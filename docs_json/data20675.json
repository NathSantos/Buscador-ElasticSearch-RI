{"add": {"doc": {"field": [{"@name": "docid", "#text": "BR-TU.25011"}, {"@name": "filename", "#text": "9548_RafaelTrevisanutoGuiraldello_revisada.pdf"}, {"@name": "filetype", "#text": "PDF"}, {"@name": "text", "#text": "U\nN\n\nIV\nER\n\nSI\nD\n\nA\nD\n\nE \nD\n\nE \nS\u00c3\n\nO\n P\n\nA\nU\n\nLO\nIn\n\nst\nit\n\nu\nto\n\n d\ne \n\nC\ni\u00ea\n\nn\nci\n\nas\n M\n\nat\nem\n\n\u00e1t\nic\n\nas\n e\n\n d\ne \n\nC\no\n\nm\np\n\nu\nta\n\n\u00e7\u00e3\no\n\nMultiscale methods for oil reservoir simulation\n\nRafael Trevisanuto Guiraldello\nTese de Doutorado do Programa de P\u00f3s-Gradua\u00e7\u00e3o em Ci\u00eancias de\nComputa\u00e7\u00e3o e Matem\u00e1tica Computacional (PPG-CCMC)\n\n\n\n\n\nSERVI\u00c7O DE P\u00d3S-GRADUA\u00c7\u00c3O DO ICMC-USP\n\nData de Dep\u00f3sito:\n\nAssinatura: ______________________\n\nRafael Trevisanuto Guiraldello\n\nMultiscale methods for oil reservoir simulation\n\nThesis submitted to the Institute of Mathematics\nand Computer Sciences \u2013 ICMC-USP \u2013 in\naccordance with the requirements of the Computer\nand Mathematical Sciences Graduate Program, for\nthe degree of Doctor in Science. FINAL VERSION\n\nConcentration Area: Computer Science and\nComputational Mathematics\n\nAdvisor: Prof. Dr. Roberto Federico Ausas\n\nUSP \u2013 S\u00e3o Carlos\nFebruary 2019\n\n\n\nFicha catalogr\u00e1fica elaborada pela Biblioteca Prof. Achille Bassi \ne Se\u00e7\u00e3o T\u00e9cnica de Inform\u00e1tica, ICMC/USP, \n\ncom os dados inseridos pelo(a) autor(a)\n\n                                       Bibliotec\u00e1rios respons\u00e1veis pela estrutura de cataloga\u00e7\u00e3o da publica\u00e7\u00e3o de acordo com a AACR2: \n                                       Gl\u00e1ucia Maria Saia Cristianini - CRB - 8/4938 \n                                       Juliana de Souza Moraes - CRB - 8/6176\n\nG965m\nGuiraldello, Rafael Trevisanuto\n   Multiscale methods for oil reservoir simulation\n/ Rafael Trevisanuto Guiraldello; orientador\nRoberto Federico Ausas. -- S\u00e3o Carlos, 2019.\n   128 p.\n\n   Tese (Doutorado - Programa de P\u00f3s-Gradua\u00e7\u00e3o em\nCi\u00eancias de Computa\u00e7\u00e3o e Matem\u00e1tica Computacional) --\n Instituto de Ci\u00eancias Matem\u00e1ticas e de Computa\u00e7\u00e3o,\nUniversidade de S\u00e3o Paulo, 2019.\n\n   1. Porous Media. 2. Darcy Flows. 3. Robin\nboundary conditions. 4. Multiscale Methods. I.\nAusas, Roberto Federico, orient. II. T\u00edtulo. \n\n\n\nRafael Trevisanuto Guiraldello\n\nM\u00e9todos multiescala para simula\u00e7\u00e3o de reservat\u00f3rios de\npetr\u00f3leo\n\nTese apresentada ao Instituto de Ci\u00eancias\nMatem\u00e1ticas e de Computa\u00e7\u00e3o \u2013 ICMC-USP,\ncomo parte dos requisitos para obten\u00e7\u00e3o do t\u00edtulo\nde Doutor em Ci\u00eancias \u2013 Ci\u00eancias de Computa\u00e7\u00e3o e\nMatem\u00e1tica Computacional. VERS\u00c3O REVISADA\n\n\u00c1rea de Concentra\u00e7\u00e3o: Ci\u00eancias de Computa\u00e7\u00e3o e\nMatem\u00e1tica Computacional\n\nOrientador: Prof. Dr. Roberto Federico Ausas\n\nUSP \u2013 S\u00e3o Carlos\nFevereiro de 2019\n\n\n\n\n\nTo Ana Maria and Antonio with all the love of my heart.\n\n\n\n\n\nACKNOWLEDGEMENTS\n\nI would like to thank all the people who have somehow contributed to the development of\nthis thesis. Firstly, I would like to thank Dr. Felipe Pereira for accepting me in this postgraduate\nprogram and for introducing me to this research area, which was the motivation for all the\nacademic research that is part of this thesis. I would also like to thank my academic advisor\nDr. Roberto Ausas for all the cooperative work, always friendly and helpful with feedback and\ninsightful ideas in the development of this research.\n\nIn order to develop this work a range of basic knowledge was essential, and in this sense\nI thank Dr. Gustavo Buscaglia, Dr. Roberto Ausas and Dr. Fabricio Sousa for all the knowledge\ntransmitted in the graduate disciplines. Here a special thanks to Dr. Gustavo Buscaglia for the\ncare to direct my studies on related topic to my research project whenever possible within these\ndisciplines.\n\nI would like to thank the Institute of Mathematical and Computer Sciences (ICMC) and\nthe University of S\u00e3o Paulo (USP) for all the resources and facilities offered for the developments\nof this research. Thanks also to the University of Texas at Dallas (UT-Dallas) for making its\nfacilities available, where part of this work was developed in an internship under the supervision\nof Dr. Felipe Pereira, which I thank for the academic collaboration during this period and for\ncontributing immensely in my stay in the city of Dallas.\n\nI would also like to thank the Center for Applied Mathematical Sciences for Industry\n(CEPID - CeMEAI) through Dr. Jos\u00e9 Cuminato for the financial support in my participation in\ninternational congresses, thus contributing to the dissemination of my results.\n\nI had the opportunity to work in collaboration with Dr. Felipe Pereira, Dr. Roberto Ausas,\nDr. Fabricio Sousa and Dr. Gustavo Buscaglia through the development of this project and in the\ndevelopment of academic articles whom I thank for the scientific collaboration, always with a\nfriendly and cooperative atmosphere, contributing to my development as a scientist.\n\nFinally, I would like to thank my parents, Ana Maria and Antonio, and also my lifemate\nVanessa for all the love and support, without you none of this would be possible.\n\n\n\n\n\n\u201cTherefore the problem is not so much, to see what nobody has yet seen,\n\nbut rather to think concerning that which everybody sees, what nobody has yet thought..\u201d\n\n(Arthur Schopenhauer)\n\n\n\n\n\nRESUMO\n\nGUIRALDELLO, R. T. M\u00e9todos multiescala para simula\u00e7\u00e3o de reservat\u00f3rios de petr\u00f3leo.\n2019. 130 p. Tese (Doutorado em Ci\u00eancias \u2013 Ci\u00eancias de Computa\u00e7\u00e3o e Matem\u00e1tica Computaci-\nonal) \u2013 Instituto de Ci\u00eancias Matem\u00e1ticas e de Computa\u00e7\u00e3o, Universidade de S\u00e3o Paulo, S\u00e3o\nCarlos \u2013 SP, 2019.\n\nNesta tese \u00e9 proposto um m\u00e9todo misto multiescala visando a aproxima\u00e7\u00e3o precisa de campos\nde velocidade e press\u00e3o em meios porosos altamente heterog\u00eaneos, o m\u00e9todo Multiscale Robin\nCoupled Method (MRCM). Este procedimento \u00e9 baseado em um novo m\u00e9todo de decomposi\u00e7\u00e3o\nde dom\u00ednio no qual os problemas locais s\u00e3o definidos com condi\u00e7\u00f5es de contorno de Robin. O\nm\u00e9todo permite a defini\u00e7\u00e3o independente de espa\u00e7os de interface para press\u00e3o e fluxo sobre\no esqueleto da decomposi\u00e7\u00e3o que pode ser escolhida com grande flexibilidade para acomodar\ncaracter\u00edsticas locais dos campos de permeabilidade subjacentes. Simula\u00e7\u00f5es num\u00e9ricas s\u00e3o\napresentadas visando ilustrar v\u00e1rias caracter\u00edsticas do novo m\u00e9todo. Ilustramos a possibilidade\nde recuperar a solu\u00e7\u00e3o multiescala de dois m\u00e9todos bem conhecidos da literatura, a saber, o Mul-\ntiscale Mortar Mixed Finite Element Method (MMMFEM) e o Multiscale Hybrid-Mixed (MHM)\nFinite Element Method por escolhas adequadas do par\u00e2metro ? nas condi\u00e7\u00f5es da interface de\nRobin. Os resultados mostram que a precis\u00e3o do MRCM depende da escolha deste par\u00e2metro\nalgor\u00edtmico, bem como da escolha dos espa\u00e7os de interface. Uma extensa avalia\u00e7\u00e3o num\u00e9rica do\nMRCM \u00e9 conduzida com dois tipos de espa\u00e7os de interface, os usuais espa\u00e7os polinomiais por\npartes e os espa\u00e7os informados, este \u00faltimo obtidos a partir da redu\u00e7\u00e3o de dimensionalidade de\nconjutos de espa\u00e7os de snapshots. Diferentes distribui\u00e7\u00f5es de inc\u00f3gnitas entre press\u00e3o e fluxo\ns\u00e3o exploradas. Os resultados mostram que ? , adequadamente adimensionalizado, pode ser\nfixado em unidade para evitar qualquer indetermina\u00e7\u00e3o no m\u00e9todo. Al\u00e9m disso, com ambos\nos tipos de espa\u00e7os, observa-se que uma distribui\u00e7\u00e3o equilibrada de inc\u00f3gnita entre press\u00e3o\ne fluxo nas interfaces torna o MRCM bastante atraente tanto em precis\u00e3o quanto em custo\ncomputacional, competitivo com outros m\u00e9todos multiescala da literatura. As solu\u00e7\u00f5es MRCM\ns\u00e3o, em geral, apenas globalmente conservativas. Dois procedimentos de p\u00f3s-processamento s\u00e3o\npropostos para recuperar a conserva\u00e7\u00e3o local dos campos de velocidade multiescala. Investiga-\nmos a aplicabilidade de tais m\u00e9todos em campos de permeabilidade altamente heterog\u00eaneos na\nmodelagem do transporte de contaminantes na subsuperf\u00edcie. Esses m\u00e9todos s\u00e3o comparados a\num procedimento padr\u00e3o da literatura. Os resultados indicam que os m\u00e9todos propostos t\u00eam o\npotencial de produzir resultados mais precisos do que o m\u00e9todo padr\u00e3o com custo computacional\nsimilar ou reduzido.\n\nPalavras-chave: Meio porosos, Fluxos de Darcy, Condi\u00e7\u00f5es de fronteira de Robin, Aproxima\u00e7\u00e3o\nmultiescala, Simula\u00e7\u00e3o de reservat\u00f3rios.\n\n\n\n\n\nABSTRACT\n\nGUIRALDELLO, R. T. Multiscale methods for oil reservoir simulation. 2019. 130 p.\nTese (Doutorado em Ci\u00eancias \u2013 Ci\u00eancias de Computa\u00e7\u00e3o e Matem\u00e1tica Computacional) \u2013 Insti-\ntuto de Ci\u00eancias Matem\u00e1ticas e de Computa\u00e7\u00e3o, Universidade de S\u00e3o Paulo, S\u00e3o Carlos \u2013 SP,\n2019.\n\nIn this thesis a multiscale mixed method aiming at the accurate approximation of velocity and\npressure fields in heterogeneous porous media is proposed, the Multiscale Robin Coupled Method\n(MRCM). The procedure is based on a new domain decomposition method in which the local\nproblems are subject to Robin boundary conditions. The method allows for the independent\ndefinition of interface spaces for pressure and flux over the skeleton of the decomposition\nthat can be chosen with great flexibility to accommodate local features of the underlying\npermeability fields. Numerical simulations are presented aiming at illustrating several features\nof the new method. We illustrate the possibility to recover the multiscale solution of two well-\nknown methods of the literature, namely, the Multiscale Mortar Mixed Finite Element Method\n(MMMFEM) and the Multiscale Hybrid-Mixed (MHM) Finite Element Method by suitable\nchoices of the parameter ? in the Robin interface conditions. Results show that the accuracy\nof the MRCM depends on the choice of this algorithmic parameter as well as on the choice of\nthe interface spaces. An extensive numerical assessment of the MRCM is conduct with two\ntypes of interface spaces, the usual piecewise polynomial spaces and the informed spaces, the\nlatter obtained from sets of snapshots by dimensionality reduction. Different distributions of\nthe unknowns between pressure and flux are explored. The results show that ? , suitably non-\ndimensionalized, can be fixed to unity to avoid any indeterminacy in the method. Further, with\nboth types of spaces, it is observed that a balanced distribution of the interface unknowns between\npressure and flux renders the MRCM quite attractive both in accuracy and in computational\ncost, competitive with other multiscale methods from the literature. The MRCM solutions are\nin general only global conservative. Two postprocessing procedures are proposed to recover\nlocal conservation of the multiscale velocity fields. We investigate the applicability of such\nmethods in highly heterogeneous permeability fields in modeling the contaminant transport in\nthe subsurface. These methods are compared to a standard procedure. Results indicate that the\nproposed methods have the potential to produce more accurate results than the standard method\nwith similar or reduced computational cost.\n\nKeywords: Porous media, Darcy Flow, Robin boundary conditions, Multiscale approximation,\nReservoir simulation.\n\n\n\n\n\nLIST OF FIGURES\n\nFigure 1 \u2013 Computational domain, meshes used for discretization and relevant notation\nto implement the MRCM. The blue dots are only used to visualize a possible\npartition TH of the skeleton ?. They might or not be nodes to which an\ninterface degree of freedom is associated. . . . . . . . . . . . . . . . . . . . 47\n\nFigure 2 \u2013 Problem setting and permeability field K(x) for the quarter of a 5\u2013spot problem. 51\n\nFigure 3 \u2013 Pressure and flux basis functions of local indices 1,6,11 and 16 corresponding\nto subdomain ?7 when using as interface spaces UH,1 and PH,1. The velocity\nfield arrows are drawn without any scale applied to them in order to simply\nillustrate the trend of the flow field. The maximum (red) and minimum (blue)\nvalues of the ?\u2019s and vector magnitude of the ?\u2019s are also indicated. . . . . 52\n\nFigure 4 \u2013 L2(?) norm of the difference between the MRCM solution and the MMM-\nFEM and MHM solutions as a function of the algorithmic parameter ? for\nthe quarter of a 5-spot problem. . . . . . . . . . . . . . . . . . . . . . . . . 53\n\nFigure 5 \u2013 Contours of pressure error and arrows of velocity error of the MRCM solution\nwith respect to the fine grid solution for different values of the Robin condition\nparameter ? of Eq. (2.65) and different coarse interface spaces UH and PH\nin the quarter of a 5-spot problem. . . . . . . . . . . . . . . . . . . . . . . 54\n\nFigure 6 \u2013 L2(?) error norm of pressure ?p?ph?L2(?) as a function of the characteristic\ncoarse interface mesh size H for the second numerical example maintaining\nthe ratio H/h constant and considering different combinations of coarse\ninterface spaces UH and PH . Solution norm: ? p ?L2(?)= 1/2. . . . . . . . 56\n\nFigure 7 \u2013 L2(?) error norm of flux ?u?uh?L2(?) as a function of the characteristic\ncoarse interface mesh size H for the second numerical example maintaining\nthe ratio H/h constant and considering different combinations of interface\nspaces UH and PH . Solution norm: ? u ?L2(?)=\n\n?\n2 ? . . . . . . . . . . . . 57\n\nFigure 8 \u2013 L2(?) error norms of pressure and flux as a function of the characteristic\ncoarse interface mesh size H for the second numerical example with fine\ngrid size h maintained constant and using UH,1 and PH,1 as interface spaces.\nSolution norm: ? p ?L2(?)= 1/2, ? u ?L2(?)=\n\n?\n2 ? . . . . . . . . . . . . . . 58\n\nFigure 9 \u2013 L2(?) error norms of pressure and flux as a function of the polynomial order\nof the discrete interface spaces UH and PH . Solution norm: ? p ?L2(?)= 1/2,\n? u ?L2(?)=\n\n?\n2 ? . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 59\n\n\n\nFigure 10 \u2013 Relative L2(?) errors for pressures (top) and fluxes (bottom), computed\nusing the fine grid solution of SPE10 as a reference. Each curve shows the\nresults of a different slice, depicted in the right-hand side. Note that the errors\nassociated with the MRCM for intermediate values of ? are considerably\nsmaller than those associated with the MMMFEM and MHM. . . . . . . . . 61\n\nFigure 11 \u2013 Relative pressure and flux error profiles for slice 36 as a function of ?\nparameter, for different computations of the Robin condition parameter. . . 62\n\nFigure 12 \u2013 Relative pressure and flux error profiles for slice 36 as a function of ?\nparameter, for different number of subdomains. . . . . . . . . . . . . . . . 63\n\nFigure 13 \u2013 Relative pressure and flux error profiles for slice 36 as a function of ?\nparameter. The inserts show the permeability field and the subdomains\ncolored by the local norm L2(?i) for each subdomain ?i. . . . . . . . . . . 64\n\nFigure 14 \u2013 Relative pressure and flux error profiles for slice 36 as a function of ?\nparameter, or different permeability contrast Kmax/Kmin. . . . . . . . . . . 66\n\nFigure 15 \u2013 Computational domain decomposition and oversampling regions. . . . . . . 75\n\nFigure 16 \u2013 Effect on ? position for L = h (solid lines) and L = H (dashed lines) for a\nsequence of fine mesh refinement. . . . . . . . . . . . . . . . . . . . . . . 79\n\nFigure 17 \u2013 Relative pressure errors (top) and relative flux errors (bottom) for a collection\nof SPE10 layers with L = H. . . . . . . . . . . . . . . . . . . . . . . . . . 80\n\nFigure 18 \u2013 Relative pressure error as function of ? for layers 33,46,42 and 45 with 5\ndof \u2019s. Solid lines: polynomial spaces; Dashed lines: informed spaces, for the\nMRCM formulation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 81\n\nFigure 19 \u2013 Relative flux error as function of ? for layers 33,46,42 and 45 with 5 dof \u2019s.\nSolid lines: polynomial spaces; Dashed lines: informed spaces, for the\nMRCM formulation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 82\n\nFigure 20 \u2013 Pressure solution for the optimal global ? and interface spaces with 5 dof \u2019s\nfor polynomials and the fine pressure solution for layer 36. . . . . . . . . . 83\n\nFigure 21 \u2013 Streamlines for the optimal global ? and interface spaces with 5 dof \u2019s for\npolynomials and the fine solution for layer 36. . . . . . . . . . . . . . . . . 83\n\nFigure 22 \u2013 Relative pressure error as function of ? for layers 30,63,67 and 75 with 4\ndof \u2019s. Solid lines: polynomial spaces; Dashed lines: informed spaces, for the\nMRCM formulation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 84\n\nFigure 23 \u2013 Relative flux error as function of ? for layers 30,63,67 and 75 with 4 dof \u2019s.\nSolid lines: polynomial spaces; Dashed lines: informed spaces, for the\nMRCM formulation. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 85\n\nFigure 24 \u2013 Absolute pressure error for the optimal global ? and interface spaces with 5\ndof \u2019s for polynomial and informed interface spaces for layer 36. . . . . . . 86\n\nFigure 25 \u2013 Absolute flux error for the optimal global ? and interface spaces with 5 dof \u2019s\nfor polynomial and informed interface spaces for layer 36. . . . . . . . . . . 87\n\n\n\nFigure 26 \u2013 Relative pressure and flux error for all the SPE10 layers considering k = 4\nand polynomial functions to build the interface spaces. . . . . . . . . . . . . 88\n\nFigure 27 \u2013 Relative pressure and flux error for all the SPE10 layers considering k = 4\nand informed functions to build the interface spaces. . . . . . . . . . . . . . 88\n\nFigure 28 \u2013 Relative pressure and flux error for all the SPE10 layers considering k = 5\nand polynomial functions to build the interface spaces. . . . . . . . . . . . . 89\n\nFigure 29 \u2013 Relative pressure and flux error for all the SPE10 layers considering k = 5\nand informed functions to build the interface spaces. . . . . . . . . . . . . . 89\n\nFigure 30 \u2013 Number of GMRES iterations to convergence for all the SPE10 layers with\nk = 5. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 90\n\nFigure 31 \u2013 Relative pressure and flux errors and number of GMRES iterations, indi-\ncated below the labels, to convergence for different domain decomposition\ngeometries,indicated at top of each graph with the number of unknowns being\nsolved in parenthesis, for the layer 36 with k = 5. . . . . . . . . . . . . . . 91\n\nFigure 32 \u2013 Permeability field used to illustrate the behavior of the multiscale method. . 96\n\nFigure 33 \u2013 Multiscale solutions produced by the MRCM method considering different\nvalues of the Robin condition parameter: ? = 10?6 (top), ? = 1 (middle),\n? = 106 (bottom). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 97\n\nFigure 34 \u2013 The computational domain along with the fine grid discretization and the\ndomain decomposition adopted. . . . . . . . . . . . . . . . . . . . . . . . . 99\n\nFigure 35 \u2013 The Patch method. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104\n\nFigure 36 \u2013 Examples of patch definitions for the Stitch method. Overlapping domains\nwith non-simplicial mesh (left) and non-overlapping domains with simplicial\nmesh (right). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106\n\nFigure 37 \u2013 The Stitch method. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 107\n\nFigure 38 \u2013 Concentration at time t = 0.5 for the fine solution and multiscale solution\nwith k = 2. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 111\n\nFigure 39 \u2013 Relative concentration errors for k = 2,3,4 and two domain decomposition:\n4\u00d74 (left column) and 8\u00d78 (right column) for the downscaling schemes,\nthe Mean (red line), the Patch (green line) and the Stitch (blue line). . . . . 112\n\nFigure 40 \u2013 Relative errors of the Patch (left) and the Stitch (right) for different patch\nsizes and the relative error of the Mean scheme (red line). . . . . . . . . . . 113\n\nFigure 41 \u2013 Relative velocity field error to the maximum absolute velocity value of the\nfine solution w/o downscaling. . . . . . . . . . . . . . . . . . . . . . . . . 113\n\nFigure 42 \u2013 Examples of permeability fields generated by the log-conductivity functions\nwith different seeds. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114\n\nFigure 43 \u2013 Relative mean error \u00b5 at each time t for the permeability fields K j(x), j =\n1,...,100, and the maximum standard deviation ? over t. Shaded area\ndenotes the maximum and minimum error region. . . . . . . . . . . . . . . 115\n\n\n\nFigure 44 \u2013 Examples of permeability fields from SPE10 project: layer 20 (top) and layer\n36 (bottom). . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 116\n\nFigure 45 \u2013 Concentrations at breakthrough time for the fine solution (top) and the multi-\nscale solution with k = 4 and the Stitch scheme (bottom) for layer 36. . . . . 117\n\nFigure 46 \u2013 Maximum relative error over t of the downscaling schemes, the Mean (red\nline), the Patch (green line) and the Stitch (blue line) for all layers of the\nSPE10 project. The dashed line indicates where the layers with channels\nbegins. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 117\n\nFigure 47 \u2013 Maximum relative errors over time t of the MRCM, MMMFEM and MHM\nfor the log-normal field (left column) and the Layer 36 (right column) for\nenriched interface spaces. . . . . . . . . . . . . . . . . . . . . . . . . . . . 119\n\n\n\nLIST OF TABLES\n\nTable 1 \u2013 Expected convergence rates of the L2(?) norm of the error for the MMMFEM\nand MHM formulations when polynomial spaces of degree ` = 0 or 1 are used\non the skeleton ?. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 55\n\nTable 2 \u2013 Order reduction for the multiscale solutions of the first numerical experiment. 110\nTable 3 \u2013 Mean \u00b5 errors and the standard deviation ? of the SPE10 layers. . . . . . . . 116\nTable 4 \u2013 Order reduction obtained by the multiscale method by enriching the interface\n\nspaces. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118\nTable 5 \u2013 Convergence order on concentration for the multiscale methods in two types\n\nof permeability fields. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 120\n\n\n\n\n\nLIST OF ABBREVIATIONS AND ACRONYMS\n\n2LM Two-Lagrange Multiplier Method\n\nMHM Multiscale Hybrid-Mixed Finite Element Method\n\nMMMFEM Multiscale Mortar Mixed Finite Element Method\n\nMRCM Multiscale Robin Coupled Method\n\nMsFEM Multiscale Finite Element Method\n\nMuMM Multiscale Mixed Method\n\nVMM Variational Multiscale Method\n\n\n\n\n\nCONTENTS\n\n1 INTRODUCTION . . . . . . . . . . . . . . . . . . . . . . . . . . . . 25\n1.1 The Darcy flow problem . . . . . . . . . . . . . . . . . . . . . . . . . . 26\n1.2 Multiscale methods . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27\n1.2.1 Domain decomposition schemes . . . . . . . . . . . . . . . . . . . . . 29\n1.2.2 Fine mesh discretization schemes . . . . . . . . . . . . . . . . . . . . . 31\n1.2.3 A multiscale method . . . . . . . . . . . . . . . . . . . . . . . . . . . . 32\n1.3 Outline . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 33\n\n2 THE MULTISCALE ROBIN COUPLED METHOD FOR FLOWS\nIN POROUS MEDIA . . . . . . . . . . . . . . . . . . . . . . . . . . 35\n\n2.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 36\n2.2 Numerical scheme . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 38\n2.2.1 The domain decomposition formulation . . . . . . . . . . . . . . . . . 38\n2.2.2 The multiscale formulation . . . . . . . . . . . . . . . . . . . . . . . . 43\n2.2.3 The multiscale implementation . . . . . . . . . . . . . . . . . . . . . . 44\n2.2.3.1 Multiscale basis functions and the interface linear system . . . . . . . . . . 46\n2.3 Numerical experiments . . . . . . . . . . . . . . . . . . . . . . . . . . . 48\n2.3.1 The quarter of a 5-spot - Relation between methods . . . . . . . . . 50\n2.3.2 Problem with a manufactured solution - Convergence assessment . 52\n2.3.3 The importance of the Robin condition parameter . . . . . . . . . . 58\n2.4 Concluding remarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 65\n\n3 INFORMED SPACES FOR THE MULTISCALE ROBIN COUPLED\nMETHOD IN RESERVOIR SIMULATION . . . . . . . . . . . . . . 69\n\n3.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 69\n3.2 The Multiscale Robin Coupled Method . . . . . . . . . . . . . . . . . 72\n3.2.1 Discrete variational formulation . . . . . . . . . . . . . . . . . . . . . . 72\n3.3 Interface spaces: Polynomial and informed . . . . . . . . . . . . . . . 74\n3.4 Numerical experiments . . . . . . . . . . . . . . . . . . . . . . . . . . . 77\n3.4.1 The characteristic length scale . . . . . . . . . . . . . . . . . . . . . . 78\n3.4.2 Comparison of multiscale mixed methods . . . . . . . . . . . . . . . . 78\n3.5 Concluding remarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 88\n\n\n\n4 VELOCITY POSTPROCESSING SCHEMES FOR THE MULTISCALE\nROBIN COUPLED METHOD FOR CONTAMINANT TRANSPORT\nIN SUBSURFACE FLOWS . . . . . . . . . . . . . . . . . . . . . . . 93\n\n4.1 Introduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 93\n4.2 The Multiscale Robin Coupled method . . . . . . . . . . . . . . . . . 98\n4.3 The velocity postprocessing schemes . . . . . . . . . . . . . . . . . . 103\n4.3.1 The Patch method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 104\n4.3.2 The Stitch method . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 106\n4.4 Numerical set-up . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 108\n4.5 Numerical Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 109\n4.5.1 First approach . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 110\n4.5.2 Robustness . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 114\n4.5.3 Comparison of multiscale methods . . . . . . . . . . . . . . . . . . . . 117\n4.6 Concluding remarks . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 118\n\n5 MAIN RESULTS AND FUTURE WORK . . . . . . . . . . . . . . . 121\n5.1 Main contributions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 121\n5.1.1 Future work . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 122\n5.1.1.1 New informed spaces - LOD . . . . . . . . . . . . . . . . . . . . . . . . . . 122\n5.1.1.2 A Multilevel MRCM . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 123\n5.1.1.3 3D HPC implementation . . . . . . . . . . . . . . . . . . . . . . . . . . . 123\n\nBIBLIOGRAPHY . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 125\n\n\n\n25\n\nCHAPTER\n\n1\nINTRODUCTION\n\nThe computational modeling of transport phenomena in porous media still presents\nmajor mathematical and numerical challenges and is, therefore, a current research topic of\ninterest both in academia and industry. Such type of problems have a remarkable complexity\nthat requires multiphysics and multiscale approach. Among the relevant phenomena that need\nto be considered are: (i) the fluid flow includes various phases such as oil, gas, and water, (ii)\nthe presence of chemical reactions and phase transitions in which thermodynamics, energy,\nand mass transport must be considered, (iii) the heterogeneity on the properties of the porous\nmedium such as permeability, porosity as well as mechanical properties such as geological faults\nand fractures at different scales need to be taken into account, (iv) the coupling between fluid\ntransport and rock deformation, (v) the spatial and temporal multiscale nature of the phenomena\nbeing considered, ranging from the micropore scale to kilometer scales spatially and from the\nscale of the few seconds, due to rapid geological events or production, due to human intervention,\nto scales of many years temporally. On top of everything mentioned, (vi) the high uncertainty\non the physical and material properties of the porous medium and the initial and the boundary\nconditions to be applied in order to solve the problem. The uncertainty in the determination of\nthe coefficients of the governing equations on reservoir flow problems implies that deterministic\npredictions for this class of problems are of limited use. In general, the properties of the medium\ncan be characterized statistically, defining quantities like the mean and covariance (GELHAR,\n1993; GELHAR, 1989; ZHANG; LU, 2004) to carry out uncertainty quantification studies\n(SMITH, 2013; LAW; STUART; ZYGALAKIS, ; GINTING; PEREIRA; RAHUNANTHAN,\n2014) which are the key concept to realistically estimate the expected error in the numerical\npredictions. However, in these studies, thousands of individual simulations typically involving\nseveral million or even billions of unknowns each need to be performed. It is clear here the need\nfor the development of high-performance simulators together with robust and accurate numerical\nmethods to allow such simulations to be made in a feasible time with high precision.\n\nDepending on each of the above mentioned cases, different mathematical models are\n\n\n\n26 Chapter 1. Introduction\n\nneeded to describe the different physical phenomena. Among these, the Darcy model is a basic\ningredient and the development and analysis of efficient numerical schemes to approach this\nmodel is the central theme of this thesis. The solution to the porous media problem is not\nonly relevant in the simulation of oil and gas reservoirs, but also in other applications such as\ncontaminant transport in aquifers, the capture of CO2, the storage of nuclear waste and also in\nresin injection processes in industry, just to name a few.\n\nExcellent references that describes in detail the mathematical and numerical treatment of\nthe above themes can be found in (CHAVENT; JAFFR\u00c9, 1986; TRANGENSTEIN; BELL, 1989b;\nTRANGENSTEIN; BELL, 1989a; CHEN, 2007; CHEN, 2005; CHEN; HUAN; MA, 2006;\nCOUSSY, 2010; HOU; WU, 1997; EFENDIEV; HOU, 2008; DURLOFSKY; GERRITSEN,\n2006) among others.\n\nIn the next sections we introduce the mathematical problem to be handled as well as the\nkey concepts for a multiscale approximation of the problem.\n\n1.1 The Darcy flow problem\nConsider the single-phase incompressible case with no effects of gravity, for simplicity\n\n(see (CHEN; HUAN; MA, 2006)). The problem for the pressure p and the velocity u based on\nDarcy\u2019s law is given by:\n\n? \u00b7u = f in ? (1.1)\n\nu =?K ?p in ? (1.2)\n\np = gD on ?D (1.3)\n\nu \u00b7n = gN on ?N (1.4)\n\n?? u \u00b7n + p = gR on ?R (1.5)\n\nwhere ? ?Rd , d = 2 or 3 is the problem\u2019s domain, K is a symmetric, uniformly positive definite\ntensor with components in L?(?), u is the fluid velocity, p is the pressure, f ? L2(?) the\nsource/sink terms, gD, gN and gR are the pressure boundary data, the normal velocity data and the\nRobin boundary condition data, respectively, where ? is positive function defined on ?R and n is\nthe outer normal vector to ? ?. Eq. (1.1) is the mass conservation equation and Eq. (1.2) is the\nDarcy law. The extension to the multiphase case, i.e., problems in which two or more fluids are\npresent can be seen, for example, in (CHAVENT; JAFFR\u00c9, 1986; CHEN; HUAN; MA, 2006).\n\nConsider now the following spaces\n\nW = L2(?), V = H(div,?) e VgN ={v ? V; v\u00b7n = gN on ?N}\n\nwhere\nH(div,?) =\n\n{\nq ? L2(?)d ; ?\u00b7q ? L2(?)\n\n}\n.\n\n\n\n1.2. Multiscale methods 27\n\nThe mixed variational formulation of problem (1.1-1.5) is given by: Find u ? VgN and p ?W ,\nsuch that:?\n\n?\n\nK?1u\u00b7v +\n?\n?R\n\n? (u\u00b7n)(v\u00b7n)?\n?\n\n?\n\np?\u00b7v = ?\n?\n\n?D\n\ngDv\u00b7n?\n?\n?R\n\ngR v\u00b7n ?v ? V0?\n?\n\n?\u00b7u w =\n?\n\n?\n\nf w ?w ?W,\n(1.6)\n\nwhere we assume that gD and gR are regular enough so that problem (1.6) is well posed\n(see (K\u00f6NN\u00f6; SCHOETZAU; STENBERG, 2011)). Note that the pressure and Robin boundary\ncondition happens to be introduced in a natural way in formulation (1.6), that is why in the\ncontext of finite elements these conditions are called the natural boundary conditions. On the\nother hand, the flux boundary condition needs to be included in the test space VgN and is called\nan essential boundary condition. Formulation (1.6) involves the divergence of the solution and\ntest functions, but not arbitrary first order derivatives. This allow us to work with H(div,?), i.\ne., a space spanned by polynomial vectors by parts that are only required to have their normal\ncomponents to be continuous, an important fact for the finite element approximation of this\nproblem.\n\n1.2 Multiscale methods\n\nThe direct simulation of the three-dimensional problem (1.6) in the reservoir scale taking\ninto account the spatial scales of permeability K can result in very large discrete problems,\ninvolving up to billions of unknowns to produce a consistent approximation. To resolve this issue\nand incorporate the fine-scale information in the numerical simulations, in the context of methods\nbased on variational formulations, two lines of work have appeared: The multiscale finite element\nmethods (MsFEM) and variational multiscale methods (VMM). Although the methods have\nbeen introduced separately, similarities, and in some cases equivalences, are observed.\n\nThe basic idea in the multiscale finite element method was introduced by Babuska and\nOsborn in (BABUSKA; OSBORN, 1983). In this work, the concept of generalized basis functions\nwas introduced, where local problems are solved at element level and fine-scale information is\nintroduced into the solution. From here, the idea was generalized and extended to numerous\nproblems.\n\nAs mentioned by Aarnes in (AARNES, 2006), the work of Hou and Wu (HOU; WU,\n1997) was one of the first to recognize the potential on these methods to solve two and three-\ndimensional elliptic problems with coefficients that exhibit high spatial variations, both in the\ncontext of Darcy\u2019s problem and compositive material problems in solid mechanics. In the case of\nan elliptic problem with 2D periodic coefficients the multiscale solution was proved to converge\nto the solution of the problem according to the homogenization theory. In the linear case, the\nsolution of local problems can be done in an offline stage and the basis functions used a posteriori\n\n\n\n28 Chapter 1. Introduction\n\nto solve a global problem. In the nonlinear case, this can not be done in principle, but the\nmethodology still has advantages because the solution of all local problems can be performed\nmuch more efficiently (e.g., in parallel) when compared to the complete solution of the problem\nin the fine mesh.\n\nSimilarly, multiscale variational methods were introduced for the purpose of capturing\nfine scale phenomena. The method was originally proposed by Hughes in (HUGHES, 1995;\nHUGHES et al., 1998). Considering an abstract problem L (u) = f (+ boundary conditions),\nthe idea to separate the scales in the associated variational problem is to split the search and\ntest spaces as direct sum of the function space for the large scales V? and a space for the fine\nscales V ?. The solution is then written as the sum of a part that will be solved numerically via\na finite element method plus a part that will be solved \"analytically\" (or in practice by some\nlocalization process) to incorporate the effect of fine scales, i.e., the solution u ?V = V? ?V ?,\nu = u? + u?, u? ? V? , u? ?V ?. The problem to be solved for u? in the fine scale uses the residual of\nthe differential equation in the large scale given by L (u?)? f . From here the method has been\napplied and extended to several areas. A full and detailed description of this type of method\ncan be found in the references cited above. One of the interesting aspects to be considered is\nthe relation of the method with several formulations of stabilized finite elements, providing a\ngeneral and formal framework for its development.\n\nApplications of the mixed and mixed-hybrid forms were studied later in both cases as\ncan be seen, for example, in (CHEN; HOU, 2003; ARBOGAST et al., 2007; ARBOGAST,\n2004) among others. Extension for the finite volume formulations were also considered (see\n(JENNY; LEE; TCHELEPI, 2003; LUNATI; JENNY, 2006; LEE; ZHOU; TCHELEPI, 2009;\nHAJIBEYGI; TCHELEPI, ; BOSMA et al., 2017)). It is worth mentioning here the interesting\nwork of (KIPPE; AARNES; LIE, 2008) where these and other methods are compared in terms\nof accuracy.\n\nThe focus of this thesis is on the multiscale finite element methods based on domain\ndecomposition (DD) schemes in which the domain ? is decomposed into non-overlapping\nsubdomains ?i,i = 1,...,m and local problems are solved in each ?i, due to their potential\nto solve efficiently elliptic problems with rapidly varying coefficients in parallel multi-core\ncomputers.\n\nTo describe such type of MsFEM, consider problem (1.1-1.5) but now, for simplicity,\nwith only pressure boundary conditions, given by\n\n?\u00b7u = f in ?\nu = ?K ? p in ?\np = gD in ? ?\n\n. (1.7)\n\nTo produce a multiscale approximation of the above problem one need:\n\n? A domain decomposition scheme;\n\n\n\n1.2. Multiscale methods 29\n\n? A discrete solver for the Darcy problem.\n\nIn the next sections we recall these concepts, then we use then to produce an example of\na multiscale method.\n\n1.2.1 Domain decomposition schemes\n\nIn the study of transport in porous media a consistent approximation of the solution\nof differential equations, such as (1.7), usually requires a fine enough mesh to capture the\nspatial variation in small scales of the coefficient K, leading to large linear systems involving\nseveral millions or even billions unknowns, as mentioned earlier. Solving such a type of system\ndirectly implies an extremely high computational cost and/or processing time. To reduce such a\ncomputational burden, domain decomposition methods becomes an interesting alternative. The\ndomain decomposition methods are a set of \"divide and conquer\" schemes used to find numerical\nsolutions of partial differential equations, mainly elliptic and parabolic, that can be classified\naccording to the choice of the domain partition as overlapping and non-overlapping methods.\nIn (QUARTERONI; VALLI, 1999) and (MATHEW, 2008) there is a complete discussion on\nsuch type of methods. In this work we focus on non-overlapping methods due to its natural\nparallelization. In such type of methods, the domain ? is decomposed into non-overlapping\nsubdomains {?i}, i = 1,...,m and local problems are solved in each ?i. At the so-called skeleton\n? of the partition (the union of all internal interfaces ?i, j = ?i ?? j) compatibility conditions\nneed to be satisfied, i.e.,\n\nui \u00b7ni + u j \u00b7n j = 0 , (1.8)\n\npi ? p j = 0 , (1.9)\n\nfor the collection of local solutions {ui, pi} to be a solution of (1.7).\n\nBy restricting problem (1.7) to the subdomains ?i results in the domain decomposition\nproblem given by: Find ui ? V? and pi ?W?\n\n?\u00b7ui = f in ?i\nui = ?K ?pi in ?i\npi = gD on ? ?i ?? ?\n\npi = p j\n.\n= pi j on ?i j\n\nui \u00b7ni =?u j \u00b7n j .= Ji j on ?i j\n\n, (1.10)\n\nwhere V? and W? are adequate spaces. We assume that f is regular enough such that problems\n(1.7) and (1.10) are equivalent.\n\nWe now want to formulate a set of local problems in ?i equivalent to problem (1.10). For\nthis we must satisfy two conditions. Firstly, the restrictions of ui and pi must satisfy each local\n\n\n\n30 Chapter 1. Introduction\n\nproblem. Secondly, every local problem should be well posed. We now need to define a coupling\nstrategy between subdomains. Different subdomain coupling strategies were extensively studied\nduring the last years. An overview of these studies is described, for example, in (LIONS, 1990;\nCHEN et al., 2011; COWSAR; WHEELER, 1991).\n\nConsider the following strategy: Find ui ? V? , pi ?W? and ? ? M, for i = 1,..,m, such\nthat\n\n? \u00b7ui = f i in ?i\nui = ?K ? pi in ?i\npi = gD on ? ?i ?? ?\npi = ? on ?i\n\n(1.11)\n\nthat satisfy\nui \u00b7ni + u j \u00b7n j = 0 on ?i j,i ?= j. (1.12)\n\nwhere ?i = ? ?i ?? and M is a suitable interface space. That is, we have defined the\nlocal problems (1.11) by given a unique pressure boundary condition ? defined over ?. Note\nthat, by doing so, we are automatically satisfying condition (1.9) and is left for us to a find the\nunique pressure in ? that satisfy condition (1.8), i.e., the jump on the normal component of the\nvelocity in ?, as described in Eq. (1.12).\n\nIf one choose appropriate function spaces, we can multiply the above equations by test\nfunctions (including the jump restriction) and obtain the following variational problem: Find\nui ? V? , pi ?W? and ? ? M, for i = 1,..,m, such that\n\n?\n?i\n\nK?1ui \u00b7v?\n?\n\n?i\npi?\u00b7v +\n\n?\n?i\n\n? v\u00b7ni =\n?\n\n? ?i??D gDv\u00b7n\ni ?v ? V??\n\n?i\n? \u00b7ui w =\n\n?\n?i\n\nfi w ?w ?W?\n?\n\nm\ni=1\n?\n\n?i\n\u00b5 ui \u00b7ni = 0 ?\u00b5 ? M\n\n, (1.13)\n\nwhich is a mixed-hybrid variational formulation that is well posed if the involved spaces are\n\nV? =\nn?\ni\n\nVi, W? =\nn?\n\ni=1\n\nL2(?i),\n\nM =\n{\n\n\u00b5 ? H1/2(?), \u00b5|? ? (Vi \u00b7ni)?\n}\n,\n\nwhere\nVi = H(div; ?i),\n\nwhere (\u00b7)? denotes the dual space.\n\nThis formulation was originally proposed by (GLOWINSKI; WHEELER, 1988) as a\ndomain decomposition method combined with mixed finite elements and is the basis for the\nmultiscale formulation of (ARBOGAST et al., 2007; GANIS; YOTOV, 2009). Other possible\n\n\n\n1.2. Multiscale methods 31\n\noptions using the compatibility Eq.(1.8) - (1.9) is to define local problem with flux boundary\nconditions leading to the problem of satisfy the pressure jumps in ?. This method is explored\nin (BERNARDI; MADAY; PATERA, 1994; BELGACEM, 1999) for the primal variational\nformulation and is the basis of the multiscale method of (HARDER; PAREDES; VALENTIN,\n2013; ARAYA et al., 2013). One can also consider a linear combination of the compatibility\nconditions, leading to local problems defined with Robin boundary conditions type, a possibility\nexplored in (DOUGLAS et al., 1993; LOISEL, 2013) that is the basis of the multiscale method\nof (FRANCISCO et al., 2014; GUIRALDELLO et al., 2018b).\n\n1.2.2 Fine mesh discretization schemes\n\nWe are interested in numerical approximations of Darcy problems like (1.7), i.e., to\napproximate a pressure p and a velocity u with the requirement that the velocity field preserves\nthe property of being continuous on every element of the triangulation and has continuous normal\ncomponent between adjacent elements. A velocity field of this type is called a mass conservative\nand is appropriate to solve the governing transport equations of different scalar fields, such as\nconcentrations of passive tracers in the linear case to saturation fields in nonlinear cases.\n\nMass conservative formulations are essential to avoid the spurious creation/destruction of\nfluid, and thus, to accurately predict the long-term evolution (days or even years of physical time)\nof a reservoir. For problem (1.7), we have this property when we consider its mixed variational\nformulation and ask for its solution in discrete subspace of V = H(div,?), i.e., given a regular\nmesh Th of ?? in T elements, an approximation in finite elements consist in choose discrete\nsubspaces Vh ? H(div,?) and Wh ?W = L2(?) and solve the following problem:\nFind uh ?Vh ? V and ph ?Wh ?W such that:?\n\n?\n\nK?1uh \u00b7vh ?\n?\n\n?\n\nph? \u00b7vh = ?\n?\n\n?D\n\ngDvh \u00b7n ?vh ? Vh?\n?\n\n? \u00b7uh wh =\n?\n\n?\n\nf wh ?wh ?W\n. (1.14)\n\nThe most popular discrete spaces that satisfy this property are the Raviart-Thomas\n(RT) (RAVIART; THOMAS, 1977) and Brezzi-Douglas-Marini (BDM) (BREZZI; DOUGLAS;\nMARINI, 1985) spaces. Different formulations using these discrete spaces can be found in\n(RAVIART; THOMAS, 1977; NEDELEC, 1980; BREZZI et al., 1987b; BREZZI et al., 1987a;\nARBOGAST et al., 2000; DOUGLAS et al., 1993) and their citations, and the books of (BREZZI;\nFORTIN, 1991; ROBERTS; THOMAS, 1991; QUARTERONI; VALLI, 1999).\n\nIn addition to finite element methods, finite volume methods are of interest because\nthey are very popular in the industry and there is a complete range of codes available that can\nsolve complete problems, including the multiphase nonlinear case, which can be used in the\ndevelopment of multiscale methods. The equivalence between these methods can be established\nfor several cases (see (CHAVENT; JAFFR\u00c9, 1986; EYMARD; GALLOU\u00cbT; HERBIN, 2000;\n\n\n\n32 Chapter 1. Introduction\n\nRUSSEL; WHEELER, 1983; ARBOGAST; WHEELER; YOTOV, 1997; VOHRAL\u00cdK, 2006;\nBARANGER; MAITRE; OUDIN, 1996) and references therein).\n\n1.2.3 A multiscale method\n\nNow we put together the above ingredients and describe a multiscale method to approxi-\nmate problem (1.7). Let us start by recalling the domain decomposition variational formulation\n(1.13) given by: Find ui ? V? , pi ?W? and ? ? M, for i = 1,..,m, such that\n\n?\n?i\n\nK?1ui \u00b7v?\n?\n\n?i\npi?\u00b7v +\n\n?\n?i\n\n? v\u00b7ni =\n?\n\n? ?i??D gDv\u00b7n\ni ?v ? V??\n\n?i\n? \u00b7ui w =\n\n?\n?i\n\nfi w ?w ?W?\n?\n\nm\ni=1\n?\n\n?i\n\u00b5 ui \u00b7ni = 0 ?\u00b5 ? M\n\n. (1.15)\n\nTo discretize this problem, consider a triangulation Th of ? ? Rd,d = 2,3, into d-\ndimensional simplexes. From this, consider a conform partition of ? into m subdomains ?i,\nsuch that each simplex T ? Th belong to one and only one subdomain and define Th,i as the\ntriangulation correspondent to ?i.\n\nFor each ?i, consider the lowest-order Raviart-Thomas spaces for velocity and pressure\ngiven by Vih = RT0(?i) and W\n\ni\nh =\n\n{\nw ? L2(?i),w(x)|T ?P0)\n\n}\n. As we have a global conform\n\nmesh, it naturally induces a unique partition in the skeleton ?. Consider the space given by\n\nFh(Sh) ={ f : Sh ?R | f |e ? P0 , ?e ? Sh}, (1.16)\n\nin which Sh is any set o faces/edges of Th. Notice that Fh(? ?i) is the space of normal traces of\nVih. Let ?h be the set of all faces/edges over ? and define Mh = Fh(?h).\n\nThe multiscale method reads as: Find uih ? V\ni\nh, p\n\ni\nh ? W\n\ni\nh and ?H ? MH ? Mh for each\n\ni = 1,...,m, such that:\n\n?\n?i\n\nK?1uih \u00b7v?\n?\n\n?i\npih ?\u00b7v +\n\n?\n?i\n\n?H v\u00b7ni = ?\n?\n\n? ?i??D gD v\u00b7ni ?v ? V\ni\nh?\n\n?i\n?\u00b7uih w =\n\n?\n?i\n\nf w ? w ?W ih\n?\n\nm\ni=1\n?\n\n?i\nuih \u00b7n\n\ni\n\u00b5 = 0 ?\u00b5 ? MH\n\n. (1.17)\n\nThe above multiscale method is nothing but a particular case of the MMMFEM (see\n(ARBOGAST et al., 2000; ARBOGAST et al., 2007)). Notice that the first two equation of (1.17)\naccounts for the local problem in {?i} where the local meshe Th,i are fine enough to capture the\nsmall scale variations in the permeability without any approximation (or upscaling) of K. These\nare small problems when compared to the global problem in ? and are usually solved in parallel.\nBy choosing a low-dimensional space MH ? Mh, all local problems can be uncoupled, leaving us\nto find the interface pressure ?H ? MH that solves the third equation of (1.17), which accounts\nfor the flux jump between subdomain in a weak sense and couples the subdomain solutions,\nreducing the number of unknowns to NP, the dimension of MH = span{?1,...,?NP}. If one take\n\n\n\n1.3. Outline 33\n\nMH = Mh, we retrieve the domain decomposition method of (GLOWINSKI; WHEELER, 1988)\nin which for the above defined spaces has a unique solution equivalent to the non-decomposed\nproblem (m = 1).\n\n1.3 Outline\nThis thesis is mainly composed of scientific articles co-authored by the thesis\u2019s author\n\nproduced in the development of this doctoral project and organized as chapters. Thus, each\nchapter contains its own introduction and conclusion regarding the scope of the article. In\naddition, the thesis has an introductory chapter and a closing chapter highlighting the main\ncontributions and is organized as follows:\n\n? Chapter 1 describes the background and purpose of this thesis.\n\n? In Chapter 2 a multiscale mixed method aiming at the accurate approximation of velocity\nand pressure fields in heterogeneous porous media is proposed. This chapter is based on\nthe publication \"The Multiscale Robin Coupled Method for porous media flows\"(MRCM)\n(GUIRALDELLO et al., 2018b).\n\n? Chapter 3 presents an extensive numerical assessment of the MRCM, exploring the\nflexibility of the method in order to increase its accuracy. This chapter is based on the\nfollowing publication \"Interface spaces for the Multiscale Robin Coupled method in\nreservoir simulation\" (GUIRALDELLO et al., 2018a).\n\n? Chapter 4 presents two new downscaling (or postprocessing) procedures to recover local\nconservation and compatibility of the velocity field at fine grid level. These new procedures\nare compared with an usual procedure in multiscale solutions produced by global con-\nservative multiscale methods and evaluated in the case of passive tracers. This chapter is\nbased on the manuscript \"Velocity postprocessing schemes for the Multiscale Robin Cou-\npled method for contaminant transport in subsurface flows\" submitted to the a renowned\ninternational journal.\n\n? Chapter 5 summarizes the main result obtained and discuss future works.\n\n\n\n\n\n35\n\nCHAPTER\n\n2\nTHE MULTISCALE ROBIN COUPLED\n\nMETHOD FOR FLOWS IN POROUS MEDIA\n\nA multiscale mixed method aiming at the accurate approximation of velocity and pressure\nfields in heterogeneous porous media is proposed. The procedure is based on a new domain\ndecomposition method in which the local problems are subject to Robin boundary conditions. The\ndomain decomposition procedure is defined in terms of two independent spaces on the skeleton\nof the decomposition, corresponding to interface pressures and fluxes, that can be chosen with\ngreat flexibility to accommodate local features of the underlying permeability fields. The well-\nposedness of the new domain decomposition procedure is established and its connection with the\nmethod of Douglas et al., Numer. Math., 65(1):95\u2013108, 1993, is identified, also allowing us to\nreinterpret the known procedure as an optimized Schwarz (or Two-Lagrange-Multiplier) method.\nThe multiscale property of the new domain decomposition method is indicated, and its relation\nwith the Multiscale Mortar Mixed Finite Element Method (MMMFEM) and the Multiscale\nHybrid-Mixed (MHM) Finite Element Method is discussed. Numerical simulations are presented\naiming at illustrating several features of the new method. Initially we illustrate the possibility of\nswitching from MMMFEM to MHM by suitably varying the Robin condition parameter in the\nnew multiscale method. Then we turn our attention to realistic flows in high-contrast, channelized\nporous formations. We show that for a range of values of the Robin condition parameter our\nmethod provides better approximations for pressure and velocity than those computed with either\nthe MMMFEM and the MHM. This is an indication that our method has the potential to produce\nmore accurate velocity fields in the presence of rough, realistic permeability fields of petroleum\nreservoirs.\n\n\n\n36 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\n2.1 Introduction\nMultiscale formulations of the porous media equations have been developed over the last\n\ntwenty years motivated by the practical needs of the energy and environmental sectors. High-\nresolution permeability data are generated by geologists and hydrologists from seismic data,\npointwise sampling and statistical models. These data are highly heterogeneous, with no scale\nseparation, so that simplifications of the model by rigorous homogenization techniques cannot\nbe applied. Reservoir simulators thus resort to numerical multiscale methods to obtain coarsened\nmodels (with much fewer degrees of freedom) that nevertheless incorporate the fine-grid details\nof the permeability field.\n\nConsider the single-phase porous media problem\n\nu = ?K ?p in ? (2.1)\n\n?\u00b7u = f in ? (2.2)\n\np = g on ? ?p (2.3)\n\nu\u00b7n = z on ? ?u (2.4)\n\nwhere ? ?Rd , d = 2 or 3 is the problem\u2019s domain, K is a symmetric, uniformly positive definite\ntensor with components in L?(?), u is the fluid velocity, p is the pressure, f ? L2(?) the source,\ng ? H\n\n1\n2 (? ?p) the pressure boundary data, z ? H?\n\n1\n2 (? ?u) the normal velocity data and n is the\n\nouter normal to ? ?.\n\nOf the multiscale formulations available in the literature, the focus here is on those\nbased on domain decomposition (DD) techniques, in which the domain ? is decomposed into\nnon-overlapping subdomains {?i}, i = 1,...,m and local problems are solved in each ?i. At\nthe so-called skeleton ? of the partition (the union of all interfaces ?i, j = ?i ?? j) compatibility\nconditions need to be satisfied, i.e.,\n\nui \u00b7n?i + u j \u00b7n? j = 0 , (2.5)\n\npi ? p j = 0 , (2.6)\n\nfor the collection of local solutions {ui, pi} to be a solution of (2.1)-(2.4).\n\nThe finite element literature shows two main DD-based multiscale formulations: MMM-\nFEM and MHM.\n\nThe first one, introduced by Arbogast and co-authors (ARBOGAST et al., 2007), is\nbased on the mixed formulation of (2.1)-(2.4) and its discretization by div-stable elements\nin each subdomain. It is known as MMMFEM, for Multiscale Mortar Mixed Finite Element\nMethod. The local problems have pressure boundary conditions at each ? ?i ??. The Lagrange\nmultiplier ? that enforces the continuity of fluxes across ? is nothing but the interface pressure\np|?. This procedure is turned into a multiscale formulation by restricting ? to belong to a suitable\nlow-dimensional space ?H , where H refers to the size of the partition. Inside each subdomain,\n\n\n\n2.1. Introduction 37\n\nvelocity and pressure are approximated with fine-grid spaces Vih \u00d7Q\ni\nh, where h is the size of the\n\nfine grid, assumed much smaller than H. In MMMFEM the pressure compatibility condition\n(2.6) is satisfied (weakly) at the fine-grid level, whereas the flux compatibility condition (2.5) is\nrelaxed to ?\n\n?\n\n(\nui \u00b7n?i + u j \u00b7n? j\n\n)\n\u00b5H = 0 , ?\u00b5H ? ?H . (2.7)\n\nAs a consequence, there is a lack of accuracy in flux conservation at ? that takes place even if\nthe numerical scheme inside each subdomain is exactly conservative (such as RTk or BDMk\nfinite elements (RAVIART; THOMAS, 1977; BREZZI; DOUGLAS; MARINI, 1985), or finite\nvolume schemes). Cures for this crucial problem have been sought through post-processing\n(SILVA; LOULA, 2002; CORREA; LOULA, 2007) or downscaling techniques (JENNY; LEE;\nTCHELEPI, 2003; FRANCISCO et al., 2014).\n\nThe Multiscale Hybrid-Mixed Finite Element Method (MHM), on the other hand, was\nintroduced by Harder et al in 2013 (HARDER; PAREDES; VALENTIN, 2013; ARAYA et\nal., 2013) and starts from the mortar formulation as introduced by Bernardi and co-workers in\n(BERNARDI; MADAY; PATERA, 1994) and Belgacem in (BELGACEM, 1999). In MHM the\nlocal problems have flux boundary conditions, i.e., ui \u00b7n?i is assigned the value of an unknown\nLagrange multiplier ? at ? ?i ??. A fine-grid is used in each subdomain as in the MMMFEM,\nbut in the case of the MHM formulation it is the flux ? that is restricted to belong to a coarse\nspace ?H , yielding a field ?H that approximates the flux across ?. As a consequence, (2.5) is\n(weakly) satisfied with fine-grid accuracy, whereas pi ? p j is only enforced to satisfy?\n\n?\n\n(pi ? p j)?H = 0 , ??H ? ?H . (2.8)\n\nThe drawback is a lack of accuracy in the pressure compatibility condition (2.6).\n\nThe MHM formulation is more involved than the MMMFEM formulation because\none has to deal with the non-existence of solution of the local problems unless the imposed\nboundary flux values at each ? ?i exactly balance the source term integrated over ?i. The\npractical implementation adds one global unknown per subdomain, a constant-pressure mode,\nincreasing the dimension of the global interface problem to dim(?H)+ m.\n\nIn this context it is natural to look for methods that combine the good properties of\nthe two formulations described above, in which the error in satisfying (2.5)-(2.6) is distributed\nover the two equations, trying to find a convenient compromise between the flow conservation\nproperties of the MHM method and the simplicity of the MMMFEM.\n\nIn this article, we elaborate on the formulation known as Multiscale Mixed Method\n(MuMM) (FRANCISCO et al., 2014), which is based on a domain decomposition technique\nintroduced by Douglas et al (DOUGLAS et al., 1993). The local problems are subject to Robin\nboundary conditions on ?, which are generally written as\n\n??i ui \u00b7n?i + pi = gR (2.9)\n\n\n\n38 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\nwhere ?i is the Robin condition parameter and gR the prescribed value. As in the original\nMuMM, we assume that a global fine mesh Th exists and that the subdomains are obtained\nby partitioning Th into m regions {?i} of size H, much larger than h. A discrete multiscale\nvariational formulation is introduced for the MuMM allowing its generalization to arbitrary\ninterface spaces, a possibility that was not studied in the original publication. The proposed\nmethod, named Multiscale Robin Coupled Method (MRCM) is then compared to the MMMFEM\nand MHM, which are shown to be limit cases of the MRCM as ? ? 0 and ? ? ?, and suitable\nvalues of the Robin condition parameter are identified.\n\n2.2 Numerical scheme\n\nDomain decomposition methods are usually presented by first introducing the formulation\nat the continuous level and then approximating it by a finite-dimensional counterpart arising, for\nexample, from finite elements. In the case of Robin interface conditions, as noted by Douglas et al\n(DOUGLAS et al., 1993), the trace spaces of the continuous problem are unclear so that interface\nintegrals can only be written formally, without rigorous justification. To avoid this theoretical\nsetback, we present the new domain decomposition formulation directly in the discrete case,\nassuming a structured fine mesh of lowest-order Raviart-Thomas element RT0 and a diagonal\nmobility tensor, which up to a quadrature error is equivalent to the most popular cell-centered\nfinite volume method. This domain decomposition formulation is interesting in itself, especially\ndue to its connections with Douglas et al\u2019s iterative scheme (DOUGLAS et al., 1993) and with\nthe Optimized Schwarz and Two-Lagrange-Multiplier methods (LOISEL, 2013).\n\n2.2.1 The domain decomposition formulation\n\nLet Th be a subdivision of the domain ? ?Rd into a Cartesian mesh of d-dimensional\nrectangles. From this mesh, a partitioning of ? is made into subdomains {?i}i=1,...,m, such\nthat each rectangle K ? Th belongs to one and only one of the subdomains. The submesh\ncorresponding to ?i is denoted by T ih .\n\nOn each ?i we define the lowest-order Raviart-Thomas spaces for velocity and pressure,\n\nVih = {v ? H(div,?i) , v j(x)|K = p j1(x1)p j2(x2)... ,?K ? T\ni\n\nh ,\n\nwith p jk ? P1 if j = k , p jk ? P0 if j ?= k } (2.10)\n\nQih = {q ? L\n2(?i) , q(x)|K ? P0} , (2.11)\n\nwhere Pk is the space of polynomials of degree ? k. Because the submeshes are a partition of a\nunique div-conformal mesh, the space of normal traces of {Vih} onto the skeleton ? is uniquely\ndefined. Let Sh be any subset of edges/faces of Th (e.g., ?), then we define\n\nFh(Sh) ={ f : Sh ?R | f |e ? P0 , ?e ? Sh} . (2.12)\n\n\n\n2.2. Numerical scheme 39\n\nNotice that Fh(? ?i) is the space of normal traces of Vih. We assume that ? ?u and ? ?p coincide\nwith subsets of Th ?? ? and introduce\n\nVihy = {v ? V\ni\nh , v\u00b7n? = y on ? ?i ?? ?u} , (2.13)\n\nwhere we have assumed that y belongs to Fh(? ?u) (if not, it should be replaced by its projection).\nNow, let Eh be the set of all faces/edges of Th contained in ?. On each face/edge e ? Eh we also\nintroduce a unique normal n?, which is the exterior normal to ? ? if e ? ? ?, and if e belongs to\nsome ?i, j ? ? then it is defined as the unit normal exterior to the subdomain with smallest index,\nmin{i, j}.\n\nWe need to define spaces for pressure and fluxes at subdomain interfaces:\n\nPh = Fh(Eh) (2.14)\n\nUh = {Vh ? Fh(Eh) | Vh = 0 on Rh} (2.15)\n\nwhere Rh is the set of edges in Eh which have ? = 0 on both sides. When discussing matters not\nconnected to the boundary conditions, the discrete spaces Vihz and V\n\ni\nh0 will be denoted generically\n\nby Vih. The (global) direct product of the subdomain spaces V\ni\nh and Q\n\ni\nh will be denoted by Vh\n\nand Qh, respectively,\nVh = ?mi=1 V\n\ni\nh , Qh = ?\n\nm\ni=1 Q\n\ni\nh . (2.16)\n\nThe discrete variational formulation we consider is the following: Let U and P be\narbitrary subspaces of Uh and Ph, respectively. Find (uih, p\n\ni\nh) ? V\n\ni\nhz\u00d7Q\n\ni\nh, for i = 1,...,m, and\n\n(U,P) ? U \u00d7P such that\n\n(K?1uih,v)?i ?(p\ni\nh,?\u00b7v)?i +(P??iU n?\n\ni \u00b7n? + ?i uih \u00b7n?\ni,v\u00b7n?i)? ?i?? = ?(g,v\u00b7n?\n\ni)? ?i?? ?p ,\n\n(2.17)\n\n(q,?\u00b7uih)?i = ( f ,q)?i , (2.18)\nm\n\n?\ni=1\n\n(uih \u00b7n?\ni,M)? ?i?? = 0 , (2.19)\n\nm\n\n?\ni=1\n\n(?i (uih \u00b7n?\ni ?U n?\u00b7n?i),V n?i \u00b7n?)? ?i?? = 0 , (2.20)\n\nhold for all (v,q) ? Vih0 \u00d7Q\ni\nh , ?i = 1,...,m , for all M ? P and for all V ? U . A weak\n\nimposition of the boundary flux conditions on ? ?u could also be considered.\n\nLet us explain the conceptual basis for this formulation. Notice first that, if ?i = 0 for all\ni, then (2.20) reduces to 0 = 0 and the formulation is simply the Mortar Mixed Finite Element\nMethod (GLOWINSKI; WHEELER, 1988; ARBOGAST et al., 2000), P being the Lagrange\nmultiplier on ?, which has the physical interpretation of a pressure. Clearly, the unknown U is\ncompletely undetermined if all ?i\u2019s are zero. Now consider ?i > 0. Considering P and U known,\nEq. (2.17) is a discretization of (2.1) in subdomain ?i with Robin boundary condition\n\np??i u\u00b7n?i = P??i U n?\u00b7n?i . (2.21)\n\n\n\n40 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\nWith respect to the case ?i = 0, we have a new unknown U , so that the problem is not closed\nby adding just the flux-continuity equation (2.19). The required additional equation, that in fact\ndetermines U , comes from requiring pressure continuity weakly. From (2.21) we see that\n\np? i\ndef\n= P??i U n? \u00b7n?i + ?i uih \u00b7n?\n\ni (2.22)\n\nis a recovered boundary pressure for ?i. It is then natural to impose pressure continuity weakly\nat an interface ?i, j as\n\n(P??i U n?\u00b7n?i + ?i uih \u00b7n?\ni,V n? \u00b7n?i) = (P?? j U n? \u00b7n? j + ? j u\n\nj\nh \u00b7n?\n\nj,V n?\u00b7n?i) , ?V ? U . (2.23)\n\nCancelling out P, and using n? j =?n?i one arrives at (2.20). It is interesting to notice that (2.20)\nimplies\n\nU|?i, j = ?U\n?iuih \u00b7n? + ? ju\n\nj\nh \u00b7n?\n\n?i + ? j\n, (2.24)\n\nwhere ?U stands for the L2-projection onto U . A connection may be established with the\ndecomposition methods proposed in (LEIVA; BLANCO; BUSCAGLIA, 2010; BLANCO;\nLEIVA; BUSCAGLIA, 2013) which also introduce two unknown fields per interface for the\ncoupling.\n\nProposition 1. The solution ({uih, p\ni\nh},U,P) to the discrete formulation (2.17)-(2.20) is unique\n\nin ?mi=1(V\ni\nhz \u00d7Q\n\ni\nh)\u00d7U \u00d7P.\n\nProof. Assume g = z = f = 0, take v = uih in (2.17), q = p\ni\nh in (2.18), M = ?P in (2.19) and\n\nV =?U in (2.20). Adding up all the resulting equations one gets\nm\n\n?\ni=1\n\n[\n(K?1uih,u\n\ni\nh)?i +?\n\n?\n?i (uih \u00b7n??U)?\n\n2\n? ?i??\n\n]\n= 0 . (2.25)\n\nFrom this one concludes that uih = 0 for i = 1,...,m, and that U = 0. We are thus left with\n\n(pih,? \u00b7v)?i = (P,v\u00b7n?\ni)? ?i?? , ?v ? V\n\ni\nh0 , ?i , (2.26)\n\nto prove that pih = 0 and that P = 0. Take v such that v \u00b7 n?\ni = 0 on ? ?i and such that ? \u00b7v =\n\npih ?Di, where Di is the mean of p\ni\nh over ?i. Then\n\n?\n?i\n\npih(p\ni\nh ?Di) = 0 which implies that\n\npih = Di, constant per subdomain. Inserting this into (2.26) and integrating by parts one gets\n(Di ?P,v \u00b7 n?i)? ?i?? = 0, which implies Di = P on ? ?i ?? because (since P ? Ph) P|? ?i??\nbelongs to the normal trace space of V ih0. The fact that P is constant over each ? ?i ?? for all i\nimplies that P = C, a constant over the whole of ?. This then allows to conclude that pih = C for\nall i. Going back once again to (2.26), now with P = pih = C, taking v as the restriction to ?i of\nany w ? Vh0 ?H(div,?) and then adding over all subdomains one finally obtains\n\nC\n?\n\n? ?p\n\nw\u00b7n? = 0 , ?w ? Vh0 ?H(div,?) .\n\nIf ? ?p consists of at least one edge of Th this implies C = 0.\n\n\n\n2.2. Numerical scheme 41\n\nRemark 1. It is noteworthy that the well-posedness of the MRCM formulation does not require\nany compatibility condition between the spaces U and P. In fact, U does not even need to be a\nsubspace of Uh. The situation for P is different, since in the proof one needs a compatibility\ncondition between P and Vih to conclude, from (Di ?P,v \u00b7 n?\n\ni)? ?i?? = 0, that Di = P. This\ncompatibility condition is nothing but the usual inf-sup condition of the mixed mortar method,\n\ninf\n0?=P?P\n\nsup\nv?Vih0\n\n(\nP,v\u00b7n?i\n\n)\n? ?i??\n\n> 0 ,\n\nwhich in the proposed formulation is automatically satisfied because P ? Ph.\n\nWe now show that the proposed formulation is indeed a domain decomposition method,\ni.e., it yields the same solution as the non-decomposed formulation if U = Uh and P = Ph.\n\nProposition 2. Let ({uih, p\ni\nh},Uh,Ph) be the solution of the discrete formulation (2.17)-(2.20)\n\nwith U = Uh and P = Ph, and let (uh, ph) ? (Vhz ?H(div,?))\u00d7Qh be the solution of the\nnon-decomposed discrete problem (m = 1), which satisfies\n\n(K?1uh,v)? ?(ph,?\u00b7v)? = ?(g,v\u00b7n?)? ?p , (2.27)\n\n(q,?\u00b7uh)? = ( f ,q)? , (2.28)\n\nfor all v ? Vh0 ?H(div,?) and all q ? Qh.\n\nThen, assuming ?i to be constant on each edge of Eh ?? ?i,\n\nuih = uh|?i (2.29)\n\npih = ph|?i (2.30)\n\nUh = uh \u00b7n? on ??Rh (2.31)\n\nProof. Let us show that (uh, ph), restricted to each subdomain, satisfies (2.17)-(2.20). Because\nuh ? H(div,?) we know that u?ih\n\ndef\n= uh|?i satisfies (2.19). This implies, from the assumption on\n\n?i, that U?h\ndef\n= u?ih \u00b7n? satisfies (2.20) and the two terms containing ?i cancel out in (2.17).\n\nBecause (u?ih, p?\ni\nh) is the restriction to ?i of the global solution (uh, ph), there exists a\n\nunique P?ih in the restriction of Ph to ? ?i ?? such that\n\n(K?1u?ih,v\ni)?i?(p?\n\ni\nh,?\u00b7v\n\ni)?i +(P?\ni\nh,v\n\ni\u00b7n?i)? ?i?? =?(g,v\ni\u00b7n?i)? ?i?? ?p , ?v\n\ni ? Vih0 . (2.32)\n\nAdding over subdomains we get\nm\n\n?\ni=1\n\n[\n(K?1u?ih,v\n\ni)?i ?(p?\ni\nh,? \u00b7v\n\ni)?i +(g,v\ni \u00b7n?i)? ?i?? ?p\n\n]\n+\n\nm\n\n?\ni=1\n\n(P?ih,v\ni \u00b7n?i)? ?i?? = 0 . (2.33)\n\nTake now vi = v|?i , with v ? Vh0 ?H(div,?) an element of the unbroken global velocity space.\nFrom the definition of u?ih such v\n\nis make the first sum in (2.33) to vanish, and so\n\n(\nvi \u00b7n?i + v j \u00b7n? j = 0 , ? ?i, j\n\n)\n?\n\nm\n\n?\ni=1\n\n(P?ih,v\ni \u00b7n?i)? ?i?? = 0 .\n\n\n\n42 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\nThis can only happen if P?ih = P?\nj\n\nh on every ?i, j, and thus a single-valued P?h ? Ph can be defined\nthat makes (2.17) to hold. The uniqueness of solution for (2.17)-(2.20) makes uih = u?\n\ni\nh, p\n\ni\nh = p?\n\ni\nh,\n\nUh = U?h and Ph = P?h.\n\nRemark 2. If all ?i are positive, then Ph = Uh = Fh(Eh). Denoting\n\n?\ni\nh = Ph|? ?i?? ??i Uh|? ?i?? n?\u00b7n?\n\ni , (2.34)\n\nthen one has, for any ?i, j ? ?,\n\nPh =\n? j?\n\ni\nh + ?i?\n\nj\nh\n\n?i + ? j\n, Uhn? \u00b7n?i =\n\n?\nj\n\nh ??\ni\nh\n\n?i + ? j\n. (2.35)\n\nUsing this, formulation (2.17)-(2.20) can be rewritten as: Find (uih, p\ni\nh,?\n\ni\nh) ? V\n\ni\nhz\u00d7Q\n\ni\nh\u00d7\n\nFh(Eh ?? ?i), for i = 1,...,m, such that\n\n(K?1uih,v)?i ?(p\ni\nh,?\u00b7v)?i +(?i u\n\ni\nh \u00b7n?\n\ni,v\u00b7n?i)? ?i?? +(?\ni\nh,v\u00b7n?\n\ni)? ?i?? = ?(g,v\u00b7n?\ni)? ?i?? ?p ,\n\n(2.36)\n\n(q,? \u00b7uih)?i = ( f ,q)?i , (2.37)\nm\n\n?\ni=1\n\n(uih \u00b7n?\ni,Mh)? ?i?? = 0 , (2.38)\n\nm\n\n?\ni=1\n\n(?i uih \u00b7n?\ni + ? ih,Vh n?\n\ni \u00b7n?)? ?i?? = 0 , (2.39)\n\nhold for all (v,q) ? Vih0 and for all (Mh,Vh) ? Fh(Eh)\u00d7Fh(Eh).\n\nThis can be identified as the variational formulation that underlies the domain decom-\nposition algorithm proposed by Douglas et al (DOUGLAS et al., 1993). In fact, their iterative\nalgorithm assumes a red-black colouring of the subdomains with an initial value of ? ih for all red\n?i\u2019s. This allows to solve (2.36)-(2.37) for uih and p\n\ni\nh. Then (2.38)-(2.39) are considered at all\n\ninterfaces ?i, j, where ? j is a black subdomain, which yield the update formula for ?\nj\n\nh as\n\n?\nj\n\nh = ?\ni\nh + ?i u\n\ni\nh \u00b7n?\n\ni ?? ju\nj\nh \u00b7n?\n\nj = ? ih +(?i + ? j)u\ni\nh \u00b7n?\n\ni .\n\nThe process can then be iterated switching the roles of the black and red subdomains.\n\nRemark 3. Equations (2.36)-(2.39) also provide the variational formulation of the so-called Two-\nLagrange-Multiplier (2LM) method, or Optimized Schwarz method (LOISEL, 2013; LOISEL;\nNGUYEN; SCHEICHL, 2015; MADAY; MAGOUL\u00c8S, 2006). The ? ih, of which there exist\ntwo at each edge of each internal interface ?i, j, are the two Lagrange multipliers that give the\nmethod its name (notice that in our formulation there is no unknown shared by more than two\nsubdomains).\n\nThe 2LM formulation (2.36)-(2.39) may be seen as more concise, and perhaps more\nelegant, than the proposed (equivalent if U = P = Fh(Eh)) formulation (2.17)-(2.20). The latter\n\n\n\n2.2. Numerical scheme 43\n\nis however more powerful, since the separate roles of the interface pressure Ph and of the interface\nflow Uh can be clearly identified. As explained in the next section, this allows for the design of\nmultiscale formulations with different spaces for P and U , which is not possible if the start\npoint is (2.36)-(2.39).\n\n2.2.2 The multiscale formulation\n\nMultiscale variants of domain decomposition formulations, such as the MMMFEM and\nthe MHM method, follow the strategy of creating two discretization scales by restricting the\nLagrange multiplier space, which roughly speaking is Fh(Eh) in the fine grid, to a much coarser\nspace defined at a scale H ? h. Usually, H is the size of the individual subdomains.\n\nTake for example the Mortar Mixed Finite Element Method (GLOWINSKI; WHEELER,\n1988; ARBOGAST et al., 2000), which is nothing but our DD formulation (2.17)-(2.20) with\nP = Ph and ?i = 0 for all i. In this case, one obtains the fine grid solution, whereas taking\nP = PH (a coarse subspace of Ph) one obtains its multiscale version, the MMMFEM. Similarly,\nthe MHM method is obtained from the Mortar Method (BELGACEM, 1999) by taking a coarse\nsubspace UH for the Lagrange multiplier, which in this case is U . Notice that the Mortar Method\nis (intuitively) the limit of our DD formulation when ?i ?+?, which makes the unknown P to\ndisappear.\n\nFollowing the same strategy, the multiscale approach we propose simply consists of\ntaking coarse spaces U = UH and P = PH in (2.17)-(2.20) while keeping the fine-scale\nspaces Vih for velocity and Q\n\ni\nh for pressure inside each ?i. Let us follow the tradition and give\n\na name to the proposed method. Be it Multiscale Robin Coupled method, MRCM, which as\nshown in Prop. 1 yields a well\u2013posed discrete problem with the sole condition that PH ? Ph\n(see Remark 1).\n\nWhen the interface spaces are coarsened, the computational cost is greatly alleviated\nin both calculations and message passing operations. The solution is certainly quite different\nfrom that computed on the fine mesh, unless the interface subspaces happen to approximate very\nwell the fine mesh solution. A unique feature of MRCM is that coarse spaces for both interface\npressure and flux can be chosen arbitrarily, while MMMFEM only allows the user to select PH\nand MHM only allows to select UH .\n\nPiecewise polynomial interface spaces were the first to be explored in multiscale formu-\nlations (GANIS; YOTOV, 2009; HARDER; PAREDES; VALENTIN, 2013) and are the ones\nimplemented in this work, since they are easy to code and allow for rigorous analysis. More\nprecisely, our interface spaces UH and PH are projections of piecewise polynomial spaces\nonto Fh(Eh). For highly heterogeneous media a convenient alternative to piecewise polynomial\nspaces are informed spaces, in which fine-mesh solutions are precomputed at some neighborhood\n(oversampling) of each interface ?i, j, and from them some reduction technique is applied to\n\n\n\n44 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\nbuild PH and/or UH . This alternative has been explored recently by Chung et al (CHUNG;\nFU; YANG, 2016) for the MMMFEM, while it remains unexplored for the MHM method. The\nassessment of the MRCM with informed spaces is however left for future work.\n\n2.2.3 The multiscale implementation\n\nThis section provides details on the implementation of the Multiscale Robin Coupled\nMethod. The way followed to describe our implementation shares similarities to that used by\nGanis and Yotov for the Multiscale Mortar Mixed Finite Element method in (GANIS; YOTOV,\n2009). Referring to Fig. 1, let us consider a non-overlapping domain decomposition of ? into\nsubdomains ?i, i = 1,...,m. Also consider associated to the skeleton ? of this decomposition,\na partition denoted by TH (see Fig. 1 to visualize a possible partition of the skeleton) and to\nthis partition coarse\u2013scale spaces UH and PH for fluxes and pressure, respectively. Though\nnot strictly necessary (see Remark 1), both UH and PH are taken as subspaces of Fh(Eh). This\nsimplifies the coding and garantees, because PH ? Ph = Fh(Eh), that the discrete problem is\nwell posed. As said, the size of the partition H is typically much larger than h, therefore the\ndimension of these subspaces is small as compared to that of Fh(Eh) as depicted in Fig. 1.\n\nIn order to explain the implementation, let us suppose at this stage (UH,PH)? UH \u00d7PH\nknown. This way, we can rewrite the local problems on each subdomain as: Find (uih, p\n\ni\nh) ?\n\nVihz \u00d7Q\ni\nh, for i = 1,...,m, such that\n\n(K?1uih,v)?i ?(p\ni\nh,?\u00b7v)?i +(?i u\n\ni\nh \u00b7n?\n\ni,v\u00b7n?i)? ?i?? = ?(PH ??iUH n?\ni \u00b7n?,v\u00b7n?i)? ?i??\n\n?(g,v\u00b7n?i)? ?i?? ?p , (2.40)\n\n(q,? \u00b7uih)?i = ( f ,q)?i , (2.41)\n\nhold for all (v,q) ? Vih0 \u00d7Q\ni\nh , ?i = 1,...,m . Now, we perform an additive decomposition of\n\nthe solution (uih, p\ni\nh) as\n\nuih = u?\ni\nh + u?\n\ni\nh, (2.42)\n\npih = p?\ni\nh + p?\n\ni\nh. (2.43)\n\nOn the one hand, (u?h, p?h)? Vihz\u00d7Q\ni\nh satisfies the subdomain problems with interface values UH\n\nand PH equal to zero and nonzero forcing terms, that is\n\n(K?1u?ih,v)?i ?(p?\ni\nh,?\u00b7v)?i +(?i u?\n\ni\nh \u00b7n?\n\ni,v\u00b7n?i)? ?i?? = ?(g,v\u00b7n?\ni)? ?i?? ?p , (2.44)\n\n(q,?\u00b7u?ih)?i = ( f ,q)?i , (2.45)\n\nhold for all (v,q) ? Vih0 \u00d7Q\ni\nh , ?i = 1,...,m . On the other hand, (u?\n\ni\nh, p?\n\ni\nh)? V\n\ni\nh0 \u00d7Q\n\ni\nh satisfies\n\nthe subdomain problems with forcing terms f and g identically equal to zero\n\n(K?1u?ih,v)?i ?(p?\ni\nh,?\u00b7v)?i +(?i u?\n\ni\nh \u00b7n?\n\ni,v\u00b7n?i)? ?i??, = ?(PH ??iUH n?\ni \u00b7n?,v\u00b7n?i)? ?i??\n\n(2.46)\n\n(q,?\u00b7u?ih)?i = 0, (2.47)\n\n\n\n2.2. Numerical scheme 45\n\nhold for all (v,q) ? Vih0 \u00d7Q\ni\nh , ?i = 1,...,m .\n\nThe local problems above, like (2.40)\u2013(2.41) or any other considered in the rest of the\narticle can be solved by choosing any standard discrete spaces for Vih0 and Q\n\ni\nh. In this article\n\nwe restrict ourselves to the two dimensional case and the lowest order Raviart-Thomas space\nRT0 on quadrilateral cartesian grids of uniform cell size h (see Fig. 1). As known, the choice of\nthis space and a combination of the midpoint and the trapezoidal rules for numerical integration\nproduces a discrete system which only involves pressure unknowns and that is equivalent to a\nclassical cell\u2013centered finite volume method (see (ARBOGAST; WHEELER; YOTOV, 1997)\nfor instance).\n\nLet us provide some details of the final algebraic equations that are generated by problem\n(2.40)\u2013(2.41) for our choice of finite element and mesh. We denote the pressure unknowns,\nlocated at the cell centers, by ph,I,J and the flux unknowns, located at the faces midpoints, by\nuh,I\u00b11/2,J (for horizontal faces) or uh,I,J\u00b11/2 (for vertical faces). Assuming K to be elementwise\nconstant, Eq. (2.40) translates into the following two-point formulas for any internal edge of the\nmesh:\n\nuh,I+1/2,J =?K?I+1/2,J\nph,I+1,J ? ph,I,J\n\nh\n, uh,I?1/2,J =?K?I?1/2,J\n\nph,I,J ? ph,I?1,J\nh\n\n,\n\nuh,I,J+1/2 =?K?I,J+1/2\nph,I,J+1 ? ph,I,J\n\nh\nuh,I,J?1/2 =?K?I,J?1/2\n\nph,I,J ? ph,I,J?1\nh\n\n.\n\n(2.48)\n\nThe indices I and J above run through all fine scale cells of the local problems, and the K?\u2019s\nare the harmonic means of the permeabilities at interelement faces, for example, K?I+1/2,J =\n2 KI,J KI+1,J/(KI,J + KI+1,J). Turning to Eq. (2.41), for each fine scale cell it translates into\n\nh\n(\nuh,I+1/2,J ?uh,I?1/2,J + uh,I,J+1/2 ?uh,I,J?1/2\n\n)\n= h2 fI,J. (2.49)\n\nAs for the treatment of boundary conditions, those of the flux type are imposed directly by\nreplacing the right hand side of the corresponding flux expression (Eq. (2.48)) by the prescribed\nvalue at boundary edges, which is consistent with the definition of V ihy in Eq. (2.13).\n\nFor boundary edges subject to pressure conditions Eq. (2.48) can be rewritten as\n\nuh,I?1/2,J =?KI,J\npI,J ??I?1/2,J\n\nh/2\n(2.50)\n\nwhere ?I?1/2,J is a face pressure which is set to the prescribed value. The case of a Robin\nboundary condition, given as in (2.9), also leads to Eq. (2.50), but with the value of ?I?1/2,J now\nreplaced by\n\n?I?1/2,J = gR + ?i uh \u00b7n?\ni = gR ??i uh,I?1/2,J (2.51)\n\nThough Eqs. (2.50) and (2.51) are specific to a West boundary, they readily extend to the others.\n\nInserting Eqs. (2.48) or (2.50) into (2.49) one ends up with a linear system only involving\npressure unknowns. Suitable modifications of the scheme that deal with anisotropic (tensorial)\n\n\n\n46 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\npermeability coefficients can be found in (ARBOGAST; WHEELER; YOTOV, 1997). More\nsophisticated finite volume methods, known as Multipoint Flux Approximations (MPFA) are\ndiscussed in, for example, (VOHRAL\u00cdK, 2006).\n\nLet us now turn to the next ingredient of the implementation, namely the construction\nof the coarse discrete spaces UH and PH . Their respective finite element basis are denoted by\n{? j}1? j?nU and {?\n\nj}1? j?nP , so that the unknowns UH and PH are written as\n\nUH =\nnU\n\n?\n`=1\n\nXU` ?\n`, PH =\n\nnP\n\n?\n`=1\n\nX P` ?\n` , (2.52)\n\nwhere nU = dim(UH) and nP = dim(PH). By considering Eqs. (2.19)-(2.20) that corresponds to\nweak flux and pressure continuity on ?, now posed on the coarse scale H, we may simultaneously\nsolve for all fields and subdomains. However, it is possible to eliminate the internal subdomain\ndegrees of freedom, thus solving a relatively small system for the interface unknowns alone. This\nis accomplished by building multiscale basis functions on the different subdomains as explained\nnext.\n\n2.2.3.1 Multiscale basis functions and the interface linear system\n\nWe define multiscale basis functions by solving certain local problems in each subdomain.\nFirst, we need to introduce some notation. Let us define the global vector of interface unknowns\nX ? Rn, n = nU + nP, X =\n\n(\nXU ,X P\n\n)T\n, XU =\n\n(\nXU1 ,...,X\n\nU\nnU\n\n)\nand X P =\n\n(\nX P1 ,...,X\n\nP\nnP\n\n)\n. For sub-\n\ndomain ?i, i = 1,...,m, let us also define J i as the set of indices of global interface degrees of\nfreedom associated to basis functions for UH and PH whose support is on the boundary ? ?i??.\nThe multiscale basis functions in ?i, denoted here as {?ik j ,?\n\ni\nk j\n}1?k j?ni , being ni = |J\n\ni| (the\nnumber of elements in J i) and k j = 1,...,ni a local subdomain numbering of the unknowns\ncorresponding to global indices j ? J i, are obtained as solutions of problem (2.46)-(2.47) as\nfollows. For j ? J i, if 1 ? j ? nU , basis function k j of subdomain ?i is obtained by solving the\nlocal problem with boundary data UH = ? j, PH = 0, i.e., find (?ik j ,?\n\ni\nk j\n) ? Vih0 \u00d7Q\n\ni\nh, such that\n\n(K?1?ik j ,v)?i ?(?\ni\nk j ,? \u00b7v)?i +(?i ?\n\ni\nk j \u00b7n?\n\ni,v\u00b7n?i)? ?i?? = (?i?\njn?i \u00b7n?,v\u00b7n?i)? ?i??,\n\n(2.53)\n\n(q,?\u00b7?ik j )?i = 0, (2.54)\n\nhold for all (v,q) ? Vih0 \u00d7Q\ni\nh, whereas, if nU &lt;j ? nU + nP, subdomain basis function k j\n\nis obtained by solving the local problem with boundary data UH = 0, PH = ? j?nU , i.e., find\n(?ik j ,?\n\ni\nk j\n) ? Vih0 \u00d7Q\n\ni\nh, such that\n\n(K?1?ik j ,v)?i ?(?\ni\nk j ,?\u00b7v)?i +(?i ?\n\ni\nk j \u00b7n?\n\ni,v\u00b7n?i)? ?i?? = ?(?\nj?nU ,v\u00b7n?i)? ?i??,\n\n(2.55)\n\n(q,? \u00b7?ik j )?i = 0, (2.56)\n\n\n\n2.2. Numerical scheme 47\n\n? = ?0(p)? Uh ? F(Eh) p ?Pk(e)\n\nExterior to ?i\n\nn?\n\nn?i\n\nExterior to ?min{i, j}\n\nTh\n\n? ?\n\n?\n\nTH(?)\n\n?1\n\n? j=5\n\nn?i\n\nn?i\n\nn?i\n\nn? n?\n\nn?\n\nn?\n? j=7\n\nn?i\n\nh\n\nH\n\n?i, j\n?8\n\n?9\n\n?3 ?4? j=2\n\n? j=10\n\ne ? TH(?)\n\nI ?1/2,J I + 1/2,J\n\nI,J?1/2\n\nI,JI ?1,J I + 1,J\n\nI,J + 1\n\nI,J?1\n\nI,J + 1/2\n\nuh, K?\n\nph, f (x), K(x)\n\n? f\n\n?i? j\n\n?i=6\n\nSource: Elaborated by the author.\n\nFigure 1 \u2013 Computational domain, meshes used for discretization and relevant notation to implement the\nMRCM. The blue dots are only used to visualize a possible partition TH of the skeleton ?.\nThey might or not be nodes to which an interface degree of freedom is associated.\n\nhold for all (v,q) ? Vih0 \u00d7Q\ni\nh. Computation of these basis functions can be done off\u2013line and is\n\nnaturally parallelizable.\n\nNow, we are ready to build the interface linear system. To this end, first note that by the\n\n\n\n48 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\nlinearity of the problem, the local solutions on each subdomain can be written as\n\nu?ih = ?\nj?J i\n\nX j?\ni\nk j , p?\n\ni\nh = ?\n\nj?J i\nX j?\n\ni\nk j . (2.57)\n\nRecalling the decomposition (2.42)-(2.43) and the weak flux and pressure continuity Eqs.\n(2.19)-(2.20) on the coarse scale, we write\n\nm\n\n?\ni=1\n\n(\nu?ih \u00b7n?\n\ni,MH\n)\n\n? ?i??\n= ?\n\nm\n\n?\ni=1\n\n(\nu?ih \u00b7n?\n\ni,MH\n)\n\n? ?i??\n, (2.58)\n\nm\n\n?\ni=1\n\n(?i (u?ih \u00b7n?\ni ?Uhn?i \u00b7n?),VH n?i \u00b7n?)? ?i?? = ?\n\nm\n\n?\ni=1\n\n(?i (u?ih \u00b7n?\ni),VH n?i \u00b7n?)? ?i??. (2.59)\n\nFinally, by substituing (2.57) and testing with all basis functions of UH and PH we end up with\nthe linear system\n\nA X = b. (2.60)\n\nIf a matrix\u2013free method is used to solve the linear system, such as the Biconjugate Gradient\nor the GMRES method, no explicit computation of the matrix coefficients becomes necessary,\notherwise, the entries of matrix A =\n\n[\na` j\n]\n?Rn\u00d7n are, for j = 1,...,n\n\na` j =\n\n??\n??\n\nm\ni=1(?i (?\n\ni\nk j\n\u00b7n?i ?? jn?i \u00b7n?),? ` n?i \u00b7n?)? ?i??, for 1 ? `? nU\n\n?\nm\ni=1\n\n(\n?\n\ni\nk j\n\u00b7n?i,?`?nU\n\n)\n? ?i??\n\n, for nU &lt;`? n\n(2.61)\n\nwhere ? j = ? j if 1 ? j ? nU and zero otherwise and recalling that for the i-th subdomain and for\neach k j, j must belong to the set J i for the corresponding term to make sense in (2.61). As for\nthe right hand side vector b = [b`]?Rn, computing its entries involves the particular solutions\nu?ih previously found by solving (2.44)-(2.45), yielding\n\nb` =\n\n??\n???\n\nm\ni=1(?i (u?\n\ni\nh \u00b7n?\n\ni),? ` n?i \u00b7n?)? ?i??, for 1 ? `? nU\n??mi=1\n\n(\nu?ih \u00b7n?\n\ni,?`?nU\n)\n\n? ?i??\n, for nU &lt;`? n\n\n(2.62)\n\nComputing the integrals above is straightforward once all functions are piecewise constant on\nthe set of edges of Th contained in ?. Also notice that, as pointed out by Ganis and Yotov\n(GANIS; YOTOV, 2009), during the resolution of the interface problem, storing the whole set\nof subdomain basis functions values may lead to an unnecessary memory burden, being that\nin this step only the fluxes and recovered pressure values at the edges lying on ? are required.\nConsequently, the authors recommend to store only those values and after solving (2.60) perform\na last subdomain solve to find (u?ih, p?\n\ni\nh) so the final global solution can be reconstructed.\n\n2.3 Numerical experiments\nThis section presents a numerical assessment of the Multiscale Robin Coupled method\n\nand its comparison in some classical benchmark problems to the Multiscale Mortar Mixed and\n\n\n\n2.3. Numerical experiments 49\n\nHybrid-Mixed Finite Element methods previously introduced. We aim to illustrate the possibility\nof switching from one method to the other by suitably varying the Robin condition parameter\nin the MRCM formulation and also show the possibility of choosing different (coarse) spaces\nUH and PH for flux and pressure on the interface. Three test examples are addressed. First,\nthe classical quarter of a 5\u2013spot problem is studied by considering a random (log normal)\npermeability field of moderate variability. Second, a problem with a manufactured solution\nproposed in (HARDER; PAREDES; VALENTIN, 2013) is presented in order to assess the\nconvergence properties of the scheme. Finally, the MRCM formulation is assessed by solving\nseveral sections of the SPE10 benchmark with high contrast permeability fields that exhibit\nchannelized regions. All numerical results are restricted to the two dimensional case assuming\nan isotropic diagonal permeability tensor. As for the construction of the discrete spaces UH and\nPH on the interface, we will restrict ourselves in this article to the following spaces for flux and\npressure\n\nUH = {VH, VH|e = ?0(q),q ?P`U (e), e ? TH}, (2.63)\n\nPH = {MH, MH|e = ?0(q),q ?P`P(e), e ? TH}, (2.64)\n\nwhere Pk, k = `U or `P is the space of polynomials of degree k and ?0 is the L2\u2013projection of a\nfunction of Pk(e) onto the space Fh(e), e ?TH , i.e., UH and PH are made up of the elementwise\nconstant fine grid representation of polynomials of degree k over the interface elements. These\nspaces will be denoted by UH,k and PH,k from now on. In most of the numerical examples\nbelow k is made either equal to 0 or 1. For simplicity, in the first two numerical experiments TH\nis built by taking only one element per interface ?i, j between subdomains. In the third numerical\nexperiment we also consider the possibility of performing a simple refinement of the skeleton\npartition to better illustrate the properties and versatility of the scheme. More sophisticated\nchoices for these spaces and other interface refinements of TH are certainly possible and\nrelatively easy to handle, but these are left for future work.\n\nAs for the Robin condition parameter, from dimensional analysis we can see that the\nvalue of ?i on subdomain i in our discrete formulation should be chosen as:\n\n?i(x) =\n?(x)L\nK(x)\n\n, (2.65)\n\nwhere L is a characteristic length scale that in line with (FRANCISCO et al., 2014) is chosen to\nbe equal to the mesh size h. The non-dimensional function ? and the permeability K are tunnable\nalgorithmic parameters to be selected. Different choices are possible for this parameter, such as\ndiscontinuous or continuous functions at subdomain interfaces. A natural choice for K that is\nadopted in the first two numerical examples corresponds to using the local permeability Ki(x) in\n(2.65), which yields in general different parameters for each subdomain. In the third numerical\nexample, other options are explored, e.g., using the harmonic mean of the permeabilities between\nneighboring subdomains. A comprehensive survey on the choice of ?i and the possibility of\nselecting it adaptively is the subject of ongoing works.\n\n\n\n50 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\n2.3.1 The quarter of a 5-spot - Relation between methods\n\nThis first example intends to illustrate the behavior of the MRCM formulation as the\nRobin condition parameter ? introduced in Eq. (2.65) is increased from very small values, where\nthe method behaves as the MMMFEM formulation, up to very large values, where the MRCM is\nexpected to behave as the MHM formulation. To this end, we consider the classical quarter of a\n5-spot problem. The computational domain ? = [0,1]\u00d7[0,1] is considered with a point source\nlocated at the top left corner and a point sink located at the bottom right corner as displayed in\nFig. 2. Boundary conditions correspond to no flow on ? ?. A heterogeneous permeability field\ngiven by\n\nK(x) = e? ? (x), (2.66)\n\nis used, where ? controls the permeability contrast Kmax/Kmin which is taken to be 2455.8\nin this numerical example and ? (x) is a self similar Gaussian distribution with zero mean\nand covariance function C(x,y) = |x?y|?1/2. Figure 2 shows a particular realization of this\npermeability field used in the simulations with a logarithmic color scale to better appreciate\nthe permeability contrast. The domain is decomposed into 4\u00d74 subdomains also indicated in\nthe figure, each one discretized by a 16\u00d716 (fine) grid, thus having H = 1/4 and h = H/16.\nFrom this decomposition, subdomain basis functions {?ik j ,?\n\ni\nk j\n} are computed according to the\n\nnumerical procedure explained in the previous section. At this point, it is interesting to illustrate\nthe behavior of such functions. Let us consider, for instance, the interface spaces UH,1 and PH,1.\nFor this case, Fig. 3 shows plots of four (out of sixteen) local flux and pressure basis functions for\nsubdomain ?7, setting the Robin condition parameter ? equal to 1. To enhance the visualization,\nthe velocity field arrows have been plotted without any scale applied to them in order to simply\nappreciate the trend of flow field. The shape of these functions clearly reflects the complexity of\nthe flow as a consequence of the random permeability field being considered.\n\nWe aim now to study the behavior of the MRCM method as the Robin condition parameter\n? in Eq. (2.65) is varied continuously and report the L2(?) norm of the difference between the\nMRCM solution and those obtained by the MMMFEM and MHM methods, both, implemented\ninto independent codes as explained in (ARBOGAST et al., 2000) and (HARDER; PAREDES;\nVALENTIN, 2013) respectively. For the MMMFEM, the corresponding Lagrange multiplier \u00b5H\nis chosen in the coarse interface space PH,k, whereas for the MHM method, the corresponding\nLagrange multiplier ?H is chosen in UH,k.\n\nWe report pressure and flux errors using UH,0, PH,0 and UH,1, PH,1 as coarse interface\nspaces in this experiment. As mentioned, a single element per interface between neighboring\nsubdomains is used to create the partition TH of the skeleton ?. Results are shown in Fig. 4.\nThis figure shows the difference between the MRCM and the MMMFEM formulations goes to\nzero as the algorithmic parameter ? is reduced. Conversely, as ? is increased the solution of\nthe MRCM formulation becomes closer to that obtained by the MHM method. This numerical\nevidence indicates the MRCM formulation changes continuously from the MMMFEM to the\n\n\n\n2.3. Numerical experiments 51\n\nMHM method as the Robin parameter is varied. As commented, a rigorous proof of this fact,\nhowever, is out of the scope of the article. Figure 4 indicates that asymptotically the MRCM\napproaches the MMMFEM (as ? ? 0) and the MHM (as ? ? ?) linearly with respect to the\nRobin condition parameter ? . In order to further illustrate the behavior of the method, Fig. 5\nshows the pressure error and arrows of the velocity field error for the MRCM formulation with\nrespect to the fine grid solution, for three different values of the parameter ? and the same coarse\ninterface spaces previously used. Clearly, results that correspond to UH,0 and PH,0 exhibit the\nlarger errors. Notice this error is somewhat more concentrated near subdomain boundaries in all\ncases, as can be expected once the discretization has been weakened precisely at the interfaces\nbetween subdomains. At least in this case, the MRCM method shows improved accuracy as\nthe Robin condition parameter is increased. However, this is not always the case as we will see\nlater on in the following numerical examples, which motivates the possibility of selecting ?i\nadaptively in the different regions so as to switch between methods according to their accuracy\nor improved performance at particular locations.\n\n? = [0,1]\u00d7[0,1]\n\nK(x) = e2.5 ? (x)\n\n? (x)? Gaussian\n\n?7\n\nSource: f (h/2,1?h/2) = 1\n\nSink: f (1?h/2,h/2) =?1\nSource: Elaborated by the author.\n\nFigure 2 \u2013 Problem setting and permeability field K(x) for the quarter of a 5\u2013spot problem.\n\n\n\n52 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\n?\n7\n11: min =?5.2\u00d710\n\n?1, max = 5.02\u00d710?1\n?\n\n7\n11: min = 9.05\u00d710\n\n?3, max = 1.03\u00d7101\n\n?\n7\n16: min =?1.47\u00d710\n\n?2, max = 5.89\u00d710?3\n?\n\n7\n16: min = 7.03\u00d710\n\n?5, max = 3.87\u00d710?1\n\n?\n7\n6: min =?1.91\u00d710\n\n?2, max =?7.79\u00d710?5\n?\n\n7\n6: min = 6.07\u00d710\n\n?4, max = 8.28\u00d710?1\n\n?\n7\n1: min = 4.87\u00d710\n\n?3, max = 8.51\u00d710?3\n?\n\n7\n1: min = 1.35\u00d710\n\n?1, max = 4.67\u00d7101\n\nUH = 0, PH ? constant\n\nU\nH\n=\n\n0,\nP H\n\n=\n?\n\n0\n(q\n\n1\n),\n\nq 1\n?\n\nli\nne\n\nar U\nH\n=\n\n?\n0 (q\n\n1 ),\nq\n\n1\n?\n\nlinear,\nP\n\nH\n=\n\n0\n\nUH ? constant, PH = 0\n\nSource: Elaborated by the author.\n\nFigure 3 \u2013 Pressure and flux basis functions of local indices 1,6,11 and 16 corresponding to subdomain\n?7 when using as interface spaces UH,1 and PH,1. The velocity field arrows are drawn without\nany scale applied to them in order to simply illustrate the trend of the flow field. The maximum\n(red) and minimum (blue) values of the ?\u2019s and vector magnitude of the ?\u2019s are also indicated.\n\n2.3.2 Problem with a manufactured solution - Convergence assess-\nment\n\nThe second problem we consider corresponds to taking as computational domain the unit\nsquare, the following manufactured solution for the pressure\n\np = cos(2? x1) cos(2? x2) (2.67)\n\n\n\n2.3. Numerical experiments 53\n\nL\n2 (\n\n?\n)\n\nno\nrm\n\n10?10\n\n10?8\n\n10?6\n\n10?4\n\n10?2\n\n10?6 10?4 10?2 100 102 104 106\n?\n\nUH,0, PH,0\n\n?p MHMh\n?\n\np MRCh ?\n\n?u MHMh\n?u MRCh ??u\n\nMM\nMF\n\nEM\n\nh\n\n?u\nMR\n\nC\n\nh\n?\n\n?p\nMM\n\nMF\nEM\n\nh\n\n?p\nMR\n\nC\n\nh\n?\n\nL\n2 (\n\n?\n)\n\nno\nrm\n\n10?10\n\n10?8\n\n10?6\n\n10?4\n\n10?2\n\n10?6 10?4 10?2 100 102 104 106\n?\n\nUH,1, PH,1\n\n?u MHMh\n?u MRCh ??u\n\nMM\nMF\n\nEM\n\nh\n\n?u\nMR\n\nC\n\nh\n?\n\n?p\nMM\n\nMF\nEM\n\nh\n\n?p\nMR\n\nC\n\nh\n?\n\n?p MHMh ?p MRCh ?\n\nSource: Elaborated by the author.\n\nFigure 4 \u2013 L2(?) norm of the difference between the MRCM solution and the MMMFEM and MHM\nsolutions as a function of the algorithmic parameter ? for the quarter of a 5-spot problem.\n\nand an uniform scalar permeability field K = 1, for which f = 8 ? 2 cos(2? x1) cos(2? x2) must\nbe given as the source term in (2.1)-(2.4). The solution satisfies homogeneous flux boundary\nconditions at all boundaries and has zero mean. From this problem we aim to assess the conver-\ngence properties of the MRCM method as the algorithmic parameter ? in Eq. (2.65) is increased.\nFirst, mesh refinement is performed such that the ratio H/h is maintained constant, this is, by\nincreasing the number of subdomains in each direction and simultaneously the number of fine\ngrid cells in the same proportion. This way, the number of fine mesh cells in each subdomain\nis maintained constant. The first mesh in the sequence consists of 3\u00d73 subdomains, each one\nsubdivided into a fine mesh consisting of 20\u00d720 elements, i.e., H = 1/3 and h = H/20. The rest\n\n\n\n54 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\nUH,0, PH,0 UH,1, PH,1\n\n? = 108\n\n(MHM\u2013like)\n\n? = 1\n\n? = 10?8\n\n(MMMFEM\u2013like)\n\nSource: Elaborated by the author.\n\nFigure 5 \u2013 Contours of pressure error and arrows of velocity error of the MRCM solution with respect to\nthe fine grid solution for different values of the Robin condition parameter ? of Eq. (2.65) and\ndifferent coarse interface spaces UH and PH in the quarter of a 5-spot problem.\n\nof the meshes in the sequence are obtained by successively halving H and h. We report the L2(?)\nerror norms for pressure and velocity denoted respectively by ?p? ph?L2(?) and ?u?uh?L2(?)\n\n\n\n2.3. Numerical experiments 55\n\nas functions of the partition characteristic size H. In the limiting cases, corresponding to ? ? 0\nand ? ? ?, we expect to recover respectively the convergence rates of the MMMFEM method\n(ARBOGAST et al., 2000; ARBOGAST et al., 2007) and those corresponding to the MHM\nmethod (HARDER; PAREDES; VALENTIN, 2013). These rates are summarized in table 1 for\nthe particular cases that interest us in this article. A few comments are in order regarding these\nconvergence rates: first, they assume that polynomial spaces are used on the mesh skeleton,\nalthough it is worth recalling that we are not using polynomials, but their projections onto F(Eh),\nas previously discussed. Second, for the MMMFEM formulation, the order H 2 for pressure\nis a superconvergence result obtained by a duality argument in (ARBOGAST et al., 2000)\nprecisely when the L2(?)\u2013norm is used to measure the errors, that is the natural norm in our\nimplementation. Finally, regarding the approximation properties of the local solvers, for the\nMMMFEM the estimates in (ARBOGAST et al., 2000) consider a mixed formulation and for\ninstance RTk spaces (here, k = 0), whereas for the MHM method, according to (HARDER;\nPAREDES; VALENTIN, 2013), the convergence properties of the scheme are assessed by using\nan elliptic solver at the local level with a one element submesh and polynomial interpolation of\ndegree `+ 1 (here, `?{0,1}).\n\nTable 1 \u2013 Expected convergence rates of the L2(?) norm of the error for the MMMFEM and MHM\nformulations when polynomial spaces of degree ` = 0 or 1 are used on the skeleton ?.\n\nPressure Flux\nMethod ` = 0 ` = 1 ` = 0 ` = 1\n\nMMMFEM (see (ARBOGAST et al., 2000)) - O(H 2) - O(H)\nMHM (see (HARDER; PAREDES; VALENTIN, 2013)) O(H 2) O(H 3) O(H) O(H 2)\n\nResults are displayed in Fig. 6 and 7 that show the error norms corresponding to different\ncombinations of the coarse interface spaces, namely, UH,`U \u2013PH,`P with `U and `P in {0,1}.\nLack of convergence is observed for the MMMFEM method for any combination of interface\nspaces where PH = PH,0. Conversely, the best results are obtained by taking moderate to\nlarge values of ? and any combination of interface spaces where PH = PH,1. In the limiting\ncase, that corresponds to taking ? = 10?8, the error exhibits the expected convergence rate\nof the MMMFEM method, i.e., O(H 2) for pressure and O(H) for flux. In the other limiting\ncase, that corresponds to taking ? = 108 the error exhibits the expected convergence rate of the\nMHM method, i.e., the error converges either with O(H 2) for pressure and O(H) for flux if\nthe velocity space is UH,0, whereas if the velocity space UH,1 is used, the convergence rate is\nO(H 3) for pressure and O(H 2) for flux. We see that for all combinations of spaces considered,\nthe error and convergences properties of the MRCM formulation improves as we increase the\nvalue of the Robin condition parameter, with one exception that corresponds to using UH,0 and\nPH,1 (see third column of Figs. 6 and 7), in which the method exhibits the same convergence\nrate irrespective of the value of ? taken. In this case, we also note the error does not change\nmonotonically with respect to ? and that for ? = 108 (MHM-like solution) it exhibits greater\n\n\n\n56 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\nerrors both for pressure and flux. Finally, for the choice of interface spaces UH,1 and PH,1 we\nobserve that for low to intermediate values of the Robin condition parameter (tipically, . 10 for\npressure and . 30 for flux) the convergence rate of the MRCM method never exceeds O(H 2)\nfor pressure and O(H) for flux, but it reaches the MHM rates rapidly as we further increase ?\nfrom those values, indeed coinciding with the values at which the MRCM begins to approach the\nMHM formulation linearly with respect to ? as observed in the first numerical experiment (see\nFig. 4).\n\n? ?\n\n? H 2\n\n0.001\n\n0.01\n\n0.1\n\n1\n\n0.01 0.1 1\nH\n\nUH,0, PH,0\n\n?\np\n?\n\np h\n? L\n\n2 (\n?\n)\n\n? ?\n\n? H 3\n\n10?5\n\n0.0001\n\n0.001\n\n0.01\n\n0.1\n\n1\n\n0.01 0.1 1\nH\n\nUH,1, PH,0\n\n? H 2\n\n0.0001\n\n0.001\n\n0.01\n\n0.1\n\n1\n\n0.01 0.1 1\nH\n\nUH,0, PH,1\n\n? H 3\n\n? ?? H 2\n\n0.0001\n\n0.001\n\n0.01\n\n0.1\n\n0.01 0.1 1\nH\n\nUH,1, PH,1\n\n10?5\n\nMMMFEM\u2013like MHM\u2013like\n\n? = 1\n? = 5\n\n? = 10\n\n? = 20\n? = 50\n\n? = 100\n\n? = 200\n? = 500\n\n? = 1100\n? = 108? = 10?8\n\nSource: Elaborated by the author.\n\nFigure 6 \u2013 L2(?) error norm of pressure ?p? ph?L2(?) as a function of the characteristic coarse inter-\nface mesh size H for the second numerical example maintaining the ratio H/h constant and\nconsidering different combinations of coarse interface spaces UH and PH . Solution norm:\n? p ?L2(?)= 1/2.\n\nThe previous refinement procedure brings insight on the convergence properties of the\nmethod as the number of subdomains is increased, but the size of the local problems is left\nunchanged. From a HPC perspective, these results becomes thus relevant if we are interested\nin weak scaling speedup. A different refinement approach, consists in keeping the global fine\ngrid partition Th fix and then increase the number of subdomains, such that the local problems\n\n\n\n2.3. Numerical experiments 57\n\n? ?\n\n? H\n\n0.1\n\n1\n\n10\n\n0.01 0.1 1\nH\n\nUH,0, PH,0\n?\n\nu\n?\n\nu h\n? L\n\n2 (\n?\n)\n\n? ?\n\n? H 2\n\n0.001\n\n0.01\n\n0.1\n\n1\n\n10\n\n0.01 0.1 1\nH\n\nUH,1, PH,0\n\n? H\n\n0.01\n\n0.1\n\n1\n\n10\n\n0.01 0.1 1\nH\n\nUH,0, PH,1\n\n? H\n\n? H 2\n\n? ?\n\n0.001\n\n0.01\n\n0.1\n\n1\n\n0.01 0.1 1\nH\n\nUH,1, PH,1\n\nMMMFEM\u2013like MHM\u2013like\n\n? = 1\n? = 5\n\n? = 10\n\n? = 20\n? = 50\n\n? = 100\n\n? = 200\n? = 500\n\n? = 1100\n? = 108? = 10?8\n\nSource: Elaborated by the author.\n\nFigure 7 \u2013 L2(?) error norm of flux ?u?uh?L2(?) as a function of the characteristic coarse interface mesh\nsize H for the second numerical example maintaining the ratio H/h constant and considering\ndifferent combinations of interface spaces UH and PH . Solution norm: ? u ?L2(?)=\n\n?\n2 ? .\n\nbecome smaller at each refinement step. This may be relevant if we are interested in strong\nscaling speedup. To illustrate the convergence properties in this case, Fig. 8 shows the L2(?)\nnorm of the errors for pressure and flux using UH,1 and PH,1 as interface spaces. In contrast\nto the previous refinement study, now we observe a smoother increase of the convergence rate\ntowards the MHM estimates, both for pressure and flux as we move to larger values of ? .\nInterestingly, the MRCM asymptotically exhibits a significantly larger convergence rate and\nsimilar error for pressure (? H 2.72) for the intermediate value ? = 5 as compared to the case\nwith ? = 108 (MHM\u2013like), whose convergence rate deteriorates to something lower than O(H).\n\nAs a final convergence experiment, consider a fixed domain decomposition of ? con-\nsisting of 4\u00d74 subdomains (i.e., H = 1/4) and take as coarse interface spaces for flux and\npressure UH,` and PH,` with ` = 0,1,...,6. For this experiment we adopt the value ? = 100 and\nreport results for different fine grid discretizations, namely h = H/20, h = H/40 and h = H/80.\nFigure 9 shows the L2(?) error norms of pressure and flux. Consider for example the curves\ncorresponding to h = H/20. The pressure error decreases as ` is increased from 0 to 2 and\nthen becomes essentially constant for ` > 2. A similar behavior is observed for the flux error\nfor ` > 3. This means that taking ` = 3 (6 unknowns per interface ?i, j, 3 for UH and 3 for PH )\none gets results with the same accuracy as that of the fine grid solution. Considering that the\nfine grid solution involves 20 unknowns per interface (using Mortar or Mortar Mixed domain\ndecomposition) the reduction in dimensionality is evident. For the case h = H/80 the reduction\nis even larger, since taking ` = 5 (10 unknowns per interface) yields the same accuracy as that\nobtained with the 80 unknowns per interface of the fine grid.\n\n\n\n58 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\n? ?\n\n? H 3.22\n? H 2.37\n\n? H 2.13\n\n? H 2.72 ? H 0.86\n\n0.0001\n\n0.001\n\n0.01\n\n0.1\n\n0.01 0.1 1\n\n?p\n?\n\np h\n? L\n\n2 (\n?\n)\n\nH\n\n? H 1.97\n\n? H 1.51\n\n? ?\n\n? H 1.21\n\n? H 0.97\n\n0.001\n\n0.01\n\n0.1\n\n1\n\n0.01 0.1 1\n\n?u\n?\n\nu h\n? L\n\n2 (\n?\n)\n\nH\n\nMHM\u2013likeMMMFEM\u2013like ? = 50\n\n? = 10?8 ? = 108\n? = 1\n? = 5\n\nSource: Elaborated by the author.\n\nFigure 8 \u2013 L2(?) error norms of pressure and flux as a function of the characteristic coarse interface mesh\nsize H for the second numerical example with fine grid size h maintained constant and using\nUH,1 and PH,1 as interface spaces. Solution norm: ? p ?L2(?)= 1/2, ? u ?L2(?)=\n\n?\n2 ? .\n\n2.3.3 The importance of the Robin condition parameter\n\nNext we focus on two aspects of the MRCM. Through numerical experiments we will\nshow that for a range of values of the Robin condition parameter the MRCM provides better\napproximations for pressure and velocity than those computed with the MRCM with extreme\nvalues of the Robin condition parameter. These extreme values produce numerical solutions close\nthe the ones produced by the MMMFEM and MHM. Moreover, we perform a comprehensive\nnumber of tests aiming in illustrating the accuracy and robustness of the generalized MRCM\nformulation.\n\nIn the study reported here we use the permeability field provided by the SPE10 project\n(http://www.spe.org/web/csp), that is commonly employed to test subsurface codes. Released\nby the Society of Petroleum Engineers (SPE), it has become a recurrent benchmark in this field\n(CHRISTIE; BLUNT, 2001; FRANCISCO et al., 2014). The original data contains 220\u00d760\u00d785\ncells and its physical dimensions are 2200\u00d71200\u00d7170 (ft). In our experiments the permeability\ncontrast is Kmax/Kmin ? 107. For the purpose of our simulations and further investigations about\nthe choice of the Robin condition parameter, 2D computations are performed in selected slices in\nthe z direction. It is worth noting that most of the selected slices contains channelized structures\nthat are particularly challenging for current multiscale methods. Moreover, if not stated otherwise,\nresults were computed using linear spaces PH,1 and UH,1 for the underlying interface problems.\n\n\n\n2.3. Numerical experiments 59\n\n10?5\n\n0.0001\n\n0.001\n\n0.01\n\n0.1\n\n1\n\n0 1 2 3 4 5 6\n\n?p\n?\n\np h\n? L\n\n2 (\n?\n)\n\n`\n\n10?5\n\n0.0001\n\n0.001\n\n0.01\n\n0.1\n\n1\n\n10\n\n0 1 2 3 4 5 6\n\n?u\n?\n\nu h\n? L\n\n2 (\n?\n)\n\n`\n\nh = H40h =\nH\n20 h =\n\nH\n80\n\nSource: Elaborated by the author.\n\nFigure 9 \u2013 L2(?) error norms of pressure and flux as a function of the polynomial order of the discrete\ninterface spaces UH and PH . Solution norm: ? p ?L2(?)= 1/2, ? u ?L2(?)=\n\n?\n2 ? .\n\nFor all slices, the computational domain is set to be a rectangle ? = [0,11/3]\u00d7 [0,1],\nand boundary conditions are no-flow at the top and bottom boundaries (y = 0 and y = 1), along\nwith an imposed flux on the left (x = 0) and right (x = 11/3) boundaries.\n\nAs previously stated, the Robin condition parameter ?i appearing in the variational for-\nmulation (2.17)-(2.20), is computed as in Eq. (2.65), i.e. ?i = ? h/K, where ? is a dimensionless\nparameter and K is the permeability field, that can be calculated on the interfaces ?i, j ? ? in\ndifferent ways. Although an optimal choice for the computation of this parameter demands a\nmore thorough investigation, we consider here four simple choices for the evaluation of the per-\nmeability field aiming at showing the robustness and flexibility of our formulation. We consider\nthe following options:\n\n1. Discontinuous: The most obvious choice, since permeability fields are discontinuous\nalong the grid edges/facets, is to compute\n\n?`(x) =\n? h\n\nK`(x)\n, `?{i, j}, x ? ?i, j (2.68)\n\nso that ? is constant by parts and different on each side of ?i, j (an illustration is provided\nin the insert of figure 1).\n\n2. Harmonic: Another approach is to take the same value on both sides of ?i, j as the\n\n\n\n60 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\nharmonic average of permeability values, i.e.\n\n?`(x) =\n? h\nK\n\n, K =\n2Ki(x)K j(x)\n\nKi(x)+ K j(x)\n, `?{i, j}, x ? ?i, j . (2.69)\n\n3. One-sided: Consists in setting ? to zero in one side of ?i, j, and the other side dependent\non a given parameter ? . Thus\n\n?`(x) =\n\n???\n??\n\n0, if K`(x) &lt;max\n{\n\nKi(x),K j(x)\n}\n\n? h\nK`(x)\n\n, otherwise.\n(2.70)\n\nwith `?{i, j} and x ? ?i, j.\n\n4. Extreme: Consists in setting the Robin condition parameter ? as the extreme values (0 or\n?) in each side of the interface, such as\n\n?`(x) =\n\n??\n? 0, if K`(x) &lt;max\n\n{\nKi(x),K j(x)\n\n}\n?, otherwise.\n\n(2.71)\n\nwith `?{i, j} and x ? ?i, j.\n\nWe performed a series of numerical studies for a number of different slices, using the\nDiscontinuous Robin condition parameter (Eq. (2.68)), varying the parameter ? from 10?6\n\n(where the MRCM behaves like the MMMFEM) to 106 (where the MRCM behaves like the\nMHM). For these studies, the domain is decomposed in 11\u00d73 sub-domains of size H = 1/3,\neach containing 20\u00d720 cells, so that h = 1/60. The L2(?) errors are computed based on a\nreference fine grid solution of 220\u00d760 grid cells. Figure 10 shows the behavior of the errors\nfor pressure (top) and fluxes (bottom), alongside the (log-scaled) permeability field for a set of\nslices of the SPE10 model.\n\nThe first eye-catching conclusion that can be drawn from these results is that there is a\nrange of alpha (? ? [1,100]) values in which the errors for pressure and fluxes attain a minimum\nvalue. These errors are smaller than the errors of the MMMFEM-like and the MHM-like results,\nfor all slices, using the standard discontinuous computation of ? .\n\nWe have chosen slice number 36 to perform additional tests, in order to assess how the\nerrors are affected by the choice of the Robin condition parameter and on the way the domain\ndecomposition is performed. Figure 11 shows the error profiles obtained in this slice, for different\ncomputations of the Robin condition parameter. The results show that for the Discontinuous\nand Harmonic approaches we observe a similar behavior of the errors as we move from small\nvalues of ? (MMMFEM-like solutions) to large values of this parameter (MHM-like solutions),\nwith a small flux error improvement in the Harmonic approach for small values of ? . For the\nOne-sided and Extreme cases, distinct behaviors are observed, with no real improvement over\n\n\n\n2.3. Numerical experiments 61\n\nMHM-likeMMMFEM-like\n\nMHM-likeMMMFEM-like\n\n6\n27\n\n33\n\n36\n37,\n\n40\n\n44\n\n48\n42\n\n47\n\n6,\n\n27\n33,\n36\n\n37\n\n40\n\n44\n\n48\n42\n47\n\n6\n\n27\n\n33\n\n36\n\n37\n\n40\n\n44\n\n48\n\n42\n\n47\n\n?2.6 4.3log10(K)\n\n?\n\n10?1\n\n100\n\n10?6 10?4 10?2 100 102 104 106?\npM\n\nR\nC\n\nh\n?\n\npF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)/\n?p\n\nF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)\n\n10?2\n\n?\n\n100\n\n10?6 10?4 10?2 100 102 104 106?u\nM\n\nR\nC\n\nh\n?\n\nuF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)/\n?u\n\nF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)\n\n10?1\n\nSource: Elaborated by the author.\n\nFigure 10 \u2013 Relative L2(?) errors for pressures (top) and fluxes (bottom), computed using the fine grid\nsolution of SPE10 as a reference. Each curve shows the results of a different slice, depicted in\nthe right-hand side. Note that the errors associated with the MRCM for intermediate values of\n? are considerably smaller than those associated with the MMMFEM and MHM.\n\nprevious choices. In the One-sided case, the minimum pressure error happens for a different\n? value, as compared to the ? value leading to a minimum in the flux error. For the Extreme\ncase, the error sensitivity to the variation of ? parameter is less pronounced, with no significant\nerror improvement. Nonetheless, these two cases illustrate the robustness of our formulation: the\nRobin condition parameters may be set in an arbitrary manner, with acceptable results produced\nby the MRCM formulation.\n\nAnother factor affecting the error profiles is the number of subdomains used to decompose\nthe whole domain. The error profiles for different domain decompositions can be seen in figure\n12, where pressure and flux erros for the 36th slice of SPE10 are shown. We consider subdivisions\nwith 11\u00d73 subdomains, yielding H = 1/3 and 20\u00d720 fine grid cells inside each subdomain,\n22\u00d76 subdomains, with H = 1/6 and 10\u00d710 fine grid cells per subdomain, and finally 44\u00d712\n\n\n\n62 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\n?\n\n10?2\n\n10?1\n\nDiscontinuous\n100\n\n10?6\n\nOne-sided\n\n10?4 10?2\n\nExtreme\n\n100 102 104 106\n\n?p\nM\n\nR\nC\n\nh\n?\n\npF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)/\n?p\n\nF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)\n\nHarmonic\n\n?\n\n0.2\n\n0.3\nDiscontinuous\n\n0.4\n\n0.5\n\nOne-sided\n\n0.6\n\n0.7\n\nExtreme\n\n0.8\n\n10?6 10?4 10?2 100 102 104 106\n\n?u\nM\n\nR\nC\n\nh\n?\n\nuF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)/\n?u\n\nF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)\n\nHarmonic\n\nSource: Elaborated by the author.\n\nFigure 11 \u2013 Relative pressure and flux error profiles for slice 36 as a function of ? parameter, for different\ncomputations of the Robin condition parameter.\n\nsubdomains, with H = 1/12 and subdomains containing only 5\u00d75 fine grid cells. The simulations\nwere performed using the discontinuous computation of the Robin condition parameter. While\nthe main trend is preserved throughout all simulated cases, one can easily see that the minimum\nfor both pressure and flux is shifted towards the position ? = 1 by increasing the number of\nsubdomains.\n\nFollowing the ideas in (FRANCISCO et al., 2014), we also test the introduction of\nan intermediate length scale H such that h &lt;H &lt;H. While H still refers to the size of the\nsubdomains, H is the size of a subdivision of each interface ?i, j and defines a new partition TH\nof ?. The piecewise polynomial spaces on TH are denoted by PH,k and UH,k. Notice that ?\ndoes not depend on H, so that PH,k is a refinement of PH,k and UH,k is a refinement of UH,k.\n\n\n\n2.3. Numerical experiments 63\n\n?p\nM\n\nR\nC\n\nh\n?\n\npF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)/\n?p\n\nF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)\n\n?\n\n10?3\n\nH = 1/610?2\n\n10?1\n\nH = 1/12\n\n100\n\n10?6\n\nH = 1/3,H = 1/12\n\n10?4 10?2\nH = 1/6,H = 1/12\n\n100 102 104 106\n\nH = 1/3\n\n?\n\n0\n\n0.1\n\nH = 1/60.2\n\n0.3\n\nH = 1/12\n\n0.4\n\n0.5\n\nH = 1/3,H = 1/12\n\n0.6\n\n0.7\n\nH = 1/6,H = 1/12\n\n0.8\n\n10?6 10?4 10?2 100 102 104 106\n\n?u\nM\n\nR\nC\n\nh\n?\n\nuF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)/\n?u\n\nF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)\n\nH = 1/3\n\nSource: Elaborated by the author.\n\nFigure 12 \u2013 Relative pressure and flux error profiles for slice 36 as a function of ? parameter, for different\nnumber of subdomains.\n\nResults of two additional simulations with interface spaces PH,1 and UH,1 can be seen\nin figure 12 (in dashed lines). One is computed by setting H = 1/3 and H = 5h = H/4 while the\nother is computed with H = 1/6 and H = 5h = H/2. We remark on two of the main advantages\nresulting from the introduction of the intermediate length scale H. First, pressure and flux errors\nare somewhat smaller as compared to the results obtained with the linear spaces PH,1 and VH,1.\nSecond, and most importantly, the introduction of H scale alleviates the dependence of the\nminimum error location on the domain decomposition, as they are all near the value ? = 1.\n\nWe now focus on the results reported in figure 13, where one can see the error profiles for\npressure and flux, for the computations performed with permeability field given by the 36th slice\nof the SPE10 field. We show details of the error distribution as inserts in this figure. These inserts\n\n\n\n64 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\n0.8\n\n1\n\n10?6 10?4 10?2 100 102 104 106\n?\n\n0\n\n0.2\n\n0.4\n\n0.6\nMMMFEM\n\nMRC ? = 18\n\n?u\nM\n\nR\nC\n\nh\n?\n\nuF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)/\n?u\n\nF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)\n\nMHM\n1.0\n\n0.8\n\n0.5\n\n0.2\n\n0\n\n?p\nM\n\nR\nC\n\nh\n?\n\npF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)/\n?p\n\nF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)\n\nMHM\nMMMFEM\n\nMRC ? = 18\n\n101\n\n102\n\n10?6 10?4 10?2 100 102 104 106\n?\n\n10?3\n\n10?2\n\n10?1\n\n100\n\n2.5\n\n1.9\n\n1.2\n\n0.6\n\n0\n\nSource: Elaborated by the author.\n\nFigure 13 \u2013 Relative pressure and flux error profiles for slice 36 as a function of ? parameter. The inserts\nshow the permeability field and the subdomains colored by the local norm L2(?i) for each\nsubdomain ?i.\n\n\n\n2.4. Concluding remarks 65\n\nshow the domain decomposition used (corresponding to H = 1/3) and the permeability field\nsuperimposed by the local errors, i.e., errors computed inside each domain ?i using a L2(?i)\nnorm. We display the local errors for the MMMFEM and MHM methods, as well as the MRCM\nwith a choice for ? that minimizes the flux errors. For this selected slice of SPE10 and the chosen\nsubdomain division (H = 1/3), the minimum flux happens around ? = 18, while the minimum\npressure error is attained around ? = 6. Once in porous media flows minimizing flux errors is\ntypically preferred over minimizing pressure errors, we show only detailed results for ? = 18.\nThese results bring some insights about the error distribution in each method. Pressure errors are\nwell-behaved, and small errors are obtained in all subdomains, for both MMMFEM and MRCM\nwith small values of ? . Large pressure errors are obtained for large ? , including the result from\nthe MHM method, with increasing pressure errors towards the fluid production (right) boundary.\nFlux errors are more insightful. One can easily see that for all methods, errors are concentrated\naround the channelized structures of the permeability field, with larger values attained for the\nMMMFEM and MHM methods. The choice ? = 18 brings the local flux errors down by a factor\nof at least 2, especially in the vicinity of the channelized structures.\n\nWe close this section with a study of the error for pressure and fluxes that result from\ndistinct contrasts Kmax/Kmin in the permeability field of slice number 36. We set this ratio from\n105 until 109. The results displayed in figure 14 indicate robustness of the MRCM also in terms\nof this ratio. The errors for flux show only mild dependence on it, even for very heterogeneous\nformations.\n\n2.4 Concluding remarks\n\nWe have introduced a new multiscale mixed finite element method, the Multiscale Robin\nCoupled method (MRCM), aiming at the accurate approximation of subsurface flows. The new\nmethod is based on a domain-decomposition procedure in which the subdomains are coupled\nby the Robin boundary condition. There appear two independent spaces on the skeleton of the\ndecomposition, corresponding to interface pressures and fluxes, that can be chosen with great\nflexibility to accommodate local features of the underlying permeability fields. Initially the\nwell-posedness of the proposed domain decomposition procedure is established and it is shown\nthat it generalizes an existing domain decomposition procedure based on the Robin boundary\ncondition. In fact, it allows one to interpret the existing procedure as a Two-Lagrange-Multiplier\nmethod. The multiscale property of the proposed domain decomposition method is discussed\nand its relation with existing multiscale mixed methods is pointed out.\n\nNumerical experiments are presented and discussed. Initially we compare the numerical\nsolutions of the MRCM to existing ones. We show that as the parameter in the Robin condition\nof our method is set to extreme values we recover results from two known methods (MMMFEM\nand MHM) as well as their convergence rates. Then we focus on the simulation of realistic flow\n\n\n\n66 Chapter 2. The Multiscale Robin Coupled Method for flows in porous media\n\nKmax/Kmin\n\nKmax/Kmin\n\n102 104 106\n\n106\n\n?p\nM\n\nR\nC\n\nh\n?\n\npF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)/\n?p\n\nF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)\n\n?\n\n107\n\n10?2\n\n10?1\n\n108\n\n100\n\n10?6\n109\n\n10?4 10?2 100\n\n105\n\n?\n\n0\n\n0.1\n\n1060.2\n\n0.3\n\n107\n\n0.4\n\n0.5\n\n108\n\n0.6\n\n0.7\n\n109\n\n0.8\n\n10?6 10?4 10?2 100 102 104 106\n\n?u\nM\n\nR\nC\n\nh\n?\n\nuF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)/\n?u\n\nF\nin\n\ne\nh\n? L\n\n2\n(?\n\n)\n\n105\n\nSource: Elaborated by the author.\n\nFigure 14 \u2013 Relative pressure and flux error profiles for slice 36 as a function of ? parameter, or different\npermeability contrast Kmax/Kmin.\n\n\n\n2.4. Concluding remarks 67\n\nin high-contrast channelized porous formations by considering several layers of the classical\nSPE10 permeability field. Two aspects of the MRCM are considered. First we show that for a\nrange of values of the Robin condition parameter our method provides better approximations for\npressure and velocity than those computed with the new procedure with extreme values of the\nRobin condition parameter. This is an indication that our method has the potential to produce\nmore accurate velocity fields in the presence of rough, realistic permeability fields of petroleum\nreservoirs. Moreover, by selecting different expressions for the calculation of the Robin condition\nparameter, we indicate the robustness of the MRCM formulation.\n\n\n\n\n\n69\n\nCHAPTER\n\n3\nINFORMED SPACES FOR THE MULTISCALE\nROBIN COUPLED METHOD IN RESERVOIR\n\nSIMULATION\n\nThe Multiscale Robin Coupled Method (MRCM) is a recent multiscale numerical method\nbased on a non-overlapping domain decomposition procedure. One of its hallmarks is that the\nMRCM allows for the independent definition of interface spaces for pressure and flux over the\nskeleton of the decomposition. The accuracy of the MRCM depends on the choice of these\ninterface spaces, as well as on an algorithmic parameter ? in the Robin interface conditions\nimposed at the subdomain boundaries. This work presents an extensive numerical assessment\nof the MRCM in both of these aspects. Two types of interface spaces are implemented: usual\npiecewise polynomial spaces and informed spaces, the latter obtained from sets of snapshots by\ndimensionality reduction. Different distributions of the unknowns between pressure and flux are\nexplored. Two non- dimensionalizations of ? are tested. The assessment is conducted on realistic,\nhigh contrast, channelized permeability fields from a SPE benchmark database. The results\nshow that ? , suitably non-dimensionalized, can be fixed to unity to avoid any indeterminacy\nin the method. Further, with both types of spaces it is observed that a balanced distribution\nof the interface unknowns between pressure and flux renders the MRCM quite attractive both\nin accuracy and in computational cost, competitive with other multiscale methods from the\nliterature.\n\n3.1 Introduction\n\nMultiscale domain decomposition methods have received considerable attention from\nthe scientific community due to their potential to solve efficiently elliptic problems with rapidly\nvarying coefficients in parallel multi-core computers. This class of methods approximates the\nexact solution by solving uncoupled local problems on non-overlapping subdomains, along with\n\n\n\n70 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\none global problem (or interface problem) associated with the coupling between subdomains\nthrough their boundaries. In fact, consistency conditions require the imposition of some form\nof continuity of fluxes and of pressures at interfaces between neighbor subdomains. Different\nmethods have been developed based on distinct approaches to address the continuity issue.\nWe mention, for instance, the Multiscale Mortar Mixed Finite Element Method (MMMFEM)\n(ARBOGAST et al., 2007) and the Multiscale Hybrid-Mixed Method (MHM) (ARAYA et al.,\n2013; HARDER; PAREDES; VALENTIN, 2015), as some well known procedures of this type.\nIn the MMMFEM, the pressure continuity is weakly satisfied in the fine-grid scale (the scale of\nthe local grid of each subdomain, usually denoted by h), while normal flux continuity is ensured\nin a much larger scale (H ? h), usually associated with the size of the subdomains. Conversely\nin the MHM, continuity of the normal fluxes is satisfied at the fine-grid h scale, while pressure\ncontinuity is only imposed at the larger H scale.\n\nThe design of accurate multiscale domain decomposition methods for channelized, high-\ncontrast porous media, remains as an important challenge because in typical problems posed by\nthe oil industry existing multiscale methods may produce inaccurate numerical approximations\n(GUIRALDELLO et al., 2018b).\n\nIn our search for more accurate procedures, here we investigate an improved version\nof the recently proposed Multiscale Robin Coupled method (MRCM) (GUIRALDELLO et al.,\n2018b). This method is based on the domain decomposition of Douglas et al. (DOUGLAS et al.,\n1993) and on the Multiscale Mixed Method (MuMM) of Francisco et al. (FRANCISCO et al.,\n2014), and ensures weak continuity of both normal fluxes and pressures through the imposition\nof Robin-type boundary conditions, namely\n\n??iui \u00b7n?i + pi = ? ju j \u00b7n? j + p j, (3.1)\n\nat the interface ?i j between subdomains (identified by i and j), usually in a scale that is larger\nthan the fine-grid scale. In Eq. (3.1) pi and ui are pressure and velocity of subdomain i at the\ninterface, and n?i =?n? j is the outwards unit normal. The MRCM can be seen as a generalization\nof the above mentioned methods depending on the parameter ?i: the MMMFEM (respectively,\nthe MHM) is recovered as ?i ? 0 (respectively, ?i ?+?) for all i.\n\nThe accuracy and cost of multiscale domain decomposition methods are mainly deter-\nmined by the choice of the interface space, i.e., the space on which the global problem is posed.\nThis space consists of functions defined on the collection of interfaces between subdomains, or\nskeleton of the partition, ? =?i ?= j?i j, where ?i j denotes the interface between nearest-neighbor\nsubdomains. For the MMMFEM the interface space is a pressure space PH , while for the MHM\nit is a flux space UH . A salient feature of the MRCM, with ?i different from 0 and +?, is that\nits global interface problem is posed on the direct product PH \u00d7UH of a pressure space and a\nflux space, both defined on the skeleton and which can be chosen independently. This allows\nus to explore an interesting question: Assume that one decides to allocate k unknowns at each\n\n\n\n3.1. Introduction 71\n\ninterface ?i j of the skeleton. How does their distribution between pressure unknowns and flux\nunknowns affect the accuracy and cost-effectiveness of the method?\n\nOf course the approximation capabilities of the interface space depends not just on its\ndimension (i.e., number of unknowns) but also on the functions it consists of. The first reported\nimplementations of MMMFEM, MHM and MRCM adopted piecewise polynomial spaces over\nthe interfaces, which are the simplest to code and analyze. It is however accepted nowadays that\npolynomial spaces are not optimal for highly heterogeneous problems, and different kinds of\nproblem-dependent approximation spaces (informed spaces, in short) have been proposed for\nmultiscale finite element (BABUSKA; OSBORN, 1983; CHUNG; EFENDIEV; HOU, 2016)\nand finite volume (JENNY; LEE; TCHELEPI, 2003) methods. The latter was extended to several\nnonlinear complex cases, including the compressible and compositional cases as well as fractures\n(LUNATI; JENNY, 2006; LEE; ZHOU; TCHELEPI, 2009; HAJIBEYGI; TCHELEPI, ; BOSMA\net al., 2017). The combination of informed spaces with the MMMFEM has recently been studied\nby Chung et al. (CHUNG; FU; YANG, 2016), while it remains unexplored for the MHM. In line\nwith this trend, this work explores a strategy for building informed spaces at the interfaces for\nthe MRCM. In this way, we explore the question of optimal allocation of unknowns between\npressure and flux not just with polynomials but also with spaces that are more suitable for highly\nheterogeneous media. Moreover, once the MHM is a particular case of the MRCM, a first study\nof combining the MHM with informed spaces is also produced.\n\nOur numerical results indicate that, typically, the optimal accuracy is attained somewhere\nin between the MMMFEM (all unknowns for pressure) and the MHM (all unknowns for flux). In\nother words, the solution of minimal error is produced by the MRCM for some specific choice\nof its algorithmic parameters. Further, it is shown that through appropriate dimensional analysis\nit is possible to fix all parameters of the MRCM automatically, resulting in a fully-determined\nmethod that is competitive with known ones. In particular, it is recommended that the number of\nunknowns for interface pressure is equal to (or slightly smaller than) the number of unknowns\nfor interface flux. In this way we arrive at a method that is effective for all layers in the SPE10\ndatabase. The construction of the informed spaces needs however to be improved, since the\nmethod exhibits comparable overall accuracy with polynomial and informed interface spaces.\nThere exist multiscale iterative methods, that include global information on the multiscale basis\nfunctions and show improvements in terms of accuracy (see e.g. (CHUNG; EFENDIEV; LEUNG,\n2018; HAJIBEYGI et al., 2008)). The development and dicussion of such procedures for the\nMRCM is out of the scope of this article and is left for future work. However, we remark that\ninformed interface spaces do show improved approximation of fluxes in regions of the domain\nwith high-contrast formations.\n\nThe plan of this article is as follows: The MRCM is briefly recalled in Section 2, adopting\na fine grid discretization consisting of lowest order Raviart-Thomas finite elements RT0 and\ngeneral spaces PH and UH at the skeleton ?. The reader should recall that the RT0 elements are\n\n\n\n72 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\nequivalent to the popular cell-centered finite volume method with two-point flux approximation.\nThe strategy adopted for building the interface spaces is described in Section 3. It is similar to\nstrategies proposed by other authors, such as the empirical interpolation technique used by Calo et\nal. (CALO et al., 2014; CALO et al., 2016) in the context of multiscale finite elements. With these\nelements at hand, Section 4 is then devoted to numerical experiments addressing the questions\nof selection of optimal algorithmic parameters and of optimal allocation of interface unknowns\nbetween pressures and fluxes. The geological data used in the experiments are two-dimensional\nslices of the SPE10 benchmark database, with different degrees of channelization.\n\n3.2 The Multiscale Robin Coupled Method\n\n3.2.1 Discrete variational formulation\n\nLet us consider a fine grid Th, i.e., a subdivision of the domain ? ? Rd consisting\nof d-dimensional cuboids of size h, and a decomposition of ? in subdomains {?i}i=1,...,m, of\ncharacteristic size H ? h, such that each element K ? Th belongs to one and only one of the\nsubdomains. Moreover, let ? be the skeleton of the domain decomposition, as the union of all\ninterfaces ?i, j = ?i ?? j. The discrete variational formulation of the MRCM is written over the\ndiscrete lowest order Raviart-Thomas spaces for velocity and pressure, defined as\n\nVih = {v ? H(div,?i) , v j(x)|K = p j1(x1)p j2(x2)... ,?K ? T\ni\n\nh ,\n\nwith p jk ? P1 if j = k , p jk ? P0 if j ?= k } , (3.2)\n\nVihy = {v ? V\ni\nh , v\u00b7n? = y on ? ?i ?? ?u} , (3.3)\n\nQih = {q ? L\n2(?i) , q(x)|K ? P0} , (3.4)\n\nwith y being a piecewise constant function defined on the edges of ? ?u and Pk the usual space\nof polynomials of degree up to k.\n\nWe denote by Eh the set of all edges/faces of Th in the skeleton ?. A unique normal n? is\ndefined as\n\nn?(e) .= exterior normal to ? ?min{i, j} , if e ? ?i, j (3.5)\n\nfor every e in Eh. The spaces for pressures and fluxes at subdomain interfaces that will be\nconsidered here consist of functions that are constant on each e of Eh, i.e., they are subsets of\n\nFh(Eh) ={ f : Eh ?R | f |e ? P0 , ?e ? Eh} . (3.6)\n\nTo finally state the variational formulation of the MRCM, consider low-dimensional\nsubspaces UH and PH of Fh(Eh). The MRCM consists in finding (uih, p\n\ni\nh) ? V\n\ni\nhz \u00d7Q\n\ni\nh, for\n\n\n\n3.2. The Multiscale Robin Coupled Method 73\n\ni = 1,...,m, and (UH,PH)? UH \u00d7PH such that(\nK?1uih,v\n\n)\n?i\n?\n(\n\npih,?\u00b7v\n)\n\n?i\n\n+\n(\nPH ??iUH n?i \u00b7n? + ?i uih \u00b7n?\n\ni,v\u00b7n?i\n)\n\n? ?i??\n=?\n\n(\ng,v\u00b7n?i\n\n)\n? ?i?? ?p\n\n(3.7)(\nq,? \u00b7uih\n\n)\n?i\n\n= ( f ,q)\n?i\n\n(3.8)\n\nm\n\n?\ni=1\n\n(\nuih \u00b7n?\n\ni,MH\n)\n\n? ?i??\n= 0 (3.9)\n\nm\n\n?\ni=1\n\n(\n?i (uih \u00b7n?\n\ni ?UH n?i \u00b7n?),VH n?i \u00b7n?\n)\n\n? ?i??\n= 0 (3.10)\n\nhold for all (v,q) ? Vih0 \u00d7Q\ni\nh , ?i = 1,...,m , for all MH ? PH and for all VH ? UH . Above,\n\nthe symbol (\u00b7,\u00b7)A denotes the scalar product of L2(A).\n\nThe existence and uniqueness of the solution of this variational formulation is proved in\n(GUIRALDELLO et al., 2018b). It only requires that\n\nm\n\n?\ni=1\n\n(?iVH,VH) > 0 , ?VH ? UH , VH ?= 0 . (3.11)\n\nThis condition is easy to check, since\n\nm\n\n?\ni=1\n\n(?iVH,VH) =\nm\n\n?\ni=1\n\n?\n? ?i??\n\n?iV\n2\nH =\n\n?\n?\n\n(\n?\n+ + ??\n\n)\nV 2H , (3.12)\n\nwhere the plus and minus superscript refer to the two sides of ?. If the functions ?i, assumed\nnon-negative, are not identically zero on both sides of ? and on the whole support of some VH ,\nthen the solution is unique. In the extreme case that all ?i\u2019s are identically zero, then UH must be\nzero for the problem to be well-posed. This reduces the formulation to the MMMFEM.\n\nRemark 4. Actually, the variational formulation also holds without the conditions PH ? Fh(Eh),\nUH ? Fh(Eh). The necessary and sufficient conditions are, in fact, (3.12) together with the same\ninf-sup compatibility of the MMMFEM, namely that for each nonzero MH ? PH there exists i\n(1 ? i ? m) such that\n\nsup\nv?Vih0\n\n(\nv\u00b7n?i,MH\n\n)\n? ?i??\n\n> 0 (3.13)\n\nFor the case of the RT0 velocity approximation, this is equivalent to\n\nsup\nAh?Fh(Eh)\n\n(Ah,MH)? > 0 ,\n\nwhich is automatically satisfied if PH ? Fh(Eh). Otherwise condition (3.13) must be checked\nindependently.\n\nThe implementation performed here strictly follows the one presented in (GUIRALDELLO\net al., 2018b), sharing similarities with the works of Ganis &amp; Yotov (GANIS; YOTOV, 2009)\n\n\n\n74 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\nand Francisco et al. (FRANCISCO et al., 2014). Note that the linear system associated with Eqs.\n(3.7)-(3.10) is of a size comparable to that of the original, undecomposed problem. However, the\nsolution to the problem written in terms of Eqs. (3.7)-(3.10) can be, locally, expressed in terms\nof linear combinations of multiscale basis functions. The construction of such basis functions is\nnaturally parallelizable.\n\nBy assuming that the interface variables (UH,PH) are known, one can uncouple Eqs. (3.7)-\n(3.8) from Eqs. (3.9)-(3.10). The first set of equations will produce local problems for the\ncomputation of the multiscale basis functions. The set of multiscale basis functions is then used\non Eqs. (3.9)-(3.10) to generate a global linear system to be solved for the interface variables,\ncoupling the local solutions while ensuring the compatibility conditions between subdomains.\nThe final solution is then obtained by linear combination of the previously computed multiscale\nbasis functions. The interested reader is referred to Guiraldello et al. (GUIRALDELLO et al.,\n2018b) for a thorough explanation of the implementation of this numerical scheme.\n\n3.3 Interface spaces: Polynomial and informed\nThe original implementation of the MRCM used piecewise polynomial spaces over the\n\nskeleton ? of the domain decomposition, both for pressure PH and flux UH . More precisely,\nwe have considered spaces made up of the elementwise constant fine grid representation of\npolynomials over the interface elements\n\nUH = U\npol,`U +1\n\nH ={VH, VH|e = ?0(q),q ?P`U (e), e ? TH}, (3.14)\n\nPH = P\npol,`P+1\nH ={MH, MH|e = ?0(q),q ?P`P(e), e ? TH}, (3.15)\n\nwhere Pk, k = `U or `P, is the space of polynomials of degree ? k and ?0 is the L2\u2013projection\nof a function of Pk(e) onto the space Fh(e), e ? TH . The superscript added to the symbol for\neach space contains the class of functions adopted (\u201cpol\u201d for polynomials, \u201cinf\u201d for informed)\nfollowed by the number of degrees of freedom on each edge of TH . Notice that UH and PH are\ndefined independently at each edge (face in 3D), with no continuity at corner points.\n\nOne alternative to polynomial spaces is, as previously mentioned, informed spaces,\nwhose construction is a two-step process: (i) construction of the so called snapshot space by\nsolving local problems on regions containing the interfaces ?i, j of the domain decomposition\n(i.e., oversampling) and considering some parameterisation (for example, on the boundary\nconditions of these local problems) and (ii) selection of the final informed space by applying\na dimensionality reduction technique (SVD, POD, etc.) to end up with a coarsened interface\nproblem of affordable size and whose solution appoximates well the fine grid solution.\n\nBy oversampling, we associate to each subdomain ?k a new region ?k that contains it.\nFigure 15 shows a few examples of the oversampling regions ?k for an interior subdomain and\nfor a subdomain that intersects the boundary of ?. This way, the ?k\u2019s clearly contain the whole\n\n\n\n3.3. Interface spaces: Polynomial and informed 75\n\n?\n\nTH(?)Th\n\n? ?\n\n?h(e)\n\nph\n\nh\n\nH\n\n?i, j\n\nI,J\n\n? j?i\n\nUe =?KI,J\n?h(e)? ph,I,J\n\nh/2\n\n?i ? j\n\n?i ? j\n\n?k\n\nSource: Elaborated by the author.\n\nFigure 15 \u2013 Computational domain decomposition and oversampling regions.\n\nof ? ?k ??. This decomposition essentially follows the original domain decomposition of ? by\nslightly augmenting the size of the local problems by just a few layers of fine grid cells that are\nnow shared by several processes. This is expected to be efficient in terms of message passing and\navoids dealing with more than one decomposition of ?. Although in the linear case this would\nnot be a serious drawback since this stage of the computation is done offline, in the non-linear\ncase periodic recomputation of the basis functions is needed and switching dynamically between\nvery distinct domain decompositions would lead to an undesirable computational burden.\n\nConsider interface ?i, j and corresponding subdomains ?k, k = i, j. Their boundaries\nare formed by a collection of fine grid faces em ? Th, m = 1,2,...,Nk. In order to build the\nsnapshot space for interface ?i, j we solve NK local Darcy problems on each oversampling region\n\n\n\n76 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\n?k (k = i, j), i.e.,\nuk,mh = ?K?p\n\nk,m\nh in ?k\n\n? \u00b7uk,mh = Ck,m in ?k\nB(uk,mh , p\n\nk,m\nh ) = ?m(x) on ? ?k\n\n(3.16)\n\nThe function ?m(x) takes the value 1 if x ? em and 0 otherwise. In (3.16), B is a boundary\noperator which enforces either pressure boundary conditions on ? ?k, i.e.,\n\nB(uk,mh , p\nk,m\nh ) = p\n\nk,m\nh (3.17)\n\nin which case the source term Ck,m is identically equal to zero, or flux boundary conditions on\n? ?k, i.e.,\n\nB(uk,mh , p\nk,m\nh ) = u\n\nk,m\nh \u00b7n?? ?k (3.18)\n\nand the source term Ck,m satifies the compatibility condition?\n?k\n\nCk,m =\n?\n\n? ?k\n\n?m . (3.19)\n\nAfter solving these problems, we retrieve the corresponding fluxes through the faces e ? ?i j as\n\nU k,me = u\nk,m\nh (e)\u00b7n?(e) . (3.20)\n\nWe also retrieve the corresponding pressure at ?i j, but since for the RT0 element the\npressure nodes are located at the center of the computational cells, face pressure values must be\nrecovered by using Darcy\u2019s law. This amounts to compute a face pressure at each fine grid cell\nthat intersects the boundary ?i, j. For instance, for an east boundary and fine grid cell I,J (see\nFigure 15), we obtain the face pressure ? k,mh (e) by solving\n\nU k,me =?KI,J\n?\n\nk,m\nh (e)? p\n\nk,m\nh,I,J\n\nh/2\n. (3.21)\n\nIn this way we end up, for each ?i, j, for each k = i or j, and for each m = 1,...,Nk, with\ntwo column arrays U? k,m and P?k,m, each of dimension Mi j (the number of fine grid faces in ?i, j),\nwhose components are U k,me and ?\n\nk,m\nh (e), respectively. We define new column arrays denoted by\n\nU k,m and Pk,m by substracting the constant component of U? k,m and P?k,m which are finally used\nto build the snapshot matrices\n\nA?i jU =\n[\nU i,1,...,U i,Ni, U j,1,...,U j,N j\n\n]\nA?i jP =\n\n[\nPi,1,...,Pi,Ni, P j,1,...,P j,N j\n\n]\nThe next step is to perform the SVD decomposition on the two matrices above. The SVD\n\ndecomposition of a given matrix A?Rm\u00d7n reads\n\nA = X?YT\n\n\n\n3.4. Numerical experiments 77\n\nwhere X ? Rm\u00d7m and Y ? Rn\u00d7n are orthogonal matrices and ? ? Rm\u00d7n is a diagonal matrix\ngiven by\n\n? = diag(?1,..,?q,0,..,0) (3.22)\n\nwhere ?1 ? ?2 ? ...? ?q > 0 are the singular values of the decomposition and q is the\nrank of matrix A. This procedure is executed on both A?i jU and A\n\n?i j\nP .\n\nFinally, the informed space U inf,kH (respectively, P\ninf,k\nH ) is defined locally on each ?i, j\n\nas the space of linear combinations of the first k?1 right singular vectors of A?i jU (respectively,\nA?i jP ) augmented with the constant function on the corresponding interface.\n\nTwo comments are in order for the procedure just described. First, the number of local\nproblems of type (3.16) to be solved can be reduced significantly by adopting a different strategy\nto parameterize the solution, for instance, by grouping together several fine grid faces on ? ?\non which some specified boundary conditions can be applied. Also randomly sampling these\nfine grid faces is a possibility (CALO et al., 2016). Second, in the proposed approach, the\nsolutions of the local problems are considered all equally probable prior to computing the SVD\ndecomposition. However, some strategy could be devised to discard solutions of small norm on\nthe interface. These topics will be the subject of future studies.\n\n3.4 Numerical experiments\n\nWe have performed a series of numerical experiments in a quarter of a 5-spot geometry\nin a rectangular 2D region with dimensions [0,11/3]\u00d7 [0,1]. We consider no-flow boundary\nconditions with an injection (production) well positioned at the top left (bottom right) corner\nof the computational region. For the absolute permeability we take distinct layers of the SPE10\nproject (http://www.spe.org/web/csp) (CHRISTIE; BLUNT, 2001). These are realistic, very\nheterogeneous fields typical of petroleum reservoirs.\n\nThe interface spaces are either polynomials or informed spaces obtained with oversam-\npling of size h. We consider the flux boundary operator given by Eq. (3.18) and the average\npressure is set to zero. The results are given in the form of graphs that display the relative\nL2(?) error norm (computed with respect to the fine grid solution) for the pressure and flux\nvariables. We first investigate the adequate characteristic length scale for the adimensionalization\nof the numerial parameter ? , and then explore the accuracy of the MRCM compared with the\nMMMFEM and the MHM with same number of interface unknowns. Finally, we perform an\nexhaustive comparison study covering all the SPE10 layers.\n\n\n\n78 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\n3.4.1 The characteristic length scale\n\nDimensional analysis indicates that the Robin coefficient of subdomain i can be written\nin terms of a dimensionless ? as\n\n?i (x) =\n? (x)L\nK (x)\n\n.\n\nIn (GUIRALDELLO et al., 2018b), we set L = h, h being the mesh size. Here we show that a\nbetter choice is L = H, where H is the size of ?i j = ? ?i ?? ? j. To see this we fix the decom-\nposition of the computational region and perform a mesh refinement study inside subdomains.\nAlthough ? could in general depend on x, we adopt a fixed value for it that holds for all x and\nall i. For the choice L = H the value of ? for which the MRCM yields minimum error remains\nessentially unaltered under the refinement study. In order to illustrate our findings, we consider\nlayer 36 (that contains a high contrast channel) divided into 22\u00d76 rectangular subdomains with\nsize H \u00d7H, being H = 1/6. For this domain decomposition we consider a sequence of mesh\nrefinements inside each subdomain starting with 10\u00d710 (mesh size h = H/10) and increase\neach direction by a factor of 2 until we reach h = H/80. For the interface spaces we consider\nhere polynomials of degree one, i.e., UH = U\n\npol,2\nH and PH = P\n\npol,2\nH .\n\nAs can be seen in Fig. 16, where we report the errors against the parameter ? , if one sets\nL = h (solid lines) the optimal value for ? increases for both pressure and fluxes as the mesh is\nrefined. On the other hand, if one sets L = H (dashed lines) the value of ? for which the error\nis minimal turns out to be quite independent of h, with ? ? 0.3 to minimize pressure error and\n? ? 1 to minimize flux error. This suggests that one could simply assign a fixed value to ? .\n\nTo further confirm this, we solve the same problem with another decomposition given\nby 11\u00d73 subdomains (H = 1/3) and a fixed mesh of 20\u00d720 elements per subdomain (i.e.,\nh = H/20). Further, we consider several permeability fields taken from different layers of the\nSPE10 data. As before, the interface spaces are U pol,2H and P\n\npol,2\nH (piecewise linear polynomials).\n\nIn Fig. 17 we illustrate the relative errors for pressure and flux as functions of ? . Note that the\nminimum error remains close to ? = 1, especially for the flux error, in all cases.\n\nGiven the results reported above, from now on we adopt L = H in the definition of the\nRobin parameter.\n\n3.4.2 Comparison of multiscale mixed methods\n\nHere we focus on numerical solutions computed with the MRCM, in comparison to those\nprovided by the MMMFEM and the MHM. Through numerical simulations we have shown (see\n(GUIRALDELLO et al., 2018b)) that as ? ?+0 the flux interface space UH becomes irrelevant\nand the MRCM produces results that tend to those of the MMMFEM with the interface space\nPH . On the other hand, as ? ?+?, PH becomes irrelevant and the MRCM produces results\nthat tend to those computed with the MHM with the interface space UH . In conclusion, one can\nview the MRCM as a generalization of the two other known procedures.\n\n\n\n3.4. Numerical experiments 79\n\nSource: Elaborated by the author.\n\nh = H/10, H/20, H/40, H/80.\n\nFigure 16 \u2013 Effect on ? position for L = h (solid lines) and L = H (dashed lines) for a sequence of fine\nmesh refinement.\n\nThe comparison among the three methodologies will be conducted as follows: For each\nnumerical study we fix a number k of degrees of freedom (dof \u2019s) per interface ?i, j to be employed\nin solutions computed with all methods. For the MMMFEM we set PH = P\n\npol,k\nH in the case of\n\npiecewise polynomial spaces, and PH = P\ninf,k\nH in the case of informed spaces. Similarly, for the\n\nMHM we set UH equal to either U\npol,k\n\nH or U\ninf,k\n\nH . For the MRCM we take the interface spaces\nto be P pol,kPH (or P\n\ninf,kP\nH in the informed case) and U\n\npol,kU\nH (or U\n\ninf,kU\nH ), with kU + kP = k.\n\nInitially we set k = 5 dof \u2019s per interface and take some representative layers of the\nSPE10 database. We select layer 33 that does not exhibit a strong channelized structure, layer 36\nwith one well defined channel, and layers 42 and 45 with an intricate channel structure. In our\nstudies we set Kmax/Kmin ? 106. In Figs. 18 and 19 we display the relative L2(?) error norms for\npressure and flux variables, respectively, as functions of ? . When comparing the MRCM pressure\nwith that of the MMMFEM (left dots) and that of the MHM (right dots) it is clear that one can\nalways find a combination of (kP,kU ) and ? such that the MRCM produces a more accurate\nresult than MMMFEM and MHM for both polynomial (solid lines) and informed (dashed lines)\ninterface spaces. This observation is valid except for layer 45, for which the MMMFEM solution\nfor the polynomial space is superior. This conclusion remains the same when comparing the\nflux errors. Exceptions to this finding occur on layers 33 and 42, for which the MHM produces\nthe most accurate results for the case of informed spaces. In order to exhibit the quality of the\n\n\n\n80 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\nSource: Elaborated by the author.\n\nFigure 17 \u2013 Relative pressure errors (top) and relative flux errors (bottom) for a collection of SPE10 layers\nwith L = H.\n\nsolution, Figs. 20 and 21 display the pressure solution and the streamlines for the best global ?\ncompared to the fine solution for layer 36 for the polynomial case. In Figs. 22 and 23 we illustrate\nthe relative L2(?) error norms for pressure and flux variables, respectively, as a function of ? for\nthe case of k = 4 with layers 30, 63, 67 and 75, which were selected using the same criterion as\nadopted above, although none of the fields with channelized structure (layers ? 63) present one\nwell-defined channel as in layer 36. In the numerical studies just discussed, that focus on global\nerrors, we have shown that one can often find a combination of kP, kU and ? for the MRCM that\nproduces a better numerical solution than that provided by MMMFEM and MHM.\n\nNext, we investigate how the error is distributed aiming at assessing the importance\nof informed spaces in approximating the velocity field in high-contrast realistic channelized\nformations. We take the permeability field with the most pronounced channel (layer 36), k = 5,\nand the best combination of (kP,kU ) and ? for polynomial and informed spaces that minimize\nthe corresponding global error, as depicted on Figs. 18 and 19.\n\nIn Figs. 24 and 25 we show the pointwise absolute errors for pressure and flux, respec-\ntively. From these results one can see that both strategies provide comparable approximations\nfor the pressure field (see Fig. 24). However, Fig. 25 indicates that informed spaces produce a\nbetter approximation of the flux variable than its polynomial counterpart. Moreover, the error is\nlarger on the main channel structure of the permeability field for the polynomial compared to the\ninformed case. Thus, informed spaces show great potential to be applied in reservoir simulation.\n\n\n\n3.4. Numerical experiments 81\n\n(kP,kU ) = (4,1),(3,2),(2,3), (1,4). N Pol ? Inf\n\nSource: Elaborated by the author.\n\nFigure 18 \u2013 Relative pressure error as function of ? for layers 33,46,42 and 45 with 5 dof \u2019s. Solid lines:\npolynomial spaces; Dashed lines: informed spaces, for the MRCM formulation.\n\n\n\n82 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\n(kP,kU ) = (4,1),(3,2),(2,3), (1,4). N Pol ? Inf\n\nSource: Elaborated by the author.\n\nFigure 19 \u2013 Relative flux error as function of ? for layers 33,46,42 and 45 with 5 dof \u2019s. Solid lines:\npolynomial spaces; Dashed lines: informed spaces, for the MRCM formulation.\n\n\n\n3.4. Numerical experiments 83\n\nLayer 36 pressure solution\n\n(kP,kU ) = (4,1) ? = 6.527\u00d710?2 Fine Sol.\n\nSource: Elaborated by the author.\n\nFigure 20 \u2013 Pressure solution for the optimal global ? and interface spaces with 5 dof \u2019s for polynomials\nand the fine pressure solution for layer 36.\n\nLayer 36 streamlines\n\n(kP,kU ) = (3,2) ? = 1.035\u00d7100 Fine Sol.\n\nSource: Elaborated by the author.\n\nFigure 21 \u2013 Streamlines for the optimal global ? and interface spaces with 5 dof \u2019s for polynomials and\nthe fine solution for layer 36.\n\nThe studies discussed above illustrate that the accuracy of results produced by the\nMRCM depend on the choice of (kP,kU ) and ? . They also confirm, as noted by Guiraldello et\nal (GUIRALDELLO et al., 2018b), that intermediate values of ? are \u201csafe\u201d, in the sense that\nthey lead to errors that are never larger, and usually smaller, than the errors produced by the\nextreme values ? = 0 (MMMFEM) and ? = +? (MHM). In order to avoid the need of selecting\n(kP,kU ) and ? at each run of the MRCM, we adopt the following strategy that has worked well\nin numerous tests:\n\n? If k is even, we take kP = kU = k/2;\n\n? if k is odd, we take kP = (k?1)/2 and kU = kP + 1 = k?kP;\n\n\n\n84 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\n(kP,kU ) = (3,1),(2,2), (1,3). N Pol ? Inf\n\nSource: Elaborated by the author.\n\nFigure 22 \u2013 Relative pressure error as function of ? for layers 30,63,67 and 75 with 4 dof \u2019s. Solid lines:\npolynomial spaces; Dashed lines: informed spaces, for the MRCM formulation.\n\n\n\n3.4. Numerical experiments 85\n\n(kP,kU ) = (3,1),(2,2), (1,3). N Pol ? Inf\n\nSource: Elaborated by the author.\n\nFigure 23 \u2013 Relative flux error as function of ? for layers 30,63,67 and 75 with 4 dof \u2019s. Solid lines:\npolynomial spaces; Dashed lines: informed spaces, for the MRCM formulation.\n\n\n\n86 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\nAbsolute pressure error\n\nPol : (kP,kU ) = (4,1) ? = 6.527\u00d710?2\n\nIn f : (kP,kU ) = (2,3) ? = 4.391\u00d710?1\n\nSource: Elaborated by the author.\n\nFigure 24 \u2013 Absolute pressure error for the optimal global ? and interface spaces with 5 dof \u2019s for\npolynomial and informed interface spaces for layer 36.\n\n? set ? = 1.\n\nIn this way there are no free parameters for the MRCM. To justify such choices we perform an\nexhaustive comparison of MRCM, MHM and MMMFEM, with the same number k of dof \u2019s per\ninterface for all methods, considering all SPE10 layers. Both polynomial and informed spaces\nare considered and the three methods can be compared on an equal footing. Figures 26 and 28\nshow, respectively, the results for k = 4 and k = 5 for polynomial interface spaces. Note that that\nwhen a curve corresponding to any of the methods appears in the shadowed region of another\ncurve with a larger error, the color gets darker. For this choice of parameters the MHM is the\nleast accurate method in the pressure variable for the channelized layers (layer number > 35),\nthe MMMFEM being the most accurate. For the flux variable, however, the most accurate is the\nMRCM, while the MMMFEM behaves quite poorly for some of the layers around layer 40. The\ncorresponding study for informed spaces is given in Figs. 27 and 29. For these spaces the MHM\nis again the least accurate procedure in the pressure variable (especially in layers 65-75), while\nthe MMMFEM and MRCM behave similarly. For the flux variable the MHM and MRCM yield\n\n\n\n3.4. Numerical experiments 87\n\nAbsolute flux error\n\nPol : (kP,kU ) = (3,2) ? = 1.035\u00d7100\n\nIn f : (kP,kU ) = (1,4) ? = 1.004\u00d7102\n\nSource: Elaborated by the author.\n\nFigure 25 \u2013 Absolute flux error for the optimal global ? and interface spaces with 5 dof \u2019s for polynomial\nand informed interface spaces for layer 36.\n\nsimilar accuracy, better than that of the MMMFEM, which again is considerably worse than the\nothers for the layers around layer 40.\n\nAlthough the focus of previous experiments is accuracy, another equally important aspect\nis the efficiency of the numerical methods. In order to illustrate this aspect, Figure 30 displays\nthe number of GMRES iterations to convergence to solve the interface problem for each method\nwith k = 5 for all the SPE10 layers with polynomial functions for the MMMFEM and MRCM\nand informed functions for the MHM. The GMRES was set with a relative tolerance of 10?9\n\nand an ILU preconditioner with a drop tolerance of 10?4. From the results one can observe\nthat the MMMFEM and the MRCM have comparable number of GMRES iterations, with a\nslight advantage for the MRCM, and converge with half of the iterations required for the MHM.\nIn these experiments the linear systems being solved have 260 unknowns. Another important\npoint is that all of the above experiments are based on a fixed domain decomposition of 11\u00d73\nsubdomains. In order to explorer other configurations, Figure 31 displays the relative error to\nconvergence for many different domain decomposition geometries with k = 5 for layer 36. Notice\n\n\n\n88 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\nthat, as the global fine mesh is fixed and each subdomain is a collection of fine elements, the\nnumber of elements for each domain decomposition geometry are different, e.g., each subdomain\nof the 5\u00d76 domain decomposition geometry has a fine mesh of 44\u00d710 elements.\n\nThe results shown in Figs. 26-31 allow us to conclude that the proposed MRCM is a\ncompetitive alternative to MMMFEM and MHM, both with polynomial and informed interface\nspaces. It should however be noted that the error obtained with informed spaces is roughly the\nsame as that obtained with polynomial spaces. The only salient effect is the reduction of the\npressure error, and just for the MHM.\n\nOverall, the numerical results reported here indicate that the MRCM, with suitable\nchoices for the spaces and parameters, is able to produce more accurate solutions than the other\ntwo procedures for problems defined for realistic, very heterogeneous permeability fields.\n\nSource: Elaborated by the author.\n\nFigure 26 \u2013 Relative pressure and flux error for all the SPE10 layers considering k = 4 and polynomial\nfunctions to build the interface spaces.\n\nSource: Elaborated by the author.\n\nFigure 27 \u2013 Relative pressure and flux error for all the SPE10 layers considering k = 4 and informed\nfunctions to build the interface spaces.\n\n3.5 Concluding remarks\nWe have reviewed the recently introduced Multiscale Robin Coupled Method and de-\n\nscribed its implementation with informed spaces (or empirical interpolation spaces, obtained by\noversampling) for the interface variables. We have compared the accuracy of the solutions of\n\n\n\n3.5. Concluding remarks 89\n\nSource: Elaborated by the author.\n\nFigure 28 \u2013 Relative pressure and flux error for all the SPE10 layers considering k = 5 and polynomial\nfunctions to build the interface spaces.\n\nSource: Elaborated by the author.\n\nFigure 29 \u2013 Relative pressure and flux error for all the SPE10 layers considering k = 5 and informed\nfunctions to build the interface spaces.\n\ntwo well known multiscale methods, the Multiscale Mortar Mixed Finite Element Method and\nthe Mixed Hybrid Method, with that of the MRCM in realistic, very heterogeneous permeability\nfields given by layers of the SPE10 project. The comparison was carried out with the same\nnumber of unknowns for all methods, with interface spaces given by polynomial and informed\nfunctions. It should be mentioned that no such comparison is available even if restricted to\nMMMFEM and MHM, and that no previous implementation or assessment of the MHM with\ninformed spaces has been reported in the literature.\n\nOur numerical results indicate that the MRCM, fixing its algorithmic parameter ? to\nthe value 1 and with a balanced distribution of the unknowns between interface pressures and\ninterface fluxes, is a competitive alternative to the two previous methods. In fact, it is more\naccurate than MHM (which behaves better than MMMFEM) for the flux variable in highly\nchannelized cases, without the large pressure errors produced by MHM.\n\nFurther work is needed to establish new, effective strategies for the construction of\ninformed spaces. The simple procedures explored in this work have been useful for studying the\noptimal distribution of unknowns between interface pressures and fluxes, but the reduction in\nthe solution global error was not significant, although it shows improved local approximations\nfor the fluxes in channelized formations. Moreover, it was also shown that the MHM, when the\n\n\n\n90 Chapter 3. Informed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\nSource: Elaborated by the author.\n\nFigure 30 \u2013 Number of GMRES iterations to convergence for all the SPE10 layers with k = 5.\n\ninterface spaces are switched from polynomial to informed (with the specific spaces proposed),\nexhibits essentially the same flux error but with a noticeable decrease of the pressure error. The\nidentification of informed spaces with similar positive effects on the MRCM are left for future\nstudies.\n\n\n\n3.5. Concluding remarks 91\n\nDomain decomposition geometries\n\nSource: Elaborated by the author.\n\nFigure 31 \u2013 Relative pressure and flux errors and number of GMRES iterations, indicated below the labels,\nto convergence for different domain decomposition geometries,indicated at top of each graph\nwith the number of unknowns being solved in parenthesis, for the layer 36 with k = 5.\n\n\n\n\n\n93\n\nCHAPTER\n\n4\nVELOCITY POSTPROCESSING SCHEMES\nFOR THE MULTISCALE ROBIN COUPLED\n\nMETHOD FOR CONTAMINANT\nTRANSPORT IN SUBSURFACE FLOWS\n\nWe propose two postprocessing procedures (Patch method and Stitch method) to re-\ncover local conservation of velocity fields produced by multiscale approximations that are only\nconservative in coarse scales. These procedures operate on small overlapping regions and are\ndesigned to be implemented in parallel, that makes them relatively inexpensive. We investigate\nthe applicability of such methods when tested on single-phase flow problems using the Multiscale\nRobin Coupled Method (MRCM) in highly heterogeneous permeability fields for modeling the\ncontaminant transport in the subsurface. Numerical simulations are presented aiming to illustrate\nand compare the performance of the new methods with a standard procedure, the Mean method,\nin terms of accuracy in contaminant concentration. We show that for a collection of permeability\nfields taken as log-normal fields the new postprocessing procedures provide similar or better\naccuracy than the Mean method. Then we turn our attention to flows in high-contrast channelized\nporous formations, where the new methods robustly yield more accurate results and should thus\nbe favored.\n\n4.1 Introduction\n\nWe are concerned with flows in porous media. The model problem that we consider\nconsists on the one hand of the second order elliptic Darcy model, whose mixed form is: find u\n\n\n\n94\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nand p such that ??????\n?????\n\nu = ?K ?p in ?\n?\u00b7u = f in ?\n\np = g on ? ?p\nu\u00b7n?? ? = z on ? ?u\n\n(4.1)\n\nwhere ? ? Rd , d = 2 or 3 is the computational domain, K is a symmetric, uniformly positive\ndefinite tensor with components in L?(?), u is the Darcy velocity, p is the pressure, f ? L2(?)\nthe source, g ? H\n\n1\n2 (? ?p) the pressure boundary data, z ? H?\n\n1\n2 (? ?u) the normal velocity data\n\nand n?? ? is the outer normal to ? ?. On the other hand, given the fluid velocity u as obtained\nfrom (4.1) we solve the transport of a passive tracer or contaminant which is governed by the\nscalar hyperbolic conservation law\n\n????\n???\n\n? C\n\n? t\n+ ? \u00b7(u C ) = 0 in ?\n\nC (x,t = 0) = C0(x) in ?\nC (x,t) = CD(x,t) in ? ??\n\n(4.2)\n\nwhere C is the concentration of the pollutant species, C0 its initial condition and CD the\nconcentration at the inlet boundaries ? ?? ={x ? ? ?, u\u00b7n?? ? &lt;0}.\n\nNowadays applications of fluid flow in subsurface problems governed by (4.1)-(4.2) or\nsome variant of it, such as those involving oil and gas production, compositional flow in oil\nreservoirs and pollutant transport in aquifers, may require over a billion computational cells to\npredict with reasonable accuracy the flow variables. Besides this enormous challenge, uncertainty\nquantification studies are necessary to deal with the stochastic nature of the permeability field\nand estimate relevant quantities with statistical significance. Multiscale domain decomposition\nmethods for the simulation of transport in porous media, aiming for high performance and\nscalability, have been the focus of intensive research over the last years. The underlying idea is\nto decompose the computational domain into non-overlapping subdomains in which local small\nproblems are solved. This is naturally done in parallel. Recently, in (GUIRALDELLO et al.,\n2018b) and (GUIRALDELLO et al., 2018a), we have proposed a new method named Multiscale\nRobin Coupled Method (MRCM) as a generalization to the Multiscale Mixed Method (MuMM)\n(FRANCISCO et al., 2014), based on a domain decomposition technique introduced originally\nby Douglas et al (DOUGLAS et al., 1993), in which the local problems are subject to Robin\ntype boundary conditions. In the new method we introduce two unknown fields on the so called\nskeleton of the domain decomposition, namely, a flux UH and a pressure PH , belonging to some\nfunction spaces of low dimension UH and PH defined over the skeleton, such that continuity of\npressure and flux are weakly enforced. This in turn leads to a system of equations of intermediate\nsize that couples the solutions over the domains of the decomposition. In a multiscale formulation\nlike ours, the compatibility conditions are only satisfied at some coarse scale H ? h in order\nto alleviate the computational burden. Denoting the skeleton of the decomposition by ? and by\n\n\n\n4.1. Introduction 95\n\n(u, p) the multiscale solution, this means that?\n?\n\n(\nu+?u?\n\n)\n\u00b7n? MH d? = 0 , ?MH ? PH , (4.3)?\n\n?\n\n(p+? p?)VH d? = 0 , ?VH ? UH , (4.4)\n\nwhere the + and ? superscripts refer to the two-sided limits approaching ? and n? is a unit vector\nnormal to ?. In the limit case when H = h we recover the global fine grid solution and continuity\nof flux and pressure is satisfied pointwise. Two well known methods, the Multiscale Mortar\nMixed Finite Element Method (MMMFEM) (ARBOGAST et al., 2007) and the Multiscale\nHybrid-Mixed Finite Element Method (MHM) (HARDER; PAREDES; VALENTIN, 2013) can\nbe obtained as particular cases of the MRCM by suitably defining a parameter ? in the Robin\nboundary condition that couples the subdomain solutions, i.e.,\n\n?\n? H\n\nKi(x)\nuih \u00b7n?\n\ni + pi =?\n? H\n\nKi(x)\nUH n?\u00b7n?i + PH (4.5)\n\nwhere uih is the flux multiscale solution on subdomain ?i and n?\ni is the exterior normal to\n\n? ?i. We can move from one method to the other in different parts of the domain without any\nimplementation effort. Also, there is considerable freedom to select the numerical schemes to\nsolve the local problems in the subdomains as well as to choose the interface spaces UH and\nPH independently from each other. All these features give the possibility of producing more\naccurate solutions as compared to other available techniques, as we have numerically shown in\n(GUIRALDELLO et al., 2018b; GUIRALDELLO et al., 2018a). The drawback of course is that\nfluxes are only conservative at the coarse scale given by the size of the subdomains H, i.e., for\neach interface ?i j between subdomains ?i and ? j the following holds?\n\n?i j\n\nuih \u00b7n? d? =\n?\n\n?i j\n\nu jh \u00b7n? d?. (4.6)\n\nFluxes are not in general continuous at the fine level of the discretization on interfaces between\nadjacent domains. The velocity field produced by such methods is unsuitable to be used in the\ntransport equation (4.2). Therefore, some post-processing or downscaling procedure becomes\nnecessary.\n\nLet us illustrate this with an example. Consider the highly heterogeneous permeability\nfield displayed in Figure 32. This field exhibits a contrast Kmax/Kmin ? 105 and corresponds\nto a log-normal field plus a central channelized region that has been inserted by hand to make\nthe problem more challenging. In this example, the domain ? = [0,1]\u00d7 [0,1] is discretized\ninto 100 \u00d7 100 fine grid cells and decomposed into 2 \u00d7 2 subdomains.The skeleton of the\ndecomposition is denoted by ?, which in this particular case is made of the four internal\ninterfaces between the subdomains. Figure 33 shows the multiscale solution (velocity and\npressure) produced by our method in three different situations, considering interface spaces PH\nand UH of very low dimension made up of functions that are constant by parts on each interface.\n\n\n\n96\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nSource: Elaborated by the author.\n\nFigure 32 \u2013 Permeability field used to illustrate the behavior of the multiscale method.\n\nIn the first case (top subfigure), we take the Robin condition parameter very large (? = 106). In\nthis situation the MRCM retrieves the MHM solution, in which continuity of fluxes is enforced\npointwise, as observed in the insert, whereas continuity of pressure is weakly satisfied according\nto (4.4). This leads to a significant pressure jump at the interfaces, also clearly noticeable in\nthe figure. In the second case we take ? = 1 (middle part). For such intermediate value of the\nRobin condition parameter neither flux nor pressure satisfy pointwise continuity. As a result, a\nsmall jump is observed at the interfaces in both multiscale velocity and pressure. For instance,\nthis is clearly noticed in the right insert, where we have also plotted the flux jump along ?13\nwhich is one of the critical interfaces crossing the high permeability channel. Finally, we take\nthe algorithmic parameter very small (? = 10?6), such that the method retrieves the MMMFEM\nsolution, in which the pressure field is continuous, as observed at the bottom of Figure 33, while\nthe velocity field exhibits very large jumps at the interfaces, also highlighted in the right insert\nthat shows the flux jump along interface ?13. It becomes evident that in the last two cases some\ndownscaling or postprocessing procedure on the velocity field is mandatory prior to its use in the\nresolution of the transport equation, be it in a multiphase (non-linear) problem or in the linear\ncase of a passive tracer. This is addressed in this article where two new simple and relatively\ninexpensive procedures are proposed, namely the Patch method and the Stitch method, that are\ncompared to the standard technique of computing the average velocity at interfaces between\nsubdomains.\n\nAfter this introduction, the plan of the article is as follows. First, we recall the MRCM\n\n\n\n4.1. Introduction 97\n\nMHM - ? = 106\n\nPressure field\n\nVelocity field\n\nMRCM - ? = 1\n\n-15\n\n-10\n\n-5\n\n0\n\n5\n\n10\n\n15\n\n0 0.2 0.4 0.6 0.8 1\n\nF\nlu\n\nx\nju\n\nm\np\n\nDistance along interface ?13\n\nPressure field\n\nVelocity field\n\nMMMFEM - ? = 10?6\n\n-30\n\n-25\n\n-20\n\n-15\n\n-10\n\n-5\n\n0\n\n5\n\n10\n\n0 0.2 0.4 0.6 0.8 1\nDistance along interface ?13\n\nF\nlu\n\nx\nju\n\nm\np\n\nPressure field\n\nVelocity field\n\nSource: Elaborated by the author.\n\nFigure 33 \u2013 Multiscale solutions produced by the MRCM method considering different values of the\nRobin condition parameter: ? = 10?6 (top), ? = 1 (middle), ? = 106 (bottom).\n\n\n\n98\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nmethod by explaining with some level of detail how the previous example was actually computed.\nIn section 4.3 the proposed downscaling methods are presented. In the numerical results section\nwe extensively assess and compare them by solving the transport of a passive tracer by means\nof a finite volume method in highly heterogeneous permeability rock formations. Finally, some\nconclusions are drawn.\n\n4.2 The Multiscale Robin Coupled method\nIn this section we recall the main ingredients and some implementation aspects of the\n\nMultiscale Robin Coupled Method method. For further details, such as well-posedness results,\nimplementation in a variational setting and the possibility of using informed functions to build\nup the interface spaces UH and PH the reader is referred to (GUIRALDELLO et al., 2018b;\nGUIRALDELLO et al., 2018a).\n\nWe begin by introducing some notation. The key ingredient is the discrete solution of\nlocal Darcy problems. Let us consider a rectangular domain ? ?Rd, d = 2,3 and a subdivision\nTh made of d-dimensional rectangles. We refer to this partition as the fine grid. The permeability\nK and source term f are functions belonging to the space P0(Th), i.e., functions that are constant\nby parts on this fine grid. In general, the boundary of ? can be divided into disjoint parts denoted\nby ?u,?p,?r in which flux, pressure and Robin boundary conditions are imposed. The problem\nreads: Find (uh, ph) such that????????\n\n???????\n\nuh = ?K ? ph in ?\n?\u00b7uh = f in ?\n\nph = gp on ?p\nuh \u00b7n = gu on ?u\n\n?? uh \u00b7n + p = gr on ?r\n\n. (4.7)\n\nThe domain ? can be the domain in which the global problem being considered is posed or\nany subdomain made of a collection of fine grid cells, as it will be the case later on when\ndescribing the downscaling procedures. Figure 34 shows the computational domain, the fine\ngrid discretization and the domain decomposition. For the solution of the Darcy problems we\nadopt a standard cell-centered finite volume scheme on rectangular cartesian grids in which we\nsolve for the cell pressure unknowns pI,J by eliminating the edge flux unknowns uI\u00b112 ,J\u00b1\n\n1\n2\n. A\n\ncomplete description can be found in (GUIRALDELLO et al., 2018b). For further details and\npossible generalizations see e.g. (ARBOGAST; WHEELER; YOTOV, 1997). As mentioned,\nthere is considerable freedom to choose the local solvers. In principle any finite volume, finite\nelement or finite difference scheme that delivers the edge fluxes at subdomain interfaces, when\nrequested by the multiscale method to be described below, can be used.\n\nA non-overlapping domain decomposition of ? into subdomains ?i, i = 1,...,N is\nconsidered. Let us denote by n?i the outer normal to ? ?i and by n? a unique normal to interface\n\n\n\n4.2. The Multiscale Robin Coupled method 99\n\n?23\n\n?56\n\n?89\n\n? j ?i\n\nExterior to ?i\n\nn?\n\nn?i\n\nExterior to ?min{i, j}\nFine grid Th\n\n? ?\n\nSkeleton ?\n\n?14 ?36?25\n\nn?i\n\nn?i\n\nn?i\n\nn? n?\n\nn?\n\nn?\n\nn?i\n\nI ?1/2,J I + 1/2,J\n\nI,J?1/2\n\nI,JI ?1,J I + 1,J\n\nI,J + 1\n\nI,J?1\n\nI,J + 1/2\n\nCell pressure pI,J\n\nEdge pressure\n\n?12\n\n?45\n\n?78\n?47 ?69\n\nEdge flux uI\u00b112 .J\u00b1\n1\n2\n\nHh\n\n?58\n\n?1\n\n?i=5\n\n?2\n\n?7\n\n?3\n\n?6\n\n?9?8\n\n?4\n\nSource: Elaborated by the author.\n\nFigure 34 \u2013 The computational domain along with the fine grid discretization and the domain decomposi-\ntion adopted.\n\n?i j defined such that it points out from the domain with smallest index (i.e., n? = n?min(i, j)).\n\nOur multiscale method can be written as: Find subdomain solutions (uih, p\ni\nh), i = 1,...,N\n\nand interface fields (UH,PH) satisfying the local problems\n\n????????\n???????\n\nuih = ?K ? p\ni\nh in ?i\n\n?\u00b7uih = f in ?i\npih = gp on ? ?i ??p\n\nuih \u00b7n?\ni = gu on ? ?i ??u\n\n??iuih \u00b7n?\ni + pih = ??iUH n?\u00b7n?\n\ni + PH on ? ?i ??\n\n(4.8)\n\nin which the differential operators are replaced by suitable discrete approximations, together\n\n\n\n100\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nwith the compatibility conditions on the skeleton ????????\n??????\n\nN\n\n?\ni=1\n\n?\n? ?i??\n\n(\nuih \u00b7n?\n\ni)\n? d? = 0 ,\n\nN\n\n?\ni=1\n\n?\n? ?i??\n\n?i\n(\nuih \u00b7n?\n\ni ?UH n?i \u00b7n?\n)\n\n? n?i \u00b7n? d? = 0 ,\n(4.9)\n\nwhich must hold for all functions ? ? PH and ? ? UH . The interface flux UH and interface\npressure PH are functions belonging to these spaces which are contained in Fh(Eh) defined as\n\nFh(Eh) ={ f : Eh ?R | f |e ? P0 , ?e ? Eh} , (4.10)\n\nwhere Eh is the set of all edges (in 2D) or faces (in 3D) of Th contained in ?. These spaces are\nmade up at least of the constant function over ?. Equation (4.9) in such case is nothing but the\nstatement that fluxes and pressures are continuous over ? in the mean sense. A smart definition\nof the interface spaces is essential for the resulting accuracy and convergence of the method.\nIn this article we restrict ourselves to polynomial spaces for simplicity, however some better\nstrategies were recently devised in (GUIRALDELLO et al., 2018a). As for the Robin condition\nparameter ?i on each subdomain, several choices are possible. Based on our previous experience\n(see (GUIRALDELLO et al., 2018a)), we adopt\n\n?i(x) =\n? H\n\nKi(x)\n(4.11)\n\nwhere ? is a dimensionless algorithmic parameter that is taken equal to 1 in the numerical\nexperiments below, H is the characteristic size of the subdomains and Ki(x) is a local permeability.\nBy changing ? we retrieve the MMMFEM method (? ? 0) and the MHM method (? ? ?).\nThis has been numerically shown in the authors\u2019 article (GUIRALDELLO et al., 2018b).\n\nLet us explain how the example of the previous section was actually computed by using\nthe MRCM formulation. First, to solve the problem efficiently we must segregate the resolution\nof the subdomain problems from the resolution of the interface unknowns. To that end, on each\nsubdomain ?i, the solution (uih, p\n\ni\nh) of the Darcy problem is decomposed as the sum of two parts\n\nuih = u?\ni\nh + u?\n\ni\nh, p\n\ni\nh = p?\n\ni\nh + p?\n\ni\nh, (4.12)\n\nsatisfying the following problems????????\n???????\n\nu?ih = ?K ?p?\ni\nh in ?i\n\n?\u00b7u?ih = f in ?i\np? ih = gp on ? ?i ??p\n\nu?ih \u00b7n?\ni = gu on ? ?i ??u\n\n??iu?ih \u00b7n?\ni + p? ih = 0 on ? ?i ??\n\n, (4.13)\n\n\n\n4.2. The Multiscale Robin Coupled method 101\n\n????????\n???????\n\nu?ih = ?K ? p?\ni\nh in ?i\n\n? \u00b7u?ih = 0 in ?i\np? ih = 0 on ? ?i ??p\n\nu?ih \u00b7n?\ni = 0 on ? ?i ??u\n\n??iu?ih \u00b7n?\ni + p? ih = ??iUH n?\u00b7n?\n\ni + PH on ? ?i ??\n\n. (4.14)\n\nIt is useful to think the solution u?ih as a function of the interface data (PH,UH). Abusing notation\nthis will be denoted later on as u?ih(PH,UH). In the example above, the skeleton ? in which the\nRobin boundary conditions are being imposed is made of the four internal interfaces as shown in\nFigure 32, which are numbered ?12,?34,?13 and ?24.\n\nNow, consider PH = span{?1,...,?NP} and UH = span{?1,...,?NU}, where NP and NU\nare the dimensions of the interface spaces. In general, we choose kU and kP degrees of freedom\nper interface, therefore the dimensions of these spaces are NP = kP \u00d7NI and NU = kU \u00d7NI ,\nbeing NI the number of elements in the skeleton mesh. The simplest case corresponds to taking\nkP = kU = 1 and one element per interface between subdomains, as we have done in the example\nabove. In such case, the interface spaces are made up of functions that are constant on each\ninterface ?i j. Let us write the interface fields as linear combinations of the basis functions\n\nPH =\nNP\n\n?\nk=1\n\nPk ?k, UH =\nNU\n\n?\nk=1\n\nUk ?k. (4.15)\n\nThis leads to the linear system of equations to be satisfied by the vector of interface unknown\ncoefficients X = (P1,...,PNP,U1,...,UNU )\n\n?. This system consists of two blocks of rows and\ncolumns\n\nA X = b ?\n\n?\n?? A\n\nPP APU\n\nAU P AUU\n\n?\n??\n?\n??P\n\nU\n\n?\n?? =\n\n?\n??b\n\nP\n\nbU\n\n?\n??. (4.16)\n\nThe first block of rows is obtained by taking ? = ?`, ` = 1,...,NP in the first equation of (4.9),\ni.e.,\n\nN\n\n?\ni=1\n\n?\n? ?i??\n\n(\nuih \u00b7n?\n\ni)\n?` = ?\n\ni j\ni&lt;j\n\n?\n?i j\n\n(\nuih \u00b7n?\n\ni + u jh \u00b7n?\nj\n)\n\n?` =\n\n= ?\ni j\n\ni&lt;j\n\n?\n?i j\n\n[(\nu?ih(PH,UH)+ u?\n\ni\nh\n)\n\u00b7n?i +\n\n(\nu? jh(PH,UH)+ u?\n\nj\nh\n\n)\n\u00b7n? j\n]\n\n?` =\n\n= ?\ni j\n\ni&lt;j\n\n?\n?i j\n\n(\nu?ih(PH,UH)?u?\n\nj\nh(PH,UH)\n\n)\n\u00b7n? ?` + ?\n\ni j\ni&lt;j\n\n?\n?i j\n\n(\nu?ih ?u?\n\nj\nh\n\n)\n\u00b7n? ?` = 0, (4.17)\n\nwhere we have emphasized the dependence of u?ih with respect to (PH,UH) and omitted the\n\n\n\n102\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\ndifferential d? for conciseness. Using (4.15) we obtain\n\nNP\n\n?\nk=1\n\nPk ?\ni j\n\ni&lt;j\n\n?\n?i j\n\nJi j(u?h(?k,0))?`\n\n? ?? ?\nAPP\n`k\n\n+\nNU\n\n?\nk=1\n\nUk ?\ni j\n\ni&lt;j\n\n?\n?i j\n\nJi j(u?h(0,?k))?`\n\n? ?? ?\nAPU\n`k\n\n=\n\n=??\ni j\n\ni&lt;j\n\n?\n?i j\n\nJi j(u?h)?`\n\n? ?? ?\nbP\n`\n\n, (4.18)\n\nwhere the symbol Ji j(\u00b7) stands for the jump operator at ?i j and is defined for any vector\nfield v as Ji j(v) = (vi ?v j) \u00b7 n?. The second block of rows is obtained similarly by taking\n? = ?`, ` = 1,...,NU in the second equation of (4.9), i.e.,\n\nN\n\n?\ni=1\n\n?\n? ?i??\n\n?i\n(\nuih \u00b7n?\n\ni ?UH n?i \u00b7n?\n)\n\n?` n?i \u00b7n? =\n\n= ?\ni j\n\ni&lt;j\n\n?\n?i j\n\n(\n?i uih + ? j u\n\nj\nh\n\n)\n\u00b7n? ?`??\n\ni j\ni&lt;j\n\n?\n?i j\n\n(\n?i + ? j\n\n)\nUH ?` =\n\n= ?\ni j\n\ni&lt;j\n\n?\n?i j\n\n(\n?i u?ih(PH,UH)+ ? j u?\n\nj\nh(PH,UH)\n\n)\n\u00b7n? ?` +\n\n+?\ni j\n\ni&lt;j\n\n?\n?i j\n\n(\n?i u?ih + ? j u?\n\nj\nh\n\n)\n\u00b7n? ?`??\n\ni j\ni&lt;j\n\n?\n?i j\n\n(\n?i + ? j\n\n)\nUH ?` = 0. (4.19)\n\nAgain, inserting (4.15) yields\n\nNP\n\n?\nk=1\n\nPk ?\ni j\n\ni&lt;j\n\n?\n?i j\n\n(\n?i u?ih(?k,0)+ ? j u?\n\nj\nh(?k,0)\n\n)\n\u00b7n? ?`\n\n? ?? ?\nAU P\n`k\n\n+\n\n+\nNU\n\n?\nk=1\n\nUk ?\ni j\n\ni&lt;j\n\n?\n?i j\n\n[(\n?i u?ih(0,?k)+ ? j u?\n\nj\nh(0,?k)\n\n)\n\u00b7n??\n\n(\n?i + ? j\n\n)\n?k\n\n]\n?`\n\n? ?? ?\nAUU\n`k\n\n=??\ni j\n\ni&lt;j\n\n?\n?i j\n\n(\n?i u?ih + ? j u?\n\nj\nh\n\n)\n\u00b7n? ?`\n\n? ?? ?\nbU\n`\n\n. (4.20)\n\nRemark 5. Two remarks can be made about (4.18) and (4.20):\n\ni. The functions u?ih(?k,0) and u?\ni\nh(0,?k) are the solutions to the subdomain problems (4.14)\n\ntaking as Robin boundary data (PH,UH) = (?k,0) and (PH,UH) = (0,?k), respectively.\nThese are, in fact, the so called multiscale basis functions that we have described before in\n(GUIRALDELLO et al., 2018b).\n\n\n\n4.3. The velocity postprocessing schemes 103\n\nii. Although not necessary, in this article each of the basis functions ?l and ?` that span\nPH and UH is chosen to have as support one single interface ?i j of the mesh skeleton ?,\ngreatly simplifying the system assembly and leading to a sparse matrix A. Moreover, such\nchoice for the space PH allows us to obtain a conservative solution at the coarse scale H\nfor ? &lt;+?, a fact easily verified through expression (4.18).\n\n4.3 The velocity postprocessing schemes\nFirst, let us recall that the multiscale solutions produced by the MRCM are mass-\n\nconserving at the coarse scale of the domain decomposition, i.e., for each interface ?i j between\nsubdomains ?i and ? j, it holds ?\n\n?i j\n\n(\nuih \u00b7n??u\n\nj\nh \u00b7n?\n)\n= 0, ? i, j. (4.21)\n\nThe solution is, however, discontinuous at the fine level, except when the algorithmic parameter\n? is taken very large as we have illustrated (see Figure 33). Some postprocessing or downscaling\nprocedure on the velocity field becomes thus essential if transport of any quantity such as a fluid\nsaturation or the concentration of a passive tracer is to be solved. A natural and simple way to\ndeal with such discontinuous field is to take the average value of the two-sided solution at the\ninterfaces between subdomains so as to define a unique flux on the fine grid over the skeleton\nof the domain decomposition. Given the multiscale solutions uih, i = 1,...,N, this amounts to\ncomputing in a first step for each ?i j a new interface field defined as\n\nU?i jh\n.\n=\n\n1\n2\n\n(\nuih|?i j + u\n\nj\nh|?i j\n\n)\n. (4.22)\n\nNotice that the new velocity U?i jh transfers the same mass through the interfaces as the two-sided\nmultiscale solution, i.e., ?\n\n?i j\n\nuih \u00b7n? =\n?\n\n?i j\n\nu jh \u00b7n? =\n?\n\n?i j\n\nU?i jh \u00b7n?. (4.23)\n\nOnce the flux values on every ?i j are updated, we proceed to the second step: for each subdomain\n?i, solve ??????\n\n?????\nu?ih = ?K ?p?\n\ni\nh in ?i,\n\n?\u00b7u?ih = f in ?i,\nu?ih \u00b7n?\n\ni = uih \u00b7n?\ni on ? ?i ?? ?,\n\nu?ih \u00b7n?\ni = U?ikh \u00b7n?\n\ni on ?ik,?k,\n\n(4.24)\n\nwhere index k above runs over all subdomain neighbors to ?i. After these two steps we end\nup with a flux field which is conservative on the fine grid and therefore suitable for transport.\nWe refer to this method as the Mean method. Notice in (4.24) that along ? ?i ?? ? the original\nvelocity multiscale solution is being imposed as boundary condition. This approach is quite\nsimple to implement and relatively cheap. The only operation that involves some additional cost\nis the solution of subdomain problems (4.24), which can clearly be done in parallel.\n\n\n\n104\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nThe question considered here is whether alternative methods can be designed that have\ncomplexity similar to that of the Mean method while exhibiting better accuracy. The aim of this\narticle is precisely to propose two new alternatives to the Mean method, namely, the Patch and\nthe Stitch methods, which are now explained and later on assessed in the results section.\n\n4.3.1 The Patch method\n\nLet us consider oversampling regions around each interface ?i j covering the skeleton of\nthe domain decomposition. These regions are called patches and they are made up of a collection\nof fine grid cells of the underlying discretization. In our implementation each one covers one\nsingle interface ?i j and has a thickness in the directions perpendicular to ?i j tipically formed by\n1 to 3 layers of fine cells, as illustrated in Figure 35. Notice, these regions may intersect each\nother. The idea is to solve local Darcy problems on these patches so as to define a unique velocity\n\nu24h \u00b7n?24 = u\n4\nh \u00b7n?24\n\nu24h \u00b7n?24 = u\n2\nh \u00b7n?24\n\nu13h \u00b7n?13 = u\n3\nh \u00b7n?13\n\nu13h \u00b7n?13 = u\n1\nh \u00b7n?13\n\n?13\n\nu1\n2 h\n\u00b7n?\n\n12\n=\n\nu1 h\n\u00b7n?\n\n12\n\n?24\n\n?34\n\n?12\n\nSteps 1 &amp; 2 - Patch problems and Restriction:\n\n?13\n\n?24\n\n?4 : u4h?3 : u\n3\nh\n\nu3\n4 h\n\u00b7n?\n\n34\n=\n\nu3 h\n\u00b7n?\n\n34\n\nu3\n4 h\n\u00b7n?\n\n34\n=\n\nu4 h\n\u00b7n?\n\n34\n\n?34\n\nStep 3 - Subdomain problems:\n\n?2 : u?2h?1 : u?\n1\nh\n\n?3 : u?3h ?4 : u?\n4\nh\n\n?1 : u1h ?2 : u\n2\nh?12\n\nu1\n2 h\n\u00b7n?\n\n12\n=\n\nu2 h\n\u00b7n?\n\n12\n\nU?13h ? u\n13\nh U?\n\n24\nh ? u\n\n24\nh\n\nU?\n12 h\n?\n\nu1\n2 h\n\nU?\n34 h\n?\n\nu3\n4 h\n\nU?13h\n\nU?12h\n\nU?34h\n\nU?24h\n\nSource: Elaborated by the author.\n\nFigure 35 \u2013 The Patch method.\n\nfield on each interface ?i j. The procedure can be divided into three steps:\n\n\n\n4.3. The velocity postprocessing schemes 105\n\nStep 1 - Patch problems: For each ?i j define a patch ?i j that encloses the interface, formed by a\ncollection of fine grid elements of ?i and ? j and solve:??????\n\n?????\nui jh = ?K ?p\n\ni j\nh in ?i j\n\n?\u00b7ui jh = f in ?i j\n\nui jh \u00b7ni j =\n\n{\nuih \u00b7ni j if x ? ?i\nu jh \u00b7ni j if x ? ? j\n\non ? ?i j\n\n, (4.25)\n\nwhere ni j is the exterior normal vector to ? ?i j.\n\nStep 2 - Restriction: For each interface define a new interface field as the restriction of ui jh to ?i j,\ni.e.,\n\nU?i jh\n.\n= ui jh |?i j . (4.26)\n\nStep 3 - Subdomain problems: Foreach ?i, solve:??????\n?????\n\nu?ih = ?K ?p?\ni\nh in ?i,\n\n?\u00b7u?ih = f in ?i,\nu?ih \u00b7n?\n\ni = uih \u00b7n?\ni on ? ?i ?? ?,\n\nu?ih \u00b7n?\ni = U?ikh \u00b7n?\n\ni on ?ik,?k,\n\n(4.27)\n\nwhere index k above runs over all subdomain neighbors to ?i. This is exactly the same as in\n(4.24) with U?i jh replaced by U?\n\ni j\nh . After steps 1-3, we end up with a mass-conserving flux field.\n\nThe extension to three dimensions is straightforward. One can easily check that the new interface\nvelocity satisfies ?\n\n?i j\n\nuih \u00b7n? =\n?\n\n?i j\n\nu jh \u00b7n? =\n?\n\n?i j\n\nU?i jh \u00b7n?, (4.28)\n\nsince the solutions of the local problems are obtained by a mass-conserving method and satisfies\nthe compatibility condition ?\n\n? ?i j\n\nui jh \u00b7ni j =\n?\n\n?i j\n\nf . (4.29)\n\nAlso notice that problems (4.25) and (4.27) are undefined up to a pressure constant. The indeter-\nminacy is in practice removed by imposing the average pressure field to be zero.\n\nInterestingly, this method can be turned into an iterative scheme by repeating the process\nand taking in equation (4.25) (in Step 1) the last computed u?ih instead of the multiscale solution\nuih. A few iterations have shown to provide a more accurate result when compared to the fine\ngrid solution, however, based on our numerical experimentation we have concluded the benefit\nbrought by such iterative method does not justify the additional computational cost involved.\n\nIn the Mean method, the only necessary operation to define a unique flux at the interfaces\nis the averaging of the original multiscale flux solution, whereas in the Patch method this is\nacomplished by executing Steps 1 and 2, that obviously involve an additional cost. However, the\n\n\n\n106\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nlocal patch problems are in general small as compared to the subdomain problems, whose resolu-\ntion is part of both methods and dominates the overall computational cost of the downscaling\nprocedures. All these tasks can always be executed efficiently in parallel.\n\n4.3.2 The Stitch method\n\nWe propose another method based on the idea of solving local problems on patches\naround the interfaces of the domain decomposition. Informally speaking, in this method, instead\nof recomputing the solutions over the subdomains, we simply \u201cstitch\" the local patch solutions\nto the global multiscale solution. In order to proceed we must first distinguish two situations:\n(i) Overlapping patches; and (ii) Non-overlapping patches. The first case, is the one to be\nadopted if using non-simplicial grids for discretization in the subdomains, as is the case in our\nimplementation that uses rectangular cartesian grids. The second case is feasible when using\nsimplicial grids for discretization. These two situations are illustrated in Figure 36.\n\n?3 ?4\n\n?1 ?2\n\n?3 ?4\n\n?1 ?2\n\nNon-simplicial mesh - Overlapping domains Simplicial mesh - Non-overlapping domains\n\n?34\n\n?12\n\n?34\n\n?12\n\n?13 ?24?13 ?24\n\nSource: Elaborated by the author.\n\nFigure 36 \u2013 Examples of patch definitions for the Stitch method. Overlapping domains with non-simplicial\nmesh (left) and non-overlapping domains with simplicial mesh (right).\n\nLet us consider the first case of overlapping patches. In such case, in order to produce\na mass-conserving solution, the local patches need to be separated into disjoint sets. This can\nin principle be done in an arbitrary way. In our implementation, for the sake of simplicity we\nseparate into two sets: the sets of horizontal and vertical patches, as displayed in Figure 37. In\nthis case, the downscaling method proceeds as follows:\n\nStep 1 - Horizontal patch problems: For each horizontal interface ?i j define a patch ?Hi j that\nencloses the interface, formed by a collection of fine grid elements of ?i and ? j and solve:??????\n\n?????\nui j,Hh = ?K ? p\n\ni j,H\nh in ?\n\nH\ni j\n\n?\u00b7ui j,Hh = f in ?\nH\ni j\n\nui j,Hh \u00b7ni j =\n\n{\nuih \u00b7ni j if x ? ?i\nu jh \u00b7ni j if x ? ? j\n\non ? ?Hi j\n\n, (4.30)\n\nwhere ni j is exterior normal vector to ? ?Hi j.\n\n\n\n4.3. The velocity postprocessing schemes 107\n\nu?ih = u\ni\nh in ?i??\n\nH\nik\n\nu?ih\n.\n= ui j,Hh in ??i??\n\nH\nik\n\nu?ih = u?\ni\nh in ?i??\n\nV\nik\n\nu?ih\n.\n= ui j,Vh in ??i??\n\nV\nik\n\nStep 1 - Solve horizontal patches:\n\nu13,Hh \u00b7n?13 = u\n3\nh \u00b7n?13\n\n?\nH\n13\n\n?2 : u2h?1 : u\n1\nh\n\n?\nH\n24\n\n?3 : u3h ?4 : u\n4\nh\n\nStep 3 - Solve vertical patches:\n\n?2 : u?2h?1 : u?\n1\nh\n\nStep 4 - Stitch vertical solutions:\n\n?3 : u?3h\n\n?4 : u?4h?\nV\n34\n\n?2 : u?2h\n\nStep 2 - Stitch horizontal solutions:\n\nu1\n2,\n\nV\nh\n\u00b7n?\n\n12\n=\n\nu?1 h\n\u00b7n?\n\n12\n\nu13,Hh \u00b7n?13 = u\n1\nh \u00b7n?13\n\n?1 : u?1h ?\nV\n12\n\nu3\n4,\n\nV\nh\n\u00b7n?\n\n34\n=\n\nu?3 h\n\u00b7n?\n\n34\n\nu3\n4,\n\nV\nh\n\u00b7n?\n\n34\n=\n\nu?4 h\n\u00b7n?\n\n34\n\n?\nH\n13\n\n?\nH\n24\n\n?3 : u?3h\n\n?4 : u?4h\n\n?\nV\n34\n\n?\nV\n12\n\nu1\n2,\n\nV\nh\n\u00b7n?\n\n12\n=\n\nu?2 h\n\u00b7n?\n\n12\n\nu24,Hh \u00b7n?24 = u\n4\nh \u00b7n?24\n\nu24,Hh \u00b7n?24 = u\n2\nh \u00b7n?24\n\n?\nV\n12\n\n?\nV\n34\n\n?\nH\n13 ?\n\nH\n24\n\nSource: Elaborated by the author.\n\nFigure 37 \u2013 The Stitch method.\n\nStep 2 - Stitch horizontal solutions: For each subdomain ?i, take:\n\nu?ih\n.\n= uih in ?i??\n\nH\nik,\n\nu?ih\n.\n= ui j,Hh in ??i ??\n\nH\nik,\n?k (4.31)\n\nwhere index k runs over all horizontal patches that intersect with ?i.\n\nStep 3 - Vertical patch problems: For each vertical interface ?i j define a patch ?Vi j that encloses\nthe interface, formed by a collection of fine grid elements of ?i and ? j and solve:??????\n\n?????\nui j,Vh = ?K ?p\n\ni j,V\nh in ?\n\nV\ni j\n\n?\u00b7ui j,Vh = f in ?\nV\ni j\n\nui j,Vh \u00b7ni j =\n\n{\nu?ih \u00b7ni j if x ? ?i\nu? jh \u00b7ni j if x ? ? j\n\non ? ?Vi j\n\n, (4.32)\n\nStep 4 - Stitch vertical solutions: For each subdomain ?i, take:\n\nu?ih\n.\n= u?ih in ?i??\n\nV\nik,\n\nu?ih\n.\n= ui j,Vh in ??i ??\n\nV\nik,\n?k (4.33)\n\n\n\n108\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nwhere index k runs over all vertical patches that intersect with ?i. After steps 1-4 we end up\nwith a velocity field u?ih which is mass-conserving on the fine grid and continuous at subdomain\ninterfaces. The extension to three dimensions is straightforward.\n\nIn the second aforementioned situation of non-overlapping patches the computation can\nbe done all at once, i.e., in a first step all patches are solved simultaneously and, in a second step,\nthe solutions are stitched in order to produce a mass-conserving global solution. This last case\nhas not been implemented and its assessment is left for future works.\n\nThis method is perhaps the most attractive one in regards to computational cost, since it\ndoes not require solution of the subdomain problems, but only resolution of local small patch\nproblems around the interfaces.\n\n4.4 Numerical set-up\n\nIn order to compare the downscaling schemes under the same conditions we consider\nthe transport of a passive tracer in highly heterogeneous permeability fields K(x). Two types\nof absolute permeability fields are considered here, the first being the log-normal, K(x) =\nexp(? ? (x)), in which ? (x) is a Gaussian field and ? a constant value chosen that controls the\ncontrast, i.e., Kmax/Kmin. Here, ? (x) is characterized by its mean value \u00b5? and an exponential\nanisotropic covariance function given by\n\nC? (r) = ?\n2\n?\n\ne(?r),\n\nwhere ?? is a constant variance and r =\n?\n\nr21/Ix + r\n2\n2/Iy with Ix and Iy being correlation lengths\n\nand r1 and r2 the two-point separation distance in longitudinal and transverse direction, respec-\ntively. To generate these log-conductivity fields we have used the Hydro-Gen package (BELLIN;\nRUBIN, 1996). The second type considered are the layers of the SPE10 project that is highly\nheterogeneous and presents channelized structures.\n\nIn all the numerical experiments the domain is a 2D region ? = [0,Lx]\u00d7[0,Ly]. For the\nDarcy problem no-flow boundary conditions are considered at y = 0 and y = Ly and inflow-\noutflow boundary conditions are imposed at x = 0 and x = Lx, respectively.\n\nFor the MRCM we have considered piecewise polynomial functions both for the pressure\nspace PH and for the flux space UH . In fact, we use elementwise constant fine grid representation\nof polynomials over the interface elements\n\nUH = {VH, VH|e = ?0(q),q ?PkU?1(e), e ? TH},\n\nPH = {MH, MH|e = ?0(q),q ?PkP?1(e), e ? TH},\n\nwhere Pl , is the space of polynomials of degree ? l and ?0 is the L2\u2013projection of a function Pl(e)\nonto the space Fh(e), e ? TH . In the numerical results section the experiments are performed\n\n\n\n4.5. Numerical Results 109\n\nby choosing a total number of degrees of freedom per interface k = kU + kP. Although not\nmandatory, this number will be the same for all interfaces. Also, for simplicity, the number of\nfine grid elements per interface N f is chosen to be the same for all interfaces. In such case the\norder reduction obtained by our multiscale method is simply computed as 100\u00d7(N f ?k)/N f .\n\nFor the transport problem we assume a water saturated field (C (x,t0) = 0,x ? ?) with a\npassive tracer injected on x = 0 at time t = t0, carried by the flow for t > t0. In order to solve the\ntransport equation a classical upwind scheme combined with a TVD Runge-Kutta of second order\nin time is adopted for discretization. Let us provide some details about the scheme. Given the fine\ngrid partition Th of ?, a cell-centered finite volume scheme is considered for the concentration\nunknowns. For each fine grid element of Th, Vi, i = 1,...,m, the discrete concentration field Ch\nsatisfies\n\nd\ndt\n\n?\nVi\n\nCh dV =? ?\nE??Vi\n\n?\nE\nCh|E u?h \u00b7? dS, (4.34)\n\nwhere u?h is the postprocessed multiscale velocity field, which is already given at the edges of\nVi and ? is the outer normal to ?Vi. As mentioned, for the edge concentration Ch|E the upwind\nvalue is taken. This leads to the semi-discrete system\n\nd\ndt\n\nC = F (C),\n\nwhere C ? Rm and Ci = 1|Vi|\n?\n\nVi\nCh dV . Applying a TVD Runge-Kutta scheme of second order\n\n((GOTTLIEB; SHU, 1998)) a fully-discrete system is obtained. Defining the time step ? t, the\nunknown vector at time level n + 1 is obtained from\n\nC(n+1) =\n1\n2\n\nCn +\n1\n2\n\nC*+\n1\n2\n\n? t F (C*), (4.35)\n\nwhere\nC* = Cn + ? t F (Cn). (4.36)\n\n4.5 Numerical Results\nWe begin this section by assessing the coupling between the multiscale solution of the\n\nMRCM and the postprocessing schemes. Two types of domain decomposition are considered in\ncombination with different interface spaces. These results allow us to define the MRCM parame-\nters and evaluate the error produced by increasing the size of the patches in the postprocessing\nschemes. Based on these results, we choose a patch size and repeat the previous experiment for a\ncollection of permeability fields with the same covariance function as well as for permeability\nfields taken from the SPE10 project. From these we obtain some metrics for the error of the\nschemes. Finally, we evaluate the error and the convergence order of downscaling schemes\ncoupled with the MMMFEM, the MHM, and the MRCM with enriched interface spaces for\npermeability fields with and without channel structures.\n\n\n\n110\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nIn this section the downscaling methods are assessed in terms of the L2(?) relative error\nnorm of the tracer concentration, defined as\n\nEc(t?) =\n?Cmsc(x, t?)?C f ine(x, t?)?L2(?)\n\n?C f ine(x, t?)?L2(?)\n,\n\nin which Cmsc(x,t) is the result obtained by using the postprocessed flux multiscale solution and\nC f ine(x,t) is the result obtained by using the fine grid flux solution.\n\n4.5.1 First approach\n\nWe start by considering a domain ? with dimensions Lx = Ly = 1 and square fine\nelements of size h = 1/120. For the absolute permeability field K(x) = exp(? ? (x)), we set ? (x)\nwith Ix = 5\u00d7h, Iy = 12\u00d7h, \u00b5? = 0 and ?? = 1 and take ? = 2, leading to a contrast of order\nKmax/Kmin ? 106. The domain is decomposed into 4\u00d74 and 8\u00d78 square subdomains of size\nH = 30h and H = 15h, respectively. For the interface spaces we have considered k = 2,3,4.\nTable 2 displays the order reduction obtained by the multiscale method for the above cases.\n\n# of dof\u2019s per interface k\n2 3 4\n\n4\u00d74 93.3% 90.0% 86.7%\n8\u00d78 86.7% 80.0% 73.3%\n\nTable 2 \u2013 Order reduction for the multiscale solutions of the first numerical experiment.\n\nSource: Elaborated by the author.\n\nThe degrees of freedom (dof \u2019s) are distributed in the possible combinations such that\nkP + kU = k and the patches\u2019 thicknesses are taken as two fine elements in the downscaling\nschemes. The transport equation is solved with ? t = 10?5, that satisfies a CF L condition for all\nthe problems considered here, from t0 = 0 to tMAX = 1. Figure 38 displays the concentration\ntransported by the fine solution and the concentration transported by the multiscale solution with\nk = 2 and the downscaling schemes at time t = 0.5 for the 4\u00d74 decomposition. The relative\nerrors from t0 to tMAX are shown in Figure 39. One can note in the considered cases that the\nPatch scheme consistently has the smallest errors when compared to the other two schemes.\nAlso, the Stitch scheme presents larger errors when the multiscale method has kP = kU = 1 for\nthe 4\u00d74 domain decomposition and kU > kP and presents similar errors to the Mean scheme in\nall other cases.\n\nFrom our experience, the precision of the postprocessing schemes depends on the\naccuracy of the multiscale solution. With this observed we set the MRCM with kP = kU = 2\nand a 4\u00d74 domain decomposition, where the schemes have similar errors and the multiscale\nsolution has a reduced computational cost, to further assess the downscaling schemes.\n\nNow we evaluate the impact of the patch thickness on the error of the Patch and Stitch\nschemes. We take the problem defined above and increase the thickness from 2 fine elements to\n\n\n\n4.5. Numerical Results 111\n\nFine Sol.\n\nMsc. Sol.\n+ Patch\n\nMsc. Sol.\n+ Mean\n\nMsc. Sol.\n+ Stitch\n\nSource: Elaborated by the author.\n\nFigure 38 \u2013 Concentration at time t = 0.5 for the fine solution and multiscale solution with k = 2.\n\n10 fine elements. Results are shown in Figure 40. Larger patches lead to smaller errors in both\nschemes, but the gain in accuracy is not significant after about 6 fine elements. To keep the patch\nproblems small relative to the subdomain problems, we set patches with 4 elements.\n\nFigure 41 displays the relative error of the flux field for the multiscale solution and the\nrelative errors after the postprocessing schemes. As is well known, multiscale methods based on\nnon-overlapping domain decomposition have larger errors at the interfaces between subdomains,\nwhere the coupling is done through low order spaces, as shown in the left top of Figure 41.\nFrom this experiment we observed that the Mean scheme, despite generating a continuous field,\nmaintains existing errors at the interfaces. The scenario is different for the Patch and Stitch\nschemes, in which the patches include information from within the subdomains. The errors are\ngreatly reduced at the interfaces and only remain concentrated at the corners of the domain\ndecomposition.\n\n\n\n112\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nSource: Elaborated by the author.\n\nFigure 39 \u2013 Relative concentration errors for k = 2,3,4 and two domain decomposition: 4\u00d74 (left column)\nand 8\u00d78 (right column) for the downscaling schemes, the Mean (red line), the Patch (green\nline) and the Stitch (blue line).\n\n\n\n4.5. Numerical Results 113\n\nSource: Elaborated by the author.\n\nFigure 40 \u2013 Relative errors of the Patch (left) and the Stitch (right) for different patch sizes and the relative\nerror of the Mean scheme (red line).\n\nMsc. Sol.\n\nMsc. Sol.\n+ Patch\n\nMsc. Sol.\n+ Mean\n\nMsc. Sol.\n+ Stitch\n\nSource: Elaborated by the author.\n\nFigure 41 \u2013 Relative velocity field error to the maximum absolute velocity value of the fine solution w/o\ndownscaling.\n\n\n\n114\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\n4.5.2 Robustness\n\nTo check the robustness of the downscaling schemes we generate new log-conductivity\nfields, ? j(x), j = 1,...,100, with the same properties described in the last section for different\nseeds, thus generating fields with similar structures distributed in spatially distinct patterns. With\nthat we define new permeability fields K j(x), also taking ? = 2 and redo the last experiment\nfrom the previous section for each j = 1,...,100. In Figure 42 we show some examples of these\nfields. Figure 43 displays the mean error of all these simulations for each time t as well as the\n\nSource: Elaborated by the author.\n\nFigure 42 \u2013 Examples of permeability fields generated by the log-conductivity functions with different\nseeds.\n\nmaximum and minimum errors and the maximum standard deviation over all the time steps.\n\nThe Patch scheme still displays smaller errors than the other two schemes for all error\nmeasures. Similar errors in average for the Stitch and the Mean schemes are observed, although\nthe Stitch has larger maximum errors and a standard deviation almost 1.5 times larger than the\nother schemes.\n\n\n\n4.5. Numerical Results 115\n\nSource: Elaborated by the author.\n\nFigure 43 \u2013 Relative mean error \u00b5 at each time t for the permeability fields K j(x), j = 1,...,100, and\nthe maximum standard deviation ? over t. Shaded area denotes the maximum and minimum\nerror region.\n\nFor the next numerical experiment we take 2D layers of the SPE10 project (CHRISTIE;\nBLUNT, 2001) as permeability fields in a rectangular domain with dimensions Lx = 11/3\nand Ly = 1. There are 85 highly heterogeneous layers in the SPE10 project. Layers 1 to 35\nhave structures similar to those of the fields previously explored and layers 36 to 85 have high\ncorrelation channels that pose realistic challenges and are commonly used for the evaluation\nof numerical methods in oil reservoir simulation. In Figure 44 we show two examples of these\nlayers, with and without channel structures.\n\nThese fields are defined in a fine mesh with 220\u00d760 elements. For the multiscale method\nthe domain is decomposed into 11\u00d73 subdomains, each one with a fine mesh of 20\u00d720 square\nelements of size h = 1/60. In this case the order reduction of the multiscale method is 80%.\nFigure 45 shows the solution of the transport equation at the breakthrough time for the fine\n\n\n\n116\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nSource: Elaborated by the author.\n\nFigure 44 \u2013 Examples of permeability fields from SPE10 project: layer 20 (top) and layer 36 (bottom).\n\nsolution and for the multiscale solution with the Stitch scheme. Figure 46 shows the maximum\nrelative error among all time steps, to to tMAX for each layer.\n\nBy looking at the concentration error it is easy to note the transition from layers without\nchannels, where errors stay between 5% and 10%, to layers with channels, where errors range\nfrom 10% to 30%, as displayed in Figure 46. For the downscaling schemes, the Patch shows the\nsmallest errors and the Stitch provides intermediate errors between the Patch and Mean for all\nlayers, although the errors for layers with channelized structures are similar. In Table 3 we show\nthe mean error and the standard deviation for the cases with and without channels.\n\nLayers ? 35 Layers ? 36\n\u00b5 ? \u00b5 ?\n\nPatch 0.0330 0.0104 0.1245 0.0479\nStitch 0.0488 0.0137 0.1438 0.0486\nMean 0.0855 0.0170 0.1958 0.0467\n\nTable 3 \u2013 Mean \u00b5 errors and the standard deviation ? of the SPE10 layers.\n\nSource: Elaborated by the author.\n\n\n\n4.5. Numerical Results 117\n\nSource: Elaborated by the author.\n\nFigure 45 \u2013 Concentrations at breakthrough time for the fine solution (top) and the multiscale solution\nwith k = 4 and the Stitch scheme (bottom) for layer 36.\n\nSource: Elaborated by the author.\n\nFigure 46 \u2013 Maximum relative error over t of the downscaling schemes, the Mean (red line), the Patch\n(green line) and the Stitch (blue line) for all layers of the SPE10 project. The dashed line\nindicates where the layers with channels begins.\n\n4.5.3 Comparison of multiscale methods\n\nAs mentioned earlier, the MRCM generalizes a family of multiscale methods and among\nthem are the MMMFEM (? = 0) and the MHM (? ?+?). Taking advantage of this fact, we now\ncompare the concentration errors of the postprocessing schemes when combined with the above\nmultiscale methods for a collection of k values. From these results we will estimate a convergence\n\n\n\n118\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\norder of the schemes when combined with these multiscale methods. Although the MHM\nmultiscale solution has naturally a continuous flux field without the need of a postprocessing\nscheme, we apply them in order to assess whether there is an improvement in terms of accuracy.\nNote that the Mean scheme does not change the MHM multiscale solution.\n\nFor the MRCM, we choose to keep the equidistribution of degrees of freedom between\npressure and flux interface spaces, i.e., if we take k = 4, both pressure and flux interface spaces\nhave linear functions per interface. On the other hand, the MMMFEM and the MHM with\nk = 4 are defined with cubic functions by interfaces in the pressure interface space and in the\nflux interface space, respectively. The experiment is performed using two types of permeability\nfields. For the first we use ? (x) with ? = 2 to define the permeability field K(x) = exp(? ? (x))\nin ? = [0,1]\u00d7 [0,1] decomposed into 8\u00d78 subdomains, each subdomain with a fine mesh of\n15\u00d715 square elements of size h = 1/120. For the second type we take layer 36 of the SPE10\nproject and use the same configuration as the last experiment of the previous section. Figure\n47 shows the maximum concentration error over time from k = 2 until k = 10 for the above\npermeability fields. Table 4 displays the order reduction obtained by the multiscale methods.\n\n# of dof\u2019s per interface k\n2 4 6 8 10\n\nLog-normal 86.7% 73.3% 60.0% 46.7% 33.3%\nLayer 36 90.0% 80.0% 70.0% 60.0% 50.0%\n\nTable 4 \u2013 Order reduction obtained by the multiscale method by enriching the interface spaces.\n\nFor the log-normal field (left column on Fig.47) the smallest errors are obtained by\nthe MMMFEM with all the downscaling schemes followed by the MRCM, with similar errors\nfor k = 2 in all multiscale methods. In this type of permeability field the MMMFEM shows a\nquadratic convergence order when combined with the Patch and Stitch schemes that drops to 1.5\nwhen combined with the Mean scheme. On the other hand, the MRCM shows a 1.5 convergence\norder when combined with the Patch and Stitch schemes that drops to linear when combined\nwith the Mean scheme and the MHM shows a convergence order of 0.5 when combined with all\nthe downscaling schemes.\n\nFor layer 36 (right column of Fig.47) the MMMFEM shows a quadratic numerical\nconvergence when combined with the Patch scheme, that drops to 1.5 with the Stitch scheme\nand again drops to 0.5 when combined with the Mean scheme. The convergence order for the\nMRCM drops to 0.5 in combination with all the downscaling schemes, the same convergence\norder obtained for the MHM. A summary of convergence orders are depicted in Table 5.\n\n4.6 Concluding remarks\nWe have started by recalling the main ingredients and implementation aspects of the\n\nrecently proposed Multiscale Robin Coupled Method (MRCM). After that, we have proposed\n\n\n\n4.6. Concluding remarks 119\n\nSource: Elaborated by the author.\n\nFigure 47 \u2013 Maximum relative errors over time t of the MRCM, MMMFEM and MHM for the log-normal\nfield (left column) and the Layer 36 (right column) for enriched interface spaces.\n\ntwo postprocessing methods to recover mass-conserving velocity fields from multiscale solutions\nthat are only conservative in coarse scales. The new methods were compared with a standard\nmethod of the literature in terms of accuracy of the transport of contaminant in subsurface.\nTwo types of very heterogeneous permeability fields were considered, the ones generated with\nthe Hydro-Gen package and the fields given by the SPE10 project. Initially, the comparison\nwas carried out with solutions produced by the MRCM with a set of predefined parameters.\nThereafter, by suitable choices of the parameter ? , we have compared the performance of the\npostprocessing procedures with solutions produced by the MMMFEM, the MRCM and the\nMHM with the same order reduction.\n\nThe numerical results indicate that the Patch method consistently has the smallest errors,\n\n\n\n120\nChapter 4. Velocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant\n\ntransport in subsurface flows\n\nLog-normal Layer 36\nPatch Stitch Mean Patch Stitch Mean\n\nMRCM O(k?1.5) O(k?1.5) O(k?1.0) O(k?0.5) O(k?0.5) O(k?0.5)\nMMMFEM O(k?2) O(k?2.0) O(k?1.5) O(k?2.0) O(k?1.5) O(k?0.5)\n\nMHM O(k?0.5) O(k?0.5) O(k?0.5) O(k?0.5) O(k?0.5) O(k?0.5)\nTable 5 \u2013 Convergence order on concentration for the multiscale methods in two types of permeability\n\nfields.\n\nSource: Elaborated by the author.\n\nfollowed by the Stitch method (which is the least expensive of the three) and then the Mean\nmethod. These results were very robust for the two types of permeability fields considered.\nFurthermore, the new methods have reduced the velocity error at subdomain interfaces of the\nmultiscale approximations, a task not accomplished by the Mean method.\n\nCombining the Patch method with the MMMFEM proved to be the most accurate proce-\ndure in channelized fields, although significant differences in accuracy with other postprocessing\nschemes were only attained for multiscale solutions with order reduction less than or equal to\n65%. In the more interesting cases with order reduction above 75% the Stitch method provides\ncomparable accuracy and thus provides the best compromise between computational cost and\nprecision.\n\n\n\n121\n\nCHAPTER\n\n5\nMAIN RESULTS AND FUTURE WORK\n\nIn this section the main result obtained are summarized and future works are discussed.\n\n5.1 Main contributions\nThe main contributions of this project can be summarized as:\n\n? A new multiscale mixed method was proposed, the Multiscale Robin Coupled Method for\nsubsurface flows.\n\n\u2013 Formal well-posedness is proved;\n\n\u2013 Provides a variational formulation for the Two-Lagrange-Multiplier domain decom-\nposition method;\n\n\u2013 Allows for independent choices for interface spaces;\n\n\u2013 Generalize existing multiscale methods of the literature;\n\n\u2013 First assessment of the MHM with H(div) subelement grid discretization;\n\n\u2013 Suitable choice of the parameter ? produces more accurate results when compared\nto existing methods in realistic high-channelized porous formations.\n\n? The accuracy of the MRCM is assessed for two types of interface spaces: piecewise\npolynomial and informed spaces.\n\n\u2013 Provides a strategy to build-up the informed spaces;\n\n\u2013 Show improved local approximations for fluxes in channelized formations;\n\n\u2013 First comparison of the MMMFEM, MRCM and MHM in terms of accuracy with\npolynomial and informed spaces;\n\n\u2013 First assessment of the MHM with informed spaces;\n\n\n\n122 Chapter 5. Main results and future work\n\n\u2013 Fully defines the parameters of the MRCM (? ,PH,UH ) given a multiscale reduction,\nk dof \u2019s in this case, leading to a competitive method when compared to similar\nmethods of the literature.\n\n\u2013 MRCM shows less iterations of GMRES to attain a given tolerance when compared\nto the MMMFEM and the MHM.\n\n? Two new strategies to recover local mass conservation of multiscale solution that are only\nconservative on coarse scales were proposed and compared with a standard method of the\nliterature in terms of accuracy in contaminant transport.\n\n\u2013 New methods reduce the flux error between subdomains of the multiscale approxi-\nmations;\n\n\u2013 Improved precision compared to the Mean method with similar/reduced computa-\ntional cost.\n\n5.1.1 Future work\n\nRecently, in (GUIRALDELLO et al., 2018b) and (GUIRALDELLO et al., 2018a), an\nexhaustive assessment of the MRCM has been presented. However, several improvements are\nstill under investigation, some of them we intend to address in a postdoc project. The main topics\nwe are concerned are: (i) improved choices of interface spaces; (ii) extension of the method to a\nmultilevel/multigrid context so as to accelerate convergence of iterative methods; (iii) 3D HPC\nimplementation of the MRCM. In what follows we provide an overview of what we intend to\nsurvey and some of the expected results.\n\n5.1.1.1 New informed spaces - LOD\n\nIn the original implementation of the MRCM (see (GUIRALDELLO et al., 2018b)), we\nhave considered piecewise polynomial spaces over the skeleton ? of the domain decomposition,\nboth for pressure PH and flux UH . This choice is standard for a first exploration of a multiscale\nmethod, since it allows rigorous analysis. For highly heterogeneous media an alternative are\ninformed spaces, in which fine-mesh solutions are precomputed at some neighborhood (oversam-\npling) of the subdomain and/or the interface between subdomains. From these solution, some\ndimensionality reduction technique is applied to build PH and UH . The MRCM with informed\nspaces was first explored in (GUIRALDELLO et al., 2018a).\n\nWe intend to study and establish new strategies for the construction of informed spaces\nby exploring new regions of oversampling, new strategies to compute the offline spaces and basis\nreduction methods, seeking for accuracy improvements for the 2D case and possibly extending\nto 3D.\n\n\n\n5.1. Main contributions 123\n\nThe informed spaces described above are constructed in an offline stage. Recently in the\nliterature the concept of online spaces has been explored (CHUNG; EFENDIEV; LEUNG, 2018)\nwhere the informed spaces are constructed from multiscale solutions of low computational cost,\nso as to include global information as boundary condition in the oversampling problem. This in\nturn leads to procedures that allow to enrich the interface spaces iteratively.\n\n5.1.1.2 A Multilevel MRCM\n\nThe size of the interface linear system involved in the MRCM depends on the dimensions\nof the coarse interface spaces UH and PH . A reasonable multiscale approximation to the true\n(fine grid) solution can be obtained by suitably choosing the interface spaces to be of sufficiently\nlarge dimension (see (ARBOGAST; XIAO, 2015)). In the three dimensional case this may end up\nleading to a linear system of intermediate size whose resolution still requires an efficient linear\nsolver. Available linear algebra packages, generally provides several preconditioned Krylov\nbased iterative methods that can be used for such purpose.\n\nWe intend to explore other alternatives that have the potential to solve the problem more\nefficiently, namely\n\n(i) Multilevel/Multigrid linear solvers based on successive refinements/coarsening of the\ninterface spaces UH and PH ;\n\n(ii) Use of the MRCM as a preconditioner of the fine grid problem into a Krylov based iterative\nsolver.\n\n5.1.1.3 3D HPC implementation\n\nIn (GUIRALDELLO et al., 2018b) and (GUIRALDELLO et al., 2018a) the implementa-\ntion has been restricted to the two dimensional case. An important point is the extension of these\nmethods to three-dimensional case into a high-performance environment aiming to solve large\nsize reservoirs, containing up to 1 billion computational cells, so as to deal with the unusual thick\nBrazil\u2019s reservoirs in the pre-salt layer and capture the severe heterogeneity of the permeability\nfield.\n\n\n\n\n\n125\n\nBIBLIOGRAPHY\n\nAARNES, J. E. On the Use of a Mixed Multiscale Finite Element Method for Greater Flexibility\nand Increased Speed or Improved Accuracy in Reservoir Simulation. SIAM Multiscale Model.\nSimul., v. 2, n. 3, p. 421\u2013439, 2006. Citation on page 27.\n\nARAYA, R.; HARDER, C.; PAREDES, D.; VALENTIN, F. Multiscale hybrid-mixed method.\nSIAM J. Numer. Anal., v. 51, n. 6, p. 3505\u20133531, 2013. Citations on pages 31, 37, and 70.\n\nARBOGAST, T. Analysis of a Two-scale, Locally Conservative Subgrid Upscaling for Elliptic\nProblems. SIAM J. Numer. Anal., v. 42, p. 576\u2013598, 2004. Citation on page 28.\n\nARBOGAST, T.; COWSAR, L. C.; WHEELER, M. F.; YOTOV, I. Mixed finite element methods\non nonmatching multiblock grids. SIAM J. Numer. Anal., v. 37, n. 4, p. 1295\u20131315, 2000.\nCitations on pages 31, 32, 39, 43, 50, and 55.\n\nARBOGAST, T.; PENCHEVA, G.; WHEELER, M. F.; YOTOV, I. A multiscale mortar mixed\nfinite element method. SIAM Multiscale Model. Simul., v. 6, n. 1, p. 319\u2013346, 2007. Citations\non pages 28, 30, 32, 36, 55, 70, and 95.\n\nARBOGAST, T.; WHEELER, M. F.; YOTOV, I. Mixed finite elements for elliptic problems\nwith tensor coefficients as cell-centered finite differences. SIAM J. Numer. Anal., v. 34, n. 2, p.\n828\u2013852, 1997. Citations on pages 31, 32, 45, 46, and 98.\n\nARBOGAST, T.; XIAO, H. Two-level mortar domain decomposition preconditioners for het-\nerogeneous elliptic problems. Computer Methods in Applied Mechanics and Engineer-\ning, v. 292, p. 221 \u2013 242, 2015. ISSN 0045-7825. Special Issue on Advances in Simula-\ntions of Subsurface Flow and Transport (Honoring Professor Mary F. Wheeler). Available:\n<http://www.sciencedirect.com/science/article/pii/S0045782514004198>. Citation on page 123.\n\nBABUSKA, I.; OSBORN, E. Generalized finite element methods: Their performance and their\nrelation to mixed methods. SIAM J. Numer. Anal., v. 31, p. 510\u2013536, 1983. Citations on pages\n27 and 71.\n\nBARANGER, J.; MAITRE, J.-F. c.; OUDIN, F. Connection between finite volume and mixed\nfinite element methods. ESAIM: Mathematical Modelling and Numerical Analysis - Mod\u00e9li-\nsation Math\u00e9matique et Analyse Num\u00e9rique, Dunod, v. 30, n. 4, p. 445\u2013465, 1996. Available:\n<http://www.numdam.org/item/M2AN_1996__30_4_445_0>. Citations on pages 31 and 32.\n\nBELGACEM, F. The mortar finite element method with Lagrange multipliers. Numer. Math.,\nv. 84, n. 2, p. 173\u2013197, 1999. Citations on pages 31, 37, and 43.\n\nBELLIN, A.; RUBIN, Y. Hydro_gen: A spatially distributed random field generator for correlated\nproperties. Stochastic Hydrology and Hydraulics, v. 10, n. 4, p. 253\u2013278, Nov 1996. ISSN\n1435-151X. Available:&lt;https://doi.org/10.1007/BF01581869>. Citation on page 108.\n\nBERNARDI, C.; MADAY, Y.; PATERA, A. T. A new nonconforming approach to domain\ndecomposition: The mortar element method. In: Nonlinear Partial Differential Equations\n\nhttp://www.sciencedirect.com/science/article/pii/S0045782514004198\nhttp://www.numdam.org/item/M2AN_1996__30_4_445_0\nhttps://doi.org/10.1007/BF01581869\n\n\n126 Bibliography\n\nand their Applications. Coll\u00e8ge de France Seminar, volume XI. Lectures presented at the\nweekly seminar on applied mathematics, Paris, France, 1989-1991. [S.l.]: Harlow: Longman\nScientific &amp; Technical; New York: John Wiley &amp; Sons, Inc., 1994. p. 13\u201351. ISBN 0-582-23800-\n5/pbk; 0-470-23367-2/pbk. Citations on pages 31 and 37.\n\nBLANCO, P.; LEIVA, J.; BUSCAGLIA, G. C. A black-box decomposition approach for coupling\nheterogeneous components in hemodynamics simulations. Int. J. Numer. Method. Biomed.\nEng., John Wiley &amp; Sons, Ltd, v. 29, n. 3, p. 408\u2013427, 2013. ISSN 2040-7947. Available:\n<http://dx.doi.org/10.1002/cnm.2519>. Citation on page 40.\n\nBOSMA, S.; HAJIBEYGI, H.; TENE, M.; TCHELEPI, H. Multiscale finite volume method\nfor discrete fracture modeling on unstructured grids (MS-DFM). Journal of Computational\nPhysics, v. 351, p. 145 \u2013 164, 2017. ISSN 0021-9991. Available:&lt;http://www.sciencedirect.\ncom/science/article/pii/S0021999117306927>. Citations on pages 28 and 71.\n\nBREZZI, F.; DOUGLAS, J.; DUR\u00c1N, R.; FORTIN, M. Mixed finite elements for second order\nelliptic problems in three variables. Numerische Mathematik, v. 51, n. 2, p. 237\u2013250, 1987.\nISSN 0945-3245. Available:&lt;http://dx.doi.org/10.1007/BF01396752>. Citation on page 31.\n\nBREZZI, F.; DOUGLAS, J.; FORTIN, M.; MARINI, L. D. Efficient rectangular mixed finite\nelements in two and three space variables. ESAIM: Mathematical Modelling and Numerical\nAnalysis - Mod\u00e9lisation Math\u00e9matique et Analyse Num\u00e9rique, Dunod, v. 21, n. 4, p. 581\u2013\n604, 1987. Available:&lt;http://eudml.org/doc/193515>. Citation on page 31.\n\nBREZZI, F.; DOUGLAS, J.; MARINI, L. D. Two families of mixed finite elements for second\norder elliptic problems. Numer. Math., v. 47, p. 217\u2013236, 1985. Citations on pages 31 and 37.\n\nBREZZI, F.; FORTIN, M. Mixed and Hybrid Finite Elements Methods. Springer-Verlag,\n1991. (Springer series in computational mathematics). ISBN 9780387975825. Available:&lt;https:\n//books.google.com.br/books?id=yYwZAQAAIAAJ>. Citation on page 31.\n\nCALO, V. M.; EFENDIEV, Y.; GALVIS, J.; GHOMMEM, M. Multiscale empirical interpolation\nfor solving nonlinear pdes using generalized multiscale finite element methods. arXiv preprint\narXiv:1407.0103v1, 2014. Citation on page 72.\n\nCALO, V. M.; EFENDIEV, Y.; GALVIS, J.; LI, G. Randomized oversampling for generalized\nmultiscale finite element methods. SIAM Multiscale Model. Simul., v. 14, n. 1, p. 482\u2013501,\n2016. Citations on pages 72 and 77.\n\nCHAVENT, G.; JAFFR\u00c9, J. Mathematical Models and Finite Elements for Reservoir Simu-\nlation - Single phase, Multiphase and Multicomponent Flows through Porous Media. [S.l.]:\nNorth-Holland, 1986. (Studies in Mathematics and its Applications). Citations on pages 26, 31,\nand 32.\n\nCHEN, W.; GUNZBURGER, M.; HUA, F.; WANG, X. A Parallel Robin-Robin Domain Decom-\nposition Method for the Stokes-Darcy System. SIAM J. Numer. Anal., v. 49, n. 3, p. 1064\u20131084,\n2011. Citation on page 30.\n\nCHEN, Z. Finite Element Methods and Their Applications. Springer Berlin Heidelberg,\n2005. (Scientific Computation). ISBN 9783540240785. Available:&lt;https://books.google.com.\nbr/books?id=DEGlOJ1KZOwC>. Citation on page 26.\n\nhttp://dx.doi.org/10.1002/cnm.2519\nhttp://www.sciencedirect.com/science/article/pii/ S0021999117306927\nhttp://www.sciencedirect.com/science/article/pii/ S0021999117306927\nhttp://dx.doi.org/10.1007/BF01396752\nhttp://eudml.org/doc/193515\nhttps://books.google.com.br/books?id=yYwZAQAAIAAJ\nhttps://books.google.com.br/books?id=yYwZAQAAIAAJ\nhttps://books.google.com.br/books?id=DEGlOJ1KZOwC\nhttps://books.google.com.br/books?id=DEGlOJ1KZOwC\n\n\nBibliography 127\n\n. Mathematical Techniques in Oil Recovery. [S.l.]: Siam, 2007. (Reservoir Simulation).\nCitation on page 26.\n\nCHEN, Z.; HOU, T. Y. A Mixed Multiscale Finite Element Method for Elliptic Problems with\nOscillating Coefficients. Math. Comp, v. 72, p. 541\u2013576, 2003. Citation on page 28.\n\nCHEN, Z.; HUAN, G.; MA, Y. Computational Methods for Multiphase Flows in Porous\nMedia. [S.l.]: Computational Science &amp; Engineering. Society for Industrial and Applied Mathe-\nmatics (SIAM), Philadelphia, PA, 2006. Citation on page 26.\n\nCHRISTIE, M.; BLUNT, M. Tenth SPE comparative solution project: A comparison of upscaling\ntechniques. SPE-66599-MS,Society of Petroleum Engineers, 2001. Citations on pages 58, 77,\nand 115.\n\nCHUNG, E. T.; EFENDIEV, Y.; HOU, T. Adaptive multiscale model reduction with generalized\nmultiscale finite element methods. J. Comp. Phys., v. 320, p. 69\u201395, 2016. Citation on page 71.\n\nCHUNG, E. T.; EFENDIEV, Y.; LEUNG, W. T. Fast online generalized multiscale finite element\nmethod using constraint energy minimization. Journal of Computational Physics, v. 355, p.\n450 \u2013 463, 2018. ISSN 0021-9991. Available:&lt;http://www.sciencedirect.com/science/article/pii/\nS0021999117308604>. Citations on pages 71 and 123.\n\nCHUNG, E. T.; FU, S.; YANG, Y. An enriched multiscale mortar space for high contrast flow\nproblems. arXiv preprint arXiv:1609.02610, 2016. Citations on pages 44 and 71.\n\nCORREA, M.; LOULA, A. F. D. Stabilized velocity post-processings for Darcy flow in hetero-\ngeneous porous media. Commun. Numer. Methods Eng., John Wiley &amp; Sons, Ltd., v. 23, n. 6,\np. 461\u2013489, 2007. ISSN 1099-0887. Available:&lt;http://dx.doi.org/10.1002/cnm.904>. Citation\non page 37.\n\nCOUSSY, O. Mechanics and Physics of Porous Solids. [S.l.]: Wiley, 2010. ISBN 978-0-470-\n72135-3. Citation on page 26.\n\nCOWSAR, L. C.; WHEELER, M. F. Parallel Domain Decomposition Method for Mixed Finite\nElements for Elliptic Partial Differential Equations. Fourth International Symposium on\nDomain decomposition methods for partial differential equations, Philadelphia, PA, p. 358\u2013\n372, 1991. Citation on page 30.\n\nDOUGLAS, J.; PAES-LEME, P. J.; ROBERTS, J.; WANG, J. P. A parallel iterative procedure\naplicable to the approximate solution of second order partial differential equations by mixed\nfinite element methods. Numer. Math., v. 65, n. 1, p. 95\u2013108, 1993. Citations on pages 31, 37,\n38, 42, 70, and 94.\n\nDURLOFSKY, L. J.; GERRITSEN, M. G. Modeling Fluid Flow in Oil Reservoirs. Annu. Rev.\nFluid Mech, v. 37, n. 37, p. 211\u2013238, 2006. Citation on page 26.\n\nEFENDIEV, Y.; HOU, T. Multiscale Finite Element Methods. Theory and Applications.\n[S.l.]: Springer, 2008. Citation on page 26.\n\nEYMARD, R.; GALLOU\u00cbT, T.; HERBIN, R. Finite Volume Methods. [S.l.]: Elsevier Science\nB.V., Amsterdam, 2000. 713-1020 p. (Handbook of Numerical Analysis, 7). Citations on pages\n31 and 32.\n\nhttp://www.sciencedirect.com/science/article/pii/ S0021999117308604\nhttp://www.sciencedirect.com/science/article/pii/ S0021999117308604\nhttp://dx.doi.org/10.1002/cnm.904\n\n\n128 Bibliography\n\nFRANCISCO, A.; GINTING, V.; PEREIRA, F.; RIGELO, J. Design and implementation of a\nmultiscale mixed method based on a nonoverlapping domain decomposition procedure. Math.\nComput. Simul., v. 99, p. 125\u2013138, 2014. Citations on pages 31, 37, 49, 58, 62, 70, 74, and 94.\n\nGANIS, B.; YOTOV, I. Implementation of a mortar mixed finite element method using a\nmultiscale flux basis. Comput. Methods Appl. Mech. Engrg., v. 198, p. 3989\u20133998, 2009.\nCitations on pages 30, 43, 44, 48, and 73.\n\nGELHAR, L. W. Flow and Transport in Porous Formations. [S.l.]: Springer, New York, 1989.\nCitation on page 25.\n\n. Stochastic Subsurface Hydrology. [S.l.]: Prentice-Hall, Englewood Cliffs, NJ, 1993.\nCitation on page 25.\n\nGINTING, V.; PEREIRA, F.; RAHUNANTHAN, A. A Prefetching Technique for Prediction of\nPorous Media Flows. Computa. Geosci., v. 18, n. 5, p. 661\u2013675, 2014. Citation on page 25.\n\nGLOWINSKI, R.; WHEELER, M. F. Domain decomposition and mixed finite element methods\nfor elliptic problems. First international symposium on domain decomposition methods for\npartial differential equations, p. 144\u2013172, 1988. Citations on pages 30, 33, 39, and 43.\n\nGOTTLIEB, S.; SHU, C.-W. Total variation diminishing runge-kutta schemes. Math. Comput.,\nAmerican Mathematical Society, Boston, MA, USA, v. 67, n. 221, p. 73\u201385, Jan. 1998. ISSN\n0025-5718. Available:&lt;http://dx.doi.org/10.1090/S0025-5718-98-00913-2>. Citation on page\n109.\n\nGUIRALDELLO, R. T.; AUSAS, R. F.; SOUSA, F. S.; PEREIRA, F.; BUSCAGLIA, G. C.\nInterface spaces for the multiscale Robin coupled method in reservoir simulation. Math. Comput.\nSimul., 2018. Citations on pages 33, 94, 95, 98, 100, 122, and 123.\n\n. The multiscale Robin coupled method for flows in porous media. J. Comput. Phys.,\nv. 355, p. 1\u201321, 2018. Citations on pages 31, 33, 70, 73, 74, 78, 83, 94, 95, 98, 100, 102, 122,\nand 123.\n\nHAJIBEYGI, H.; BONFIGLI, G.; HESSE, M. A.; JENNY, P. Iterative multiscale finite-volume\nmethod. Journal of Computational Physics, v. 227, n. 19, p. 8604 \u2013 8621, 2008. ISSN 0021-\n9991. Available:&lt;http://www.sciencedirect.com/science/article/pii/S002199910800332X>. Ci-\ntation on page 71.\n\nHAJIBEYGI, H.; TCHELEPI, H. A. Compositional Multiscale Finite-Volume Formulation.\nSociety of Petroleum Engineers, v. 19, n. 2. Citations on pages 28 and 71.\n\nHARDER, C.; PAREDES, D.; VALENTIN, F. A family of multiscale hybrid-mixed finite element\nmethods for the Darcy equation with rough coefficients. J. Comput. Phys., v. 245, p. 107 \u2013 130,\n2013. Citations on pages 31, 37, 43, 49, 50, 55, and 95.\n\n. On a multiscale hybrid-mixed method for advective-reactive dominated problems with\nheterogeneous coefficients. SIAM Multiscale Model. Simul., v. 13, n. 2, p. 491\u2013518, 2015.\nCitation on page 70.\n\nHOU, T. Y.; WU, X. H. A Multiscale Finite Element Method for Elliptic Problems in Composite\nMaterials and Porous Media. J. Comput. Phys., v. 134, p. 169\u2013189, 1997. Citations on pages\n26 and 27.\n\nhttp://dx.doi.org/10.1090/S0025-5718-98-00913-2\nhttp://www.sciencedirect.com/science/article/pii/ S002199910800332X\n\n\nBibliography 129\n\nHUGHES, T. Multiscale Phenomena: Green\u2019s Functions, the Dirichlet-to-Neumann Formulation,\nSubgrid Scale Models, Bubbles and the Origins of Stabilized Methods. Comput. Methods Appl.\nMech. Engrg., v. 127, p. 387\u2013401, 1995. Citation on page 28.\n\nHUGHES, T.; FEIJOO, G.; MAZZEI, L.; QUINCY, J. The Variational Multiscale Method - A\nParadigm for Computational Mechanics. Comput. Methods Appl. Mech. Engrg., v. 166, p.\n3\u201324, 1998. Citation on page 28.\n\nJENNY, P.; LEE, S. H.; TCHELEPI, H. A. Multi-scale finite-volume method for elliptic problems\nin subsurface flow simulation. J. Comput. Phys., v. 187, p. 47\u201367, 2003. Citations on pages 28,\n37, and 71.\n\nKIPPE, V.; AARNES, J. E.; LIE, K. A Comparison of Multiscale Methods for Elliptic Problems\nin Porous Media Flow. Comput Geosci., v. 12, n. 3, p. 377\u2013398, 2008. Citation on page 28.\n\nK\u00f6NN\u00f6, J.; SCHOETZAU, D.; STENBERG, R. Mixed finite element methods for problems with\nRobin boundary conditions. SIAM J. Numerical Analysis, v. 49, p. 285\u2013308, 2011. Citation\non page 27.\n\nLAW, K.; STUART, A.; ZYGALAKIS, K. Data Assimilation: A Mathematical Introduction.\n[S.l.]: Springer. (Texts in Applied Mathematics, 62). Citation on page 25.\n\nLEE, S. H.; ZHOU, H.; TCHELEPI, H. A. Adaptive multiscale finite-volume method for non-\nlinear multiphase transport in heterogeneous formations. Journal of Computational Physics,\nv. 228, n. 24, p. 9036 \u2013 9058, 2009. ISSN 0021-9991. Available:&lt;http://www.sciencedirect.com/\nscience/article/pii/S002199910900494X>. Citations on pages 28 and 71.\n\nLEIVA, J.; BLANCO, P.; BUSCAGLIA, G. C. Iterative strong coupling of dimensionally\nheterogeneous models. Int. J. Numer. Methods Eng., John Wiley &amp; Sons, Ltd., v. 81, n. 12, p.\n1558\u20131580, 2010. ISSN 1097-0207. Available:&lt;http://dx.doi.org/10.1002/nme.2741>. Citation\non page 40.\n\nLIONS, P. L. On the schwars alternating method iii: A variant for nonoverlapping subdomains.\nIn: . Third International Symposium on Domain Decomposition Methods for Partial\nDifferential Equations. Society for Industrial and Applied Mathematics, 1990. (Domain de-\ncomposition methods - international symposium), chap. 11, p. 202\u2013223. ISBN 9780898712537.\nAvailable:&lt;https://books.google.com.br/books?id=_GJ1DXrAyJ8C>. Citation on page 30.\n\nLOISEL, S. Condition number estimates for the nonoverlapping optimized Schwarz method and\nthe 2-Lagrange multiplier method for general domains and cross points. SIAM J. Numer. Anal.,\nv. 51, n. 6, p. 3062\u20133083, 2013. Citations on pages 31, 38, and 42.\n\nLOISEL, S.; NGUYEN, H.; SCHEICHL, R. Optimized Schwarz and 2-Lagrange multiplier\nmethods for multiscale elliptic PDEs. SIAM J. Sci. Comput., v. 37, n. 6, p. A2896\u2013A2923,\n2015. Citation on page 42.\n\nLUNATI, I.; JENNY, P. Multiscale finite-volume method for compressible multiphase flow\nin porous media. Journal of Computational Physics, v. 216, n. 2, p. 616 \u2013 636, 2006. ISSN\n0021-9991. Available:&lt;http://www.sciencedirect.com/science/article/pii/S0021999106000039>.\nCitations on pages 28 and 71.\n\nMADAY, Y.; MAGOUL\u00c8S, F. Absorbing interface conditions for domain decomposition meth-\nods: A general presentation. Comput. Methods Appl. Mech. Engrg., v. 195, p. 3880\u20133900,\n2006. Citation on page 42.\n\nhttp://www.sciencedirect.com/science/article/pii/ S002199910900494X\nhttp://www.sciencedirect.com/science/article/pii/ S002199910900494X\nhttp://dx.doi.org/10.1002/nme.2741\nhttps://books.google.com.br/books?id=_GJ1DXrAyJ8C\nhttp://www.sciencedirect.com/science/article/pii/ S0021999106000039\n\n\n130 Bibliography\n\nMATHEW, T. Domain Decomposition Methods for the Numerical Solution of Partial Differ-\nential Equations. Springer Berlin Heidelberg, 2008. (Lecture Notes in Computational Science\nand Engineering). ISBN 9783540772095. Available:&lt;https://books.google.com.br/books?id=\n9n9PTTvimG4C>. Citation on page 29.\n\nNEDELEC, J. C. Mixed finite elements in r3. Numerische Mathematik, v. 35, n. 3, p. 315\u2013341,\n1980. ISSN 0945-3245. Available:&lt;http://dx.doi.org/10.1007/BF01396415>. Citation on page\n31.\n\nQUARTERONI, A.; VALLI, A. Domain Decomposition Methods for Partial Differential\nEquations. [S.l.]: Clarendon press - Oxford, 1999. Citations on pages 29 and 31.\n\nRAVIART, P. A.; THOMAS, J. M. A mixed finite element method for 2nd order elliptic problems.\nIn: Mathematical Aspects of the Finite Elements Method. [S.l.]: Springer, Berlin, 1977,\n(Lecture Notes in Mathematics, 606). p. 292\u2013315. Citations on pages 31 and 37.\n\nROBERTS, J. E.; THOMAS, J. M. Mixed and hybrid methods. In: CIARLET, P.; LIONS, J.\n(Ed.). Handbook of Numerical Analysis, Vol. II. [S.l.]: North-Holland, Amsterdam, 1991. p.\n523\u2013639. Citation on page 31.\n\nRUSSEL, T. F.; WHEELER, M. F. Chapter II: Finite Element an Finite Difference Methods\nfor Continuous Flows in Porous Media. [S.l.]: SIAM, 1983. (The Mathematics of Reservoir\nSimulation). Citations on pages 31 and 32.\n\nSILVA, R. C. C.; LOULA, A. F. D. Local residual error estimator and adaptive finite element\nanalysis of poisson problems. Comput. Struct., v. 80, p. 2027 \u2013 2034, 2002. ISSN 0045-7949.\nAvailable:&lt;http://www.sciencedirect.com/science/article/pii/S0045794902002602>. Citation\non page 37.\n\nSMITH, R. C. Uncertainty Quantification: Theory, Implementation, and Applications.\n[S.l.]: Siam, 2013. (Computational Science and Engineering). ISBN 978-1611973211. Ci-\ntation on page 25.\n\nTRANGENSTEIN, J. A.; BELL, J. B. Mathematical Structure of Compositional Reservoir\nSimulation. SIAM J. Appl. Math., v. 10, n. 5, p. 817\u2013845, 1989. Citation on page 26.\n\n. Mathematical Structure of the Black Oil Model for Petroleum Reservoir Simulation. SIAM\nJ. Appl. Math., v. 49, n. 3, p. 749\u2013783, 1989. Citation on page 26.\n\nVOHRAL\u00cdK, M. Equivalence between lowest order mixed finite element and multipoint finite\nvolume methods on simplicial meshes. ESAIM, v. 40, n. 2, 2006. Citations on pages 31, 32,\nand 46.\n\nZHANG, D.; LU, Z. An Efficient, High-order Perturbation Approach for Flow in Random Porous\nMedia via Karhunen-Lo\u00e9ve and Polynomial Expansions. J. Comput. Phys., v. 194, p. 773\u2013794,\n2004. Citation on page 25.\n\nhttps://books.google.com.br/books?id=9n9PTTvimG4C\nhttps://books.google.com.br/books?id=9n9PTTvimG4C\nhttp://dx.doi.org/10.1007/BF01396415\nhttp://www.sciencedirect.com/science/article/pii/ S0045794902002602\n\n\nU\nN\n\nIV\nER\n\nSI\nD\n\nA\nD\n\nE \nD\n\nE \nS\u00c3\n\nO\n P\n\nA\nU\n\nLO\nIn\n\nst\nit\n\nu\nto\n\n d\ne \n\nC\ni\u00ea\n\nn\nci\n\nas\n M\n\nat\nem\n\n\u00e1t\nic\n\nas\n e\n\n d\ne \n\nC\no\n\nm\np\n\nu\nta\n\n\u00e7\u00e3\no\n\n\n\tTitle page\n\tTitle page\n\tDedication\n\tAcknowledgements\n\tEpigraph\n\tResumo\n\tAbstract\n\tList of Figures\n\tList of Tables\n\tList of abbreviations and acronyms\n\tContents\n\tIntroduction\n\tThe Darcy flow problem\n\tMultiscale methods\n\tDomain decomposition schemes \n\tFine mesh discretization schemes\n\tA multiscale method\n\n\tOutline\n\n\tThe Multiscale Robin Coupled Method for flows in porous media\n\tIntroduction\n\tNumerical scheme\n\tThe domain decomposition formulation\n\tThe multiscale formulation\n\tThe multiscale implementation\n\tMultiscale basis functions and the interface linear system\n\n\n\tNumerical experiments\n\tThe quarter of a 5-spot - Relation between methods\n\tProblem with a manufactured solution - Convergence assessment\n\tThe importance of the Robin condition parameter\n\n\tConcluding remarks\n\n\tInformed Spaces for the Multiscale Robin Coupled method in reservoir simulation\n\tIntroduction\n\tThe Multiscale Robin Coupled Method\n\tDiscrete variational formulation\n\n\tInterface spaces: Polynomial and informed\n\tNumerical experiments\n\tThe characteristic length scale\n\tComparison of multiscale mixed methods\n\n\tConcluding remarks\n\n\tVelocity postprocessing schemes for the Multiscale Robin Coupled method for contaminant transport in subsurface flows\n\tIntroduction\n\tThe Multiscale Robin Coupled method\n\tThe velocity postprocessing schemes\n\tThe Patch method\n\tThe Stitch method\n\n\tNumerical set-up\n\tNumerical Results\n\tFirst approach\n\tRobustness\n\tComparison of multiscale methods\n\n\tConcluding remarks\n\n\tMain results and future work\n\tMain contributions\n\tFuture work\n\tNew informed spaces - LOD\n\tA Multilevel MRCM\n\t3D HPC implementation\n\n\n\n\tBibliography"}]}}}