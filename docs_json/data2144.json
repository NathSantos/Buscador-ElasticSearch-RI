{"add": {"doc": {"field": [{"@name": "docid", "#text": "BR-TU.05935"}, {"@name": "filename", "#text": "10403_2009000592.pdf"}, {"@name": "filetype", "#text": "PDF"}, {"@name": "text", "#text": "Ricardo \u00c2ngelo dos Santos Filipe\nUniversidade de Aveiro Departamento de_______________________\n2008\tElectr\u00f3nica, Telecomunica\u00e7\u00f5es e Inform\u00e1tica\nTeleopera\u00e7\u00e3o de um ve\u00edculo da Eco-Maratona\n2008\nUniversidade de Aveiro Departamento de\nElectr\u00f3nica, Telecomunica\u00e7\u00f5es e Inform\u00e1tica\nRicardo \u00c2ngelo dos Santos Filipe (a28521@ua.pt)\nTeleopera\u00e7\u00e3o de um ve\u00edculo da Eco-Maratona\nDisserta\u00e7\u00e3o apresentada \u00e0 Universidade de Aveiro para cumprimento dos requisitos necess\u00e1rios \u00e0 obten\u00e7\u00e3o do grau de Mestre em Engenharia Electr\u00f3nica e Telecomunica\u00e7\u00f5es, realizada sob a orienta\u00e7\u00e3o cient\u00edfica do Dr. Bernardo Cunha, Professor do Departamento de Electr\u00f3nica, Telecomunica\u00e7\u00f5es e Inform\u00e1tica da Universidade de Aveiro.\nEste trabalho \u00e9 dedicado a todos aqueles que fizeram e fazem parte da minha vida e que, de uma forma ou de outra, contribu\u00edram para me transformar naquilo que hoje sou.\no j\u00fari\npresidente\tDoutor Jo\u00e3o Nuno Pimentel da Silva Matos Professor Associado da Universidade de Aveiro\nVogais\tDoutor Manuel Bernardo Salvador Cunha (Orientador) Professor Auxiliar da Universidade de Aveiro Doutor Artur Jos\u00e9 Carneiro Pereira (Co-Orientador) Professor Auxiliar da Universidade de Aveiro Doutor Carlos Baptista Cardeira Professor Auxiliar do Departamento de Engenharia Mec\u00e2nica do Instituto Superior T\u00e9cnico da Universidade T\u00e9cnica de Lisboa\nagradecimentos\tAgrade\u00e7o a todas as pessoas envolvidas, at\u00e9 \u00e0 data, no projecto ICARO por tudo o que desenvolveram e ajudaram a construir. De um ponto de vista mais particular, os meus sinceros agradecimentos aos Professores Bernardo Cunha e Manuel Violas, aos Engenheiros Nuno Ferreira, Daniel Castanheira, David Ribeiro e Andr\u00e9 Neto pelo incans\u00e1vel apoio, disponibilidade e ajuda nas diversas \u00e1reas abrangidas por este disserta\u00e7\u00e3o.\npalavras-chave\tSistemas electr\u00f3nicos, monitoriza\u00e7\u00e3o, controlo, teleopera\u00e7\u00e3o e telemetria.\nresumo\tO ICARO \u00e9 um projecto pluridisciplinar da Universidade de Aveiro, que ao enquadrar trabalhos de \u00e1reas t\u00e3o diversas como mec\u00e2nica, sistemas de informa\u00e7\u00e3o e inform\u00e1tica, permitem a participa\u00e7\u00e3o anual de uma equipa da universidade na prova Eco-Maratona Shell que decorre, este ano, em Nogaro, Fran\u00e7a. O trabalho desenvolvido em anos subsequentes j\u00e1 permitiu acumular um know-how consider\u00e1vel, nomeadamente acerca do modelo arquitectural e funcional dos elementos base, inerentes \u00e0 monitoriza\u00e7\u00e3o e controlo do ve\u00edculo. No que diz respeito a esta tese em particular, desenvolveram-se os m\u00f3dulos Vis\u00e3o Remota, Monitoriza\u00e7\u00e3o e Suporte ao condutor, bem como algumas altera\u00e7\u00f5es nos m\u00f3dulos Volante e Controlo/GatewayPalm, al\u00e9m da cria\u00e7\u00e3o dos setups finais para coloca\u00e7\u00e3o no ve\u00edculo, quando em condu\u00e7\u00e3o remota, para controlo da direc\u00e7\u00e3o e trav\u00e3o. Relativamente ao m\u00f3dulo Vis\u00e3o Remota, este \u00e9 constitu\u00eddo por uma mini c\u00e2mara a cores, bem como todo o sistema de amplifica\u00e7\u00e3o e transmiss\u00e3o do sinal, realizado atrav\u00e9s de uma conex\u00e3o RF na banda de UHF no emissor (instalado no ve\u00edculo) e um receptor de TV (instalado nas boxes da pista). De forma a obter uma eficaz monitoriza\u00e7\u00e3o e suporte ao condutor foi criado um programa de software e instalado num palmtop/PDA. A electr\u00f3nica de suporte que lhe est\u00e1 associada ir\u00e1 permitir a transfer\u00eancia da informa\u00e7\u00e3o do ve\u00edculo e do volante para o palmtop/PDA.\nkeywords\tElectronic systems, monitoring, control, teleoperation, telemetry.\nabstract\tICARO is a multidisciplinary project from University of Aveiro, incorporating works from areas such as mechanics, electronics, information systems and computing. The main objective is the annual participation from a team of our university in the Eco-Marathon Shell competition which is held in France. The work developed in the previous years already permitted to accumulate a considerable know-how about the architectural and functional model of the fundamental elements constituents of the monitoring and control systems of the vehicle. In this thesis in particular we present the details related to the development of a set of modules for remote vision, monitorization and support to the driver, as also some changes in the steering wheel module and Control/GatewayPalm module and the creation of the final setups to be included in the vehicle, while in remote driving mode, for control of direction and brake. In what concerns to the remote vision, consists of the mini cam , as well of all the amplification ad transmission system of the signal, with a RF link in the band of UHF (in the vehicle) and the TV receptor (in the boxes). The module of monitorization and support to the driver via Palmtop/PDA has been created by developing the software installed in palmtop/PDA and the electronics associated with the transmission of data from the vehicle and steering wheel to palmtop/PDA.\nConte\u00fado\nIntrodu\u00e7\u00e3o ao Sistema...................................................................7\nArquitectura geral do sistema (ICARO) / estado de arte [1]............................7\nArquitectura proposta no ano anterior para o desenvolvimento do sistema de condu\u00e7\u00e3o remota\ne de condu\u00e7\u00e3o normal..................................................................9\nCap\u00edtulo 2.............................................................................13\nDesenvolvimento de um sistema de vis\u00e3o remota que permita acompanhar a prova a partir do exterior do ve\u00edculo....................................................................13\nIntrodu\u00e7\u00e3o...........................................................................13\nPr\u00e9-requisitos....................................................................13\nSistema do ano transacto..........................................................15\nConsidera\u00e7\u00f5es te\u00f3ricas com novo modelo de radia\u00e7\u00e3o...................................15\nSistema Actual.......................................................................17\nSistema de emiss\u00e3o................................................................17\nResultados Finais....................................................................28\nSistema de Recep\u00e7\u00e3o...............................................................29\nConclus\u00f5es...........................................................................30\nCap\u00edtulo 3.............................................................................31\nAltera\u00e7\u00f5es efectuadas no volante.......................................................31\nIntrodu\u00e7\u00e3o...........................................................................31\nAltera\u00e7\u00f5es efectuadas - causas:......................................................32\nC\u00e1lculo da acelera\u00e7\u00e3o:............................................................32\nCria\u00e7\u00e3o do m\u00f3dulo Girosc\u00f3pio:.....................................................32\nAltera\u00e7\u00e3o na taxa de amostragem...................................................36\nAltera\u00e7\u00e3o no monitor ICARO........................................................37\nAltera\u00e7\u00e3o na tabela das prioridades [1]:..........................................37\nAltera\u00e7\u00e3o do comando - activa\u00e7\u00e3o de controlo remoto...............................38\nConclus\u00f5es...........................................................................38\nCap\u00edtulo 4.............................................................................39\nProjecto e desenvolvimento de um sistema de actua\u00e7\u00e3o controlado por um microcontrolador capaz de conduzir e travar o ve\u00edculo...................................................39\nIntrodu\u00e7\u00e3o ao sistema................................................................39\nTrav\u00e3o...............................................................................40\nAltera\u00e7\u00f5es no c\u00f3digo.................................................................44\nConclus\u00f5es...........................................................................45\nCap\u00edtulo 5.............................................................................47\nSoftware de suporte em palmtop/PDA para arquivo local de informa\u00e7\u00e3o e disponibiliza\u00e7\u00e3o de\ndados cr\u00edticos ao piloto...............................................................47\nIntrodu\u00e7\u00e3o te\u00f3rica...................................................................47\nTecnologias de Suporte \u00e0 comunica\u00e7\u00e3o...............................................47\nSistema anterior - PalmOS..........................................................48\nConstitui\u00e7\u00e3o das tramas existentes\tnas redes sem fios...........................49\nArquitectura do sistema..............................................................50\nPiconet - palmtop/PDA como master,\tvolante e m\u00f3dulo de controlo slaves.............51\nPiconet - M\u00f3dulo de controlo master,\tpalmtop/PDA e volante slave...................52\nScatternet - Volante Master - PDA\tslave e PDA Master-MC slave......................53\nMudan\u00e7a da topologia da rede.........................................................54\nPrograma Final do palmtop/PDA........................................................55\nAspectos gerais....................................................................55\nLiga\u00e7\u00e3o Bluetooth e obten\u00e7\u00e3o dos valores para posterior processamento..............56\nProcessamento das tramas...........................................................57\nProcessamento dos dados............................................................58\nAspectos do programa principal.....................................................58\nConclus\u00f5es.........................................................................66\nCap\u00edtulo 6.............................................................................67\nM\u00f3dulo GatewayPalm.....................................................................67\nAspectos Gerais......................................................................67\nIntrodu\u00e7\u00e3o te\u00f3rica...................................................................67\nRede CAN...........................................................................67\nGatewayPalm - Hardware...............................................................69\nGatewayPalm - Software...............................................................69\nTestes efectuados....................................................................70\nConclus\u00f5es...........................................................................71\nCap\u00edtulo 7.............................................................................73\nConclus\u00f5es gerais......................................................................73\nRefer\u00eancias........................................................................74\nAnexo A............................................................................75\nAnexo B............................................................................77\nAnexo C............................................................................81\nIndice de Figuras\nfigura 1 - Condu\u00e7\u00e3o normal (volante\tdentro\tdo carro)\t[1]................................9\nfigura 2 - Condu\u00e7\u00e3o remota (volante\tfora do\tve\u00edculo)\t[2]................................9\nfigura 3 - Programa monitor ICARO.......................................................11\nfigura 5 - Pista de Nogaro..............................................................14\nfigura 4-Rela\u00e7\u00e3o entre a SNR e a qualidade da imagem [1]................................14\nfigura 6 - Diagrama de blocos 1- sistema emissor........................................15\nfigura 7 - Diagrama de blocos 2 - sistema emissor.......................................15\nfigura 8 - Reflex\u00f5es provocadas pelo ch\u00e3o[3]............................................15\nfigura 9 - Modelo meio livre vs modelo efeito altura das antenas........................16\nfigura 10 - Foto do modulador 2 com pico de -8 dBm e centrado em 570 Mhz................18\nfigura 11 - Antena mon\u00f3polo - do ano transacto..........................................19\nfigura 12 - Dist\u00e2ncia M2 + amplificador (IEETA na imagem)...............................20\nfigura 13 - Modulador 2 + amp. GaAs.....................................................21\nfigura 14 - Esquema do filtro passa-banda...............................................22\nfigura 15 - Simula\u00e7\u00e3o do filtro UHF.....................................................22\nfigura 16 - Filtro UHF, resultado em laborat\u00f3rio........................................23\nfigura 17 - Filtro UHF..................................................................23\nfigura 18 - Antena mon\u00f3polo simulada....................................................24\nfigura 19 - Gr\u00e1fico do mon\u00f3polo simulado................................................25\nfigura 20 -Gr\u00e1fico do monopolo real.....................................................25\nfigura 21 - Nova antena.................................................................26\nfigura 23 -Amplificador de pot\u00eancia.....................................................27\nfigura 22 - Circuito do amplificador de pot\u00eancia........................................27\nfigura 24 - Aspecto real - amplificador de pot\u00eancia.....................................28\nfigura 25 - Estado final do sistema de emiss\u00e3o..........................................28\nfigura 26 - Sistema de recep\u00e7\u00e3o.........................................................29\nfigura 27 - Aspecto geral do volante [1]................................................31\nfigura 28 - Sinal do girosc\u00f3pio a velocidade constante..................................34\nfigura 29 - Movimento realizado.........................................................35\nfigura 30 - Sinal proveniente do girosc\u00f3pio, movimento conhecido \u00e0 partida..............35\nfigura 31 - Gr\u00e1fico do Filtro FIR.......................................................36\nfigura 32 - Prioridades das liga\u00e7\u00f5es................................................... 37\nfigura 33 - PCB do m\u00f3dulo de controlo. [1]..............................................39\nfigura 34 - (a) Vista lateral\t(b) Vista Isom\u00e9trica....................40\nfigura 35 - Aspecto do trav\u00e3o na realidade..............................................41\nfigura 36 - Modelo do trav\u00e3o utilizado..................................................42\nfigura 37 - Modelo da direc\u00e7\u00e3o utilizado................................................42\nfigura 38 - Valores de varia\u00e7\u00e3o de PWM na direc\u00e7\u00e3o......................................43\nfigura 39 - Esquema da cria\u00e7\u00e3o do PWM...................................................43\nfigura 40 - Imagem do programa monitor, em PalmOS.........................................48\nfigura 41 - Liga\u00e7\u00e3o sem fios bluetooth do sistema - scatternet............................50\nfigura 42 - Programa de testes............................................................51\nfigura 43 - Cria\u00e7\u00e3o da rede...............................................................52\nfigura 44 - Arquitectura global ICARO com a nova topologia................................54\nfigura 45 - Nova topologia da rede - mais detalhada.......................................55\nfigura 46 - Monitor ICARO.................................................................56\nfigura 47 - Aspecto da recep\u00e7\u00e3o\tde dados..................................................56\nfigura 48 - M\u00e1quina de estados\t- process_data............................................57\nfigura 49 - M\u00e1quina de estados\t- extract_data............................................58\nfigura 50 - M\u00e1quina de estados\t- programa principal......................................60\nfigura 51 - Menu Principal................................................................62\nfigura 52 - Menu Configura\u00e7\u00e3o Bluetooth...................................................62\nfigura 53 - Menu Monitor/rep/ay...........................................................62\nfigura 54 - Menu Altitudes (acedido somente\tdo menu\tmonitor/replay).......................63\nfigura 55 - Pa/mtop/PDA em cima - espelho\tpara visualizar a\tinforma\u00e7\u00e3o[1].................64\nfigura 56 - Trama CAN.....................................................................68\nfigura 57 - Prioridade sobre o barramento.................................................68\n6\nCap\u00edtulo 1\nIntrodu\u00e7\u00e3o ao Sistema\nICARO \u00e9 um projecto pluridisciplinar da Universidade de Aveiro que enquadra trabalhos de diferentes \u00e1reas, nomeadamente mec\u00e2nica, electr\u00f3nica, sistemas de informa\u00e7\u00e3o e inform\u00e1tica. Tem por objectivo principal a participa\u00e7\u00e3o anual de uma equipa da universidade na prova Eco-Maratona Shell.\nO trabalho desenvolvido ao longo dos anos, permitiu acumular um conjunto de saberes variados acerca do modelo arquitectural e funcional dos elementos fundamentais constituintes do sistema de monitoriza\u00e7\u00e3o e controlo do ve\u00edculo. O volante, criado no ano anterior e (praticamente) funcional permite, ao piloto, ligar e desligar o motor, buzinar e actuar sobre o acelerador.\n\u00c9 com o intuito de contribuir para este projecto maior que se enquadra a an\u00e1lise e discuss\u00e3o do trabalho levado a cabo nesta disserta\u00e7\u00e3o.\nArquitectura geral do sistema (ICARO) / estado de arte [1]\nO ICARO assenta numa arquitectura distribu\u00edda com base numa rede CAN1. No estado de arte em que o referido projecto foi encontrado este era constitu\u00eddo por oito diferentes m\u00f3dulos:\nVolante: m\u00f3dulo de interface entre o condutor e o ve\u00edculo. Este sistema permite a condu\u00e7\u00e3o remota/n\u00e3o remota do ve\u00edculo. Possui v\u00e1rios bot\u00f5es de controlo capazes de produzir comandos, como por exemplo, ligar o motor e buzinar. A exist\u00eancia de um potenci\u00f3metro permite ao condutor indicar a velocidade desejada. De forma a saber qual o \u00e2ngulo de rota\u00e7\u00e3o que o condutor deseja imprimir na direc\u00e7\u00e3o existe um aceler\u00f3metro e um man\u00edpulo de travagem que s\u00e3o utilizados apenas em condu\u00e7\u00e3o remota.\nM\u00f3dulo de transmiss\u00e3o de vis\u00e3o remota: permite ao condutor, quando em condu\u00e7\u00e3o remota, ter uma vis\u00e3o aproximada daquela que teria se se encontrasse no interior do ve\u00edculo.\nM\u00f3dulo de controlo da direc\u00e7\u00e3o e trav\u00e3o/GatewayPalm: quando em modo de condu\u00e7\u00e3o remota, este sistema controla a direc\u00e7\u00e3o e o trav\u00e3o, servindo tamb\u00e9m de gateway de comunica\u00e7\u00e3o entre o volante e os restantes m\u00f3dulos do ve\u00edculo. A tecnologia de comunica\u00e7\u00e3o utilizada pelo volante \u00e9 o bluetooth. Em oposi\u00e7\u00e3o a esta forma de comunica\u00e7\u00e3o est\u00e3o os restantes m\u00f3dulos do ve\u00edculo, uma vez que utilizam CAN.\n1 Controller Area Network\nAl\u00e9m disso, este m\u00f3dulo \u00e9 respons\u00e1vel pelo envio, para logging no palmtop/PDA1, de toda a informa\u00e7\u00e3o existente nos m\u00f3dulos CAN, quer em condu\u00e7\u00e3o remota quer em condu\u00e7\u00e3o normal.\nGateway Boxes/Telemetria: permite que o ve\u00edculo envie informa\u00e7\u00e3o para registo nas boxes e o envio/recep\u00e7\u00e3o de comandos para a condu\u00e7\u00e3o remota deste.\nGPS: Global Positioning System.\nRoda: m\u00f3dulo no qual se realiza a leitura de um sensor que gera impulsos2, os quais permitem a determina\u00e7\u00e3o da velocidade instant\u00e2nea do veiculo e respectivas grandezas derivadas tais como a distancia percorrida.\nMotor monitor: \u00e9 o respons\u00e1vel pela aquisi\u00e7\u00e3o de valores dos sensores ligados ao motor.\nMotor control: m\u00f3dulo respons\u00e1vel pelo controlo do motor.\n1\n2\nPrograma desenvolvido este ano.\nN\u00famero de impulsos por unidade de tempo dependente da velocidade de rota\u00e7\u00e3o angular da roda.\nArquitectura proposta no ano anterior para o desenvolvimento do sistema de condu\u00e7\u00e3o remota e de condu\u00e7\u00e3o normal\nfigura 1 - Condu\u00e7\u00e3o normal (volante dentro do carro) [1].\nfigura 2 - Condu\u00e7\u00e3o remota (volante fora do ve\u00edculo) [2].\n\nTal como se pode verificar pelas figuras 1 e 2 acima apresentadas, a solu\u00e7\u00e3o proposta no ano anterior inclui dois modos de funcionamento do ve\u00edculo da EcoMaratona:\nModo de condu\u00e7\u00e3o normal: que estabelece uma liga\u00e7\u00e3o do volante para o m\u00f3dulo de controlo, servindo o Palmtop/PDA como gateway entre os 2 dispositivos. \u00c9 condi\u00e7\u00e3o essencial que o palmtop/PDA seja capaz de estabelecer e manter 2 liga\u00e7\u00f5es em simult\u00e2neo.\nA informa\u00e7\u00e3o proveniente da rede CAN \u00e9 retransmitida ficando, desta forma, assegurado o registo de dados no palmtop/PDA e no PC das boxes, atrav\u00e9s da Telemetria.\nModo de condu\u00e7\u00e3o remota\nExistem m\u00faltiplas formas de se criar a rede:\nVolante&lt;-> PDA&lt;-> m\u00f3dulo de controlo/gateway Palm\nVolante&lt;-> m\u00f3dulo de controlo/gateway Palm\nVolante&lt;-> PDA&lt;-> PC&lt;-> Telemetria\nVolante&lt;-> PC&lt;-> Telemetria\nNo primeiro caso o palmtop/PDA poder\u00e1 servir de gateway entre o volante e o m\u00f3dulo de controlo. No segundo caso, o volante liga-se directamente ao m\u00f3dulo de controlo. Em qualquer uma das op\u00e7\u00f5es apresentadas, o accionar da condu\u00e7\u00e3o remota poder\u00e1 ser despoletado perto do ve\u00edculo, desde que os dispositivos bluetooth estejam ao alcance. De forma a activar a condu\u00e7\u00e3o remota do ve\u00edculo, \u00e9 necess\u00e1rio executar um gesto pr\u00e9-determinado. Esse gesto consiste na coloca\u00e7\u00e3o do volante a 90 graus, relativamente ao tronco do piloto, colocando o volante novamente na posi\u00e7\u00e3o inicial.\nCom este gesto, os respons\u00e1veis pelo accionamento do trav\u00e3o e da direc\u00e7\u00e3o entram em funcionamento, permitindo assim o controlo correcto do ve\u00edculo.\nNo caso do volante se encontrar nas boxes e no que diz respeito ao terceiro caso, \u00e9 poss\u00edvel enviar informa\u00e7\u00e3o para o palmtop/PDA, uma vez que este ser\u00e1 o respons\u00e1vel pelo envio para o PC. Este, por sua vez, reenviar\u00e1, por telemetria, para o ve\u00edculo.\nNo \u00faltimo caso apresentado poder-se-\u00e1 enviar a informa\u00e7\u00e3o (comandos) para o PC, sendo depois enviados, por telemetria, para o ve\u00edculo.\nEm qualquer um destes 2 \u00faltimos casos, n\u00e3o \u00e9 necess\u00e1rio fazer nenhum gesto, pois os comandos prov\u00eaem do m\u00f3dulo de telemetria que despoleta automaticamente a condu\u00e7\u00e3o remota.\nO programa existente no PC das boxes e que permite enviar os comandos para o ve\u00edculo \u00e9 o programa monitor ICARO. Este possui a capacidade de receber dados da rede CAN do ve\u00edculo e de os visualizar em tempo-real ou ver posteriormente para eliminar poss\u00edveis erros do piloto, de condu\u00e7\u00e3o, entre outros. Al\u00e9m disso o programa permite\ntamb\u00e9m enviar para o ve\u00edculo os comandos de controlo, respons\u00e1veis pela condu\u00e7\u00e3o remota.\nfigura 3 - Programa monitor ICARO.\n\u00c9 de referir tamb\u00e9m que o volante, para al\u00e9m dos bot\u00f5es de controlo, cont\u00e9m tamb\u00e9m um sensor que permite determinar o \u00e2ngulo que ele pr\u00f3prio descreve, bem como a quantidade de for\u00e7a que ser\u00e1 imprimida no trav\u00e3o. Esta informa\u00e7\u00e3o ser\u00e1 apenas usada quando o ve\u00edculo se encontrar em modo de condu\u00e7\u00e3o remota.\nOs restantes m\u00f3dulos CAN comportam-se de maneira id\u00eantica em qualquer dos casos, sendo a excep\u00e7\u00e3o o m\u00f3dulo de controlo. Este m\u00f3dulo poder\u00e1 enviar a informa\u00e7\u00e3o para logging no palmtop/PDA em qualquer dos casos, desde que este esteja presente.\n\u00c9 neste contexto que se enquadra esta disserta\u00e7\u00e3o a qual tem como objectivos principais:\n\u2022\to desenvolvimento de um sistema de vis\u00e3o remoto que permita acompanhar a prova a partir do exterior do ve\u00edculo;\n\u2022\tprojecto e desenvolvimento de um sistema de actua\u00e7\u00e3o controlado por um microcontrolador capaz de conduzir e travar o ve\u00edculo;\n\u2022\to desenvolvimento de algoritmos, baseados em processamento digital de imagem, com vista \u00e0 integra\u00e7\u00e3o de mecanismos autom\u00e1ticos de suporte \u00e0 seguran\u00e7a, nomeadamente em situa\u00e7\u00f5es de falha de comunica\u00e7\u00e3o entre a box e o ve\u00edculo;\n\u2022\ta optimiza\u00e7\u00e3o do software de suporte em palmtop/PDA para arquivo local de informa\u00e7\u00e3o e disponibiliza\u00e7\u00e3o de dados cr\u00edticos ao piloto;\n12\nCap\u00edtulo 2\nDesenvolvimento de um sistema de vis\u00e3o remota que permita acompanhar a prova a partir do exterior do ve\u00edculo\nPara a teleopera\u00e7\u00e3o remota de um ve\u00edculo, \u00e9 necess\u00e1rio utilizar um sistema de vis\u00e3o remota que permita a transmiss\u00e3o, em tempo-real, de imagens para um local de controlo do ve\u00edculo.\nNeste sentido, este cap\u00edtulo pretende dar \u00eanfase ao trabalho desenvolvido nesta \u00e1rea, referindo os componentes do sistema final e evolu\u00e7\u00f5es referentes ao ano transacto, bem como os testes de campo e laborat\u00f3rio vs simula\u00e7\u00f5es, baseadas em modelos de propaga\u00e7\u00e3o de radia\u00e7\u00e3o.\nIntrodu\u00e7\u00e3o\nPr\u00e9-requisitos\nEste sistema foi desenvolvido para a EcoMaratona que, em 2008, decorre em Nogaro, Fran\u00e7a. Devido ao elevado n\u00famero de equipas participantes na prova que utilizar\u00e3o a banda industrial, scientific and medical (ISM) que se localiza no espectro de 2.400-2.500 Ghz, adoptou-se a banda Ultra High Frequency (UHF) , localizando-se esta entre os 470 e os 806 Mhz.\nCada canal [2] possui uma banda de 6 Mhz, existindo desde o canal 14 ao 69, reservado para televis\u00e3o, sendo excep\u00e7\u00e3o o canal 37 - que \u00e9 reservado para radioastronomia (608 MHz a 614 MHz). Al\u00e9m das raz\u00f5es acima mencionadas acima, existe tamb\u00e9m a possibilidade de utilizar produtos j\u00e1 existentes no mercado para esta gama de frequ\u00eancias, o que \u00e9 sempre um aspecto positivo a ter em conta.\nDevido aos aspectos topol\u00f3gicos do circuito (1.2 km de comprimento), o sistema ter\u00e1 de conseguir transmitir, no m\u00ednimo, a essa dist\u00e2ncia1 com uma qualidade de imagem aceit\u00e1vel.\nNas simula\u00e7\u00f5es efectuadas em Matlab [1] adoptou-se como SNR2 pretendido o valor de 40 dB para uma imagem com qualidade recebida nas boxes. De forma a ilustrar essas simula\u00e7\u00f5es, apresentar-se-\u00e3o, de seguida, as imagens relativas a diferentes tipos de SNR e o seu impacto na qualidade da imagem recebida.\n1\tA essa dist\u00e2ncia de raio, pois o sistema n\u00e3o poder\u00e1 ser directivo, j\u00e1 que o carro n\u00e3o se encontra fixo\n2\tSNR - Rela\u00e7\u00e3o Sinal-Ru\u00eddo.\n(a) Imagem Original.\n(b) Imagem com 40&lt;113 de SNR.\n((\u2022) Imagem com 30 (IB de SNR.\n(d) lmagem com 28 dB de SNR.\nfigura 4-Rela\u00e7\u00e3o entre a SNR e a qualidade da imagem [1].\nTodavia, o sistema receptor - as boxes, localiza-se num dos extremos da pista, sendo esse o ponto exactamente oposto ao local mais baixo da pista, apresentando um desn\u00edvel de cerca de 4 metros, em rela\u00e7\u00e3o \u00e0s boxes.\nDevido a esta barreira natural assumiu-se, ent\u00e3o, que seria necess\u00e1ria uma pot\u00eancia que conseguisse transmitir as imagens a uma dist\u00e2ncia de 3 kms1.\nfigura 5 - Pista de Nogaro.\n1 Na realidade poder\u00e1 ser necess\u00e1rio menos, mas ir-se-\u00e1 \u201capontar\u201d a meta para 3kms para worst-case.\nSistema do ano transacto\nNo ano transacto [1], no \u00e2mbito do projecto realizado obtiveram-se, para o sistema de v\u00eddeo, os esquemas a seguir apresentados. \u00c9 ainda de salientar que este sistema emissor dever\u00e1 ser instalado no ve\u00edculo.\nC\u00e2mara Pal\nModuladorl\nAntena\nfigura 6 - Diagrama de blocos 1- sistema emissor.\nC\u00e2mara Pal\nModulador2\nfigura 7 - Diagrama de blocos 2 - sistema emissor.\nNuma an\u00e1lise mais detalhada dos diagramas, o modulador2 possu\u00eda uma antena embutida e portanto o sistema final, resultava no diagrama de blocos 2, existindo uma vers\u00e3o alternativa do sistema com um modulador mais fraco (-40 dBm de pot\u00eancia de sa\u00edda) seguido de uma antena mon\u00f3polo de quarto comprimento de onda, sendo este o diagrama de blocos 1.\nContudo, o sistema nunca conseguiu ultrapassar a dist\u00e2ncia aproximada de 25 metros de alcance, da\u00ed a necessidade de reengenharia do sistema de forma a alcan\u00e7ar os 3 kms.\nO sistema de recep\u00e7\u00e3o instalado nas boxes seria, nesta configura\u00e7\u00e3o, composto por uma televis\u00e3o ou um computador, com capacidade de aquisi\u00e7\u00e3o de sinal tv, em conjunto com uma antena mon\u00f3polo de quarto de comprimento de onda.\nConsidera\u00e7\u00f5es te\u00f3ricas com novo modelo de radia\u00e7\u00e3o\nNos c\u00e1lculos te\u00f3ricos efectuados anteriormente, assumiu-se o meio como livre sem perturba\u00e7\u00f5es, o que se revelou incorrecto devido \u00e0 dist\u00e2ncia a que se encontrava, do ch\u00e3o, a antena do carro. As reflex\u00f5es provocadas pelo ch\u00e3o, causam um decaimento da qualidade do sinal vs pot\u00eancia, que n\u00e3o \u00e9 proporcional ao quadrado da dist\u00e2ncia assumida no trabalho realizado no ano anterior.\nDevido ao baixo comprimento da antena emissora, verificou-se que o modelo adoptado para c\u00e1lculo da pot\u00eancia necess\u00e1ria para o link estava errado. Foi, ent\u00e3o, necess\u00e1rio efectuar um novo c\u00e1lculo [3], [4] com um modelo que tem em considera\u00e7\u00e3o, n\u00e3o s\u00f3 a frequ\u00eancia da portadora e a dist\u00e2ncia, mas tamb\u00e9m a topografia do terreno (como sendo meio n\u00e3o livre) e a altura das antenas.\nfigura 9 - Modelo meio livre vs modelo efeito altura das antenas.\nA figura 9 representa a informa\u00e7\u00e3o de perda em fun\u00e7\u00e3o do comprimento da antena transmissora. \u00c9 ainda de referir que a antena receptora, nesta simula\u00e7\u00e3o, se manteve sempre a uma altura de 2 metros.\nNuma an\u00e1lise mais pormenorizada, verifica-se que a onda representada pela cor amarela diz respeito ao meio livre (referente \u00e0 equa\u00e7\u00e3o 2.1).\nNuma an\u00e1lise comparativa e de acordo com a figura acima apresentada, depreende-se que quer a altura das antenas do solo quer as reflex\u00f5es no terreno t\u00eam uma grande influ\u00eancia na pot\u00eancia transmitida. As arcadas s\u00e3o devido ao cancelamento da onda directa pela onde reflectida no ch\u00e3o.\nA grande diferen\u00e7a em rela\u00e7\u00e3o ao modelo de propaga\u00e7\u00e3o e radia\u00e7\u00e3o anterior \u00e9 a depend\u00eancia da pot\u00eancia transmitida com a dist\u00e2ncia de um factor de cerca de d4 - devido \u00e1 dist\u00e2ncia das antenas emissora e receptora - ao inv\u00e9s do modelo de meio livre que \u00e9 dependente de um factor de d2. Essa \u00e9 uma diferen\u00e7a significativa em rela\u00e7\u00e3o ao que inicialmente se pensava ser a pot\u00eancia necess\u00e1ria para o link de imagem.\nPrx \u2014\nPtx \u00e7 \u00e7\n4Ttd2 e'^ r\n(2.1)\nPrx \u2014\n\u00bf.[2sin(^.^)]2.PTx.G\u00a3.GR\n(2.2)\nFace a estas conclus\u00f5es, redefiniu-se a pot\u00eancia necess\u00e1ria para o link de v\u00eddeo, de forma a se obter uma rela\u00e7\u00e3o sinal ru\u00eddo de 28 dB 1, estando a antena emissora colocada a 2 metros de altura (tal como a receptora). Essa pot\u00eancia \u00e9 de aproximadamente 5 W ou cerca de 37 dBm, o que \u00e9 consideravelmente mais em rela\u00e7\u00e3o ao 1 W, valor assumido no ano anterior.\nDeste modo, com base na nova pot\u00eancia de transmiss\u00e3o e com base no esquema do ano anterior, foi necess\u00e1rio adicionar mais blocos funcionais, nomeadamente um amplificador de pot\u00eancia, filtros para elimina\u00e7\u00e3o de ru\u00eddo, bem como uma antena optimizada.\nSistema Actual\nO sistema actual, desenvolvido este ano, pode ser dividido em 2 subsistemas:\nSistema de emiss\u00e3o: que ser\u00e1 integrado no ve\u00edculo, sendo port\u00e1til e alimentado a(s) bateria(s), permitindo o envio de uma imagem aceit\u00e1vel1 2 para as boxes, por forma a permitir a condu\u00e7\u00e3o remota do ve\u00edculo.\nSistema de recep\u00e7\u00e3o: instalado nas boxes, que poder\u00e1 ser directivo e alimentado a partir da rede el\u00e9ctrica.\nSistema de emiss\u00e3o\nCaracteriza\u00e7\u00e3o do sistema anterior\nAntes da coloca\u00e7\u00e3o de um amplificador de pot\u00eancia de forma a obter os 5 W na sa\u00edda, houve necessidade de optimizar todo o sistema com o intuito de, por um lado, n\u00e3o sofrer perdas de sinal devido a imperfei\u00e7\u00f5es significativas do sistema, e por outro obter garantias da fiabilidade do mesmo. Al\u00e9m disso, como j\u00e1 foi referido anteriormente, reviram-se os c\u00e1lculos te\u00f3ricos efectuados no ano transacto, visando obter coer\u00eancia entre os resultados obtidos (no campo e no laborat\u00f3rio) e os esperados teoricamente.\nO trabalho iniciou-se pela caracteriza\u00e7\u00e3o do sistema de v\u00eddeo, desenvolvido no ano anterior, com a an\u00e1lise dos seus blocos fundamentais, quer em termos de pot\u00eancia como da sua resposta no espectro. Existiam 2 moduladores para serem caracterizados3. Relativamente a um deles foi poss\u00edvel encontrar um datasheet no qual a pot\u00eancia de sa\u00edda era referida como sendo de -40 dBm.\n1\tA pot\u00eancia necess\u00e1ria para se ter 40 dB de SNR era de cerca de 60 W devido ao decaimento r\u00e1pido da curva do modelo adoptado e assumiu-se como aceit\u00e1vel um valor de SNR=28.\n2\tVer sec\u00e7\u00e3o Pr\u00e9-requisitos.\n3\tAl\u00e9m da antena.\nfigura 10 - Foto do modulador 2 com pico de -8 dBm e centrado em 570 Mhz.\nEm rela\u00e7\u00e3o ao 2\u00b0 modulador, este possu\u00eda j\u00e1 uma antena incorporada. A an\u00e1lise do seu comportamento recorrendo a um Spectrum analyser1 indicou um pico de -11 dBm. Verificou-se tamb\u00e9m que gerava um significativo n\u00edvel de ru\u00eddo, resultando na cria\u00e7\u00e3o de r\u00e9plicas em diversas frequ\u00eancias ao longo do espectro. Por este facto, foi necess\u00e1rio, para este caso, criar-se um filtro passa-banda para UHF.\nA figura 10, embora n\u00e3o seja muito n\u00edtida, ilustra a forma de onda do sinal de UHF, ap\u00f3s modulado.\nNum momento posterior, caracterizou-se tamb\u00e9m a antena mon\u00f3polo criada no ano anterior, por forma a conhecer que frequ\u00eancias de trabalho apresentam melhor VSWR2, com vista a optimizar a maior pot\u00eancia transmitida para a sa\u00edda, maximizando assim o rendimento do sistema.\n1\tDaqui em diante, todas as refer\u00eancias feitas neste cap\u00edtulo de testes de laborat\u00f3rio dizem respeito a testes efectuados com aux\u00edlio de Spectrum analyser.\n2\tVoltage Standing Wave Ratio\nMon\u00f3polo - antena ano (06/07)\n8\nc/l\n7\n6\n5\n4\n3\n2\n1\n500\t520\t540\t560\t580\t600\t620\t640\t660\t680\t700\nFrequ\u00eancia (Mhz)\nfigura 11 - Antena mon\u00f3polo - do ano transacto.\nEsta antena apresenta algumas defici\u00eancias, entre as quais um VSWR elevado para as frequ\u00eancias de trabalho, sendo a excep\u00e7\u00e3o \u00e0 volta de 530 Mhz. Outra das particularidades desta antena \u00e9 que n\u00e3o apresenta uma curva de VSWR considerada normal para um mon\u00f3polo1 de quarto de comprimento de onda. O ideal seria um VSWR baixo, sendo os valores \u00f3ptimos entre 1 e 2 para as frequ\u00eancias que se ir\u00e3o utilizar para transmitir v\u00eddeo.\nDesta forma perde-se alguma pot\u00eancia na sa\u00edda do sistema que poderia ser transmitida.\nPr\u00e9-amplificador\nFace \u00e0 verifica\u00e7\u00e3o de que o sinal proveniente do modulador tinha amplitude insuficiente para alimentar o amplificador de pot\u00eancia do sinal do modulador, foi necess\u00e1rio colocar um andar de pr\u00e9-amplifica\u00e7\u00e3o entre estes dois dispositivos.\nNuma primeira fase, colocou-se um amplificador de recep\u00e7\u00e3o de antena comercial, com um ganho de 20 dB [5], trocando apenas a entrada de antena pela do modulador2 e a sa\u00edda para televis\u00e3o pela de antena, pois o pr\u00e9-amplificador \u00e9 rec\u00edproco. Salienta-se ainda que o amplificador era alimentado, n\u00e3o pela rede el\u00e9ctrica, mas sim a partir de uma bateria.\n1\tUm mon\u00f3polo tem uma curva de VSWR que apresenta uma concavidade em rela\u00e7\u00e3o ao eixo das frequ\u00eancias no caso do gr\u00e1fico da figura 19.\n2\tA \u00fanica altera\u00e7\u00e3o feita no modulador consistiu em retirar a antena incorporada e colocar um conector BNC f\u00eamea.\nO amplificador comercial possu\u00eda uma limita\u00e7\u00e3o em amplitude do sinal de sa\u00edda, e consequentemente, nunca se conseguiu o boost necess\u00e1rio no sinal que era esperado. Todavia, apresentam-se de seguida os resultados obtidos.\nResultados obtidos:\nEm campo [6]:\nDist\u00e2ncia (m)\nModulador 1\tModulador 2\tM1+ amp\tM2+amp\n0.5\t25\t25\t110\nfigura 12 - Dist\u00e2ncia M2 + amplificador (IEETA na imagem).\nEm laborat\u00f3rio:\nPot\u00eancia (dBm)\nM1\n-40\nM2\n-11\nM2+ amp\n-6\nEmbora no datasheet [5] refira que a sa\u00edda do sinal \u00e9 superior a 106 dBpV, verifica-se que o sistema satura. Fazendo a convers\u00e3o de dbpV para dBm, 106 dbpV equivale a uma sa\u00edda de -6 dBm, da\u00ed a passagem de -11 dBm somente para -6dBm e n\u00e3o para mais.\nDeste modo alterou-se o pr\u00e9-amplificador para um amplificador GaAs1, tendo este somente um ganho de 10 dB com banda de 0-2Ghz2. Embora com um ganho inferior, este amplificador, n\u00e3o apresenta a limita\u00e7\u00e3o na sa\u00edda evidenciada pelo amplificador comercial.\nTestes efectuados com o amplificador GaAs:\nEm laborat\u00f3rio:\nPico de pot\u00eancia de 5.4dBm a 570Mhz.\nEm campo:\nDist\u00e2ncia de cerca de 250 metros (ver figura 13).\n1\tFornecido pelo Professor Violas.\n2\tDevido \u00e0 LB do amplificador ser\u00e1 necess\u00e1rio utilizar um filtro passa-banda para UHF.\nfigura 13 - Modulador 2 + amp. GaAs.\nA simula\u00e7\u00e3o realizada em matlab com o modelo de propaga\u00e7\u00e3o seria de esperar que se conseguisse quase 400 metros de alcance, caso a pot\u00eancia \u00e0 sa\u00edda do amplificador fosse toda radiada, logo o sistema necessitaria de ser optimizado antes da coloca\u00e7\u00e3o do amplificador de pot\u00eancia. Colocou-se ent\u00e3o um filtro UHF para eliminar esporas criadas pelo modulador, e que fazem perder pot\u00eancia, e tamb\u00e9m uma antena melhorada e optimizada para as frequ\u00eancias de utiliza\u00e7\u00e3o.\nFiltro UHF\nPara eliminar as esporas que se observaram em laborat\u00f3rio, colocou-se um filtro passa-banda para UHF que, neste caso, percorre a gama de 440 - 800 Mhz. No in\u00edcio pensou-se fazer o filtro em microstrip [7]. Por\u00e9m, como as linhas s\u00e3o de \u00c0/4 e como trabalhamos num canal de UHF a 570 Mhz, as linhas teriam um comprimento de 0.52/4=0.13 m. Utilizando transformadas de kuroda para alterar a bobine, que \u00e9 um stub em s\u00e9rie, e pass\u00e1-lo para paralelo, obt\u00eam-se um comprimento do filtro de 3*0.13 ~ 39cm, se considerarmos um filtro de 1- ordem. O comprimento do filtro seria assim muito grande, tendo-se optado por componentes discretos SMD1 para o referido filtro.\n1 surface-mount devices.\nSimulou-se, em Microwave Office, o circuito seguinte:\nfigura 14 - Esquema do filtro passa-banda.\nPORT\nP=2\nZ=75Ohm\nO filtro consiste num andar em n, seguido de um andar em T, que atenuam as frequ\u00eancias abaixo de 440 Mhz e acima de 800 Mhz. Um filtro com mais andares, por forma a fazer subir a sua ordem, seria poss\u00edvel. Todavia, os resultados apresentaram-se satisfat\u00f3rios para o fim em vista, permitindo assim a exist\u00eancia de um filtro mais compacto e com menos componentes.\nObtiveram-se, assim, os seguintes resultados em simula\u00e7\u00e3o:\nfigura 15 - Simula\u00e7\u00e3o do filtro UHF.\nEm laborat\u00f3rio, ap\u00f3s a cria\u00e7\u00e3o f\u00edsica do filtro com os componentes existentes na figura 14 obtiveram-se os resultados patentes na figura 16:\nfigura 16 - Filtro UHF, resultado em laborat\u00f3rio.\nEmbora a imagem de laborat\u00f3rio n\u00e3o esteja com a resolu\u00e7\u00e3o que seria desej\u00e1vel, verificou-se que os resultados obtidos eram em muito id\u00eanticos aos da simula\u00e7\u00e3o. A banda passante vai dos 450 Mhz aos 790 Mhz, sendo as diferen\u00e7as em rela\u00e7\u00e3o ao circuito simulado resultado da imprecis\u00e3o associada aos componentes SMD. Os resultados da simula\u00e7\u00e3o vs laborat\u00f3rio s\u00e3o, contudo, muito satisfat\u00f3rios.\nSomente para efeitos de registo, apresentam-se as imagens que dizem respeito ao aspecto do filtro passa-banda.\nfigura 17 - Filtro UHF.\nAntena\nTal como foi referido anteriormente, a antena n\u00e3o se encontrava optimizada, raz\u00e3o pela qual se estava a perder pot\u00eancia que poderia ser radiada com a constru\u00e7\u00e3o de uma antena com o comprimento correcto.\nNeste sentido, foi desenvolvida uma nova antena que, numa 1- fase, foi simulada e testada em laborat\u00f3rio de modo a conseguir radiar o m\u00e1ximo de pot\u00eancia poss\u00edvel.\nA antena emissora tem de ser um mon\u00f3polo de um quarto de comprimento de onda para radiar em todas as direc\u00e7\u00f5es [6] pois o ve\u00edculo andar\u00e1 numa pista, o que n\u00e3o permite directividade.\n\t.\tr\u2014V VZZX\t\n\t\\\t\\ \u00c0\t\t\u00c0\t \\\nVZV-A\u2014\t\nfigura 18 - Antena mon\u00f3polo simulada.\nA nova antena ter\u00e1 um plano de massa e ser\u00e1 em alum\u00ednio (por ser mais f\u00e1cil de trabalhar). O fio da antena, na imagem representado a vermelho, ser\u00e1 em cobre.\nAtrav\u00e9s de uma ferramenta para simula\u00e7\u00e3o e projecto de antenas, baseada em Numerical Eletromagnetic Code (NEC)1, projectou-se assim uma antena que fosse optimizada para transmitir no canal 31, que come\u00e7a em 570 Mhz.\n1 Um agradecimento especial ao Professor Rocha Pereira pela ajuda prestada.\nOs resultados obtidos, atrav\u00e9s da simula\u00e7\u00e3o da nova antena, s\u00e3o os seguintes:\nDe acordo com diversas simula\u00e7\u00f5es efectuadas, verificou-se que quanto menor for o comprimento da antena, mais o diagrama de VSWR1 se deslocava para a direita, chegando ao valor te\u00f3rico de 12.8 cent\u00edmetros para o comprimento da antena. Tal facto \u00e9 vis\u00edvel atrav\u00e9s do gr\u00e1fico apresentado na figura 19.\nDesta forma construiu-se ent\u00e3o a antena em alum\u00ednio e, com o Spectrum Analyser, optimizou-se para os 570 Mhz, obtendo-se o seguinte diagrama de VSWR para a antena real.\n700\nFrequ\u00eancia (Mhz)\nfigura 20 -Gr\u00e1fico do monopolo real.\nX\u00c9 de notar que o VSWR vai de 1 a sendo os valores que queremos obter o mais pr\u00f3ximo de 1 para optimiza\u00e7\u00e3o.\nA antena apresenta uma boa resposta para a frequ\u00eancia pretendida, possibilitando, assim, uma maior pot\u00eancia radiada no canal 31 de UHF. \u00c9 poss\u00edvel ser utilizada tamb\u00e9m noutros canais, garantindo uma maior pot\u00eancia radiada relativamente \u00e0 anterior.\nfigura 21 - Nova antena.\nResultados auferidos nos testes de campo:\nA dist\u00e2ncia obtida \u00e9 sensivelmente a mesma que se obtinha com o modelo anterior contudo, conseguindo-se agora entre 10 e 20 metros a mais de alcance. Aponta-se como limita\u00e7\u00e3o destes testes, o local onde foram feitas as medi\u00e7\u00f5es, uma vez que, a 220 metros existem \u00e1rvores e, porventura, ve\u00edculos estacionados. Com estas condi\u00e7\u00f5es, o sinal perde-se rapidamente por\u00e9m, as diferen\u00e7as em rela\u00e7\u00e3o \u00e0 anterior s\u00e3o not\u00f3rias. Uma vez que a qualidade de imagem \u00e9 significativamente melhor, considera-se que esta antena evidencia uma maior pot\u00eancia radiada.\nNo que diz respeito \u00e0 introdu\u00e7\u00e3o do filtro, n\u00e3o se verificou nenhuma vantagem em termos de pot\u00eancia. Ainda assim, ser\u00e1 aconselh\u00e1vel a introdu\u00e7\u00e3o deste m\u00f3dulo no sistema final, pois o modulador M2 introduz bastantes esporas, em zonas do espectro que n\u00e3o queremos transmitir. Tal situa\u00e7\u00e3o ser\u00e1 minimizada pela utiliza\u00e7\u00e3o do filtro que, por sua vez, eliminar\u00e1 os harm\u00f3nicos introduzidos pelo modulador.\nAmplificador de Pot\u00eancia\nLogo que o sinal j\u00e1 se encontrava com alguma pot\u00eancia, uma vez que as esporas criadas pelo modulador tinham sido eliminadas pelo filtro e a antena apresentava um\nelevado grau de fiabilidade, este era um sistema que apresentava uma boa resposta mas com pouco alcance.\nUma vez que, teoricamente, se tinha uma boa no\u00e7\u00e3o da pot\u00eancia necess\u00e1ria para o link de v\u00eddeo com as boxes, compraram-se trans\u00edstores de pot\u00eancia de 5W [8] para colocar no final da cadeia, de forma a estabelecer uma liga\u00e7\u00e3o directa com a antena.\nO amplificador foi desenhado para a frequ\u00eancia de 500Mhz com trimmers, com o intuito de conseguir uma melhor adapta\u00e7\u00e3o da malha de entrada e de sa\u00edda, induzindo a obten\u00e7\u00e3o m\u00e1xima de pot\u00eancia de sa\u00edda.\nfigura 22 - Circuito do amplificador de pot\u00eancia.\nDe seguida, apresenta-se o layout da placa. O layout foi feito em autocad, com a ajuda de um membro do IT, Paulo Gon\u00e7alves. Foi constru\u00edda a placa dissipadora em alum\u00ednio, que servir\u00e1 tamb\u00e9m de suporte ao trans\u00edstor. Esta placa foi feita com o aux\u00edlio do professor Bernardo Cunha.\nfigura 23 -Amplificador de pot\u00eancia.\nAs imagens apresentadas em cima dizem respeito \u00e0 placa e ao negativo utilizado para o circuito impresso. Como \u00e9 poss\u00edvel observar, a placa \u00e9 cortada a meio, de forma a permitir a coloca\u00e7\u00e3o do trans\u00edstor de pot\u00eancia. Ambas as placas possuem trimmers para melhorar a adapta\u00e7\u00e3o na malha de entrada. Na parte superior das placas encontram-se as alimenta\u00e7\u00f5es do circuito.\nfigura 24 - Aspecto real - amplificador de pot\u00eancia.\nResultados Finais\nO sistema desenvolvido, n\u00e3o chegou a ser completamente implementado. No entanto, devido ao sinal disponibilizado pelo amplificador GaAs, foi necess\u00e1rio colocar um amplificador de 0.5 W1 de forma a aumentar a for\u00e7a do sinal. Al\u00e9m disso o conector utilizado na sa\u00edda do modulador foi alterado devido a n\u00e3o estar bem fixo e assim introduzir ru\u00eddo e atenuar o sinal.\nO esquema seguinte ilustra o sistema final para atingir os objectivos propostos inicialmente.\nModulador\nFiltro\nPr\u00e9-amplificador GaAs\nAmplificador\n0.5 W\nAmplificador 5W\nAntena\nfigura 25 - Estado final do sistema de emiss\u00e3o.\nO sistema de 5W n\u00e3o se conseguiu no \u00e2mbito desta tese, colocar em funcionamento, necessitando somente da integra\u00e7\u00e3o de um dissipador no amplificador e recorrer a um Spectrum Analyser para fazer os ajustes devidos com os trimmers.\nO sistema ficou portanto a funcionar at\u00e9 ao amplificador de 0.5W apresentando-se de seguida os resultados em laborat\u00f3rio do sistema.\n1 Disponibilizado pelo Professor Violas\n\tAmp. GaAs\tAmp. GaAs +amp. 0.5W\nPot\u00eancia \u00e1 entrada da antena (dBm)\t8,5\t21\nTabela 1 - Resultados em laborat\u00f3rio\nO sistema apresenta j\u00e1 um sinal elevado, embora ainda longe dos 37 dBm. Por\u00e9m a introdu\u00e7\u00e3o do amplificador de 5W no sistema elevar\u00e1 a pot\u00eancia do sinal, colocando-o perto dos 37dBm.\nSistema de Recep\u00e7\u00e3o\nAntena\nTelevis\u00e3o\nfigura 26 - Sistema de recep\u00e7\u00e3o.\nO sistema de recep\u00e7\u00e3o de imagens, localizado nas boxes, consiste numa televis\u00e3o ligada a uma antena. Esta foi alterada de mon\u00f3polo para uma antena comercial mais directiva1 e com elementos activos que permitem um maior ganho. Testes efectuados este ano e tamb\u00e9m no ano anterior mostraram que o computador introduz um atraso de cerca de meio segundo, n\u00e3o permitindo, por isso, um visionamento em tempo-real das imagens obtidas. Esta situa\u00e7\u00e3o deve-se ao processamento feito pela placa de tv externa do port\u00e1til que introduz o atraso que se verificou no visionamento.\n1 O sistema de recep\u00e7\u00e3o ser\u00e1 colocado nas boxes, podendo ser muito mais directivo que a do sistema de emiss\u00e3o.\nConclus\u00f5es\nDo ponto de vista funcional, o sistema de v\u00eddeo sofreu diversos melhoramentos, relativamente ao ano anterior. A altera\u00e7\u00e3o do diagrama de blocos funcionais e a adapta\u00e7\u00e3o do modelo de propaga\u00e7\u00e3o e radia\u00e7\u00e3o, mostrou-se mais coerente com os resultados observados experimentalmente.\nCom o novo modelo, surgiu tamb\u00e9m a necessidade de se obter uma maior pot\u00eancia na sa\u00edda em rela\u00e7\u00e3o ao que se pensava inicialmente, tornando o sistema mais complexo.\nA principal dificuldade encontrada no desenvolvimento deste sistema prende-se, essencialmente, com as informa\u00e7\u00f5es provenientes do trabalho desenvolvido no ano transacto. O volume de informa\u00e7\u00e3o, em termos de caracteriza\u00e7\u00e3o, era escasso, pelo que foi necess\u00e1ria uma melhor descri\u00e7\u00e3o do sistema anterior, bem como do actual, de forma a conseguir justificar decis\u00f5es tomadas e caminhos seguidos. Esta metodologia revela-se bastante eficaz na medida em que, se for necess\u00e1rio fazer altera\u00e7\u00f5es no sistema, poder-se-\u00e1 faz\u00ea-lo com bastante informa\u00e7\u00e3o dispon\u00edvel.\nDo ponto de vista acad\u00e9mico, foi-me poss\u00edvel clarificar as no\u00e7\u00f5es de propaga\u00e7\u00e3o e radia\u00e7\u00e3o de ondas, de cria\u00e7\u00e3o de sistemas funcionais ao n\u00edvel de antenas, filtros, pr\u00e9-amplificadores e amplificadores de pot\u00eancia, entre outros.\nEm rela\u00e7\u00e3o a trabalho futuro, falta a integra\u00e7\u00e3o do amplificador de 5W no sistema, estando este j\u00e1 criado faltando fazer os ajustes necess\u00e1rios e test\u00e1-lo no sistema de emiss\u00e3o.\nCap\u00edtulo 3\nAltera\u00e7\u00f5es efectuadas no volante\nNeste cap\u00edtulo dar-se-\u00e1 \u00eanfase \u00e0s altera\u00e7\u00f5es efectuadas no sistema volante, quer do ponto de vista funcional, de forma a melhorar a resposta do volante, quer do ponto de vista estrutural, possibilitando a sua integra\u00e7\u00e3o completa no sistema global ICARO.\nIntrodu\u00e7\u00e3o\nO volante \u00e9 constitu\u00eddo pelo m\u00f3dulo de comunica\u00e7\u00e3o e leitura dos comandos fornecidos pelo condutor e, como se verificar\u00e1 mais adiante, conter\u00e1 tamb\u00e9m o palmtop/PDA, respons\u00e1vel pelas informa\u00e7\u00f5es que ser\u00e3o fornecidas ao condutor1.\nEm ambos os modos de condu\u00e7\u00e3o, remota e normal, o sistema volante permite ao piloto ligar e desligar o motor, buzinar, actuar sobre o acelerador e o trav\u00e3o (este somente quando o sistema se encontra em modo de opera\u00e7\u00e3o remota). Da mesma forma tamb\u00e9m \u00e9 poss\u00edvel ao condutor do ve\u00edculo aceder aos v\u00e1rios ecr\u00e3s do palmtop/PDA, continuando a controlar o carro, quer no modo de condu\u00e7\u00e3o remota quer quando o volante se encontra conectado ao veio da direc\u00e7\u00e3o.\nPara al\u00e9m dos 4 bot\u00f5es do volante anteriormente referidos, \u00e9 de notar tamb\u00e9m a exist\u00eancia de um potenci\u00f3metro, respons\u00e1vel pelo fornecimento do valor da acelera\u00e7\u00e3o desejada a empregar no ve\u00edculo, bem como um sensor de carga, que accionar\u00e1 o dispositivo relativo ao trav\u00e3o, quando em condu\u00e7\u00e3o remota.\nfigura 27 - Aspecto geral do volante [1].\n1O sistema palmtop/PDA ser\u00e1 referido num cap\u00edtulo posterior, uma vez que o objecto de estudo aqui referido \u00e9 o m\u00f3dulo volante, a electr\u00f3nica e c\u00f3digo que lhe est\u00e3o associados.\nAltera\u00e7\u00f5es efectuadas - causas:\nTal como j\u00e1 foi referido anteriormente, o volante possui um aceler\u00f3metro que, ao fornecer os dados das componentes dos 3 eixos - no referencial cartesiano - permite o c\u00e1lculo do \u00e2ngulo que o volante faz em rela\u00e7\u00e3o ao veio da direc\u00e7\u00e3o. Por\u00e9m, quando aplicadas for\u00e7as horizontais e/ou verticais (e n\u00e3o em torno de um eixo), o aceler\u00f3metro fornece dados que resultam em \u00e2ngulos n\u00e3o verdadeiros.\nAbordou-se, ent\u00e3o, o problema, testando 2 possibilidades de forma a atenuar a situa\u00e7\u00e3o acima descrita. As hip\u00f3teses consideradas s\u00e3o as seguintes:\n\u2022\to c\u00e1lculo da acelera\u00e7\u00e3o grav\u00edtica, atrav\u00e9s da express\u00e3o x2+y2+z2 &lt;g2 + threshold. Caso o resultado do c\u00e1lculo do 1\u00b0 membro da express\u00e3o seja superior, relativamente ao 2\u00b0 membro, significa que se est\u00e1 a criar acelera\u00e7\u00e3o, segundo uma ou mais das componentes;\n\u2022\ta adi\u00e7\u00e3o de um m\u00f3dulo de girosc\u00f3pio no veio da direc\u00e7\u00e3o, perpendicular \u00e0 placa que cont\u00eam a electr\u00f3nica do volante. Deste modo \"validam-se\" os valores do aceler\u00f3metro, uma vez que o girosc\u00f3pio apenas fornece valores de tens\u00e3o para for\u00e7as radiais.\nC\u00e1lculo da acelera\u00e7\u00e3o:\nAdoptando como metodologia a express\u00e3o de x2 + y2 + z2 > g2 + threshold, caso se verifique esta condi\u00e7\u00e3o, mant\u00e9m-se o valor do \u00e2ngulo de direc\u00e7\u00e3o anteriormente calculado.\nO c\u00e1lculo da acelera\u00e7\u00e3o provou ser eficaz para acelera\u00e7\u00f5es elevadas, observando-se que o volante, para acelera\u00e7\u00f5es superiores a g+ threshold, mantinha o valor anterior do \u00e2ngulo de direc\u00e7\u00e3o.\nContudo, para acelera\u00e7\u00f5es muito baixas (ou mesmo nulas), segundo uma ou mais das componentes que n\u00e3o fosse o eixo de direc\u00e7\u00e3o, esta t\u00e9cnica n\u00e3o \u00e9 capaz de corrigir o problema. Tal situa\u00e7\u00e3o deve-se ao facto do deslocamento ser feito muito lentamente, n\u00e3o criando uma acelera\u00e7\u00e3o significativa em rela\u00e7\u00e3o \u00e0 que obter\u00edamos caso estivesse em repouso ou a mover-se segundo um eixo.\nCria\u00e7\u00e3o do m\u00f3dulo Girosc\u00f3pio:\nO girosc\u00f3pio \u00e9 respons\u00e1vel pelo fornecimento de valores de tens\u00e3o, proporcionais a for\u00e7as radiais. Para tal, o girosc\u00f3pio [9] teria de ser colocado segundo o eixo do veio de direc\u00e7\u00e3o, de forma a ser poss\u00edvel obter os valores mais correctos. O girosc\u00f3pio, em conjunto com o aceler\u00f3metro, permitiria alcan\u00e7ar valores bastante correctos de direc\u00e7\u00e3o - o esquema el\u00e9ctrico e o layout da placa encontram-se no anexo C.\nEm rela\u00e7\u00e3o ao c\u00f3digo [10] [11], o ganho do amplificador que se encontra em frente do girosc\u00f3pio tem o valor de 5. Tendo o girosc\u00f3pio uma sensibilidade de 0.62mV/\u00b0/s, obtem-se um ganho de 3.1 mV/\u00b0/S.\nA ADC \u00e9 de 10 bits possuindo um VDD = 5V, logo:\n1\tb\u00cdt = 1^24 ~ 4-88 Q/Sfbit\nO per\u00edodo de tempo em que vai ser executado o excerto de c\u00f3digo, referente ao girosc\u00f3pio, \u00e9 de 0.05 s, o que corresponde a 20 Hz.\nComo exemplo, observe-se:\nValor 0 corresponde a 512 da ADC do microcontrolador. Imaginemos que a ADC devolve o valor 520, ent\u00e3o:\n520 - 512 = 8 * 4.88 = 39.04\t* t = 39.04 * 0.05 = 1.95*?\nO que significa que, naquele intervalo de tempo, ocorreu uma varia\u00e7\u00e3o de 1.95 graus.\nCom base nesta metodologia criou-se, ent\u00e3o, o c\u00f3digo que serviu de base no microcontrolador. Ainda assim nunca foi poss\u00edvel obter valores satisfat\u00f3rios - com o girosc\u00f3pio - que justificassem a introdu\u00e7\u00e3o deste na vers\u00e3o final do volante.\nCom o intuito de melhor avaliar a performance do girosc\u00f3pio, fizeram-se dois testes de forma a entender o que estaria a condicionar o seu desempenho. Assim sendo:\n1\u00b0 teste\nAtrav\u00e9s de um m\u00f3dulo bluetooth1 com um girosc\u00f3pio, foi poss\u00edvel testar o funcionamento deste com velocidade constante. Para isso, colocou-se o dispositivo sem fios sobre o eixo de um motor DC, sempre alimentado \u00e0 mesma tens\u00e3o.\nOs resultados obtidos foram os seguintes:\n1 Uma palavra de apre\u00e7o ao Eng. David Ribeiro por ter fornecido o dispositivo sem fios.\nsinal inicial\nfigura 28 - Sinal do giroscopio a velocidade constante.\nAnalisando a figura 28 verifica-se que, inicialmente, o dispositivo se encontrava parado. \u00c0 posteriori, o motor foi ligado, deixando-se o dispositivo a girar em torno do eixo do motor durante algum tempo, at\u00e9 se parar o motor DC. Verifica-se, ent\u00e3o, que enquanto o motor gira sempre no mesmo sentido, o valor do integral do girosc\u00f3pio aumenta linearmente (n\u00e3o se colocou nenhuma condi\u00e7\u00e3o para quando chegasse aos 360 graus, pois o mais importante era verificar os valores fornecidos pelo girosc\u00f3pio), incrementando a vari\u00e1vel de posi\u00e7\u00e3o existente. Prova-se, assim, que o girosc\u00f3pio apresenta valores proporcionais \u00e0 velocidade.\n2\u00b0 teste\nDe seguida efectuou-se um novo teste, utilizando o volante existente e o girosc\u00f3pio criado, ligado \u00e0 electr\u00f3nica do volante. O girosc\u00f3pio estava colocado no veio da direc\u00e7\u00e3o e executou-se um movimento pr\u00e9-definido com o volante.\nEsse movimento foi executado da seguinte forma: em 1\u00b0 lugar rodou-se o volante para a direita, a 90 graus. De seguida, efectuou-se o mesmo movimento, mas para a esquerda e novamente para o centro, voltando \u00e0 posi\u00e7\u00e3o inicial. Num 3\u00b0 movimento, o volante foi rodado para a esquerda, a 90 graus e, finalmente, para a direita 90 graus, em direc\u00e7\u00e3o ao centro.\nfigura 29 - Movimento realizado.\nCom os movimentos enunciados e exemplificados com recurso \u00e0 figura 29, obtiveram-se os seguintes gr\u00e1ficos:\nsinal inicial\n0\t200\t400\t600\t800\t1000\t1200\t1400\nfigura 30 - Sinal proveniente do girosc\u00f3pio, movimento conhecido \u00e0 partida.\nO 3\u00b0 gr\u00e1fico corresponde ao sinal integrado, proveniente do girosc\u00f3pio, sendo que o 1\u00b0 gr\u00e1fico diz respeito ao sinal original. J\u00e1 o 2\u00b0 \u00e9 o resultado do sinal ap\u00f3s filtragem.\nPercebe-se claramente em que situa\u00e7\u00f5es o volante foi girado para a esquerda e para a direita. Como era de prever, existem 4 picos principais relativos \u00e0 rota\u00e7\u00e3o do volante, nos 4 movimentos exemplificados. As 2 ondas do meio apresentam caracter\u00edsticas semelhantes, tal como as dos extremos.\nEmbora, no 3\u00b0 gr\u00e1fico seja necess\u00e1rio um factor de escala, observa-se um efeito comum nestes dispositivos - o drift.\nQuando em repouso, numa determinada posi\u00e7\u00e3o, o dispositivo vai incrementando o seu valor, n\u00e3o permanecendo continuamente no mesmo s\u00edtio. Tal situa\u00e7\u00e3o \u00e9 vis\u00edvel atrav\u00e9s do 3\u00b0 gr\u00e1fico. Uma forma de minimizar este efeito \u00e9 utilizando um aceler\u00f3metro (como o existente no volante), de forma a rectificar o valor absoluto fornecido pelo girosc\u00f3pio ao final de algumas amostras, que se ache significativo.\nCom esta t\u00e9cnica, ainda assim, verifica-se que o girosc\u00f3pio continua a dar valores muito errados. Como tal, esta hip\u00f3tese ficou \"suspensa\".\n\u00c9 de notar que existem girosc\u00f3pios com melhor compensa\u00e7\u00e3o de drift, ADCs internas, bem como melhor sensibilidade do que o girosc\u00f3pio utilizado. Estes utilizam comunica\u00e7\u00e3o SPI1 para a liga\u00e7\u00e3o sendo por\u00e9m, muito mais dispendiosos.\nPor outro lado, o volante, mesmo em condu\u00e7\u00e3o remota, estar\u00e1 fixado a uma mesa, n\u00e3o permitindo, assim, efectuar os movimentos referidos anteriormente - movimentos n\u00e3o centr\u00edfugos - que originam esses erros.\nAltera\u00e7\u00e3o na taxa de amostragem\nA acelera\u00e7\u00e3o, trav\u00e3o e direc\u00e7\u00e3o eram amostrados a uma frequ\u00eancia de 20 Hz, o que, para os movimentos em quest\u00e3o, \u00e9 bastante elevado. Deste modo, reduziu-se essa amostragem, alterando os valores do filtro FIR para os 6 Hz.\nfigura 31 - Gr\u00e1fico do Filtro FIR.\n>> F=0:0.01:50;\n>> freqz (FIR1(7,3/20,'low',chebwin(7+1,20)),1,F,100)\nOs coeficientes dos filtros FIR, alterados para uma amostragem de 6 Hz, t\u00eam como consequ\u00eancia menor sensibilidade e, consequentemente, uma maior robustez a varia\u00e7\u00f5es\n1 Serial Peripheral Interface.\nm\u00ednimas na acelera\u00e7\u00e3o, travagem e direc\u00e7\u00e3o. Apesar disso, o ponto cr\u00edtico do sistema \u00e9 a direc\u00e7\u00e3o como foi verificado experimentalmente.\nAltera\u00e7\u00e3o no monitor ICARO\nO monitor ICARO \u00e9 um programa que permite monitorizar todos os sistemas do ve\u00edculo das boxes, al\u00e9m do envio de comandos para o ve\u00edculo. No referido monitor apenas se adicionou c\u00f3digo para que, ao pressionar do bot\u00e3o screen_change do volante, fosse vis\u00edvel no monitor ICARO. Assim, torna-se poss\u00edvel interagir o volante com o monitor, observando todos os bot\u00f5es do volante a funcionar.\nAltera\u00e7\u00e3o na tabela das prioridades [1]:\nNo ano transacto, o palmtop/PDA desempenhava um papel crucial na cria\u00e7\u00e3o e manuten\u00e7\u00e3o da rede, pois servia de gateway entre volante e m\u00f3dulo de controlo. Este ano, foi alterada1 essa t\u00e9cnica, visando tornar o sistema mais fi\u00e1vel e r\u00e1pido. Assim sendo, a tabela de liga\u00e7\u00e3o do volante e de prioridades foi alterada.\nDe acordo com o esquema seguinte - figura 32 - a liga\u00e7\u00e3o a amarelo diz respeito \u00e0s liga\u00e7\u00f5es sem fios e a verde \u00e0s liga\u00e7\u00f5es pelo barramento CAN.\nfigura 32 - Prioridades das liga\u00e7\u00f5es.\nComo se pode observar, as liga\u00e7\u00f5es relacionadas com envio de tramas para controlo s\u00e3o todas de alta prioridade, sendo as de monitoriza\u00e7\u00e3o e de visualiza\u00e7\u00e3o ao piloto de baixa prioridade.\n1 Num cap\u00edtulo posterior (capitulo 5) dar-se-\u00e1 mais \u00eanfase \u00e0 metodologia adoptada.\nNesta nova configura\u00e7\u00e3o, o palmtop/PDA j\u00e1 n\u00e3o desempenha um papel crucial na rede, passando apenas a ser um elemento terminal desta, n\u00e3o deixando de ser respons\u00e1vel pelo logging dos dados e a consequente visualiza\u00e7\u00e3o por parte do piloto. Quando no ve\u00edculo, o volante deixou de se ligar ao palmtop/PDA, para se ligar directamente ao m\u00f3dulo de controlo.\nAltera\u00e7\u00e3o do comando - activa\u00e7\u00e3o de controlo remoto\n\u00c9 poss\u00edvel teleoperar o ve\u00edculo e activar a condu\u00e7\u00e3o remota atrav\u00e9s de 2 formas:\n\u2022\tPerto ou dentro do veiculo;\n\u2022\tEnviando os comandos da boxe.\nO m\u00e9todo de activa\u00e7\u00e3o quando perto do ve\u00edculo consistia em colocar o volante \"deitado\", formando um \u00e2ngulo de 90 graus, em rela\u00e7\u00e3o ao tronco do piloto, colocando-se novamente na posi\u00e7\u00e3o \"normal\" de condu\u00e7\u00e3o. Esta t\u00e9cnica permitia aproveitar a coordenada Z do aceler\u00f3metro por\u00e9m, era de dif\u00edcil execu\u00e7\u00e3o, por isso a activa\u00e7\u00e3o da teleopera\u00e7\u00e3o perto do carro \u00e9, agora, poss\u00edvel pressionando o bot\u00e3o start e, de seguida, o bot\u00e3o screen, com um determinado intervalo de tempo m\u00e1ximo entre estes 2 bot\u00f5es.\nConclus\u00f5es\nO volante, embora j\u00e1 estivesse bastante funcional, apresentava alguns problemas. Como tal foi necess\u00e1rio introduzir algumas modifica\u00e7\u00f5es e/ou ajustes, visando a sua funcionalidade plena no sistema global ICARO.\nN\u00e3o foi poss\u00edvel colocar o girosc\u00f3pio totalmente operacional e, como tal, n\u00e3o foi inclu\u00eddo na vers\u00e3o do volante. Por\u00e9m, por sugest\u00e3o do Eng. David Ribeiro poder-se-\u00e1 experimentar um outro tipo de girosc\u00f3pio (ADIS16250 da Analog Device), uma vez que possui maior sensibilidade e ADC interna para o efeito pretendido.\nCap\u00edtulo 4\nProjecto e desenvolvimento de um sistema de actua\u00e7\u00e3o controlado por um microcontrolador capaz de conduzir e travar o ve\u00edculo\nNo desenvolvimento deste cap\u00edtulo ser\u00e3o analisadas as altera\u00e7\u00f5es efectuadas no sistema M\u00f3dulo de controlo. Discutir-se-\u00e1, ent\u00e3o, a integra\u00e7\u00e3o do sistema electr\u00f3nico com a mec\u00e2nica do ve\u00edculo, bem como os diferentes testes efectuados e as altera\u00e7\u00f5es na arquitectura onde se enquadra o m\u00f3dulo de controlo/GatewayPalm.\nIntrodu\u00e7\u00e3o ao sistema\nO sistema desenvolvido no estado do ano transacto, apresenta electr\u00f3nica que \u00e9 respons\u00e1vel pelo reencaminhamento da CAN para o palmtop/PDA e do reencaminhamento da informa\u00e7\u00e3o do volante para a CAN do ve\u00edculo.\nApresentava, tamb\u00e9m, a possibilidade de controlo da direc\u00e7\u00e3o e do trav\u00e3o -quando em condu\u00e7\u00e3o remota. Esse controlo era feito com o aux\u00edlio de 2 motores DC, onde era introduzida uma onda PWM na sua alimenta\u00e7\u00e3o, de forma a coloc\u00e1-los no lugar desejado, quer para a direc\u00e7\u00e3o quer para o trav\u00e3o.\nPOWER 12V\nSensor\tSensor\nTrav\u00e3o\tDirec\u00e7\u00e3o\nMotor Direc\u00e7\u00e3o\nMotor Trav\u00e3o\nCAN\nfigura 33 - PCB do m\u00f3dulo de controlo. [1]\nAnteriormente, existia uma malha de realimenta\u00e7\u00e3o, que possibilitava conhecer o local onde se encontrava o motor em quest\u00e3o e, deste modo, fazer o seu controlo em malha fechada.\nAssim, neste cap\u00edtulo analisaremos os itens que estavam por concluir/realizar, nomeadamente o trav\u00e3o, al\u00e9m da integra\u00e7\u00e3o da electr\u00f3nica no ve\u00edculo e altera\u00e7\u00f5es efectuadas, visando o correcto funcionamento de todo o sistema, quer em condu\u00e7\u00e3o normal quer em condu\u00e7\u00e3o teleoperada.\nTrav\u00e3o\nDo ponto de vista material [1], o trav\u00e3o n\u00e3o se encontrava criado havendo, contudo, modelos relativos \u00e0 sua estrutura f\u00edsica e indicadores da forma como este se iria comportar fisicamente.\nA ideia original assemelhava-se a um p\u00e9 no pedal (de forma a empurrar o trav\u00e3o existente no ve\u00edculo). O motor de rota\u00e7\u00e3o estaria, ent\u00e3o, ligado a um sem-fim que transformaria a for\u00e7a rotacional em for\u00e7a de transla\u00e7\u00e3o, atrav\u00e9s de um guia.\nAssim sendo, a for\u00e7a rotacional seria traduzida num avan\u00e7o ou recuo do pedal, conforme desejado pelo piloto, e a for\u00e7a que este empregasse no sensor do trav\u00e3o existente no volante.\n(b) Vista Isom\u00e9trica.\nA figura 35 mostra o aspecto final do trav\u00e3o, aquele que foi implementado na\n, . 1\npratica .\nfigura 35 - Aspecto do trav\u00e3o na realidade.\nAp\u00f3s testes efectuados com carga no setup de testes do trav\u00e3o, concluiu-se que n\u00e3o seria a t\u00e9cnica ideal para accionamento do trav\u00e3o do carro teleoperado.\nO trav\u00e3o, embora apresentasse as caracter\u00edsticas necess\u00e1rias para ser r\u00e1pido e eficaz na actua\u00e7\u00e3o da travagem, pois possui uma velocidade de rota\u00e7\u00e3o de 1800 rpm, n\u00e3o apresentava os requisitos de for\u00e7a necess\u00e1ria para conseguir mover o trav\u00e3o real do carro.\nAdoptou-se, assim, uma nova t\u00e9cnica baseada no puxar, em detrimento do empurrar (do trav\u00e3o) e, utilizaram-se novos motores. Como o trav\u00e3o n\u00e3o apresentava a for\u00e7a necess\u00e1ria para travar o ve\u00edculo, pois o motor apresentava um torque de 94g/cm -capaz de permitir uma for\u00e7a m\u00e1xima de 5Kg com o curso existente no ve\u00edculo de 25 mm -, alteraram-se os motores, quer o da direc\u00e7\u00e3o quer o do trav\u00e3o. Com um torque m\u00e1ximo de 40.8kg/cm, os novos motores cumprem, assim, os requisitos necess\u00e1rios [13].\n\u00c9 ainda de referir que os motores1 2 t\u00eam valores de funcionamento na gama compreendida entre 700^s e 2300 |is.\n1 Um agradecimento ao Eng. Fernando Filipe, pela ajuda prestada.\n2Referiram-se alguns aspectos dos motores que, numa situa\u00e7\u00e3o normal, n\u00e3o se teriam em conta, uma vez que o datasheet apenas existe em japon\u00eas.\nfigura 36 - Modelo do trav\u00e3o utilizado.\nO trav\u00e3o \u00e9 apresentado na figura 36 e percorre todo a gama do servo de 0 a 270 graus. O valor 0 equivale ao trav\u00e3o em descanso, correspondendo o valor 270 \u00e0 for\u00e7a m\u00e1xima. Preso numa roldana est\u00e1 um cabo com uma mola, que ser\u00e1 respons\u00e1vel por puxar o trav\u00e3o existente no ve\u00edculo.\nfigura 37 - Modelo da direc\u00e7\u00e3o utilizado.\nAtrav\u00e9s da figura 37, \u00e9 poss\u00edvel observar que a direc\u00e7\u00e3o apresenta suportes para o encaixe no chassis. O motor ligar-se-\u00e1 directamente ao veio da direc\u00e7\u00e3o do ve\u00edculo e os \u00e2ngulos de viragem estar\u00e3o compreendidos entre -45 e +45 graus, situando-se o ponto 0 nos 135 graus (1500 |is) do servo.\nfigura 38 - Valores de varia\u00e7\u00e3o de PWM na direc\u00e7\u00e3o.\nOs servomotores, por possu\u00edrem no seu interior electr\u00f3nica, n\u00e3o necessitam uma malha de realimenta\u00e7\u00e3o1, para o controlo em malha fechada. Ser\u00e1, ent\u00e3o, necess\u00e1rio colocar o valor de PWM para o \u00e2ngulo correspondente, atrav\u00e9s do microcontrolador.\nOs motores funcionam a uma frequ\u00eancia muito mais baixa relativamente \u00e0 utilizada no ano transacto - 9Khz - frequ\u00eancia essa que era utilizada para modular a alimenta\u00e7\u00e3o dos antigos motores DC.\nAssim, n\u00e3o ser\u00e1 poss\u00edvel a utiliza\u00e7\u00e3o directa do m\u00f3dulo inclu\u00eddo na PIC para o PWM, pois a frequ\u00eancia necess\u00e1ria para o funcionamento dos motores ser\u00e1 de cerca de 100 Hz, quando o m\u00f3dulo da PIC \u00e9 utilizado para criar ondas PWM de frequ\u00eancia na ordem dos kHz [12].\nNeste sentido, utilizou-se o TimerO de forma a gerar uma interrup\u00e7\u00e3o de 10 em 10 ms e o timer2 para gerar a onda PWM.\n\t10 ms \u00ed\t>\nTimerO\t\n\tI\nPWM\t\nStart \u2014i\t\nTimer2\t\n\te\t) PR2\t1\nfigura 39 - Esquema da cria\u00e7\u00e3o do PWM.\n1 \u00c9 sempre poss\u00edvel a exist\u00eancia de sensores, constituindo-se estes como mais um par\u00e2metro de monitoriza\u00e7\u00e3o.\nQuando \u00e9 despoletada uma interrup\u00e7\u00e3o de 10 em 10 ms pelo TimerO, o pino que fornece o sinal de controlo PWM \u00e9 colocado a 1. \u00c9 calculada, ent\u00e3o, a onda PWM necess\u00e1ria e assim, no registo PR2 respons\u00e1vel pelo instante da activa\u00e7\u00e3o do Timer2, \u00e9 colocado o valor de quando \u00e9 que ir\u00e1 ser despoletado uma interrup\u00e7\u00e3o pelo Timer2. Quando a interrup\u00e7\u00e3o relativa ao Timer2 \u00e9 activada, \u00e9 colocado o pino correspondente ao PWM a 0. Este procedimento \u00e9 efectuado para o controlo do trav\u00e3o, devido a resolu\u00e7\u00e3o do Timer2.\nPara o controlo da direc\u00e7\u00e3o a t\u00e9cnica utilizada \u00e9 an\u00e1loga, utilizando-se o Timer3 pois possui uma maior resolu\u00e7\u00e3o.\nJitter1 existente no PWM de controlo:\n\tTimer3 (direc\u00e7\u00e3o)\tTimer2 (trav\u00e3o)\nTempo (ns)\t210\t620\nTabela 2 - Jitter no PWM.\nOs valores de Jitter s\u00e3o muito satisfat\u00f3rios, n\u00e3o se observando varia\u00e7\u00f5es nos servomotores, no que diz respeito \u00e0 mudan\u00e7a de posi\u00e7\u00e3o - quando estes est\u00e3o numa posi\u00e7\u00e3o fixa. Deste modo, garante-se que os motores n\u00e3o sofrem qualquer efeito, provocado por varia\u00e7\u00f5es no PWM - calculados no microcontrolador.\nAltera\u00e7\u00f5es no c\u00f3digo\nM\u00f3dulo functions\nO m\u00f3dulo de controlo n\u00e3o enviava, por CAN, o comando de SCREEN. De forma a corrigir tal situa\u00e7\u00e3o, alterou-se a fun\u00e7\u00e3o define_signals para o comando screen ser tamb\u00e9m enviado.\nA tabela de IDs de mensagens CAN a serem enviadas passou a incluir, tamb\u00e9m, o comando SCREEN.\nM\u00f3dulo cannack\nA tabela de envio foi alterada de forma a incluir o comando SCREEN.\nVaria\u00e7\u00e3o m\u00e1xima, relativamente ao tempo ideal.\nConclus\u00f5es\nEmbora o sistema de testes do ano anterior tenha ficado funcional, foi necess\u00e1rio efectuar algumas altera\u00e7\u00f5es devido \u00e0 pouca efic\u00e1cia em termos de for\u00e7a e rapidez que os motores mostravam no controlo da direc\u00e7\u00e3o e do trav\u00e3o, quando em controlo remoto, obtendo-se assim uma vers\u00e3o final para colocar no ve\u00edculo.\nRelativamente a altera\u00e7\u00f5es ao c\u00f3digo, al\u00e9m das que se prendem com o funcionamento dos novos motores, todas as outras foram levadas a cabo, para que o sistema global se mostrasse funcional, sendo agora poss\u00edvel o envio da informa\u00e7\u00e3o total para o palmtop/PDA. A informa\u00e7\u00e3o, proveniente do volante, passa pelo m\u00f3dulo de controlo tendo este a fun\u00e7\u00e3o de gateway volante para o palmtop/PDA (atrav\u00e9s da rede CAN).\nA electr\u00f3nica associada ao M\u00f3dulo de Controlo/GatewayPalm deixou de possuir a funcionalidade de GatewayPalm, passando \"apenas\" a m\u00f3dulo de controlo. De uma forma mais pormenorizada, dar-se-\u00e1 relevo a este assunto num cap\u00edtulo posterior.\nEmbora n\u00e3o seja priorit\u00e1rio, pois o sistema encontra-se funcional, seria interessante, numa perspectiva de continua\u00e7\u00e3o do projecto, construir-se uma nova placa, com rel\u00e9s em vez de pontes H, de forma a (des)activar os motores (dado que a placa que l\u00e1 se encontra foi desenhada para os motores DC anteriores). As pontes H permitiam a polariza\u00e7\u00e3o dos motores DC, al\u00e9m de aumentarem o sinal de 5V, \u00e0 entrada da ponte, para 12V \u00e0 sa\u00edda, disponibilizando mais corrente.\n\u00c9 ainda de referir que os motores utilizados no desenvolvimento deste projecto s\u00e3o alimentados directamente da bateria, permitindo que rel\u00e9s (des)liguem a alimenta\u00e7\u00e3o dos motores.\n46\nCap\u00edtulo 5\nSoftware de suporte em palmtop/PDA para arquivo local de informa\u00e7\u00e3o e disponibiliza\u00e7\u00e3o de dados cr\u00edticos ao piloto\nNeste cap\u00edtulo analisar-se-\u00e1 o software existente no palmtop/PDA, a rede criada entre os sistemas palmtop/PDA, volante e m\u00f3dulo de controlo, bem como o modo de estrutura do c\u00f3digo correspondente. Ser\u00e3o, tamb\u00e9m, abordadas as diferentes topologias de rede que poderiam ser utilizadas no programa final e o motivo pelas quais estas foram inviabilizadas. Descrever-se-\u00e1 o programa final e a sua implementa\u00e7\u00e3o, o aspecto gr\u00e1fico e os requisitos do programa.\nIntrodu\u00e7\u00e3o te\u00f3rica\nTecnologias de Suporte \u00e0 comunica\u00e7\u00e3o\nBluetooth\nBluetooth \u00e9 uma especifica\u00e7\u00e3o industrial para \u00e1reas de redes pessoais sem fios (Wireless personal area networks - PANs). O bluetooth permite conectar e trocar informa\u00e7\u00f5es entre dispositivos, nomeadamente telem\u00f3veis, port\u00e1teis, computadores, impressoras, c\u00e2maras digitais, entre outros.\nOs dispositivos bluetooth operam na faixa ISM (Industrial, Scientific, Medical) centrada em 2,45 GHz. Nos Estados Unidos, a faixa ISM varia de 2400 a 2483,5 MHz. Na maioria dos pa\u00edses da Europa, a mesma banda tamb\u00e9m est\u00e1 dispon\u00edvel. No Jap\u00e3o a faixa varia entre 2400 a 2500 MHz.\nOs dispositivos s\u00e3o classificados de acordo com a pot\u00eancia e alcance, em tr\u00eas n\u00edveis como mostra a tabela seguinte:\nClasse\tPot\u00eancia m\u00e1xima (mW/dBm)\tAlcance (valor aproximado)\nClasse 1\t100 mW (20 dBm)\t~ 100 metros\nClasse 2\t2.5 mW (4 dBm)\t~ 10 metros\nClasse 3\t1 mW (0 dBm)\t~ 1 metro\nTabela 3 - Especifica\u00e7\u00f5es do bluetooth.\nA banda ISM encontra-se dividida em 79 portadoras, espa\u00e7adas 1 MHz, podendo cada dispositivo transmitir em 79 frequ\u00eancias diferentes. De forma a minimizar as interfer\u00eancias, o dispositivo \"master\", ap\u00f3s sincronizado, pode mudar as frequ\u00eancias de\ntransmiss\u00e3o dos seus \"slaves\" at\u00e9 1600 vezes por segundo. Em rela\u00e7\u00e3o \u00e0 sua velocidade pode chegar a 721 Kbps e possui tr\u00eas canais de voz.\nCada dispositivo \u00e9 dotado de um n\u00famero \u00fanico - 48 bits - que serve de identifica\u00e7\u00e3o, no formato 00:00:00:00:00:00, denominado \"Endere\u00e7o de Bluetooth\" (Bluetooth Address) e s\u00e3o \u00fanicos e exclusivos para cada dispositivo fabricado, assim como o endere\u00e7o MAC da placa de rede.\nOs dispositivos bluetooth comunicam-se entre si e formam uma rede designada piconet, na qual podem existir at\u00e9 oito dispositivos interligados, pois piconets t\u00eam um espa\u00e7o de endere\u00e7amento de 3 bit, o que limita o tamanho m\u00e1ximo da piconet a 8 dispositivos (23 = 8), sendo um deles o mestre - master - e os outros dispositivos escravos - slave.\nA jun\u00e7\u00e3o de 2 ou mais piconets constituem uma scatternet. Esta permite o suporte de comunica\u00e7\u00e3o de mais do que 8 dispositivos. As scatternets podem ser formadas quando um elemento de uma piconet (master ou slave) participa noutra piconet em separado. A participa\u00e7\u00e3o do dispositivo em ambas as piconets permite a troca de informa\u00e7\u00e3o entre elementos das piconets. Usando esta filosofia \u00e9 poss\u00edvel juntar v\u00e1rias piconets numa complexa scatternet, expandindo assim o tamanho f\u00edsico da rede bluetooth para al\u00e9m dos seus limites impostos.\nSistema anterior - PalmOS\nO programa de monitoriza\u00e7\u00e3o anteriormente desenvolvido para o ICARO, foi desenvolvido para palmOS, considerando-se j\u00e1 a hip\u00f3tese de se construir uma piconet com v\u00e1rios dispositivos1. O dispositivo armazenava, ent\u00e3o, a informa\u00e7\u00e3o para logging e futuro visionamento no monitor do ICARO, apresentando a informa\u00e7\u00e3o mais relevante ao piloto, nomeadamente em termos de velocidade instant\u00e2nea, distancia percorrida, n\u00famero da volta, estado da liga\u00e7\u00e3o bluetooth, o estado da bateria, RPM do motor, o tempo de prova vs tempo ideal de prova - a 30km/h.\nLap: 1\tVm:00 Km/h\nPBt: O\nEBt \u2022\nBit: \u2022\nElectronics\nTp: 00 m 00 s\nICARO 2005\n\u2666\nFuel Tap\n04\n39\nJ\na\nMensagens para o piloto!\n~ I 7\u00c7X------------- RPM\nr 7\n- \u00a3\n-5\n-4 \u00ed -3\n-2\n1-1\n00-\n00000 metros\nfigura 40 - Imagem do programa monitor, em PalmOS.\n1API (Application Programming Interface). Esta estrutura permitia fazer directamente a piconet.\n\u00c9 de referir que, a n\u00edvel grafico, a constitui\u00e7\u00e3o deste programa mostrou-se uma ajuda fundamental, na medida em que possibilitou definir mais claramente a ideia do formato em que se queria o programa, para visualiza\u00e7\u00e3o ao piloto. No que diz respeito \u00e0 constru\u00e7\u00e3o do c\u00f3digo, e consequente reutiliza\u00e7\u00e3o deste, n\u00e3o era poss\u00edvel devido, essencialmente, \u00e0 cria\u00e7\u00e3o da rede, uma vez que se utilizaria o sistema operativo Windows Mobile 5.0.\nConstitui\u00e7\u00e3o das tramas existentes nas redes sem fios\nAs tramas t\u00eam o seguinte aspecto:\n00000000 1NNNNNNN BBBSSSSS DDDDDDDD\nBBBSSSSS\nDDDDDDDD\nDDDDDDDD\nCCCCCCCC\nCCCCCCCC\nHeader 0\nHeader 1 (Num. De bytes do restante da trama &lt;72) BBB = Board SSSSS = Signal ID\nData\nEm caso de dados multi-byte Adoptar formato big-endian CRC 0\nCRC1\nIDs das mensagens circulantes nas liga\u00e7\u00f5es sem fios:\nPlaca\nGatewayPalm\nGatewayBoxes GPS\nRoda\nMotor (monitoriza\u00e7\u00e3o)\nMotor (controlo) Volante\nBoardID\n0\n1\n2\n3\n4\n5\n6\nTabela 4 - IDs das placas.\nPara obter mais informa\u00e7\u00f5es acerca das tramas, consultar o anexo B.\nArquitectura do sistema\nO palmtop/PDA acer n300, por possuir o Windows mobile 5.0 como sistema operativo, n\u00e3o permite, \u00e0 partida, efectuar uma piconet. Para tal, utilizou-se um sdk1 (software development kit) para o desenvolvimento e cria\u00e7\u00e3o de aplica\u00e7\u00f5es bluetooth, com base em .net.\nNo ano transacto realizaram-se apenas alguns testes, com o intuito de verificar se o volante se ligava ao pda e se havia perda de tramas, n\u00e3o sendo poss\u00edvel obter a rede com o palmtop/PDA - master -, volante e m\u00f3dulo de controlo - slaves -, faltando ainda construir a rede entre os 3 dispositivos. A cria\u00e7\u00e3o desta rede permite que se efectuem trocas de informa\u00e7\u00e3o entre todos os dispositivos.\nA rede tem de ser capaz de permitir a troca de informa\u00e7\u00e3o entre o volante, o palmtop/PDA e o m\u00f3dulo de controlo, sendo o palmtop/PDA, a gateway entre o volante e o m\u00f3dulo de controlo.\nNuma perspectiva te\u00f3rica, existem 3 hip\u00f3teses para a cria\u00e7\u00e3o da rede:\n\u2022\tPiconet com palmtop/PDA como master; volante e m\u00f3dulo de controlo como slaves;\n\u2022\tPiconet com um dos m\u00f3dulos bluetooth existentes no volante ou m\u00f3dulo de controlo como master; palmtop/PDA e o outro m\u00f3dulo bluetooth como slaves;\n\u2022\tScatternet com palmtop/PDA como slave (sendo o volante o master) e palmtop/PDA master (m\u00f3dulo de controlo como slave) - ver figura 41.\nfigura 41 - Liga\u00e7\u00e3o sem fios bluetooth do sistema - scatternet.\n1 Frason Bluetools SDK.\nDe seguida analisar-se-\u00e1 cada hip\u00f3tese em particular, bem como vantagens e desvantagens associadas a cada uma e a sua implementa\u00e7\u00e3o pr\u00e1tica1.\nPiconet - palmtop/PDA como master, volante e m\u00f3dulo de controlo slaves\nUma vez que no ano transacto j\u00e1 se tinha tentado criar a rede, embora n\u00e3o tenha sido poss\u00edvel, o programa utilizado funcionava noutros palmtop/PDA contudo, n\u00e3o funcionava no acer n300, mostrando-se tal facto como indicador de que o palmtop/PDA j\u00e1 possu\u00eda algumas limita\u00e7\u00f5es ao n\u00edvel do hardware.\nEste ano foi j\u00e1 poss\u00edvel criar a rede com o palmtop/PDA como master, transmitindo a informa\u00e7\u00e3o entre o volante, o m\u00f3dulo de controlo e o palmtop/PDA. A grande vantagem de ter o palmtop/PDA como master na piconet, era a possibilidades de, atrav\u00e9s das bibliotecas Frason [14], voltar a conectar e implementar uma m\u00e1quina de estados em caso de perda de liga\u00e7\u00e3o. Neste caso o palmtop/PDA seria totalmente respons\u00e1vel pela tentativa de voltar a ligar a qualquer dos m\u00f3dulos.\nDe forma a facilitar as liga\u00e7\u00f5es, a partir de uma base fi\u00e1vel de funcionamento, o software foi adaptado dos exemplos do Franson Bluetools SDK. Assim, tal como se v\u00ea atrav\u00e9s da imagem2, \u00e9 poss\u00edvel descobrir os dispositivos, bem como os seus servi\u00e7os (neste caso espec\u00edfico, a transmiss\u00e3o de informa\u00e7\u00e3o \u00e9 o \u201cserial port service\u201d), em paralelo com o envio/recep\u00e7\u00e3o de informa\u00e7\u00e3o nas duas liga\u00e7\u00f5es.\nfigura 42 - Programa de testes.\n1 O c\u00f3digo ser\u00e1 explicado somente na vers\u00e3o final adoptada para o software pois, al\u00e9m de se mostrar muito repetitivo, n\u00e3o permitia centrar a aten\u00e7\u00e3o no que \u00e9 realmente importante - a vers\u00e3o adoptada e final. O respectivo c\u00f3digo encontra-se no CD anexo \u00e0 tese, para futura an\u00e1lise e poss\u00edvel utiliza\u00e7\u00e3o.\n2Como seria de esperar, a tela do palmtop/PDA n\u00e3o \u00e9 t\u00e3o grande como a tela criada para visionamento, sendo necess\u00e1rio usar uma barra de deslocamento horizontal.\nO diagrama seguinte representa a cria\u00e7\u00e3o da rede:\n*\n*\nDescoberta devices liga\u00e7\u00e3o 1\nDescoberta devices liga\u00e7\u00e3o 2\nDescoberta services liga\u00e7\u00e3o 1\nDescoberta services liga\u00e7\u00e3o 2\nConnec\u00e7\u00e3o ao servi\u00e7o do device 1\nConnec\u00e7\u00e3o ao servi\u00e7o do device 2\nEnvio e recep\u00e7\u00e3o de informa\u00e7\u00e3o\n*\n*\n*\n*\nfigura 43 - Cria\u00e7\u00e3o da rede.\nPor\u00e9m, a cria\u00e7\u00e3o da rede desta maneira apresenta alguns problemas. Entre os quais destacam-se:\n\u2022\ta n\u00e3o exist\u00eancia de, em caso de perda de liga\u00e7\u00e3o, possibilidade de restauro, uma vez que o palmtop/PDA, emite erro de \"discover device timeout\", quando existem 2 liga\u00e7\u00f5es1;\n\u2022\ta descoberta dos dispositivos tem que ser feita uma a seguir a outra, n\u00e3o existindo a possibilidade de ligar a um dispositivo e depois ao outro, pois o palmtop/PDA devolve sempre erros na descoberta do 2\u00b0 dispositivo, quando o 1\u00b0 j\u00e1 se encontra ligado;\n\u2022\ta pouca fiabilidade, o que n\u00e3o permite a cria\u00e7\u00e3o de uma m\u00e1quina de estados para ligar novamente em caso de perda de conex\u00e3o.\nApesar de tudo isso, em testes efectuados com o envio de 10000 tramas de 8 bytes (o pc ligado como substituto do m\u00f3dulo de controlo), para o palmtop/PDA, simultaneamente com o volante a enviar informa\u00e7\u00e3o para este, n\u00e3o se perdeu qualquer trama.\nPor\u00e9m, a grande vantagem de criar uma piconet com o palmtop/PDA como master, sendo este o respons\u00e1vel pela gest\u00e3o da rede, n\u00e3o se verificou, uma vez que n\u00e3o \u00e9 fi\u00e1vel, sendo portanto colocada de lado esta hip\u00f3tese para a cria\u00e7\u00e3o da rede.\nPiconet - M\u00f3dulo de controlo master, palmtop/PDA e volante slave\nOs testes realizados deixaram a descoberto que n\u00e3o era necess\u00e1rio utilizar o palmtop/PDA como gateway, pois o volante comunicava directamente com o MC, sendo palmtop/PDA somente para visionamento e logging de informa\u00e7\u00e3o.\nEm rela\u00e7\u00e3o aos m\u00f3dulos bluetooth existentes no volante e MC s\u00f3 permitem liga\u00e7\u00f5es ponto-a-ponto n\u00e3o sendo por isso poss\u00edvel fazer a piconet.\nXO programa somente com uma liga\u00e7\u00e3o, permite a desconex\u00e3o e reconex\u00e3o sem qualquer tipo de problemas, o que n\u00e3o se verifica com 2 liga\u00e7\u00f5es, quando o palmtop/PDA est\u00e1 como master.\nScatternet - Volante Master - PDA slave e PDA Master-MC slave\nA rede foi constru\u00edda com duas liga\u00e7\u00f5es, sendo que uma delas era feita pelo palmtop/PDA (para o MC) e a outra criando um servi\u00e7o serial port com o Franson Bluetools SDK, ao qual o volante se ligava.\nDiversos testes efectuados revelaram que n\u00e3o se perdia qualquer trama nesta configura\u00e7\u00e3o. Por\u00e9m, o processamento das tramas revelou-se muito lento, existindo um atraso de cerca de meio segundo quando as duas liga\u00e7\u00f5es estavam em simult\u00e2neo a enviar informa\u00e7\u00e3o.\nMais tarde, ao inv\u00e9s de se criar um servi\u00e7o pelo Bluetools, acedeu-se simplesmente \u00e0 porta serial do palmtop/PDA ao qual o volante se ligava. Diferentes testes mostraram que, embora a informa\u00e7\u00e3o da serial port fosse rapidamente processada, os dados provenientes do buffer do Bluetools n\u00e3o eram processados a tempo, existindo uma grande perda de tramas. Em 10000 tramas de 8 bytes enviadas sendo o palmtop/PDA master apenas 3648 tramas foram recebidas.\nOutro aspecto negativo a apontar a esta hip\u00f3tese \u00e9 a inexist\u00eancia da possibilidade de saber quando ocorria a perda de liga\u00e7\u00e3o, algo que com a cria\u00e7\u00e3o de servi\u00e7o era poss\u00edvel de saber, no que diz respeito \u00e0 recep\u00e7\u00e3o de dados. Esta situa\u00e7\u00e3o mostrava-se impratic\u00e1vel pois o palmtop/PDA serviria de gateway do volante para o MC, havendo assim perda de controlo do ve\u00edculo.\nO quadro apresentado de seguida, mostra-se como resumo das principais caracter\u00edsticas das diversas topologias de rede.\n\tFi\u00e1vel (possibilidade de restauro da liga\u00e7\u00e3o)\tPerda de tramas\tRapidez em processamento das tramas para gateway\nPiconet (PDA - Master, Volante e MC slaves)\tN\u00e3o\tN\u00e3o\tN\u00e3o\nPiconet (MC (ou Volante) - Master, Volante (ou MC) e PDA slaves)\tN\u00e3o \u00e9 poss\u00edvel criar\tN\u00e3o \u00e9 poss\u00edvel criar\tN\u00e3o \u00e9 poss\u00edvel criar\nScatternet - Volante Master - PDA slave. PDA Master-MC slave (via Frason Bluetools)\tSim\tN\u00e3o\tN\u00e3o\nScatternet - Volante Master - PDA slave. PDA Master-MC slave (via porta COM)\tSim\tSim\tN\u00e3o\nTabela 5 - Principais caracter\u00edsticas das liga\u00e7\u00f5es efectuadas.\nO maior problema das liga\u00e7\u00f5es efectuadas \u00e9 conseguir que os comandos de controlo circulem entre o volante e m\u00f3dulo de controlo, servindo o palmtop/PDA como gateway, n\u00e3o havendo perda de tramas. Tal facto n\u00e3o \u00e9 verific\u00e1vel com a utiliza\u00e7\u00e3o deste palmtop/PDA, uma vez que este processa cerca de 1 trama de 250 em 250 ms quando as\n2\tliga\u00e7\u00f5es est\u00e3o activadas, o que implica bastantes problemas a qualquer destas topologias de rede.\nMudan\u00e7a da topologia da rede\nCom o objectivo de evitar que o palmtop/PDA servisse de gateway e torn\u00e1-lo apenas um sistema terminal de logging e visionamento, alterou-se a topologia da rede. Esta altera\u00e7\u00e3o permite minimizar o atraso entre o volante e o m\u00f3dulo de controlo, bem como a necessidade de processamento do palmtop/PDA.\nA rede utilizada foi a descrita atrav\u00e9s da figura 44:\nfigura 44 - Arquitectura global ICARO com a nova topologia.\nComo se pode verificar na figura 44, o m\u00f3dulo de controlo/GatewayPalm deixa de ter as 2 fun\u00e7\u00f5es, apresentando-se em separado, existindo agora uma nova placa com a fun\u00e7\u00e3o GatewayPalm (ser\u00e1 referido no cap\u00edtulo seguinte). Esta placa estar\u00e1 na rede CAN e tornar\u00e1 poss\u00edvel a exist\u00eancia do palmtop/PDA como ponto terminal servindo a placa como electr\u00f3nica de suporte ao palmtop/PDA para recebimento de dados.\nfigura 45 - Nova topologia da rede - mais detalhada.\nA placa ter\u00e1 a fun\u00e7\u00e3o de sniffer da rede CAN enviando, posteriormente, por bluetooth a informa\u00e7\u00e3o em tramas para o palmtop/PDA, permitindo assim \"ancorar\" o palmtop/PDA no sistema, sem interagir directamente com este, tornando-o completamente independente do palmtop/PDA.\nPrograma Final do palmtop/PDA\nAspectos gerais\nO palmtop/PDA ser\u00e1 capaz de:\niniciar a liga\u00e7\u00e3o bluetooth com um dispositivo e receber informa\u00e7\u00e3o;\npossuir capacidade para, em caso de perca de liga\u00e7\u00e3o, voltar a conectar ao dispositivo (m\u00e1quina de estados);\nvalidar a informa\u00e7\u00e3o (tramas) vinda do bluetooth (m\u00e1quina de estados);\nprocessar os dados (efectuar o log deles, visualizar a informa\u00e7\u00e3o, fazer alguns c\u00e1lculos com eles, entre outros) atrav\u00e9s de uma m\u00e1quina de estados;\ncriar um ficheiro de log dos dados recebidos para futura visualiza\u00e7\u00e3o no monitor do ICARO;\ncriar um ficheiro de log de erros para registo de poss\u00edveis falhas ocorridas (a t\u00edtulo de exemplo, o aparecimento de caixas de erro ao condutor n\u00e3o permitiria ver o que realmente importa - a informa\u00e7\u00e3o);\nconfigurar a liga\u00e7\u00e3o bluetooth e escolher dispositivo a ligar, sem ser necess\u00e1rio alterar c\u00f3digo (atrav\u00e9s da cria\u00e7\u00e3o de um ficheiro de configura\u00e7\u00e3o de bluetooth);\n\u2022 desenhar um gr\u00e1fico de perfil de altitude, de forma a que o condutor saiba o local onde se encontra.\nfigura 46 - Monitor ICARO.\nLiga\u00e7\u00e3o Bluetooth e obten\u00e7\u00e3o dos valores para posterior processamento\nA liga\u00e7\u00e3o bluetooth ser\u00e1 realizada atrav\u00e9s das bibliotecas de desenvolvimento de aplica\u00e7\u00f5es Frason Bluetools. Estas bibliotecas permitem a liga\u00e7\u00e3o a um servi\u00e7o de um determinado dispositivo, bem como a descoberta de dispositivos e servi\u00e7os. A abertura e manuten\u00e7\u00e3o de uma liga\u00e7\u00e3o e a disponibiliza\u00e7\u00e3o de fun\u00e7\u00f5es de leitura e de escrita para um buffer de valores provenientes da liga\u00e7\u00e3o, s\u00e3o tamb\u00e9m aplica\u00e7\u00f5es das referidas bibliotecas.\nDepois da informa\u00e7\u00e3o se encontrar dispon\u00edvel no buffer do bluetooth, esta \u00e9 copiada para um buffer circular de modo a, por um lado n\u00e3o se perder informa\u00e7\u00e3o devido a poss\u00edveis rajadas de bytes provenientes do dispositivo, por outro, caso se percam alguns dados, quando o ponteiro de escrita do buffer circular igualar o ponteiro de escrita, perder-se-\u00e3o os dados mais antigos.\nLer dados buffer de bluetooth\nColocar dados no buffer circular, para posterior processamento.\nfigura 47 - Aspecto da recep\u00e7\u00e3o de dados.\nO buffer circular tem um tamanho de 8kbytes e possui um ponteiro de escrita e de leitura que apontam para o 1\u00b0 elemento livre para escrita e leitura, respectivamente.\nProcessamento das tramas\nAs tramas existentes no buffer circular t\u00eam que ser processadas. Para tal utilizou-se um timer que \u00e9 activado de 100 em 100ms, que verifica se existem bytes no buffer circular para serem processados. Em caso afirmativo, a m\u00e1quina de estados seguinte \u00e9 activada (fun\u00e7\u00e3o processdata), at\u00e9 que todos os bytes do buffer circular tenham sido processados, isto \u00e9, ponteiro de escrita = ponteiro de leitura.\nfigura 48 - M\u00e1quina de estados - process_data.\n\nExistem 3 estados em que \u00e9 poss\u00edvel encontrar a fun\u00e7\u00e3o:\nSyncro (no programa realizado denominado por Header_0)\nLength (no programa realizado denominado por Header_1) Data+CRC (no programa realizado denominado por Data)\nO estado Syncro \u00e9 respons\u00e1vel por \"capturar\" o in\u00edcio de cada trama, passando para o estado seguinte, caso tenha sido recebido 0x00. Em caso negativo, continua neste estado at\u00e9 se capturar o que poder\u00e1 ser o in\u00edcio de uma trama.\nO estado length \u00e9 respons\u00e1vel por dar conta de quantos bytes de dados (incluindo CRC) vir\u00e3o a seguir e at\u00e9 ao final da trama. \u00c9 de salientar ainda que cada trama ter\u00e1, no m\u00e1ximo, 72 bytes e que as tramas poder\u00e3o ter v\u00e1rios sinais de forma a diminuir o overhead. Assim, no estado length, existe um byte com a estrutura 1NNNNNNN, sendo N o n\u00famero de bytes restantes da trama (&lt;72 bytes). Em caso negativo, retoma-se o estado syncro.\nO estado final Data+CRC \u00e9 respons\u00e1vel por armazenar a informa\u00e7\u00e3o em 2 buffers:\nBuffer possuindo a trama completa, com o header de syncro e o header de length, juntamente com os 2 bytes de CRC e, claro, os dados. Este buffer tem como finalidade o armazenamento de tramas v\u00e1lidas para futuro processamento dos dados noutra m\u00e1quina de estados. Essa m\u00e1quina de estado ser\u00e1 referida mais a frente e tem a finalidade de processar data, visualizar, fazer c\u00e1lculos, entre outros.\nBuffer para guardar dados, num ficheiro para futuro visionamento no monitor do ICARO1, possuindo apenas os dados e respectivos identificadores dos sinais. N\u00e3o se utilizou o mesmo buffer, pois o 1\u00b0 referido \u00e9 utilizado para processamento de dados, enquanto que o 2\u00b0 t\u00eam uma capacidade maior e \u00e9 um buffer tempor\u00e1rio onde os dados s\u00e3o colocados at\u00e9 que se tenham mais de 1024 bytes. Nesse momento, os bytes s\u00e3o escritos no ficheiro de dados criado no SD-CARD do palmtop/PDA.\nEsta t\u00e9cnica foi utilizada de forma a evitar a escrita constante no cart\u00e3o de mem\u00f3ria, guardando apenas quando j\u00e1 se tem bastante informa\u00e7\u00e3o2.\nAl\u00e9m disso, o estado Data+CRC possui a fun\u00e7\u00e3o de verificar a validade das tramas atrav\u00e9s do CRC sendo que, em caso afirmativo, a informa\u00e7\u00e3o \u00e9 guardada nos 2 buffers acima referidos.\nProcessamento dos dados\nfigura 49 - M\u00e1quina de estados - extract_data\nNo estado Data+ CRC referido anteriormente, em caso de trama v\u00e1lida, \u00e9 chamada a fun\u00e7\u00e3o que \u00e9 respons\u00e1vel pelo tratamento da informa\u00e7\u00e3o (fun\u00e7\u00e3o extract_data). Essa fun\u00e7\u00e3o parte do 1\u00b0 byte existente no buffer - que \u00e9 um identificador - e, sabendo quantos bytes de dados relativos a esse sinal v\u00eam a seguir, faz o que tiver de ser feito de acordo com esse sinal (por exemplo, imprimir no ecr\u00e3, fazer c\u00e1lculos, etc.). Este ciclo continuar\u00e1 a ser executado at\u00e9 que todos os bytes da trama v\u00e1lida tenham sido processados.\nAspectos do programa principal\nForm1.vb \u00e9 o programa principal, onde s\u00e3o efectuadas as opera\u00e7\u00f5es fundamentais com base nos m\u00f3dulos existentes, onde \u00e9 feito o load do programa principal e onde se termina o referido programa. Todos os restantes m\u00f3dulos s\u00e3o auxiliares, de forma a permitir que o Forml esteja mais percept\u00edvel para leitura e compreens\u00e3o.\nO programa apresenta 6 m\u00f3dulos [14], [15], [16]:\n1O programa de palmtop/PDA possui um \u201cmini-monitor\u201d que permite o visionamento do ficheiro de dados -a prova.\n2Surgindo como excep\u00e7\u00e3o o final do programa que, independentemente de se ter 1024 bytes, guarda a informa\u00e7\u00e3o que ainda exista no buffer.\n\u2022\tBlue_funcs.vb - contempla as fun\u00e7\u00f5es para o correcto funcionamento do bluetooth, desde a fun\u00e7\u00e3o de escrita, leitura de e para um dispositivo bluetooth e as fun\u00e7\u00f5es de connect_device() e de disconnect_device() que o nome j\u00e1 \u00e9 explicat\u00f3rio1;\n\u2022\tBuffers_funcs.vb - possui as fun\u00e7\u00f5es de leitura e escrita num buffer e 2 fun\u00e7\u00f5es de processamento de tramas, uma para dados vindos de um dispositivo bluetooth, outra para os dados oriundos de um ficheiro;\n\u2022\tCRC.vb - cont\u00e9m a fun\u00e7\u00e3o para an\u00e1lise do CRC vindo das tramas;\n\u2022\tFilters.vb - contempla as fun\u00e7\u00f5es para os valores que necessitam de c\u00e1lculos (dist\u00e2ncia, velocidade, etc.) e as fun\u00e7\u00f5es para a passagem de valores num\u00e9ricos para a correspondente imagem para visualiza\u00e7\u00e3o. As fun\u00e7\u00f5es relativas a dados que n\u00e3o s\u00e3o visualizados, embora funcionais, n\u00e3o s\u00e3o executadas durante o programa para n\u00e3o haver processamento desnecess\u00e1rio. Este m\u00f3dulo s\u00f3 \u00e9 chamado pelo m\u00f3dulo signals.vb;\n\u2022\tSignals.vb - \u00e9 o m\u00f3dulo respons\u00e1vel pelo tratamento dos dados. Existem 37 sinais poss\u00edveis para tratamento, alguns dos quais \u00e9 necess\u00e1rio apenas visualizar, outros fazer c\u00e1lculos e outros somente incrementar o buffer para os dados seguintes;\n\u2022\tInclude.vb - possui, como o nome indica, as vari\u00e1veis globais ao sistema, bem como os par\u00e2metros de defini\u00e7\u00f5es gerais (tamanho de buffers, ID das placas, etc.).\n1O reconnect_device n\u00e3o foi efectuado dentro deste m\u00f3dulo mas sim directamente no programa pois tratase de um disconnect_device - connect_device, que \u00e9 efectuado quando o buffer de bluetooth retorna um erro de ErrorCode.ConnectionFailed.\nO programa principal do monitor HammerShark ter\u00e1 o seguinte aspecto:\nVisionamento A completo )\nConfigura\u00e7\u00e3o Bluetootti\nMonitor\nExecuta c\u00f3digo associado\nExecuta c\u00f3digo associado\nTerminar aplica\u00e7\u00e3o\nMain Menu\nExecuta c\u00f3digo associado\nReplay\nConfigura\u00e7\u00e3o A terminada )\nC Opera\u00e7\u00e3o terminada pelo ) utilizador y\nfigura 50 - M\u00e1quina de estados - programa principal.\nTal como se verifica atrav\u00e9s da figura acima, o menu principal possibilita apenas a escolha da opera\u00e7\u00e3o que o utilizador deseja fazer.\nJ\u00e1 o menu monitor, por sua vez, \u00e9 constitu\u00eddo por 2 ecr\u00e3s que disponibilizam informa\u00e7\u00e3o \u00fatil, em tempo-real, ao utilizador. Num dos ecr\u00e3s, \u00e9 fornecida informa\u00e7\u00e3o acerca da velocidade, da dist\u00e2ncia percorrida, n\u00famero da volta, estados das baterias, etc. O outro menu possui um perfil de altitudes que permite ao piloto saber se est\u00e1 a subir ou a descer, quais s\u00e3o as subidas e as descidas mais acentuadas, entre outros. Esses 2 pain\u00e9is s\u00e3o mudados atrav\u00e9s do carregar de um bot\u00e3o existente no volante do ve\u00edculo. O menu monitor \u00e9 tamb\u00e9m respons\u00e1vel pela liga\u00e7\u00e3o bluetooth com um dispositivo j\u00e1 pr\u00e9-determinado (existe um ficheiro de configura\u00e7\u00e3o no cart\u00e3o de mem\u00f3ria com os par\u00e2metros do dispositivo ao qual se pretende ligar) para, em caso de falha, tentar novamente reconectar ao dispositivo e tamb\u00e9m pela salvaguarda da informa\u00e7\u00e3o num ficheiro.\nO menu replay permite abrir um ficheiro de dados \u00e0 escolha do utilizador e rever a prova, tal como \u00e9 mostrada no menu monitor ao piloto. Al\u00e9m disso, permite fazer pause/play aos dados da prova em quest\u00e3o.\nNo que diz respeito ao menu configura\u00e7\u00e3o, este permite fazer a descoberta de dispositivos na \u00e1rea de alcance do bluetooth, os seus servi\u00e7os e ligar aos dispositivos. Caso o utilizador pretenda, \u00e9 poss\u00edvel definir o dispositivo seleccionado como dispositivo por defeito a ser utilizado na pr\u00f3xima vez que o menu monitor for iniciado.\nFicheiros criados pelo monitor e de configura\u00e7\u00e3o\nDiversos ficheiros s\u00e3o manipulados e utilizados pelo programa, entre os quais:\nFicheiros de configura\u00e7\u00e3o:\n\u2022\tBluetooth_conf.txt - possui todos os dados do dispositivo e servi\u00e7o ao qual o programa se liga automaticamente. \u00c9 poss\u00edvel de ser alterado no menu configura\u00e7\u00e3o, atrav\u00e9s da descoberta de dispositivos e seus servi\u00e7os.\n\u2022\tTrack_info.txt - possui os dados relativos \u00e1 pista. Esses dados s\u00e3o: dist\u00e2ncia total, n\u00famero de voltas, tempo de prova e comprimento de cada volta.\nFicheiros de dados:\n\u2022\ticaro_data_tempo.txt - cont\u00eam toda a informa\u00e7\u00e3o recebida pelo link bluetooth. Apenas \u00e9 criado quando o utilizador selecciona o menu Monitor. Data e o tempo \u00e9 a data actual dada em ano, m\u00eas e dia tal como o tempo \u00e9 dado em hora, minutos, segundos de forma a n\u00e3o existir repeti\u00e7\u00e3o de nomes.\n\u2022\ticaro-error_log_data_tempo.txt - ficheiro de logging de estado do programa e erros que possam eventualmente acontecer.\nAspecto Gr\u00e1fico\nApresentam-se, de seguida, os menus e sua apar\u00eancia gr\u00e1fica, bem como a forma de tratamento da informa\u00e7\u00e3o para mostrar ao piloto, uma vez que a informa\u00e7\u00e3o ter\u00e1 de ser espelhada para visualiza\u00e7\u00e3o.\nfigura 51 - Menu Principal.\nfigura 52 - Menu Configura\u00e7\u00e3o Bluetooth.\nfigura 53 - Menu Monitor/rep/oy.\nfigura 54 - Menu Altitudes (acedido somente do menu monitor/replay).\nO menu Monitor (menu n\u00famero 3) \u00e9 iniciado quando o utilizador pressiona o bot\u00e3o replay ou monitor, ainda que com algumas diferen\u00e7as. No menu Monitor relacionado com o replay, \u00e9 pedido ao utilizador que seleccione um ficheiro para visualiza\u00e7\u00e3o existente no SD-CARD do palmtop/PDA.\nJ\u00e1 no menu Monitor relacionado com a monitoriza\u00e7\u00e3o ao piloto, \u00e9 efectuada a liga\u00e7\u00e3o bluetooth, atrav\u00e9s de um ficheiro de configura\u00e7\u00e3o existente no SD-CARD1 (pass\u00edvel de ser alterado pelo menu de configura\u00e7\u00e3o bluetooth). Deste modo, \u00e9 feita a visualiza\u00e7\u00e3o da informa\u00e7\u00e3o e logging dos dados recebidos no SD-CARD do dispositivo. Al\u00e9m disso, \u00e9 criado um ficheiro de erros e status acerca de eventuais erros, conex\u00e3o, entre outros2.\nComo se pode ver, o menu Monitor possu\u00ed a informa\u00e7\u00e3o mais relevante: velocidade, distancia percorrida, numero de volta, tempo de volta etc...\nAl\u00e9m do j\u00e1 referido, foi colocado um menu de altitudes da pista para o piloto ter conhecimento acerca da topografia do terreno, nomeadamente se deve desligar o motor, se est\u00e1 a descer ou a subir, poss\u00edveis subidas e descidas acentuadas, entre outras informa\u00e7\u00f5es de interesse.\nUma vez que a informa\u00e7\u00e3o vai passar por um espelho antes de ser visionada pelo piloto, toda a informa\u00e7\u00e3o destes 2 menus encontra-se espelhada.\n1Esse ficheiro cont\u00e9m a informa\u00e7\u00e3o acerca do endere\u00e7o do dispositivo bluetooth, o nome do dispositivo, o nome do servi\u00e7o a que se deseja ligar, bem como o n\u00famero do servi\u00e7o respectivo.\n2Para o piloto, a informa\u00e7\u00e3o relativa aos erros n\u00e3o \u00e9 muito relevante, pelo que estas mensagens s\u00e3o colocadas num ficheiros para posterior processamento nas boxes.\nfigura 55 - Palmtop/PDA em cima - espelho para visualizar a informa\u00e7\u00e3o[1].\n\u00c9 de referir que o palmtop/PDA encontra-se colocado em cima do volante, existindo um espelho que permitir\u00e1 ao piloto ver essa informa\u00e7\u00e3o.\nUm outro aspecto que se verificou \u00e9 que o palmtop/PDA suporta o tempo da prova, n\u00e3o falhando a bateria. Tal facto \u00e9 pass\u00edvel de ser comprovado pois, ao enviarem-se tramas de 8 bytes para o palmtop/PDA, durante 1 hora, verifica-se que este apenas \"gastou\" cerca de 26% da bateria.\nOp\u00e7\u00f5es tomadas a n\u00edvel visual [17] [18]\nRelativamente ao aspecto gr\u00e1fico, mais propriamente ao menu Monitor e Gr\u00e1fico, existiam 2 hip\u00f3teses para a sua cria\u00e7\u00e3o em vb.net:\n\u2022\tum conjunto de imagens agrupadas numa Image_List que permite mostrar numa picturebox, e repetir a visualiza\u00e7\u00e3o quantas vezes se pretender e em quantas pictureboxs se quiser;\n\u2022\tsobrepor todas as imagens que se quiserem (por exemplo colocar as imagens de 0 a 9 invertidas e sobrepostas) e tornar vis\u00edvel a que se quer e invis\u00edvel as restantes. Deste modo garante-se que s\u00f3 a que queremos \u00e9 mostrada ao utilizador. Cada grupo de imagens sobrepostas poder\u00e3o ser agrupadas num array de picturebox, de forma a tornar mais f\u00e1cil o seu manuseamento com base em \u00edndices do array.\nOs dois programas com as diferen\u00e7as acima descritas, foram concebidos de forma a comparar as vantagens e desvantagens de cada um.\nMegas (mb)\t\t\nMem\u00f3ria ocupada\tHammerShark PICS\tHammerShark ImagList\nAntes programa iniciar\t19.86\t21.93\nMenu main\t28.46\t33.80\nAp\u00f3s visualiza\u00e7\u00e3o Nogaro\t28.73\t43.86\nTabela 6 - Compara\u00e7\u00e3o entre os 2 programas.\nOs programas apresentam algumas vantagens, um em rela\u00e7\u00e3o ao outro. Na tabela 5, a linha \u201cap\u00f3s visualiza\u00e7\u00e3o Nogaro\u201d refere-se a um ficheiro de dados relativo \u00e0 prova do ICARO, de 2006, em Nogaro - Fran\u00e7a.\nEm qualquer um deles, uma imagem s\u00f3 \u00e9 alterada quando necess\u00e1rio, de forma a haver menos processamento, pois existem 21 pictureboxs que podem ser modificadas consoante os dados.\nO programa HammerShark_PICS ocupa menos mem\u00f3ria que o HammerShark_ImageList1, tendo a vantagem de praticamente n\u00e3o aumentar de tamanho, com a utiliza\u00e7\u00e3o, ao contr\u00e1rio do programa baseado em ImageList.2\nAl\u00e9m disso, comparando as mesmas imagens trabalhadas pelo Image_List e colocadas em picturebox sobrepostas, t\u00eam melhor defini\u00e7\u00e3o, pois apresentam-se menos pixilizadas.\nA \u00fanica vantagem do programa baseado em Imagelist \u00e9 os tempos de execu\u00e7\u00e3o no arranque do programa. Os referidos tempos s\u00e3o inferiores aos do HammerShark_PICS, pois este \u00faltimo precisa de carregar todas as imagens. Quando o menu main aparece no ecr\u00e3 j\u00e1 todas as imagens foram carregadas.\n1\tO Palmtop/PDA possui uma mem\u00f3ria limitada a 60 mb para a execu\u00e7\u00e3o dos programas, por isso \u00e9 vital que o programa ocupe pouco dessa mem\u00f3ria.\n2\tExiste um \"bug\" no Compact Framework, referido com mais detalhe no anexo A. Este consiste na n\u00e3o liberta\u00e7\u00e3o de recursos quando se altera uma imagem de uma picturebox. Estes recursos permanecem ocupados at\u00e9 ao limite imposto pelo SO de utiliza\u00e7\u00e3o de mem\u00f3ria, de forma a n\u00e3o atingir o n\u00edvel de OutOfMemory, embora este possa ser despoletado se se estiver a acompanhar os erros emitidos pelo programa.\nConclus\u00f5es\nO programa, neste momento, realiza todas as fun\u00e7\u00f5es pretendidas. Torna vis\u00edvel a informa\u00e7\u00e3o ao piloto, grava-a num ficheiro em suporte SD-CARD, processa os dados provenientes da liga\u00e7\u00e3o bluetooth e estabelece esta liga\u00e7\u00e3o automaticamente.\n\u00c9 ainda de referir que foram adicionadas mais algumas potencialidades ao programa, com o intuito de o tornar mais eficiente. Entre as\"novas\" fun\u00e7\u00f5es destacam-se o aviso para quando a bateria est\u00e1 num n\u00edvel baixo, um menu para replay de provas, um ficheiro de logging de erros e de estado ao longo da utiliza\u00e7\u00e3o do programa, um menu de configura\u00e7\u00e3o autom\u00e1tica de bluetooth (criando um ficheiro de configura\u00e7\u00e3o_bluetooth para posterior liga\u00e7\u00e3o, al\u00e9m de reconex\u00e3o bluetooth em caso de perda.\nA topologia da rede foi alterada, deixando o palmtop/PDA de desempenhar ter um papel crucial na rede, passando a ser um visualizador e loggging de dados. Foram feitas experi\u00eancias com todos os tipos de rede poss\u00edveis, escolhendo-se a melhor e que mais se adequava a cumprir o objectivo pretendido.\nNo que diz respeito ao interface gr\u00e1fico, tamb\u00e9m foram testadas as diferentes formas de cria\u00e7\u00e3o do programa, tendo-se optado pelas imagens sobrepostas.\nO programa, na sua totalidade, revela-se robusto, n\u00e3o perde tramas da liga\u00e7\u00e3o bluetooth, \u00e9 r\u00e1pido durante a sua execu\u00e7\u00e3o, uma vez que todas as imagens s\u00e3o adicionadas no princ\u00edpio do programa, garante-se assim maior rapidez de execu\u00e7\u00e3o.\nEm s\u00edntese, o programa de palmtop/PDA encontra-se finalizado, faltando apenas mencionar e discutir a electr\u00f3nica de suporte de envio de tramas para o palmtop/PDA. Tal informa\u00e7\u00e3o ser\u00e1 analisada no pr\u00f3ximo cap\u00edtulo.\nCap\u00edtulo 6\nM\u00f3dulo GatewayPalm\nAspectos Gerais\nDevido \u00e0 impossibilidade dos m\u00f3dulos bluetooth conseguirem estabelecer liga\u00e7\u00f5es que n\u00e3o sejam ponto-a-ponto (criar piconets) e como o palmtop/PDA apresentava uma capacidade limitada para o tratamento das tramas e respectivo direccionamento do volante para o m\u00f3dulo de controlo, fez-se uma nova placa que ter\u00e1 o papel de sniffer da rede CAN e criar as tramas para respectivo envio para o bluetooth.\nAl\u00e9m disso, para efectuar testes, foi adicionada tamb\u00e9m uma porta usb-s\u00e9rie.\nIntrodu\u00e7\u00e3o te\u00f3rica\nRede CAN\nCAN ou CAN-BUS apresenta-se como a abreviatura de Controller Area Network e define-se como um protocolo para comunica\u00e7\u00e3o entre m\u00faltiplos dispositivos. Foi criada pela Bosch, em 1991, para uso na ind\u00fastria autom\u00f3vel, nomeadamente para a liga\u00e7\u00e3o dos controlos nos motores de autom\u00f3veis. Actualmente \u00e9 utilizada em diversas \u00e1reas e define apenas a liga\u00e7\u00e3o f\u00edsica e o controlo do acesso ao meio de transmiss\u00e3o (liga\u00e7\u00e3o de dados).\nAlguns aspectos da rede CAN:\nMulti-master, broadcast, serial bus;\nTaxa de transmiss\u00e3o de 5kBit/s a 1 Mbit/s;\nO tamanho do barramento depende da taxa de transmiss\u00e3o, que \u00e9 de aproximadamente de 40 m @ 1 Mbit/s, 1000m @ 5 Kbit/s;\nCodifica\u00e7\u00e3o dos bits: NRZ - Non return to zero;\nTx/Rx sincroniza\u00e7\u00e3o, usando bit stuffing (5 bits);\nAcesso ao barramento ass\u00edncrono;\nData entre 0 -8 bytes;\nIdentificadores com 11 bits, na vers\u00e3o A, e 29 bits na vers\u00e3o B.\nAs vers\u00f5es acima referidas est\u00e3o esquematizadas na Figura 56, onde \u00e9 poss\u00edvel ver os campos da trama completa. \u00c9 poss\u00edvel utilizar as duas vers\u00f5es (designadas por vezes como standard ou extended) em simult\u00e2neo, desde que:\n\u2022\tSe utilizem ou controladores CAN2.0B ou controladores designados por CAN2.0B passivos;\n\u2022\tUm controlador CAN2.0B passivo detecta as tramas 2.0B pela verifica\u00e7\u00e3o do bit de IDE (Identifier Extension), ignorando-as;\n\u2022 Um controlador 2.0A que, sem esta funcionalidade, reagir\u00e1 a uma trama 2.0B com tramas de erro.\n1bit 11 bit\nSujeito a\n1 bit 1blt 18blt\nBit-Stuffing e CRC\n1blt 1bit1blt 4blt\n0-64bit\n30 F\nIdentific.\nBase\nSRRIDE\nIdentificador\nExtendido\nRTR rv1 rvO DLC\nCampo Dados\n15blt\nSequ\u00eancia Final 1bit 1blt 1blt 7bit\nCRC\tDei CRC\tACK\tDei ACK\tEOF\n(r)\n(r) (r...r)\n(d)\n(r) (r)\napenas no CAN 2.0B\n(d) (d)\nn\u00e3o existe em tramas RTR\n\u2014Campo CRC^Cmp ACK|-\nCampo de Arbitragem\nCampo de____\nControlo\nfigura 56 - Trama CAN.\nA camada f\u00edsica do CAN for\u00e7a a sincroniza\u00e7\u00e3o de todos os n\u00f3s da rede e faz com que haja apenas um \u00fanico bit em qualquer altura no barramento.\nA codifica\u00e7\u00e3o \u00e9 feita atrav\u00e9s de bits dominantes (0) e recessivos (1). Um bit recessivo s\u00f3 aparece no barramento quando todos os n\u00f3s transmitem bits recessivos, bastando que apenas um n\u00f3 transmita um bit dominante para que este prevale\u00e7a. Cada n\u00f3 espera que a CAN esteja inactiva para come\u00e7ar a transmitir uma nova trama, podendo haver v\u00e1rios n\u00f3s a iniciar a transmiss\u00e3o simultaneamente.\nEst. A H 0 FH 0 Q I 1 1 1 |0| 1 | 0 1 Est. B ~| 0 FF 0 0 I 1 1 1 |o 0 OpH Est. C ]ojTLoJTi\u201c i\u201cT;o_p oji;\nBus jomo 01 1 1 1 10 0 0 EH\nfigura 57 - Prioridade sobre o barramento.\nCada mensagem possuiu o seu pr\u00f3prio identificador - quanto menor este for, maior ser\u00e1 a prioridade da mensagem. Em caso de transmiss\u00e3o simult\u00e2nea, cada n\u00f3 tentar\u00e1 transmitir a sua mensagem at\u00e9 que, durante a transmiss\u00e3o do identificador, a mensagem com maior prioridade (com o menor identificador) se imponha sobre as outras. Ap\u00f3s a transmiss\u00e3o do identificador, apenas um n\u00f3 estar\u00e1 a transmitir, com excep\u00e7\u00e3o para o caso da mensagem ser um pedido de transmiss\u00e3o remota (\u00fanico caso em que v\u00e1rios n\u00f3s podem transmitir simultaneamente).\nGatewayPalm - Hardware\nEm termos de hardware, a placa apresenta como componentes principais:\n\u2022\tPIC18F458;\n\u2022\tCAN TRANSCEIVER;\n\u2022\tO m\u00f3dulo bluetooth [19], atrav\u00e9s de um conector, sendo colocada a placa via bluetooth no conector.\nA esse conector tamb\u00e9m se pode ligar um Mini USB-Serial UART Module, para o envio de tramas, bem como testes, atrav\u00e9s da porta serial. \u00c9 de salientar ainda que existe mais electr\u00f3nica de suporte, nomeadamente os reguladores de 12V para 5V, al\u00e9m do regulador de 5V para 3.3V, o RJ45 para programa\u00e7\u00e3o, entre outros.\nNo que diz respeito ao esquema el\u00e9ctrico e de layout da placa, o esquema encontra-se no anexo C.\nGatewayPalm - Software\nExiste um evento, o RX_CAN, que indica que foi recebida uma trama CAN. A partir desse momento, \u00e9 despoletado um evento RX_CAN_DATA, que processa a informa\u00e7\u00e3o vinda da CAN, processando qual a placa que enviou a informa\u00e7\u00e3o e o sinal a que se refere. A partir desse momento, a informa\u00e7\u00e3o \u00e9 adicionada a um buffer at\u00e9 se atingir o comprimento m\u00e1ximo de 70 bytes para uma trama, ou seja, uma trama cont\u00eam v\u00e1rios sinais de maneira a reduzir o overhead. Quando esse comprimento \u00e9 atingido, adicionam-se 2 bytes de CRC e enviam-se para logging, atrav\u00e9s do bluetooth, para o palmtop/PDA a informa\u00e7\u00e3o.\nAl\u00e9m disso do evento j\u00e1 referido, existe um outro evento denominado EV_TICK_QUART_SEC: que, de 250 em 250 ms, envia informa\u00e7\u00e3o para o palmtop/PDA -caso exista, mesmo que n\u00e3o tenha os 70 bytes.\nAspecto das tramas\n00000000 1NNNNNNN BBBSSSSS DDDDDDDD\tHeader 0 Header 1 (Num. De bytes do restante da trama &lt;72) BBB = Board SSSSS = Signal ID Data\nBBBSSSSS\t\nDDDDDDDD\tEm caso de dados multi-byte\nDDDDDDDD\tAdoptar formato big-endian\nCCCCCCCC\tCRC 0\nCCCCCCCC\tCRC1\nTestes efectuados\nFoi poss\u00edvel observar que o envio do comando screen_change do volante para o Palmtop/PDA, atrav\u00e9s do M\u00f3dulo de Controlo e passando pela rede CAN at\u00e9 ao GatewayPalm, era feito de forma \"instant\u00e2nea\", sendo vis\u00edvel no ecr\u00e3 do palmtop/PDA a troca efectuada, n\u00e3o havendo assim a possibilidade de atrasos.\nOutro teste realizado consistiu, essencialmente, em ligar o PC ao M\u00f3dulo de Controlo, via bluetooth, e enviar 1000 tramas de 8 bytes. No palmtop/PDA verificou-se que n\u00e3o se perdiam tramas.\nConclus\u00f5es\nO m\u00f3dulo respons\u00e1vel pela capta\u00e7\u00e3o das tramas na rede CAN consegue envi\u00e1-las para o palmtop/PDA.\nEm rela\u00e7\u00e3o \u00e0 placa, esta \u00e9 composta pela placa sniffer de rede CAN, tendo um conector onde \u00e9 poss\u00edvel colocar uma serial port (mini USB) ou um m\u00f3dulo bluetooth, encontrando-se ambos funcionais.\nDeste modo, foi poss\u00edvel mudar a topologia de rede existindo um programa de Palmtop/PDA funcional e uma nova placa, tamb\u00e9m funcional, que envia os dados para este.\n72\nCap\u00edtulo 7\nConclus\u00f5es gerais\nO desenvolvimento deste trabalho consistiu na cria\u00e7\u00e3o e altera\u00e7\u00e3o de diversos m\u00f3dulos para a teleopera\u00e7\u00e3o de um ve\u00edculo. Analisando cada m\u00f3dulo em detalhe conclui-se que, em rela\u00e7\u00e3o ao m\u00f3dulo de vis\u00e3o remota, embora inicialmente se pensasse que seria algo mais simples, uma vez que se pretendia um sistema mais robusto e com menos lixo no espectro, o sistema tornou-se mais complexo e bastante mais trabalhoso. Foi, tamb\u00e9m, necess\u00e1rio reformular os c\u00e1lculos te\u00f3ricos para algo que, de facto, se enquadrava na realidade.\nNo que diz respeito ao m\u00f3dulo volante, este sistema j\u00e1 se encontrava funcional, tendo sido apenas necess\u00e1rio fazer alguns ajustes para a sua total integra\u00e7\u00e3o no sistema global ICARO. Relativamente \u00e0 utiliza\u00e7\u00e3o do girosc\u00f3pio, n\u00e3o foi poss\u00edvel coloc\u00e1-lo a funcionar correctamente, tendo-se optado pela sua n\u00e3o integra\u00e7\u00e3o no volante.\nA electr\u00f3nica de m\u00f3dulo de controlo/GatewayPalm foi, por sua vez, alterada, deixando de ter as duas fun\u00e7\u00f5es especificadas no ano transacto passando, agora, a receber os comandos do volante, a retransmiti-los para os m\u00f3dulos CAN e a fazer o controlo - quando em condu\u00e7\u00e3o remota. Esta placa, embora funcional, poderia ser melhorada, atrav\u00e9s da alimenta\u00e7\u00e3o dos servos directamente da placa. Esta modifica\u00e7\u00e3o permitiria a n\u00e3o exist\u00eancia de fios soltos mas sim de conectores, atrav\u00e9s de reles que (des)activariam os motores.\nRelativamente \u00e0 cria\u00e7\u00e3o do software do palmtop/PDA e \u00e0 electr\u00f3nica a ele associada, o sistema mostrou-se funcional, necessitando apenas de pequenos ajustes relacionados com o facto da corrida se desenrolar em Hockenheim, Alemanha, no ano de 2009. Tal situa\u00e7\u00e3o obriga a ajustar os par\u00e2metros usados para a dist\u00e2ncia total de pista, o n\u00famero de voltas e o tempo total de prova que, neste momento, est\u00e3o definidos para a prova de Nogaro, Fran\u00e7a. Estas altera\u00e7\u00f5es centrar-se-\u00e3o, essencialmente, na \u00f3ptica do utilizador, uma vez que o palmtop/PDA recebe e processa dados do ve\u00edculo, correctamente. A nova topologia de rede provou ser eficaz, pois possibilita a n\u00e3o exist\u00eancia de uma gateway entre o volante e o ve\u00edculo existindo, agora, 2 liga\u00e7\u00f5es ponto-a-ponto. A nova placa GatewayPalm t\u00eam a fun\u00e7\u00e3o de sniffer da rede CAN e retransmite, por bluetooth, para o palmtop/PDA, provando ser uma boa metodologia a utilizar.\nNuma perspectiva de trabalho futuro, embora a placa do m\u00f3dulo de controlo possa tamb\u00e9m ser inclu\u00edda, esta n\u00e3o \u00e9 priorit\u00e1ria pois, al\u00e9m do girosc\u00f3pio, existe um t\u00f3pico da proposta de trabalho inicial que n\u00e3o foi poss\u00edvel desenvolver neste projecto. Parafraseando, o \"desenvolvimento de algoritmos baseados em processamento digital de imagem com vista \u00e0 integra\u00e7\u00e3o de mecanismos autom\u00e1ticos de suporte \u00e0 seguran\u00e7a, nomeadamente em situa\u00e7\u00f5es de falha de comunica\u00e7\u00e3o entre a box e o ve\u00edculo\u201d, servir\u00e1 como uma primeira etapa para a condu\u00e7\u00e3o aut\u00f3noma do ve\u00edculo.\nRefer\u00eancias\n[1]\t- Daniel Castanheira, \"Teleopera\u00e7\u00e3o de um ve\u00edculo de eco maratona\", IEETA, Universidade de Aveiro 2007.\n[2]\t- http://www.jneuhaus.com/fccindex/470 mhz.html\n[3]\t- http://wireless.per.nl/reference/chaptr03/pel/pel.htm\n[4]\t- ANDERSON ESCUDERO , \"Modelagem para o c\u00e1lculo da perda no percurso de propaga\u00e7\u00e3o em \u00e1reas residenciais nas faixas de VHF e UHF \", Instituto Nacional de Telecomunica\u00e7\u00f5es, 2004.\n[5]\t- Televes: Datasheet 5522, Televes 2007.\n[6]\t- http://maps.google.com/\n[7]\t- Neves, Apontamentos da disciplina de Propaga\u00e7\u00e3o e Radia\u00e7\u00e3o de Ondas Electromagn\u00e9ticas, DETI, Universidade de Aveiro 2007.\n[8]\t- Philips Semiconductors: Datasheet BLF542 , Philips 2003.\n[9]\t- Murata: Datasheet Piezoelectric Vibrating Gyroscope,Murata 2006.\n[10]\t- http://tom.pycke.be/mav/70/gyroscope-to-roll-pitch-and-yaw\n[11]\thttp://www.killerbees33.com/index.php?option=com content&amp;task=view&amp;id=84&amp;Itemid=50\n[12]\t- Microchip: Datasheet PIC18F458, Microchip 2006.\n[13]\t- KONDO - Datasheet KRS-4014, Kondo 2007.\n[14]\t- http://franson.com/bluetools/\n[15]\t- http://labs.developerfusion.co.uk/convert/csharp-to-vb.aspx\n[16]\t- http://www.homeandlearn.co.uk/net/nets9p7.html\n[17]\thttp://blog.opennetcf.org/ctacke/PermaLink,guid,987041fc-2e13-4bab-930a-f79021225b74.aspx\n[18]\t- http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2566824&amp;SiteID=1\n[19]\t- Free2move: Bluetooth Module, Datasheet F2M03GLA , Free2move 2007.\n[20]\t- Microsoft : Visual Basic .NET Passo a Passo , Microsoft 2007.\nAnexo A\n1.\tCreating a bitmap using the stream constructor will construct a DIB (Device Independent Bitmap).\n2.\tCreating a bitmap using the width/height constructor will construct a DDB (Device Dependent Bitmap).\n3.\tDIB's are allocated out of the virtual address space of the application.\n4.\tDDB's are allocated by the driver. This typically means that they are allocated in the virtual address space of gwes.exe. Alternatively, the driver could allocate these in dedicated video ram.\n5.\tCreating a bitmap with the stream constructor will generate a fair amount of garbage as it copies data from one buffer to the other.\nWhen we perform a GC because of an OOM in the stream constructor case, we will almost certainly have some amount of garbage that we can free back to the OS immediately. This will also trigger the finalizer to run on another thread as soon as possible. That should help the next call to bitmap creation.\nWhen we perform a GC because of an OOM in the width/height constructor case, it is fairly likely that the OOM is caused because of virtual memory exhaustion in gwes.exe. Thus freeing memory in our process will not help the memory condition in gwes.exe. We need the bitmap finalizer to run before this would actually free memory in a way that would help this scenario. While the finalizer thread would certainly have been triggered to start, it most likely will not get a chance to free bitmaps before we OOM while trying to allocate a bitmap immediately after triggering a GC on the initial thread.\nIn short, we have 2 different types of Bitmap in our runtime with varying performance and allocation characteristics. DDBs are generally faster to manipulate and draw to the screen than DIBs, but they are constructed in an external memory space that can cause allocation confusion and cause the performance of calls to LockBits or Save to be slow. If a DIB is desired and you wish to construct it based on width and height, we provide a function that constructs a Bitmap with a width, height, and pixelformat specified. This function will construct a DIB instead of a DDB.\nEm suma, quando se utilizam pictureboxs para ir mudando constantemente imagens, os recursos n\u00e3o s\u00e3o libertados.\nExistem 2 poss\u00edveis t\u00e9cnicas para contornar este problema:\nNo final da utiliza\u00e7\u00e3o da picturebox fazer um\nGC.WaitFOrPendingFinalizers()\nGC.Collect()\nQue for\u00e7a o programa a esperar por eventos que ainda n\u00e3o tenham sido finalizados, seguido de um Garbage Collect que fecha todos os recursos que n\u00e3o estejam a ser utilizados.\nPor\u00e9m apresenta alguns problemas nomeadamente que no caso em que tenhamos um programa (como \u00e9 o caso do capitulo 5) que t\u00eam m\u00faltiplos eventos que podem ser chamados podemos correr o risco de eventualmente eliminar recursos utilizados por eventos que realmente precisam deles, o que vai originar instabilidade no programa e processamento de informa\u00e7\u00e3o.\nA outra t\u00e9cnica \u00e9:\nPicturebox.image.dispose()\nPicturebox.image = nova_imagem\nOu seja apagar a imagem antiga e s\u00f3 depois colocar a nova, n\u00e3o deixando a cargo do compilador essa tarefa e sim for\u00e7ando-o a isso. Por\u00e9m esta vertente n\u00e3o \u00e9 100% fi\u00e1vel, pois os recursos continuam a aumentar (a um n\u00edvel muito inferior ao que se regista caso n\u00e3o se fa\u00e7a o dispose da imagem) o que se torna mais evidente em programas como o desta tese em que existem cerca de 20 pictureboxs que podem ser alteradas.\nAnexo B\nMensagens RF\nExistem tr\u00eas liga\u00e7\u00f5es sem fios, uma que comunica com o PDA, outra que permite a comunica\u00e7\u00e3o entre volante -modulo de controlo e outra liga\u00e7\u00e3o que permite a comunica\u00e7\u00e3o com as boxes.\nTramas\n00000000 1NNNNNNN BBBSSSSS DDDDDDDD\tHeader 0 Header 1 (Num. De bytes do restante da trama &lt;72) BBB = Board SSSSS = Signal ID Data\nBBBSSSSS\t\nDDDDDDDD\tEm caso de dados multi-byte\nDDDDDDDD\tAdoptar formato big-endian\nCCCCCCCC\tCRC 0\nCCCCCCCC\tCRC1\nIDs das mensagens circulantes nas liga\u00e7\u00f5es sem fios\nPlaca\tBoard ID\nGateway Palm\t0\nGPS\t1\nRoda\t2\nMotor (monitoriza\u00e7\u00e3o)\t3\nMotor (controlo)\t5\nVolante\t6\nPlaca Gateway Volante (Board ID 0)\nID do sinal\tDescri\u00e7\u00e3o\tN\u00b0 de bytes\tFrequ\u00eancia (n/Seg.)\tN\u00b0 de bytes/Seg.\n2\tStart/Stop\t1\tEspor\u00e1dico(4)\tN.A.\n3\tBuzina\t1\tEspor\u00e1dico(4)\tN.A.\n4\tAcelerador\t1\tEspor\u00e1dico(20)\tN.A.\n5\tScreen Change\t1\tEspor\u00e1dico(4)\tN.A.\n6\tTemp. habit\u00e1culo\t1\t1\t1\n7\tSetPoint acelerador\t1\tEspor\u00e1dico\tN.A.\n8\tReset Roda\t0\tEspor\u00e1dico\tN.A.\n9\tBrake\t1\t20\t20\n10\tSteer\t1\t20\t20\n11\tRemote\t0\tEspor\u00e1dico\tN.A.\nTotais\t\t8\t\t40 a 74\nStart/Stop\tAa\tAa = 0x00 -> Stop pressed aa = 0xFF-> Start pressed\nBuzina\tAa\tAa = 0x00 -> OFF aa= 0xFF -> On\nAcelerador\tAa\tAa= posi\u00e7\u00e3o do acelerador em inteiro (0 - 99=\nScreen Change\tAa\tAa= 0xFF\nTemp. habit\u00e1culo\tAa\t*por de_nir (devolve 0x00 de momento)\nSetpoint acelerador\tAa\taa - setpoint do acelerador em inteiro (0 - 99)\nBrake\tAa\taa - setpoint do trav\u00e3o em inteiro (0 - 99)\nSteer\tAa\taa - setpoint da direc\u00e7\u00e3o em inteiro, graus, (-45 - 45)\nPlaca GPS (Board ID 2)\nID do sinal\tDescri\u00e7\u00e3o\tN\u00b0 de bytes\tFrequ\u00eancia (n/Seg.)\tN\u00b0 de bytes/Seg.\n1\tLatitude\t4\t1\t4\n2\tLongitude\t4\t1\t4\n3\tAltitude\t2\t1\t2\n4\tVelocidade\t2\t1\t2\n5\tDirec\u00e7\u00e3o\t2\t1\t2\n6\tDilui\u00e7\u00e3o\tde precis\u00e3o\t2\t1\t2\n7\tHora\t3\t1\t3\n8\tData\t3\t1\t3\n9\tDados v\u00e1lidos\t1\t1\t1\nTotais\t\t23\t\t23\nLatitude\tDd0,mm,mm1,mm2\nLongitude\tDd1,mm,mm1,mm2\nAltitude\tAaaa\nVelocidade\tVvvv\nDirec\u00e7\u00e3o\tDddd\nDilui\u00e7\u00e3o de precis\u00e3o\tPppp\nHora\tHh , mm , ss\nData\tDd , ms, yy\nDados validos\tV\nLegenda da tabela anterior:\n\u2022\tdd0 - n\u00famero de graus (0 - 90)\n\u2022\tdd1 - n\u00famero de graus (0 - 90)\n\u2022\thh - hora em inteiro (0 - 23)\n\u2022\tmm - n\u00famero de minutos (0 - 59)\n\u2022\tss - segundos em inteiro (0 - 59)\n\u2022\tmm1 - n\u00famero de cent\u00e9simas de minutos (0 - 99)\n\u2022\tmm2 - n\u00famero de decimas de mil\u00e9simas de minuto (0 - 99)\n\u2022\taaaa - altitude em dec\u00edmetros (-32768 - 32767)\n\u2022\tvvvv - velocidade em d\u00e9cimos de n\u00f3 (0 - 18518)\n\u2022\tdddd - direc\u00e7\u00e3o em d\u00e9cimos de grau (0 - 3599)\n\u2022\tpppp - dilui\u00e7\u00e3o de precis\u00e3o em decimas (0 - 999)\n\u2022\tdd - dia em inteiro\n\u2022\tms - m\u00eas em inteiro\n\u2022\tyy - ano em inteiro\n\u2022 v - 0 - invalido; 1 - valido\nPlaca Motor Monitoriza\u00e7\u00e3o (Board ID 3)\nID do sinal\tDescri\u00e7\u00e3o\tN\u00b0 bytes\tFreq.(n/Seg.)\tN\u00b0 bytes/Seg.\n1\tVelocidade\t2\t4\t8\n2\tDist\u00e2ncia\t2\t2\t4\n3\tTempo de prova\t2\t1\t2\n4\tV\u00e1lvula\tde combust\u00edvel\t1\t1\t1\n5\tTens\u00e3o da sonda Lambda\t1\t2\t2\n6\tTemperatura do ar de admiss\u00e3o\t1\t1\t1\n7\tTemperatura do \u00d3leo\t1\t1\t1\n8\tPress\u00e3o\tdo combust\u00edvel\t1\t1\t1\n9\tTens\u00e3o da bateria de controlo\t1\t1\t1\n10\tPress\u00e3o na C\u00e2mara de admiss\u00e3o\t1\t1\t1\n11\tTens\u00e3o na Bateria de pot\u00eancia\t1\t1\t1\n12\tRPMs\t2\t1\t2\n13\tTotal\tde combust\u00edvel\t3\t1\t3\n14\tPosi\u00e7\u00e3o\tdo acelerador\t1\t1\t1\nTotais\t\t20\t\t29\nVelocidade\tIMP(6bits) + WIN(10bits)\tIMP - N\u00famero de impulsos WIN - Janela temporal em m\u00faltiplos de 250^s\nDist\u00e2ncia\tN\tValor dado por D = 345JV r 1000\nTempo de prova\tT\tT - N\u00famero de segundos de prova\nV\u00e1lvula de combust\u00edvel\tF\tF = 0 - V\u00e1lvula de combust\u00edvel fechada F = 1- V\u00e1lvula de combust\u00edvel aberta\nTens\u00e3o da sonda Lambda\tLambda\t5 Lambda *4 255\nTemperatura do ar de admiss\u00e3o\tTAr\t67.582. T.Ar T=\t255\t+5'194\nTemperatura do \u00d3leo\tTOleo\t18xl03.^\u00ed^- 380 -21'\" 20=00\nPress\u00e3o do combust\u00edvel\tPComb\t( PComb\t\\ Pcomb = (5-\t0.5J.bar [ate]\nTens\u00e3o de bateria electr\u00f3nica\tVBATT\tVBATT Vbatt = 14.803.\u2014^\u2014(F)\nAnexo C\nLayouts e esquemas el\u00e9ctricos\nTodas as medidas de dimens\u00f5es das placas est\u00e3o em mil\u00edmetros.\n\u00c9 apresentado os esquemas el\u00e9ctricos e os layouts das placas (vers\u00f5es finais).\nOrdem de aparecimento das placas neste anexo:\n1\u00b0 Conector Bluetooth para a placa GatewayPalm\n2\u00b0 Giroscopio\n3\u00b0 Placa GatewayPalm\n4\u00b0 Filtro UHF\n5\u00b0 Conector USB para a placa GatewayPalm\nU1\t\n\u25a1ND\t\u25a1ND\nSPI OLK\tA oinj\nSPI MEO\tAO|1|\nSPI MCSI\tFIORI\nSPI DBS\tP O|3I\nPCM GLK\tFOR]\nFGM C_T\tP OI5I\nFGM SYN3 USB +\t\nFGM IN\tUHB-\nFlCft]\tUART RTS\nFicen\tlap. era\nFIGf-S]\tUART RlD\nFICO]\tUWRT TKD\nPIC\u00cd1D]\tRESET\nFIC(11]\tVCC\n\t\n\u00b13\t\n\tCTB\n\tRTB\n\tTkD\n23\tRkD\n\tU2\t\t\t\n\tvcc\tRST\t\tRm*\n\t\t\t\t\n\tU=L~i\n\tDI E LED\n\t. R1 _ 470\nZonnection\tLED\n\tn| 113 =\tI JQ 1 PV.E\t\nTJI\t\t\tMW\t\n\u00abO\tF im J\t\tNI\n\t\t3\t~\t\nSHIELD\tRESET\nSHIELD\tFA HEN\n\tCLK1\u00cdW\nWk\tSLEEP\nWkID\trxD\nVttSD\t\nUSBFWR\th?;c\n'.'KJCJ\tRTS#\n\tGTS#\n\u25a1ND\t\n\t\nRxD\t' 4\nTxD\t=\u25a0\nRTS\tR\nGTS\t7\n\u00a3\t\n\tU3E- Serial 232\t\nmt\tJSE-Sexial to Sniffex\t\n\t\u25a1ocumtrt Nurtier\t\nA\tBTP 1.1\tfir. i"}]}}}