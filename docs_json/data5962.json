{"add": {"doc": {"field": [{"@name": "docid", "#text": "BR-TU.08997"}, {"@name": "filename", "#text": "13910_PFC-20141-RicardoSantosdaSilva.pdf"}, {"@name": "filetype", "#text": "PDF"}, {"@name": "text", "#text": "DAS Departamento de Automa\u00e7\u00e3o e Sistemas CTC Centro Tecnol\u00f3gico UFSC Universidade Federal de Santa Catarina\nIdentifica\u00e7\u00e3o de Sistemas Din\u00e2micos N\u00e3o Lineares Utilizando M\u00e9todos de Coloca\u00e7\u00e3o\nMonografia submetida a Universidade Federal de Santa Catarina como requisito para a aprova\u00e7\u00e3o da disciplina:\nDAS 5511: Projeto de Fim de Curso\nRicardo Santos da Silva\nFlorian\u00f3polis, agosto de 2014\nIdentifica\u00e7\u00e3o de Sistemas Din\u00e2micos N\u00e3o Lineares Utilizando Metodos de Coloca\u00e7\u00e3o\nRicardo Santos da Silva\nEsta monografia foi julgada no contexto da disciplina DAS 5511: Projeto de Fim de Curso e aprovada na sua forma final pelo\nCurso de Engenharia de Controle e Automa\u00e7ao Industrial\nBanca Examinadora:\nMarco Aurelio Schmitz de Aguiar\nOrientador Empresa\nEduardo Camponogara Orientador do Curso\nRicardo Jose Rabelo Respons\u00e1vel pela disciplina\n, Avaliador\n, Debatedor\nDebatedor\nResumo\nEste estudo busca o desenvolvimento de t\u00e9cnicas de identifica\u00e7\u00e3o de modelos para sistemas de produc\u00e3o de petr\u00f3leo utilizando o metodo de colocac\u00e3o (collocation method). Combinando este metodo com tecnicas de otimizacao nao-linear resolve-se um problema de encontrar os par\u00e2metros e condicoes iniciais de um modelo din\u00e2mico nao linear que melhor descrevem a resposta de um sistema no tempo.\nO collocation method e um caso particular do metodo Impl\u00edcito de Runge-Kutta (IRK), que consiste na solucao numerica de equacoes diferenciais e equacoes diferenciais algebricas.\nEm particular, inicialmente verifica-se se a estrategia e realizavel utilizando um simples circuito RLC e, apos a validacao, a tecnica e utilizada para resolver a identificacao de um poco produtor de petroleo e gas. Para identificacao da resposta do sistema foi utilizado um modelo de baixa ordem, com apenas 3 estados, que pode ser utilizado numa malha de controle. Utilizando os dados de simulacao deste modelo de baixa ordem, o problema de identificacao e facilmente resolvido com boa precisao. Estes resultados iniciais impulsionaram a busca de dados reais ou de simuladores complexos de fluxo multifasico (e.g.; OLGA) para serem usados como referencias da estrategia.\nA implementacao foi realizada com o emprego de ferramentas de modelagem como Modelica e solvers de otimizacao disponibilizados atraves do pacote Optimica.\nAbstract\nThis study seeks to develop techniques for identifying models for oil production systems using the collocation method. Combining this method with nonlinear optimization techniques results in an effective strategy to find the parameters and initial conditions of a nonlinear dynamic model that best describe the time response of a system.\nThe collocation method is a particular case of the Implicit Runga-Kutta (IRK) method, which is suitable for the numerical solution of differential equations and differential algebraic equations.\nAfter testing and validating the collocation method with a simple application to the identification of the parameters of a RLC circuit, using a simple RLC circuit and after validation, the technique is used to solve the identification of an oil and gas producing well. To identify the system response it was used a low-order model, with only three states, which can be used in a control loop. Using the simulation data of this low-order model, the identification problem is easily solved with good accuracy. The initial results have motivated the search for real data or complex multiphase flow simulators (eg: OLGA) to be used as reference to the strategy.\nThe implementation was carried out with the use of modeling tools like Modelica and the optimization solvers available through the Optimica package.\nContents\n1\tIntrodu\u00e7\u00e3o\t1\n2\tCollocation Method\t3\n2.1\tSistema Dinamicos.................................................. 3\n2.2\tFiltro de Kalman................................................... 5\n2.3\tCollocation Method................................................. 8\n2.4\tPolinomio Deslocado de Gauss-Jacobi............................... 12\n2.5\tOrdem de Convergencia............................................... 14\n2.6\tExemplo............................................................. 14\n2.6.1\tRadau Collocation............................................. 14\n2.6.2\tGauss Collocation........................................... 16\n3\tFerramentas de Implementa\u00e7\u00e3o\t20\n3.1\tModelica ........................................................... 20\n3.2\tOptimica............................................................ 20\n3.3\tJModelica.org....................................................... 22\n3.3.1\tCasADi...................................................... 23\n3.3.2\tSundials ................................................... 23\n3.3.3\tIPOPT....................................................... 23\n4\tEstima\u00e7\u00e3o de Par\u00e2metros\t25\n4.1\tOtimizacao.......................................................... 25\n4.1.1\tFuncao Objetivo............................................. 27\n4.2\tCircuito RLC ....................................................... 29\n4.2.1\tEstimac^o dos Parametros do Circuito RLC.................... 31\n4.3\tPo\u00e7o Produtor de Petr\u00f3leo..................................... 36\n4.3.1\tModelo do Po\u00e7o........................................... 37\n4.3.2\tEstima\u00e7\u00e3o dos Par\u00e2metros de um Po\u00e7o Produtor de Petroleo . .\t39\n4.4\tEstima\u00e7\u00e3o do po\u00e7o com dados................................... 42\n4.4.1\tAnnulus.................................................. 42\n4.4.2\tTubing................................................... 42\n5\tConclus\u00e3o\t47\nBibliography\t48\nAppendix A: Modelos Din\u00e2micos\t50\nA.1\tModelo do Po\u00e7o .............................................. 50\nA.2\tAnnulus...................................................... 53\nA.\t3\tTubing II.................................................... 55\nAppendix B: Modelos de Simula\u00e7\u00e3o\t59\nB.\t1\tModelo RLC ................................................... 59\nB.2\tModelo de Otimiza\u00e7ao\tdo RLC................................... 59\nB.3\tCodigo Python para Simula\u00e7ao e Estima\u00e7ao ..................... 60\nChapterl: Introdu\u00e7\u00e3o\nEstima\u00e7\u00e3o \u00e9 o processo de inferir o valor de uma quantidade de interesse a partir de observa\u00e7\u00f5es indiretas, imprecisas e incertas. O proposito da observa\u00e7ao pode ser, por exemplo: (a) a determina\u00e7ao da (\u00f3rbita de planetas (Laplace, Gauss, Legendre); (b) a determinacao da posicao e velocidade de uma aeronave em um sistema de controle de trafego aereo; (c) a determinacao de par\u00e2metros de um modelo de sistema como forma de predizer o estado f\u00edsico do mesmo, entre outros.\nEm um processo real, existem diversos fatores que podem alterar seu comportamento. Tais fatores sao facilmente notados ao modelar o processo: ao alterar os par\u00e2metros verificamos uma mudanca nas variaveis de sa\u00edda. Por exemplo, a resistencia nos fios de transmissao de energia influenciam a corrente de um circuito eletrico. Essas mudancas, mesmo que sutis, podem influenciar na performance e estabilidade de tecnicas de controle.\nEste trabalho e a extensao de um trabalho anterior [15], onde foram desenvolvidos modelos nao lineares de uma plataforma de producao de petroleo e gas. Com o conhecimento do modelo e possuindo medicoes do processo e poss\u00edvel estimar os par\u00e2metros dos modelos, com a utilizacao de uma ferramenta para amostragem e coleta de dados chamada collocation method [12], [9], e tecnicas de otimizacao. Existem outras tecnicas como o filtro de Kalman, m\u00e1ximum likelihood, entre outras que permitem a estimacao de par\u00e2metros. Entretanto, \u201cverificou-se que as tecnicas de otimizacao sao mais robustas e viaveis do que o filtro de Kalman\u201d[2]. \u201cPara sistemas nao-lineares, o filtro de Kalman e comumente aplicado na pratica. Enquanto o filtro de Kalman e relativamente facil de implementar, tem sido demonstrado que o filtro possui um desempenho insatisfatorio em sistemas altamente nao-lineares\u201d [13].\nAs equacoes dos modelos foram codificadas usando uma linguagem de alto n\u00edvel para modelagem de sistemas chamada Modelica, baseada em equacoes e orientada a objetos projetada para modelagem grafica e textual de sistemas f\u00edsicos complexos. O ambiente computacional JModelica.org foi usado para compilar o modelo. Este ambiente tambem faz a interface do modelo com ferramentas de simulacao e de otimizacao.\nO Cap\u00edtulo 2 descreve o collocation method, ferramenta utilizada para a estimacao dos par\u00e2metros. O Cap\u00edtulo 3 apresenta as ferramentas utilizadas para a\nimplementacao dos problemas. O Cap\u00edtulo 4 descreve os problemas de estimacao e seus resultados. O Cap\u00edtulo 5 apresenta as conclus\u00f5es finais e possibilidades de trabalhos futuros.\nChapter2: Collocation Method\nNeste Cap\u00edtulo sera poss\u00edvel ver uma explicacao sobre sistemas din\u00e2micos, os quais terao seus par\u00e2metros estimados pelo collocation method (combinado de tecnicas de otimizacao). Desta forma, este collocation method e um caso particular do metodo Impl\u00edcito de Runge-Kutta (IRK), onde demonstra-se o equacionamento e deducao deste.\nAlem dessa explicacao, uma outra forma de estimacao de par\u00e2metros tambem e descrita neste Cap\u00edtulo: os filtros de Kalman. Este, porem, e citado brevemente, por conta das desvantagens que apresenta perante o collocation method.\nAo final do Cap\u00edtulo, portanto, apresenta-se um exemplo do collocation method, por ser um metodo mais adequado neste trabalho, para melhor entendimento.\n2.1: Sistema Din\u00e2micos\nUm sistema din\u00e2mico \u00e9 um conceito matem\u00e1tico, caracterizado por uma regra fixa que descreve a dependencia do tempo de um ponto em um espaco geometrico, portanto e um sistema que evolui no tempo. Normalmente, estes sistemas tem entradas e sa\u00eddas. A qualquer momento, um sistema dinamico tem um estado determinado por um vetor de numeros reais que pode ser representado por um ponto em um espaco de estado apropriado. Pequenas variacoes no estado do sistema criam pequenas mudancas nos valores do sistema. A regra de evolucao do sistema dinamico descreve o que os estados futuros seguem a partir do estado atual. A regra e deter-min\u00edstica; em outras palavras, para um dado intervalo de tempo apenas um estado futuro decorre do estado atual. A regra normalmente e definida por um conjunto de equacoes diferenciais algebricas (DAE), no molde de\ndx dt\n= f (x(t),u(t),w(t),t)\ng(x(t),u(t),w(t),t) = 0\n(2.1a)\n(2.1b)\nonde x(t) \u00e9 o vetor de estados do sistema, u(t) \u00e9 o vetor de sinais de controle, w(t) \u00e9 o vetor com as variaveis algebricas e f e g sao funcoes que envolvem todos os componentes anteriores.\nUma vez que o sistema possa ser resolvido, dado um ponto inicial, e poss\u00edvel determinar todas as suas posicoes futuras, uma colecao de pontos conhecidos como trajet\u00f3ria. Para sistemas din\u00e2micos simples, conhecendo a trajet\u00f3ria e muitas vezes suficiente para obter suas posicoes futuras, mas a maioria dos sistemas dinamicos sao muito complicados para serem entendidos em termos de trajetorias individuais. As dificuldades surgem porque:\n\u2022\tOs sistemas estudados somente sao conhecidos de maneira aproximada. Os par\u00e2metros do sistema podem nao ser conhecidos com precisao ou termos da equacao podem estar faltando. As aproximacoes utilizadas podem invalidar a validade ou relevancia de solucoes numericas. Para responder a estas perguntas varias nocoes de estabilidade foram introduzidas no estudo de sistemas dinamicos, como a estabilidade de Lyapunov ou estabilidade estrutural. A estabilidade do sistema dinamico implica que ha uma classe de modelos ou condi-coes iniciais para os quais as trajetorias sejam equivalentes. A operacao para a comparacao de orbitas para estabelecer sua equivalencia muda com as diferentes nocoes de estabilidade.\n\u2022\tO tipo de trajetoria pode ser mais importante do que uma trajetoria particular. Algumas trajetorias podem ser periodicas, enquanto outras podem vagar por diferentes estados do sistema. A classificacao de todas as trajetorias poss\u00edveis levou ao estudo qualitativo de sistemas dinamicos, isto \u00e9, propriedades que nao mudam com a alteracao de coordenadas. Sistemas dinamicos lineares sao exemplos de sistemas dinamicos em que as classes de poss\u00edveis orbitas sao compreendidas.\n\u2022\tO comportamento de trajetorias como uma funcao de um par\u00e2metro pode ser o que e necessario para uma aplicacao. Como o par\u00e2metro pode ser variado, os sistemas dinamicos podem ter pontos de bifurcacao, onde o comportamento qualitativo do sistema dinamico muda. Uma bifurcacao ocorre quando uma pequena mudanca feita nos valores dos par\u00e2metros de um sistema provoca uma mudanca repentina em seu comportamento. O ponto onde essa mudanca ocasiona a bifurcacao e chamado de ponto de bifurcacao. Por exemplo, pode ir de ter apenas movimentos periodicos ao comportamento aparentemente err\u00e2tico, como na transicao para escoamento turbulento de um fluido. Bifurcacoes ocorrem em ambos os sistemas cont\u00ednuos e sistemas discretos.\n2.2: Filtro de Kalman\nO filtro de Kalman \u00e9 um estimador denominado problema linear quadr\u00e1tico, o qual consiste no problema de estimar o estado instant\u00e1neo de um sistema dinamico linear perturbado por ru\u00eddo branco, atraves do uso de medicoes linearmente relacionadas com este estado, porem corrompidas pelo ru\u00eddo branco.\nUma das primeiras aplicacoes do filtro de Kalman foi o controle de sistemas din\u00e1micos complexos tais como: processos de manufatura, aeronautica e astronauti-ca, navios, etc. Desde o momento da sua introducao, o filtro de Kalman tem sido objeto de extensa pesquisa e aplicacao, em especial na area de navegacao autonoma ou assistida. Isto e provavelmente devido, em grande parte, aos avancos da computacao digital que tornaram pratica a utilizacao do filtro, mas tambem a relativa simplicidade e robustez do proprio filtro. Raramente as condicoes necessarias para otimizacao realmente existem e, no entanto, o filtro funciona bem para muitas aplicacoes apesar desta situacao [16].\nPara controlar um sistema dinamico, precisa-se primeiro saber o que ele esta fazendo. Para estas aplicacoes, nem sempre e poss\u00edvel ou desejavel medir toda variavel que se deseja controlar, e o filtro de Kalman permite uma maneira de inferir a informacao faltante atraves de medicoes indiretas e ru\u00eddos.\nSob o ponto de vista pratico, algumas perspectivas do filtro de Kalman [7] podem ser consideradas:\n\u2022\tTrata-se apenas de uma ferramenta: Ele nao resolve nenhum problema por si mesmo. Nao se trata de uma ferramenta f\u00edsica, de um ente ou ferramenta matematica para tornar o trabalho mental mais eficiente.\n\u2022\tE um programa computacional: Ele foi chamado de idealmente preparado para um computador digital, em parte porque utiliza uma representacao finita de um problema de estimacao por um numero fixo de variaveis. Entretanto, admite-se que essas variaveis sejam numeros reais, com precisao infinita.\n\u2022\tTrata-se de uma caracterizacao estat\u00edstica de um problema de estimacao: Ele e mais que um estimador, porque ele propaga o estado corrente de conhecimento de um sistema dinamico, incluindo a influencia estat\u00edstica de perturbacoes randomicas e os efeitos de todas as medicoes passadas.\nO filtro age de forma a minimizar o erro m\u00e9dio quadr\u00e1tico, que \u00e9 a diferen\u00e7a entre o estado predito e o atual. Dado um valor inicial, o filtro prediz o pr\u00f3ximo estado e, baseado na leitura do estado, atualiza a predi\u00e7ao e minimiza o erro em cada atualiza\u00e7ao.\nA caracter\u00edstica recursiva do filtro proporciona uma solu\u00e7ao computacionalmente aceitavel, uma vez que a computacao ocorre a medida que os dados vao sendo processados. O filtro apoia-se no fato de que o ruido e normalmente distribu\u00eddo. Mesmo que essa hipotese nao se confirme, o filtro continua sendo um estimador otimo.\nO filtro de Kalman e baseado em um modelo din\u00e1mico de sistema que representa como seus parametros, representados por um vetor de estados, que variam a medida que o filtro e processado [11]. O modelo e representado por:\nx(k) = F(k, k \u2014 1)x(k \u2014 1) + n(k)\t(2.2)\nonde x(k) representa o vetor de estados, F(k,k \u2014 1) e uma matriz de transicao de estados que mostra como o processo transita do estado k \u2014 1 para o estado k, n(k) e um ruido do sistema e k representa a iteracao do processo ao longo do tempo.\nAlem do modelo din\u00e1mico do sistema, o filtro tem como base a observacao (medida) do sistema, retirado de sensores, que relaciona os sinais anal\u00edticos com o vetor de estado e e descrita por:\ny(k) = h(k)x(k \u2014 1) + e(k)\t(2.3)\nonde y(k) representa o vetor de medicao dos sinais anal\u00edticos, h(k) e a funcao de medicao que relaciona o vetor de estados com o sinal anal\u00edtico e e(k) e o ruido de medicao.\nO filtro de Kalman funciona em duas etapas: predicao e atualizacao. Na fase de predicao o estado atual e estimado com base na leitura realizada do estado anterior. Na fase de atualizacao o estado predito e atualizado com base na leitura do estado em tempo real. Para ajustar a diferenca entre o vetor de estado predito e do atualizado e utilizado o ganho de Kalman, descrito por\ng(k) = P (k \u2014 1)h(k)[h(k)P (k \u2014 1)h(k) + r(k)]-1\t(2.4)\nonde P(k) e a matriz de covariancia do sistema e r(k) e a variancia do ruido de medicao.\nA situa\u00e7\u00e3o ideal \u00e9 quando o ganho de Kalman converge a zero \u00e0 medida que o vetor de estados vai se estabilizando. Entretanto, na pratica, o ganho de Kalman converge a um intervalo pr\u00f3ximo de zero e e determinado pelo ruido do sistema. A matriz de covariancia do sistema pode ser obtida como\nP (k) = [I \u2014 g(k \u2014 1)A.(k)]P (k \u2014 1)[I \u2014 g(k \u2014 1)A.(k)] + g(k \u2014 1)r(k)g(k \u2014 1)\t(2.5)\nonde I representa a matriz identidade.\nDepois de encontrado o ganho de Kalman e atualizada a matriz de covariancia atraves das Equacoes (2.4) e (2.5), respectivamente, e feita a atualizacao do vetor de estados por\nx(k) = x(k \u2014 1) + g(k)[y (k) \u2014 \u00c1(k)x(k \u2014 1)]\t(2.6)\nUm ponto crucial no filtro de Kalman e a estimativa dos valores iniciais do vetor de estados e da matriz de covariancia do sistema, uma vez que no comeco do processo nao existem valores anteriores ao inicial no sinal. A Figura 2.1 apresenta o processo das etapas do filtro.\nNova predi\u00e7\u00e3o\nFigure 2.1: Filtro de Kalman\n2.3: Collocation Method\nO collocation method \u00e9 um m\u00e9todo para a solu\u00e7\u00e3o num\u00e9rica de equa\u00e7\u00f5es diferenciais e equa\u00e7oes diferenciais algebricas (DAE, do ingles Differential Algebraic Equation). A ideia e a de escolher um espaco de dimensao finita de solucoes candidatas e um numero de pontos no dom\u00ednio (chamados collocation points), e selecionar uma solucao que satisfaca a equacao dada nos collocation points.\nO collocation method e um caso particular do metodo Impl\u00edcito de Runge-Kutta (IRK) onde o periodo de integracao numerica [0,T] (ou [t0,tf]) e particionado em ne intervalos. O elemento finito i esta definido no periodo [t^-i,t\u00bb] e cada intervalo e aproximado por um polinomio de ordem nc, onde nc e o numero de collocation points, sendo h\u00bb o comprimento do intervalo. A curva e composta por ne elementos finitos. O elemento finito pode ser observado na Figura 2.2.\nEste polinomio, (\u00bf(t) \u00e9 a aproxima\u00e7\u00e3o do elemento finito i que est\u00e1 definido no per\u00edodo [t\u00bf_i, ], pode ser representado de v\u00e1rias formas, ou seja, series de potencia, polinomio de Newton ou B-splines, no entanto, para desenvolver o metodo de co-loca\u00e7ao e prefer\u00edvel polinomios de interpola\u00e7ao de Lagrange. A razao e que esta classe de polinomios tem propriedades, que serao evidenciadas na pr\u00f3xima se\u00e7ao, de estabilidade, erro nulo para certos problemas e sua formulacao e mais simples, pois os par\u00e2metros do polinomio correspondem aos estados (i.e; os par\u00e2metros da Eq. (2.8)) tem os mesmos limites que os estados, o que significa que uma restricao de estado pode ser aplicada diretamente sobre os coeficientes de aproximacao. A Figura\n2.3\tdemonstra um elemento finito e seus collocation points, apresentando tambem o valor de para cada collocation point.\nO polinomio base de Lagrange e dado por:\nnc\nlk(t) =\nj=0,=k\n(t - tj) (tk \u2014 tj)\n(2.7)\nt e a variavel que seleciona um tempo espec\u00edfico no intervalo, sendo 0 o inicio do intervalo e 1 o fim, tk; k = 1,..., nc o conjunto de collocation points.\nA interpolacao polinomial de Lagrange tem a forma geral:\nnc\nonde lk e o k-\u00e9simo termo da base do polinomio de Lagrange, (k e o coeficiente associado ao k-esimo termo e nc e o n\u00famero de pontos de interpolacao. Verificando a Equacao 2.7, note que lk (tk) = 1, por\u00e9m lk(j) = 0, o que garante que a aproximacao seja igual a curva nos collocation points.\nA normalizacao do tempo permite utilizar os mesmos pontos de interpolacao e polinomios base em todos os elementos de todas as variaveis, simplificando ainda mais o problema. A normalizacao e realizada como segue\nt(r) = ti_i + hiT\t(2.9)\nonde ti e o instante final do elemento i, chamado de ponto do malha de elemento i, e hi e o comprimento do elemento i.\nDerivando uma interpolacao polinomial de Lagrange da Eq. (2.8) e utilizando a normalizacao do tempo da Eq. (2.9) a partir de agora, encontra-se:\nnc\ne a derivada de lk e obtida atraves da regra do produto \u00e7omo:\nlk (t)\nnc\n=\nm=1,=k\n1 TT (t - Ti) (Tk - Tm) j\t(Tk - Tj)\n(2.11)\nNo elemento i o estado x(t) e aproximado por x,(t), assim a aproxima\u00e7ao so sera \u00e7ont\u00ednua se\nXi+i (0) = Xi (1)\n(2.12)\nUma vez que e ne\u00e7essario um ponto de interpola\u00e7ao, no in\u00ed\u00e7io de \u00e7ada elemento para x,, a fim de garantir a \u00e7ontinuidade, define-se\nto :=0\t(2.13)\nsendo to o primeiro collocation point da interpola\u00e7ao.\nPara a aproxima\u00e7ao de X no elemento i usa-se a derivada de x,, \u00e7om o tempo normalizado, os polin\u00f3mios de \u00e7olo\u00e7a\u00e7ao que representam as derivadas do estado sao dados pela regra da \u00e7adeia, para isso e ne\u00e7essario diferen\u00e7iar a Eq. (2.9). Como se segue:\ndt = h, dT\t(2.14a)\n, . dT dx, , . 1 \\,\t.\nxi(T ) =\t(T) = h:\t(214b)\nonde x,^ e o k-esimo collocation point do elemento finito i.\nSeja\nt,,k : t,-i + h,Tk\t(2.15a)\nt\u00ed;k : i G [1... ne], k G [1.. .nc]\t(2.15b)\nEntao os collocation points \u00e7oin\u00e7idem \u00e7om os pontos de interpola\u00e7ao dos polin\u00f3mios de \u00e7olo\u00e7a\u00e7ao, \u00e7om a ex\u00e7ep\u00e7ao de t0 em \u00e7ada elemento. Esses pontos de interpola\u00e7ao sao es\u00e7olhidos \u00e7omo collocation points, porque pode-se fa\u00e7ilmente obter todos os valores de x nesses pontos.\nAssim a aproxima\u00e7ao de x fi\u00e7a\nnc\ne sua derivada e\ndx(t) dr\nnc\n=\nk=0\ndlk(r)\n7 Xik\nhi f (x(ti,k ) 1 ti,k )\nnc\n=\nk=0\ndlk (r)\n7\tXik 1\n(2.17a)\n(2.17b)\nk = 1,...,nc\nNo caso de nc > 1, e preciso garantir a continuidade do sistema\nx1,0 = x0\t(2.18a)\nnc Xi+1,0 =\tlk (1)xik, Vi G [1,ne]\t(2.18b)\nk=0 nc xf\tlk (1)xnek\t(2.18c)\nk=0\nonde xi,0 representa o valor do primeiro estado, no in\u00edcio do primeiro sub-intervalo, xi+i)0 e o valor de estado, no in\u00edcio do intervalo i e xf e o valor de estado, no final do per\u00edodo de simulacao.\nGeneralizando o problema para a interpolacao nao somente dos estados, cons-troi-se um vetor z, definido por\nz(t) = (x(t),u(t),w(t))\t(2.19)\nonde x(t) sao os estados, u(t) o sinal de controle e w(t) variaveis algebricas. No elemento i sao aproximados por um vetor de interpolacao polinomial de Lagrange\nZi(r) = (xi(r ),Ui(r ),Wi(r))\n(2.20)\nAssim, as equa\u00e7\u00f5es para o vetor z(t) s\u00e3o an\u00e1logas \u00e0s dos estados x(t).\n2.4: Polin\u00f3mio Deslocado de Gauss-Jacobi\nA escolha dos pontos de interpola\u00e7\u00e3o restantes e o que define o collocation method espec\u00edfico. Essa escolha e baseada nas ra\u00edzes do polinomio deslocado de Gauss-Jacobi de grau K = nc - a - 0, que pode ser descrito por\nK\nP^(r ) = E(-1)KYj\t(2.21)\nj=0\nonde,\nYo = 1 Y, = (K +1 - j)(K + j + a + ff)\te [1\tK] Y)\tj(j + ff)\t,j G\t'\t(2.22a) (2.22b)\nonde a e s\u00e3o constantes a escolher, definidas no dominio [0 , 1]. O polinomio \u00e9 deslocado no sentido que normalmente esta definido com t g [-1 , 1], enquanto aqui ele esta definido no dominio [0,1]. A combinacao das constantes forma 3 metodos diferentes.\na = 0 e ff = 0 Gauss collocation\na = 1 e ff = 0 Radau collocation\na =1e ff =1 Lobatto collocation\n(2.23a)\n(2.23b)\n(2.23c)\nO m\u00e9todo Lobatto, diferente do Radau e do Gauss, possui um collocation point no in\u00edcio de cada elemento, ou seja, t0 e obtido atraves da Eq. (2.21) e nao pode ser definido como feito na Eq (2.13). Por esta razao, o metodo descrito nesta secao nao pode ser usado para criar um metodo Lobatto. E necessaria uma abordagem diferente para o Lobatto collocation.\nComo exemplo a solucao da Eq. (2.21) e dada para nc de 1 a 4, na Tabela\n2.1\tpara o Radau e na Tabela 2.2 para o Gauss. As solucoes apresentadas estao arredondadas para melhor comparar a diferenca entre os dois metodos. Para nc maiores pode-se utilizar de computadores para a resolucao da Eq. (2.21)\nTable 2.1: Radau Collocation Points (a = 1 e ft = 0)\n\tT1\tT2\tT3\tT4\nnc =1\t1,000\t-\t-\t-\nnc = 2\t0,333\t1,000\t-\t-\nnc = 3\t0,155\t0,644\t1,000\t-\nnc = 4\t0,088\t0,409\t0,787\t1,000\nTable 2.2: Gauss Collocation Points (a = 0 e ff = 0)\n\tT1\tT2\tT3\tT4\nnc =1\t0,500\t-\t-\t-\nnc = 2\t0,211\t0,788\t-\t-\nnc = 3\t0,112\t0,500\t0,887\t-\nnc = 4\t0,069\t0,330\t0,669\t0,930\n2.5: Ordem de Convergencia\nComo mostrado em [3] e [10] o erro global uniforme do estado aproximado no\nelemento i, e\nO (hmin(\u2122e+1.2nc-a-fi))\n(2.24)\nO erro global uniforme das variaveis algebricas aproximadas e variaveis de controle no elemento i e\no(hnc)\n(2.25)\nSe nc > 1 o erro global uniforme \u00e9, portanto, o mesmo para Gauss, Radau e Lobatto.\nNo final/comeco dos elementos, o erro global de todas as variaveis e\no(h2nc-a-fi)\n(2.26)\nAssim, a ordem de converg\u00eancia da solu\u00e7\u00e3o \u00e9 de at\u00e9 duas vezes mais elevada no final/come\u00e7o dos elementos do que no resto do elemento (incluindo os pontos de coloca\u00e7ao). Este fenomeno e chamado super convergencia.\n2.6: Exemplo\nDefine-se o sistema:\ndx 2\n= x2 \u2014 2x + 1,\tx(0) = \u20143\ndt\n(2.27)\ncom t g [0,1]. A solug\u00e1o anal\u00edtica desse sistema \u00e9 dada pela equag\u00e1o x(t) = (4t -3)/(4t +1). Entretanto serao calculadas aproximacoes nUmericas usando o collocation method utilizando as ra\u00edzes do polinomio (2.21) de Radau e Gauss com nc = 3.\n2.6.1: Radau Collocation\nOs collocation points sao tirados do polinomio da Eq. (2.21), substituindo os valores de a e do Radau collocation na Eq. (2.22) e esta na Eq. (2.21), obtem-se\n2\npRadau (t ) = 1 + J2(\u20141)2-j j=i\n(3 \u2014 j)(3+ j) ,\n-----------T\n(2.28)\nCom Radau os collocation points sao t0 = 0, tx = 0.155051, t2 = 0.644949, e t3 = 1. A\nFigura 2.4 demonstra os collocation points em relajo com a resposta anal\u00edtica\n(1)Z\nFigure 2.4: Collocation points do m\u00e9todo de Radau\nUsando a Eq. (2.17b) com N =1 elementos, e hi = 1/N obtem-se\n3\nE\nj=0\ndlj (Tk) Zij\tdT\n= hi(z2j - 2zik + 1),\nk =1,..., 3, i = 1\n(2.29)\nDesenvolvendo a base de Lagrange descrita na Eq. (2.11), encontra-se:\ndlo(Tk) dT\ndli(Tk) dT\nd\u00bf2(Tk ) dT\nd\u00bf3(Tk )\ndT\n-30t2 + 36Tk - 9\n46.7423t2 - 51.2392Tk - 10.0488\n-23.7423t2 + 20.5925Tk - 1.38214\n2 16 1\n10Tk - ITTk + 3\n(2.30a)\n(2.30b)\n(2.30c)\n(2.30d)\nSubstituindo a Eq. (2.30) na Eq. (2.29) encontra-se:\nzo(-30t2 + 36Tk - 9) + zi(46.7423t2 - 51.2392^ + 10.0488)\nZ2(-23.7423t2 + 20.5925Tk - 1.38214) + Z3\n( 2 16 1\\\n(10Tk - TTk +3j\n(2.31)\n= (zk - -\u25a0 + 1), k = i,..., 3\nResolvendo o sistema de equacoes tem-se zx = -1.65701, z2 = 0.032053, z3 = 0.207272 com z0 = -3.\nUm grafico na Figura 2.6 mostra a comparacao do metodo de Radau com o de Gauss, que sera descrito na proxima subsecao, e com a solucao anal\u00edtica.\n2.6.2: Gauss Collocation\nOs collocation points s\u00e3o tirados do polin\u00f3mio da Eq. (2.21), substituindo os valores de a e do Gauss collocation na Eq. (2.22) e esta na Eq. (2.21), obt\u00e9m-se\n3\npGauss(T) =\tv \u25a0\nj=i\n(4 - j)(3+j) i\n------------T j2\n(2.32)\nCom Gauss os collocation points sao t0 = 0, n = 0.112702, t2 = 0.500000, e t3 =\n0.887298. A Figura 2.5 demonstra os collocation points em relagao com a resposta anal\u00edtica\nO equacionamento desenvolvido na Subsecao 2.6.1 nao se altera, por excecao do conjunto de equacoes em (2.31), pois os valores de Tk sao dados pela Eq. (2.32).\nFigure 2.5: Collocation points do m\u00e9todo de Gauss\nResolvendo o sistema de equates, tem-se zx = -1.742931, z2 = -0.2488663, z3 = 0.176679 com z0 = -3.\nA Figura 2.6 mostra os 3 metodos considerados: solucao anal\u00edtica, aproximacao com Gauss collocation e aproximacao com Radau collocation.\nFigure 2.6: Gr\u00e1fico das respostas\nA Tabela 2.3 contem o erro de aproxima\u00e7\u00e3o de Gauss e de Radau em compa-\nracao com a solucao anal\u00edtica. O erro foi calculado com a seguinte formula:\nErro\ngauss\n= !\\z(t)\n0\nErro\nf1\nradau\t(z(t)\n0\nzg (t))2dt\nzr (t))2dt\n(2.33a)\n(2.33b)\nsendo zg (t) a aproximacao da curva pelo Gauss collocation, zr (t) a aproximacao da curva pelo Radau collocation e z(t) a resposta anal\u00edtica.\nTable 2.3: Erro quadr\u00e1tico das curvas\nErro aproxima\u00e7\u00e3o de Gauss\nErro aproxima\u00e7\u00e3o de Radau\n0,0220575614331819\n0,0153388854412689\nChapter3: Ferramentas de Implementa\u00e7\u00e3o\nEsse cap\u00edtulo apresenta as ferramentas utilizadas para modelar e resolver o problema de estimacao de par\u00e2metros.\n3.1: Modelica\nModelica e uma linguagem orientada a objetos desenvolvida para modelar o comportamento din\u00e2mico dos sistemas tecnicos de uma forma simples. Os modelos sao descritos usando equacoes diferenciais, alg\u00e9bricas e discretas. Os modelos tambem podem ser compostos por outros modelos em uma estrutura hier\u00e2rquica. Modelica consegue lidar com problemas grandes e complexos devido a sua capacidade de reutilizacao de modelos.\nModelica e uma linguagem textual, no entanto, existem varios ambientes que fornecem uma interface grafica ao usuario. Algumas implementacoes sao gratuitas e outras comerciais. Ambientes livres sao: OpenModelica (Linkoping University) e JModelica.org (Universidade de Lund). Ambientes comerciais sao: CATIA Systems (Dassault Systemes), Dymola (Dynasim), MapleSim (MAPLESOFT), MathModelica (Wolfram Research), e outros.\n3.2: Optimica\nEnquanto o uso prim\u00e1rio de modelos Modelica e simulacao, varios outros usos estao surgindo. Como nao e viavel recodificar os modelos para cada novo modelo de uso, futuras ferramentas Modelica e tambem a pr\u00f3pria linguagem Modelica, devem acomodar e promover novos usos de modelos Modelica.\nUm exemplo de uso emergente de modelos Modelica e otimizacao dinamica. Uma caracter\u00edstica de problemas de otimizacao dinamica realista e que o procedimento de formulacao de tais problemas e altamente interativo. E comum que uma extensa afinacao da funcao de custo e restricoes seja necess\u00e1ria, a fim de obter uma solucao aceitavel. Esses elementos sao indispensaveis na formulacao de problemas de otimizacao dinamica e nao sao suportados pela linguagem Modelica.\nA fim de formular um problema de otimizacao dinamica, a ser resolvido por um algoritmo numerico, o usuario tem de fornecer diferentes tipos de informacao. E natural categorizar essas informacoes em tres n\u00edveis, o que corresponde ao aumento dos n\u00edveis de detalhe [1].\n\u2022\tN\u00edvel I. No n\u00edvel matematico, uma formulacao can\u00f4nica de um problema de oti-mizacao dinamica e dado. Isto inclui variaveis e par\u00e2metros para otimizar, funcao de custo para minimizar, restricoes e modelo Modelica constituindo a restricao dinamica. O problema formulado \u00e9, em geral, infinito no aspecto de, que nao pode ser usado diretamente atraves de um algoritmo numerico, sem informacao adicional.\n\u2022\tN\u00edvel II. No n\u00edvel da transcricao, um metodo para traduzir o problema a partir de um problema de dimensao infinita para um problema de dimensao finita precisa ser fornecido. Isto pode incluir malhas de discretizacao, bem como estimativas iniciais para os par\u00e2metros de otimizacao e variaveis. Deve ser notado que a informacao necessaria para este n\u00edvel depende do algoritmo numerico que e utilizado para resolver o problema.\n\u2022\tN\u00edvel III. No n\u00edvel do algoritmo, informacoes tais como tolerancias e os parametros de controle do algoritmo podem ser fornecidas. Tais par\u00e2metros sao muitas vezes cr\u00edticos, de modo a obter um desempenho aceitavel em termos de convergencia, confiabilidade numerica e velocidade.\nEm Modelica, apenas as informacoes correspondentes ao N\u00edvel I sao expressas na descricao real do modelo. Para otimizacao dinamica, a necessidade de entrada do usuario no n\u00edvel de algoritmo e mais enfatizada. Algoritmos automaticos, por exemplo para a selecao de malha, existem, mas podem nao serem adequados para todos os tipos de problemas. Por conseguinte, e desejavel incluir, na linguagem, meios para o usuario especificar a maior parte dos aspectos do problema de modo a manter a flexibilidade, permitindo ao mesmo tempo o uso de algoritmos automaticos quando poss\u00edvel e adequado.\nA extensao Optimica permite ao usuario especificar elementos importantes de um problema de otimizacao dinamica, tais como funcoes de custo, restricoes e intervalo de otimizacao. O modelo din\u00e2mico, no qual o problema de otimizacao dinamica e baseado, e expresso usando o padr\u00e2o Modelica. Optimica tambem suporta uma anotacao que permite ao utilizador especificar as propriedades de um metodo de\ntranscricao, baseado na colocacao direta. Devido a estas propriedades, Optimica suporta formulacao de problemas de otimizacao dinamica, utilizando construcoes de alto nivel, tanto no n\u00edvel matematico quanto no nivel da transcricao numerica.\nOptimica apresenta tres aspectos principais no padreo Modelica:\n\u2022\tClasse de otimizacao, uma nova classe de objetos pode ser instanciada. Ela representa o problema de otimizacao. Necessariamente precisa de uma funcao objetivo e variaveis de otimizacao. E importante notar que o horizonte de predicao pode ser uma variavel de otimizacao.\n\u2022\tUma secao de restri\u00e7\u00e3o dentro de elementos de otimizacao. Nesta secao, podem-se declarar igualdades e desigualdades que impoem restricoes as variaveis.\n\u2022\tVariaveis de acesso em tempo. Com o padreo Modelica nao podemos acessar as variaveis em um momento espec\u00edfico. Com Optimica e poss\u00edvel fazer restricoes como: x(tf) = 1 (variavel x no tempo final tf deve ser igual a 1) ou y(5) &lt;3 (variavel y no tempo de 5 deve ser menor do que 3).\n3.3: JModelica.org\nJModelica.org e um pacote para simulacao e otimizacao de modelos Modelica. E desenvolvido em colaboracao entre a industria e academicos, com a finalidade de criar uma plataforma industrialmente viavel usando o estado da arte dos algoritmos para analisar sistemas f\u00edsicos complexos. Python e usado como uma linguagem de programacao para criar uma interface amigavel para todos os componentes do JMo-delica.org [12].\nO ambiente JModelica consiste em um conjunto de m\u00f3dulos de software, incluindo compiladores para Modelica e Optimica, um gerador de codigo para linguagem C, uma biblioteca de tempo de execucao em C, um algoritmo de otimizacao simultanea, e uma biblioteca para integracao com a linguagem de programacao Python. Tambem, internamente, ele se conecta com outras tr\u00eas ferramentas muito usadas: CasADi, Sundials, e IPOPT [15].\nE t\u00edpico que a solucao de problemas de otimizacao din\u00e2micos exigem multiplas iteracoes, em que a funcao de custo, as restricoes, o metodo da transcricao, e mesmo o modelo sao refinados de modo a obter melhores resultados. Os resultados, entao,\nnormalmente precisam ser analisados e os par\u00e2metros de formula\u00e7\u00e3o de otimiza\u00e7\u00e3o ajustados. O uso de linguagens de descri\u00e7\u00e3o de alto nivel libera o usuario da tarefa custosa e propensa a erros de codifica\u00e7\u00e3o das formula\u00e7\u00f5es de modelos e otimiza\u00e7\u00e3o em linguagens menos adequadas. Com efeito, o foco do processo de concep\u00e7ao e transferido da codifica\u00e7ao do problema para a formula\u00e7ao do problema, que se traduz em processos de projeto mais eficientes.\n3.3.1: CasADi\nCasADi e um sistema minimalista de algebra computacional que implementa di-ferencia\u00e7ao automatica, por meio de uma abordagem h\u00edbrida simbolica/numerica. Ele e projetado para ser uma ferramenta de baixo n\u00edvel para a implementa\u00e7ao r\u00e1pida, mas altamente eficiente, de algoritmos de otimiza\u00e7\u00e3o numerica.\nEm otimiza\u00e7ao e importante calcular eficientemente derivados de fun\u00e7ao. Para isso usa-se CasADi (Computer algebra system with Automatic Differentiation). Uma vez que uma representa\u00e7\u00e3o simb\u00f3lica que consiste em objetos CasADi de um problema de NLP foi criada, CasADi fornece todas as informa\u00e7oes das derivadas neces-sarias para a solu\u00e7ao numerica do problema com muito pouco esfor\u00e7o do usuario.\n3.3.2: Sundials\nSundials e um pacote de solvers de ODE e DAE que foi desenvolvido para ser um integrador de tempo robusto e solver nao-linear. O solver mais utilizado e CVODE, um solver de ODE com a capacidade de resolver alguns tipos especiais de DAE que podem calcular automaticamente sensibilidades.\n3.3.3: IPOPT\nIpopt (Interior Point OPTimizer) e um pacote de software para otimiza\u00e7ao nao-linear em grande escalaEle e projetado para encontrar solu\u00e7oes (locais) de problemas de otimiza\u00e7ao matematica.\nIpopt usa um algoritmo de pontos interiores com um filtro do metodo de linesearch. Ele tambem tem uma fun\u00e7ao automatica de problema de escala, algumas heur\u00edsticas para acelerar a convergencia, e algumas tecnicas para aumentar a robustez.\nA Figura 3.1 mostra a esquematiza\u00e7\u00e3o da estrutura dos softwares utilizados na resolu\u00e7\u00e3o de problemas de otimiza\u00e7ao.\nSolution\nPython\nJModelica.org\nFMUX Compiler\nf Modelica I Optimica\nCasADiModel\nK\nC LocalDAECollocationAIg X\nFigure 3.1: Vis\u00e3o geral da estrutura de otimiza\u00e7\u00e3o\nChapter4: Estima\u00e7\u00e3o de Par\u00e2metros\nNeste Cap\u00edtulo apresenta-se a definicao de tecnica de otimizacao e se aplica o collocation method , descrito no Cap\u00edtulo 2, juntamente com essa nova tecnica em um circuito RLC para a validac^o da metodologia.\nAssim que validada, muda-se o sistema: a metodologia e aplicada em um poco produtor de petr\u00f3leo e gas. Neste caso, foi poss\u00edvel obter resultados positivos em relacao aos par\u00e2metros que ser\u00e2o descritos neste Cap\u00edtulo. Os resultados impulsionaram a utilizacao de dados de simuladores mais sofisticados para serem usados como refer\u00eancia da metodologia, porem nao se obtiveram bons resultados, por isso foi necessaria a modificacao do modelo, tornando-o levemente mais sofisticado.\nTodos os codigos utilizados para os modelos e para a resolucao dos problemas de estimacao se encontram no apendice B.\n4.1: Otimiza\u00e7\u00e3o\nNo caso mais simples, um problema de otimizacao consiste em maximizar ou minimizar uma funcao real, escolhendo sistematicamente valores de entrada a partir de um conjunto permitido e calculando o valor da funcao. A generalizacao da teoria de otimizacao e tecnicas para outras formulacoes compreende uma grande area da matematica aplicada. De modo mais geral, a otimizacao busca encontrar \u201co melhor valor poss\u00edvel\u201d de alguma funcao objetivo dado um dom\u00ednio definido (ou um conjunto de restricoes), incluindo uma variedade de diferentes tipos de funcoes objetivo e diferentes tipos de dom\u00ednios. Problemas de otimizacao podem ser divididos em duas categorias, dependendo se as variaveis sao cont\u00ednuas ou discretas. Um problema de otimizacao com variaveis discretas e conhecido como um problema de otimizacao combinatoria.\nUm problema de otimizacao dinamica normalmente tem a seguinte forma:\nmin ^(t,x(t), y(t), w(t), u(t))\ns.t.: x = f (t,x(t), w(t), u(t), O)\ng(t,x(t),y(t),u(t)) = 0\nxL&lt;x(t) &lt;xU yL&lt;y(t) &lt;yU wL&lt;w(t) &lt;wu uL&lt;u(t) &lt;uu OL&lt;O(t) &lt;OU t0&lt;t &lt;tf\n(4.1a)\n(4.1b)\n(4.1c)\n(4.1d)\n(4.1e)\n(4.1f)\n(4-1g)\n(4.1h)\n(4.1i)\nonde\n\u2022\te a funcao objetivo.\n\u2022\tx(t), y(t), w(t), u(t) e O sao os estados, sa\u00edda, variaveis algebricas e de controle e os par\u00e2metros da funcao, respectivamente.\n\u2022\tf e g sao funcoes de estado e funcoes algebricas, respectivamente.\n\u2022\txL e xu sao os limites inferiores e superiores, respectivamente, dos estados.\n\u2022\tyL e yu sao os limites inferiores e superiores, respectivamente, da sa\u00edda.\n\u2022\twL e wu os limites inferiores e superiores, respectivamente, das variaveis alge-bricas.\n\u2022\tuL e uu sao os limites inferiores e superiores, respectivamente, do controle.\n\u2022\tOL e Ou sao os limites inferiores e superiores, respectivamente, dos par\u00e2metros.\nEssas variaveis podem ser discretizadas utilizando o collocation method mostrado nas secoes anteriores. Os limites de variaveis sao os mesmos da formulacao de tempo cont\u00ednua, os quais sao aplicados diretamente sobre os collocation points. Esta facilidade de aplicacao de restricoes e uma das razoes pelas quais o polinomio de interpolacao de Lagrange e escolhido. No entanto, essas restricoes so podem ser asseguradas nos collocation points e nao no intervalo entre eles.\n4.1.1: Fun\u00e7\u00e3o Objetivo\nA formula\u00e7\u00e3o mais comum e flex\u00edvel para a fun\u00e7\u00e3o objetivo integra o erro quadr\u00e1tico ponderado entre os estados, as vari\u00e1veis algebricas, os controles e suas referencias. Esta formulacao permite o controle de diferentes vari\u00e1veis do sistema.\nmin = \u00ed [(x - Xref )TQx(x - Xref) + (y - Vref )T Qy (y - Vref)\nJt0\t(4.2)\n+ (w - Wref )TQw (w - Wref) + (u - Uref )TQu(u - Uref )]dt\nonde Qx, Qy, Qw e Qu sao os fatores de peso dos estados, sa\u00eddas, vari\u00e1veis algebricas e controle, respectivamente.\nNo caso do problema de estimacao de par\u00e2metros, as referencias sao obtidas pelos dados medidos do sistema. Os dados sao compostos das entradas e sa\u00eddas do sistema. Para resolver o problema adicionam-se restricoes as entradas e aos estados, entretanto o mesmo nao pode ser feito com as sa\u00eddas. Essas restricoes de igualdade sao aplicadas apenas nos collocation points, assim forcando as entradas a serem iguais aos dados de referencia. Nesse caso, os par\u00e2metros possuem um valor livre, para que o algoritmo possa encontrar o valor que minimize a funcao objetivo e cumpra com as restricoes. Adicionando as novas restricoes e discretizando com o collocation method as Eqs. (4.1), obtem-se:\nmin\t[(xik\txref (tik)) Qx(xik\txref (tik))\n0 \u00bf. \u00bf.\ni=0 k=0\n+ (yik\tyref (tik )) Qy (yik\tyref (tik)) + (wik\twref (tik)) Qw (wik\twref (tik))\n(4.3a)\n+ (uik\turef (tik)) Qu(uik\turef (tik))]\nnc\nS-t-:\nk=0\ndlk(r) dr\nxik - hif (tik,xik,Uik,0) = 0, V k G [1, nc],i G [1, ne]\n(4.3b)\ng(tik,xik,uik) = 0, V k G [1,... ,nc],i G [1,..., nc]\t(4.3c)\nnc\nxi+i,o =\tIk(1)xik, V i G [1,... ,ne]\t(4.3d)\nk=0\nnc\nxf =\t4 (1)xnek\t(4.3e)\nk=0\nxL &lt;xik &lt;xU\t(4.3f)\nyL &lt;yik &lt;yU\t(4.3g)\nwL &lt;wik &lt;wU\t(4.3h)\nuL &lt;uik &lt;uU\t(4.3i)\nuik uref (tik ) xik xref (tik )\nxi,o = xo\n(4.3j)\n(4.3k)\n(4.3l)\nem que r encontrado dependera do tipo do collocation method, utilizando as Tabelas\n2.1\te 2.2. A Figura 4.1 demonstra um exemplo, apontando onde se encontram os collocation points, elementos finitos e o per\u00edodo da aproximac^o.\n4.2: Circuito RLC\nUm circuito RLC \u00e9 um circuito el\u00e9trico constitu\u00eddo por uma resist\u00eancia, um indutor e um capacitor, ligado em s\u00e9rie ou em paralelo. O circuito forma um oscilador harm\u00f4nico para a corrente que ressoa de forma semelhante a um circuito LC. A principal diferenca da presenca da resistencia e que ela faz com que qualquer oscilacao induzida no circuito ira extinguir-se ao longo do tempo se nao for mantida por uma fonte. Este efeito da resistencia e chamado de amortecimento. A presenca da resistencia tambem reduz ligeiramente a frequencia ressonante de pico. Alguma resistencia e inevitavel em circuitos reais, mesmo se uma resistencia nao esta especificamente inclu\u00edda como um componente.\nHa muitas aplicacoes para este circuito. Eles sao utilizados em diversos tipos diferentes de circuitos osciladores. Outra aplicacao importante e para tuning, como em receptores de radio ou aparelhos de televisao, onde sao usados para selecionar uma estreita faixa de frequ\u00eancias de ondas de radio do ambiente. Um circuito RLC pode ser usado como um filtro passa-banda, filtro rejeita-faixa, filtro passa-baixa ou filtro passa-alta. A Figura 4.2 apresenta um modelo do circuito RLC em serie.\nA equacao diferencial que regula o circuito pode ser encontrada atraves da lei\nde Kirchhoff.\nVr + Vl + Vc = V (t) di\nRi + L\u2014 + Vc = V (t)\ndt\nPela equacao do capacitor temos:\ndVc\ti\n~dt = C\n(4.4a)\n(4.4b)\n(4.5)\nCom isso podemos montar um sistema de equacoes de estado\nx1 = VC(t)\t(4.6a)\nx2 = i(t)\t(4.6b)\nSubstituindo as equacoes (4.6) nas equacoes (4.4b) e (4.5) encontra-se o sis-\ntema abaixo\nX2\nX1 = ~^\n\u2022\tV(t)\nX2 = ~\n\u20221\n~L\nRx2\n~~L~\n(4.7a)\n(4.7b)\n4.2.1: Estima\u00e7\u00e3o dos Par\u00e1metros do Circuito RLC\nUtilizando o modelo descrito anteriormente, propoe-se um problema de estima\u00e7\u00e3o dos par\u00e2metros do circuito, R, L e C utilizando o collocation method e tecnicas de otimizacao. Para isso primeiramente sao necess\u00e1rios dados que sao obtidos a partir de simulacoes. O circuito usado na simulacao tem os par\u00e2metros: R = 200Q, L = 0,01H, C = 1e-3F e uma entrada V(t) = 5V.\nUma vez com os dados e o conhecimento do modelo, simula-se o modelo com uma estimativa inicial dos par\u00e2metros. Essa simulacao fornecera a trajet\u00f3ria de otimizacao usada na estimacao. Apos isso, utiliza-se o collocation method nos dados amostrados de V(t), Vc(t) e I(t), reconstruindo as curvas para entao poder estimar os valores de R, L e C.\nAbaixo encontra-se a Tabela 4.1 com as diferentes situacoes de simulacao, com uma estimativa inicial de R = 400Q, L = 0,02H e C = 2e-3F.\nTable 4.1: Par\u00e2metros Estimados\nEl fin\tCP\tT (s)\tR (Q)\tL (H)\tC (F)\tErro R (%)\tErro L (%)\tErro C (%)\n\t\t\t200,00\t0,01\t0,001\t\t\t\n1000\t1\t54,59\t199,90\t0,00944\t0,0009756\t0,047\t5,590\t2,432\n1000\t10\t465,67\t200,36\t0,00966\t0,0009981\t0,183\t3,345\t0,182\n100\t1\t1,18\t199,88\t0,01543\t0,0007711\t0,055\t54,360\t22,881\n100\t10\t7,55\t201,70\t0,01938\t0,0009916\t0,850\t93,895\t0,832\nPode-se perceber que existe uma troca entre o numero de elementos finitos (El fin) e o numero de collocation points(CP), uma vez que mais elementos finitos aumenta o tempo de processamento, mas tambem aumenta a precis\u00e3o da estimacao. O mesmo ocorre com o numero de collocation points. Entretanto, uma escolha ruim na razao entre esses par\u00e2metros pode ocasionar um aumento desnecess\u00e1rio de tempo de processamento e uma pior estimacao.\nPara melhor estudar esse m\u00e9todo de estima\u00e7\u00e3o de par\u00e2metros, altera-se a entrada, at\u00e9 entao constante para uma serie de degraus, conforme ilustra a Figura 4.3.\nFigure 4.3: Entrada V(t).\nAssim, aplicando a mesma metodologia para o caso de entrada constante, com\nos mesmos valores de parametros e estimativas iniciais encontram-se os resultados mostrados na Tabela 4.2.\n\t\tTable 4.2: Par\u00e2metros Estimados\t\t\t\t\t\t\nEl fin\tCP\tT\tR\tL\tC\tErro R\tErro L\tErro C\n\t\t(s)\t(Q)\t(H)\t(F)\t(%)\t(%)\t(%)\n\t\t\t200,00\t0,01\t0,001\t\t\t\n100\t1\t1,04\t196,62\t0,0004016\t0,00089185\t1,69\t95,984\t10,815\n200\t1\t1,78\t198,26\t0,0005798\t0,00094373\t0,87\t94,202\t5,627\n1000\t1\t28,85\t199,50\t0,0067239\t0,00098881\t0,25\t32,761\t1,119\nApesar de haver um grande erro na estima\u00e7\u00e3o de L, comparando as respostas do sistema com os dois conjuntos de par\u00e2metros nas Figuras 4.4, 4.5, 4.6 e 4.7, observa-se que elas sao equivalentes. Na Tabela 4.3 apresenta-se o erro de aproxima-\u00e7ao do resultado encontrado pelo collocation method em compara\u00e7ao com o sistema simulado. O erro foi calculado com a seguinte formula:\nErro/ =\t(I(t) - Ip(t))2dt\t(4.8a)\nJo\nErroyc = \u00ed ' (Vc(t) - Vp(t))2dt\t(4.8b)\nJo\nErrov\u00e7 =\t(V (t) \u2014 Vp (t))2dt\t(4.8c)\no\nsendo tf o tempo final de simulacao, I(t), VC(t) e Vr(t) a corrente, tensao no capacitor e tensao no resistor do sistema simulado e Ip(t), Vp(t) e Vrp(t) a corrente, tensao no capacitor e tensao no resistor do sistema com os parametros estimados.\nTable 4.3: Erro quadr\u00e9tico RLC\nErro de I\tErro de Vc\n1,15574026e-07 8,81899924e-03\nErro de Vr\n8,88219230e-03\n6\n'0\n2\n6\nT\u00e8mpo [s]\nFigure 4.4: Compara\u00e7\u00e3o entre as 3 entradas V(t).\n\t\t\t\t\u2014 V \u2014 V \u2014 V\tdo sistema simulado do collocation method com os para metros estimados\n\t\t\t\t\t\n\t\t\t\t\t\n\t1\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n4\n10\nCorrente [A]\nFigure 4.5: Compara\u00e7\u00e3o entre as 3 correntes I(t).\nFigure 4.6: Compara\u00e7ao entre as 3 tensoes Vc(t).\nFigure 4.7: Compara\u00e7\u00e3o entre as 3 tens\u00f5es Vr(t).\n4.3: Po\u00e7o Produtor de Petr\u00f3leo\nOs primeiros pocos de petr\u00f3leo nos tempos modernos foram perfurados percus-sivamente, martelando uma ferramenta a cabo na terra. Pouco depois, ferramentas de cabo foram substitu\u00eddas por perfuracao rotativa, o que poderia perfurar pocos a uma profundidade muito maior e em menos tempo. Ate os anos 1970, a maioria dos pocos de petroleo era vertical, embora imperfeicoes causassem o desvio, ao menos levemente de uma exata verticalidade da maior parte dos pocos (o que levou aos pocos direcionais). Entretanto as tecnologias de perfuracao direcional modernas permitem pocos fortemente desviados, os quais podem, dada suficiente profundidade e com as ferramentas apropriadas, tornarem-se horizontais. Isto e de grande valor, na medida em que rochas reservatorio que contem hidrocarbonetos sao normalmente horizontais, ou sub-horizontais; um poco horizontal colocado em uma zona de producao tem mais area de superf\u00edcie na zona de producao que um poco vertical, resultando em uma maior taxa de producao. O uso de perfuracao desviada e horizontal tambem tornou poss\u00edvel chegar a reservatorios a varios quil\u00f4metros de distancia do local de perfuracao (perfuracao de alcance estendido), permitindo a producao de hidrocarbonetos localizados abaixo dos locais que sao ou dif\u00edceis de colocar-se uma sonda de perfuracao, ou ambientalmente sens\u00edveis, ou povoados.\nO gas-lift cont\u00ednuo, metodo de elevacao do petroleo e gas, baseia-se na injec\u00e3o cont\u00ednua de gas a alta pressao na coluna de producao, com o objetivo de gaseificar o fluido desde o ponto de injecao ate a superf\u00edcie. O gas aqui em questao e o gas natural, fruto da producao do proprio poco, que e comprimido em compressores na plataforma e enviado ao annulus do poco atraves de uma linha de servico. Na superf\u00edcie, o controle da injecao de gas no poco e feito atraves de um regulador de fluxo, ou choke. Ja no poco ha uma valvula de gas lift que promove a comunicacao entre o annulus e a coluna de producao (tubing) e segue pela linha de producao ate chegar a plataforma. A valvula de gas lift tem a funcao de controlar o fluxo de gas e estabelecer contato entre o annulus e o tubing.\nOs modelos da rede de extracao de petroleo considerados neste trabalho foram modelados em [15]. Esta secao e dedicada ao modelo do poco produtor, onde e aplicado o metodo proposto para a estimacao de par\u00e2metros.\n4.3.1: Modelo do Po\u00e7o\nO poco e o principal atuador de um reservat\u00f3rio de petr\u00f3leo, sendo composto por varias pecas distintas: choke de gas-lift, a valvula de injecao, anulus, tubo de revestimento, e choke de producao.\nA operacao de um poco pode ser descrita pelas seguintes etapas:\n1.\tO gas injetado passa atraves do choke de gas-lift e aumenta a pressao do anulus.\n2.\tComo a pressao no anulus excede a pressao na tubulacao (tubing), o gas comeca a fluir atraves da valvula de injecao (injection valve).\n3.O gas injetado se mistura com o fluido que emana a partir do reservatorio e reduz a densidade geral.\n4.\tCom uma densidade inferior, a contrapressao induzida pelo fluido e reduzida facilitando o fluir para a superf\u00edcie.\nO modelo de Binder [4] e uma extens\u00e3o do modelo de Eikrem, um modelo que tem sido desenvolvido e usado nos ultimos 10 anos [15]. O esquema do poco pode ser observado na Figura 4.8. Uma versao anterior do modelo foi comparado com o simulador OLGA, mesmo com a simplicidade os resultados tem fidelidade consider\u00e1vel. O modelo tem apenas 3 ODEs e algumas equacoes algebricas e ainda pode representar a maioria das caracter\u00edsticas e restricoes do poco. Por estas razoes e o modelo usado.\nAs principais premissas do modelo sao:\n\u2022\tA producao de oleo e descrita pela equacao de Vogel [8].\n\u2022\tA producao de gas e producao de agua e dada pela relacao l\u00edquidor\u00e1gua (watercut) e razao gas-oleo (GOR).\n\u2022\tA distribuicao das massas dos tr\u00eas fluidos ocorre sem demora de transporte.\n\u2022\tA friccao entre os fluidos e a parede do anulo/tubo nao e considerada.\n\u2022\tAs press\u00f5es sao obtidas pelas leis de gas ideal e efeito gravitacional de l\u00edquidos.\nO modelo descreve o sistema din\u00e2mico usando 3 estados e 3 entradas \u2014 wgi(vazao do gas de injecao), upc(production choke), e pds(pressao downstream) e suas equacoes completas sao apresentadas no ap\u00eandice A.1:\nReservoir\nAnnulus\nTubing\nInjection valve\nGas lift choke\nGas in\nProduction choke\n\u2022&lt;*> Oil out\n/ Casing\nFigure 4.8: Esquema de um Po\u00e7o.\nmga\twin\twgi\nm gt = wgr + wgi \u2014 wgp\nm lt \u2014 wlr\twlp\nwout\tfc (m;pds;upc)\nMassa de g\u00e1s no Annulus\nMassa de g\u00e1s na Tubula\u00e7\u00e1o\nMassa de l\u00edquido na Tubula\u00e7\u00e3o choke flow\n(4.9)\nm =\nNo anulus, a entrada de gas-lift win aumenta a massa de g\u00e1s mga do anulus, enquanto o fluxo atraves da vaivula de inje\u00e7ao wgi reduz. O gas proveniente do reservat\u00f3rio wgr adiciona-se ao gas proveniente do anulus wgi e e reduzida a partir do gas que flui atraves do choke de produ\u00e7ao wgp descrevendo a dinamica da massa de gas no tubo. A massa de l\u00edquido na tubula\u00e7ao e a integral no tempo do l\u00edquido que flui do reservatorio wlr descontado pelo fluxo l\u00edquido de sa\u00edda atraves do choke de produ\u00e7ao wlp. O vetor de fluxo de gas, oleo e agua wout e funcao dos estados m = (mga, mgt, mlt), da abertura do estrangulamento de producao upc e da pressao a jusante de estrangulamento pds, que depende do estado dos oleodutos.\nA principal diferen\u00e7a entre os modelos de Binder e Eikrem \u00e9 que, no modelo de Binder, o reservat\u00f3rio nao so produz petroleo e gas, mas agua tambem. Portanto, algumas altera\u00e7\u00f5es foram feitas nas equa\u00e7\u00f5es de densidade e pressao.\nAmbos os modelos consideraram a abertura do choke de produ\u00e7ao upc como uma variavel controlavel, no entanto, para reduzir a complexidade do problema se assume que ela esta sempre totalmente aberta, uma vez que qualquer outra posicao do choke iria reduzir a producao de petroleo.\nUma modificacao adicional para o modelo de Binder foi necessaria para atender a caracter\u00edstica de nao-retorno no choke de gas-lift. Deve haver fluxo no choke apenas se a pressao no annulus e inferior a pressao antes do choke. Devido a esta limitacao, a injecao de gas-lift deve estar dentro dos limites:\npgm\tpta\n0 &lt;wgl &lt;wgl\t= fgv(pgm \u2014 pta)\n(4.10a)\n(4.10b)\nsendo wg(ax o fluxo quando o choke de gas-lift esta totalmente aberto. Esse valor pode ser encontrado utilizando a funcao do choke, que e dependente da diferenca de pressao entre o tubo de distribuicao de gas-lift (pgm) e a parte superior do anulus (pta).\n4.3.2: Estima\u00e7\u00e3o dos Par\u00e2metros de um Po\u00e7o Produtor de Petr\u00f3leo\nUtilizando a mesma metodologia da secao anterior, apresenta-se o problema de estimacao dos par\u00e2metros de um poco de petr\u00f3leo. Os par\u00e2metros a serem estimados sao os coeficientes das valvulas de injecao, Civ, e de producao, Cpc, e as condicoes iniciais da massa de gas no anular do poco e na tubulacao do poco e massa de l\u00edquido na tubulacao do poco, respectivamente, mga0, mgt0 e mlt0.\nAbaixo encontra-se a Tabela 4.4 com as diferentes situacoes de simulacao, com uma estimativa inicial de Civ = 0,00017, Cpc = 0,0019, mga0 = 3700, mgt0 = 1450 e mlt0 = 3400\nMesmo com 200 elementos finitos, que apresenta a maior porcentagem de erro, o sistema ainda se comporta como o sistema simulado, como pode ser observado nas Figuras 4.9 e 4.10. A Figura 4.11 mostra a localizacao das medicoes dos dados coletados.\nTable 4.4: Par\u00e2metros Estimados\nElem fin\tT(s)\tC\tC\tmga0\tmgt0\tmito\n\t\t0,00016\t0,0014\t3629,07\t1389,20\t3352,26\n200\t7,18\t0,0001599\t0,0014006\t3633,32\t1388,19\t3275,61\n500\t48,34\t0,0001599\t0,0014002\t3630,80\t1389,24\t3320,57\n1000\t99,57\t0,0001599\t0,0014001\t3629,92\t1389,26\t3336,51\nFigure 4.9: Compara\u00e7\u00e3o da press\u00e3o upstream da v\u00e1lvula de produ\u00e7\u00e3o (pp) e press\u00e3o downstream da valvula de inje\u00e7ao (pto).\n\t\t\t\t\u2014 Fluxo de gas do sistema simulado Fluxo de oleo do sistema simulado Fluxo de agua do sistema simulado Fluxo de oas com os Darametros estimados\t\n\t\t\t\tFluxo de oleo Fluxo de agua\tcom os para metros estimados com os para metros estimados\n\t\t\t\t\t\n\\ \\\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t\t\n400\n16\n14\n12\n200\n600\n800\nT\u00e8mpo [s]\n1000\nFigure 4.10: Compara\u00e7ao dos fluxos de produ\u00e7ao de g\u00e1s, oleo e agua.\nProduction\nGas in\nchoke\nFigure 4.11: Esquema das medi\u00e7\u00f5es dos dados coletados.\n4.4: Estima\u00e7\u00e3o do po\u00e7o com dados\nA metodologia empregada ate agora utilizava o proprio modelo para estimacao, entretanto isso nao e poss\u00edvel numa aplicacao fora do mundo academico. Pensando nisso, abordou-se um modelo de uma ordem muito maior para se ter como refer\u00eancia para a estimacao. Os dados obtidos vem do modelo descrito em [14].\nApos alguns testes, notou-se que o modelo utilizado anteriormente era muito simples e nao conseguiria replicar o comportamento dos dados. Por isso foi alterado e decidiu-se por desacoplar o poco, permitindo lidar com o annulus e o tubing de maneira separada. Os novos modelos sao descritos em [6], um trabalho ainda em andamento e nos Ap\u00eandices A.2 e A.3.\n4.4.1: Annulus\nO modelo modificado do annulus apresenta elementos de atrito para melhor representar os efeitos no sistema real. Essa modificacao ja e suficiente para aplicar a metodologia proposta. Entretanto o modelo continua simples, com apenas 1 estado, as modificacoes podem ser observadas no apendice A.2. Os par\u00e2metros a serem estimados sao: o coeficiente da valvula Civ e a condicao inicial da massa de gas no anular do poco, mga0. A Tabela 4.5 apresenta o resultado da estimacao. Pode-se perceber, que por causa da separacao, mesmo com um numero grande de elementos finitos, apresenta um tempo r\u00e2pido de solucao.\nTable 4.5: Par\u00e2metros Estimados\nElem fin\tT(s)\tCiv\tmga0\n1440\t49,21\t0,0001357\t6569,80\nAs Figuras 4.12, 4.13 e 4.14 apresentam as compara\u00e7\u00f5es entre as medi\u00e7\u00f5es e o modelo simulado com os par\u00e2metros apresentados na Tabela 4.5.\n4.4.2: Tubing\nO modelo modificado do tubing apresenta elementos de atrito para melhor representar os efeitos no sistema real. Algumas modifica\u00e7oes adicionais foram neces-sarias para melhor simular o ambiente real. Um novo estado foi adicionado, a fracao massica de gas e outros par\u00e2metros de tuning de atrito. Entretanto o modelo continua simples, com apenas 3 estados, as modificacoes podem ser observadas no\nFigure 4.12: Compara\u00e7\u00e3o das pressoes de fundo e topo do annulus.\nFigure 4.13: Compara\u00e7\u00e3o das pressoes de bottom hole.\nap\u00e9ndice A.3. Os parametros a serem estimados sao: o coeficiente da valvula Cpc, os par\u00e1metros de tuning de atrito k e k2 e as condicoes iniciais da massa de gas, de l\u00edquido e de fracao massica de gas no tubing do poco, respectivamente, mgt0, mlt0 e x0 A Tabela 4.6 apresenta o resultado da estimacao.\nTable 4.6: Parametros Estimados\nElem fin\tT(s)\tCpc\tk\tk2\tmgt0\tmit0\tX0\n1440\t12,84\t0,050005\t0,464221\t1,18581\t171,9171\t4973,5314\t0.14999\nMedido\nPar\u00e1metro estimado |\nS ff 18\n\n1.2\n5000\n10000\n15000\n30000\n35000\n40000\n45000\n20000\t25000\nTime (seconds)\n100\nFigure 4.14: Compara\u00e7\u00e3o das vaz\u00f5es de enrtada e de sa\u00edda do annulus.\nAs Figuras 4.15 e 4.16 apresentam as compara\u00e7\u00f5es entre as medi\u00e7\u00f5es e o modelo simulado com os par\u00e2metros apresentados na Tabela 4.6.\nMesmo com as modifica\u00e7oes, a pressao de produ\u00e7ao (pp) nao consegue seguir a curva medida do simulador. Contudo pode-se observar pelas Figuras 4.15 e 4.16 que as vazoes e a pressao de bottom hole se aproximam muito do simulador, por isso o resultado ainda e satisfat\u00f3rio, pois ainda pode-se utilizar disso para algumas aplicacoes.\n45\n3:\no5\u2019\ni\u2014*\nO\u00ed\nQ o\n\nC\nte\n20\n\u2014\tMedido\n\u2014\tParametros estimados\nO>\nt\u00ed\nte\nt\u00ed\nt-i\n\u00cdT\nte\ng\n\u00a3\n17\n16\nJ 15 ni\nS 14\n2\n\u00cdS 13 s\n\u00a7 12 E\nD\n\u00b0 11\n\u20195\nCT\n\u25a1 10\nr\n9\t\u2014 Medido\n\u2014 Para metros estimados\n80\t5000\t10000\t15000\t20000\t25000\t30000\t35000\t40000\t45000\nTime (seconds)\n\u25a0S\u00ed\nu 16 \u00a3\nE 14\nO 12\n\u00a12\n10\n18\n\n80\t5000\t10000\t15000\t20000\t25000\t30000\t35000\t40000\t45000\nTime (seconds)\nFigure 4.16: Comparagao das pressoes de produgao e de bottom hole.\nChapter5: Conclus\u00e3o\nEste trabalho apresentou o collocation method, a diferenca entre o Gauss collocation e Radau collocation, expondo seu equacionamento e deducao matematica. Um exemplo de Radau e Gauss collocation e demonstrado para melhor fixar o metodo.\nUma ferramenta interessante foi apresentada neste trabalho, o JModelica.org que implementa os compiladores para Modelica e Optimica e que reune ferramentas para simulacro e otimizacao. Modelica e Optimica permitem modelar e criar problemas de otimizacao din\u00e2mica com facilidade. A plataforma JModelica.org teve um papel importante no desenvolvimento e analise dos modelos e da estrutura de controle. A linguagem Modelica ajudou a especificar DAEs modulares que representassem componentes f\u00edsicos da rede de producao, enquanto a linguagem Optimica nos permitiu definir estrategias de estimacao.\nA estimacao foi implementada utilizando o collocation method combinado com tecnicas de otimizacao que sao mais robustas e viaveis do que outros metodos (e.g; filtro de Kalman). O metodo foi demonstrado, seguido por um exemplo explicativo e demonstracao de como ele pode ser usado para formular problemas de otimizacao nao-linear.\nA validacao da estrategia desenvolvida com o circuito RLC, permitiu o avanco do estudo para um modelo de poco produtor de gas e oleo de pequena ordem. Com os resultados apresentados abordou-se um problema mais pratico. Utilizando dados de um simulador de grande ordem foi poss\u00edvel estimar par\u00e2metros que aproximavam o modelo de menor ordem ao do simulador. Este resultado permite a utilizacao de simuladores mais simples, facilitando calculos (e.g; controle) e diminuindo o tempo de processamento para simulacoes. Como continuacao deste trabalho, pode-se prosseguir na verificacao dos modelos de forma a melhora-los, mas mantendo a sua forma simples, a ponto de se aproximar ainda mais do simulador. Outro ponto seria a utilizacao dessa mesma estrategia em outros componentes de uma rede de extracao de oleo e gas.\nBibliography\n[1]\tJohan Akesson. Optimica: An extension of modelica supporting dynamic optimization. Proc. 6th Int. Model. Conf. 2008, 2008.\n[2]\tJS Albuquerque and LT Biegler. Decomposition algorithms for on-line estimation with nonlinear models. Comput. Chem. Eng., 1995.\n[3]\tUM Ascher and LR Petzold. Computer methods for ordinary differential equations and differential algebraic equations. SIAM: Society for Industrial and Applied Mathematics, 1998.\n[4]\tBJT Binder. Production Optimization in a Cluster of Gas-Lift Wells, 2012.\n[5]\tGO Brown. The history of the Darcy-Weisbach equation for pipe flow resistance. Environ. Water Resour. Hist., pages 34-43, 2002.\n[6]\tMarco Aurelio S. de Aguiar, Andres Codas, and Eduardo Camponogara. A Collocation-Based Approach for Optimal Control of Offshore Oil Production Networks.\n[7]\tCarlos Henrique Farias dos Santos. Teoria E Pratica Do Filtro De Kalman.\n[8]\tK.A. Fattah, M Elias, HA El-Banbi, and ESA El-Tayeb. New Inflow Performance Relationship For Solution-Gas Drive Oil Reservoirs. J. Pet. Technol., 20(1):343-366, 2012.\n[9]\tShivakumar Kameswaran and Lorenz T. Biegler. Convergence rates for direct transcription of optimal control problems using collocation at Radau points. Comput. Optim. Appl., 41(1):81-126, November 2007.\n[10]\tS Karneswaran and LT Biegler. Convergence rates for direct transcription of optimal control problems with final-time equality constraints using collocation at Radau points. Am. Control Conf. ..., pages 165-171, 2006.\n[11]\tDaniel Vitor De Lucena. Filtering and improving of spectra with Kalman filter. Abakos, 1(2), 2013.\n[12]\tFredrik Magnusson. Collocation methods in JModelica. org, 2012.\n[13]\tBethany Nicholson, Rodrigo Lopez-Negrete, and Lorenz T Biegler. On-line state estimation of nonlinear dynamic systems with gross errors. Comput. Chem. Eng., December 2013.\n[14]\tAgustinho Plucenio, C. A. Ganzaroli, and Daniel J. Pagano. Stabilizing gas-lift well dynamics with free operating point. In 2012 IFAC Work. Autom. Control Offshore Oil Gas Prod., number 2010, pages 95-100, 2012.\n[15]\tMarco Schmitz de Aguiar. Optimal oil production network control using Modelica, 2013.\n[16]\tGreg Welch and Gary Bishop. An introduction to the Kalman filter, 1995.\nAppendix A: Modelos Din\u00e2micos\nA.1: Modelo do Po\u00e7o\nEstas s\u00e3o as equa\u00e7\u00f5es do modelo descrito em 4.3.\nBalan\u00e7o de Massa:\nmga Wgl Wgi r\u00e2gt = wgr + wgi \u2014 Wgp m lt = wgl \u2014 wgi\nFluxo de Massa:\nWgi = Civ Pgi max(0, pai \u2014 pti)\nWp = Cp^/pp max(0,Pai \u2014 Pti)\nmgt\nWgp =\tWp\nm\nmit\nwip\twp\nmt\nWop   (1 rwc)wlp\nWwp\trwcWlp\nWlr = PlQmax 1 \u2014 (1 \u2014 C) (\t\u2014 C\nWgr = TglrWlr\nWmax = Cgl Pgl max(0, Pgm \u2014 Pta)\n(A.1a)\n(A.1b)\n(A.1c)\n(A.2a)\n(A.2b)\n(A.2c)\n(A.2d)\n(A.2e)\n(A.2f)\n(A.2g)\n(A.2h)\n(A.2i)\nPressoes\n\u00ed RTa\tg\\\nPai = VM +2A.J m\u201c\nRTtmgt\tgm\nPp = MgVt -\t- 2At\nPti\ngmt\n= Pp + aT\nrglrgMgLw\n1 + rglr + 2RT\tPti + Pl gLw\nPbh\nPta\n1 + rglr -\nRTa\tg\nVMg - 2AaJ ga\nrgkgMgLw\n2RTt\n(A.3a)\n(A.3b)\n(A.3c)\n(A.3d)\n(A.3e)\nDensidades:\npgi = RT pai\t(A.4a)\n_\tPlMgPpmt Pp\tpiRTtmn + MgPpmgt\t(A.4b)\npl\trwcpw + (1\trwc)po\t(A.4c)\nMg\t\npgl = RT pgm\t(A.4d)\nTable A.1: Vari\u00e1veis do modelo do po\u00e7o\nNome\tTipo\tExplica\u00e7\u00e3o\nm ga\tEstado\tMassa de g\u00e1s no annulus\nm gt\tEstado\tMassa de gas no tubing\nTh lr\tEstado\tMassa de l\u00e1quido no the tubing\nwgi\tAlg\u00e9brico\tVaz\u00e3o de massa na valvula de injec\u00e3o\nWp\tAlg\u00e9brico\tVazao de massa no choke de producao\nwgp\tAlg\u00e1brico\tProdu\u00e7ao de g\u00e1s\nwlp\tAlg\u00e1brico\tProduc\u00e3o de l\u00edquido\nwop\tAlg\u00e1brico\tProducao de oleo\nwwp\tAlg\u00e1brico\tProducao de \u00e1gua\nwir\tAlg\u00e1brico\tL\u00edquido extra\u00eddo do reservat\u00f3rio\nwgr\tAlg\u00e1brico\tGas extra\u00eddo do reservat\u00f3rio\npgi\tAlg\u00e1brico\tDensidade do gas upstream da valvula de injec\u00e3o\npp\tAlg\u00e1brico\tDensidade da producao upstream do choke de producao\nPai\tAlg\u00e1brico\tPress\u00e3o upstream da valvula de inje\u00e7\u00e3o\nPp\tAlg\u00e1brico\tPressao upstream da valvula de producao\nPti\tAlg\u00e1brico\tPressao downstream de inje\u00e7\u00e3o\nPbh\tAlg\u00e1brico\tPress\u00e3o no bottom hole\nTable A.2: Vari\u00e1veis do modelo do po\u00e7o\nNome\tTipo\tExplica\u00e7\u00e3o\nCiv\tTunning\tCoeficiente de v\u00e1vlula de inje\u00e7ao\nCpc\tTunning\tChoke de produc\u00e3o\nrwc\tReservat\u00f3rio\tWatercut do reservat\u00f3rio\nQmax\tReservat\u00f3rio\tVaz\u00e3o teorica m\u00e1xima do reservat\u00e1rio\nC\tConstante\tConstante de Voegel\nPr\tReservat\u00f3rio\tPressao de reservat\u00f3rio\nrgor\tReservat\u00f3rio\tRazao g\u00e1s-\u00e1leo\nR\tConstante\tConstante de g\u00e1s ideal\nT T a\tPo\u00e7o\tTemperatura do annulus\ng\tConstante\tGravidade\nVa\tPo\u00e7o\tVolume do Annulus\nMg\tPar\u00e2metro\tMassa molar do gas\nAa\tPo\u00e7o\tArea da seccao do annulus\nTt\tPo\u00e7o\tTemperatura do tubing\nVt\tPo\u00e7o\tVolume do tubing\nAt\tPo\u00e7o\tArea da sec\u00e7ao do tubing\nrglr\tReservat\u00f3rio\tRaz\u00e3o g\u00e1s-l\u00e1quido\nLw\tPo\u00e7o\tComprimento do tubing do reservat\u00f3rio para ponto de injecao\npi\tPar\u00e2metro\tDensidade de massa l\u00e1quida\npw\tPar\u00e2metro\tDensidade de massa de agua\npo\tPar\u00e2metro\tDensidade de massa de oleo\nA.2: Annulus\nA equa\u00e7\u00e3o Darcy-Weisbach [5] \u00e9 dada por:\nPf - Po =\n. pLU2 fD 2D\n(A.5)\nonde pf e p0 sao press\u00f5es em dois pontos diferentes em um tubo, fD \u00e9 fator de atrito de Darcy, L e a distancia entre os pontos, D o diametro do tubo, e U e a velocidade media (m/s) do fluido. O fD e dado por:\n/\trz \u00a3\t\\ i.ii 6 91\\ 2\nfD = (-1-8Io\u00ab\u00bb[( 3td)\t+ r\\)\t(A.6)\nporque a velocidade media e dif\u00edcil de calcular e formulas complexas podem resultar em equacoes impl\u00edcitas, que sao caras para resolver, e aproximada por\nU ~ Win = WinV = WinL\t(A 7)\n~ Ap\tAm m\t( . )\ncom A sendo a area de secao transversal, p a densidade media do fluido que pode ser substitu\u00eddo por m/V, onde m e a massa de l\u00edquido na secao e V o volume. O numero de Reynold Re pode ser definido como::\nRe =\npDU\nWinD\npA\n(A.8)\nP\nonde p \u00e9 a viscosidade din\u00e2mica e win \u00e9 o fluxo de entrada no annulus.\nPara um comprimento substancialmente pequeno dh a queda de pressao d&amp;p\ne:\ndp = fD\n1 pU2\nD 2\ndh\n(A.9)\nUsando a formula de pressao hidrostatica:\ndp = -pg dh\n(A.10)\nSomando-se a dinamica de ambos os fen\u00f4menos, a resultante e\ndp = p\n-g + fD\n1 U2_\nD ~2\ndh\n(A.11)\nse um fluxo contrario na direcao de h e assumida. Usando a lei dos gases ideais::\npV = nRT pV = Mr * p = T\n(A.12a)\n(A.14)\nque produz:\npM r\t1 U2_|\ndp = RT -9 + 'D-\nRT\ndp\np\nm\nRT\n-a - f 1U21\n9 fD d 2\ndh\npor uma questao de legibilidade C e definido como:\nm r f i U2' RT -9 - fD D T\n(A.15)\nintegrando ambos os lados:\nlogpf - logpo = C(hf - ho)\n(A.16a)\nAplicando ao annulus:\npf = p0eC(hf h0)\n(A.16b)\npta \u2014 pbae\nCLa\n(A.17)\nonde ba significa fundo do annulus, e ta significa topo do annulus, e hta - hba \u00e9 igual ao comprimento do annulus La. A variavel C \u00e9 dada por:\nMg\nRTa\n-9 + fD\n1 U2 1\n1 ga\nDa 2 _\n(A.18)\n\nA pressao no topo do annulus tambem pode ser definida como:\npta\tpba\t9pLa + fD\nLa PUga\nD 2\n(A.19)\nA densidade media no annulus e dado por:\n_\tmga\nP= Va\n(A.20)\nsubstituicao na equacao:\npta = pba\ngm,ga\n+ fD\nLa mgaUga\nDa\t2Va\n(A.21)\nO que resulta em um sistema nao linear com duas equacoes e duas variaveis, com a\nsolu\u00e7\u00e3o anal\u00edtica:\nPba\nPba (1\nPba\ngmga . f La mga Uga\n~\u00c3T\tfD Da\t2Va\ngmga\tf La mgaUga\n~\u00c3T \u2014 fD Da 2Va\ngmga \u2014 f La mgaU^a\nAa\tfD Da 2Va\n- eCLa)\n(1 \u2014 eCLa)\ngmga ,\t, mgaUga\npta\tPba\ta + fD\tA\n(A.22b)\n(A.22c)\n(A.22d)\nO conjunto de equa\u00e7\u00f5es \u00e9:\nUga\nwinLa\nRe\nfD\nmga winDa pg Aa ^\u20141-81og1g Mp RTa\n\\3.7Dj\n\\ 1-11 r n\nCa\t. 6.9\n+ Re\n1 U2 1\n1 ga\nPba\ngmga\nAa\n-g + fD Da 2\n\u2014 f La mga Uga fDDa\t2Va\n(1 - eCLa)\nPta\nPgi\n_\tgmga\tg mgaUga\n= Pba\u2014 ~ + fD 2D\u00c3\n_ pbaMg\n= RTa\n(A.23a)\n(A.23b)\n(A.23c)\n(A.23d)\n(A.23e)\n(A.23f)\n(A.23g)\nC =\nA.3: Tubing II\nA equa\u00e7\u00e3o Darcy-Weisbach [5] \u00e9 dada por:\nPf \u2014 Po =\nf PLU2 fD 2D\n(A.24)\nPara um comprimento substancialmente pequeno dh a queda de press\u00e3o dp \u00e9:\ndp = fn D ^2-dh\t(A.25)\nonde pf e p0 sao press\u00f5es em dois pontos diferentes em um tubo, fD e fator de atrito de Darcy, L e a distancia entre os pontos, D o diametro do tubo, e U e a velocidade\nm\u00e9dia (m/s) do fluido. O fD \u00e9 dado por:\nfD = k\tjTd)\ni-ii\t6.9\n+ Re\nporque a velocidade m\u00e9dia \u00e9 dif\u00edcil de calcular e formulas complexas podem em equacoes impl\u00edcitas, que sao caras para resolver, e aproximada por\nUm\tUs,g + Us,l\nWl\tWg\n+\nAl Pl\tAg Pg\n(wl,in + Wl,out)L + (wg,in + Wg,out)L 2mu\t2mgt\n\u00e9\nRe =\npDUm\n\n\np\n(mu + mgt) DUm V pA\nSendo a fra\u00e7ao d\u00e9 massa d\u00e9 gas definido como:\nx\n<y.pg\naPg + (1 \u2014 a)Pl\n\u00e9 a fra\u00e7ao d\u00e9 vacuo definida como:\na =\nUS,g\nC0(US,g + Us,l) + Vd\nsubstituindo um no outro:\nx\ne isolando a na primeira equacao:\nqg\nqg + ql + VdAPl\nXPl\n(1\t\u2014 X)Pg + XPl\nA mistura d\u00e9 fluidos m\u00e9dio num d\u00e9t\u00e9rminado ponto \u00e9:\nPm\taPg + (1\ta) Pl\nsubstituindo na primeira equacao temos:\n_____ apg pm\nx\ncom\n_ PMg Pg\n(A.26)\nresultar\n(A.27)\n(A.28)\n(A.29)\n(A.30)\n(A.31)\n(A.32)\n(A.33)\n(A.34)\n(A.35)\n(A.36)\na equa\u00e7\u00e3o e expandido para:\nxpi\n1 pMg\nPm\t(1 \u2014 x)\t+ xpi x RT\npMg pi\n(1 \u2014 x)pMg + xpl RT\nSabendo que a equa\u00e7ao hidrostatica e:\ndp = \u2014pmgdh\nse somarmos os dois fenomenos, temos:\ndp\tpm\npU21\n~ r\n\u2014g \u2014\tD\npMg pi\ndh\n\u2014g \u2014 f\n(1 \u2014 x)pMg + xpi RT |_\tD 2D\ndh\npor uma questao de legibilidade C e definido como:\nr\ti u2i\nC = Mg pi \u2014k2g \u2014 fD\nD 2\nconsequentemente,\np\ndp (1 \u2014 x) Mg p + xp\u00a1 RT Cdh\n(1 \u2014 x)Mgp + xpi RT\ndp = Cdh\np\nque tem como solu\u00e7ao:\n[(1 \u2014 x)Mg p + xpi RT log p]\npwh\n= [Ch]\np\u2014Pip\nhwh\nh\u2014hip\nassumindo Lt = hwh \u2014 hip\n[(1 \u2014 x)Mg (pwh \u2014 pip) + xpl RT (log pwh \u2014 log pip)] = CLt\nalem disso, sabemos que\nPwh\tpip\t^pt,m\t^pt,U\n_g (mgt + mit)\n^pt,m =\nA-t\nA _ , pmLU2\t(mgt + mit)U2\nAptU = f d 2 = fD\u20142\u00c3D\u2014\n(A.37a)\n(A.37b)\n(A.38a)\n(A.39a)\n(A.39b)\n(A.40)\n(A.41a)\n(A.41b)\n(A.42a)\n(A.43)\n(A.44)\n(A.45)\n(A.46)\ncom pm = mgt+mit, pode ser substitu\u00eddo na (A.43)\nxpiRT(logpwh - logpip) = CLt - (1 - x)Mg (pwh - pip)\n(logpwh - logpip) =\nCLt + (1 - x)Mg (Apt,m + Apt,u) xpl RT\nCLt +(l-x)-Mg (Apt,m + APt,U)\nPwh \u2014 pipe\nx pi RT\nResolvendo analiticamente:\n=\tApt,m + Apt,U\nPip\tCLt + (1-x)Mg(^Pt,m + ^Pt,U )\n1 \u2014 e\txpirt\npwh\tpip\tApt,m\tApt,U\nApt,m\ng(mgt + mit) At\nApt,u = fD\nPm L U2\nD 2\n= fD\n(mgt + mit)U2\n2AtD\n(A.47a)\n(A.47b)\n(A.47c)\n(A.48a)\n(A.48b)\n(A.48c)\n(A.48d)\nAppendix B: Modelos de Simulapao\nEste apendice apresenta os codigos utilizados para as simulates comentadas no Capitulo 4.\nB.1: Modelo RLC\nmodel RLC //Valores iniciais e parametros.\nparameter Real x10 = 0;\nparameter Real x20 = 0;\nparameter Real R(min = 1, max = 500, nominal = 100) = 200;\nparameter Real L(min = 1e-4, max = 0.1, nominal = 1e-2) = 0.01;\nparameter Real C(min = 1e-7, max = 0.01, nominal = 1e-3) = 1e-3;\nReal Vr;\n// Estados\nReal Vc(start = x10, fixed = true, nominal = 1);\nReal I(start = x20, fixed = true, nominal = 1e-5);\n// Sinal de Controle\ninput Real V(start = 0, fixed = true);\nequation\nder(Vc) = I/C;\nder(I) = V/L - Vc/L - R*I/L;\nVr = R*I;\nend RLC;\nB.2: Modelo de Otimizapao do RLC\noptimization RLCParEst (startTime = 0, finalTime = 10)\nextends RLC(R(free=true), L(free=true), C(free=true));\nend RLCParEst;\nB.3: C\u00f3digo Python para Simulagao e Estimado\n// Importa funcoes para compilar\nfrom pymodelica import compilefmu\nfrom pyfmi import loadfmu\nimport numpy as N\nfrom pyjmi import transfer_optimization_problem\nfrom collections import OrderedDict\nfrom pyjmi.optimization.casadLcollocation import MeasurementData\n// SIMUALTION OF THE RLC FOR DATA SAMPLING\n// Compila o modelo\nsimulationModelName = compile_fmu(\u201dRLC\u201d,\u201dRLC.mo\u201d)\n// Carrega o modelo\nsimulationModel = load_fmu(simulationModelName)\nt = N.linspace(0.,10.,200) // Criar pontos uniformemente espacados\nV5 = 5*N.ones(40) // Cria o vetor de entrada\nV2 = 2*N.ones(40) // Cria o vetor de entrada\nV3 = 3*N.ones(40) // Cria o vetor de entrada\nV1 = 1*N.ones(40) // Cria o vetor de entrada\nV4 = 4*N.ones(40) // Cria o vetor de entrada\nV = N.concatenate((V5,V2,V3,V1,V4),axis = 0)\nV_traj = N.transpose(N.vstack((t,V))) // Criar a matriz de dados e transpoe a matriz para a forma correta\ninpuLobject = (\u2019V\u2019, V_traj)\nsimulationOpts = simulationModel.simulate_options() // Recupera as op\u00e7\u00f5es pa\ndr\u00e3o\nsimulationOpts[\u2019ncp\u2019] = 200 // Altera o nUmero de pontos de comunica\u00e7ao.\nsimulationOpts[\u2019CVode_options\u2019][\u2019maxh\u2019] = 0.05\n//simula o sistema RLC\nresl = simulationModel.simulate(final_time=2, options = simulationOpts, input=\ninput_object)\n// Obter dados amostrados a partir dos resultados simulados\nVc_sim = res1[\u2019Vc\u2019]\nl_sim = res1[\u2019I\u2019]\nt_sim = res1[\u2019time\u2019]\nV_sim = res1[\u2019V\u2019]\nVr_sim = res1[\u2019Vr\u2019]\n// SIMULACAO PARA PRIMEIRa SUPOSICAO DO ALGORITMO DE OTIMIZA-CAO\n// Reseta o modelo\nsimulationModel.reset()\n// Suposicao inicial\nsimulationModel.set(\u2019R\u2019,400)\nsimulationModel.set(\u2019L,0.02)\nsimulationModel.set(\u2019C\u2019,2e-3)\n// simula o sistema RLC\nres2 = simulationModel.simulate(final_time=2, options = simulationOpts, input= inpuLobject)\n// PROBLEMA DE ESTIMACAO DE PARAMETROS\n// Compila o modelo\noptimizationModel = transfer_optimization_problem(\u201dRLCParEst\u201d,\n[\u201dRLCParEst.mop\u201d, \u201dRLC.mo\u201d])\nQ = N.diag([1., 1., 1., 1.])\ndata_V = N.vstack([t_sim, V_sim])\ndata_Vc = N.vstack([t_sim, Vc_sim]) data_Vr = N.vstack([t_sim, Vr_sim]) datai = N.vstack([t_sim, I_sim]) unconstrained = OrderedDict() constrained = OrderedDict() constrained[\u2019V\u2019] = data_V unconstrained[\u2019Vc\u2019] = data_Vc unconstrained[\u2019Vr\u2019] = data_Vr unconstrained[\u2019I\u2019] = dataJ measurement_data = MeasurementData(Q=Q, unconstrained=unconstrained, constrained=constrained)\nn_e = 200 // Numero de elementos finitos no algoritmo de collocation\n// Obtem um objeto de opcoes para o algoritmo de otimizacao\nopLopts = optimizationModel.optimize_options()\n// Defina a trajet\u00f3ria e numero de collocation points opt_opts[\u2019n_e\u2019] = n_e\nopt_opts[\u2019init_traj\u2019] = res2.result_data\nopt_opts[\u2019 n_cp\u2019 ] = 1\nopt_opts[\u2019 measurement_data\u2019 ] = measurement_data\n// Resolve o problema de otimizacao\nres3 = optimizationModel.optimize(options=opt_opts)\n// Extracao de valores (\u00f3timos de par\u00e2metros\nR_opt = res3.final(\u201dR\u201d)\nL_opt = res3.final(\u201dL\u2019)\nCopt = res3.final(\u201dC\u201d)\n// Imprima os valores dos parametros ideais\nprint \u2019R: \u2019 + str(R_opt)\nprint \u2019L: \u2019 + str(L_opt)\nprint \u2019C: \u2019 + str(C_opt)\n// Reseta o modelo\nsimulationModel.reset()\n// Estabelece os parametros encontrados para simulacao\nsimulationModel.set(\u2019R\u2019,R_opt)\nsimulationModel.set(\u2019L\u2019,L_opt)\nsimulationModel.set(\u2019C\u2019,C_opt)\n// simula o sistema RLC\nres4 = simulationModel.simulate(final_time=2, options = simulationOpts, input=\ninpuLobject)\n// Compila o modelo\nsimulationModelName = compile_fmu(\u201dRLC2\u201d,\u201dRLC2.mo\u201d)\n// Carrega o modelo\nsimulationModel = load_fmu(simulationModelName)\n//simula o sistema RLC\nres5 = simulationModel.simulate(final_time=10, options = simulationOpts, input= inpuLobject)"}]}}}