{"add": {"doc": {"field": [{"@name": "docid", "#text": "BR-TU.13729"}, {"@name": "filename", "#text": "19844_Tese.pdf"}, {"@name": "filetype", "#text": "PDF"}, {"@name": "text", "#text": "Universidade de Aveiro \n\nAno 2014 \n\nDepartamento de Eletr\u00f3nica, Telecomunica\u00e7\u00f5es e \n\nInform\u00e1tica \n\nTom\u00e9 da Costa Matos \n\n \n\n \n\nDesenvolvimento de um controlador e software de \n\nparametriza\u00e7\u00e3o para caldeiras a pellets \n\n \n\n   \n\n\n\n \n\n \n\n  \n\n\n\n \n\n \n\n \n\n \n\nUniversidade de Aveiro \n\nAno 2014 \n\nDepartamento de Eletr\u00f3nica, Telecomunica\u00e7\u00f5es e \n\nInform\u00e1tica \n\nTom\u00e9 da Costa Matos \n\n \n\n \n\nDesenvolvimento de um controlador e software de \n\nparametriza\u00e7\u00e3o para caldeiras a pellets \n\n \n\n Disserta\u00e7\u00e3o apresentada \u00e0 Universidade de Aveiro para cumprimento dos \n\nrequisitos necess\u00e1rios \u00e0 obten\u00e7\u00e3o do grau de Mestre em Engenharia Eletr\u00f3nica \n\ne Telecomunica\u00e7\u00f5es, realizada sob a orienta\u00e7\u00e3o cient\u00edfica do Doutor Paulo \n\nBacelar Reis Pedreiras, Professor Auxiliar do Departamento de Eletr\u00f3nica \n\nTelecomunica\u00e7\u00f5es e Inform\u00e1tica e do Doutor Valter Filipe Miranda Castel\u00e3o \n\nSilva, Professor Adjunto da Escola Superior de Tecnologia e Gest\u00e3o de \u00c1gueda \n\nda Universidade de Aveiro \n\n   \n\n \n\n  \n\n\n\n \n\n \n\n  \n\n\n\n \n\n \n\n  \n \n\n  \n\no j\u00fari   \n\n \n\nPresidente Prof. Doutor Alexandre Manuel Moutela Nunes da Mota \n\nProfessor Associado do Departamento de Eletr\u00f3nica, Telecomunica\u00e7\u00f5es e Inform\u00e1tica \n\nda Universidade de Aveiro \n\n  \n\n \n\n Prof. Doutor Paulo Jos\u00e9 Lopes Machado Portugal \n\nProfessor Auxiliar da Faculdade de Engenharia da Universidade do Porto \n\n  \n\n \n\n Prof. Doutor Valter Filipe Miranda Castel\u00e3o Silva \n\nProfessor Adjunto da Escola Superior de Tecnologia e Gest\u00e3o de \u00c1gueda da \n\nUniversidade de Aveiro \n\n  \n\n \n\n  \n\n\n\n \n\n \n\n  \n\n\n\n \n\n \n\n  \n\n  \n\nAgradecimentos \n\n \n\nAgrade\u00e7o \u00e0 minha fam\u00edlia, especialmente aos meus pais e irm\u00e3os pelo \n\nincentivo e confian\u00e7a transmitidos ao longo deste trabalho, mesmo em \n\nmomentos de algum desnorte. \n\n \n\nAo meu Pai e Tio Lando pela preciosa ajuda prestada em diversas etapas do \n\ntrabalho. \n\n \n\n\u00c0 Rosa pela compreens\u00e3o e paci\u00eancia, al\u00e9m da enorme for\u00e7a que sempre me \n\ntransmitiu. \n\n \n\nAos meus amigos e colegas que estiveram comigo ao longo destes anos. \n\n \n\nAo Engenheiro Augusto Tavares da ECOAMA pela amabilidade e \n\ndisponibilidade para a discuss\u00e3o de in\u00fameros pontos do trabalho. \n\n \n\nAos orientadores, Professor Paulo Pedreiras e Professor Valter Silva pela \n\nforma preocupada com que seguiram o desenvolvimento de todo o trabalho, \n\nassim como pelo pronto esclarecimento de d\u00favidas que foram surgindo. \n\n \n\n  \n\n\n\n \n\n \n\n  \n\n\n\n \n\n \n\n  \n\n  \n\npalavras-chave \n\n \n\ncontrolador, pellets, recuperador de calor, caldeira, queimador, sistema de \n\ncontrolo, sensores, atuadores. \n\n \n\nresumo \n\n \n\n \n\nO presente trabalho prop\u00f5e o desenvolvimento de um controlador para \n\naparelhos de aquecimento a pellets, como caldeiras, recuperadores de calor e \n\nqueimadores, em parceria com a empresa de produ\u00e7\u00e3o e instala\u00e7\u00e3o deste tipo \n\nde aparelhos, a ECOAMA. O pellet tem vindo a ganhar cada vez mais \n\nsimpatizantes dadas as claras vantagens no seu manuseio, nomeadamente \n\ncomo combust\u00edvel alternativo ao petr\u00f3leo para aquecimento de casas e \n\nsistemas industriais. O controlador Fumis ALPHA, atualmente utilizado, tem \n\nprovocado alguns constrangimentos tanto a n\u00edvel funcional como econ\u00f3mico \n\npara a empresa e a sua substitui\u00e7\u00e3o por outro que possa ser produzido e \n\ncustomizado pela ECOAMA revela-se um excelente atrativo, al\u00e9m das \n\nin\u00fameras vantagens associadas. A disserta\u00e7\u00e3o envolve o projeto e \n\nimplementa\u00e7\u00e3o de circuitos de acondicionamento de sinal para sensores e \n\natuadores, envolvendo todo um sistema de controlo.  \n\nV\u00e1rias s\u00e3o as funcionalidades implementadas das quais de destacam a \n\nprograma\u00e7\u00e3o hor\u00e1ria, a capacidade preditiva, a coopera\u00e7\u00e3o entre \n\ncontroladores, etc. \n\nA conce\u00e7\u00e3o de uma interface com o utilizador por meio de um LCD com \n\nfuncionalidade de toque permite ao utilizador, seja ele o cliente ou o pr\u00f3prio \n\ninstalador, uma f\u00e1cil navega\u00e7\u00e3o entre ecr\u00e3s, possibilitando a gest\u00e3o do \n\nprocesso de aquecimento ou a configura\u00e7\u00e3o de par\u00e2metros a ele associados. \n\nA cria\u00e7\u00e3o de uma aplica\u00e7\u00e3o PC vem incrementar as ferramentas ao dispor do \n\nfabricante para monitoriza\u00e7\u00e3o, teste e configura\u00e7\u00e3o, acrescentando valor ao \n\ntrabalho. \n\nVerificado o funcionamento do sistema desenvolvido, ficou a certeza de que foi \n\ndado um passo firme na cria\u00e7\u00e3o de um prot\u00f3tipo capaz de poder ser \n\ncomercializado num futuro pr\u00f3ximo. \n\n \n\n  \n\n\n\n \n\n \n\n  \n\n\n\n \n\n \n\n  \n\n  \n\nKeywords \n\n \n\ncontroller, pellets, stove, boiler, burner, control system, sensors, actuators \n\n \n\nAbstract \n\n \n\nThis work proposes the development of a controller for pellet heating devices \n\nsuch as boilers, stoves and burners, in partnership with a producer and \n\ninstaller enterprise \u2013 the ECOAMA. The pellet has been gaining more and \n\nmore supporters due to the clear advantages in his handling, particularly as an \n\nalternative fuel to oil for heating homes and industrial systems. Fumis ALPHA, \n\nthe currently controller used has caused some embarrassment to both \n\nfunctional and economic level for the company and its replacement with one \n\nthat can be produced and customized by ECOAMA proves to be an excellent \n\nattraction, in addition to the numerous benefits associated. The dissertation \n\ninvolves the design and implementation of signal conditioning circuits for \n\nsensors and actuators, involving a whole control system. \n\nThere are several features implemented such as the daily scheduling and \n\npredictive capacity, cooperation between controllers, etc. \n\nThe conception of a user interface via a touch LCD allows the user, client or \n\ninstaller, easy navigation between screens, enabling management of the \n\nheating process or parameters configuration. The creation of a PC application \n\nhas increased the available tools to the manufacturer for monitoring, testing \n\nand configuration, adding value to the work. \n\nAfter checked and validated the operation of the developed system, it became \n\ncertain that it was given a firm step in creating a prototype able to be marketed \n\nin the near future. \n\n \n\n\n\n \n\n \n\n\n\nI \n\n \n\nConte\u00fado \n\n  \nCap\u00edtulo 1 Introdu\u00e7\u00e3o .......................................................................................................... 1 \n\n1.1 Enquadramento .......................................................................................................... 1 \n\n1.2 Motiva\u00e7\u00e3o ................................................................................................................... 1 \n\n1.3 Objetivos ..................................................................................................................... 2 \n\n1.4 Requisitos ................................................................................................................... 2 \n\nCap\u00edtulo 2 Conceitos e Estado da Arte .............................................................................. 5 \n\n2.1 Pellets ......................................................................................................................... 5 \n\n2.1.1 - Processo de fabrico de pellets ................................................................. 7 \n\n2.1.2 - Dados estat\u00edsticos .................................................................................... 8 \n\n2.2 Sistemas de aquecimento a pellets ............................................................................ 9 \n\n2.2.1 - Recuperador de calor ............................................................................... 9 \n\n2.2.2 - Caldeira .................................................................................................. 12 \n\n2.2.3 - Queimador .............................................................................................. 13 \n\n2.3 Princ\u00edpio de funcionamento ...................................................................................... 14 \n\n2.4 Regulamenta\u00e7\u00e3o de emiss\u00f5es ................................................................................. 14 \n\n2.5 Controladores de aparelhos de aquecimento a biomassa ....................................... 15 \n\n2.5.1 - Fumis ALPHA ......................................................................................... 19 \n\n2.5.2 - Primeira vers\u00e3o do controlador .............................................................. 20 \n\nCap\u00edtulo 3 Funcionalidades .............................................................................................. 23 \n\n3.1 Armazenamento da data e hora ............................................................................... 23 \n\n3.2 Interface com LCD + touchscreen ............................................................................ 23 \n\n3.3 Interface com aplica\u00e7\u00e3o PC...................................................................................... 24 \n\n3.4 Programa\u00e7\u00e3o do crono termostato ........................................................................... 25 \n\n3.5 Coopera\u00e7\u00e3o de controladores .................................................................................. 25 \n\n3.6 Predi\u00e7\u00e3o.................................................................................................................... 25 \n\nCap\u00edtulo 4 Hardware........................................................................................................... 27 \n\n4.1 Diagrama de blocos .................................................................................................. 27 \n\n4.2 Descri\u00e7\u00e3o dos sensores e atuadores ....................................................................... 28 \n\n4.2.1 - Sensores ................................................................................................ 28 \n\n4.2.2 - Atuadores ............................................................................................... 30 \n\n4.3 Real-Time Clock ....................................................................................................... 32 \n\n4.4 Circuitos de acondicionamento de sinal ................................................................... 33 \n\n4.4.1 - Sonda NTC ............................................................................................. 33 \n\n4.4.2 - LM335 ..................................................................................................... 34 \n\n4.4.3 - Termopar ................................................................................................ 35 \n\n4.4.4 - Detetor de passagem por zero ............................................................... 37 \n\n4.4.5 - Interface de pot\u00eancia .............................................................................. 38 \n\n\n\nII \n\n \n\n4.5 Microcontrolador ....................................................................................................... 38 \n\n4.6 Interface com o utilizador ......................................................................................... 39 \n\n4.6.1 - LCD......................................................................................................... 40 \n\n4.6.2 - M\u00f3dulo VM800C ..................................................................................... 41 \n\n4.7 PCI ............................................................................................................................ 42 \n\nCap\u00edtulo 5 Firmware e Software ........................................................................................ 43 \n\n5.1 Firmware ................................................................................................................... 43 \n\n5.1.1 - Processo de controlo .............................................................................. 43 \n\n5.1.2 - Armazenamento e conceptualiza\u00e7\u00e3o dos par\u00e2metros do sistema ........ 47 \n\n5.1.3 - Codifica\u00e7\u00e3o e descodifica\u00e7\u00e3o da data e hora atual ................................ 49 \n\n5.1.4 - Device drivers ......................................................................................... 50 \n\n5.1.5 - Frequ\u00eancia de amostragem das temperaturas ...................................... 56 \n\n5.1.6 - Cria\u00e7\u00e3o de primitivas gr\u00e1ficas e \u201cwidgets\u201d.............................................. 57 \n\n5.1.7 - Cria\u00e7\u00e3o de um ecr\u00e3 ................................................................................ 57 \n\n5.1.8 - Touch ...................................................................................................... 58 \n\n5.1.9 - Gest\u00e3o de ecr\u00e3s ..................................................................................... 58 \n\n5.1.10 - Programa\u00e7\u00e3o da interface com o LCD ................................................. 61 \n\n5.1.11 - Programa\u00e7\u00e3o do crono termostato ....................................................... 62 \n\n5.1.12 - Calibra\u00e7\u00e3o ............................................................................................ 63 \n\n5.1.13 - Predi\u00e7\u00e3o ............................................................................................... 63 \n\n5.1.14 - Comunica\u00e7\u00e3o gateway-controladores .................................................. 65 \n\n5.1.15 - Estrutura da fun\u00e7\u00e3o MAIN .................................................................... 66 \n\n5.2 Software para PC ..................................................................................................... 67 \n\n5.2.1 - Comunica\u00e7\u00e3o com a porta s\u00e9rie ............................................................. 68 \n\n5.2.2 - Estrutura da aplica\u00e7\u00e3o ............................................................................ 71 \n\nCap\u00edtulo 6 Testes de Valida\u00e7\u00e3o ........................................................................................ 77 \n\n6.1 Testes aos sensores ................................................................................................ 77 \n\n6.1.1 - NTC ........................................................................................................ 77 \n\n6.1.2 - Termopar K ............................................................................................. 79 \n\n6.1.3 - LM335 ..................................................................................................... 80 \n\n6.2 Atuadores ................................................................................................................. 81 \n\n6.2.1 - Teste em vazio ....................................................................................... 81 \n\n6.2.2 - Teste com cargas individuais ................................................................. 82 \n\n6.2.3 - Teste com cargas simult\u00e2neas ............................................................... 84 \n\n6.3 Comunica\u00e7\u00e3o entre controladores ........................................................................... 86 \n\n6.4 Controlador em ambiente real .................................................................................. 88 \n\nCap\u00edtulo 7 Conclus\u00f5es....................................................................................................... 91 \n\n7.1 Trabalho Futuro ........................................................................................................ 92 \n\n\n\nIII \n\n \n\nLISTA DE FIGURAS \n\nFigura 2.1 - Pellets ........................................................................................................................ 6 \n\nFigura 2.2 - Ciclo do CO2 .............................................................................................................. 6 \n\nFigura 2.3 - Secador tambor rotativo............................................................................................. 7 \n\nFigura 2.4 - Mesa de secagem ...................................................................................................... 7 \n\nFigura 2.5 - Recuperador de calor \u2013 vers\u00e3o independente ........................................................ 10 \n\nFigura 2.6 - Recuperador de calor integrado com chamin\u00e9 ........................................................ 10 \n\nFigura 2.7 - Queimador com alimenta\u00e7\u00e3o por gravidade ............................................................ 11 \n\nFigura 2.8 - Queimador com alimenta\u00e7\u00e3o ascendente ............................................................... 11 \n\nFigura 2.9 - Queimador com alimenta\u00e7\u00e3o horizontal .................................................................. 11 \n\nFigura 2.10 - Entrada de ar do pr\u00f3prio compartimento ............................................................... 11 \n\nFigura 2.11 - Opera\u00e7\u00e3o com entrada direta de ar do exterior ..................................................... 11 \n\nFigura 2.12 - Entrada de ar num canal independente da chamin\u00e9 ............................................. 11 \n\nFigura 2.13 - Caldeira a pellets fabricada em \u00c1ustria ................................................................. 13 \n\nFigura 2.14 - Queimador ECOAMA ............................................................................................ 13 \n\nFigura 2.15 \u2013 Controlador BMC 020X ......................................................................................... 16 \n\nFigura 2.16 - Interface com o utilizador do controlador BMC 020X ............................................ 16 \n\nFigura 2.17 \u2013 Controlador ST-91................................................................................................. 16 \n\nFigura 2.18 \u2013 Controlador NPBC-V5 ........................................................................................... 16 \n\nFigura 2.19 \u2013 Controlador Fumis ALPHA .................................................................................... 17 \n\nFigura 2.20 - Primeira vers\u00e3o do controlador .............................................................................. 20 \n\nFigura 4.1 \u2013 Diagrama de blocos do controlador e suas interfaces ............................................ 27 \n\nFigura 4.2 - Sistema de controlo de malha fechada gen\u00e9rico .................................................... 28 \n\nFigura 4.3 - Term\u00edstor NTC NS N E 1.5 5/6 E 20 N S E ............................................................. 28 \n\nFigura 4.4 - Termopar TC K A 3 4 V 10 I N I S/M ....................................................................... 29 \n\nFigura 4.5 - LM335 ...................................................................................................................... 29 \n\nFigura 4.6 - Resist\u00eancia de igni\u00e7\u00e3o (HTH Rohrheizer \u2013 79/11/200) ........................................... 30 \n\nFigura 4.7 - Motor de alimenta\u00e7\u00e3o (BCZ 509) ............................................................................. 31 \n\nFigura 4.8 \u2013 Ventilador AACO ST25 ........................................................................................... 31 \n\nFigura 4.9 \u2013 Ventilador AACO VA2 W 50R ................................................................................. 31 \n\nFigura 4.10 - Real-Time Clock .................................................................................................... 32 \n\nFigura 4.11 - Circuito de polariza\u00e7\u00e3o do Term\u00edstor NTC ............................................................ 33 \n\nFigura 4.12 - OPAMP em configura\u00e7\u00e3o de buffer ....................................................................... 34 \n\nFigura 4.13 - Circuito de acondicionamento de sinal do LM335 ................................................. 35 \n\nFigura 4.14 - Circuito de acondicionamento de sinal do termopar ............................................. 36 \n\nFigura 4.15 \u2013 Modelo da entrada anal\u00f3gica da ADC do microcontrolador PIC32 ...................... 36 \n\nFigura 4.16 - Circuito detetor de passagem por zero da tens\u00e3o da rede el\u00e9trica ....................... 37 \n\nFigura 4.17 \u2013 Gr\u00e1ficos da onda retificada (vermelho) e do sinal \u00e0 sa\u00edda do detetor (verde)...... 37 \n\nFigura 4.18 - Interface de pot\u00eancia ............................................................................................. 38 \n\n\n\nIV \n\n \n\nFigura 4.19 \u2013 Microcontrolador PIC32-T795 ............................................................................... 39 \n\nFigura 4.20 - Diagrama de blocos da interface com o utilizador ................................................. 40 \n\nFigura 4.21 \u2013 LCD NHD-3.5-320240MF-ATXL#-1 ...................................................................... 40 \n\nFigura 4.22 \u2013 M\u00f3dulo VM800C35A ............................................................................................. 41 \n\nFigura 5.1 - Estrutura simplificada do c\u00f3digo, em C, para uma m\u00e1quina de estados ................ 44 \n\nFigura 5.2 - Diagrama de transi\u00e7\u00e3o de estados .......................................................................... 47 \n\nFigura 5.3 - Esquema da rotina de leitura da ADC ..................................................................... 51 \n\nFigura 5.4 - Fluxograma de sincroniza\u00e7\u00e3o com a tens\u00e3o da rede el\u00e9trica ................................. 54 \n\nFigura 5.5 - Diagrama de transi\u00e7\u00e3o entre ecr\u00e3s .......................................................................... 60 \n\nFigura 5.6 - Camadas l\u00f3gicas para interface com o FT800 ........................................................ 61 \n\nFigura 5.7 - Buffer de comandos gr\u00e1ficos ................................................................................... 62 \n\nFigura 5.8 - Evolu\u00e7\u00e3o ideal da temperatura ambiente durante a calibra\u00e7\u00e3o .............................. 64 \n\nFigura 5.9 - Esquema de liga\u00e7\u00e3o PC-gateway-controladores .................................................... 65 \n\nFigura 5.10 \u2013 Campo de dados da trama enviada por cada controlador ................................... 65 \n\nFigura 5.11 \u2013 Campo de dados da mensagem enviada pelo gateway ....................................... 66 \n\nFigura 5.12 - Fluxograma do ciclo infinito da fun\u00e7\u00e3o MAIN ........................................................ 67 \n\nFigura 5.13 - Fluxograma da RSI para a rece\u00e7\u00e3o de carateres .................................................. 69 \n\nFigura 5.14 - Configura\u00e7\u00e3o para a leitura de carateres da porta s\u00e9rie ....................................... 70 \n\nFigura 5.15 - Fluxograma da leitura de dados da porta s\u00e9rie ..................................................... 71 \n\nFigura 5.16 - Fluxograma da escrita de dados na porta s\u00e9rie .................................................... 71 \n\nFigura 5.17 - Aplica\u00e7\u00e3o inicialmente desconectada .................................................................... 72 \n\nFigura 5.18 - Troca de mensagens despoletada pelo bot\u00e3o \u201cConnect\u201d...................................... 72 \n\nFigura 5.19 - Fluxograma estabelecido pelo bot\u00e3o \u201cConnect\u201d .................................................... 73 \n\nFigura 5.20 - Aba para altera\u00e7\u00e3o de par\u00e2metros e teste do MA e RI ......................................... 73 \n\nFigura 5.21 - Aba para altera\u00e7\u00e3o de par\u00e2metros e teste do VA ................................................. 74 \n\nFigura 5.22 - Ecr\u00e3 de monitoriza\u00e7\u00e3o do processo de aquecimento............................................ 75 \n\nFigura 5.23 - Troca de mensagens de monitoriza\u00e7\u00e3o entre o PC e o gateway .......................... 76 \n\nFigura 6.1 \u2013 Montagem da experi\u00eancia em vazio ....................................................................... 82 \n\nFigura 6.2 \u2013 Montagem da experi\u00eancia com a RI ligada ............................................................ 82 \n\nFigura 6.3 - Montagem de teste do barramento CAN ................................................................. 86 \n\nFigura 6.4 - Apenas o gateway ligado ao barramento CAN ....................................................... 86 \n\nFigura 6.5 - Ambos os microcontroladores ligados ao barramento ............................................ 87 \n\nFigura 6.6 - Remo\u00e7\u00e3o do microcontrolador 2 .............................................................................. 87 \n\nFigura 6.7 - Altera\u00e7\u00e3o dos par\u00e2metros do controlador 1 ............................................................ 88 \n\nFigura 6.8 - Controlador em teste nas instala\u00e7\u00f5es da ECOAMA ................................................ 88 \n\nFigura 6.9 - Chama do queimador na fase de \u201cIgni\u00e7\u00e3o\u201d ............................................................. 90 \n\nFigura 6.10 - Chama do queimador no in\u00edcio da fase de \u201cQueima\u201d ............................................ 90 \n\nFigura 6.11 - Chama do queimador no in\u00edcio da fase de \u201cExtin\u00e7\u00e3o\u201d........................................... 90 \n\nFigura 6.12 - C\u00e2mara de combust\u00e3o finalizado o processo de aquecimento ............................. 90 \n\nFigura 7.1 \u2013 Exemplo de um SC da temperatura interior de uma casa ...................................... 94 \n\n\n\nV \n\n \n\nFigura 8.1 - Esquema do recuperador de calor H\u00e9stia (ECOAMA) .......................................... 101 \n\nFigura 8.2 - Esquema de liga\u00e7\u00e3o da RTC ao microcontrolador ................................................ 102 \n\nFigura 8.3 - Desenho da PCI do controlador ............................................................................ 102 \n\nFigura 8.4 - Processo inativo ..................................................................................................... 105 \n\nFigura 8.5 - Processo ativo ....................................................................................................... 105 \n\nFigura 8.6 - Sele\u00e7\u00e3o de n\u00edvel m\u00e1ximo de queima ..................................................................... 105 \n\nFigura 8.7 - Menu de temperaturas ........................................................................................... 105 \n\nFigura 8.8 - Mostrador de temperaturas ................................................................................... 106 \n\nFigura 8.9 - Sele\u00e7\u00e3o de temperatura desejada ......................................................................... 106 \n\nFigura 8.10 - Menu de rel\u00f3gio ................................................................................................... 106 \n\nFigura 8.11 - Atualiza\u00e7\u00e3o da data e hora atuais ....................................................................... 106 \n\nFigura 8.12 - Programa\u00e7\u00e3o do crono termostato ...................................................................... 106 \n\nFigura 8.13 - Predi\u00e7\u00e3o ............................................................................................................... 106 \n\nFigura 8.14 - Inser\u00e7\u00e3o de palavra-passe .................................................................................. 106 \n\nFigura 8.15 - Menu de programa\u00e7\u00e3o ......................................................................................... 106 \n\nFigura 8.16 - Menu de par\u00e2metros ............................................................................................ 107 \n\nFigura 8.17 - Config. par\u00e2metros do MA ................................................................................... 107 \n\nFigura 8.18 - Config. par\u00e2metros do VA ................................................................................... 107 \n\nFigura 8.19 - Config. par\u00e2metros do VE ................................................................................... 107 \n\nFigura 8.20 - Config. temperaturas ........................................................................................... 107 \n\nFigura 8.21 - Teclado virtual ...................................................................................................... 107 \n\nFigura 8.22 - Teste aos atuadores ............................................................................................ 107 \n\nFigura 8.23 - Menu de bloqueio do teclado ............................................................................... 107 \n\nFigura 8.24 - Calibra\u00e7\u00e3o ............................................................................................................ 108 \n\nFigura 8.25 - Inser\u00e7\u00e3o de nova palavra-passe .......................................................................... 108 \n\nFigura 8.26 - Tramas I2C para transfer\u00eancia de dados ............................................................ 108 \n\nFigura 8.27 - Modelo de comunica\u00e7\u00e3o SPI ............................................................................... 111 \n\nFigura 8.28 - Liga\u00e7\u00e3o Independente ......................................................................................... 112 \n\nFigura 8.29 - Liga\u00e7\u00e3o em cascata ............................................................................................. 112 \n\nFigura 8.30 - Topologia da rede CAN ....................................................................................... 113 \n\nFigura 8.31 - Constitui\u00e7\u00e3o geral de um n\u00f3 da rede CAN .......................................................... 114 \n\nFigura 8.32 - Controlador CAN .................................................................................................. 114 \n\nFigura 8.33 - Trama CAN Standard .......................................................................................... 115 \n\n \n\n  \n\n\n\nVI \n\n \n\nLISTA DE TABELAS \n\nTabela 2.1 - Principais produtores e consumidores de pellets da EU em 2010 ........................... 8 \n\nTabela 2.2 - Limites de emiss\u00f5es de acordo com o EN 303-5 ................................................... 15 \n\nTabela 2.3 - Caracter\u00edsticas dos controladores do mercado europeu ........................................ 18 \n\nTabela 3.1 - A\u00e7\u00f5es permitidas a partir do display em fun\u00e7\u00e3o do interveniente .......................... 24 \n\nTabela 3.2 - A\u00e7\u00f5es permitidas a partir da aplica\u00e7\u00e3o PC ............................................................. 24 \n\nTabela 4.1 - Caracter\u00edsticas dos sensores utilizados.................................................................. 30 \n\nTabela 4.2 - Principais caracter\u00edsticas dos atuadores utilizados ................................................ 32 \n\nTabela 4.3 - Pinos do Conetor J5 do VM800C ........................................................................... 41 \n\nTabela 5.1 - A\u00e7\u00f5es em fun\u00e7\u00e3o do estado do processo ............................................................... 45 \n\nTabela 5.2 - Estado dos atuadores em fun\u00e7\u00e3o do estado do processo ..................................... 46 \n\nTabela 5.3 - Mapeamento de mem\u00f3ria da RTC .......................................................................... 49 \n\nTabela 5.4 - Instantes de disparo relativos aos extremos de velocidade dos ventiladores ........ 55 \n\nTabela 5.5 - Frequ\u00eancias de amostragem de cada tipo de temperatura .................................... 57 \n\nTabela 5.6 - Funcionalidades dispon\u00edveis na aplica\u00e7\u00e3o PC por tarefa ....................................... 76 \n\nTabela 6.1 - Corrente e tens\u00e3o na RI .......................................................................................... 83 \n\nTabela 6.2 - Corrente e tens\u00e3o no MA ........................................................................................ 83 \n\nTabela 6.3 - Corrente e tens\u00e3o no VA ........................................................................................ 83 \n\nTabela 6.4 - Corrente e tens\u00e3o no VE ........................................................................................ 83 \n\nTabela 6.5 - Medi\u00e7\u00f5es com apenas os ventiladores ligados ...................................................... 84 \n\nTabela 6.6 - Medi\u00e7\u00f5es com os ventiladores e o motor de alimenta\u00e7\u00e3o ligados ......................... 84 \n\nTabela 6.7 - Medi\u00e7\u00f5es com todos os atuadores ligados ............................................................. 85 \n\nTabela 8.1 - Mapeamento dos par\u00e2metros do sistema na mem\u00f3ria da RTC ........................... 104 \n\nTabela 8.2 - Comandos de atualiza\u00e7\u00e3o de par\u00e2metros ............................................................ 104 \n\nTabela 8.3 - Comandos utilizados no teste dos atuadores ....................................................... 104 \n\nTabela 8.4 - Comandos de agendamento do crono termostato ............................................... 105 \n\nTabela 8.5 - Comandos solicita\u00e7\u00e3o de in\u00edcio e fim de processo ............................................... 105 \n\nTabela 8.6 - Fun\u00e7\u00f5es de todos os pinos de entrada/sa\u00edda do LCD.......................................... 116 \n\n \n\n  \n\n\n\nVII \n\n \n\nLISTA DE GR\u00c1FICOS \n\nGr\u00e1fico 5.1 - Curva de Tens\u00e3o-Temperatura da NTC e regress\u00e3o polinomial de ordem 5 ........ 51 \n\nGr\u00e1fico 5.2 - C\u00e1lculo da temperatura utilizando apenas um tro\u00e7o .............................................. 52 \n\nGr\u00e1fico 5.3 - C\u00e1lculo da temperatura utilizando dois tro\u00e7os ....................................................... 53 \n\nGr\u00e1fico 5.4 - Temperatura em fun\u00e7\u00e3o da tens\u00e3o de sa\u00edda do MCP602 ..................................... 53 \n\nGr\u00e1fico 5.5 - Rela\u00e7\u00e3o entre o Instante de disparo e a tens\u00e3o aplicada ao VA ........................... 55 \n\nGr\u00e1fico 5.6 - Rela\u00e7\u00e3o entre o Instante de disparo e a tens\u00e3o aplicada ao VE ........................... 56 \n\nGr\u00e1fico 6.1 - Medi\u00e7\u00e3o da temperatura ambiente ......................................................................... 77 \n\nGr\u00e1fico 6.2 - Erro associado \u00e0 medi\u00e7\u00e3o da temperara ambiente ............................................... 78 \n\nGr\u00e1fico 6.3 - Medi\u00e7\u00e3o da temperatura da \u00e1gua .......................................................................... 78 \n\nGr\u00e1fico 6.4 - Erro associado \u00e0 medi\u00e7\u00e3o da temperatura da \u00e1gua .............................................. 79 \n\nGr\u00e1fico 6.5 - Medi\u00e7\u00e3o da temperatura do ar quente ................................................................... 79 \n\nGr\u00e1fico 6.6 - Erro associado \u00e0 medi\u00e7\u00e3o da temperatura do ar quente ....................................... 80 \n\nGr\u00e1fico 6.7 - Medi\u00e7\u00e3o da temperatura da placa .......................................................................... 80 \n\nGr\u00e1fico 6.8 - Erro associado \u00e0 medi\u00e7\u00e3o da temperatura da placa .............................................. 81 \n\nGr\u00e1fico 6.9 - Correntes medidas no teste individual aos atuadores ........................................... 83 \n\nGr\u00e1fico 6.10 - Tens\u00f5es medidas no teste individual aos atuadores ........................................... 83 \n\nGr\u00e1fico 6.11 - Corrente total consumida a partir das contribui\u00e7\u00f5es individuais vs simult\u00e2nea ... 85 \n\nGr\u00e1fico 6.12 - Evolu\u00e7\u00e3o das temperaturas ao longo do processo .............................................. 89 \n\n  \n\n\n\nVIII \n\n \n\nLISTA DE ACR\u00d3NIMOS \n\nADC Analog-to-Digital Converter \n\nAPI Application Programming Interface \n\nBCD Binary-Coded Decimal \n\nBJT Bipolar Junction Transistor \n\nCAN Controller Area Network \n\nCI Circuito Integrado \n\nI2C Inter Integrated Circuit \n\nLCD Liquid-Crystal Display \n\nLDR Light Dependent Resistor \n\nLED Light-Emitting Diode \n\nMA Motor de Alimenta\u00e7\u00e3o \n\nNTC Negative Temperature Coeficient \n\nOPAMP Operational Amplifier \n\nPCI Placa de Circuito Impresso \n\nPIC Peripheral Interface Controller \n\nPLL Phased-Locked Loop \n\nQVGA Quarter Video Graphics Array \n\nRI Resist\u00eancia de Igni\u00e7\u00e3o \n\nRPM Rota\u00e7\u00f5es por minuto \n\nRSI Rotina de Servi\u00e7o \u00e0 Interrup\u00e7\u00e3o \n\nRTC Real-Time Clock \n\nSC Sistema de Controlo \n\nSMD Surface-Mount Technology \n\nSPI Serial Peripheral Interface \n\nTFT Thin-Film-Transistor \n\nVA Ventilador Ambiente \n\nVE Ventilador de Extra\u00e7\u00e3o de gases \n\nUART Universal Asynchronous Receiver/Transmitter \n\nUSB Universal Serial Bus \n\n \n\n\n\n1 \n\n \n\nCap\u00edtulo 1 INTRODU\u00c7\u00c3O \n\n1.1 ENQUADRAMENTO \n\nO tema desta disserta\u00e7\u00e3o surgiu de um contacto entre a empresa ECOAMA e a \n\nUniversidade de Aveiro. Esta empresa residente em \u00c1gueda, regi\u00e3o de Aveiro, dedica-\n\nse \u00e0 produ\u00e7\u00e3o e instala\u00e7\u00e3o de equipamento de aquecimento tendo como combust\u00edvel \n\na biomassa, mais concretamente o pellet. Ao todo s\u00e3o comercializados tr\u00eas tipos de \n\naparelhos: recuperadores de calor utilizados para aquecimento de ar, caldeiras para \n\naquecimento de \u00e1guas sanit\u00e1rias e queimadores para pr\u00e9 aquecimento de sistemas \n\ncomo por exemplo fornos. De todos os seus constituintes, apenas o controlador n\u00e3o \u00e9 \n\nfabricado por esta empresa, mas sim importado da Eslov\u00e9nia, o que pode levar a \n\nalguns constrangimentos no que diz respeito \u00e0 sua customiza\u00e7\u00e3o, em fun\u00e7\u00e3o das \n\nprefer\u00eancias dos clientes. \n\nNasceu daqui uma proposta de disserta\u00e7\u00e3o de mestrado, com o objetivo de responder \n\na esta solicita\u00e7\u00e3o desenvolvendo um controlador capaz de realizar o controlo de cada \n\num dos aparelhos, possuindo apenas as funcionalidades desejadas e que possa ser \n\nlivremente configurado pelos engenheiros de desenvolvimento e instala\u00e7\u00e3o da \n\nECOAMA. \n\n1.2 MOTIVA\u00c7\u00c3O \n\nO facto de o controlador n\u00e3o ser fabricado na ECOAMA causa alguns transtornos para \n\na empresa, uma vez que sempre que pretendem efetuar uma altera\u00e7\u00e3o no software \n\n(tornar vis\u00edvel na aplica\u00e7\u00e3o PC um certo par\u00e2metro, por exemplo), por mais simples \n\nque ela seja, t\u00eam de entrar em contacto com a ATech Electronics, a fabricante do \n\ncontrolador usado atualmente. Al\u00e9m do elevado custo associado \u00e0 altera\u00e7\u00e3o solicitada, \n\no tempo total despendido neste processo \u00e9 muito longo, pese embora os largos anos \n\nem que a ECOAMA \u00e9 sua cliente, o que em nada facilita a tarefa. Em termos de \n\nfuncionamento, o controlador j\u00e1 foi alvo de algumas queixas por parte de clientes, \n\ndevido ao facto de se desprogramar aleatoriamente ou se for desligado de um ano \n\npara o outro. As sa\u00eddas s\u00e3o bastante sens\u00edveis a varia\u00e7\u00f5es de tens\u00e3o e ficam por \n\nvezes sem controlo. \n\nOutra desvantagem deste controlador prende-se com o facto de ser bastante gen\u00e9rico, \n\npossuindo in\u00fameras funcionalidades que n\u00e3o s\u00e3o necess\u00e1rias entre os aparelhos \n\nfabricados. \n\n\n\n2 \n\n \n\nPara dar resposta a estes inconvenientes, a ECOAMA interessou-se pela possibilidade \n\nde desenvolvimento de um controlador, em parceria com a Universidade de Aveiro, \n\nque pudesse ser utilizado e programado conforme as suas especifica\u00e7\u00f5es, tendo em \n\nconta sempre o feedback do cliente. \n\nNuma primeira abordagem, foi desenvolvida uma disserta\u00e7\u00e3o intitulada de \n\n\u201cControlador e Device Drivers para um Recuperador de Calor a Pellets\u201d, que resultou \n\nnuma vers\u00e3o funcional de um dispositivo capaz de arrancar e monitorizar o processo \n\nde aquecimento num recuperador de calor, n\u00e3o obstante os problemas a ele \n\nassociados que ficaram por resolver, assim como uma s\u00e9rie de funcionalidades que \n\nficaram por acrescentar e o seu custo que deve ser reduzido. \n\n1.3 OBJETIVOS \n\nTendo em conta o referido acima, foram delineados alguns objetivos para esta \n\ndisserta\u00e7\u00e3o que se encontram enumerados nas pr\u00f3ximas linhas: \n\n? Melhoramento est\u00e9tico e organiza\u00e7\u00e3o cuidada da placa do controlador \n\nrelativamente \u00e0 vers\u00e3o anteriormente desenvolvida, sendo constitu\u00eddo apenas \n\npor uma placa; \n\n? Melhoramento das interfaces dos sensores e da resolu\u00e7\u00e3o na medida das \n\ntemperaturas; \n\n? Otimiza\u00e7\u00e3o da m\u00e1quina de estados; \n\n? Capacidade de armazenamento permanente de par\u00e2metros do sistema; \n\n? Introdu\u00e7\u00e3o da funcionalidade de programa\u00e7\u00e3o do crono termostato; \n\n? Introdu\u00e7\u00e3o da funcionalidade preditiva; \n\n? Introdu\u00e7\u00e3o da funcionalidade de comunica\u00e7\u00e3o entre controladores; \n\n? Desenvolvimento de uma interface com o utilizador simples e apelativa; \n\n? Desenvolvimento de uma aplica\u00e7\u00e3o PC para configura\u00e7\u00e3o, teste e \n\nmonitoriza\u00e7\u00e3o do sistema; \n\n? Aproxima\u00e7\u00e3o do controlador desenvolvido de um prot\u00f3tipo final. \n\nTodos estes objetivos e sua concretiza\u00e7\u00e3o foram ao longo do projeto alvo de \n\ndiscuss\u00e3o e an\u00e1lise com a empresa ECOAMA. \n\n1.4 REQUISITOS \n\nRequisitos correspondem a caracter\u00edsticas que o sistema dever\u00e1 possuir para atender \n\n\u00e0s necessidades e exig\u00eancias do utilizador. Assim, ap\u00f3s an\u00e1lise do seu prop\u00f3sito, \n\ndefiniram-se os seguintes: \n\n\n\n3 \n\n \n\n? Medi\u00e7\u00e3o da temperatura ambiente com uma resolu\u00e7\u00e3o e precis\u00e3o de 0,1\u00baC; \n\n? Medi\u00e7\u00e3o da temperatura da placa do controlador com uma resolu\u00e7\u00e3o e \n\nprecis\u00e3o de 0,1\u00baC; \n\n? Medi\u00e7\u00e3o da temperatura dos gases de escape com uma resolu\u00e7\u00e3o de 0,1\u00baC e \n\numa precis\u00e3o de 2\u00baC; \n\n? Cinco n\u00edveis de funcionamento dos motores (alimenta\u00e7\u00e3o e ventiladores); \n\n? Armazenamento permanente da data e hora atual; \n\n? A\u00e7\u00f5es em caso de falha de energia; \n\n  \n\n\n\n4 \n\n \n\n  \n\n\n\n5 \n\n \n\nCap\u00edtulo 2 CONCEITOS E ESTADO DA ARTE \n\nCom o corrente aumento do pre\u00e7o dos combust\u00edveis f\u00f3sseis torna-se cada vez mais \n\nimperativa a necessidade de utilizar formas de produ\u00e7\u00e3o de energia alternativa no que \n\ndiz respeito \u00e0 produ\u00e7\u00e3o de eletricidade e produ\u00e7\u00e3o de combust\u00edveis destinados ao \n\naquecimento de casas, autom\u00f3veis, m\u00e1quinas industriais, etc. A biomassa \u00e9, neste \n\nmomento, uma poss\u00edvel solu\u00e7\u00e3o de uma energia renov\u00e1vel, amiga do ambiente \n\npermitindo reduzir emiss\u00f5es de gases com efeito de estufa (GEE). A utiliza\u00e7\u00e3o desta \n\nfonte energ\u00e9tica permite ainda diminuir o risco de inc\u00eandios, ao promover um maior \n\naproveitamento dos res\u00edduos florestais, conduzindo a uma melhor limpeza destes \n\nespa\u00e7os, e aumentar a empregabilidade em \u00e1reas rurais [1, 2]. Ao reconhecer estes \n\nbenef\u00edcios, a UE, em 2005, come\u00e7ou a estabelecer incentivos para o uso desta fonte \n\nde energia, apostando na forma\u00e7\u00e3o de agricultores, no fornecimento de equipamento \n\npara produtores e no investimento de instala\u00e7\u00f5es de produ\u00e7\u00e3o de biocombust\u00edveis [3]. \n\nEstimou-se, em 2008, que o uso de energia renov\u00e1vel havia duplicado desde h\u00e1 35 \n\nanos atr\u00e1s, apesar de apenas corresponder a 13% da energia total consumida no \n\nnosso planeta, sendo que 10% correspondia a biomassa [4, 5]. A grande desvantagem \n\ndeste tipo de energia, quando oriunda da madeira, no seu estado bruto, reside no seu \n\nmais baixo poder calor\u00edfico comparativamente com os combust\u00edveis f\u00f3sseis, ao \n\nconte\u00fado de humidade e condi\u00e7\u00f5es de alimenta\u00e7\u00e3o. Para contornar esta desvantagem \n\ntem-se cada vez mais optado pela utiliza\u00e7\u00e3o de biomassa densificada sob a forma de \n\npellets, cuja densidade vol\u00famica e energ\u00e9tica \u00e9 superior quando comparada com a \n\nbiomassa no seu estado bruto, facilitando o seu transporte e aumentando a efici\u00eancia \n\nno seu manuseio. Al\u00e9m disso, o seu pre\u00e7o tem vindo a decrescer nos \u00faltimos anos [6]. \n\n2.1 PELLETS \n\nPellets s\u00e3o um tipo de biocombust\u00edvel granulado, com forma cil\u00edndrica, que resulta da \n\ncompress\u00e3o de diversos tipos de biomassa como cascas e podas de \u00e1rvore, \n\nserradura, maravalha e res\u00edduos resultantes da constru\u00e7\u00e3o civil e madeireiras [6, 7]. \n\nA sua forma, tamanho, teor de humidade, densidade vol\u00famica e conte\u00fado energ\u00e9tico \n\nuniformes s\u00e3o o que realmente fazem este combust\u00edvel destacar-se de todos os outros \n\noriundos da biomassa. \u00c9 esta uniformidade que vai permitir uma alimenta\u00e7\u00e3o mais \n\nf\u00e1cil e controlada. As suas dimens\u00f5es variam entre 10mm e 30mm de comprimento e \n\nentre 6mm e 10mm de di\u00e2metro. Tipicamente possui um baixo teor de humidade que \n\nvai dos 4% aos 8%, comparados com 20% a 60% da biomassa em bruto, o que vai \n\npermitir uma maior efici\u00eancia na sua combust\u00e3o. A sua densidade vol\u00famica situa-se na \n\n\n\n6 \n\n \n\nordem dos 650 kg.m-3, um valor que pode chegar a ser 4 vezes superior ao da \n\nbiomassa em bruto, e o seu valor energ\u00e9tico \u00e9, em m\u00e9dia de 4.8 kWh.kg-1, o que \n\npermite que uma maior quantidade (massa) de combust\u00edvel possa ser transportada de \n\ncada vez, al\u00e9m do associado conte\u00fado energ\u00e9tico [2, 8, 9]. \n\n \n\n \n\nFigura 2.1 - Pellets [10] \n\nOs benef\u00edcios para o ambiente s\u00e3o claros, quando comparados com os combust\u00edveis \n\nf\u00f3sseis. As concentra\u00e7\u00f5es de gases poluentes e que contribuem para o efeito de \n\nestufa s\u00e3o bastante inferiores, decorrentes da sua produ\u00e7\u00e3o, transporte e utiliza\u00e7\u00e3o. \n\nConsideram-se mesmo neutras as emiss\u00f5es de di\u00f3xido de carbono (CO2), tendo em \n\nconta o seu ciclo normal (Figura 2.2) [11]. \n\n \n\n \n\nFigura 2.2 - Ciclo do CO2  \n\n\n\n7 \n\n \n\n2.1.1 - PROCESSO DE FABRICO DE PELLETS \n\nO processo de fabrico de pellets envolve v\u00e1rias etapas que devem ser monitorizadas e \n\nrealizadas sequencialmente. S\u00e3o elas: \n\n1. Rece\u00e7\u00e3o da mat\u00e9ria-prima \u2013 os res\u00edduos florestais encontram-se no seu estado \n\nbruto. S\u00e3o pesadas diferentes amostras de material, podendo ser feita uma \n\npr\u00e9-separa\u00e7\u00e3o entre conte\u00fados secos e h\u00famidos. O conte\u00fado seco deve ser \n\narmazenado dentro de um espa\u00e7o fechado para evitar a forma\u00e7\u00e3o de poeiras \n\nindesej\u00e1veis; \n\n2. Secagem \u2013 o teor de humidade da mat\u00e9ria-prima \u00e9 colocado em n\u00edveis \n\nreduzidos. Esta fase pode ser realizada utilizando dois m\u00e9todos diferentes. Um \n\ndeles consiste na utiliza\u00e7\u00e3o de um secador tambor/rotativo (Figura I.3) que \n\nfunciona a altas temperaturas e \u00e9 principalmente utilizada para part\u00edculas finas, \n\nenquanto a mesa secadora (Figura I.4) a temperaturas mais baixas, para \n\npart\u00edculas de maiores dimens\u00f5es [12, 13]; \n\n \n\n \n\nFigura 2.3 - Secador tambor rotativo \n\n \n\nFigura 2.4 - Mesa de secagem \n\n3. Crivagem \u2013 separa\u00e7\u00e3o de material n\u00e3o resultante da biomassa como pedras, \n\npl\u00e1sticos, peda\u00e7os de metal, etc. Esta fase \u00e9 permut\u00e1vel com a anterior; \n\n4. Tritura\u00e7\u00e3o ou Moagem \u2013 processo de homogeneiza\u00e7\u00e3o da mat\u00e9ria-prima, que \n\nreduz as dimens\u00f5es dos res\u00edduos; \n\n5. Granula\u00e7\u00e3o ou Peletiza\u00e7\u00e3o \u2013 o pellet ganha a sua forma. \u00c9 utilizado um rolo \n\npara comprimir o material contra uma prensa que possui uma matriz aquecida \n\ncom pequenos orif\u00edcios, permitindo a sua forma\u00e7\u00e3o sob condi\u00e7\u00f5es de \n\ntemperatura e press\u00e3o elevados; \n\n6. Arrefecimento \u2013 fase final da cria\u00e7\u00e3o do pellet, cuja temperatura se encontra na \n\nordem dos 150\u00baC. Atrav\u00e9s de fluxos de ar frio os pellets s\u00e3o arrefecidos e \n\nganham a sua forma final; \n\n\n\n8 \n\n \n\n7. Verifica\u00e7\u00e3o \u2013 todos os pellets que n\u00e3o possuam as dimens\u00f5es estabelecidas \n\ns\u00e3o reintroduzidos no processo. \n\n8. Embalamento \u2013 dependendo do cliente final, os pellets podem ser embalados \n\nem sacos de 12, 15 e 20 kg ou ainda introduzidos num dep\u00f3sito maior de cerca \n\nde 1 tonelada. Contudo, os sacos conferem a garantia de maior qualidade do \n\nproduto na sua entrega, j\u00e1 que ficam menos expostos a agentes abrasivos \n\nexternos [14-17]. \n\n2.1.2 - DADOS ESTAT\u00cdSTICOS \n\nEm 2010 foram estimados como os maiores produtores europeus de pellets a \n\nAlemanha, a Su\u00e9cia, a \u00c1ustria e a It\u00e1lia com tend\u00eancia de subida, uma vez que nos \n\ncinco anos anteriores os pa\u00edses da Uni\u00e3o Europeia quadruplicaram a sua produ\u00e7\u00e3o. \n\nEm termos de consumo alguns destes pa\u00edses voltam a aparecer na lista como a \n\nSu\u00e9cia e a Alemanha, a que se juntam a Dinamarca, a B\u00e9lgica e a Holanda [18]. \n\nPortugal, comparativamente com estes pa\u00edses n\u00e3o \u00e9 dos que menos produz (430 mil \n\ntoneladas por ano), contudo o seu consumo \u00e9 irris\u00f3rio, exportando praticamente 50% \n\ndo que produz e armazenando o restante (Tabela 2.1). \n\n \n\nPa\u00eds \nProdu\u00e7\u00e3o \n\n(kt/ano) \n\nConsumo \n\n(kt/ano) \n\nExporta\u00e7\u00e3o \n\n(kt/ano) \n\nAlemanha 1750 1200 543 \n\n\u00c1ustria 850 660 285 \n\nB\u00e9lgica 286 920 50 \n\nDinamarca 180 1600 184 \n\nHolanda 120 913 103 \n\nIt\u00e1lia 600 850 10 \n\nSu\u00e9cia 1645 2200 69 \n\nTabela 2.1 - Principais produtores e consumidores de pellets da EU em 2010 \n\nRelativamente \u00e0 produ\u00e7\u00e3o de pellets existe uma norma estabelecida em 1999 e \n\natualizada em 2010 pela Uni\u00e3o Europeia atrav\u00e9s do seu Comit\u00e9 de Normaliza\u00e7\u00e3o para \n\ngarantir a sua boa qualidade em termos qu\u00edmicos e mec\u00e2nicos [19]. Essa norma \u00e9 \n\ndenominada de EN 14961 e estabelece limites para mais de quinze propriedades do \n\npellet, das quais se destacam o di\u00e2metro, comprimento, densidade, o grau de \n\nhumidade e poeiras, valor calor\u00edfico, etc. Esta especifica\u00e7\u00e3o envolve tr\u00eas grupos \n\ndiferentes de pellets que s\u00e3o classificados quanto \u00e0 sua origem [20]. \n\n\n\n9 \n\n \n\n2.2 SISTEMAS DE AQUECIMENTO A PELLETS \n\nA maioria dos sistemas de aquecimento a pellets de pequena escala encontra-se entre \n\nos pa\u00edses mais consumidores deste tipo de combust\u00edvel, como a Alemanha, a \u00c1ustria \n\ne a Su\u00e9cia. Comparativamente com aparelhos convencionais a g\u00e1s ou gas\u00f3leo, v\u00e1rios \n\nproblemas se levantam, como por exemplo: os requisitos em termos de espa\u00e7o, a \n\nefici\u00eancia na convers\u00e3o de energia, as emiss\u00f5es e a manuten\u00e7\u00e3o. Contudo, estas \n\ndesvantagens podem ser minimizadas e at\u00e9 anuladas utilizando estrat\u00e9gias cuidadas \n\nna sua conce\u00e7\u00e3o, como por exemplo o dimensionamento do tamanho e pot\u00eancia \n\nnominal do aparelho em fun\u00e7\u00e3o das dimens\u00f5es do espa\u00e7o envolvente, a sua limpeza \n\nregular, a modula\u00e7\u00e3o do poder de queima, a otimiza\u00e7\u00e3o da combust\u00e3o, etc [19]. \n\nOs aparelhos a pellets utilizados para aquecimento de interiores s\u00e3o genericamente \n\ntr\u00eas e ser\u00e3o abordados nas pr\u00f3ximas sec\u00e7\u00f5es. A t\u00edtulo de exemplo, o esquema de um \n\nrecuperador de calor, com v\u00e1rias perspetivas pode ser encontrado na Figura 8.1. \n\n2.2.1 - RECUPERADOR DE CALOR \n\nEste aparelho destina-se ao aquecimento do ar circundante de um espa\u00e7o fechado, \n\nnomeadamente uma sala de uma casa. O calor resultante do aquecimento \u00e9 \n\ntransferido atrav\u00e9s da circula\u00e7\u00e3o for\u00e7ada provocada por um ventilador ambiente (VA) \n\nou por radia\u00e7\u00e3o. Existem duas configura\u00e7\u00f5es: uma vers\u00e3o independente (Figura 2.5) \n\nque necessita de tubagem extra para extra\u00e7\u00e3o de gases oriundos da combust\u00e3o e \n\noutra com integra\u00e7\u00e3o em chamin\u00e9s (Figura 2.6). Ambas apresentam um princ\u00edpio de \n\nfuncionamento semelhante, contudo a segunda possui claras vantagens no que toca a \n\nrequisitos em termos de espa\u00e7o [21, 22]. \n\nA vers\u00e3o independente possui normalmente um reservat\u00f3rio integrado de pellets de \n\ncapacidade limitada, podendo ser utilizado um outro exterior de maiores dimens\u00f5es. \n\nPara informa\u00e7\u00e3o do utilizador e do pr\u00f3prio controlador acerca do volume de pellets \n\npresentes, \u00e9 pr\u00e1tica comum a utiliza\u00e7\u00e3o de um sensor de n\u00edvel [23, 24] \n\n \n\n\n\n10 \n\n \n\n \n\nFigura 2.5 - Recuperador de calor \u2013 vers\u00e3o \n\nindependente \n\n \n\nFigura 2.6 - Recuperador de calor integrado \n\ncom chamin\u00e9 \n\nA alimenta\u00e7\u00e3o dos pellets para a c\u00e2mara de combust\u00e3o \u00e9 fornecida atrav\u00e9s de um \n\nparafuso helicoidal que se encontra ligado a um motor com velocidade de rota\u00e7\u00e3o \n\nbaixa e elevado bin\u00e1rio. Em fun\u00e7\u00e3o da dire\u00e7\u00e3o e sentido de entrada dos pellets na \n\nc\u00e2mara de combust\u00e3o onde se encontra o queimador, tr\u00eas poss\u00edveis tipos podem ser \n\nconsiderados. O mais comum designa-se por queimador com alimenta\u00e7\u00e3o por \n\ngravidade (Figura 2.7), em que o parafuso helicoidal conduz os pellets desde o \n\nreservat\u00f3rio de armazenamento at\u00e9 \u00e0 c\u00e2mara de combust\u00e3o obrigando-os a cair sobre \n\nela, por influ\u00eancia da for\u00e7a grav\u00edtica [25]. Outra solu\u00e7\u00e3o passa pela alimenta\u00e7\u00e3o do \n\nqueimador com sentido ascendente (Figura 2.8). Por \u00faltimo, \u00e9 ainda utilizada a \n\nconfigura\u00e7\u00e3o de queimador com alimenta\u00e7\u00e3o horizontal (Figura 2.9). Dos tipos \n\nreferidos, a primeira tem a vantagem de assegurar uma separa\u00e7\u00e3o entre o dep\u00f3sito de \n\narmazenamento e a c\u00e2mara de combust\u00e3o, al\u00e9m de reduzir o risco de reacendimento \n\ne de conseguir um melhor controlo sobre a quantidade de pellets introduzida. Em \n\ncontrapartida, tem a desvantagem deste tipo de alimenta\u00e7\u00e3o provocar um impacto \n\nnegativo na combust\u00e3o, devido \u00e0 sua constante perturba\u00e7\u00e3o. A segunda solu\u00e7\u00e3o n\u00e3o \n\nnecessita de um sistema de remo\u00e7\u00e3o de cinzas (ao contr\u00e1rio da terceira), uma vez que \n\nos pellets acabam por fazer esse trabalho guiando-as para fora dessa \u00e1rea. A \n\ncombust\u00e3o \u00e9 bastante est\u00e1vel, contudo, o per\u00edodo de extin\u00e7\u00e3o de chama \u00e9 longo e a \n\nprobabilidade de reacendimento \u00e9 elevada [19]. \n\n \n\n\n\n11 \n\n \n\n \nFigura 2.7 - Queimador com \n\nalimenta\u00e7\u00e3o por gravidade \n\n \nFigura 2.8 - Queimador com \n\nalimenta\u00e7\u00e3o ascendente \n\n \n \n \n\n \nFigura 2.9 - Queimador com \n\nalimenta\u00e7\u00e3o horizontal \n\nA igni\u00e7\u00e3o dos pellets d\u00e1-se utilizando uma resist\u00eancia el\u00e9trica de aquecimento, \n\nnormalmente cer\u00e2mica que atinge a temperatura necess\u00e1ria \u00e0 igni\u00e7\u00e3o dos pellets de \n\nforma r\u00e1pida e \u00e9, tipicamente, inserida numa ranhura presente na c\u00e2mara de \n\ncombust\u00e3o. Para se obter feedback do estado da chama utiliza-se um sensor sens\u00edvel \n\n\u00e0 luminosidade, tipicamente uma LDR. \n\nO ar que \u00e9 aproveitado para alimentar a combust\u00e3o pode entrar na c\u00e2mara de tr\u00eas \n\nformas distintas. Numa delas utiliza-se o pr\u00f3prio ar contido no compartimento que se \n\npretende aquecer (Figura 2.10). A segunda consiste numa entrada independente de ar \n\nvindo do exterior (Figura 2.11) e a terceira no aproveitamento do sistema de extra\u00e7\u00e3o \n\npara intercalar um outro canal para entrada de ar (Figura 2.12) [21]. \n\n \n\nFigura 2.10 - Entrada de ar do \n\npr\u00f3prio compartimento \n\n \n\nFigura 2.11 - Opera\u00e7\u00e3o com \n\nentrada direta de ar do exterior \n\n \n\nFigura 2.12 - Entrada de ar \n\nnum canal independente da \n\nchamin\u00e9 \n\nO n\u00edvel de extra\u00e7\u00e3o dos gases oriundos da combust\u00e3o para o ambiente exterior ao \n\nespa\u00e7o fechado, deve ser controlado por um ventilador (VE), em fun\u00e7\u00e3o da sua \n\ntemperatura e concentra\u00e7\u00e3o de oxig\u00e9nio. Para tal \u00e9 comum utilizar-se um termopar ou \n\nPt1000 e um sensor lambda respetivamente. O efluente produzido pela combust\u00e3o \n\ndeve conter uma concentra\u00e7\u00e3o de oxig\u00e9nio entre 5% e 8% o que garante uma \n\ncombust\u00e3o \u00f3tima e uma reduzida emiss\u00e3o de gases poluentes, tais como mon\u00f3xido de \n\ncarbono e \u00f3xido nitroso. A varia\u00e7\u00e3o da densidade dos pellets que entram na c\u00e2mara \n\nde combust\u00e3o, pode deteriorar o processo se o fluxo de ar n\u00e3o seguir essa varia\u00e7\u00e3o \n\n[6, 19]. \n\n\n\n12 \n\n \n\nO controlo da temperatura do compartimento onde o recuperador se encontra inserido, \n\ndeve ter em conta a temperatura desejada pelo utilizador. Se a temperatura ambiente \n\nestiver abaixo do valor desejado, o controlador deve automaticamente regular a \n\nintensidade de combust\u00e3o, em fun\u00e7\u00e3o do diferencial de temperatura, para atingir o \n\nsetpoint. Justifica-se, por isso, a instala\u00e7\u00e3o um sensor de temperatura ambiente. \n\n2.2.2 - CALDEIRA \n\nO princ\u00edpio de funcionamento \u00e9 muito semelhante ao do recuperador de calor, \n\ndiferenciando-se, principalmente, no seu fim \u2013 o aquecimento de \u00e1guas sanit\u00e1rias ou \n\noutro tipo de l\u00edquido. Requisitos de espa\u00e7o s\u00e3o bastante mais exigentes, uma vez que \n\nestes aparelhos possuem dimens\u00f5es consider\u00e1veis necessitando, em grande parte \n\ndos casos, de um compartimento anexo para a sua instala\u00e7\u00e3o com espa\u00e7o suficiente \n\npara um reservat\u00f3rio integrado de pellets, podendo ainda possuir outro para \u00e1gua \n\n(Figura 2.13) [26, 27]. Al\u00e9m disso, torna-se imprescind\u00edvel a utiliza\u00e7\u00e3o de todo um \n\ncircuito de aquecimento, onde se podem incluir tubos, v\u00e1lvulas, radiadores, serpentina, \n\ndep\u00f3sitos, bombas de \u00e1gua, etc. Eventualmente pode, ainda, estar associado a um \n\nsistema combinado com energia solar [28]. \n\nO ar quente produzido dentro da c\u00e2mara de combust\u00e3o encontra o permutador de \n\ncalor que realiza a transfer\u00eancia de energia dos gases quentes para a \u00e1gua. A limpeza \n\nregular deste componente \u00e9 fulcral para o rendimento do aparelho e sua efici\u00eancia \n\nenerg\u00e9tica. Por essa raz\u00e3o, j\u00e1 existem sistemas de limpeza autom\u00e1tica [29]. Para \n\ncolocar a \u00e1gua em circula\u00e7\u00e3o, sobre todo o sistema, recorre-se a uma ou mais bombas \n\nde \u00e1gua. Os outros atuadores necess\u00e1rios continuam a ser o ventilador de extra\u00e7\u00e3o de \n\ngases, a resist\u00eancia de igni\u00e7\u00e3o e o alimentador de pellets, assim como todos os \n\nsistemas de limpeza autom\u00e1tica de remo\u00e7\u00e3o/armazenamento de cinzas e poeiras. \n\nApesar do controlo efetuado ser sobre a temperatura da \u00e1gua quente que sai da \n\ncaldeira, o tipo de sensor destinado para a medi\u00e7\u00e3o da temperatura ambiente pode, \n\nmuitas vezes ser igualmente utilizado para medi\u00e7\u00e3o da temperatura da \u00e1gua, como por \n\nexemplo um term\u00edstor NTC. Todos os restantes sensores abordados no recuperador \n\nde calor justificam-se igualmente neste aparelho. \n\n \n\n\n\n13 \n\n \n\n \n\nFigura 2.13 - Caldeira a pellets fabricada em \u00c1ustria \n\n2.2.3 - QUEIMADOR \n\nTrata-se de um dispositivo mais simples, podendo ser integrado tanto em \n\nrecuperadores de calor como em caldeiras (Figura 2.14). Destina-se essencialmente \u00e0 \n\nprodu\u00e7\u00e3o de calor a altas temperaturas para pr\u00e9 aquecimento de sistemas, como \n\nfornos ou secadores industriais. A combust\u00e3o d\u00e1-se de forma ligeiramente diferente, \n\numa vez que a circula\u00e7\u00e3o de ar no seu interior se d\u00e1 por sopro, ao contr\u00e1rio dos \n\naparelhos referidos anteriormente que funcionam por aspira\u00e7\u00e3o dos gases de escape. \n\nAo n\u00edvel de sensores, apenas \u00e9 necess\u00e1rio o sensor de temperatura para os gases de \n\nescape, enquanto os sensores de chama e de n\u00edvel de pellets s\u00e3o opcionais. \n\nA resist\u00eancia de igni\u00e7\u00e3o, assim como o ventilador de extra\u00e7\u00e3o de gases s\u00e3o os \n\nprincipais atuadores necess\u00e1rios deste tipo de aparelho. \n\n \n\nFigura 2.14 - Queimador ECOAMA [1] \n\nComo acrescento a estes aparelhos, podem ainda ser introduzidos sistemas de \n\ntransporte de pellets, atrav\u00e9s de parafuso helicoidal ou suc\u00e7\u00e3o aplicando-se a primeira \n\na reservat\u00f3rios pequenos e a segunda de maiores dimens\u00f5es. Ao n\u00edvel da seguran\u00e7a, \n\nexistem alguns mecanismos contra reacendimentos, em queimadores horizontais ou \n\n\n\n14 \n\n \n\nascendentes, como um pequeno sistema de aspers\u00e3o de \u00e1gua ou ainda mecanismos \n\nde separa\u00e7\u00e3o entre o parafuso alimentador e o queimador. \n\n2.3 PRINC\u00cdPIO DE FUNCIONAMENTO \n\nComo j\u00e1 foi referido, o princ\u00edpio de funcionamento destes aparelhos \u00e9 muito \n\nsemelhante, destacando-se quatro estados principais: \n\n \n\n? Inatividade - a m\u00e1quina encontra-se em repouso, n\u00e3o existindo qualquer \n\natividade em execu\u00e7\u00e3o. O controlador deve encontrar-se em modo de baixo \n\nconsumo. \n\n? Igni\u00e7\u00e3o - os pellets s\u00e3o transportados para a c\u00e2mara de combust\u00e3o e a\u00ed s\u00e3o \n\nsujeitos a igni\u00e7\u00e3o atrav\u00e9s do calor dissipado por uma resist\u00eancia de \n\naquecimento; \n\n? Trabalho/Queima \u2013 a combust\u00e3o de pellets encontra-se em andamento e o \n\ncalor resultante \u00e9 transferido para o ar interior de um compartimento no caso \n\ndo recuperador/queimador ou para a \u00e1gua, se o aparelho for uma caldeira. \n\n? Extin\u00e7\u00e3o \u2013 a chama \u00e9 extinta de forma gradual para evitar reacendimentos. \n\nDeve garantir-se um tempo m\u00ednimo nesta fase esperando que a temperatura \n\nda c\u00e2mara de combust\u00e3o baixe at\u00e9 um certo valor. \n\n\u00c9 ainda comum acrescentar-se um estado de observa\u00e7\u00e3o para o caso da temperatura \n\ndo ar ou da \u00e1gua exceder a desejada e assim evitar todo um reiniciar do processo \n\ndesde a fase de igni\u00e7\u00e3o, quando for necess\u00e1rio voltar a aumentar a temperatura. \n\nDesta forma, garante-se uma continua\u00e7\u00e3o eficaz do processo e uma melhor \n\nperformance no que toca \u00e0 redu\u00e7\u00e3o de emiss\u00f5es poluentes para a atmosfera [28]. \n\n2.4 REGULAMENTA\u00c7\u00c3O DE EMISS\u00d5ES \n\nA utiliza\u00e7\u00e3o exaustiva de aparelhos a pellets para aquecimento pode resultar na \n\ndeteriora\u00e7\u00e3o da qualidade do ar e consequentemente provocar efeitos nefastos para a \n\nsa\u00fade humana. Assim, o Comit\u00e9 de Normaliza\u00e7\u00e3o da Uni\u00e3o Europeia criou em 1999 a \n\nnorma EN 303-5 na qual obriga os produtores deste tipo de equipamento a ter \n\npreocupa\u00e7\u00e3o com a sua conce\u00e7\u00e3o no que diz respeito \u00e0s emiss\u00f5es de certos gases \n\npoluentes: o mon\u00f3xido de carbono (CO), carbono org\u00e2nico gasoso (OGC) e poeiras. \n\nNesta norma, dividem-se as caldeiras a pellets quanto \u00e0 sua pot\u00eancia nominal e em \n\ntr\u00eas classes diferentes, em fun\u00e7\u00e3o da sua efici\u00eancia na transfer\u00eancia de calor para a \n\n\u00e1gua (Tabela 2.2): \n\n\n\n15 \n\n \n\n? Classe 1: 53%-62% \n\n? Classe 2: 63%-72% \n\n? Classe 3: 73%-82% \n\n \n\nTabela 2.2 - Limites de emiss\u00f5es de acordo com o EN 303-5 [30] \n\nAs emiss\u00f5es de CO associadas ao funcionamento destes sistemas dependem \n\nfortemente das caracter\u00edsticas do aparelho, no tipo de controlo e do n\u00famero de \n\nigni\u00e7\u00f5es e extin\u00e7\u00f5es efetuadas. Na maioria das unidades de aquecimento a pellets, \n\nquanto menor for o n\u00famero de igni\u00e7\u00f5es e extin\u00e7\u00f5es, menor ser\u00e1 a emiss\u00e3o de CO. A \n\nmodula\u00e7\u00e3o da intensidade de combust\u00e3o pode reduzir o n\u00famero de igni\u00e7\u00f5es e \n\nextin\u00e7\u00f5es, prolongando o tempo total do processo, enquanto a limpeza autom\u00e1tica do \n\nqueimador e remo\u00e7\u00e3o de cinzas asseguram condi\u00e7\u00f5es estacion\u00e1rias de combust\u00e3o \n\ncom maior efici\u00eancia e redu\u00e7\u00e3o das emiss\u00f5es de CO aumentando o conforto e a \n\naceita\u00e7\u00e3o por parte dos clientes [28]. \n\nA n\u00edvel europeu t\u00eam sido lan\u00e7ados alguns incentivos e r\u00f3tulos de qualidade sobre o \n\nfabrico de aparelhos de aquecimento a pellets, motivando os seus fabricantes a \n\nelevarem a qualidade dos seus produtos, garantindo maior visibilidade no mercado \n\natual [19]. \n\n2.5 CONTROLADORES DE APARELHOS DE AQUECIMENTO A BIOMASSA \n\nAtualmente s\u00e3o grandes os avan\u00e7os verificados na ind\u00fastria dos controladores para \n\naparelhos de aquecimento a pellets ou simplesmente a lenha. Consequ\u00eancia disso, \n\ns\u00e3o muitas as funcionalidades que estes suportam. Todos eles apresentam uma \n\ninterface com o utilizador baseada num display que pode estar contida num comando \n\nde m\u00e3o ou embutido no pr\u00f3prio aparelho de aquecimento. Em alguns displays a \n\nfuncionalidade de touch, sem a presen\u00e7a f\u00edsica de bot\u00f5es j\u00e1 se encontra dispon\u00edvel. \n\n\n\n16 \n\n \n\nEstes controladores s\u00e3o bastante compactos apesar das muitas interfaces de \n\nentrada/sa\u00edda que j\u00e1 apresentam (ver funcionalidades na Tabela 2.3). \n\nAlguns exemplos de controladores atualmente existentes no mercado s\u00e3o: \n\n? BMC 020X (TEM-Sui\u00e7a \u2013 Figuras 2.15 e 2.16) [31]; \n\n? ST-91 (TECH \u2013 Pol\u00f3nia \u2013 Figura 2.17) [32]; \n\n? NPBC-V5 (Naturela Electronics \u2013 Bulg\u00e1ria \u2013 Figura 2.18) [33]; \n\n? Fumis ALPHA (ATech Electronics \u2013 Eslov\u00e9nia \u2013 Figura 2.19) [34]. \n\n \n\n \n\nFigura 2.15 \u2013 Controlador BMC 020X \n\n \n\nFigura 2.16 - Interface com o \n\nutilizador do controlador BMC 020X \n\n \n\n \n\nFigura 2.17 \u2013 Controlador ST-91 \n\n \n\nFigura 2.18 \u2013 Controlador NPBC-V5 \n\n\n\n17 \n\n \n\n \n\nFigura 2.19 \u2013 Controlador Fumis ALPHA \n\n\n\n18 \n\n \n\nControlador Aparelho (s) \nModos de \n\nOpera\u00e7\u00e3o \nEntradas Sensores Atuadores Sa\u00eddas Limpeza Interfaces \n\nBMC 020X \n\nCaldeira a \n\npellets ou \n\nlenha \n\nManual ou \n\nAutom\u00e1tico \n14 \n\n? Temperatura ambiente (NTC) \n\n?  Sensor de temperatura dos gases de \n\nescape (PT 1000) \n\n? Concentra\u00e7\u00e3o de Oxig\u00e9nio (Lambda) \n\n? Press\u00e3o \n\n? Interruptor de porta \n\n? Motor de alimenta\u00e7\u00e3o \n\n? Resist\u00eancia de igni\u00e7\u00e3o \n\n? Bomba de \u00e1gua \n\n? Ventilador de extra\u00e7\u00e3o \n\nde gases \n\n12 (230 \n\nVAC) \n\n2 (baixa \n\ntens\u00e3o) \n\nAutom\u00e1tica \n\n? Utilizador \n\nDisplay \n\nembutido \n\nST-91 \nCaldeira a \n\npellets \nAutom\u00e1tico - \n\n? Detetor de chama \n\n? Interruptor t\u00e9rmico \n\n? Temperatura da \u00e1gua quente e do \n\naquecimento central \n\n? Temperatura dos gases de escape \n\n? Aquecedor de igni\u00e7\u00e3o \n\n? Ventilador de extra\u00e7\u00e3o \n\ndos gases de escape \n\n? Motor de Alimenta\u00e7\u00e3o \n\n? Duas bombas de \u00e1gua \n\n? Duas v\u00e1lvulas de mistura \n\n- Manual \n? Utilizador \n\nDisplay \n\nEmbutido \n\nNPBC-V5 \n\nCaldeira ou \n\nQueimador a \n\npellets \n\nAutom\u00e1tico 18 \n\n? Detetor de chama \n\n? Temperatura dos gases de escape \n\n(Pt100 ou Pt1000) \n\n? Temperatura da \u00e1gua na caldeira e no \n\ndep\u00f3sito exterior \n\n? Temperatura da \u00e1gua no sistema de \n\naquecimento central \n\n? Interruptor de porta \n\n? Velocidade de rota\u00e7\u00e3o do ventilador \n\nprincipal (Sensor de Hall) \n\n? Termostato para controlo da \n\ntemperatura do compartimento \n\n? Alimentador de pellets \n\n? Resist\u00eancia de igni\u00e7\u00e3o \n\n? Tr\u00eas ventiladores \n\n? Quatro bombas de \u00e1gua \n\n20 (220 ou \n\n110 VAC) \nAutom\u00e1tica \n\n? Utilizador \n\nDisplay com \n\ncomando \n\n \n\n? Programador \n\nInterface \n\nRS232 para \n\nconex\u00e3o com \n\num PC \n\nFUMIS \n\nALPHA \n\nCaldeiras, \n\nQueimadores e \n\nRecuperadores \n\na pellets ou \n\nlenha \n\nManual ou \n\nAutom\u00e1tico \n12 \n\n? Temperatura ambiente ou da \u00e1gua \n\n(NTC ou Pt100 ou Pt1000) \n\n? Temperatura dos gases de escape \n\n(dois termopares K) \n\n? N\u00edvel de pellets \n\n? Velocidade de rota\u00e7\u00e3o dos \n\nventiladores \n\n? Termostato exterior \n\n? Interruptor t\u00e9rmico \n\n? Press\u00e3o \n\n? Interruptor de porta \n\n? Concentra\u00e7\u00e3o de oxig\u00e9nio (Lambda) \n\n? Resist\u00eancia de igni\u00e7\u00e3o \n\n? Motor de alimenta\u00e7\u00e3o \n\n? Ventilador de extra\u00e7\u00e3o de \n\ngases de escape \n\n? Ventilador ambiente \n\n? Bomba de \u00e1gua \n\n? V\u00e1lvula de mistura \n\n8 (com \n\nm\u00faltiplas \n\nfun\u00e7\u00f5es) \n\nAutom\u00e1tica \n\nou Manual \n\n? Utilizador \n\nDisplay com \n\ncomando ou \n\nembutido \n\n \n\n? Programador \n\nInterface \n\nRS232 para \n\nconex\u00e3o com \n\num PC \n\nTabela 2.3 - Caracter\u00edsticas dos controladores do mercado europeu \n\n\n\n19 \n\n \n\nAnalisando a Tabela 2.3 pode concluir-se que os controladores apresentados \n\npossuem funcionalidades operacionais muito semelhantes, diferindo no n\u00famero de \n\ninterfaces de entrada e sa\u00edda e nas interfaces com o utilizador e programador. \n\nO \u00faltimo controlador referido na mesma tabela corresponde ao que \u00e9 utilizado nos \n\nequipamentos fabricados pela ECOAMA e ter\u00e1 por isso objeto de uma an\u00e1lise mais \n\nextensiva. \n\n2.5.1 - FUMIS ALPHA \n\nFabricado na Eslov\u00e9nia pela ATech Electronics este dispositivo revela-se como uma \n\navan\u00e7ada ferramenta de controlo de sistemas de aquecimento tendo como \n\ncombust\u00edvel a biomassa, seja ela pellets, aparas de madeira, lenha, etc. \n\nO seu funcionamento \u00e9 100% autom\u00e1tico, possibilitando um baixo consumo de \n\ncombust\u00edvel e emiss\u00f5es de gases reduzidas. A combust\u00e3o \u00e9 otimizada em todos os \n\nmodos de opera\u00e7\u00e3o e permite uma redu\u00e7\u00e3o dos custos associados a este tipo de \n\nsistemas. A interface com o utilizador \u00e9 apelativa e intuitiva, atrav\u00e9s de um ecr\u00e3 com \n\nv\u00e1rios displays de 7 segmentos e bot\u00f5es em posi\u00e7\u00f5es espec\u00edficas sens\u00edveis ao toque. \n\nPermite operar com doze configura\u00e7\u00f5es diferentes, das quais tr\u00eas se aplicam a \n\nrecuperadores de calor, sete a caldeiras e as restantes a queimadores. Dependendo \n\nda vers\u00e3o do controlador, podem encontrar-se v\u00e1rias disposi\u00e7\u00f5es de interfaces I/O \n\nfornecidas. Podem ainda ser assegurados servi\u00e7os de monitoriza\u00e7\u00e3o e fine tuning de \n\npar\u00e2metros atrav\u00e9s do FUMIS PC-PRO, uma aplica\u00e7\u00e3o para PC ou do FUMIS WEB-\n\nPRO, uma ferramenta WEB para utiliza\u00e7\u00e3o remota. Complementando estes dois \n\nservi\u00e7os, disponibiliza-se um m\u00f3dulo de monitoriza\u00e7\u00e3o remota via SMS atrav\u00e9s do \n\nFUMIS GSM / GPRS REMOTE CONTROL UNIT G2RCU, que \u00e9 respons\u00e1vel pelo \n\nenvio de mensagens de texto para o utilizador sobre o estado do processo [34]. \n\nSendo este um controlador gen\u00e9rico, corre-se o risco de pagar um valor elevado pela \n\nsua aquisi\u00e7\u00e3o, com funcionalidades que podem n\u00e3o ser necess\u00e1rias. At\u00e9 ao momento \n\na ECOAMA utiliza este controlador apenas em caldeiras, recuperadores de calor e \n\nqueimadores exclusivamente a pellets, contudo ele pode ser utilizado no mesmo tipo \n\nde aparelhos alimentados com outro tipo de combust\u00edvel. No diz respeito aos \n\nsensores, n\u00e3o se est\u00e3o a utilizar sensores lambda para otimiza\u00e7\u00e3o da combust\u00e3o, mas \n\napenas sensores de temperatura. Al\u00e9m destes, nenhum sensor de press\u00e3o, de \n\ndete\u00e7\u00e3o de abertura de porta ou de n\u00edvel de pellets se encontra a ser utilizado. \n\n\n\n20 \n\n \n\n2.5.2 - PRIMEIRA VERS\u00c3O DO CONTROLADOR \n\nNo \u00e2mbito de um projeto anterior, foi desenvolvido um controlador destinado \u00e0 \n\nopera\u00e7\u00e3o de um recuperador de calor (Figura 2.20) [35]. \n\n \n\n \n\nFigura 2.20 - Primeira vers\u00e3o do controlador \n\nEste controlador foi dividido em duas placas. Uma constitu\u00edda por um microcontrolador \n\n(PIC32-MAXI-WEB), perif\u00e9ricos de entrada/sa\u00edda e ainda um LCD Touchscreen \n\nincorporado [36]. Na segunda placa encontra-se o hardware de acondicionamento de \n\nsinal para sensores, a interface de pot\u00eancia para controlo dos atuadores e a fonte de \n\nalimenta\u00e7\u00e3o. Al\u00e9m de possuir dimens\u00f5es consider\u00e1veis (260mm x 140mm), neste \n\ncontrolador n\u00e3o se encontram mecanismos de armazenamento de par\u00e2metros de \n\nforma permanente, nem da data e hora. Alguns dos circuitos de acondicionamento \n\npossuem pequenos problemas ou precisam de ser melhorados. A resolu\u00e7\u00e3o na \n\nmedi\u00e7\u00e3o de temperaturas \u00e9 de 1\u00baC e deve ser reduzida, al\u00e9m de ser necess\u00e1rio \n\nalargar a gama de medi\u00e7\u00e3o da temperatura ambiente que se encontra entre 10\u00baC e \n\n30\u00baC, com o objetivo de poder vir, eventualmente, a ser utilizado em pa\u00edses mais frios. \n\nO filtro RC utilizado na medi\u00e7\u00e3o da temperatura dos gases de escape deve ser \n\ntamb\u00e9m revisto. Relativamente \u00e0 m\u00e1quina de estados implementada, apesar de ser \n\nfuncional, n\u00e3o foi elaborada de forma estruturada separando a\u00e7\u00f5es de transi\u00e7\u00f5es entre \n\nestados. As funcionalidades apresentadas s\u00e3o reduzidas, sendo apenas poss\u00edvel ligar \n\ne desligar o processo de aquecimento (cumprindo a m\u00e1quina de estados), visualizar \n\ntemperaturas, selecionar a temperatura desejada, a partir do LCD, e comunicar com \n\numa aplica\u00e7\u00e3o PC para programar alguns par\u00e2metros, ainda que n\u00e3o de forma \n\npermanente. \n\n\n\n21 \n\n \n\nEm termos est\u00e9ticos este controlador tamb\u00e9m denota algumas lacunas, uma vez que o \n\ndesenho da placa n\u00e3o seguiu uma l\u00f3gica de separa\u00e7\u00e3o entre pistas e componentes, \n\nficando sujeito mais facilmente a curto-circuitos involunt\u00e1rios. \n\nO pre\u00e7o \u00e9 inflacionado pela placa de desenvolvimento utilizada, que possui diversos \n\nrecursos que n\u00e3o s\u00e3o necess\u00e1rios tornando-se, portanto, imperativa a utiliza\u00e7\u00e3o de um \n\nmicrocontrolador mais simples com as caracter\u00edsticas b\u00e1sicas necess\u00e1rias para a \n\ncomunica\u00e7\u00e3o com outros perif\u00e9ricos, leitura de sinais anal\u00f3gicos, processamento, etc. \n\nO LCD escolhido dever\u00e1 ser, assim, introduzido na nova placa de desenvolvimento \n\npara o controlador, tendo em conta as caracter\u00edsticas do novo microcontrolador, al\u00e9m \n\nde ser necess\u00e1rio realizar toda a programa\u00e7\u00e3o \u201cde raiz\u201d para a sua intera\u00e7\u00e3o.  \n\n\n\n22 \n\n \n\n  \n\n\n\n23 \n\n \n\nCap\u00edtulo 3 FUNCIONALIDADES \n\nNo \u00e2mbito deste trabalho e tendo em vista a aplica\u00e7\u00e3o ao caso espec\u00edfico da opera\u00e7\u00e3o \n\nde um recuperador de calor a pellets, foram ponderadas as funcionalidades do \n\ncontrolador a desenvolver. Uma funcionalidade traduz-se num uso especial para que \n\nalgo seja concebido. Neste \u00e2mbito, foram considerados os seguintes grupos de \n\nfuncionalidades: a interface com o utilizador, a programa\u00e7\u00e3o hor\u00e1ria e a \n\nconfigura\u00e7\u00e3o/parametriza\u00e7\u00e3o. As sec\u00e7\u00f5es seguintes descrevem as principais \n\nfuncionalidades implementadas para o controlador de um recuperador de calor. \n\nControlador este que se destina a acionar um conjunto de dispositivos dispon\u00edveis, em \n\nfun\u00e7\u00e3o das exig\u00eancias processuais programadas, tendo em conta limites operat\u00f3rios \n\nde modo a oferecer a comodidade e seguran\u00e7a ao utilizador de forma vi\u00e1vel. \n\n3.1 ARMAZENAMENTO DA DATA E HORA \n\nEsta funcionalidade \u00e9 poss\u00edvel utilizando uma Real-Time Clock, um circuito integrado \n\npropositadamente concebido para armazenamento e contagem do tempo, mesmo em \n\ncaso de falha de energia. Normalmente \u00e9 ligada a uma pilha para esse efeito. Atrav\u00e9s \n\ndo armazenamento da data e hora no pr\u00f3prio controlador, \u00e9 permitido ao utilizador a \n\nsua consulta e agendamento do processo de aquecimento, assim como o seu acerto. \n\n3.2 INTERFACE COM LCD + TOUCHSCREEN \n\nAtrav\u00e9s de um LCD com fun\u00e7\u00e3o de toque, \u00e9 garantida uma interface visual rica e \n\napelativa para o interveniente, seja ele o utilizador normal ou o pr\u00f3prio instalador do \n\nsistema. Nesta interface, o utilizador ter\u00e1 um leque de a\u00e7\u00f5es que pode manipular \n\nconsoante as suas prefer\u00eancias. Note-se, contudo, que h\u00e1 uma \u00e1rea reservada a \n\nconfigura\u00e7\u00e3o e depura\u00e7\u00e3o do controlador, acess\u00edvel apenas ao instalador ou operador \n\nde manuten\u00e7\u00e3o atrav\u00e9s de palavra-passe. A Tabela 3.1 resume as a\u00e7\u00f5es que podem \n\nser realizadas por cada tipo de interveniente. \n\nTodos os ecr\u00e3s criados foram alvo de discuss\u00e3o e an\u00e1lise em conjunto com a empresa \n\nECOAMA, sendo que a sua vers\u00e3o final \u00e9 praticamente a idealizada. \n\n \n\n \n\n \n\n \n\n \n\n\n\n24 \n\n \n\nInterveniente A\u00e7\u00e3o \n\nUtilizador/ \n\nInstalador \n\nConsulta da data e hora atuais \n\nSele\u00e7\u00e3o de n\u00edvel m\u00e1xima de queima \n\nSele\u00e7\u00e3o de temperatura desejada \n\nVisualiza\u00e7\u00e3o de temperaturas \n\nAltera\u00e7\u00e3o da data e hora atuais \n\nPrograma\u00e7\u00e3o do crono termostato \n\nPrograma\u00e7\u00e3o do preditor \n\nSolicita\u00e7\u00e3o de in\u00edcio e fim de processo \n\nInstalador \n\nConfigura\u00e7\u00e3o de par\u00e2metros do sistema \n\nTeste aos atuadores \n\nBloqueio do teclado \n\nCalibra\u00e7\u00e3o \n\nTabela 3.1 - A\u00e7\u00f5es permitidas a partir do display em fun\u00e7\u00e3o do interveniente \n\n3.3 INTERFACE COM APLICA\u00c7\u00c3O PC \n\nA aplica\u00e7\u00e3o PC \u00e9 um programa de comunica\u00e7\u00e3o entre o computador e o controlador. \n\nEsta funcionalidade permite realizar algumas das a\u00e7\u00f5es proporcionadas pelo LCD e \n\nacrescenta tamb\u00e9m outras que n\u00e3o foram inclu\u00eddas nele por quest\u00f5es ergon\u00f3micas. \n\nSempre que ocorrer algum problema com o LCD, a aplica\u00e7\u00e3o PC torna-se importante \n\npara verificar se o restante hardware se encontra a funcionar como pretendido, \n\nfacilitando a depura\u00e7\u00e3o, al\u00e9m de poder substituir certas a\u00e7\u00f5es associadas ao \n\nmanuseamento da m\u00e1quina por parte do utilizador (Tabela 3.2). O instalador apenas \n\nnecessita de ligar um computador ou outro terminal de dados com interface s\u00e9rie \n\n(RS232/USB), que corra a aplica\u00e7\u00e3o, \u00e0 m\u00e1quina em quest\u00e3o passando de imediato a \n\ncomunicar com ela. \n\n \n\nInterveniente A\u00e7\u00e3o \n\nInstalador \n\nSele\u00e7\u00e3o de temperatura desejada \n\nVisualiza\u00e7\u00e3o de temperaturas \n\nPrograma\u00e7\u00e3o do crono termostato \n\nSolicita\u00e7\u00e3o de in\u00edcio e fim de processo \n\nConfigura\u00e7\u00e3o de par\u00e2metros do sistema \n\nTeste aos atuadores \n\nMonitoriza\u00e7\u00e3o do estado do processo \n\nMonitoriza\u00e7\u00e3o e configura\u00e7\u00e3o dos controladores \n\nTabela 3.2 - A\u00e7\u00f5es permitidas a partir da aplica\u00e7\u00e3o PC \n\n\n\n25 \n\n \n\n3.4 PROGRAMA\u00c7\u00c3O DO CRONO TERMOSTATO \n\nPor vezes, surge a necessidade do utilizador pretender agendar previamente o \n\nfuncionamento do processo de aquecimento para uma certa hora do dia. Este tipo de \n\nprograma\u00e7\u00e3o consiste na introdu\u00e7\u00e3o da hora de in\u00edcio e fim do processo, em horas e \n\nminutos, e ainda da temperatura ambiente desejada. O controlador deve, assim, ser \n\ncapaz de fazer arrancar o processo de aquecimento e finaliz\u00e1-lo no hor\u00e1rio \n\nestabelecido pelo utilizador, independentemente se o setpoint for atingido. \n\n3.5 COOPERA\u00c7\u00c3O DE CONTROLADORES \n\nPor quest\u00f5es de efici\u00eancia e economia, em certos casos torna-se vantajoso instalar \n\num conjunto de caldeiras de aquecimento de \u00e1guas sanit\u00e1rias, de menor capacidade, \n\nem substitui\u00e7\u00e3o de uma \u00fanica caldeira de maior capacidade. Neste cen\u00e1rio, pretende-\n\nse que as caldeiras funcionem de forma semiaut\u00f3noma, entrando cada uma delas em \n\nfuncionamento apenas quando necess\u00e1rio. Mais concretamente, o n\u00famero de \n\ncaldeiras em funcionamento \u00e9 proporcional ao diferencial entre a temperatura corrente \n\ne a temperatura desejada das \u00e1guas sanit\u00e1rias. Quando o diferencial \u00e9 grande, todas \n\nas caldeiras dever\u00e3o entrar em funcionamento, desligando-se \u00e0 medida que a \n\ntemperatura for subindo. \n\nUm controlador configurado em modo cooperativo distingue-se dos outros atrav\u00e9s de \n\num n\u00famero identificador, da temperatura abaixo da qual entra em funcionamento e do \n\nn\u00edvel de queima. Para configura\u00e7\u00e3o destes tr\u00eas par\u00e2metros de cada controlador, \n\nutiliza-se um controlador intermedi\u00e1rio com funcionalidade de gateway. Esta \n\nfuncionalidade permite que um controlador recolha os par\u00e2metros dos controladores \n\npresentes no barramento e se possa ligar a um computador ou terminal de dados para \n\nconfigura\u00e7\u00e3o e/ou monitoriza\u00e7\u00e3o. \n\n3.6 PREDI\u00c7\u00c3O \n\nEsta funcionalidade \u00e9 semelhante \u00e0 do crono termostato, com a diferen\u00e7a que o \n\nutilizador programa a hora a que pretende que o compartimento esteja a uma certa \n\ntemperatura, ao inv\u00e9s de indicar a que hora este se deve ligar. Assim, \n\nautonomamente, o controlador deve ser capaz de calcular a hora a que deve ligar o \n\nprocesso de aquecimento de forma a garantir que a temperatura ambiente atinge a \n\ntemperatura desejada \u00e0 hora estipulada. A calibra\u00e7\u00e3o da m\u00e1quina ao ambiente \n\nenvolvente deve ser o primeiro passo a realizar para se poder usufruir desta \n\nfuncionalidade. \n\n\n\n26 \n\n \n\n \n\n  \n\n\n\n27 \n\n \n\nCap\u00edtulo 4 HARDWARE \n\nNo \u00e2mbito deste trabalho, entenda-se hardware como um termo coletivo que engloba \n\ntoda a componente f\u00edsica do controlador, desde fios condutores, resist\u00eancias, \n\ntrans\u00edstores, circuitos integrados, circuitos de acondicionamento, display, motores, \n\nfonte de alimenta\u00e7\u00e3o, etc. O projeto do sistema desenvolvido, iniciou-se com a sua \n\nrepresenta\u00e7\u00e3o atrav\u00e9s de um diagrama de blocos. \n\n4.1 DIAGRAMA DE BLOCOS \n\nA Figura 4.1 representa o diagrama de blocos projetado para o controlador, assim \n\ncomo sensores e atuadores suportados. Ao longo deste cap\u00edtulo ser\u00e1 dado \u00eanfase a \n\ncada um dos blocos identificados, sendo descritos o seu prop\u00f3sito e analisados os \n\nseus detalhes. \n\nACTUATORES\n\nSENSORES\n\nTens\u00e3o da Rede\n(230V, 50Hz)\n\nResist\u00eancia \nde Igni\u00e7\u00e3o\n\nMotor de \nAlimenta\u00e7\u00e3o\n\nVentilador \nAmbiente\n\nVentilador de \nExtra\u00e7\u00e3o de \n\nFumos\n\nTermopar 2\nTerm\u00edstor \n\nNTC\n\nMCU\n\nLCD\nTouchscreen\n\nRTC\n\nBarramento \nCAN\n\nFonte de \nAlimenta\u00e7\u00e3o\n\nAcondicionamento \nde Sinal\n\nAcondicionamento \nde Sinal\n\nDetector de \nPassagem por \n\nZero\n\nAcondicionamento de Sinal\n(6 canais em TRIAC)\n\nCONTROLADOR\n\nBarramento \nUART\n\nTermopar 1\n\nAcondicionamento \nde Sinal\n\nSensor de \nchama\n\nAcondicionamento \nde Sinal\n\nBomba de \n\u00e1gua\n\nV\u00e1lvula de \nmistura\n\n \n\nFigura 4.1 \u2013 Diagrama de blocos do controlador e sensores e atuadores suportados \n\n \n\n\n\n28 \n\n \n\n4.2 DESCRI\u00c7\u00c3O DOS SENSORES E ATUADORES \n\n \n\nFigura 4.2 - Sistema de controlo de malha fechada gen\u00e9rico [37] \n\nDois dos principais elementos inerentes a um qualquer sistema de controlo s\u00e3o os \n\nsensores, dispositivos que respondem a uma altera\u00e7\u00e3o associada a um fen\u00f3meno \n\nf\u00edsico, produzindo um sinal proporcional na sua sa\u00edda e os atuadores, elementos \n\nfuncionais que estabelecem a liga\u00e7\u00e3o entre a parte de processamento de informa\u00e7\u00e3o \n\nde um sistema de controlo e o processo, sendo na maioria das situa\u00e7\u00f5es respons\u00e1vel \n\npela convers\u00e3o de energia el\u00e9trica em energia mec\u00e2nica [38, 39]. \n\n4.2.1 - SENSORES \n\nOs sensores adotados para este sistema s\u00e3o um term\u00edstor NTC (Figura 4.3), um \n\nLM335 (Figura 4.5) e um termopar tipo K (Figura 4.4), todos sensores de temperatura. \n\nO primeiro destina-se, essencialmente, \u00e0 medi\u00e7\u00e3o da temperatura do ar ambiente, se \n\nestiver inserido num recuperador de calor. Numa caldeira, este tem a fun\u00e7\u00e3o de medir \n\na temperatura das \u00e1guas sanit\u00e1rias. Trata-se de um sensor resistivo de coeficiente de \n\ntemperatura negativo, ou seja, \u00e0 medida que a temperatura aumenta a resist\u00eancia aos \n\nseus terminais diminui. A sua resposta \u00e9 altamente n\u00e3o linear, por isso, a express\u00e3o \n\npara ?(?) n\u00e3o \u00e9 trivial, al\u00e9m de que necessita de uma fonte de corrente para a sua \n\npolariza\u00e7\u00e3o. Contudo, apresenta uma boa precis\u00e3o e sensibilidade. A gama de \n\ntemperaturas suportada n\u00e3o \u00e9 extraordinariamente ampla (dos -50\u00baC aos 120\u00baC) mas \n\nsatisfaz plenamente as necessidades, tanto em ambientes dom\u00e9sticos como \n\nindustriais [40]. \n\n \n\n \n\nFigura 4.3 - Term\u00edstor NTC NS N E 1.5 5/6 E 20 N S E [40] \n\n\n\n29 \n\n \n\nJ\u00e1 o termopar \u00e9 um sensor destinado \u00e0 medi\u00e7\u00e3o da temperatura dos gases resultantes \n\nda combust\u00e3o de pellets, apresentando uma gama de funcionamento superior (0\u00baC \n\naos 350\u00baC), al\u00e9m de ser mais robusto e resistente a press\u00f5es mec\u00e2nicas [40]. \n\nConsiste, basicamente, na jun\u00e7\u00e3o de dois metais de caracter\u00edsticas diferentes que, \n\nquando aquecida, gera uma for\u00e7a eletromotriz. A sensibilidade \u00e9 muito baixa \n\n(tipicamente na ordem das dezenas de \u00b5V/K), pelo que os circuitos de \n\nacondicionamento requerem cuidados especiais, pois os sinais na sua sa\u00edda s\u00e3o \n\nnormalmente muito pequenos (na ordem de mV). Por ser do tipo K, significa que os \n\ndois metais em causa correspondem \u00e0s seguintes ligas met\u00e1licas: \n\n? Terminal positivo: N\u00edquel (90%) + Cr\u00f3mio (10%) \n\n? Terminal negativo: N\u00edquel (95%) + Alum\u00ednio (2%) + Mangan\u00e9sio (2%) + S\u00edlica \n\n(1%) [41] \n\n \n\n \n\nFigura 4.4 - Termopar TC K A 3 4 V 10 I N I S/M \n\nUma vez que o facto de se ligar o termopar a um aparelho de medida introduz, pelo \n\nmenos, uma jun\u00e7\u00e3o \u201cfria\u201d no circuito, torna-se indispens\u00e1vel efetuar a sua \n\ncompensa\u00e7\u00e3o. \n\nPara o efeito, utilizou-se mais um sensor de temperatura, neste caso o LM335, um \n\ncircuito integrado que apresenta uma resposta linear na sua gama de temperaturas de \n\nfuncionamento: -40\u00baC a 100\u00baC [42]. Este sensor deve medir a temperatura da placa, \n\nno ponto onde o termopar \u00e9 ligado e deve, por isso, ser instalado num bloco \n\nisot\u00e9rmico. \n\n \n\nFigura 4.5 - LM335 [43] \n\n\n\n30 \n\n \n\nDe forma sistematizada, esta informa\u00e7\u00e3o sobre os tr\u00eas sensores em causa, pode ser \n\nconsultada na Tabela 4.1. \n\n \n\nTipo de \n\nSensor \nFun\u00e7\u00e3o \n\nGama de \n\nTemperaturas \n\nTipo de \n\nresposta \nFabricante Refer\u00eancia \n\nTerm\u00edstor \n\nNTC \n\nMedi\u00e7\u00e3o da \n\nTemperatura do ar \n\nAmbiente/\u00c1gua \n\n-50\u00baC a 120\u00baC N\u00e3o linear Sacet \n\nNS N E 1.5 \n\n5/6 E 20 N \n\nS E \n\nCircuito \n\nintegrado \n\nMedi\u00e7\u00e3o de \n\nTemperatura da \n\nPlaca \n\n-40\u00baC a 100\u00baC Linear \nTexas \n\nInstruments \nLM335 \n\nTermopar \n\ntipo K \n\nMedi\u00e7\u00e3o da \n\ntemperatura dos \n\ngases de escape \n\n0\u00baC a 350\u00baC N\u00e3o linear Sacet \n\nTC K A 3 4 \n\nV 10 I N I \n\nS/M \n\nTabela 4.1 - Caracter\u00edsticas dos sensores utilizados \n\n4.2.2 - ATUADORES \n\nNo que diz respeito aos atuadores, destacam-se quatro: \n\n? Resist\u00eancia de igni\u00e7\u00e3o \n\n? Motor de alimenta\u00e7\u00e3o \n\n? Ventilador ambiente \n\n? Ventilador dos gases de escape \n\nA resist\u00eancia de igni\u00e7\u00e3o (Figura 4.6) \u00e9 uma fonte de aquecimento de material cer\u00e2mico \n\nque funciona atrav\u00e9s da sua liga\u00e7\u00e3o \u00e0 rede el\u00e9trica, 120 V ou 220 V, atingindo muito \n\nrapidamente a temperatura de trabalho, na ordem dos 1000\u00baC. Constitu\u00eddo por um \n\nisolador de Al2O3 e por um condutor de platina integrado, \u00e9 respons\u00e1vel pela queima \n\ndos pellets. A sua resist\u00eancia varia de forma linear com a temperatura e apresenta \n\nvalores t\u00edpicos de 80 ? a 20\u00baC e 75 ? a 0\u00baC [44]. \n\n \n\n \n\nFigura 4.6 - Resist\u00eancia de igni\u00e7\u00e3o (HTH Rohrheizer \u2013 79/11/200) [44] \n\n\n\n31 \n\n \n\nO sistema de alimenta\u00e7\u00e3o (Figura 4.7) consiste num motor el\u00e9trico de indu\u00e7\u00e3o, ligado \n\na um sem fim, ao qual est\u00e1 acoplado um redutor, e tem como fun\u00e7\u00e3o o transporte de \n\npellets desde o dep\u00f3sito onde estes se encontram armazenados at\u00e9 \u00e0 c\u00e2mara de \n\ncombust\u00e3o. Atrav\u00e9s de um parafuso transportador helicoidal que roda sobre um eixo \n\ninserido no motor, os pellets s\u00e3o movimentados e, por a\u00e7\u00e3o da for\u00e7a grav\u00edtica caem na \n\nc\u00e2mara, ao atingirem a sua extremidade. Este motor possui uma velocidade de \n\nrota\u00e7\u00e3o fixa e constante na ordem de duas rota\u00e7\u00f5es por minuto e uma pot\u00eancia \n\nnominal de 55 W. \n\n \n\n \n\nFigura 4.7 - Motor de alimenta\u00e7\u00e3o (BCZ 509) [45] \n\nOs ventiladores s\u00e3o tamb\u00e9m motores el\u00e9tricos de indu\u00e7\u00e3o que possuem acoplado \n\ndiretamente ao veio de um dispositivo de movimenta\u00e7\u00e3o de ar e s\u00e3o utilizados para \n\nrealizar tarefas distintas. O ventilador ambiente (Figura 4.8) [46], destina-se a enviar o \n\ncalor resultante da combust\u00e3o para o meio ambiente interior, movimentando o ar \n\nambiente atrav\u00e9s do recuperador de calor. Por sua vez, o ventilador de extra\u00e7\u00e3o de \n\nfumos, ou ventilador do ar prim\u00e1rio (Figura 4.9) [47], tem como principal fun\u00e7\u00e3o extrair \n\nos gases oriundos da combust\u00e3o para o meio ambiente exterior, atrav\u00e9s do \n\nrecuperador de calor, for\u00e7ando simultaneamente a entrada de ar no queimador que \n\nsuporta os pellets em combust\u00e3o.  \n\n \n\n \n\nFigura 4.8 \u2013 Ventilador AACO ST25 \n\n \n\nFigura 4.9 \u2013 Ventilador AACO VA2 W 50R \n\n \n\n\n\n32 \n\n \n\nA tabela seguinte apresenta as principais carater\u00edsticas dos atuadores mencionados. \n\n \n\nAtuador Refer\u00eancia Pot\u00eancia \nTemperatura \n\nde Trabalho \n\nFluxo \n\nMax. Ar \n\nVelocidade \n\nMax. Rota\u00e7\u00e3o \n\nResist\u00eancia \n\nde Igni\u00e7\u00e3o \n\nHTH \n\nRohrheizer  \n\n79/11/200 \n\n175W 980\u00baC - - \n\nMotor de \n\nAlimenta\u00e7\u00e3o \nBCZ 509 55W - - 2 rpm \n\nVentilador \n\nAmbiente \nAACO ST25 54W -25\u00baC a 75\u00baC \n\n122 \n\nm3/h \n2800 rpm \n\nVentilador de \n\nEscape \n\nAACO VA2 W \n\n50R \n55W -25\u00baC a 150\u00baC \n\n190 \n\nm3/h \n- \n\nTabela 4.2 - Principais caracter\u00edsticas dos atuadores utilizados \n\n4.3 REAL-TIME CLOCK \n\nUma RTC \u00e9 um rel\u00f3gio que armazena e controla a contagem do tempo de forma \n\naut\u00f3noma, em tempo real. Este dispositivo adquire-se, normalmente, na forma de um \n\ncircuito integrado e permite na maioria dos casos a contagem do ano (bissexto ou \n\nn\u00e3o), m\u00eas, dia do m\u00eas, dia da semana, hora (am ou pm), minuto e segundos. A RTC \n\nusada nesta disserta\u00e7\u00e3o tem como refer\u00eancia DS1307 (Figura 4.10), possuindo uma \n\nmem\u00f3ria com capacidade de 64 bytes [48]. Os primeiros 8 bytes s\u00e3o dedicados \u00e0 \n\ngest\u00e3o do rel\u00f3gio, sobrando 56 bytes que est\u00e3o dispon\u00edveis para armazenamento de \n\ninforma\u00e7\u00e3o de forma permanente. \n\nA interface de comunica\u00e7\u00e3o disponibilizada para este circuito integrado \u00e9 Inter \n\nIntegrated Circuit (I2C), cujo protocolo se encontra descrito na sec\u00e7\u00e3o 8.2 dos anexos, \n\nassim como o seu circuito de acondicionamento na Figura 8.2. \n\n \n\n \n\nFigura 4.10 - Real-Time Clock [49] \n\n\n\n33 \n\n \n\n4.4 CIRCUITOS DE ACONDICIONAMENTO DE SINAL \n\nOs sensores considerados, como visto anteriormente, s\u00e3o espec\u00edficos para medi\u00e7\u00e3o \n\nde temperatura. Para cada um \u00e9 atribu\u00edda uma gama em que se pretende efetuar essa \n\nmedi\u00e7\u00e3o. Estas n\u00e3o devem ultrapassar os limites impostos pelos pr\u00f3prios sensores, \n\npara evitar situa\u00e7\u00f5es que comprometam o normal funcionamento da caldeira, \n\nrecuperador de calor, ou queimador. \n\nPosteriormente, o circuito deve ser projetado tendo em conta a resposta de cada um \n\ndos sensores e os requisitos definidos para o sistema. \n\n4.4.1 - SONDA NTC \n\nO circuito de acondicionamento de sinal utilizado para este sensor foi projetado para \n\nse pode medir temperaturas entre os -3\u00baC e os 60\u00baC. Este sensor n\u00e3o linear varia a \n\nresist\u00eancia aos seus terminais em fun\u00e7\u00e3o da temperatura que mede. Projetou-se, \n\nassim, um valor de corrente fixo de polariza\u00e7\u00e3o de 107\u00b5A que o excitasse atrav\u00e9s da \n\nfonte de corrente da Figura 4.11, com um trans\u00edstor BJT PNP, duas resist\u00eancias e um \n\nd\u00edodo zener. \n\n \n\n \n\nFigura 4.11 - Circuito de polariza\u00e7\u00e3o do term\u00edstor NTC \n\nUtilizou-se, ainda, um OPAMP rail-to-rail alimentado a 3.3 V em configura\u00e7\u00e3o de buffer \n\n(Figura 4.12), para evitar que sobretens\u00f5es na sonda danifiquem o microcontrolador. \n\n\n\n34 \n\n \n\n \n\nFigura 4.12 - OPAMP em configura\u00e7\u00e3o de buffer \n\nRecorrendo \u00e0 tabela presente em [50] pode observar-se que a -3\u00baC a sonda apresenta \n\numa resist\u00eancia t\u00edpica aos seus terminais de 31076 ?, enquanto a 60\u00baC, 3021 ?. A \n\ngama de tens\u00e3o considerada \u00e9, por isso, de 2.988 V. Isto permite obter uma resolu\u00e7\u00e3o \n\nentre os 0,04\u00baC para o limite inferior de temperaturas e 0,24\u00baC para o limite superior, o \n\nque excede ligeiramente o requisito de 0,1\u00baC, mas para a aplica\u00e7\u00e3o em quest\u00e3o n\u00e3o \u00e9 \n\ncr\u00edtico. \n\n4.4.2 - LM335 \n\nA gama de temperaturas a medir por este sensor estabeleceu-se situar entre -20\u00baC e \n\n65\u00baC, sendo que a gama m\u00e1xima por ele imposta situa-se entre -40\u00baC e 100\u00baC. \n\nSabendo que este sensor produz na sua sa\u00edda 2.98 volt a 25\u00baC e que a sua resposta \n\nvaria 10 mV/K, conclui-se que na gama de temperatura considerada se obt\u00e9m entre \n\n2.53 V e 3.38 V na sa\u00edda do sensor [42]. Al\u00e9m do valor m\u00e1ximo ser superior a 3.3 V, \n\nque \u00e9 a tens\u00e3o at\u00e9 \u00e0 qual o microcontrolador consegue ler, esta gama (0,85 V) \u00e9 \n\nreduzida e n\u00e3o permite que a resolu\u00e7\u00e3o na leitura da temperatura seja na ordem da \n\nd\u00e9cima do grau. Fazendo uma conta simples: 0,85V / 85\u00baC = 10mV/\u00baC ou \n\n1mV/(\u00baC/10). Como veremos adiante, a resolu\u00e7\u00e3o da ADC n\u00e3o permite ler intervalos \n\nde tens\u00e3o inferiores a 3,2 mV, logo a resolu\u00e7\u00e3o da leitura da temperatura, nestas \n\ncondi\u00e7\u00f5es, n\u00e3o cumpre os requisitos. \n\nTorna-se, por isso, importante utilizar hardware de acondicionamento de sinal para \n\nreduzir o offset e ampliar a gama de tens\u00e3o \u00e0 sa\u00edda do sensor. Utilizou-se um OPAMP \n\nem configura\u00e7\u00e3o diferen\u00e7a (Figura 4.13) tendo como tens\u00e3o de refer\u00eancia um d\u00edodo \n\nzener de 2.4 V, polarizado com uma corrente de 11.2 mA. Admitindo a rela\u00e7\u00e3o de \n\nresist\u00eancias: \n\n \n\n?14\n?9\n\n=\n?16\n?10\n\n \n(4.1) \n\n \n\nObt\u00e9m-se a express\u00e3o geral da tens\u00e3o \u00e0 sa\u00edda deste amplificador: \n\n???0 = (???335 ? ?????? )\n?16\n?14\n\n \n(4.2) \n\n\n\n35 \n\n \n\n \n\nConclui-se que esta tens\u00e3o depende apenas da diferen\u00e7a entre as tens\u00f5es do sensor \n\nde temperatura e do d\u00edodo zener. \n\nImporta frisar que \u201cRB0\u201d corresponde ao nome do pino da entrada anal\u00f3gica do \n\nmicrocontrolador que se encontra ligada \u00e0 sa\u00edda deste amplificador. Para reduzir o \n\nimpacto de algumas varia\u00e7\u00f5es nas tens\u00f5es de alimenta\u00e7\u00e3o, utilizou-se um \n\ncondensador de desacoplamento entre a alimenta\u00e7\u00e3o positiva e a massa. \n\n \n\n \n\nFigura 4.13 - Circuito de acondicionamento de sinal do LM335 \n\n4.4.3 - TERMOPAR \n\nTendo em conta a baixa amplitude do sinal aos terminais deste sensor, na ordem de \n\npoucos mV, \u00e9 necess\u00e1rio amplific\u00e1-lo para poder ser adequadamente lido e \n\ndigitalizado pela ADC. Para tal, utilizou-se o amplificador de instrumenta\u00e7\u00e3o rail-to-rail, \n\nAD623N (Figura 4.14), propositadamente concebido para manipular o ganho atrav\u00e9s \n\nde apenas uma resist\u00eancia, RG. Tendo em conta que se pretende medir temperaturas \n\nentre 0\u00baC e 350\u00baC, projetou-se um ganho de cerca de 180 (express\u00e3o 4.3), que \n\nresultou na escolha da resist\u00eancia R11 de 560?. \n\n \n\n? = 1 +\n105\n\n??\n \n\n(4.3) \n\nUtilizaram-se tamb\u00e9m condensadores de desacoplamento entre as pr\u00f3prias \n\nalimenta\u00e7\u00f5es (3.3 V e massa) para diminuir o efeito de poss\u00edveis pequenas oscila\u00e7\u00f5es \n\n\n\n36 \n\n \n\nque possam ocorrer entre as entradas do amplificador e a massa, e ainda apenas \n\nentre as duas entradas de forma a impedir que pequenas flutua\u00e7\u00f5es afetem o sinal \n\ngerado pelo termopar. \n\nPor \u00faltimo, mas n\u00e3o menos importante, importa referir o filtro passa-baixo colocado \u00e0 \n\nsa\u00edda, constitu\u00eddo pela resist\u00eancia R18 e o condensador C10. O projeto deste filtro teve \n\nem conta o modelo da entrada anal\u00f3gica da ADC (Figura 4.15). Ou seja, a resist\u00eancia \n\nR18 deve ser pequena o suficiente para permitir que a soma com a resist\u00eancia RIC e \n\nRSS permitam o carregamento total da carga do condensador, CHOLD, para um n\u00edvel de \n\ntens\u00e3o de at\u00e9 3.3 V.  \n\n \n\nFigura 4.14 - Circuito de acondicionamento de sinal do termopar \n\n \n\nFigura 4.15 \u2013 Modelo da entrada anal\u00f3gica da ADC do microcontrolador PIC32 \n\nPor outro lado, a frequ\u00eancia de corte do filtro necessita de ser baixa, uma vez que o \n\ntermopar, principalmente em ambientes industriais, funciona como antena captando \n\nsinais de diversas frequ\u00eancias, como por exemplo o da rede dom\u00e9stica (50 Hz). \n\nEscolhida uma frequ\u00eancia de corte baixa e uma resist\u00eancia que tamb\u00e9m n\u00e3o pode ser \n\nmuito alta, o valor do condensador a utilizar ter\u00e1 de ser obrigatoriamente elevado. \n\nEscolheu-se uma resist\u00eancia de 2K2? e um condensador de 100uF cer\u00e2mico, \n\nselecionando uma frequ\u00eancia de corte de cerca de 0,7 Hz. \n\n\n\n37 \n\n \n\n4.4.4 - DETETOR DE PASSAGEM POR ZERO  \n\nNeste circuito (Figura 4.16) \u00e9 utilizado o sinal resultante da retifica\u00e7\u00e3o de onda \n\ncompleta da rede el\u00e9trica para \u201catacar\u201d a base do trans\u00edstor Q2. Este vai estar ao corte, \n\nsempre que a onda estiver pr\u00f3xima de zero, colocando o seu coletor a 3.3 V. No \n\nrestante tempo, em que a amplitude da onda faz com que a base do trans\u00edstor esteja a \n\numa tens\u00e3o superior ao seu VBE, este fica na zona de satura\u00e7\u00e3o. Este processo vai \n\nresultar num sinal com picos de 3.3 V de 10 em 10 milissegundos (Figura 4.17) \n\nrecolhido pelo pino RD11 do microcontrolador, que corresponde a uma entrada de \n\ninterrup\u00e7\u00e3o externa. \n\n \n\nFigura 4.16 - Circuito detetor de passagem por zero da tens\u00e3o da rede el\u00e9trica \n\n \n\nFigura 4.17 \u2013 Gr\u00e1ficos da onda retificada (vermelho) e do sinal \u00e0 sa\u00edda do detetor (verde) \n\n\n\n38 \n\n \n\n4.4.5 - INTERFACE DE POT\u00caNCIA \n\n \n\nFigura 4.18 - Interface de pot\u00eancia \n\nPara a interface de pot\u00eancia usou-se o circuito standard, presente em [51], ao qual foi \n\nadicionado um filtro de EMI (Figura 4.18), adequado para cargas indutivas e \n\ncapacitivas de pot\u00eancia relativamente baixa. \n\nAl\u00e9m de provocar o isolamento entre o sinal el\u00e9trico digital de baixa pot\u00eancia e da rede \n\ndom\u00e9stica, o acoplador \u00f3tico protege o microcontrolador e todos os restantes circuitos \n\nque est\u00e3o para tr\u00e1s. O LED contido no seu interior necessita de uma certa corrente \n\nm\u00ednima para emitir luz e colocar o foto-TRIAC em condu\u00e7\u00e3o. Esta corrente \u00e9 garantida \n\natrav\u00e9s de uma resist\u00eancia e de um trans\u00edstor MOSFET, cuja gate se encontra ligada a \n\num pino de sa\u00edda do microcontrolador. Quando a sa\u00edda estiver ao n\u00edvel l\u00f3gico \u201c0\u201d, o \n\ntrans\u00edstor encontrar-se-\u00e1 cortado e por isso n\u00e3o circula corrente no LED, desligando o \n\nTRIAC. Na situa\u00e7\u00e3o oposta, com a gate do MOSFET a 3.3 V, superior \u00e0 sua tens\u00e3o de \n\nthreshold, VT (0.6 V), este vai encontrar-se saturado e provocar uma corrente \n\nsuficiente no LED que permite colocar o foto-TRIAC em condu\u00e7\u00e3o. Dada a natureza \n\ndas cargas, pode justificar-se a utiliza\u00e7\u00e3o de um snubber (R65 e C28) que suprima \n\ntransientes de tens\u00e3o ou corrente no TRIAC. Por \u00faltimo, para evitar interfer\u00eancia \n\neletromagn\u00e9tica entre diferentes interfaces de pot\u00eancia, optou-se por utilizar o filtro \n\nEMI passa baixo de segunda ordem (C12 e L1). \n\n4.5 MICROCONTROLADOR \n\nA parte central do controlador reside neste dispositivo, que \u00e9 visto como um \n\ncomputador num chip, composto por um microprocessador, mem\u00f3ria e perif\u00e9ricos de \n\nentrada e sa\u00edda. O microcontrolador utilizado foi o PIC32-T795 (Figura 4.19), \n\ndesenvolvido pela OLIMEX para integra\u00e7\u00e3o em sistemas embutidos. \n\n \n\n\n\n39 \n\n \n\n \n\nFigura 4.19 \u2013 Microcontrolador PIC32-T795 \n\nResumidamente, as caracter\u00edsticas deste microcontrolador s\u00e3o, entre outras, as \n\nseguintes: \n\n? Microprocessador PIC32MX795F512H de 32 bits e frequ\u00eancia m\u00e1xima de 80 \n\nMHz; \n\n? Mem\u00f3ria Flash de 512 KB; \n\n? Mem\u00f3ria RAM de 128 KB; \n\n? 3 M\u00f3dulos SPI; \n\n? 4 M\u00f3dulos I2C; \n\n? 2 M\u00f3dulos CAN 2.0B; \n\n? 6 M\u00f3dulos UART; \n\n? 5 Timers; \n\n? 16 Canais para ADC de 10 bits; \n\n? 53 Pinos de entrada/sa\u00edda; \n\n? Conetor USB OTG; \n\n? Conetor UEXT que permite a liga\u00e7\u00e3o a m\u00f3dulos RF, ZIGBEE, GSM, GPS, \n\nentre outros; \n\n? Conetor ICSP que permite a sua programa\u00e7\u00e3o atrav\u00e9s de PIC-Kit ou ICD3 [52] \n\nAs principais raz\u00f5es que justificaram a sua escolha prendem-se com a sua \n\nsimplicidade, possuindo as caracter\u00edsticas necess\u00e1rias, dimens\u00f5es reduzidas, o seu \n\nbaixo custo de aquisi\u00e7\u00e3o e o facto de a ele estar associado software gratuito para a \n\nsua programa\u00e7\u00e3o. \n\n4.6 INTERFACE COM O UTILIZADOR \n\nEm termos esquem\u00e1ticos, a interface com o utilizador pode ser entendida tal como se \n\nencontra representada na Figura 4.20. O LCD \u00e9, naturalmente, o elemento que \n\ndisponibiliza a informa\u00e7\u00e3o de que o utilizador necessita para com ele interagir, seja em \n\ntermos visuais ou por toque. A placa de desenvolvimento, VM800C, serve de \n\n\n\n40 \n\n \n\ninterveniente entre o microcontrolador e o LCD, utilizando as capacidades do \n\nprocessador e controlador gr\u00e1fico FT800. \n\n \n\n \n\nFigura 4.20 - Diagrama de blocos da interface com o utilizador \n\n4.6.1 - LCD \n\nO LCD utilizado \u00e9 do tipo TFT (Figura 4.21), ou seja, utiliza um tipo de trans\u00edstores de \n\npel\u00edcula fina que melhora a qualidade de imagem relativamente a um LCD normal. \n\nPossui uma diagonal de ecr\u00e3 de 3.5 polegadas e uma resolu\u00e7\u00e3o de 320 x 240 pix\u00e9is \n\n(QVGA). O display \u00e9 retro iluminado a LED na parte traseira \u00e0s camadas RGB da tela, \n\npermitindo um menor consumo de energia que pequenas l\u00e2mpadas fluorescentes. \n\nDe modo a facilitar a sua liga\u00e7\u00e3o a dispositivos que controlem o seu funcionamento, \n\neste possui um Flex-Cable de cinquenta e quatro pinos. \n\n \n\nFigura 4.21 \u2013 LCD NHD-3.5-320240MF-ATXL#-1 [53] \n\n\n\n41 \n\n \n\n4.6.2 - M\u00d3DULO VM800C \n\nO m\u00f3dulo de desenvolvimento VM800C estabelece uma interface f\u00e1cil de lidar com \n\naplica\u00e7\u00f5es em sistemas embutidos, criando interfaces homem-m\u00e1quina de alta \n\nqualidade. Neste m\u00f3dulo est\u00e1 contido o FT800, da Future Technology Devices \n\nInternational (FTDI), um processador gr\u00e1fico, cujas principais funcionalidades se \n\ndestacam quanto ao controlo gr\u00e1fico, de \u00e1udio e de toque (resistivo). \n\nDependendo do tipo e tamanho do LCD, existem diferentes vers\u00f5es e configura\u00e7\u00f5es \n\npara esta placa. O VM800C35A (Figura 4.22) fornece um conetor de liga\u00e7\u00e3o entre o \n\nFT800 e um TFT LCD display e 54 pinos para comunica\u00e7\u00e3o com o exterior. Na Tabela \n\n8.6 est\u00e3o descriminados os sinais utilizados em cada um dos cinquenta e quatro pinos \n\ndo conetor. \n\n \n\n \n\nFigura 4.22 \u2013 M\u00f3dulo VM800C35A \n\nO m\u00f3dulo funciona como Slave no que diz respeito \u00e0 comunica\u00e7\u00e3o s\u00e9rie SPI e \n\nnecessita, assim, de um microcontrolador adequado para com ele interagir, ou seja, \n\nque possua esta interface. \u00c9, assim, disponibilizado um conector f\u00eamea de dez pinos, \n\ncujos sinais se encontram descritos na Tabela 4.3. \n\n \n\nN\u00famero do Pino Sinal Significado \n\n1 SCK Entrada de sinal de rel\u00f3gio \n\n2 MOSI Entrada de dados do Slave \n\n3 MISO Sa\u00edda de dados do Slave \n\n4 CS# Entrada de Sele\u00e7\u00e3o do Slave \n\n5 INT# Sa\u00edda de Interrup\u00e7\u00e3o \n\n6 PD# Sinal de ativa\u00e7\u00e3o da retroilumina\u00e7\u00e3o do LCD \n\n7 5V Alimenta\u00e7\u00e3o 1 \n\n8 3.3V Alimenta\u00e7\u00e3o 2 \n\n9 GND Massa \n\n10 GND Massa \n\nTabela 4.3 - Pinos do conetor J5 do VM800C \n\n\n\n42 \n\n \n\nEste m\u00f3dulo apresenta ainda outras caracter\u00edsticas, tais como: \n\n? Driver LED para retroilumina\u00e7\u00e3o; \n\n? Sa\u00edda para \u00e1udio mono; \n\n? Fonte de alimenta\u00e7\u00e3o flex\u00edvel \u2013 USB Micro-B ou conector de dois pinos para \n\n3.3V ou 5V externos; \n\n? Cristal interno de 12MHz com PLL que pode fornecer at\u00e9 36MHz ou 48MHz de \n\nfrequ\u00eancia de rel\u00f3gio. \n\n \n\nOs motivos que pesaram na escolha deste m\u00f3dulo t\u00eam a ver com as suas elevadas \n\ncapacidades gr\u00e1ficas, resolu\u00e7\u00e3o, facilidade de manipula\u00e7\u00e3o, o sensor de toque \n\nintegrado e o seu custo moderado de aquisi\u00e7\u00e3o. \n\n4.7 PCI \n\nA placa de circuito impresso (PCI) desenvolvida (Figura 8.3) possui dimens\u00f5es de 188 \n\nmm por 189 mm e foi desenhada segundo uma estrat\u00e9gia de simplicidade, seguran\u00e7a \n\ne para facilitar o seu debug atrav\u00e9s de aparelhos de medida. Para isso foram seguidas \n\nalgumas regras: \n\n? Preocupa\u00e7\u00e3o de colocar todas as pistas debaixo da placa (1 camada) e os \n\ncomponentes em cima, apesar de em alguns casos ter sido necess\u00e1rio a \n\nutiliza\u00e7\u00e3o de jumpers; \n\n? A interface de pot\u00eancia encontrar-se claramente separada da alimenta\u00e7\u00e3o e de \n\npistas de pequeno sinal; \n\n? Utiliza\u00e7\u00e3o de pistas com largura consider\u00e1vel, assim como pads bem \n\nrevestidos de \u00e1rea cobreada. \n\n \n\nA \u00e1rea respeitante ao ret\u00e2ngulo de linha azul traduz o espa\u00e7o ocupado (por cima dos \n\ncomponentes) pelo LCD e pela estrutura que o suporta. \n\nEsta placa possui 6 sa\u00eddas em TRIAC o que permite controlar at\u00e9 6 atuadores \n\ndiferentes, como por exemplo resist\u00eancias de igni\u00e7\u00e3o, alimentadores de pellets, \n\nextratores de fumos, ventiladores, bombas de \u00e1gua, etc. Relativamente aos sensores \n\nest\u00e3o colocadas 4 entradas, sendo duas delas para termopar, outra para Term\u00edstor \n\nNTC e ainda uma para sensor de chama, que n\u00e3o foi desenvolvida nesta disserta\u00e7\u00e3o. \n\nEsta versatilidade permite que a PCI concebida possa ser utilizada tanto em \n\nrecuperadores de calor, queimadores ou caldeiras.  \n\n\n\n43 \n\n \n\nCap\u00edtulo 5 FIRMWARE E SOFTWARE \n\nNeste cap\u00edtulo ser\u00e1 abordado, em primeiro lugar o Firmware, o qual interage com o \n\nhardware de forma aut\u00f3noma, cumprindo os requisitos estabelecidos. Posteriormente, \n\nser\u00e1 dado foco ao Software, atrav\u00e9s de uma aplica\u00e7\u00e3o PC, a qual tem o objetivo de \n\nser utilizada pelo fabricante do sistema para configura\u00e7\u00e3o de par\u00e2metros, an\u00e1lise do \n\nseu funcionamento e manuten\u00e7\u00e3o. \n\n5.1 FIRMWARE \n\nO firmware foi desenvolvido com o aux\u00edlio das ferramentas MPLAB X IDE e XC32, \n\ndisponibilizadas pela Microchip. Este tem por objetivo realizar variadas a\u00e7\u00f5es, tais \n\ncomo ler dados dos sensores, interagir com dispositivos com diferentes interfaces de \n\ncomunica\u00e7\u00e3o, tomar decis\u00f5es autonomamente, controlar atuadores e processar dados \n\nadequadamente. \n\n5.1.1 - PROCESSO DE CONTROLO \n\nO controlo utilizado para este sistema \u00e9 em malha fechada, uma vez que o sinal de \n\nsa\u00edda, medido pelo sensor de temperatura ambiente \u00e9 utilizado para se combinar com \n\no sinal de refer\u00eancia, ou seja, com o sinal que representa o objetivo a atingir (a \n\ntemperatura desejada), resultando no sinal de erro que excita o controlador. Em \n\nfun\u00e7\u00e3o do sinal de erro, que pode ser maior ou menor consoante a diferen\u00e7a entre as \n\ntemperaturas de refer\u00eancia e ambiente, o controlador aplica um sinal proporcional no \n\nsistema com o objetivo de conduzir o sinal de sa\u00edda at\u00e9 ao valor pretendido [54]. O \n\ncontrolo proporcional est\u00e1 dividido em cinco n\u00edveis de diferentes amplitudes no que diz \n\nrespeito ao grau de queima. O n\u00edvel m\u00e1ximo \u00e9 aplicado quando um grande sinal de \n\nerro \u00e9 gerado, enquanto o n\u00edvel m\u00ednimo corresponde \u00e0 situa\u00e7\u00e3o em o mesmo \u00e9 \n\npequeno. \n\nPara projetar o processo de controlo recorreu-se a uma m\u00e1quina de estados. Esta \n\npode ser entendida como um modelo abstrato de um sistema ou comportamento e \n\nest\u00e1 na maioria dos casos associada a representa\u00e7\u00f5es de sistemas de controlo que \n\nmonitorizam aplica\u00e7\u00f5es. Como o nome indica, esta representa\u00e7\u00e3o envolve um \n\nconjunto de estados e sua interliga\u00e7\u00e3o, por meio de sinais. Estes sinais est\u00e3o \n\nrelacionados com o conhecimento que se tem da aplica\u00e7\u00e3o e permitem a ocorr\u00eancia \n\nde transi\u00e7\u00f5es entre esses estados. Em cada instante, a m\u00e1quina pode somente estar \n\nnum deles, o denominado estado atual [55, 56]. \n\n \n\n\n\n44 \n\n \n\nO sistema de controlo abordado nesta disserta\u00e7\u00e3o possui cinco estados, sendo eles: \n\n? Inativo \n\n? Igni\u00e7\u00e3o \n\n? Queima \n\n? Extin\u00e7\u00e3o \n\n? Observa\u00e7\u00e3o \n\n \n\nCom o objetivo de tornar a escrita do c\u00f3digo de implementa\u00e7\u00e3o de uma m\u00e1quina de \n\nestados mais simples, em linguagem C, assim como uma leitura mais leg\u00edvel da \n\nmesma, existem algumas regras a ter-se em conta e que se encontram \n\nesquematicamente representadas na Figura 5.1: \n\n? Enumera\u00e7\u00e3o dos estados do sistema atrav\u00e9s de MACROS \n\n? Declara\u00e7\u00e3o e inicializa\u00e7\u00e3o da vari\u00e1vel que armazena o estado atual \n\n? Utiliza\u00e7\u00e3o de um \u201cswitch\u201d para sele\u00e7\u00e3o do estado atual \n\n? Separa\u00e7\u00e3o entre a\u00e7\u00f5es associadas ao estado de condi\u00e7\u00f5es de transi\u00e7\u00e3o \n\n \n\n \n\nFigura 5.1 - Estrutura simplificada do c\u00f3digo, em C, para uma m\u00e1quina de estados [57] \n\nPara se perceber melhor o seu funcionamento, na Tabela 5.1 est\u00e1 contida uma \n\ndescri\u00e7\u00e3o individual das a\u00e7\u00f5es tomadas pelo controlador em cada um dos estados. \n\n \n\n \n\n \n\n\n\n45 \n\n \n\n \n\nEstado A\u00e7\u00f5es \n\nInativo \n- Manter os atuadores desligados, a n\u00e3o ser que estejam a ser \n\nexecutados testes de funcionamento dos mesmos. \n\nIgni\u00e7\u00e3o \n\n- \u00c9 iniciado um contador de tempo (em minutos) \n\n- O alimentador de pellets encontra-se inicialmente ligado durante um \n\ncerto intervalo de tempo. Ao fim desse tempo, caso n\u00e3o tenha ocorrido \n\ntransi\u00e7\u00e3o, come\u00e7a a funcionar segundo um duty-cycle baixo; \n\n- A resist\u00eancia de igni\u00e7\u00e3o encontra-se sempre ligada, assim como o \n\nventilador do ar prim\u00e1rio (gases) com uma certa velocidade constante. \n\nQueima \n\n- A resist\u00eancia de igni\u00e7\u00e3o encontra-se desligada; \n\n- Tanto o alimentador de pellets como os ventiladores funcionam \n\nsegundo um n\u00edvel que \u00e9 calculado pela diferen\u00e7a entre as temperaturas \n\ndesejada e ambiente ou entre a temperatura m\u00e1xima permitida para os \n\ngases e o seu valor instant\u00e2neo. A primeira modula\u00e7\u00e3o inicia-se \n\nquando for atingido um erro inferior a 5\u00baC, a segunda quando o erro for \n\ninferior a 30\u00baC. Ambas funcionam de forma conjunta; \n\n- Caso a temperatura dos gases baixe at\u00e9 valores inferiores \u00e0 \n\ntemperatura m\u00ednima de funcionamento da ventoinha ambiente, esta \u00e9 \n\ndesligada, para evitar que o ar arrefe\u00e7a o compartimento. \n\nExtin\u00e7\u00e3o \n\n- \u00c9 iniciado um contador de tempo (em segundos). \n\n- Garante que o alimentador de pellets e a resist\u00eancia de igni\u00e7\u00e3o se \n\nencontram desligados, enquanto os ventiladores funcionam com \n\nvelocidade de rota\u00e7\u00e3o m\u00e1xima para extrair o calor de dentro da c\u00e2mara \n\nde combust\u00e3o o mais depressa poss\u00edvel; \n\n- Caso a temperatura dos gases baixe at\u00e9 valores inferiores \u00e0 \n\ntemperatura m\u00ednima de funcionamento da ventoinha ambiente, esta \u00e9 \n\ndesligada, para evitar que o ar arrefe\u00e7a o compartimento. \n\nObserva\u00e7\u00e3o \n- N\u00e3o toma nenhuma a\u00e7\u00e3o, a n\u00e3o ser verificar as temperaturas \n\nambiente e dos gases de escape. \n\nTabela 5.1 - A\u00e7\u00f5es em fun\u00e7\u00e3o do estado do processo \n\nDe forma mais espec\u00edfica, a Tabela 5.2 indica o estado (ligado ou desligado) de cada \n\natuador em fun\u00e7\u00e3o da fase do processo. \u00c0 primeira vista pode parecer que as fases \n\n\u201cInativa\u201d e de \u201cObserva\u00e7\u00e3o\u201d s\u00e3o iguais, mas de facto isso n\u00e3o \u00e9 verdade. Na primeira, \n\nque corresponde ao estado inicial, o processo de aquecimento ainda n\u00e3o se iniciou, ou \n\n\n\n46 \n\n \n\nj\u00e1 terminou, enquanto em \u201cObserva\u00e7\u00e3o\u201d, o processo encontra-se ativo, nomeadamente \n\ncom a temperatura ambiente desejada atingida e ultrapassada em pelo menos 1\u00baC. \n\n \n\n ATUADOR \n\n \n\n \n\nESTADO \n\nResist\u00eancia \n\nde Igni\u00e7\u00e3o \n\nMotor de \n\nAlimenta\u00e7\u00e3o \n\nVentilador \n\nAmbiente \n\nVentilador \n\ndos Gases de \n\nEscape \n\nInativo OFF OFF OFF OFF \n\nIgni\u00e7\u00e3o ON ON OFF ON \n\nQueima OFF ON ON ou OFF ON \n\nObserva\u00e7\u00e3o OFF OFF OFF OFF \n\nExtin\u00e7\u00e3o OFF OFF ON ou OFF ON \n\nTabela 5.2 - Estado dos atuadores em fun\u00e7\u00e3o do estado do processo \n\nInicialmente, o sistema arranca no estado \u201cInativo\u201d. Assim que \u00e9 solicitado o in\u00edcio do \n\nprocesso, este passa automaticamente para o de \u201cIgni\u00e7\u00e3o\u201d onde os pellets s\u00e3o \n\nincinerados. Deste estado, quatro poss\u00edveis transi\u00e7\u00f5es podem ocorrer: duas delas \n\nd\u00e3o-se caso o utilizador ordene o t\u00e9rmino do processo de aquecimento, ou na situa\u00e7\u00e3o \n\nem que a NTC seja desligada do controlador, obrigando o estado a transitar para \n\n\u201cExtin\u00e7\u00e3o\u201d (em todos os estados, existem estas poss\u00edveis transi\u00e7\u00f5es) Especificamente \n\nnesta fase, caso o tempo decorrido desde o seu arranque ultrapasse os 15 minutos \n\n(representando falta de pellets na c\u00e2mara de combust\u00e3o se todos os atuadores \n\nestiveram a funcionar devidamente), a m\u00e1quina de estado transita igualmente para a \n\nfase de \u201cExtin\u00e7\u00e3o\u201d. Por outro lado, se a temperatura dos gases de escape exceder os \n\n60\u00baC, ent\u00e3o o controlador est\u00e1 preparado para transitar de estado para \u201cQueima\u201d. \n\nImporta referir que ap\u00f3s a transi\u00e7\u00e3o da fase de \u201cExtin\u00e7\u00e3o\u201d para a \u201cInativa\u201d, por \n\nqualquer raz\u00e3o a temperatura no interior da c\u00e2mara de combust\u00e3o pode voltar a \n\nexceder os 50\u00baC, devendo assegurar-se, nesse caso, que se transite de novo para a \n\nfase de \u201cExtin\u00e7\u00e3o\u201d. Esta transi\u00e7\u00e3o \u00e9 ainda assegurada no caso em que ocorra uma \n\nfalha de energia (instant\u00e2nea) e o processo de aquecimento esteja em andamento, j\u00e1 \n\nque a temperatura dos gases de escape se pode encontrar bastante elevada e \n\ninteressa expulsar todo esse calor de dentro do aparelho. Quando tiver sido \n\nrestabelecida a energia ap\u00f3s uma falha mais prolongada, a m\u00e1quina de estados \n\nencontrar-se-\u00e1 na fase \u201cInativa\u201d, sem efetuar qualquer a\u00e7\u00e3o. \n\nDe forma esquematizada, toda a informa\u00e7\u00e3o sobre estas e outras transi\u00e7\u00f5es poss\u00edveis \n\nentre estados est\u00e1 representada graficamente na Figura 5.2. \n\n\n\n47 \n\n \n\nInativo\n\nExtin\u00e7\u00e3o Queima\n\nIgni\u00e7\u00e3o\n\nObserva\u00e7\u00e3o\n\nUtilizador inicia o processo\n\nTemperatura dos gases > 60\u00baC\nE temperatura ambiente\n &lt;temperatura desejada\n\nTemperatura ambiente > \nTemperatura desejada + 1\u00baC\n\nUtilizador desliga o processo\nOU decorridos 15 min sem transitar\n\nOU NTC desligada do controlador\n\nDecorridos 15s\nE temperatura dos gases &lt;50\u00baC\n\nTemperatura do\nAr Prim\u00e1rio > 50\u00baC\n\nTemperatura ambiente \n&lt;(temperatura desejada \u2013 0.5\u00baC)\nE Temperatura dos gases > 60\u00baC\n\nTemperatura ambiente \n&lt;(temperatura desejada \u2013 0.5\u00baC)\nE temperatura dos gases &lt;60\u00baC\n\nUtilizador desliga o processo\n OU temperatura dos gases > 160\u00baC\n\nOU NTC desligada do controlador\n\nUtilizador desliga o processo\n OU temperatura dos gases > 160\u00baC\nOU temperatura dos gases &lt;45\u00baC\nOU NTC desligada do controlador\n\nIn\u00edcio\n\n \n\n \n\nFigura 5.2 - Diagrama de transi\u00e7\u00e3o de estados \n\n5.1.2 - ARMAZENAMENTO E CONCEPTUALIZA\u00c7\u00c3O DOS PAR\u00c2METROS DO SISTEMA \n\nOs 56 bytes de RAM dispon\u00edveis na RTC foram utilizados para armazenar os \n\npar\u00e2metros do sistema, que se encontram mapeados segundo a disposi\u00e7\u00e3o \n\napresentada na Tabela 8.1 (anexo). \n\n\n\n48 \n\n \n\nOs par\u00e2metros do sistema correspondem a vari\u00e1veis com significado para o \n\ncontrolador e que servem de medida fixa de compara\u00e7\u00e3o para o bom funcionamento \n\ndo programa que corre sobre ele. \n\nOs par\u00e2metros encontram-se divididos por categorias: \n\n? Atuadores \n\n? Temperaturas \n\n? Crono termostato \n\n? Coopera\u00e7\u00e3o \n\n? Palavra-passe \n\n? Calibra\u00e7\u00e3o \n\n \n\nOs par\u00e2metros que dizem respeito aos atuadores est\u00e3o diretamente associados ao \n\nprocesso de aquecimento, nomeadamente na fase de trabalho, em que cada um \n\ndeles, exceto a resist\u00eancia de igni\u00e7\u00e3o, possui regula\u00e7\u00e3o at\u00e9 cinco n\u00edveis. O primeiro \n\nn\u00edvel corresponde ao grau de queima mais baixo, enquanto o quinto corresponde ao \n\nmais alto. Relativamente ao alimentador de pellets, cada n\u00edvel corresponde a um certo \n\nintervalo de tempo em que este se encontra ligado, em percentagem, relativamente a \n\num per\u00edodo de funcionamento, em segundos. Importa salientar que na fase de igni\u00e7\u00e3o \n\neste atuador n\u00e3o utiliza nenhum dos cinco n\u00edveis anteriores. Encontra-se inicialmente \n\nligado durante um certo intervalo de tempo, passando posteriormente, a funcionar \n\nsegundo um duty-cycle baixo enquanto a fase de trabalho n\u00e3o for atingida. \n\nNos ventiladores, cada n\u00edvel corresponde a uma certa velocidade de rota\u00e7\u00e3o que \u00e9 \n\ntraduzida numericamente em tens\u00e3o eficaz de 0 a 220 V. \n\nNo que \u00e0s temperaturas diz respeito, destacam-se as do ar prim\u00e1rio, como por \n\nexemplo, a m\u00e1xima permitida, a de transi\u00e7\u00e3o da fase de \u201cIgni\u00e7\u00e3o\u201d ou \u201cObserva\u00e7\u00e3o\u201d \n\npara a fase de \u201cQueima\u201d e da fase de \u201cExtin\u00e7\u00e3o\u201d para a \u201cInativa\u201d. Quanto ao ar \n\nsecund\u00e1rio, ou ambiente, s\u00e3o estabelecidos limites m\u00ednimo e m\u00e1ximo de sele\u00e7\u00e3o da \n\ntemperatura desejada e ainda um par\u00e2metro para armazenamento da \u00faltima escolha \n\ndesta temperatura.  \n\nPara a funcionalidade do Crono termostato interessa guardar as horas e os minutos de \n\nin\u00edcio e fim do processo de aquecimento, assim como da temperatura de refer\u00eancia \n\npara cada programa, num total de tr\u00eas. \n\nAo n\u00edvel da coopera\u00e7\u00e3o entre controladores, cada um deve possuir tr\u00eas par\u00e2metros: o \n\nn\u00famero identificador, que deve ser diferente de todos os outros, a temperatura a que \n\nentra em funcionamento e o seu n\u00edvel de queima. \n\nPara a Palavra-passe est\u00e3o reservados 16 bits, ou seja, poder\u00e1 corresponder a um \n\nvalor num\u00e9rico entre 0 e 65536. \n\n\n\n49 \n\n \n\nOs par\u00e2metros associados \u00e0 calibra\u00e7\u00e3o do sistema dividem-se em tr\u00eas: a temperatura \n\ninicial, final e tempo total, e traduzem algum grau de conhecimento do sistema em que \n\na m\u00e1quina est\u00e1 inserida. \n\nPor \u00faltimo, importa frisar que o n\u00edvel m\u00e1ximo de queima que \u00e9 selecionado pelo \n\nutilizador dever\u00e1 encontrar-se entre os cinco n\u00edveis descritos anteriormente. Por \n\nexemplo, no caso do valor selecionado ser 3, a m\u00e1quina n\u00e3o vai poder funcionar num \n\nn\u00edvel de queima de 4 ou 5. \n\n\u00c0 exce\u00e7\u00e3o dos par\u00e2metros associados ao crono termostato, n\u00edvel m\u00e1ximo de queima e \n\ntemperatura desejada, que o utilizador normal pode gerir, todos os outros apenas \n\npodem ser acedidos e alterados pelo instalador/fabricante. \n\n5.1.3 - CODIFICA\u00c7\u00c3O E DESCODIFICA\u00c7\u00c3O DA DATA E HORA ATUAL \n\nInternamente, os registos internos da RTC est\u00e3o codificados em BCD, tornando-se \n\nnecess\u00e1rias criar rotinas de codifica\u00e7\u00e3o e descodifica\u00e7\u00e3o. \n\nA descodifica\u00e7\u00e3o \u00e9 necess\u00e1ria sempre que se pretenda ler a data e hora da RTC. Em \n\nBCD, os d\u00edgitos que constituem o n\u00famero decimal s\u00e3o codificados pelo peso que \n\nrepresentam. Uma vez que a gama m\u00e1xima que se pode atingir no valor dos registos \n\ntemporais desta RTC \u00e9 de 0 a 99, referente aos dois d\u00edgitos menos significativos do \n\nano (Tabela 5.3), uma poss\u00edvel convers\u00e3o deste c\u00f3digo para decimal ser\u00e1 obter, em \n\nprimeiro lugar, os d\u00edgitos mais e menos significativos (5.1 e 5.2) do n\u00famero BCD e \n\nfinalmente obter o n\u00famero em decimal (5.3). \n\n \n\n \n\nTabela 5.3 - Mapeamento de mem\u00f3ria da RTC [48] \n\n?\u00ed???? ??????? = 4 ???? ???? ?????????????? (???) (5.1) \n\n?\u00ed???? ???????? = 4 ???? ????? ?????????????? (???) (5.2) \n\n?\u00fa???? decimal = D\u00edgito dezenas \u00d7 10 + ?\u00ed???? ???????? (5.3) \n\n \n\n\n\n50 \n\n \n\nA opera\u00e7\u00e3o contr\u00e1ria, a de codifica\u00e7\u00e3o para c\u00f3digo BCD, utilizada na situa\u00e7\u00e3o em que \n\nse pretende fazer a atualiza\u00e7\u00e3o da data e hora envolve igualmente dois passos. \n\nO primeiro consiste em separar o n\u00famero decimal nos d\u00edgitos das dezenas e das \n\nunidades, como na descodifica\u00e7\u00e3o, ainda que n\u00e3o da mesma forma (5.4 e 5.5). O \n\nn\u00famero BCD final \u00e9 calculado em 5.6. \n\n \n\nD\u00edgito dezenas = N\u00famero decimal / 10 (5.4) \n\nD\u00edgito unidades = N\u00famero decimal % 10 (5.5) \n\nN\u00famero decimal = D\u00edgito dezenas \u00d7 16 + D\u00edgito unidades (5.6) \n\n5.1.4 - DEVICE DRIVERS \n\nDevice drivers s\u00e3o rotinas espec\u00edficas do firmware que interagem com componentes \n\nespec\u00edficos do hardware. S\u00e3o respons\u00e1veis pela leitura ou escrita em registos, assim \n\ncomo pela resposta a interrup\u00e7\u00f5es, com a informa\u00e7\u00e3o processada [58]. Dividiram-se \n\nos device drivers em dois tipos: para sensores e atuadores. \n\n \n\nA leitura de um sensor deve ser individual e independente de qualquer outro. \n\nConhecendo o hardware de acondicionamento de sinal e as suas especifica\u00e7\u00f5es \u00e9 \n\nposs\u00edvel realizar alguma manipula\u00e7\u00e3o matem\u00e1tica que traduza a grande f\u00edsica medida \n\nem outra que se pretende observar/medir. \n\nReproduzidos pelos sensores do sistema, os sinais anal\u00f3gicos s\u00e3o lidos atrav\u00e9s de \n\ntr\u00eas (num total de dezasseis) canais de 10 bits da ADC do PIC32. Cada canal pode ler \n\nat\u00e9 210 = 1024 valores diferentes. Uma vez que a gama de varia\u00e7\u00e3o da tens\u00e3o lida \n\nsitua-se entre 0 e 3.3V, isto significa que a resolu\u00e7\u00e3o de leitura \u00e9 \n3.3\n\n1024\n= 3.2mV. \n\nDevido ao erro associado ao processo de medida do sinal, a rotina de leitura de um \n\ncerto canal da ADC, cujo esquema exemplificativo de funcionamento pode ser \n\nconsultado na Figura 5.3, segue um determinado n\u00famero de passos. \n\nEm primeiro lugar s\u00e3o lidas dez amostras e salvaguardadas num array de dez \n\nelementos. Posteriormente \u00e9 realizada uma pequena filtragem, em que s\u00e3o detetados \n\nos valores m\u00e1ximo e m\u00ednimo, que s\u00e3o eliminados. De seguida, \u00e9 feita a m\u00e9dia entre os \n\nrestantes e convertida para tens\u00e3o, em mV, segundo a express\u00e3o 5.7 ou, reduzindo o \n\nn\u00famero de c\u00e1lculos efetuados pelo microcontrolador, express\u00e3o 5.8. \n\n\n\n51 \n\n \n\n \n\nFigura 5.3 - Esquema da rotina de leitura da ADC \n\n \n\nA leitura da temperatura ambiente \u00e9 efetuada tendo em conta a diferen\u00e7a de potencial, \n\nque resulta do produto entre a resist\u00eancia aos terminais da sonda NTC e da corrente \n\nde polariza\u00e7\u00e3o definida, 107\u00b5A (Figura 4.11). Recorrendo \u00e0 tabela existente em [50] \n\nque relaciona a sua resist\u00eancia com a temperatura, tra\u00e7ou-se o Gr\u00e1fico 5.1 com a \n\nevolu\u00e7\u00e3o da temperatura em fun\u00e7\u00e3o da diferen\u00e7a de potencial. Utilizando uma \n\nregress\u00e3o polinomial de ordem cinco, foi poss\u00edvel obter-se uma boa aproxima\u00e7\u00e3o para \n\nesta rela\u00e7\u00e3o (5.9). Previamente a este c\u00e1lculo, a tens\u00e3o lida em mV, deve ser \n\nconvertida em V. \n\n \n\n \n\nGr\u00e1fico 5.1 - Curva de Tens\u00e3o-Temperatura da NTC e regress\u00e3o polinomial de ordem 5 \n\n \n\nSegue-se o procedimento utilizado para a leitura da temperatura dos gases de escape \n\npor parte do termopar tipo K. \n\n-10\n\n0\n\n10\n\n20\n\n30\n\n40\n\n50\n\n60\n\n70\n\n0 1 2 3 4\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nDiferen\u00e7a de potencial (V)\n\nNTC Thermistor\n\n??? = ?????? ?\n3.3 ? 1000\n\n1023\n \n\n(5.7) \n\n??? =?\n??????\n\n0.31\n \n\n(5.8) \n\n????????? = ?1.416?\n5 + 14.822?4 ? 60.777?3 + 125.65?2 ? 147.53? + 95.762 (5.9) \n\n\n\n52 \n\n \n\nDepois de obtido o valor da tens\u00e3o \u00e0 sa\u00edda do amplificador AD623N, \u00e9 necess\u00e1rio \n\ndividi-lo pelo ganho antes de utilizar a express\u00e3o 5.10 [59], cujos coeficientes foram \n\ncalculados tendo em conta a tabela presente em NIST [60].  \n\n \n\n???? = ?0 +\n(? ? ?0) (?1 + (? ? ?0) (?2 + (? ? ?0)(?3 + ?4(? ? ?0))))\n\n1 + (? ? ?0) (?1 + (? ? ?0)(?2 + ?3(? ? ?0)))\n \n\nem que ? corresponde \u00e0 tens\u00e3o aos terminais do sensor (em mV). \n\n(5.10) \n\n\u00c9 importante frisar que o termopar n\u00e3o possui uma resposta linear em toda a gama de \n\ntemperatura. Por essa raz\u00e3o, dividiu-se o c\u00e1lculo da temperatura em dois tro\u00e7os para \n\nevitar descontinuidades e erros grosseiros [61]. Um primeiro dos -100\u00baC aos 100\u00baC e \n\noutro dos 100\u00baC aos 400\u00baC. Para cada um, \u00e9 utilizado um conjunto de coeficientes \n\nassociados a um polin\u00f3mio diferente. No Gr\u00e1fico 5.2 pode ser visualizada a evolu\u00e7\u00e3o \n\nda temperatura calculada, em fun\u00e7\u00e3o da tens\u00e3o aos terminais do sensor, utilizando os \n\ncoeficientes da primeira gama para medir temperaturas at\u00e9 400\u00baC. Nota-se uma \n\ndescontinuidade de cerca de 84\u00baC por volta dos 5mV, al\u00e9m da temperatura final ficar \n\napenas pelos 390\u00baC. Utilizando os coeficientes associados aos dois tro\u00e7os (Gr\u00e1fico \n\n5.3), observam-se melhorias relativamente ao gr\u00e1fico anterior. Comparando os dois \n\nm\u00e9todos, o erro m\u00e1ximo associado \u00e0 medi\u00e7\u00e3o da temperatura utilizando apenas um \n\ntro\u00e7o foi de cerca de 45\u00baC, enquanto utilizando dois tro\u00e7os de 0,02\u00baC. \n\nPor \u00faltimo, dado que a temperatura lida corresponde ao ponto em que o termopar se \n\nliga \u00e0 placa, \u00e9 necess\u00e1rio adicionar a temperatura da jun\u00e7\u00e3o fria, mais concretamente, \n\na temperatura da placa (5.11) \u2013 m\u00e9todo de compensa\u00e7\u00e3o por software. \n\n \n\n?????? ?????? = ???? + ?????? (5.11) \n\n \n\nGr\u00e1fico 5.2 - C\u00e1lculo da temperatura utilizando apenas um tro\u00e7o \n\n170,234\n\n86,151\n\n-200\n\n-100\n\n0\n\n100\n\n200\n\n300\n\n400\n\n500\n\n-5 0 5 10 15 20T\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nDiferen\u00e7a de potencial (mV)\n\nTermopar tipo K \n\n\n\n53 \n\n \n\n \n\nGr\u00e1fico 5.3 - C\u00e1lculo da temperatura utilizando dois tro\u00e7os \n\nTendo como principal objetivo realizar a compensa\u00e7\u00e3o da jun\u00e7\u00e3o fria do termopar, a \n\nleitura da temperatura da placa revela-se um importante aspeto a ter em conta. Para o \n\nefeito, utilizou-se o circuito integrado LM335 e o circuito de acondicionamento de sinal \n\nadequado (Figura 4.13). Uma vez que a gama de varia\u00e7\u00e3o de temperatura \n\nconsiderada situa-se entre -20\u00baC e 65\u00baC e a respetiva gama de tens\u00e3o \u00e0 sa\u00edda do \n\namplificador \u00e9 de 0.429V at\u00e9 aos 3.234V, \u00e9 poss\u00edvel determinar-se uma rela\u00e7\u00e3o linear \n\n(5.12) entre as duas grandezas atrav\u00e9s destes dois pontos. A reta obtida est\u00e1 \n\nrepresentada no Gr\u00e1fico 5.4. \n\n \n\n?????? = 30.303 ? ???? ? 33 (5.12) \n\n \n\n \n\nGr\u00e1fico 5.4 - Temperatura em fun\u00e7\u00e3o da tens\u00e3o de sa\u00edda do MCP6022 \n\n-200\n\n-100\n\n0\n\n100\n\n200\n\n300\n\n400\n\n500\n\n-5 0 5 10 15 20T\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nDiferen\u00e7a de potencial (mV)\n\nTermopar tipo K \n\n-40\n\n-20\n\n0\n\n20\n\n40\n\n60\n\n80\n\n0 1 2 3 4\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nDiferen\u00e7a de potencial (V)\n\nLM335\n\n\n\n54 \n\n \n\nOs quatro atuadores el\u00e9tricos descritos anteriormente possuem especifica\u00e7\u00f5es \n\npr\u00f3prias quanto ao seu modo de funcionamento, apesar da interface de pot\u00eancia ser \n\nigual para todos eles, j\u00e1 que trabalham utilizando a tens\u00e3o da rede (220V). \n\nA resist\u00eancia de igni\u00e7\u00e3o \u00e9 aquela cujo princ\u00edpio de funcionamento \u00e9 mais simples, \n\ntendo em conta a especifica\u00e7\u00e3o da m\u00e1quina de estados do processo de aquecimento. \n\nEsta funciona apenas com controlo ON/OFF, ou seja, aos seus terminais est\u00e1 aplicado \n\n0V ou 220V em qualquer instante. Assim, a sa\u00edda digital do microcontrolador, \n\ndestinada \u00e0 atua\u00e7\u00e3o deste dispositivo, deve ser colocada no valor l\u00f3gico \u201c0\u201d quando se \n\npretende deslig\u00e1-la, ou \u201c1\u201d na opera\u00e7\u00e3o contr\u00e1ria (Figura 4.18). \n\nO motor de alimenta\u00e7\u00e3o possui um princ\u00edpio de funcionamento muito semelhante. \n\nContudo, conforme anteriormente dito, o controlo especificado para este motor precisa \n\nde ter em conta o per\u00edodo de funcionamento e a percentagem desse per\u00edodo em que \n\neste atuador se deve encontrar ligado, n\u00e3o existindo controlo de velocidade de \n\nrota\u00e7\u00e3o. Sempre que \u00e9 dada ordem para se ligar, ativando a respetiva sa\u00edda digital do \n\nmicrocontrolador, a contabiliza\u00e7\u00e3o do tempo \u00e9 reinicializada. Esta contagem \u00e9 \n\nefetuada por um Timer que dispara uma interrup\u00e7\u00e3o a cada 125 milissegundos. \n\nDecorridos oito disparos seguidos, significa que decorreu um segundo e a vari\u00e1vel que \n\nmede o tempo em que este atuador se encontra ligado \u00e9 incrementada. \n\nOs ventiladores ambiente e de escape s\u00e3o controladas de forma id\u00eantica uma \u00e0 outra, \n\nmas diferente dos dois anteriores. Para controlo da velocidade de rota\u00e7\u00e3o de ambas \n\nfoi utilizada a t\u00e9cnica de regula\u00e7\u00e3o do \u00e2ngulo de disparo, o que implica uma \n\nsincroniza\u00e7\u00e3o com a tens\u00e3o da rede el\u00e9trica. Ou seja, \u00e9 necess\u00e1rio o controlador \n\nconhecer os instantes de passagem por zero, para determinar a partir da\u00ed os instantes \n\nde disparo. Essa sincroniza\u00e7\u00e3o \u00e9 estabelecida pelo circuito da Figura 4.16 que utiliza o \n\npino RD11 de entrada do microcontrolador. Sempre que neste pino ocorrer uma \n\ntransi\u00e7\u00e3o ascendente do n\u00edvel l\u00f3gico \u00e9 disparada uma rotina de interrup\u00e7\u00e3o externa. A \n\npartir desse momento, \u00e9 ativado e reinicializado um Timer por cada ventilador, caso \n\nestejam ligadas, que conta o tempo relativamente ao instante de passagem por zero \n\nda rede (Figura 5.4). \n\n \n\n \n\nFigura 5.4 - Fluxograma de sincroniza\u00e7\u00e3o com a tens\u00e3o da rede el\u00e9trica \n\n\n\n55 \n\n \n\nA frequ\u00eancia da onda sinusoidal da rede el\u00e9trica \u00e9 de 50 Hz, o que significa que de 10 \n\nem 10 milissegundos esta atinge o valor zero. Por esta raz\u00e3o, a frequ\u00eancia do Timer \n\ndeve ser de 100 Hz para impedir que a contagem do tempo n\u00e3o ultrapassasse mais do \n\nque uma arcada da onda. \n\nRecorrendo \u00e0 Tabela 5.4, podem observar-se os valores de instantes de disparo \n\nassociados \u00e0 velocidade m\u00e1xima e m\u00ednima de ambas os ventiladores. O facto da \n\nvelocidade m\u00e1xima dos ventiladores s\u00f3 ser conseguida alguns milissegundos ap\u00f3s a \n\npassagem por zero deve-se ao TRIAC ser, de facto, controlado por corrente, havendo \n\num desfasamento entre esta e a tens\u00e3o, devido ao cariz de carga indutiva. \n\n \n\nVentilador \nInstante de disparo \n\nm\u00ednimo \n\nInstante de disparo \n\nm\u00e1ximo \n\nAmbiente 4.1s 6.1s \n\nGases de Escape 3.7s 6.5s \n\nTabela 5.4 - Instantes de disparo relativos aos extremos de velocidade dos ventiladores \n\nSendo utilizados valores de tens\u00e3o para caraterizar cada um dos cinco n\u00edveis, \n\nestabeleceu-se que o valor m\u00ednimo de instante de disparo corresponde a 220V e o \n\nvalor m\u00e1ximo a 0V, o gr\u00e1fico obtido para cada um dos ventiladores (Gr\u00e1fico 5.5 e \n\nGr\u00e1fico 5.6) representa a regress\u00e3o linear realizada sobre estes dois pontos e cujas \n\nrespetivas equa\u00e7\u00f5es se encontram em 5.13 e 5.14.  \n\n \n\n \n\nGr\u00e1fico 5.5 - Rela\u00e7\u00e3o entre o Instante de disparo e a tens\u00e3o aplicada ao VA \n\n? =  ?0.0127? + 6,5139 (5.13) \n\n0,0\n\n1,0\n\n2,0\n\n3,0\n\n4,0\n\n5,0\n\n6,0\n\n7,0\n\n0 50 100 150 200 250\n\nT\ne\n\nm\np\n\no\n (\n\nm\ns\n)\n\nDiferen\u00e7a de Potencial (V)\n\nVentilador Ambiente\n\n\n\n56 \n\n \n\n \n\nGr\u00e1fico 5.6 - Rela\u00e7\u00e3o entre o Instante de disparo e a tens\u00e3o aplicada ao VE \n\n? =  ?0.0092? + 6,1138 (5.14) \n\nSempre que o respetivo timer atingir o valor de instante de disparo, p\u00e1ra o seu pr\u00f3prio \n\nfuncionamento e cria o disparo do TRIAC, ativando a respetiva sa\u00edda do \n\nmicrocontrolador. O disparo \u00e9 conclu\u00eddo, ou seja, a sa\u00edda \u00e9 colocada no valor l\u00f3gico \n\n\u201c0\u201d no programa principal. \n\n5.1.5 - FREQU\u00caNCIA DE AMOSTRAGEM DAS TEMPERATURAS \n\nA taxa da aquisi\u00e7\u00e3o de amostras para a leitura dos tr\u00eas tipos de temperaturas \n\nconsideradas \u00e9 definida atrav\u00e9s de um \u00fanico timer que gera uma RSI a cada 125 \n\nmilissegundos. Dentro da rotina existe uma vari\u00e1vel contadora para cada uma das \n\ntemperaturas. \n\nDevido ao fato da temperatura ambiente ter uma evolu\u00e7\u00e3o relativamente lenta ao \n\nlongo do tempo, cada amostra recebida (de 125 em 125 milissegundos) n\u00e3o \u00e9 \n\nimediatamente utilizada para atualizar a vari\u00e1vel que armazena a temperatura \n\nambiente. Assim sendo, a cada 30 segundos \u00e9 calculada a m\u00e9dia sobre as 30 \n\namostras adquiridas durante esse intervalo de tempo e s\u00f3 a\u00ed \u00e9 que o novo valor \u00e9 \n\namostrado. \n\nRelativamente \u00e0 temperatura dos gases de escape, a sua resposta \u00e9 mais r\u00e1pida que \n\na anterior, notando-se essa diferen\u00e7a principalmente quando a fase do processo de \n\naquecimento \u00e9 a de \u201cIgni\u00e7\u00e3o\u201c e porque o volume de ar \u00e9 inferior (c\u00e2mara de \n\ncombust\u00e3o). Por esta raz\u00e3o, optou-se por utilizar uma frequ\u00eancia de amostragem de \n\numa vez em cada segundo (1 Hz), sendo calculada a m\u00e9dia sobre as 8 amostras \n\nadquiridas durante esse intervalo de tempo. Devido ao facto desta necessitar de \n\n0,0\n\n1,0\n\n2,0\n\n3,0\n\n4,0\n\n5,0\n\n6,0\n\n7,0\n\n0 50 100 150 200 250\n\nT\ne\n\nm\np\n\no\n (\n\nm\ns\n)\n\nDiferen\u00e7a de Potencial (V)\n\nVentilador de Escape\n\n\n\n57 \n\n \n\ncompensa\u00e7\u00e3o da jun\u00e7\u00e3o fria, a frequ\u00eancia de amostragem da temperatura da placa \n\ndeve estar sincronizada com a anterior. Esta informa\u00e7\u00e3o foi recolhida pela Tabela 5.5. \n\n \n\nTemperatura Frequ\u00eancia de amostragem \n\nAmbiente \n1\n\n30\n Hz \n\nGases de Escape 1 Hz \n\nPlaca 1 Hz \n\nTabela 5.5 - Frequ\u00eancias de Amostragem de cada tipo de temperatura \n\n5.1.6 - CRIA\u00c7\u00c3O DE PRIMITIVAS GR\u00c1FICAS E \u201cWIDGETS\u201d \n\nNo que se refere aos elementos gr\u00e1ficos poss\u00edveis de ser reproduzidos no ecr\u00e3 do \n\nLCD, consideram-se dois tipos: os mais simples, as primitivas gr\u00e1ficas e os mais \n\ncomplexos que podem ser criados com combina\u00e7\u00f5es dos primeiros, os \u201cwidgets\u201d. \n\nEntenda-se como primitiva gr\u00e1fica qualquer elemento poss\u00edvel de ser suportado pela \n\nlista de displays do LCD sem o aux\u00edlio de outro, como por exemplo: pontos, linhas, \n\nret\u00e2ngulos, ou mapa de bits. A partir destes podem criar-se carateres individuais, \n\ntexto, n\u00fameros, bot\u00f5es, rel\u00f3gios anal\u00f3gicos e digitais, veloc\u00edmetros, barras de \n\nprogresso, barras deslizantes para controlo de volume, barras de sele\u00e7\u00e3o, gradientes \n\nde cor, etc. \n\nPor exemplo, para se criar um bot\u00e3o basta invocar o comando CMD_BUTTON e \n\nespecificar os seus par\u00e2metros de entrada: coordenadas horizontal e vertical do canto \n\nsuperior esquerdo (\u201cx\u201d e \u201cy\u201d) do bot\u00e3o, em pix\u00e9is, o tamanho dos caracteres de texto a \n\nmostrar (\u201cfont\u201d), op\u00e7\u00f5es de alinhamento do texto, com ou sem 3D, entre outros \n\n(\u201coptions\u201d) e, por \u00faltimo, o texto propriamente dito a introduzir na \u00e1rea delimitada pelo \n\nbot\u00e3o (\u201cs\u201d). Este e outros \u201cwidgets\u201d podem ser acedidos atrav\u00e9s da biblioteca de \n\nsuporte de elementos gr\u00e1ficos compat\u00edvel com o FT800. \n\n5.1.7 - CRIA\u00c7\u00c3O DE UM ECR\u00c3 \n\nUm ecr\u00e3 representa o resultado da conjuga\u00e7\u00e3o de um ou v\u00e1rios objetos gr\u00e1ficos \n\nvis\u00edveis. Para se criar um ecr\u00e3 \u00e9 necess\u00e1rio respeitar uma sequ\u00eancia l\u00f3gica de \n\ncomandos a enviar ao motor gr\u00e1fico: \n\n1 - In\u00edcio um novo ecr\u00e3 (cmd(CMD_DLSTART)) \n\n2 - Defini\u00e7\u00e3o da cor de fundo (cmd(CLEAR_COLOR_RGB(R, G, B)) \n\n3 \u2013 Limpeza de ecr\u00e3 (cmd(CLEAR(1, 1, 1))) \n\n4 - Constru\u00e7\u00e3o do(s) objeto(s) gr\u00e1fico(s) \n\n\n\n58 \n\n \n\n5 - Sinaliza\u00e7\u00e3o do fim da cria\u00e7\u00e3o do ecr\u00e3 (cmd(DISPLAY())) \n\n6 - Ativa\u00e7\u00e3o do novo ecr\u00e3 na \u00e1rea de display (cmd(CMD_SWAP)) \n\n \n\nNo caso de um destes passos ser ignorado, excetuando o quarto, o ecr\u00e3 n\u00e3o se torna \n\nvis\u00edvel. \n\n5.1.8 - TOUCH \n\nAtrav\u00e9s da funcionalidade de Touch no LCD, torna-se mais f\u00e1cil a intera\u00e7\u00e3o com o \n\nutilizador atrav\u00e9s de um simples toque na \u00e1rea correspondente ao objeto gr\u00e1fico \n\n(bot\u00e3o, ret\u00e2ngulo, c\u00edrculo, etc.) criado com essa funcionalidade. \n\nPara criar um objeto gr\u00e1fico que reproduza um sinal sempre que tocado utiliza-se um \n\ncomando j\u00e1 pr\u00e9-programado na mem\u00f3ria de armazenamento de comandos gr\u00e1ficos do \n\nVM800C: CMD_TRACK. Sequencialmente s\u00e3o descritos abaixo os passos \n\nnecess\u00e1rios para acrescentar esta funcionalidade a um certo objeto gr\u00e1fico: \n\n1 \u2013 Defini\u00e7\u00e3o de um n\u00famero identificador para o elemento ao qual se pretende \n\nintroduzir a funcionalidade de toque - TAG. \n\n2 - Cria\u00e7\u00e3o do elemento gr\u00e1fico e escolha o tipo de monitoriza\u00e7\u00e3o de toque a \n\nintroduzir. Existem dois: linear ou rotativo \n\n3 \u2013 Utiliza\u00e7\u00e3o do comando CMD_TRACK para estabelecer a funcionalidade de \n\ntoque ao elemento criado. \n\n? Monitoriza\u00e7\u00e3o de toque Linear \u2013 \u00e9 necess\u00e1rio especificar as \n\ncoordenadas horizontais (\u201cx\u201d) e verticais (\u201cy\u201d), em pix\u00e9is, do canto superior \n\nesquerda do elemento, o seu comprimento (\u201cw\u201d) e altura (\u201ch\u201d) e por fim \n\nintroduzir a TAG anteriormente definida. \n\n? Monitoriza\u00e7\u00e3o de toque Rotativo \u2013 \u00e9 necess\u00e1rio especificar as \n\ncoordenadas horizontais (\u201cx\u201d) e verticais (\u201cy\u201d), em pix\u00e9is, do centro do \n\nelemento, o valor \u201c1\u201d nos campos \u201cw\u201d e \u201ch\u201d e por fim introduzir a TAG \n\nanteriormente definida. \n\n \n\nA partir deste momento o elemento gr\u00e1fico monitorizado responde ao toque com o \n\nvalor da TAG atribu\u00edda. Este valor pode ser lido nos 8 bits menos significativos do \n\nregisto REG_TOUCH_TAG da categoria de registos do mecanismo gr\u00e1fico do FT800. \n\n5.1.9 - GEST\u00c3O DE ECR\u00c3S \n\nA forma como os ecr\u00e3s interagem uns com os outros e se sincronizam com todos os \n\nprocessos que se encontram a executar em simult\u00e2neo ser\u00e1 descrita de seguida. \n\n\n\n59 \n\n \n\nNo total foram elaborados vinte e dois ecr\u00e3s que transitam entre si por meio de bot\u00f5es, \n\nret\u00e2ngulos, imagens ou outros elementos gr\u00e1ficos. \n\nA unidade central de processamento necessita de saber, em primeiro lugar, o ecr\u00e3 \n\nativo a cada instante e, posteriormente, em qual dos elementos gr\u00e1ficos o utilizador \n\ntoca para a transi\u00e7\u00e3o se dar de forma correta. Em certas situa\u00e7\u00f5es pode ser ainda \n\nnecess\u00e1rio conhecer o ecr\u00e3 que foi ativado imediatamente antes do atual. Na Figura \n\n5.5 encontra-se graficamente toda a gest\u00e3o de ecr\u00e3s e respetivas transi\u00e7\u00f5es. \n\nO primeiro ecr\u00e3 (Figura 8.4) \u00e9 lan\u00e7ado automaticamente assim que o controlador \u00e9 \n\ninicializado. Todos os outros v\u00e3o sendo colocados ativamente no LCD atrav\u00e9s de \n\ndeterminadas combina\u00e7\u00f5es de toques nos elementos gr\u00e1ficos certos. \n\nPara a gest\u00e3o de todos os ecr\u00e3s criou-se uma rotina que l\u00ea continuamente o valor da \n\nTAG, cujo objeto gr\u00e1fico esteja a ser tocado pelo utilizador. Sempre que um novo ecr\u00e3 \n\nseja mostrado no LCD, por ter sido despoletada essa a\u00e7\u00e3o, atrav\u00e9s de um toque num \n\nbot\u00e3o, por exemplo, o controlador ter\u00e1 conhecimento desse acontecimento e guardar\u00e1 \n\nessa informa\u00e7\u00e3o. O valor da TAG poder\u00e1 ir de 0 a 255, ou seja, \u00e0 partida seria \n\nposs\u00edvel ter-se 256 objetos gr\u00e1ficos diferentes com funcionalidade de toque no mesmo \n\necr\u00e3. Contudo, h\u00e1 que considerar o caso em que nenhum elemento esteja a ser \n\ntocado. Para essa situa\u00e7\u00e3o foram definidos os valores da TAG, por predefini\u00e7\u00e3o, de 0 \n\nou 255. Nenhuma a\u00e7\u00e3o \u00e9 despoletada nesses casos e, portanto, s\u00e3o poss\u00edveis de \n\nmonitorizar 254 objetos gr\u00e1ficos num mesmo ecr\u00e3. \n\nA t\u00edtulo de exemplo podem-se considerar os tr\u00eas primeiros ecr\u00e3s, correspondentes \u00e0s \n\nFiguras 8.4, 8.5 e 8.6. Facilmente se percebe que o ecr\u00e3 de \u201cProcesso ativo\u201d resulta \n\ndo toque no bot\u00e3o \u201cSTART\u201d do ecr\u00e3 de \u201cProcesso inativo\u201d e vice-versa caso o bot\u00e3o \n\n\u201cSTOP\u201d seja tocado no ecr\u00e3 de \u201cProcesso ativo\u201d. De ambos os ecr\u00e3s se podem seguir \n\ntodos os outros, como por exemplo de amostragem de temperaturas, altera\u00e7\u00e3o de \n\npar\u00e2metros do sistema, etc. O terceiro ecr\u00e3 aqui considerado pode ser acedido a partir \n\nde qualquer um dos dois primeiros atrav\u00e9s do toque na imagem com o s\u00edmbolo de \n\numa chama. Nele, o valor do n\u00edvel m\u00e1ximo de queima do processo pode ser ajustado \n\ndesde 1 at\u00e9 5 atrav\u00e9s dos bot\u00f5es \u201c+\u201d e \u201c-\u201c, sendo que a cada nova altera\u00e7\u00e3o \u00e9 \n\ninvocado o mesmo ecr\u00e3 com o resultado dessa modifica\u00e7\u00e3o e o novo valor \u00e9 guardado \n\nna mem\u00f3ria do controlador. Para que se consiga voltar a um dos ecr\u00e3s iniciais, basta \n\napenas que o bot\u00e3o \u201cBack\u201d seja premido. \n\nExistem tamb\u00e9m alguns casos em que a transi\u00e7\u00e3o de um ecr\u00e3 para outro se d\u00e1 sem o \n\naux\u00edlio de qualquer toque. Um exemplo disso pode ser observado quando o processo \n\nde aquecimento se encontra na parte terminal da fase de \u201cExtin\u00e7\u00e3o\u201d (ap\u00f3s um \u201cSTOP\u201d \n\nou excesso de temperatura dos gases, por exemplo). Assim que a temperatura de \n\ntransi\u00e7\u00e3o para a fase \u201cInativa\u201d for atingida, o processo \u00e9 desligado e o LCD \n\n\n\n60 \n\n \n\nacompanha essa mudan\u00e7a colocando imediatamente ativo o ecr\u00e3 de processo inativo \n\n(Figura 8.4). \n\n \n\nSele\u00e7\u00e3o de \nn\u00edvel m\u00e1ximo \n\nde queima\n\nMenu de \nTemperaturas\n\nMenu de \nRel\u00f3gio\n\nInser\u00e7\u00e3o de \nPalavra-Passe\n\nProcesso \nInativo\n\nProcesso Ativo\n\n\u201cSTART\u201d\u201cSTOP\u201d\n\n\u201cBack\u201d\n\n\u201cBack\u201d\n\n\u201cBack\u201d\n\n\u201cBack\u201d \u201cBack\u201d\n\n\u201cBack\u201d\n\nAtualiza\u00e7\u00e3o da \ndata e hora \n\nactuais\n\nPrograma\u00e7\u00e3o \ndo Crono-\n\ntermostato\n\nMenu de \nPar\u00e2metros\n\nTeste aos \nActuadores\n\n\u201cAlterar\nhora e data\n\natual\u201d\n\n\u201cBack\u201d\n\n    \n\n    \n\n\u201cProg.\nCrono\u201d \u201cBack\u201d\n\nMenu de \nBloqueio de \n\nTeclado\n\nMenu de \nPrograma\u00e7\u00e3o\n\n\u201cProgramar\nPar\u00e2metros\u201d\n\n\u201cBloquear\nTeclado\u201d\n\nConfig. \nTemperaturas\n\nConfig. VEConfig. VAConfig. MA\n\n\u201cBack\u201d\n  \n\n\u201cMotor de\nAlimenta\u00e7\u00e3o\u201d\n\n\u201cVentilador\nAmbiente\u201d\n\n\u201cVentilador de\nEscape\u201d\n\n\u201cTemperaturas\u201d\n\u201cBack\u201d\n\n\u201cBack\u201d\n\u201cBack\u201d\n\n\u201cBack\u201d\n\nSele\u00e7\u00e3o de \nTemperatura \n\nDesejada\n\nMostrador de \nTemperaturas\n\n\u201cMostrar\nTemperaturas\u201d\n\n\u201cBack\u201d\n\n\u201cBack\u201d\n\n\u201cAlterar Temp.\nDesejada\n\nTeclado virtual\n\n\u201cInserir valor\u201d\n\n\u201cBack\u201d\n\u201cOK\u201d\n\n\u201cInserir valor\u201d \u201cInserir valor\u201d\n\n\u201cInserir valor\u201d\n\n\u201cBack\u201d\n\n\u201cOK\u201d\n\n\u201cBack\u201d\n\u201cOK\u201d\n\nIn\u00edcio\n\nPalavra-Passe\ncorreta\n\nCalibra\u00e7\u00e3o do \nSistema\n\n\u201cBack\u201d\n\n\u201cCalibrar\u201d\n\n\u201cBack\u201d\n\u201cTestar\n\nAtuadores\u201d\n\n\u201cBack\u201d\n\n\u201cBack\u201d\n\nPredi\u00e7\u00e3o\n\n\u201cPreditor\u201d\n\n\u201cBack\u201d\n\n\u201cBack\u201d\n\nInser\u00e7\u00e3o de \nnova Palavra-\n\nPasse\n\n\u201cBack\u201d/\n\u201cOK\u201d\n\n\u201c***\u201d\n\n \n\nFigura 5.5 - Diagrama de transi\u00e7\u00e3o entre ecr\u00e3s \n\n\n\n61 \n\n \n\n5.1.10 - PROGRAMA\u00c7\u00c3O DA INTERFACE COM O LCD \n\nCom base em crit\u00e9rios de simplicidade de an\u00e1lise, compreens\u00e3o e legibilidade do \n\nc\u00f3digo, a estrutura de programa\u00e7\u00e3o utilizada assenta em tr\u00eas camadas l\u00f3gicas \n\nprincipais (Figura 5.6): \n\n? Camada 1 (Comunica\u00e7\u00e3o SPI) \n\n? Camada 2 (Gest\u00e3o gr\u00e1fica e de \u00e1udio) \n\n? Camada 3 (Ecr\u00e3s ou aplica\u00e7\u00f5es) \n\n \n\n \n\nFigura 5.6 - Camadas l\u00f3gicas para interface com o FT800 \n\nA primeira camada situa-se entre os mecanismos de gest\u00e3o gr\u00e1fica e o hardware \n\npropriamente dito. Preferiu-se usar SPI, cuja descri\u00e7\u00e3o do protocolo se encontra no \n\nanexo 8.3, em detrimento de I2C pela maior simplicidade de implementa\u00e7\u00e3o. Nesta \n\ncamada est\u00e3o criadas todas as rotinas de acesso ao barramento: leitura e escrita de \n\npalavras com diferentes comprimentos (8, 16 e 32 bits). Na escrita, entenda-se ainda \n\num comando como um conjunto de palavras de comprimento n\u00e3o necessariamente \n\nigual e que concretizam um determinado elemento ou funcionalidade gr\u00e1fica. Na \n\ncamada de gest\u00e3o gr\u00e1fica e de \u00e1udio est\u00e3o presentes todas as rotinas respons\u00e1veis \n\npela transfer\u00eancia adequada de dados para o buffer de comandos gr\u00e1ficos (Figura \n\n5.7). Este buffer com a capacidade para 4K bytes de armazenamento est\u00e1 contido na \n\nmem\u00f3ria do FT800 e funciona segundo um mecanismo em anel, reencaminhando os \n\ndados para o motor gr\u00e1fico. O endere\u00e7o inicial onde est\u00e1 contido \u00e9 identificado pela \n\nmacro RAM_CMD, cujo endere\u00e7o corresponde a 10800h. Quando vazio, os registos \n\nREG_CMD_WRITE e REG_CMD_REG s\u00e3o iguais, ou seja, apontam para o mesmo \n\nendere\u00e7o de mem\u00f3ria. \u00c0 medida que comandos/palavras s\u00e3o nele depositados, o \n\n\n\n62 \n\n \n\nvalor de REG_CMD_WRITE vai sendo incrementado. Quando o motor gr\u00e1fico detetar \n\numa determinada diferen\u00e7a entre ambos os endere\u00e7os, associados ao objeto gr\u00e1fico \n\n(bot\u00e3o, por exemplo), processa os dados e ambos os ponteiros voltam a apontar para \n\no mesmo local. Sempre que forem depositados comandos no buffer, deve ser \n\nverificado previamente o espa\u00e7o livre dispon\u00edvel para que caso n\u00e3o haja, a opera\u00e7\u00e3o \n\nn\u00e3o ser permitida. Nesta camada j\u00e1 \u00e9 poss\u00edvel constru\u00edrem-se objetos gr\u00e1ficos mas \n\nainda n\u00e3o poder\u00e3o ser visualizados no ecr\u00e3. \n\n \n\n \n\nFigura 5.7 - Buffer de comandos gr\u00e1ficos \n\nNa terceira camada, a de mais alto n\u00edvel, o programador constr\u00f3i o ecr\u00e3 gr\u00e1fico \n\npreocupando-se apenas com os elementos (criados na camada anterior) que nele \n\npretende adicionar (bot\u00f5es, palavras, imagens, etc) e/ou fazer a gest\u00e3o de v\u00e1rios \n\necr\u00e3s (aplica\u00e7\u00e3o). \n\n5.1.11 - PROGRAMA\u00c7\u00c3O DO CRONO TERMOSTATO \n\nForam criados tr\u00eas programas hor\u00e1rios diferentes que podem ser livremente \n\nmanipulados pelo utilizador. Contudo, existem algumas considera\u00e7\u00f5es a ter em conta, \n\ncomo por exemplo o fato do controlador dever impedir que a hora de in\u00edcio do \n\nprocesso seja posterior \u00e0 de fim, notificando e obrigando o utilizador a alterar uma \n\ndelas. No caso em que um programa esteja agendado e tenha sido solicitada a sua \n\naltera\u00e7\u00e3o, para outro, o utilizador deve ser confrontado com uma mensagem de \n\nconfirma\u00e7\u00e3o desse desejo. Se, por algum motivo, o processo de aquecimento estiver \n\nem andamento no instante em que o programa agendado for iniciado, esta solicita\u00e7\u00e3o \n\nfica sem efeito. O ecr\u00e3 criado para programa\u00e7\u00e3o do crono termostato no LCD (Figura \n\n8.12) possui: \n\n\n\n63 \n\n \n\n? Dois bot\u00f5es, que correspondem a setas, para navega\u00e7\u00e3o entre os tr\u00eas \n\nprogramas; \n\n? Quatro bot\u00f5es para sele\u00e7\u00e3o da hora e do minuto de in\u00edcio e fim do processo de \n\naquecimento; \n\n? Dois bot\u00f5es para sele\u00e7\u00e3o da temperatura ambiente desejada. \n\n5.1.12 - CALIBRA\u00c7\u00c3O \n\nPara se poder usufruir da funcionalidade de predi\u00e7\u00e3o, \u00e9 necess\u00e1rio previamente obter-\n\nse algum conhecimento do sistema em que a m\u00e1quina se encontra instalada. Esta \n\na\u00e7\u00e3o de identifica\u00e7\u00e3o de sistema foi denominada de calibra\u00e7\u00e3o. \n\nPara ser dado o seu in\u00edcio, o programador define um setpoint de temperatura, que \n\ndeve ser atingido no processo de aquecimento e clica no bot\u00e3o \u201cOK\u201d do respetivo ecr\u00e3 \n\n(Figura 8.24). Quando a temperatura atingir o setpoint, \u00e9 contabilizado o intervalo de \n\ntempo a partir do qual a temperatura ambiente excedeu meio grau relativamente \u00e0 \n\ntemperatura inicial at\u00e9 esse momento. Ao mesmo tempo \u00e9 armazenado esse valor na \n\nmem\u00f3ria do controlador e mostrado no ecr\u00e3, assim como as temperaturas inicial e \n\nfinal. \n\n5.1.13 - PREDI\u00c7\u00c3O \n\nConhecidas as temperaturas ambiente inicial e final, assim como o tempo \u00fatil \n\ndecorrido da calibra\u00e7\u00e3o, \u00e9 poss\u00edvel calcular o tempo necess\u00e1rio ligar previamente o \n\ncontrolador antes da hora programada.  \n\nDada a evolu\u00e7\u00e3o da temperatura do compartimento em fun\u00e7\u00e3o do fluxo de ar quente \n\nenviado pelo recuperador de calor, o sistema pode ser aproximado por um modelo de \n\nprimeira ordem, com tempo morto, como representado na Figura 5.8, em termos \n\nideais. O modelo \u00e9 simplista por v\u00e1rias condicionantes como a aus\u00eancia de sensores \n\nde temperatura no exterior do compartimento, as varia\u00e7\u00f5es do sistema provocadas \n\npela abertura e fecho de portas e janelas e a presen\u00e7a ou aus\u00eancia de pessoas no seu \n\ninterior. A utiliza\u00e7\u00e3o de um modelo mais complexo n\u00e3o traria grandes vantagens nesta \n\nfase de desenvolvimento, j\u00e1 que a precis\u00e3o desta funcionalidade n\u00e3o \u00e9 um fator \n\ndecisivo e seria necess\u00e1rio um gasto de tempo elevado na sua conce\u00e7\u00e3o. \n\nSabendo a temperatura inicial e final e ainda o tempo decorrido da calibra\u00e7\u00e3o, \u00e9 \n\nposs\u00edvel encontrar-se uma aproxima\u00e7\u00e3o linear, que relacione a diferen\u00e7a entre a \n\ntemperatura desejada e a temperatura ambiente com o tempo necess\u00e1rio ligar antes \n\nda hora programada (5.15). \n\nA unidade de tempo aqui considerada \u00e9 o minuto. \n\n\n\n64 \n\n \n\n \n\nFigura 5.8 - Evolu\u00e7\u00e3o ideal da temperatura ambiente durante a calibra\u00e7\u00e3o \n\n????? ??\u00e9??? =\n???\n\n??????? ? ????????? ? 0,5\n? (????????? ? ???? ) + ????? ????? \n\n(5.15) \n\n \n\nDepois de calculado o tempo necess\u00e1rio ligar o processo de aquecimento antes da \n\nhora programada, este deve ser-lhe descontado. \n\nUma vez que a hora programada vem expressa em horas e minutos, deve ser \n\nrealizada uma pr\u00e9-convers\u00e3o (5.16 e 5.17) do tempo calculado em 5.15, visto este se \n\nencontrar somente em minutos. Posteriormente deve ser calculada a hora (hh) e o \n\nminuto (mm) de in\u00edcio do processo de aquecimento. No caso da hora calculada em \n\n(5.16) ser inferior \u00e0 programada, a hora a ligar \u00e9 obtida pela diferen\u00e7a entre ambas \n\n(5.18), enquanto na situa\u00e7\u00e3o contr\u00e1ria deve ser descontada essa diferen\u00e7a, em \n\nm\u00f3dulo, relativamente \u00e0s 24 horas (5.20). No caso dos minutos calculados em 5.17 \n\nserem inferiores ao programado, o minuto a ligar \u00e9 calculado igualmente pela sua \n\ndiferen\u00e7a (5.19), enquanto se forem superiores deve ser descontada a diferen\u00e7a, em \n\nm\u00f3dulo, sobre 60 minutos (5.21) e ainda decrementada a hora de uma unidade. \n\n \n\nHoras a descontar (hh) =\nTempo calculado\n\n60\n (parte inteira) (5.16) \n\nMinutos a descontar (mm) = Tempo calculado % Horas a descontar (5.17) \n\nHora a ligar = Hora programada ? Horas a descontar (5.18) \n\nMinuto a ligar = Minuto programado ? Minutos a descontar (5.19) \n\nHora a ligar = 24 ? |Hora programada ?  Horas a descontar| (5.20) \n\nMinuto a ligar = 60 ? |Minuto programado ? Minutos a descontar| (5.21) \n\n \n\n\n\n65 \n\n \n\nO ecr\u00e3 criado para o preditor no LCD (Figura 8.13) possui: \n\n? Quatro bot\u00f5es para sele\u00e7\u00e3o da hora e minuto a que o utilizador pretende ter a \n\ncasa aquecida; \n\n? Dois bot\u00f5es para sele\u00e7\u00e3o da temperatura ambiente desejada. \n\n5.1.14 - COMUNICA\u00c7\u00c3O GATEWAY-CONTROLADORES \n\n \n\nFigura 5.9 - Esquema de liga\u00e7\u00e3o PC-gateway-controladores \n\nComo referido anteriormente, a funcionalidade de coopera\u00e7\u00e3o de controladores requer \n\nque v\u00e1rias caldeiras desempenhem a\u00e7\u00f5es de forma aut\u00f3noma para um fim comum \u2013 o \n\naquecimento de \u00e1guas sanit\u00e1rias. O protocolo de comunica\u00e7\u00e3o utilizado (CAN 2.0B), \n\ntem como base a utiliza\u00e7\u00e3o de mensagens e encontra-se descrito no anexo 8.3. \n\nCada um dos controladores envia uma mensagem de 2 em 2 segundos com o valor \n\ndos seus tr\u00eas par\u00e2metros (identificador, temperatura e n\u00edvel de queima). No formato da \n\nmensagem est\u00e3o reservados 8 bytes destinados para o campo de dados, dos quais \n\napenas os tr\u00eas primeiros se encontram preenchidos (Figura 5.10). Importa ainda frisar \n\nque o n\u00famero identificador do destinat\u00e1rio da mensagem, que neste caso ser\u00e1 o \n\ngateway, deve obrigatoriamente ser enviado na mesma trama, para poder ser \n\nefetivamente recebida apenas por ele. Definiu-se que os valores 0 ou 255 apenas \n\npodem ser associados a ele, sendo os restantes v\u00e1lidos para os controladores. \n\n \n\nID Temperatura\nN\u00edvel de \nQueima\n\nByte 0 Byte 1 Byte 2 Byte 3 Byte 4 Byte 5 Byte 6 Byte 7  \n\nFigura 5.10 \u2013 Campo de dados da trama enviada por cada controlador \n\nPara rece\u00e7\u00e3o da mensagem, o gateway reserva tr\u00eas arrays de dez elementos, para \n\narmazenar os par\u00e2metros de cada controlador. Sempre que receber uma mensagem, \n\n\n\n66 \n\n \n\nverifica se o identificador \u00e9 v\u00e1lido (0 ou 255) e se corresponde a num novo \n\nidentificador, ou seja, que n\u00e3o exista no array respetivo. Nesse caso, insere-o na lista \n\ne ordena-a, colocando os restantes dois par\u00e2metros no mesmo lugar nos respetivos \n\narrays. Finalmente, \u00e9 reinicializado o contador respeitante ao ID recebido, seja ele \n\nnovo ou n\u00e3o. Este contador individual para cada um dos controladores presentes no \n\nbarramento caso ultrapasse 4 segundos significa que ocorreu um time-out e \n\nautomaticamente \u00e9 apagado o registo do controlador em quest\u00e3o. \n\nA transmiss\u00e3o de uma mensagem por parte do gateway acontece sempre que seja \n\nsolicitada a altera\u00e7\u00e3o de um ou mais par\u00e2metros de um determinado controlador. O \n\ncampo de dados da mensagem enviada deve possuir os novos par\u00e2metros do \n\ncontrolador solicitado, assim como o identificador do gateway (Figura 5.11). De \n\nsalientar que o identificador antigo do controlador deve ser sempre salvaguardado, j\u00e1 \n\nque este n\u00e3o teria forma de reconhecer a mensagem. O controlador ao receber a \n\nmensagem e reconhecer o remetente, altera internamente o valor dos par\u00e2metros que \n\nn\u00e3o correspondam com os seus atuais. A partir desse momento, estar\u00e1 pronto para \n\nenviar os seus novos par\u00e2metros ao gateway. \n\n \n\nNovo ID\nNova \n\nTemperatura\nNovo N\u00edvel \nde Queima\n\nID do \nGateway\n\nByte 0 Byte 1 Byte 2 Byte 3 Byte 4 Byte 5 Byte 6 Byte 7  \n\nFigura 5.11 \u2013 Campo de dados da mensagem enviada pelo gateway \n\n5.1.15 - ESTRUTURA DA FUN\u00c7\u00c3O MAIN \n\nO programa principal que corre sobre o microcontrolador \u00e9 denominado de fun\u00e7\u00e3o \n\nMAIN, onde s\u00e3o declaradas e inicializadas vari\u00e1veis, configurados registos, \n\nprocessados dados, etc. Por ordem cronol\u00f3gica s\u00e3o especificadas as opera\u00e7\u00f5es \n\ninclu\u00eddas no programa: \n\n1 - Declara\u00e7\u00e3o e inicializa\u00e7\u00e3o de vari\u00e1veis; \n\n2 - Configura\u00e7\u00e3o e inicializa\u00e7\u00e3o dos pinos de entrada e sa\u00edda; \n\n3 - Desativa\u00e7\u00e3o de todas as interrup\u00e7\u00f5es; \n\n4 - Configura\u00e7\u00e3o da rotina de interrup\u00e7\u00e3o externa; \n\n5 - Configura\u00e7\u00e3o dos Timers; \n\n6 - Configura\u00e7\u00e3o dos m\u00f3dulos de comunica\u00e7\u00e3o; \n\n7 - Configura\u00e7\u00e3o dos registos do LCD; \n\n8 - Leitura dos par\u00e2metros do sistema; \n\n9 - C\u00e1lculo das temperaturas iniciais; \n\n10 - C\u00e1lculo da hora atual; \n\n\n\n67 \n\n \n\n11 - Lan\u00e7amento do ecr\u00e3 inicial; \n\n12 - Ativa\u00e7\u00e3o das interrup\u00e7\u00f5es; \n\n13 - Ciclo infinito de opera\u00e7\u00e3o. \n\nDentro do \u00faltimo ponto \u00e9 onde se desenrola toda a atividade de processamento que d\u00e1 \n\n\u201cvida \u00e0 m\u00e1quina\u201d. De forma esquem\u00e1tica, o fluxograma do ciclo infinito de opera\u00e7\u00e3o \n\nencontra-se representado na Figura 5.12. \n\n \n\nAtua\u00e7\u00e3o dos \nVentiladores \n\nativa?\n\nLeitura da TAG de \ntoque\n\nOrdem de \ncalibra\u00e7\u00e3o?\n\nCalibra\u00e7\u00e3o do \nsistema\n\nSim\n\nDecorrido 1 \nsegundo desde a \n\n\u00faltima vez?\n\nDecorridos 5 \nsegundos desde a \n\n\u00faltima vez?\n\nAtualiza\u00e7\u00e3o \nda hora \n\natual\n\nSim\n\nGest\u00e3o da \nexecu\u00e7\u00e3o da \n\npredi\u00e7\u00e3o\n\nGest\u00e3o de programa \nagendado ou em \n\nexecu\u00e7\u00e3o\n\nCrono \nTermostato \n\nativo?\n\nSim\n\nPredi\u00e7\u00e3o ativa? N\u00e3o\n\nEcr\u00e3 necessita \nde atualiza\u00e7\u00e3o?\n\nSim\n\nGest\u00e3o da \ncomunica\u00e7\u00e3o CAN\n\nDecorridos 30 \nsegundos desde a \n\n\u00faltima vez?\n\nAmostragem da \ntemperatura \n\nambiente\nSim\n\nGest\u00e3o de \necr\u00e3s\n\nIn\u00edcio do ciclo\n\nN\u00e3o\n\nAmostragem da \ntemperatua dos gases \nde escape e da placa\n\nSim\n\nEcr\u00e3 \u00e9 \natualizado\n\nSim\n\nConclus\u00e3o do \nDisparo do TRIAC\n\nSim\n\nM\u00e1quina de \nestados\n\nN\u00e3o\n\nN\u00e3o\n\nN\u00e3o\n\n \n\nFigura 5.12 - Fluxograma do ciclo infinito da fun\u00e7\u00e3o MAIN \n\n5.2 SOFTWARE PARA PC \n\nUtilizando a ferramenta NetBeans IDE, foi criada uma aplica\u00e7\u00e3o para PC, em JAVA, \n\ncom o intuito de ser utilizada pela ECOAMA, em fun\u00e7\u00e3o da m\u00e1quina a que se destina, \n\npara instala\u00e7\u00e3o, configura\u00e7\u00e3o de par\u00e2metros e depura\u00e7\u00e3o de avarias. Nesta \n\ndisserta\u00e7\u00e3o, a aplica\u00e7\u00e3o desenvolvida destina-se apenas para um recuperador de \n\ncalor, tendo em conta que \u00e9 o \u00fanico que pode ser testado nas instala\u00e7\u00f5es da empresa. \n\nFoi escolhida esta linguagem de programa\u00e7\u00e3o por ser universal e port\u00e1vel (pode correr \n\n\n\n68 \n\n \n\nem qualquer m\u00e1quina, desde computadores, telem\u00f3veis, tablets, etc, a partir de uma \n\nm\u00e1quina virtual, Java Virtual Machine). \n\nA aplica\u00e7\u00e3o permite a\u00e7\u00f5es de teste aos atuadores, configura\u00e7\u00e3o de par\u00e2metros do \n\nsistema, programa\u00e7\u00e3o do crono termostato, monitoriza\u00e7\u00e3o do processo de \n\naquecimento, assim como do estado do barramento CAN em tempo real. Com o \n\nobjetivo de facilitar a instala\u00e7\u00e3o e manuten\u00e7\u00e3o de um recuperador de calor no interior \n\nde uma casa por parte do fabricante, procurou-se que esta fosse o mais intuitiva \n\nposs\u00edvel e de depura\u00e7\u00e3o r\u00e1pida de poss\u00edveis problemas com o hardware. \n\nPara se utilizar a aplica\u00e7\u00e3o desenvolvida, o computador deve possuir uma porta s\u00e9rie \n\nRS232 ou USB, desde que se utilize um conversor adequado, e esta encontrar-se \n\nligada ao controlador. \n\n5.2.1 - COMUNICA\u00c7\u00c3O COM A PORTA S\u00c9RIE \n\nA porta s\u00e9rie foi escolhida como elo de liga\u00e7\u00e3o entre o computador e o controlador. \n\nSendo a interface de comunica\u00e7\u00e3o bem definida (RS232) existem par\u00e2metros de \n\nconfigura\u00e7\u00e3o e/ou de trama que ambos devem respeitar. S\u00e3o eles, principalmente, a \n\nbaud rate, ou seja, a taxa de transmiss\u00e3o de s\u00edmbolos por segundo, o n\u00famero de bits \n\nde dados, de stop bits e o tipo de paridade, podendo ser utilizados outros. \n\nPara o microcontrolador poder aceder \u00e0 porta s\u00e9rie utilizou-se o m\u00f3dulo 2 da UART \n\ndisponibilizado pelo PIC32. De entre v\u00e1rias configura\u00e7\u00f5es do m\u00f3dulo destacam-se os \n\nquatro principais referidos acima: \n\n? Baud rate: 115200 bits/s \n\n? Data bits: 8 \n\n? Stop bits: 1 \n\n? Paridade: Sem paridade (\u2018N\u2019) \n\nRelativamente \u00e0 leitura de informa\u00e7\u00e3o da porta s\u00e9rie, essa tarefa fica ao encargo da \n\nrotina de interrup\u00e7\u00e3o (Figura 5.13) que \u00e9 chamada sempre que um novo caracter lhe \n\nchega. Depois de inicializado, o controlador n\u00e3o deve reconhecer nenhum outro \n\ncomando que n\u00e3o seja um dos utilizados para a conex\u00e3o com a aplica\u00e7\u00e3o. Quando \n\nesta estiver estabelecida, a rotina j\u00e1 o poder\u00e1 fazer. Sempre que um comando tiver \n\nsido reconhecido, \u00e9 executada a resposta \u00e0 solicita\u00e7\u00e3o e o array utilizado para \n\narmazenar a sequ\u00eancia de caracteres recebida \u00e9 apagado. A lista de todos os \n\ncomandos utilizados encontra-se dispon\u00edvel nas Tabelas 8.2, 8.3, 8.4 e 8.5. \n\n\n\n69 \n\n \n\nIn\u00edcio\n\nControlador \nconetado?\n\nFim\n\nPar\u00e2metros \nEnviados?\n\nSim\n\nRecebeu \n\u201cConnect1\u201d ?\n\nN\u00e3o\nRecebeu \n\n\u201cConnect2\u201d?\nEnvia \u201cAck1\u201dSim Envia \u201cAck2\u201dSim\n\nControlador \nconetado\n\nRecebeu \n\u201cfeeder\u201d?\n\nN\u00e3o\nRecebeu \n\n\u201cambfan\u201d?\nN\u00e3o\n\nRecebeu \n\u201cfliuefan\u201d?\n\nN\u00e3o\nRecebeu \n\u201ctemps\u201d?\n\nN\u00e3o\nRecebeu \n\u201cprogs\u201d?\n\nN\u00e3o\n\nEnvia \nPar\u00e2metros do \n\nAlimentador\n\nSim\n\nEnvia Par\u00e2metros \ndo Ventilador \n\nAmbiente\n\nEnvia Par\u00e2metros \ndo Ventilador de \n\nEscape\n\nEnvia \nPar\u00e2metros de \nTemperatura\n\nEnvia Par\u00e2metros \nde Programa\u00e7\u00e3o do \nCrono termostato\n\nSim Sim Sim Sim\n\nRecebeu \n\u201cgID\u201d ?\n\nN\u00e3o\n\nEnvia par\u00e2metros \nde coopera\u00e7\u00e3o do \n\ngateway\n\nRecebeu \n\u201cdevID\u201d ?\n\nN\u00e3o\n\nEnvia par\u00e2metros \nde coopera\u00e7\u00e3o \n\ndos controladores\n\nSim Sim\n\nRecebeu \n\u201cfd \u201c?\n\nRecebeu \n\u201caf \u201c?\n\nRecebeu \n\u201cff \u201c?\n\nRecebeu \n\u201ctp \u201c?\n\nRecebeu \n\u201csv1 \u201c?\n\nAltera a vari\u00e1vel \nque armazena os \n\npar\u00e2metros do \nalimentador\n\nAltera a vari\u00e1vel que \narmazena os \n\npar\u00e2metros do \nVentilador Ambiente\n\nAltera a vari\u00e1vel que \narmazena os \n\npar\u00e2metros do \nVentilador de Escape\n\nSimSimSim\n\nAltera a vari\u00e1vel \nque armazena os \n\npar\u00e2metros de \nTemperatura\n\nRecebe \npar\u00e2metros do \nprograma \u20181\u2019\n\nSim\n\nN\u00e3oN\u00e3oN\u00e3oN\u00e3o\n\nN\u00e3o\n\nSim\n\nRecebeu \n\u201csv2 \u201c?\n\nRecebe \npar\u00e2metros do \nprograma \u20182\u2019\n\nSim\n\nRecebeu \n\u201csv3 \u201c?\n\nRecebe \npar\u00e2metros do \nprograma \u20183\u2019\n\nSim\n\nN\u00e3o N\u00e3o\nRecebeu \n\n\u201cp0 \u201c?\n\nNenhum \nprograma fica \n\nativo\n\nSim\n\nRecebeu \n\u201cp1 \u201c?\n\nAltera o \nprograma \n\nativo para o \u20181'\n\nSim\n\nN\u00e3o\nRecebeu \n\n\u201cp2 \u201c?\n\nAltera o \nprograma \n\nativo para o \u20182\u2019\n\nSim\n\nRecebeu \n\u201cp3 \u201c?\n\nAltera o \nprograma \n\nativo para o \u20183\u2019\n\nSim\n\nN\u00e3oN\u00e3o\n\nRecebeu \n\u201cidgt\u201d?\n\nRecebeu \n\u201cidc1t\u201d?\n\nN\u00e3o\nRecebeu \n\u201cidc2t\u201d?\n\nRecebeu \n\u201cidc3t\u201d?\n\nRecebeu \n\u201cidc4t\u201d?\n\nN\u00e3oN\u00e3oN\u00e3o\n\nN\u00e3o\n\nAltera par\u00e2metros \nde coopera\u00e7\u00e3o do \n\ngateway\n\nAltera par\u00e2metros \nde coopera\u00e7\u00e3o do \n\ncontrolador 1\n\nAltera par\u00e2metros \nde coopera\u00e7\u00e3o do \n\ncontrolador 2\n\nAltera par\u00e2metros \nde coopera\u00e7\u00e3o do \n\ncontrolador 3\n\nAltera par\u00e2metros \nde coopera\u00e7\u00e3o do \n\ncontrolador 4\n\nSimSimSimSimSim\n\nRecebeu \n\u201cf1 \u201c?\n\nLiga o \nAlimentador \n\nde pellets\n\nSim\n\nRecebeu \n\u201cf0 \u201c?\n\nDesliga o \nAlimentador \n\nde pellets\n\nSim\n\nRecebeu \n\u201ci1 \u201c?\n\nLiga a \nResist\u00eancia de \n\nIgni\u00e7\u00e3o\n\nSim\n\nN\u00e3o N\u00e3o\nRecebeu \n\n\u201ci0 \u201c?\n\nDesliga a \nResist\u00eancia de \n\nIgni\u00e7\u00e3o\n\nSim\n\nRecebeu \n\u201ca1 \u201c?\n\nLiga o \nVentilador \nAmbiente\n\nSim\n\nN\u00e3o\nRecebeu \n\n\u201ca0 \u201c?\n\nDesliga o \nVentilador \nAmbiente\n\nSim\n\nRecebeu \n\u201ca- \u201c?\n\nDiminui uma \nunidade o n\u00edvel \n\nde tens\u00e3o\n\nSim\n\nN\u00e3oN\u00e3o\n\nN\u00e3o\n\nRecebeu \n\u201ca+\u201d?\n\nRecebeu \n\u201cF1\u201d?\n\nN\u00e3o\nRecebeu \n\n\u201cF0\u201d?\nRecebeu \n\n\u201cF-\u201d?\nRecebeu \n\n\u201cF+\u201d?\nN\u00e3oN\u00e3oN\u00e3o\n\nAumenta uma \nunidade o n\u00edvel \n\nde tens\u00e3o\n\nLiga o \nVentilador de \n\nEscape\n\nDesliga o \nVentilador de \n\nEscape\n\nDiminui uma \nunidade o n\u00edvel \n\nde tens\u00e3o\n\nAumenta uma \nunidade o n\u00edvel \n\nde tens\u00e3o\n\nSimSimSimSimSim\n\nN\u00e3o\n\nRecebeu \n\u201cstr \u201c?\n\nInicia o \nprocesso de \n\nqueima\n\nSim\n\nRecebeu \n\u201cstp \u201c?\n\nTermina o \nprocesso de \n\nqueima\n\nSim\n\nRecebeu \n\u201cpv \u201c?\n\nEnvia para a \nAplica\u00e7\u00e3o toda a \n\ninforma\u00e7\u00e3o sobre o \nestado do processo\n\nSim\n\nN\u00e3o N\u00e3o\n\nN\u00e3o\n\nN\u00e3o\n\nSim\n\n \n\nFigura 5.13 - Fluxograma da RSI para a rece\u00e7\u00e3o de carateres \n\nEm JAVA, a implementa\u00e7\u00e3o da API de comunica\u00e7\u00f5es est\u00e1 acess\u00edvel a partir da \n\nbiblioteca \u201cRXTXcomm\u201d e nela est\u00e3o contidas rotinas b\u00e1sicas de gest\u00e3o desta \n\ninterface de comunica\u00e7\u00e3o. Contudo, n\u00e3o existe uma rotina espec\u00edfica para realizar \n\na\u00e7\u00f5es de acesso \u00e0 porta s\u00e9rie para leitura ou escrita, como na linguagem C. \n\n\n\n70 \n\n \n\nPara ser poss\u00edvel a leitura ou envio de dados para a porta s\u00e9rie \u00e9 necess\u00e1rio obter \n\npreviamente informa\u00e7\u00e3o sobre as portas que est\u00e3o a ser utilizadas pelo PC. Neste \n\ncaso, a porta deve ser do tipo s\u00e9rie e o seu nome corresponder ao elemento da lista \n\nespecificado pelo instalador (COM4, por exemplo) na aplica\u00e7\u00e3o. \n\nA partir daqui \u00e9 invocado um construtor, que \u00e9 respons\u00e1vel pela abertura da respetiva \n\nporta, pela defini\u00e7\u00e3o dos par\u00e2metros de comunica\u00e7\u00e3o (baud rate, data bits, stop bits e \n\nparidade) e pela restante configura\u00e7\u00e3o necess\u00e1ria para a leitura de dados da porta \n\ns\u00e9rie (Figura 5.14): \n\n? Cria\u00e7\u00e3o de um stream de dados do tipo inputStream, para a rece\u00e7\u00e3o; \n\n? Cria\u00e7\u00e3o de um \u201cListener\u201d para gerar um evento sempre que uma mudan\u00e7a no \n\nconte\u00fado da porta s\u00e9rie for detetada; \n\n? Defini\u00e7\u00e3o dos par\u00e2metros de configura\u00e7\u00e3o da porta; \n\n? Cria\u00e7\u00e3o e inicializa\u00e7\u00e3o de uma thread. \n\n \n\n \n\nFigura 5.14 - Configura\u00e7\u00e3o para a leitura de carateres da porta s\u00e9rie \n\nDentro da rotina que \u00e9 gerada a cada novo evento ocorrido na porta s\u00e9rie, \u00e9 \n\nnecess\u00e1rio depositar os dados recebidos para um array de caracteres (Figura 5.15) \n\nque possa ser acedido no programa principal. \n\n\n\n71 \n\n \n\n \n\nFigura 5.15 - Fluxograma da leitura de dados da porta s\u00e9rie \n\nA escrita \u00e9 mais simples de implementar, uma vez que n\u00e3o utiliza a thread nem a \n\ngera\u00e7\u00e3o de eventos ass\u00edncronos. No programa principal, sempre que se pretenda \n\nescrever sobre a porta s\u00e9rie basta atribuir ao objeto de stream de dados para \n\ntransmiss\u00e3o do tipo outputStream, o conte\u00fado da string que se pretende enviar e \n\nutilizar a rotina \u201cwrite\u201d associada a esta classe (Figura 5.16) para enviar a informa\u00e7\u00e3o. \n\n \n\n \n\nFigura 5.16 - Fluxograma da escrita de dados na porta s\u00e9rie \n\n5.2.2 - ESTRUTURA DA APLICA\u00c7\u00c3O \n\nA aplica\u00e7\u00e3o estrutura-se por abas, sendo que cada uma delas est\u00e1 destinada a uma \n\nou mais opera\u00e7\u00f5es espec\u00edficas. \n\n \n\n? Conex\u00e3o \n\nA aba de conex\u00e3o \u00e9 respons\u00e1vel pelo estabelecimento da liga\u00e7\u00e3o entre o computador \n\ne o controlador, assim como do acompanhamento e configura\u00e7\u00e3o dos par\u00e2metros de \n\ncoopera\u00e7\u00e3o dos restantes controladores ligados ao barramento. \n\nA conex\u00e3o deve ser a primeira atividade a ser executada, para garantir que se \n\nestabeleceu uma correta comunica\u00e7\u00e3o entre ambos. Assim sendo, inicialmente \n\nquando a aplica\u00e7\u00e3o \u00e9 executada, deve encontrar-se desconectada (Figura 5.17) \n\n \n\n\n\n72 \n\n \n\n \n\nFigura 5.17 - Aplica\u00e7\u00e3o inicialmente desconectada \n\nO bot\u00e3o \u201cConnect\u201d deve ser clicado para estabelecimento da liga\u00e7\u00e3o, iniciando-se uma \n\ntroca de mensagens segundo a Figura 5.18. Para essa troca de mensagens se poder \n\nefetivar com sucesso s\u00e3o necess\u00e1rias algumas valida\u00e7\u00f5es, como por exemplo se a \n\nporta selecionada da lista coincide com a que est\u00e1 ligada ao controlador, entre outras \n\n(Figura 5.19). Recebendo a segunda mensagem de confirma\u00e7\u00e3o, \u201cAck2\u201d, a aplica\u00e7\u00e3o \n\nconsidera ter o controlador conectado e pede que lhe envie todos os par\u00e2metros do \n\nsistema, atualizando os campos de dados respetivos. \n\n \n\nA\np\n\nli\nc\na\n\n\u00e7\n\u00e3\n\no\n P\n\nC\n\nC\no\n\nn\ntr\n\no\nla\n\nd\no\n\nr \n(g\n\na\nte\n\nw\na\n\ny\n)\n\n\u201cConnect1\"\n\n\u201cConnect2\"\n\n\u201cAck1\u201d\n\n\u201cAck2\u201d\n\n\u201cfeeder\u201d\n\n\u201cambfan\u201d\n\n\u201cfluefan\u201d\n\n\u201ctemps\u201d\n\n\u201cprg\u201d\n\n\u201cgID\u201d\n\nPar\u00e2metros do Motor de Alimenta\u00e7\u00e3o\n\nPar\u00e2metros do Ventilador de Escape\n\nPar\u00e2metros das Temperaturas \n\nPar\u00e2metros dos programas\n\nPar\u00e2metros de coopera\u00e7\u00e3o do gateway\n\nPar\u00e2metros do Ventilador Ambiente\n\nCONETADO\n\nPar\u00e2metros \ndo Sistema \nEnviados\n\n \n\nFigura 5.18 - Troca de mensagens despoletada pelo bot\u00e3o \u201cConnect\u201d \n\n\n\n73 \n\n \n\n \n\nFigura 5.19 - Fluxograma estabelecido pelo bot\u00e3o \u201cConnect\u201d \n\n? Configura\u00e7\u00e3o dos par\u00e2metros do sistema \n\nOs mecanismos de configura\u00e7\u00e3o dos par\u00e2metros do sistema anteriormente descritos \n\ns\u00e3o descritos nesta sec\u00e7\u00e3o. A Figura 5.20 diz respeito \u00e0 aba do alimentador de pellets \n\nonde podem ser visualizados os campos de dados relativos aos seus par\u00e2metros.  \n\n \n\n \n\nFigura 5.20 - Aba para altera\u00e7\u00e3o de par\u00e2metros e teste do MA e RI \n\nEm caso de altera\u00e7\u00e3o de um dos par\u00e2metros mencionados em cima, podem ser \n\nrealizadas tr\u00eas a\u00e7\u00f5es. Uma delas \u00e9 despoletada pelo bot\u00e3o \u201cSet\u201d que envia a \n\n\n\n74 \n\n \n\ninforma\u00e7\u00e3o para a vari\u00e1vel respetiva do programa que corre no controlador. A segunda \n\n\u00e9 despoletada pelo bot\u00e3o \u201cSet default\u201d que, al\u00e9m de fazer o mesmo que o anterior, \n\npede ainda que a nova altera\u00e7\u00e3o seja guardada na mem\u00f3ria do controlador, como \n\npredefini\u00e7\u00e3o. Por \u00faltimo, no caso de o instalador ter alterado os valores predefinidos \n\npor outros sem os ter predefinido novamente e pretender recuper\u00e1-los, em vez de os \n\nestar a introduzir todos novamente, basta que clique no bot\u00e3o \u201cRestore defaults\u201d. \n\nVoltando \u00e0 aba de conex\u00e3o (Figura 5.17), podem ser observados nos campos de texto \n\nmais \u00e0 direita os par\u00e2metros de identifica\u00e7\u00e3o, as temperaturas a que entram em \n\nfuncionamento e o n\u00edvel de queima dos controladores presentes no barramento. \n\nOcorrida uma altera\u00e7\u00e3o de um destes par\u00e2metros, \u00e9 enviada a nova informa\u00e7\u00e3o, \n\natrav\u00e9s do bot\u00e3o \u201cSet\u201d, para o gateway. Por sua vez, este encarregar-se-\u00e1 de envi\u00e1-la \n\nao(s) respetivo(s) controladores, que guardar\u00e3o a altera\u00e7\u00e3o solicitada. \n\n \n\n? Teste aos atuadores \n\nEsta funcionalidade da aplica\u00e7\u00e3o destina-se, durante a instala\u00e7\u00e3o e/ou repara\u00e7\u00e3o do \n\naparelho, a certificar que os atuadores est\u00e3o a trabalhar como pretendido, facilitando a \n\ndete\u00e7\u00e3o de eventuais avarias. \n\nO teste ao motor de alimenta\u00e7\u00e3o e \u00e0 resist\u00eancia de igni\u00e7\u00e3o (Figura 5.20) apenas \u00e9 feito \n\ncom um bot\u00e3o para ligar, \u201cON\u201d, e outro para desligar, \u201cOFF\u201d. Os testes aos \n\nventiladores, al\u00e9m de contemplarem estas duas a\u00e7\u00f5es, possuem tamb\u00e9m dois bot\u00f5es \n\npara regula\u00e7\u00e3o do n\u00edvel de tens\u00e3o a elas aplicada, \u201c+\u201d e \u201c-\u201c, e consequentemente da \n\nsua velocidade de rota\u00e7\u00e3o. A Figura 5.21 exemplifica o teste que pode ser realizado ao \n\nventilador ambiente. \n\n \n\n \n\nFigura 5.21 - Aba para altera\u00e7\u00e3o de par\u00e2metros e teste do VA \n\n\n\n75 \n\n \n\n? Monitoriza\u00e7\u00e3o do estado do processo e dos controladores em coopera\u00e7\u00e3o \n\nUma vez que o instalador/operador de manuten\u00e7\u00e3o do sistema deve ter acesso ao \n\nmaior n\u00famero de informa\u00e7\u00e3o poss\u00edvel, foi criada a aba da Figura 5.22 com o objetivo \n\nde verificar o correto funcionamento da m\u00e1quina de estados, atrav\u00e9s da leitura do \n\nestado dos atuadores, da fase do processo e das temperaturas medidas. \n\nDepois de estabelecida a conex\u00e3o com o controlador, nova informa\u00e7\u00e3o referente ao \n\nestado do processo \u00e9 recebida periodicamente pela aplica\u00e7\u00e3o, atualizando assim os \n\ncampos de texto de 2 em 2 segundos. Este per\u00edodo foi escolhido tendo em conta que \n\nmudan\u00e7as do estado do processo devem ser observadas com alguma brevidade. \n\nInicialmente, o processo encontra-se no estado \u201cInativo\u201d, logo os seus atuadores \n\nestar\u00e3o todos desligados e a temperatura dos gases de escape igual \u00e0 temperatura da \n\nplaca. Para iniciar o processo \u00e9 necess\u00e1rio um clique no bot\u00e3o \u201cSTART\u201d ficando \n\nentregue todo o controlo \u00e0 m\u00e1quina de estados. Para termin\u00e1-lo basta um clique no \n\nbot\u00e3o \u201dSTOP\u201d, voltando ao estado inicial, depois da extin\u00e7\u00e3o da chama. \n\n \n\n \n\nFigura 5.22 - Ecr\u00e3 de monitoriza\u00e7\u00e3o do processo de aquecimento \n\nVoltando \u00e0 aba de conex\u00e3o, onde \u00e9 igualmente realizada a monitoriza\u00e7\u00e3o dos \n\ncontroladores de coopera\u00e7\u00e3o, al\u00e9m do gateway, podem ser observados os seus \n\nn\u00fameros identificadores no campo de dados, em tempo real (Figura 5.17). Esta lista \u00e9 \n\natualizada continuamente com o intuito da dete\u00e7\u00e3o de novo dispositivo ser feita de \n\nforma r\u00e1pida por parte do instalador/operador de manuten\u00e7\u00e3o, assim como a \n\nocorr\u00eancia de falha, avaria ou ainda de remo\u00e7\u00e3o. \n\nEstas duas monitoriza\u00e7\u00f5es s\u00e3o conseguidas, novamente, atrav\u00e9s de uma troca de \n\nmensagens realizada periodicamente de 2 em 2 segundos (Figura 5.23). \n\n \n\n\n\n76 \n\n \n\nA\np\n\nli\nc\na\n\n\u00e7\n\u00e3\n\no\n P\n\nC\n\nC\no\n\nn\ntr\n\no\nla\n\nd\no\n\nr \n(g\n\na\nte\n\nw\na\n\ny\n)\n\n\u201cpv\u201d\n\nEstado do Processo\n\n\u201cdevID\u201d\n\nPar\u00e2metros de coopera\u00e7\u00e3o dos controladores\n\n \n\nFigura 5.23 - Troca de mensagens de monitoriza\u00e7\u00e3o entre o PC e o gateway \n\nNa Tabela 5.6, encontram-se condensadas as abas por tipo de tarefa. \n\n \n\nTarefa Abas Funcionalidades \n\nConex\u00e3o \u201cConnection\u201d \nEstabelecimento da liga\u00e7\u00e3o entre o \n\ncontrolador e a aplica\u00e7\u00e3o PC \n\nConfigura\u00e7\u00e3o dos \n\npar\u00e2metros do \n\nsistema \n\n\u201cFeeder\u201d/ \n\n\u201cEnvironment \n\nFan\u201d/ \n\n\u201cFlue Fan\u201d \n\nConfigura\u00e7\u00e3o dos par\u00e2metros associados aos \n\ncinco n\u00edveis da fase de trabalho e \u00e0 fase de \n\nigni\u00e7\u00e3o. As altera\u00e7\u00f5es efetuadas podem \n\nordenar a salvaguarda na vari\u00e1vel do \n\nprograma e/ou na mem\u00f3ria do controlador. \n\n\u201cTemperatures\u201d \nConfigura\u00e7\u00e3o dos par\u00e2metros associados \u00e0s \n\ntemperaturas. \n\n\u201cProgramming\u201d \nConfigura\u00e7\u00e3o dos par\u00e2metros associados ao \n\ncrono termostato. \n\nTeste aos atuadores \n\n\u201cFeeder\u201d/ \n\n\u201cEnvironment \n\nFan\u201d/ \n\n\u201cFlue Fan\u201d/ \n\nLigar e desligar cada um dos atuadores; \n\nRegular a velocidade dos ventiladores entre \n\ncinco n\u00edveis. \n\nMonitoriza\u00e7\u00e3o do \n\nestado do processo e \n\ndos controladores em \n\ncoopera\u00e7\u00e3o \n\n\u201cConnection\u201d \n\n\u201cProcess\u201d \n\nIniciar e terminar o processo de aquecimento; \n\nVisualiza\u00e7\u00e3o das temperaturas medidas pelos \n\nsensores, do estado dos atuadores e do \n\npr\u00f3prio processo; \n\nVisualiza\u00e7\u00e3o dos controladores que se \n\nencontram ligados ao barramento em termo \n\nreal. \n\nTabela 5.6 - Funcionalidades dispon\u00edveis na aplica\u00e7\u00e3o PC por tarefa \n\n\n\n77 \n\n \n\nCap\u00edtulo 6 TESTES DE VALIDA\u00c7\u00c3O \n\nOs testes realizados destinaram-se a validar o comportamento dos sensores, \n\natuadores e respetivas interfaces de acondicionamento, assim como a m\u00e1quina de \n\nestados. \n\n6.1 TESTES AOS SENSORES \n\nCom o objetivo de encontrar um termo de compara\u00e7\u00e3o as experi\u00eancias realizadas \n\nsobre os sensores foram realizadas sempre com o aux\u00edlio de um term\u00f3metro FLUKE. \n\n6.1.1 - NTC \n\nNum primeiro teste foram colocados o term\u00f3metro FLUKE e a NTC a medir a \n\ntemperatura ambiente de uma sala de estar com portas e janelas abertas para for\u00e7ar o \n\nseu valor a ser o mais constante poss\u00edvel durante a experi\u00eancia, dada a elevada \n\nmassa de ar em cont\u00ednua circula\u00e7\u00e3o. Durante cerca de 25 minutos foram recolhidas \n\namostras separadas por 30 segundos (Gr\u00e1fico 6.1). Houve o cuidado de colocar \n\nambos os sensores \u00e0 mesma altura e \u00e0 mesma dist\u00e2ncia de uma das paredes para \n\nuniformizar a medida. \n\n \n\n \n\nGr\u00e1fico 6.1 - Medi\u00e7\u00e3o da temperatura ambiente \n\nO valor m\u00e1ximo atingido pelo term\u00f3metro FLUKE foi de 25.7\u00baC, enquanto com a NTC \n\nde 25,9\u00baC. O valor m\u00ednimo situou-se nos 25.5\u00baC em ambos os sensores. \n\nO erro m\u00e1ximo verificado foi de -0.3\u00baC (Gr\u00e1fico 6.2), o que em termos pr\u00e1ticos tem \n\npouco significado, uma vez que o utilizador n\u00e3o \u00e9 capaz de se aperceber desta \n\n24\n\n24,5\n\n25\n\n25,5\n\n26\n\n26,5\n\n27\n\n27,5\n\n28\n\n0 10 20 30\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nTempo (min)\n\nFLUKE\n\nNTC\n\n\n\n78 \n\n \n\ndiferen\u00e7a no que diz respeito \u00e0 temperatura ambiente. Pode-se concluir que a precis\u00e3o \n\ne resolu\u00e7\u00e3o na medi\u00e7\u00e3o da temperatura da NTC cumprem os requisitos. \n\n \n\n \n\nGr\u00e1fico 6.2 - Erro associado \u00e0 medi\u00e7\u00e3o da temperara ambiente \n\nNum segundo teste arrefeceu-se \u00e1gua de uma pequena bacia com cerca de 1 litro de \n\ncapacidade, no congelador, e retirou-se a mesma deixando-a repousar e iniciando de \n\nimediato a medi\u00e7\u00e3o da sua temperatura. \n\n \n\n \n\nGr\u00e1fico 6.3 - Medi\u00e7\u00e3o da temperatura da \u00e1gua \n\nVerifica-se que, inicialmente, a temperatura da \u00e1gua era de cerca de 5\u00baC e ao final de \n\n25 minutos esta aumentou at\u00e9 aos 10\u00baC (Gr\u00e1fico 6.3). \n\nO erro absoluto, associado \u00e0 diferen\u00e7a entre a temperatura medida pelo term\u00f3metro \n\nFLUKE e a NTC, teve o seu m\u00e1ximo em 0.5\u00baC (Gr\u00e1fico 6.4). Algumas oscila\u00e7\u00f5es entre \n\nas duas medi\u00e7\u00f5es podem dever-se ao facto de durante a experi\u00eancia terem sido \n\ncolocadas as m\u00e3os v\u00e1rias vezes em contacto com a bacia, para fazer aquecer mais \n\nrapidamente a \u00e1gua no seu interior. \n\n-0,4\n\n-0,3\n\n-0,2\n\n-0,1\n\n0\n\n0,1\n\n0,2\n\n0 10 20 30\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nTempo (min)\n\nERRO\n\n0\n\n2\n\n4\n\n6\n\n8\n\n10\n\n12\n\n0 10 20 30\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nTempo (min)\n\nFLUKE\n\nNTC\n\n\n\n79 \n\n \n\n \n\nGr\u00e1fico 6.4 - Erro associado \u00e0 medi\u00e7\u00e3o da temperatura da \u00e1gua \n\nNovamente, a dispers\u00e3o de pontos relativos ao erro se d\u00e1 predominantemente em \n\nordenadas negativas, o que significa que se pode proceder a um pequeno ajuste na \n\nmedi\u00e7\u00e3o da temperatura da NTC, nomeadamente reduzir um pouco o seu offset. \n\n6.1.2 - TERMOPAR K \n\nCom o aux\u00edlio de uma torradeira foram colocados o term\u00f3metro FLUKE e o Termopar \n\nsuspensos, mas pr\u00f3ximos da superf\u00edcie met\u00e1lica aquecida. Inicialmente deixou-se que \n\na torradeira atingisse a sua temperatura m\u00e1xima para, posteriormente, deslig\u00e1-la da \n\ncorrente e iniciar-se a medi\u00e7\u00e3o do ar quente por ela irradiado. \n\nEste teste teve a dura\u00e7\u00e3o de 10 minutos, com um intervalo de 20 segundos entre cada \n\namostra (Gr\u00e1fico 6.5). \n\n \n\nGr\u00e1fico 6.5 - Medi\u00e7\u00e3o da temperatura do ar quente \n\nObservam-se em v\u00e1rios per\u00edodos de tempo que a temperatura medida pelo termopar \u00e9 \n\nligeiramente superior \u00e0 do FLUKE e vice-versa. \n\n-0,6\n\n-0,4\n\n-0,2\n\n0\n\n0,2\n\n0,4\n\n0 10 20 30\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nTempo (min)\n\nERRO\n\n0\n\n10\n\n20\n\n30\n\n40\n\n50\n\n60\n\n70\n\n0 5 10 15\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nTempo (min)\n\nFLUKE\n\nTermopar\n\n\n\n80 \n\n \n\nO erro m\u00e1ximo obtido situou-se em 4.4\u00baC (Gr\u00e1fico 6.6), enquanto a maior diferen\u00e7a de \n\nerro entre duas amostras foi de 2\u00baC, o que na aplica\u00e7\u00e3o em causa (medi\u00e7\u00e3o da \n\ntemperatura dos gases de escape) n\u00e3o \u00e9 cr\u00edtico, uma vez que n\u00e3o lhe \u00e9 exigida uma \n\nprecis\u00e3o inferior a esse valor. \n\n \n\n \n\nGr\u00e1fico 6.6 - Erro associado \u00e0 medi\u00e7\u00e3o da temperatura do ar quente \n\n6.1.3 - LM335 \n\nO teste realizado com o sensor de temperatura destinado \u00e0 compensa\u00e7\u00e3o da jun\u00e7\u00e3o \n\nfria do termopar foi realizado durante 22 minutos e iniciou-se logo ap\u00f3s ter sido ligado \n\no controlador, com um intervalo de 30 segundos entre cada amostra. \n\nOs Gr\u00e1ficos 6.7 e 6.8 descrevem respetivamente a evolu\u00e7\u00e3o da temperatura da placa, \n\nmedida atrav\u00e9s do term\u00f3metro FLUKE e LM335 e o erro associado. \n\n \n\n \n\nGr\u00e1fico 6.7 - Medi\u00e7\u00e3o da temperatura da placa \n\n-4\n\n-3\n\n-2\n\n-1\n\n0\n\n1\n\n2\n\n3\n\n4\n\n5\n\n0 5 10 15\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nTempo (min)\n\nERRO\n\n15\n\n20\n\n25\n\n30\n\n35\n\n40\n\n0 5 10 15 20 25\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nTempo (min)\n\nFLUKE\n\nLM335\n\n\n\n81 \n\n \n\n \n\nGr\u00e1fico 6.8 - Erro associado \u00e0 medi\u00e7\u00e3o da temperatura da placa \n\nVerificou-se que a temperatura da placa sobe continuamente, o que se justifica pela \n\nelevada dissipa\u00e7\u00e3o de calor provocada pelo regulador de tens\u00e3o LM7805, que fornece \n\na alimenta\u00e7\u00e3o necess\u00e1ria a grande parte dos componentes. A calibra\u00e7\u00e3o deste sensor \n\nteve em conta a temperatura ambiente inicial medida pelo term\u00f3metro FLUKE e foi \n\nrealizada por software. \n\nVisualizando os dois gr\u00e1ficos conclui-se que o erro vai aumentando (em m\u00f3dulo) \u00e0 \n\nmedida que a temperatura da placa tamb\u00e9m sobe. Isto deve-se ao facto da jun\u00e7\u00e3o do \n\ntermopar do FLUKE ter sido encostado ao inv\u00f3lucro pl\u00e1stico do sensor e este n\u00e3o \n\natingir a temperatura das pistas de sinal que o atravessam (a sa\u00edda do LM335 est\u00e1 \n\nligado aos 5V atrav\u00e9s de apenas uma resist\u00eancia logo, encontra-se mais quente). \n\nAssim, a medida n\u00e3o foi realizada no mesmo local em ambos os sensores. Da\u00ed o erro \n\nm\u00e1ximo ter chegado aos 3.3\u00baC. Apesar disso, a resolu\u00e7\u00e3o e precis\u00e3o na medi\u00e7\u00e3o da \n\ntemperatura para o LM335 cumprem os requisitos (0,1\u00baC). \n\n6.2 ATUADORES \n\nAs medi\u00e7\u00f5es de corrente e tens\u00e3o foram efetuadas nesta sec\u00e7\u00e3o com o aux\u00edlio de um \n\nmult\u00edmetro FLUKE de true rms, uma vez que as formas de onda geradas devidas \u00e0 \n\nmodula\u00e7\u00e3o do ciclo (\u00e2ngulo de disparo do TRIAC), n\u00e3o s\u00e3o sinusoidais, o que \n\nutilizando o m\u00e9todo do valor m\u00e9dio se estariam a cometer erros grosseiros. \n\n6.2.1 - TESTE EM VAZIO \n\nO primeiro teste foi realizado sem qualquer atuador ligado, com o objetivo de se medir \n\na corrente que circula no lado prim\u00e1rio do transformador (Figura 6.1). O valor em \n\nrepouso, ou seja, apenas com a placa ligada foi de 0,061 A, enquanto o valor m\u00e1ximo \n\n-3,5\n\n-3\n\n-2,5\n\n-2\n\n-1,5\n\n-1\n\n-0,5\n\n0\n\n0,5\n\n0 5 10 15 20 25\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nTempo (min)\n\nERRO\n\n\n\n82 \n\n \n\nfoi de 0,075 A e verificou-se quando o bip do altifalante do m\u00f3dulo VM800C era \n\nativado, atrav\u00e9s do toque num qualquer \u201cbot\u00e3o\u201d do ecr\u00e3 do LCD de forma repetitiva. \n\n \n\nA\n\n \n\nFigura 6.1 \u2013 Montagem da experi\u00eancia em vazio \n\n6.2.2 - TESTE COM CARGAS INDIVIDUAIS \n\nNesta sec\u00e7\u00e3o encontram-se as medidas de corrente alternada na linha que alimenta \n\nas cargas (Fase ou Neutro da rede) e a tens\u00e3o eficaz alternada aos terminais do \n\natuador respetivo, colocado em funcionamento com todos os restantes (Figura 6.2). \n\n \n\nA\n\nV\n\n \n\nFigura 6.2 \u2013 Montagem da experi\u00eancia com a RI ligada \n\nOs testes realizados com a resist\u00eancia de igni\u00e7\u00e3o (Tabela 6.1) mostram que, logo ap\u00f3s \n\nesta entrar em funcionamento, se encontra a ser percorrida por uma corrente elevada \n\nmas que rapidamente decresce at\u00e9 se situar nos 0,719 A. A corrente consumida pelo \n\nmotor de alimenta\u00e7\u00e3o \u00e9 cerca de 0,336 A durante o per\u00edodo em que se encontra ligado \n\n(Tabela 6.2). Relativamente aos ventiladores, mediram-se as mesmas grandezas \n\nel\u00e9tricas, mas dividindo-as nos seus cinco n\u00edveis de funcionamento (Tabelas 6.3 e \n\n6.4). Comparando ambos, verifica-se que o ventilador de escape consome sempre \n\nmais corrente em qualquer um dos n\u00edveis, assim como a tens\u00e3o aos seus terminais \u00e9 \n\nsuperior, excetuando nos n\u00edveis um e dois. \n\n\n\n83 \n\n \n\n \n\nResist\u00eancia de igni\u00e7\u00e3o \n\nFase Corrente (A) Tens\u00e3o (V) \n\nInicial 2,339 236,2 \n\nFinal 0,719 238,1 \n\n Tabela 6.1 - Corrente e tens\u00e3o na RI \n\nMotor de alimenta\u00e7\u00e3o \n\nCorrente (A) Tens\u00e3o (V) \n\n0,253 239,7 \n\n Tabela 6.2 - Corrente e tens\u00e3o no MA \n\nVentilador ambiente \n\nN\u00edvel Corrente (A) Tens\u00e3o (V) \n\n1 0,168 169,6 \n\n2 0,211 184,5 \n\n3 0,252 197,9 \n\n4 0,310 212,7 \n\n5 0,389 227,5 \n\n Tabela 6.3 - Corrente e tens\u00e3o no VA \n\nVentilador de escape \n\nN\u00edvel Corrente (A) Tens\u00e3o (V) \n\n1 0,183 157,8 \n\n2 0,252 179,3 \n\n3 0,320 197,2 \n\n4 0,420 215,5 \n\n5 0,478 233 \n\n Tabela 6.4 - Corrente e tens\u00e3o no VE \n\n \n\n \n\nGr\u00e1fico 6.9 - Correntes medidas no teste individual aos atuadores \n\n \n\nGr\u00e1fico 6.10 - Tens\u00f5es medidas no teste individual aos atuadores \n\nOs Gr\u00e1ficos 6.9 e 6.10 traduzem visualmente os resultados apresentados. \n\n0,000\n\n0,200\n\n0,400\n\n0,600\n\n0,800\n\n0 1 2 3 4 5\n\nC\no\n\nrr\ne\n\nn\nte\n\n (\nA\n\n)\n\nN\u00edvel\n\nVA\n\nVE\n\nRI\n\nMA\n\n0\n\n50\n\n100\n\n150\n\n200\n\n250\n\n0 1 2 3 4 5\n\nT\ne\n\nn\ns\n\n\u00e3\no\n\n (\nV\n\n)\n\nN\u00edvel\n\nVA\n\nVE\n\nRI\n\nMA\n\n\n\n84 \n\n \n\n6.2.3 - TESTE COM CARGAS SIMULT\u00c2NEAS \n\nNesta sec\u00e7\u00e3o procurou-se observar a corrente total consumida por v\u00e1rios atuadores \n\nligados ao mesmo tempo e a tens\u00e3o medida aos terminais do ventilador de escape. \n\nInicialmente ligaram-se ambos os ventiladores e mediram-se todas as combina\u00e7\u00f5es \n\nentre n\u00edveis de funcionamento (Tabela 6.5). A montagem segue o mesmo esquema \n\ndos testes anteriores. \n\n \n\nVentilador de Escape \n\nN\n\u00edv\n\ne\nl 1 2 3 4 5 \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\n1 0,416 157,5 0,485 178,6 0,549 196,3 0,644 215,1 0,7 230,8 \n\n2 0,458 157,6 0,526 178,6 0,592 196,1 0,688 214,9 0,742 230,6 \n\n3 0,496 157,4 0,566 178,6 0,634 196,1 0,728 214,8 0,781 230,6 \n\n4 0,552 157,6 0,622 178,1 0,689 196 0,783 214,8 0,842 230,5 \n\n5 0,630 157,5 0,701 178,1 0,767 195,9 0,861 214,6 0,921 230,7 \n\n Tabela 6.5 - Medi\u00e7\u00f5es com apenas os ventiladores ligados \n\nConclui-se, como esperado, que quanto maior a soma do n\u00edvel de funcionamento de \n\nambas, maior a corrente consumida. Contudo, a tens\u00e3o medida aos terminais do \n\nventilador de escape praticamente n\u00e3o sofreu altera\u00e7\u00f5es, variando o n\u00edvel de \n\nfuncionamento do ventilador ambiente, ou seja, n\u00e3o \u00e9 influenciada por outra carga \n\nligada a uma sa\u00edda diferente. \n\n \n\nNa experi\u00eancia seguinte ligou-se o motor de alimenta\u00e7\u00e3o, continuando com os \n\nventiladores ligados. Incrementos ao n\u00edvel da corrente total consumida s\u00e3o not\u00f3rios \n\n(Tabela 6.6). \n\n \n\nVentilador de Escape \n\nN\n\u00edv\n\ne\nl 1 2 3 4 5 \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\n1 0,73 155,6 0,793 176,9 0,861 195,1 0,948 212,9 1,006 230,2 \n\n2 0,769 155,4 0,837 176,9 0,908 195,1 0,991 212,9 1,048 229,9 \n\n3 0,811 155,4 0,875 176,9 0,947 194,8 1,032 212,8 1,089 229,8 \n\n4 0,863 155,7 0,932 177 1,002 194,9 1,082 212,6 1,147 229,9 \n\n5 0,94 155,6 1,006 177 1,074 194,7 1,164 212,7 1,225 229,9 \n\n Tabela 6.6 - Medi\u00e7\u00f5es com os ventiladores e o motor de alimenta\u00e7\u00e3o ligados \n\nNo \u00faltimo teste, ligou-se ainda, a resist\u00eancia de igni\u00e7\u00e3o e fizeram-se as respetivas \n\nmedi\u00e7\u00f5es. O valor m\u00e1ximo de corrente consumida pelos 4 atuadores situou-se em \n\n\n\n85 \n\n \n\n1,719 A (Tabela 6.7), curiosamente um valor inferior ao consumido pela resist\u00eancia de \n\nigni\u00e7\u00e3o na sua fase inicial. \n\n \n\nVentilador de Escape \n\nN\n\u00edv\n\ne\nl 1 2 3 4 5 \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\nCorrente \n(A) \n\nTens\u00e3o \n(V) \n\n1 1,239 155,2 1,297 176,2 1,357 196,6 1,451 215,5 1,514 232,1 \n\n2 1,277 155,4 1,334 175,9 1,391 196,7 1,493 215,5 1,555 231,9 \n\n3 1,317 155,5 1,376 176 1,427 196,6 1,526 215,2 1,594 232,2 \n\n4 1,368 155,2 1,432 176,1 1,482 196,4 1,585 215,2 1,641 232 \n\n5 1,443 155,1 1,509 175,9 1,561 196,5 1,66 215,2 1,719 231,9 \n\n Tabela 6.7 - Medi\u00e7\u00f5es com todos os atuadores ligados \n\nNas tr\u00eas experi\u00eancias o valor de tens\u00e3o aos terminais do ventilador escape, \n\npermaneceu praticamente constante em qualquer um dos n\u00edveis, o que permite \n\nconcluir que o canal \u00e9 robusto contra interfer\u00eancias externas por parte de outros \n\natuadores. \n\nFazendo uma compara\u00e7\u00e3o entre a soma das correntes consumidas individualmente, \n\npor cada um dos atuadores relativamente aos valores quando as cargas se encontram \n\nligadas em simult\u00e2neo, verifica-se que a primeira excede a segunda. O Gr\u00e1fico 6.11 \n\nmostra os resultados de ambas as partes, para um n\u00edvel fixo do ventilador ambiente de \n\n3, fazendo variar o do ventilador de escape. \n\n \n\n \n\nGr\u00e1fico 6.11 - Corrente total consumida a partir das contribui\u00e7\u00f5es individuais vs simult\u00e2nea \n\n \n\n0,000\n\n0,400\n\n0,800\n\n1,200\n\n1,600\n\n2,000\n\n0 1 2 3 4 5\n\nC\no\n\nrr\ne\n\nn\nte\n\n (\nA\n\n)\n\nN\u00edvel\n\nIndividual\n\nSimult\u00e2nea\n\n\n\n86 \n\n \n\n6.3 COMUNICA\u00c7\u00c3O ENTRE CONTROLADORES \n\nNesta sec\u00e7\u00e3o encontram-se os testes feitos \u00e0 comunica\u00e7\u00e3o entre controladores. \n\nAntes de ser dado in\u00edcio \u00e0 experi\u00eancia, programaram-se os dois microcontroladores da \n\nparte inferior da Figura 6.3 para enviarem os seus tr\u00eas par\u00e2metros de 2 em 2 \n\nsegundos atrav\u00e9s de uma mensagem CAN, sem sincronismo entre ambos. O \n\ncontrolador principal foi configurado para receber mensagens de cada um deles e \n\natualizar com a mesma frequ\u00eancia o campo de dados da aplica\u00e7\u00e3o que corre sobre o \n\nPC. \n\nInicialmente, foi estabelecida a comunica\u00e7\u00e3o entre o gateway e o PC com os \n\nmicrocontroladores desligados e por isso apenas este se encontra presente no \n\nbarramento (Figura 6.4) \n\n \n\n \n\nFigura 6.3 - Montagem de teste do barramento CAN \n\n \n\nFigura 6.4 - Apenas o gateway ligado ao barramento CAN \n\n\n\n87 \n\n \n\nDe seguida, foram ligados os dois microcontroladores em simult\u00e2neo. O gateway \n\nrecebeu essa informa\u00e7\u00e3o e ordenou-a em termos de n\u00famero identificador enviando \n\nimediatamente para a aplica\u00e7\u00e3o, que atualizou os seus campos de dados (Figura 6.5). \n\n \n\n \n\nFigura 6.5 - Dois controladores ligados ao barramento \n\nO teste seguinte foi o de desligar o microcontrolador com o n\u00famero identificador 2, \n\ncuja altera\u00e7\u00e3o se encontrou rapidamente vis\u00edvel na Figura 6.6. \n\n \n\n \n\nFigura 6.6 - Remo\u00e7\u00e3o do controlador 2 \n\nPor \u00faltimo alterou-se o n\u00famero identificador do controlador 1, assim como a \n\ntemperatura de funcionamento e o poder de queima, desligando-se logo ap\u00f3s o \n\ngateway. Assim, que a liga\u00e7\u00e3o foi restabelecida, as altera\u00e7\u00f5es solicitadas foram \n\nobservadas no campo de dados destinado para o efeito (Figura 6.7). \n\n\n\n88 \n\n \n\n \n\nFigura 6.7 - Altera\u00e7\u00e3o dos par\u00e2metros do controlador 1 \n\nConclui-se que a comunica\u00e7\u00e3o CAN estabelecida entre controladores se d\u00e1 com \n\nsucesso e funciona como pretendido. \n\n6.4 CONTROLADOR EM AMBIENTE REAL \n\nCom o objetivo de validar a m\u00e1quina de estados, as interfaces de atua\u00e7\u00e3o e sensores, \n\nassim como a comunica\u00e7\u00e3o s\u00e9rie, o controlador desenvolvido foi testado na empresa \n\nECOAMA, mais concretamente no recuperador de calor H\u00e9stia (Figura 6.8 \u2013 aparelho \n\ndo lado direito com tons de vermelho). \n\n \n\n \n\nFigura 6.8 - Controlador em teste nas instala\u00e7\u00f5es da ECOAMA \n\nDepois de conectados todos os atuadores e sensores do aparelho \u00e0 placa do \n\ncontrolador, ligou-se ao PC (via RS232 com conversor USB) que corria um terminal de \n\ndados. Inicialmente, o estado do sistema \u00e9 \u201cInativo\u201d, tendo-se medido uma \n\ntemperatura ambiente de 24,6\u00baC. Antes de se ligar o processo de aquecimento, \n\n\n\n89 \n\n \n\nselecionou-se a temperatura desejada para 30\u00baC, de forma a colocar o n\u00edvel de \n\nqueima no m\u00e1ximo (n\u00edvel 5). Pressionado o bot\u00e3o \u201cSTART\u201d do LCD, o processo \n\niniciou-se e a m\u00e1quina de estados transitou para o estado de \u201cIgni\u00e7\u00e3o\u201d como previsto, \n\ncome\u00e7ando a visualizar-se os valores de temperatura medidos no terminal de dados \n\ndo PC, de 5 em 5 segundos.  \n\nNo Gr\u00e1fico 6.12 pode ser vista a evolu\u00e7\u00e3o da temperatura ambiente, dos gases de \n\nescape e da placa durante os cerca de 27 minutos de teste. \n\n \n\n \n\nGr\u00e1fico 6.12 - Evolu\u00e7\u00e3o das temperaturas ao longo do processo \n\nPassados pouco menos de 5 minutos desde o in\u00edcio do processo, verificou-se uma \n\nqueda da temperatura dos gases de escape, que \u00e9 explicada por uma falha na liga\u00e7\u00e3o \n\ndo termopar \u00e0 placa. Restabelecida a liga\u00e7\u00e3o, a temperatura voltou rapidamente a \n\nsubir, ultrapassando os 60\u00baC cerca de 1 minuto depois e transitando de estado para \n\n\u201cQueima\u201d. Este estado manteve-se durante apenas 4 minutos, uma vez que o n\u00edvel de \n\nqueima m\u00e1ximo, a que o recuperador se encontrava, tinha programado que o motor de \n\nalimenta\u00e7\u00e3o rodasse ininterruptamente durante o seu per\u00edodo de trabalho, o que fez \n\ncom que o queimador ficasse com uma grande quantidade de pellets para incinerar, \n\naumentando ainda mais a chama e consequentemente, o calor no seu interior. \n\nUltrapassando os 150\u00baC, que foi a temperatura que ficou estabelecida como sendo a \n\ntemperatura m\u00e1xima de funcionamento, o controlador for\u00e7ou a transi\u00e7\u00e3o de estado \n\npara \u201cExtin\u00e7\u00e3o\u201d, desligando o motor de alimenta\u00e7\u00e3o e colocando os ventiladores \n\nambiente e de gases a rodar ao m\u00e1ximo da velocidade para expulsar o mais depressa \n\nposs\u00edvel o calor no interior do aparelho. \n\nAo longo do teste, a temperatura ambiente chegou aos 26.7\u00baC, enquanto a \n\ntemperatura da placa, como verificado anteriormente, subiu continuamente, at\u00e9 aos \n\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\n120\n\n140\n\n160\n\n180\n\n0 5 10 15 20 25 30\n\nT\ne\n\nm\np\n\ne\nra\n\ntu\nra\n\n (\n\u00baC\n\n)\n\nTempo (min)\n\nT. Ambiente\n\nT. Placa\n\nT. Gases de\nEscape\n\nQueima Igni\u00e7\u00e3o Extin\u00e7\u00e3o Inativa \n\n\n\n90 \n\n \n\n36.7\u00baC. O estado de \u201cObserva\u00e7\u00e3o\u201d foi planeado para n\u00e3o ser atingido, dado o curto \n\ntempo dispon\u00edvel para a realiza\u00e7\u00e3o do teste, comparado com o tempo necess\u00e1rio para \n\nse atingir a temperatura desejada, a n\u00e3o ser que se tivesse considerado um diferencial \n\npequeno. \n\nDurante o processo, foram tiradas algumas fotografias \u00e0 chama presente no \n\nqueimador, em fun\u00e7\u00e3o do estado do processo, (Figuras 6.9, 6.10, 6.11 e 6.12) que \n\npodem ser visualizadas abaixo. \n\n \n\n \n\nFigura 6.9 - Chama do queimador na fase de \n\n\u201cIgni\u00e7\u00e3o\u201d \n\n \n\nFigura 6.10 - Chama do queimador no in\u00edcio \n\nda fase de \u201cQueima\u201d \n\n \n\nFigura 6.11 - Chama do queimador no in\u00edcio \n\nda fase de \u201cExtin\u00e7\u00e3o\u201d \n\n \n\nFigura 6.12 - C\u00e2mara de combust\u00e3o \n\nfinalizado o processo de aquecimento \n\nConclui-se que o controlador possui uma m\u00e1quina de estados funcional e que as \n\ninterfaces dos atuadores e dos sensores se encontram projetadas corretamente.  \n\n\n\n91 \n\n \n\nCap\u00edtulo 7 CONCLUS\u00d5ES \n\nNo \u00e2mbito do trabalho realizado, foi conseguido um consider\u00e1vel avan\u00e7o em rela\u00e7\u00e3o \n\nao controlador anteriormente concebido, o que permite aproxim\u00e1-lo de um prot\u00f3tipo \n\nfinal. \n\nAs interfaces dos sensores foram melhoradas, como a do termopar, cujo filtro passa-\n\nbaixo necessitava de redimensionamento, uma vez que a sua elevada resist\u00eancia \n\nimpedia a entrada da ADC de amostrar corretamente o valor de tens\u00e3o presente \u00e0 \n\nsa\u00edda do mesmo. (Figuras 3.14 e 3.15). A medi\u00e7\u00e3o da temperatura dos gases de \n\nescape foi dividida em dois tro\u00e7os, em vez de apenas um, tendo em conta a larga \n\ngama de temperaturas que se pretendeu medir. Este sensor deve ser cuidadosamente \n\nligado \u00e0 placa para evitar erros grosseiros na medi\u00e7\u00e3o da temperatura, como \n\naconteceu na fase de \u201cIgni\u00e7\u00e3o\u201d do teste do controlador em ambiente real (Gr\u00e1fico \n\n6.12). O sensor de temperatura ambiente apenas era utilizado para medir \n\ntemperaturas entre 10\u00baC e 30\u00baC e neste momento mede entre -3\u00baC e 60\u00baC. A \n\nresolu\u00e7\u00e3o e precis\u00e3o do processo de medida das temperaturas cumprem os requisitos, \n\napesar de ultrapassarem ligeiramente, para temperaturas relativamente altas medidas \n\npela NTC. A temperatura medida por este sensor segue um c\u00e1lculo polinomial de \n\nordem cinco, o que acaba por influenciar a resolu\u00e7\u00e3o em fun\u00e7\u00e3o da temperatura que \n\nse pretende medir. Um processo de lineariza\u00e7\u00e3o da sua resposta resolveria, em \n\nprinc\u00edpio, esta pequena lacuna. \n\nA temperatura da placa apresenta o inconveniente de aumentar consideravelmente \n\ndurante os primeiros 20/30 minutos em que se encontra ligado, devido ao aquecimento \n\ndo regulador de tens\u00e3o de 5V. Este acontecimento pode levar \u00e0 diminui\u00e7\u00e3o do tempo \n\nde opera\u00e7\u00e3o do pr\u00f3prio chip, aconselhando-se a resolu\u00e7\u00e3o do problema. \n\nA \u00e1rea ocupada pela placa do controlador desenvolvido \u00e9 inferior relativamente \u00e0 \n\nvers\u00e3o anterior e possui um aspeto mais convidativo e organizado. \n\nA utiliza\u00e7\u00e3o de uma RTC, al\u00e9m de permitir um armazenamento da data e hora atual, \n\npermitiu o armazenamento permanente de par\u00e2metros, apesar do seu espa\u00e7o de \n\nendere\u00e7amento ser reduzido. Num aprimoramento deste controlador, essa limita\u00e7\u00e3o \n\ndeve ser eliminada, pois o n\u00famero de par\u00e2metros do sistema pode chegar a ser \n\nelevado. \n\nA funcionalidade de programa\u00e7\u00e3o do crono termostato foi implementada com sucesso, \n\napesar de contemplar apenas agendamento di\u00e1rio, com sele\u00e7\u00e3o da hora e minuto, \n\n\u00fanica e exclusivamente. A programa\u00e7\u00e3o semanal pode ser um aspeto perfeitamente \n\nexig\u00edvel por um cliente e deve, por isso, ser tida em conta numa pr\u00f3xima vers\u00e3o. \n\n\n\n92 \n\n \n\nA funcionalidade preditiva tem a mesma limita\u00e7\u00e3o e seguiu uma abordagem simplista \n\ndo modelo de uma casa, que se justifica nesta fase de desenvolvimento. O seu \n\nfuncionamento foi validado, junto do engenheiro respons\u00e1vel, com sucesso no \n\ndecorrer das v\u00e1rias desloca\u00e7\u00f5es \u00e0s instala\u00e7\u00f5es da ECOAMA. \n\nA coopera\u00e7\u00e3o entre controladores foi igualmente validada, no que diz respeito \u00e0 \n\ncomunica\u00e7\u00e3o, n\u00e3o tendo sido implementado o seu funcionamento em termos de \n\nm\u00e1quina de estados, visto ser necess\u00e1rio a produ\u00e7\u00e3o de uma outra placa igual \u00e0 \n\ndesenvolvida, al\u00e9m de todo um outro conjunto de sensores e atuadores. Assim, \n\napenas se verificou a liga\u00e7\u00e3o de dois microcontroladores semelhantes \u00e0 placa \n\ncorrendo o mesmo programa, visualizando-se o resultado na aplica\u00e7\u00e3o PC. \n\nDe salientar que, neste trabalho, o controlo da combust\u00e3o n\u00e3o \u00e9 muito eficaz (malha \n\naberta), baseando-se apenas na temperatura dos gases de escape, sem ter em conta \n\no estado da chama, da press\u00e3o do ar nem da concentra\u00e7\u00e3o de oxig\u00e9nio. Apesar de \n\nincrementar o seu custo total, s\u00e3o informa\u00e7\u00f5es que o controlador deve possuir para \n\naumentar o desempenho e efici\u00eancia do sistema. \n\nRelativamente \u00e0 interface com o utilizador, a sua conce\u00e7\u00e3o foi criada tendo em conta a \n\nopini\u00e3o e prefer\u00eancias da ECOAMA, resultando em vinte e dois ecr\u00e3s dispon\u00edveis para \n\nf\u00e1cil navega\u00e7\u00e3o por parte do utilizador e do pr\u00f3prio fabricante. \n\nComo acrescento a esta interface, foi desenvolvida uma aplica\u00e7\u00e3o PC em JAVA que \n\npudesse substituir o funcionamento do LCD, em caso de avaria, e ajudar na \n\nmonitoriza\u00e7\u00e3o do processo de aquecimento. O seu aspeto est\u00e9tico n\u00e3o foi a maior \n\npreocupa\u00e7\u00e3o, por isso justifica-se, em abordagens futuras, o seu aprimoramento. \n\n7.1 TRABALHO FUTURO \n\nEm suma, s\u00e3o v\u00e1rios os aspetos que podem ser melhorados e acrescentados, \n\nvalorizando o controlador desenvolvido: \n\n \n\n? Redu\u00e7\u00e3o das dimens\u00f5es da placa do controlador (compacta\u00e7\u00e3o) \n\nA utiliza\u00e7\u00e3o de componentes SMD principalmente nos circuitos de baixa pot\u00eancia, \n\nassim como um transformador de menores dimens\u00f5es ajudar\u00e3o de forma \n\ndeterminante a cumprir esta melhoria. \n\n \n\n? Generaliza\u00e7\u00e3o do controlador para caldeiras e queimadores, al\u00e9m do \n\nrecuperador de calor \n\n\n\n93 \n\n \n\nNo \u00e2mbito desta disserta\u00e7\u00e3o, apenas foi desenvolvido e testado o controlador para \n\nfuncionar sobre um recuperador de calor. Apesar das poucas diferen\u00e7as ao n\u00edvel do \n\nfuncionamento, este deve poder ser utilizado nos restantes aparelhos identificados. \n\n \n\n \n\n? Alargamento do espa\u00e7o de endere\u00e7amento para armazenamento de \n\npar\u00e2metros (EEPROM externa ou Flash RAM do PIC32) \n\nO n\u00famero de par\u00e2metros deste tipo de sistemas poder\u00e1 ser elevado e diferir entre \n\ncaldeiras, recuperadores de calor e queimadores, o que a certa altura ultrapassar\u00e1, a \n\nmem\u00f3ria dispon\u00edvel na RTC. \n\n \n\n? Teste e implementa\u00e7\u00e3o do circuito de acondicionamento para sensor de \n\nchama \n\nA entrada do controlador desenvolvido para sensor de chama n\u00e3o foi projetada, mas \n\nem termos de efici\u00eancia ser\u00e1 um avan\u00e7o relevante para monitoriza\u00e7\u00e3o da combust\u00e3o. \n\n \n\n? Introdu\u00e7\u00e3o de uma interface para sensor de oxig\u00e9nio (lambda) \n\nA redu\u00e7\u00e3o de emiss\u00f5es, assim como a otimiza\u00e7\u00e3o da combust\u00e3o ser\u00e3o melhorados \n\nconsideravelmente com a introdu\u00e7\u00e3o deste sensor. \n\n \n\n? Resolu\u00e7\u00e3o do problema do consider\u00e1vel aumento da temperatura da \n\nplaca do controlador durante o tempo em que se encontra ligado \n\nUma vez que \u00e0 entrada do regulador de tens\u00e3o de 5V se encontra uma diferen\u00e7a de \n\npotencial relativamente elevada, ser\u00e1 necess\u00e1rio utilizar um transformador com uma \n\nrela\u00e7\u00e3o de transforma\u00e7\u00e3o superior, utilizar uma resist\u00eancia para dissipa\u00e7\u00e3o de calor a \n\nmontante ou um dissipador de maiores dimens\u00f5es. \n\n \n\n? Acrescento de programa\u00e7\u00e3o semanal do processo de aquecimento elativa \n\nao crono termostato e ao preditor \n\nCertas pessoas preferem definir no in\u00edcio da semana o agendamento do processo de \n\naquecimento para os restantes dias. Nestas circunst\u00e2ncias, ser\u00e1 necess\u00e1rio incluir um \n\ncampo para sele\u00e7\u00e3o do dia da semana. \n\n \n\n? Melhoramento est\u00e9tico e acrescento de funcionalidades da aplica\u00e7\u00e3o PC \n\nNem todas as funcionalidades desenvolvidas podem ser, neste momento, testadas na \n\naplica\u00e7\u00e3o PC, al\u00e9m de apenas funcionar em recuperadores de calor. \n\n\n\n94 \n\n \n\n? Elabora\u00e7\u00e3o de um modelo mais complexo e robusto de uma casa \n\nNo que diz respeito \u00e0 predi\u00e7\u00e3o, pode interessar a elabora\u00e7\u00e3o de um modelo de uma \n\ncasa (ou apenas de um compartimento) mais complexo, onde entrem as principais \n\nperturba\u00e7\u00f5es a ele associadas, assim como os fatores que contribuem de forma mais \n\ndeterminante para o estabelecimento da temperatura interior. \n\nAo longo do dia e de dia para dia a temperatura de um compartimento sofre ligeiras \n\naltera\u00e7\u00f5es, descendo e subindo repetidamente. Isto deve-se ao balan\u00e7o t\u00e9rmico \n\nproporcionado pelos fluxos de ar que sobre ele circulam: o fluxo de calor que entra no \n\ncompartimento e o fluxo de calor que sai do mesmo. A temperatura exterior tem, \n\nassim, uma grande influ\u00eancia. \n\nNeste trabalho dever\u00e3o ser identificados os modelos do aquecedor e da \n\ncasa/compartimento. \n\nA Figura 7.1 descreve um exemplo de um diagrama de blocos de um sistema de \n\ncontrolo da temperatura interior de uma casa. \n\n \n\n \n\nFigura 7.1 \u2013 Exemplo de um SC da temperatura interior de uma casa [62] \n\n  \n\n\n\n95 \n\n \n\nREFER\u00caNCIAS \n\n1. ECOAMA. Site da Empresa [Internet]. 2013; Available from: \n\nhttp://www.ecoama.pt/portugues.html. \n\n2. European Biomass Association. A Pellet Road Map for Europe [Internet]. 2008; \n\nAvailable from: http://www.aebiom.org/IMG/pdf/Pellet_Roadmap_final.pdf. \n\n3. Comission of the European Communities. Biomass action plan [Internet]. 2005; \n\nAvailable from: \n\nhttp://ec.europa.eu/energy/res/biomass_action_plan/doc/2005_12_07_comm_bio\n\nmass_action_plan_en.pdf. \n\n4. Edenhofer, O., et al. Renewable Energy Sources and Climate Change Mitigation - \n\nSpecial Report of the Intergovernmental Panel on Climate Change [Internet]. 2012; \n\nAvailable from: http://srren.ipcc-wg3.de/report/IPCC_SRREN_Full_Report.pdf. \n\n5. Tr\u00f8mborga, E., et al., Economic sustainability for wood pellets production \u2013 A \n\ncomparative study between Finland, Germany, Norway, Sweden and the US. \n\nBiomass and Bioenergy, 2013. 57: p. 68-77. \n\n6. Kang, S., et al., Development of an air fuel control system for a domestic wood \n\npellet boiler. Journal of Mechanical Science and Technology, 2013. 27(6): p. 1701-\n\n1706. \n\n7. Oliveira, C. Futuro da Biomassa no Brasil - Potencial de Biomassa Florestal e \n\nIndustrial e o Desenvovimento de Projetos Industriais Sustent\u00e1veis [Internet]. \n\n2014; Available from: \n\nhttp://www.porthuseventos.com.br/congresso_biomassa/Celso_Oliveira.pdf. \n\n8. Alakangas, E. and P. Paju. Wood Pellets in Finland - technology, economy and \n\nmarket [Internet]. 2002; Available from: \n\nhttp://www.ateap.cz/new/Pelety_Finsko.pdf. \n\n9. Curran Renewable Energy. Premium Wood Pellet Fuel [Internet]. 2014; Available \n\nfrom: http://www.curranpellets.com/documents/future-of-american-\n\nenergy.pdf#!premium-wood-pellets/cisy. \n\n10. Massachusetts Division of Energy Resources. Wood Pellet Heating - A Reference \n\non Wood Pellet Fuels &amp; Technology for Small Commercial &amp; Institutional Systems \n\n(Guidebook) [Internet]. 2007; Available from: \n\nhttp://www.biomasscenter.org/pdfs/DOER_Pellet_Guidebook.pdf. \n\n11. Plumbset UK LDT. Carbon Neutral Wood Pellets [Internet]. 2014; Available from: \n\nhttp://www.plumbset.co.uk/biomass-boilers.php. \n\n12. Wood Pellet Line. Rotary Drum dryer [Internet]. Available from: \n\nhttp://www.woodpelletline.com/Rotary-Drum-Dryers.htm. \n\nhttp://www.ecoama.pt/portugues.html\nhttp://www.aebiom.org/IMG/pdf/Pellet_Roadmap_final.pdf\nhttp://ec.europa.eu/energy/res/biomass_action_plan/doc/2005_12_07_comm_biomass_action_plan_en.pdf\nhttp://ec.europa.eu/energy/res/biomass_action_plan/doc/2005_12_07_comm_biomass_action_plan_en.pdf\nhttp://srren.ipcc-wg3.de/report/IPCC_SRREN_Full_Report.pdf\nhttp://www.porthuseventos.com.br/congresso_biomassa/Celso_Oliveira.pdf\nhttp://www.ateap.cz/new/Pelety_Finsko.pdf\nhttp://www.curranpellets.com/documents/future-of-american-energy.pdf#!premium-wood-pellets/cisy\nhttp://www.curranpellets.com/documents/future-of-american-energy.pdf#!premium-wood-pellets/cisy\nhttp://www.biomasscenter.org/pdfs/DOER_Pellet_Guidebook.pdf\nhttp://www.plumbset.co.uk/biomass-boilers.php\nhttp://www.woodpelletline.com/Rotary-Drum-Dryers.htm\n\n\n96 \n\n \n\n13. Philmec. Flatbed [Internet]. 2002; Available from: \n\nhttp://www.philmech.gov.ph/default.asp?page=photos&amp;hd=&amp;mcols=7&amp;Path=image\n\ns\\photos\\Postharvest%20Facilities/FLATBED. \n\n14. PelHeat. The Beginners Guide To Pellet Production [Internet]. 2013; Available \n\nfrom: \n\nhttp://www.weedcenter.org/mrwc/docs/The_Beginners_Guide_To_Making_Pellets.\n\npdf. \n\n15. Pellet Process. Manufacturing Process [Internet]. 2014; Available from: \n\nhttp://www.pelletprocess.de/?page_id=18&amp;lang=en. \n\n16. Pieter D. Kofman. The production of wood pellets [Internet]. 2007; Available from: \n\nhttp://www.woodenergy.ie/media/woodenergy/content/faq/The%20production%20o\n\nf%20wood%20pellets.pdf. \n\n17. Ciolkosz, D. Renewable and Alternative Energy Fact Sheet [Internet]. 2009. \n\n18. Audigane, N., et al. European Pellet Report. 2012; Available from: \n\nhttp://www.enplus-pellets.eu/wp-content/uploads/2013/11/D2.2bis-European-\n\npellet-report.pdf. \n\n19. Fiedler, F., The state of the art of small-scale pellet-based heating systems and \n\nrelevant regulations in Sweden, Austria and Germany. Renewable and Sustainable \n\nEnergy Reviews, 2004. 8(3): p. 201-221. \n\n20. Alakangas, E. New European Pellet Standards [Internet]. 2010; Available from: \n\nhttp://www.wsed.at/fileadmin/redakteure/WSED/2010/download_presentations/Ala\n\nkangas_paper_neu.pdf. \n\n21. RIKA Pellets Stoves. RIKA Brochure [Internet]. 2014; Available from: \n\nhttp://www.rika.at/en/katalog-bestellen/. \n\n22. Salar Lareiras. Recuperador Calor Damasco NC Bio Bronpi [Internet]. Available \n\nfrom: http://www.salar-lareiras.pt/catalogo-produtos/bio-bronpi/recuperadores-de-\n\ncalor-pellets/biobr-damasco-nc-recuperador-calor-damasco-nc-bio-bronpi.html. \n\n23. Wood Pecker Energy. Wood Pellet Boiler Systems [Internet]. 2010; Available from: \n\nhttp://rftr.co.uk/downloads/Woodpecker-Brochure.pdf. \n\n24. Electronics, A. Fumis LevelTronic - Biomass Level Sensor (Info Sheet) [Internet]. \n\n2011; Available from: http://www.fumis.si/catalog-\n\ndocuments/INFO_Sheet_Fumis_LevelTronic_eng_WEB.pdf. \n\n25. Obernberger, I. State-of-the-art of small-scale biomass combustion in boilers \n\n[Internet]. 2008; Available from: \n\nhttp://www.ieabcc.nl/workshops/task32_Dublin_SSC/05%20Obernberger.pdf. \n\n26. Dias, J., M. Costa, and J.L.T. Azevedo, Test of a small domestic boiler using \n\ndifferent pellets. Biomass and Bioenergy, 2004. 27(6): p. 531-539. \n\nhttp://www.philmech.gov.ph/default.asp?page=photos&amp;hd=&amp;mcols=7&amp;Path=images/photos/Postharvest%20Facilities/FLATBED\nhttp://www.philmech.gov.ph/default.asp?page=photos&amp;hd=&amp;mcols=7&amp;Path=images/photos/Postharvest%20Facilities/FLATBED\nhttp://www.weedcenter.org/mrwc/docs/The_Beginners_Guide_To_Making_Pellets.pdf\nhttp://www.weedcenter.org/mrwc/docs/The_Beginners_Guide_To_Making_Pellets.pdf\nhttp://www.pelletprocess.de/?page_id=18&amp;lang=en\nhttp://www.woodenergy.ie/media/woodenergy/content/faq/The%20production%20of%20wood%20pellets.pdf\nhttp://www.woodenergy.ie/media/woodenergy/content/faq/The%20production%20of%20wood%20pellets.pdf\nhttp://www.enplus-pellets.eu/wp-content/uploads/2013/11/D2.2bis-European-pellet-report.pdf\nhttp://www.enplus-pellets.eu/wp-content/uploads/2013/11/D2.2bis-European-pellet-report.pdf\nhttp://www.wsed.at/fileadmin/redakteure/WSED/2010/download_presentations/Alakangas_paper_neu.pdf\nhttp://www.wsed.at/fileadmin/redakteure/WSED/2010/download_presentations/Alakangas_paper_neu.pdf\nhttp://www.rika.at/en/katalog-bestellen/\nhttp://www.salar-lareiras.pt/catalogo-produtos/bio-bronpi/recuperadores-de-calor-pellets/biobr-damasco-nc-recuperador-calor-damasco-nc-bio-bronpi.html\nhttp://www.salar-lareiras.pt/catalogo-produtos/bio-bronpi/recuperadores-de-calor-pellets/biobr-damasco-nc-recuperador-calor-damasco-nc-bio-bronpi.html\nhttp://rftr.co.uk/downloads/Woodpecker-Brochure.pdf\nhttp://www.fumis.si/catalog-documents/INFO_Sheet_Fumis_LevelTronic_eng_WEB.pdf\nhttp://www.fumis.si/catalog-documents/INFO_Sheet_Fumis_LevelTronic_eng_WEB.pdf\nhttp://www.ieabcc.nl/workshops/task32_Dublin_SSC/05%20Obernberger.pdf\n\n\n97 \n\n \n\n27. Windhager. BioWIN 2 -The Pellet Boiler [Internet]. 2014; Available from: \n\nhttp://www.windhager.co.uk/files/4814/0630/0916/BioWIN2_Brochure_01.07.14.pd\n\nf. \n\n28. Fiedler, F., Combined Solar and Pellet Heating Systems - Study of Energy Use \n\nand CO-Emissions. Malardalen University 2006: p. 1-98. \n\n29. Kedel. A fully-automated, self-cleaning pellet boiler [Internet]. 2012; Available from: \n\nhttp://www.revisionheat.com/pdfs/kedel-brochure.pdf. \n\n30. Cooke, R. and A. Russell. Procurement Guidelines for Biomass Heating [Internet]. \n\n2007; Available from: http://www.mercia-\n\nenergy.co.uk/Downloads/BiomassGuidelines07.pdf. \n\n31. TEM. Biomass Controllers [Internet]. Available from: \n\nhttp://www.tem.ch/Bilder/Service_Dokumente/TEM_Biomass_eng.pdf. \n\n32. Tech. Microprocessor Temperature Regulators [Internet]. 2009; Available from: \n\nhttp://santehnika.lv/imgs/files/Tech%20katalogas%5Ben%5D.pdf. \n\n33. Naturela Electronics. NPBC-V5 - A high class pellet boiler and burner controller \n\n[Internet]. 2014; Available from: http://www.naturela-bg.com/en/product/47-0-npbc-\n\nv5-universalen-kontroler-za-upravlenie-na-visok-klas-peletni-gorelki-i-kotli/. \n\n34. ATech Electronics. Fumis ALPHA - Superior Combustion Control Technology (Info \n\nSheet) [Internet]. Available from: http://www.fumis.si/catalog-\n\ndocuments/INFO_Sheet_Fumis_ALPHA_eng_WEB.pdf. \n\n35. Moura, N., Controlador e Device Drivers para um Recuperador de Calor a Pellets \n\n(Tese de Mestrado). Universidade de Aveiro, 2013. \n\n36. Olimex Ltd. PIC32-Maxi-Web: User`s Manual [Internet]. 2013; Available from: \n\nhttps://www.olimex.com/Products/PIC/Development/PIC32-MAXI-\n\nWEB/resources/PIC32-MAXI-WEB.pdf. \n\n37. Mutambara, A.G.O., Design and Analysis of Control Systems1999: Library of \n\nCongress  \n\n38. Bishop, R.H., Mechatronic Systems, Sensors, and Actuators: Fundamentals and \n\nModeling, ed. C. Press2007. \n\n39. Janocha, H., Actuators: Basics and Applications2004: Springer Science &amp; \n\nBusiness Media. \n\n40. Probes, S. Probes for Temperature Measurement - Catalog [Internet]. 2014; \n\nAvailable from: http://sacet-\n\nprobes.com/cms/images/immagini_sacet/DOWNLOAD/CATALOG.pdf. \n\n41. Thermometrics. Type K Thermocouple [Internet]. 2013; Available from: \n\nhttp://www.thermometricscorp.com/thermocouple.html. \n\nhttp://www.windhager.co.uk/files/4814/0630/0916/BioWIN2_Brochure_01.07.14.pdf\nhttp://www.windhager.co.uk/files/4814/0630/0916/BioWIN2_Brochure_01.07.14.pdf\nhttp://www.revisionheat.com/pdfs/kedel-brochure.pdf\nhttp://www.mercia-energy.co.uk/Downloads/BiomassGuidelines07.pdf\nhttp://www.mercia-energy.co.uk/Downloads/BiomassGuidelines07.pdf\nhttp://www.tem.ch/Bilder/Service_Dokumente/TEM_Biomass_eng.pdf\nhttp://santehnika.lv/imgs/files/Tech%20katalogas%5Ben%5D.pdf\nhttp://www.naturela-bg.com/en/product/47-0-npbc-v5-universalen-kontroler-za-upravlenie-na-visok-klas-peletni-gorelki-i-kotli/\nhttp://www.naturela-bg.com/en/product/47-0-npbc-v5-universalen-kontroler-za-upravlenie-na-visok-klas-peletni-gorelki-i-kotli/\nhttp://www.fumis.si/catalog-documents/INFO_Sheet_Fumis_ALPHA_eng_WEB.pdf\nhttp://www.fumis.si/catalog-documents/INFO_Sheet_Fumis_ALPHA_eng_WEB.pdf\nhttp://www.olimex.com/Products/PIC/Development/PIC32-MAXI-WEB/resources/PIC32-MAXI-WEB.pdf\nhttp://www.olimex.com/Products/PIC/Development/PIC32-MAXI-WEB/resources/PIC32-MAXI-WEB.pdf\nhttp://sacet-probes.com/cms/images/immagini_sacet/DOWNLOAD/CATALOG.pdf\nhttp://sacet-probes.com/cms/images/immagini_sacet/DOWNLOAD/CATALOG.pdf\nhttp://www.thermometricscorp.com/thermocouple.html\n\n\n98 \n\n \n\n42. Texas Instruments. LM135/LM235/LM335, LM135A/LM235A/LM335A Precision \n\nTemperature Sensors (Datasheet). \n\n43. Delta Electronics Online Shop. LM335 Temperature Sensor [Internet]. 2014; \n\nAvailable from: http://de-\n\nonlineshop.nl/index.php?route=product/product&amp;product_id=778. \n\n44. Rauschert. High-temperature heating elements [Internet]. 2012; Available from: \n\nhttp://www.rauschert.de/cms/upload/pdf/sonstige_Dokumente/Produktbroschre_H\n\nTH_GB.pdf. \n\n45. BCZ Elettromeccanica S.N.C. Modello 509 [Internet]. 2005; Available from: \n\nhttp://bcz.it/. \n\n46. AACO Manufacturing. Fume Extrators for Pellet Stoves [Internet]. 2005; Available \n\nfrom: http://www.aaco.it/j/materiale/prodotti/estrattori/AACO_ST20-73.pdf. \n\n47. AACO Manufacturing. Fume Extractors and Ventilators for Hot Air Generators \n\n[Internet]. 2005; Available from: \n\nhttp://www.aaco.it/j/materiale/prodotti/ventilatori/AACO_centrifugal.pdf. \n\n48. Maxim Integrated. DS1307 (Datasheet). 2008. \n\n49. Surplustronics shop. DS1307 Real Time Clock RTC [Internet]. Available from: \n\nhttp://www.surplustronics.co.nz/products/1786-ds1307-real-time-clock-rtc. \n\n50. Redfish Sensors. NTC Thermistor - Resistance-Temperature Characteristics \n\n[Internet]. Available from: http://www.redfishsensors.com/PDFs/R805-103F-3435-\n\nC.pdf. \n\n51. Texas Instruments. MOC3020 through MOC3023 Optocouplers/Optoisolators \n\n(Datasheet). 1998. \n\n52. Olimex Ltd. PIC32-T795 development board User\u2019s Manual [Internet]. 2012; \n\nAvailable from: https://www.olimex.com/Products/Duino/PIC32/PIC32-\n\nT795/resources/PIC32-T795_um.pdf. \n\n53. Digi-key Corporation Online Shop. LCD Display NHD-3.5-320240MF-ATXL#-1 \n\n[Internet]. Available from: http://www.digikey.com/product-detail/en/NHD-3.5-\n\n320240MF-ATXL%23-1/NHD-3.5-320240MF-ATXL%23-1-ND/2165878. \n\n54. Melo, A.P., Teoria dos Sistema de Controlo Lineares2010: Universidade de \n\nAveiro. \n\n55. Wagner, F., et al., Modeling Software with Finite State Machines - A Pratical \n\nApproach2006: Auerbach. \n\n56. Feng, T., et al., System Design, Modeling, and Simulation using Ptolemy II - \n\nChapter 62014: Ptolemy. \n\n57. Pedreiras, P. StateCharts - Especifica\u00e7\u00e3o, Modela\u00e7\u00e3o e Projecto de Sistemas \n\nEmbutidos (Universidade de Aveiro). 2009; Available from: \n\nhttp://de-onlineshop.nl/index.php?route=product/product&amp;product_id=778\nhttp://de-onlineshop.nl/index.php?route=product/product&amp;product_id=778\nhttp://www.rauschert.de/cms/upload/pdf/sonstige_Dokumente/Produktbroschre_HTH_GB.pdf\nhttp://www.rauschert.de/cms/upload/pdf/sonstige_Dokumente/Produktbroschre_HTH_GB.pdf\nhttp://bcz.it/\nhttp://www.aaco.it/j/materiale/prodotti/estrattori/AACO_ST20-73.pdf\nhttp://www.aaco.it/j/materiale/prodotti/ventilatori/AACO_centrifugal.pdf\nhttp://www.surplustronics.co.nz/products/1786-ds1307-real-time-clock-rtc\nhttp://www.redfishsensors.com/PDFs/R805-103F-3435-C.pdf\nhttp://www.redfishsensors.com/PDFs/R805-103F-3435-C.pdf\nhttp://www.olimex.com/Products/Duino/PIC32/PIC32-T795/resources/PIC32-T795_um.pdf\nhttp://www.olimex.com/Products/Duino/PIC32/PIC32-T795/resources/PIC32-T795_um.pdf\nhttp://www.digikey.com/product-detail/en/NHD-3.5-320240MF-ATXL%23-1/NHD-3.5-320240MF-ATXL%23-1-ND/2165878\nhttp://www.digikey.com/product-detail/en/NHD-3.5-320240MF-ATXL%23-1/NHD-3.5-320240MF-ATXL%23-1-ND/2165878\n\n\n99 \n\n \n\nhttp://ppedreiras.av.it.pt/resources/empse0910/praticas/empse-statecharts-\n\nhandson.pdf. \n\n58. Stringhman, G., Hardware/Firmware Interface Design - Best Practices for \n\nImproving Embedded System Development2010: Elsevier. \n\n59. Industries, M. Type K Thermocouple Calibration - Efficient voltage to temperature \n\nconversion and temperature measurement using rational polynomial functions \n\n[Internet]. Available from: http://www.mosaic-industries.com/embedded-\n\nsystems/microcontroller-projects/temperature-measurement/thermocouple/type-k-\n\ncalibration-table. \n\n60. National Institute of Standards and Technology (NIST)  ITS-90 Table for type K \n\nthermocouple [Internet]. 1999; Available from: \n\nhttp://srdata.nist.gov/its90/download/type_k.tab. \n\n61. Fonseca, P., Sistema de Instrumenta\u00e7\u00e3o Eletr\u00f3nica2011: Universidade de Aveiro. \n\n62. Mota, A., Modelos de Sistemas - Vers\u00e3o Beta 0.1. Departamento de Electr\u00f3nica \n\nTelecomunica\u00e7\u00f5es e Inform\u00e1tica - Universidade de Aveiro, 2013. \n\n  \n\nhttp://ppedreiras.av.it.pt/resources/empse0910/praticas/empse-statecharts-handson.pdf\nhttp://ppedreiras.av.it.pt/resources/empse0910/praticas/empse-statecharts-handson.pdf\nhttp://www.mosaic-industries.com/embedded-systems/microcontroller-projects/temperature-measurement/thermocouple/type-k-calibration-table\nhttp://www.mosaic-industries.com/embedded-systems/microcontroller-projects/temperature-measurement/thermocouple/type-k-calibration-table\nhttp://www.mosaic-industries.com/embedded-systems/microcontroller-projects/temperature-measurement/thermocouple/type-k-calibration-table\nhttp://srdata.nist.gov/its90/download/type_k.tab\n\n\n100 \n\n \n\n \n\n\n\n101 \n\n \n\nANEXOS \n\n \n\nFigura 8.1 - Esquema do recuperador de calor H\u00e9stia (ECOAMA) \n\n\n\n102 \n\n \n\n \n\nFigura 8.2 - Esquema de liga\u00e7\u00e3o da RTC ao microcontrolador \n\n \n\nTens\u00e3o da \nRede\n\nLiga\u00e7\u00e3o aos \nAtuadores\n\nLiga\u00e7\u00e3o aos \nSensores\n\nRTC\n\nCAN\n\nFonte\nde \n\nAlimenta\u00e7\u00e3o\n\nMicrocontroladorUART\n\n \n\nFigura 8.3 - Desenho da PCI do controlador \n\n \n\n\n\n103 \n\n \n\nEndere\u00e7o \nValor por \n\ndefeito \nIdentifica\u00e7\u00e3o do Par\u00e2metro \n\nTipo de \n\nPar\u00e2metro \n\n0x8 10 Per\u00edodo (s) - N\u00edvel 1 \n\nMotor de \n\nalimenta\u00e7\u00e3o \n\n0x9 10 Per\u00edodo (s) - N\u00edvel 2 \n\n0xA 10 Per\u00edodo (s) - N\u00edvel 3 \n\n0xB 10 Per\u00edodo (s) - N\u00edvel 4 \n\n0xC 10 Per\u00edodo (s) - N\u00edvel 5 \n\n0xD 10 Tempo ligado (%) - N\u00edvel 1 \n\n0xE 30 Tempo ligado (%) - N\u00edvel 2 \n\n0xF 50 Tempo ligado (%) - N\u00edvel 3 \n\n0x10 75 Tempo ligado (%) - N\u00edvel 4 \n\n0x11 100 Tempo ligado (%) - N\u00edvel 5 \n\n0x12 60 Tempo ligado I (s) - Igni\u00e7\u00e3o \n\n0x13 20 Per\u00edodo (s) \u2013 Igni\u00e7\u00e3o \n\n0x14 10 Tempo ligado II (%) - Igni\u00e7\u00e3o \n\n0x15 33 Tens\u00e3o (V) \u2013 N\u00edvel 1 \n\nVentilador \n\nambiente \n\n0x16 77 Tens\u00e3o (V) \u2013 N\u00edvel 2 \n\n0x17 121 Tens\u00e3o (V) \u2013 N\u00edvel 3 \n\n0x18 169 Tens\u00e3o (V) \u2013 N\u00edvel 4 \n\n0x19 220 Tens\u00e3o (V) \u2013 N\u00edvel 5 \n\n0x1A 33 Tens\u00e3o (V) \u2013 N\u00edvel 1 \n\nVentilador dos \n\ngases de \n\nescape \n\n0x1B 77 Tens\u00e3o (V) \u2013 N\u00edvel 2 \n\n0x1C 121 Tens\u00e3o (V) \u2013 N\u00edvel 3 \n\n0x1D 169 Tens\u00e3o (V) \u2013 N\u00edvel 4 \n\n0x1E 220 Tens\u00e3o (V) \u2013 N\u00edvel 5 \n\n0x1F 77 Tens\u00e3o (V) - Igni\u00e7\u00e3o \n\n0x20 160 Temperatura m\u00e1xima para os gases de escape (\u00baC) \n\nTemperaturas \n\n0x21 60 Temperatura de transi\u00e7\u00e3o igni\u00e7\u00e3o \u2013 Queima (\u00baC) \n\n0x22 50 Temperatura de transi\u00e7\u00e3o extin\u00e7\u00e3o \u2013 Inativa (\u00baC) \n\n0x23 25 Temperatura desejada (\u00baC) \n\n0x24 10 Limite m\u00e1ximo para temperatura desejada (\u00baC) \n\n0x25 35 Limite m\u00ednimo para temperatura desejada (\u00baC) \n\n0x26 0 Hora de in\u00edcio (hh) \u2013 Programa 1 \n\nCrono \n\ntermostato \n\n \n\n0x27 0 Minuto de In\u00edcio (mm)\u2013 Programa 1 \n\n0x28 0 Hora de fim (hh) \u2013 Programa 1 \n\n0x29 0 Minuto de fim (mm) \u2013 Programa 1 \n\n0x2A 15 Temperatura desejada (\u00baC) \u2013 Programa 1 \n\n0x2B 0 Hora de in\u00edcio (hh) \u2013 Programa 2 \n\n0x2C 0 Minuto de In\u00edcio (mm) \u2013 Programa 2 \n\n0x2D 0 Hora de fim (hh) \u2013 Programa 2 \n\n0x2E 0 Minuto de fim (mm) \u2013 Programa 2 \n\n0x2F 20 Temperatura desejada (\u00baC) \u2013 Programa 2 \n\n0x30 0 Hora de in\u00edcio (hh) \u2013 Programa 3 \n\n0x31 0 Minuto de In\u00edcio (mm) \u2013 Programa 3 \n\n0x32 0 Hora de fim (hh) \u2013 Programa 3 \n\n0x33 0 Minuto de fim (mm) \u2013 Programa 3 \n\n0x34 25 Temperatura desejada (\u00baC) \u2013 Programa 3 \n\n0x35 0 \nIdentificador do programa ativo / Identificador do \n\nestado do crono termostato \n\n0x36 1 N\u00famero Identificador  \n\n\n\n104 \n\n \n\n0x37 40 Temperatura de entrada em funcionamento (\u00baC) Controladores \n\n0x38 3 N\u00edvel de queima \n\n0x39 4 N\u00edvel m\u00e1ximo de queima - \n\n0x3A 123 Palavra-Passe - \n\n0x3B 0 Temperatura inicial (\u00baC) \n \n\nCalibra\u00e7\u00e3o \n0x3C 0 Temperatura final (\u00baC) \n\n0x3D 0 Tempo de calibra\u00e7\u00e3o (min) \n\n0x3E    \n\n0x3F    \n\nTabela 8.1 - Mapeamento dos par\u00e2metros do sistema na mem\u00f3ria da RTC \n\nOrigem Comando A\u00e7\u00e3o despoletada \n\nBot\u00e3o \n\n\"Set\" \n\n\"fd\" O vetor com os par\u00e2metros do motor de alimenta\u00e7\u00e3o \u00e9 atualizado \n\n\"af\" O vetor com os par\u00e2metros do ventilador ambiente \u00e9 atualizado \n\n\"ff\" O vetor com os par\u00e2metros do ventilador de escape \u00e9 atualizado \n\n\u201ctp\u201d O vetor com as temperaturas parametrizadas \u00e9 atualizado \n\n\u201cidgt\u201d \nAtualiza o valor do ID, temperatura e n\u00edvel de queima de \n\nfuncionamento do controlador (gateway) \n\n\u201cidc1t\u201d \nAtualiza o valor do ID, temperatura e n\u00edvel de queima de \n\nfuncionamento do controlador 1 a ele ligado \n\n\u201cidc2t\u201d \nAtualiza o valor do ID, temperatura e n\u00edvel de queima de \n\nfuncionamento do controlador 2 a ele ligado \n\n\u201cidc3t\u201d \nAtualiza o valor do ID, temperatura e n\u00edvel de queima de \n\nfuncionamento do controlador 3 a ele ligado \n\n\u201cidc4t\u201d \nAtualiza o valor do ID, temperatura e n\u00edvel de queima de \n\nfuncionamento do controlador 4 a ele ligado \n\nBot\u00e3o \n\n\"Set \n\ndefault\" \n\n\"fdd\" \nO vetor com os par\u00e2metros do motor de alimenta\u00e7\u00e3o \u00e9 atualizado e \n\nRTC guarda a informa\u00e7\u00e3o \n\n\"afd\" \nO vetor com os par\u00e2metros do ventilador ambiente \u00e9 atualizado e \n\nRTC guarda a informa\u00e7\u00e3o \n\n\"ffd\" \nO vetor com os par\u00e2metros do ventilador de escape \u00e9 atualizado e \n\nRTC guarda a informa\u00e7\u00e3o \n\n\u201ctpd\u201d \nO vetor com as temperaturas parametrizadas \u00e9 atualizado e RTC \n\nguarda a informa\u00e7\u00e3o \n\nTabela 8.2 - Comandos de atualiza\u00e7\u00e3o de par\u00e2metros \n\nOrigem Comando A\u00e7\u00e3o despoletada \n\nBot\u00e3o \n\n\"ON\" \n\n\"f1\" Ligar motor de alimenta\u00e7\u00e3o \n\n\u201ci1\u201d Ligar resist\u00eancia de igni\u00e7\u00e3o \n\n\"a1\" Ligar ventilador ambiente \n\n\"F1\" Ligar ventilador de escape \n\nBot\u00e3o \n\n\"OFF\" \n\n\"f0\" Desligar motor de alimenta\u00e7\u00e3o \n\n\u201ci0\u201d Desligar resist\u00eancia de igni\u00e7\u00e3o \n\n\"a0\" Desligar ventilador ambiente \n\n\"F0\" Desligar ventilador de escape \n\nBot\u00e3o \u201c-\u201d \n\u201ca-\u201c Diminuir tens\u00e3o aplicada ao ventilador ambiente \n\n\u201cF-\u201c Diminuir tens\u00e3o aplicada ao ventilador de escape \n\nBot\u00e3o \u201c+\u201d \n\u201ca+\u201d Aumentar tens\u00e3o aplicada ao ventilador ambiente \n\n\u201cF+\u201d Aumentar tens\u00e3o aplicada ao ventilador de escape \n\nTabela 8.3 - Comandos utilizados no teste dos atuadores \n\n\n\n105 \n\n \n\nOrigem Comando A\u00e7\u00e3o despoletada \n\nCaixas de Sele\u00e7\u00e3o \n\n\"p1\" Programa 1 agendado \n\n\u201cp2\u201d Programa 2 agendado \n\n\"p3\" Programa 2 agendado \n\n\u201cp0\u201d Nenhum programa \u00e9 agendado \n\nBot\u00e3o \"Save\" \n\n\"sv1\" Desligar Motor de alimenta\u00e7\u00e3o \n\n\u201csv2 Desligar resist\u00eancia de Igni\u00e7\u00e3o \n\n\"sv3\" Desligar ventilador ambiente \n\n\u201csv4\u201d Desligar ventilador de escape \n\nTabela 8.4 - Comandos de agendamento do crono termostato \n\nOrigem Comando A\u00e7\u00e3o despoletada \n\nBot\u00e3o \"START\" \"str\" Dar in\u00edcio ao processo \n\nBot\u00e3o \u201cSTOP\u201d \u201cstp\u201d Terminar o processo \n\nTabela 8.5 - Comandos de solicita\u00e7\u00e3o de in\u00edcio e fim de processo \n\n8.1 Ecr\u00e3s desenhados para o LCD \n\n \n\nFigura 8.4 - Processo inativo \n\n \n\nFigura 8.5 - Processo ativo \n\n \n\nFigura 8.6 - Sele\u00e7\u00e3o de n\u00edvel m\u00e1ximo de queima \n\n \n\nFigura 8.7 - Menu de temperaturas \n\n  \n\n\n\n106 \n\n \n\n \n\nFigura 8.8 - Mostrador de temperaturas \n\n \n\nFigura 8.9 - Sele\u00e7\u00e3o de temperatura desejada \n\n \n\nFigura 8.10 - Menu de rel\u00f3gio \n\n \n\nFigura 8.11 - Atualiza\u00e7\u00e3o da data e hora atuais \n\n \n\nFigura 8.12 - Programa\u00e7\u00e3o do crono termostato \n\n \n\nFigura 8.13 - Predi\u00e7\u00e3o \n\n \n\nFigura 8.14 - Inser\u00e7\u00e3o de palavra-passe \n\n \n\nFigura 8.15 - Menu de programa\u00e7\u00e3o \n\n\n\n107 \n\n \n\n \n\nFigura 8.16 - Menu de par\u00e2metros \n\n \n\nFigura 8.17 - Config. par\u00e2metros do MA \n\n \n\nFigura 8.18 - Config. par\u00e2metros do VA \n\n \n\nFigura 8.19 - Config. par\u00e2metros do VE \n\n \n\nFigura 8.20 - Config. temperaturas \n\n \n\nFigura 8.21 - Teclado virtual \n\n \n\nFigura 8.22 - Teste aos atuadores \n\n \n\nFigura 8.23 - Menu de bloqueio do teclado \n\n\n\n108 \n\n \n\n \n\nFigura 8.24 - Calibra\u00e7\u00e3o \n\n \n\nFigura 8.25 - Inser\u00e7\u00e3o de nova palavra-passe \n\n8.2 Interface Inter Integrated Circuit (I2C) \n\nEsta interface foi desenvolvida pela Philips Semiconductor em 1992, lan\u00e7ando a sua \n\n\u00faltima vers\u00e3o em 2007. Corresponde a um tipo de comunica\u00e7\u00e3o s\u00e9rie bidirecional, \n\nhalf-duplex, orientado ao byte com transa\u00e7\u00f5es Master-Slave. Numa escrita, um Master \n\ntransmissor envia dados para um Slave recetor, enquanto na leitura um Master recetor \n\nl\u00ea dados de um Slave transmissor. \n\nSinaliza\u00e7\u00e3o \n\nO barramento \u00e9 composto por apenas 2 fios: um deles para a linha de dados (SDA) e \n\noutra para a linha de rel\u00f3gio (SCL). Em cada per\u00edodo do rel\u00f3gio \u00e9 transferido um bit de \n\ndados, sendo que estes apenas ficam v\u00e1lidos quando SCL = \u201c1\u201d e apenas podem ser \n\nalterados quando SCL = \u201d0\u201d. Contudo, existem exce\u00e7\u00f5es nas condi\u00e7\u00f5es, que podem \n\nser de dois tipos: start e stop. O primeiro sinaliza o in\u00edcio de uma transfer\u00eancia de \n\ndados e ocorre na transi\u00e7\u00e3o de \u201c1\u201d para \u201c0\u201d em SDA, enquanto a linha SCL se \n\nencontra no n\u00edvel l\u00f3gico \u201c1\u201d. A segunda corresponde ao seu t\u00e9rmino e ocorre na \n\ntransi\u00e7\u00e3o de \u201c0\u201d para \u201c1\u201d em SDA quando SCL = \u201c1\u201d. Pode-se, por isto, dizer que o \n\nbarramento se encontra ocupado entre um start e um stop e livre entre um stop e um \n\nstart. \n\nTransmiss\u00e3o de dados \n\n \n\nFigura 8.26 - Tramas I2C para transfer\u00eancia de dados \n\n\n\n109 \n\n \n\nTraduzindo de forma sequencial a Figura 8.26, ser\u00e3o referidos abaixo os passos a \n\nseguir para uma correta transmiss\u00e3o de dados: \n\n1 \u2013 Master envia um Start Bit, sinalizando o in\u00edcio da transmiss\u00e3o; \n\n2 \u2013 Master envia 7 bits de endere\u00e7amento do Slave com o qual pretende \n\ncomunicar acrescido do bit de opera\u00e7\u00e3o, leitura ou escrita; \n\n3 \u2013 Se o endere\u00e7amento for efetuado de forma correta, o Slave deve \n\nresponder com um bit de confirma\u00e7\u00e3o (Acknowledge). \n\n4 \u2013 Se a opera\u00e7\u00e3o a efetuar for de escrita, ent\u00e3o o Master come\u00e7a a transferir \n\nos dados, 8 de bits por slot, esperando sempre o bit de confirma\u00e7\u00e3o do Slave. \n\nQuando todos os dados tiverem sido transferidos, ent\u00e3o o Master envia um \n\nstop bit e d\u00e1 por encerrada a transa\u00e7\u00e3o. \n\n \n\nSe o Master pretender efetuar uma leitura, o Slave come\u00e7a de imediato a transferir \n\ninforma\u00e7\u00e3o para o barramento, com a confirma\u00e7\u00e3o a ser dada pelo Master a cada 8 \n\nbits. Quando este tiver recebido todos os dados de que necessita, envia um bit de Not \n\nAcknowledge e de seguida um stop bit, libertando de novo o barramento. \n\nTaxas de Transmiss\u00e3o \n\nA taxa de bits transferidos por segundo classifica-se em 4 tipos, sendo eles: \n\n? Standard mode: at\u00e9 100 Kbit/s \n\n? Fast mode: at\u00e9 400 Kbit/s \n\n? Fast mode plus: at\u00e9 1 Mbit/s \n\n? High Speed: at\u00e9 a 3,4 Mbit/s \n\nBarramento Multi-Master \n\nV\u00e1rios Masters podem pretender iniciar uma nova transfer\u00eancia de dados no mesmo \n\ninstante. \u00c9, por isso necess\u00e1rio que os seus rel\u00f3gios se mantenham sincronizados e \n\num processo de arbitragem para determinar aquele que vai ter acesso ao barramento. \n\nAmbos utilizam a t\u00e9cnica de bit dominante (\u201c0\u201d) / recessivo (\u201c1\u201d), ou seja, o bit \n\ndominante sobrep\u00f5e-se sempre ao bit recessivo. \n\nSincroniza\u00e7\u00e3o de Rel\u00f3gio dos Masters \n\nLogo que na linha SCL ocorra uma transi\u00e7\u00e3o \u201c1\u201d -> \u201c0\u201d, todos os Masters s\u00e3o for\u00e7ados \n\na colocar os respetivos rel\u00f3gios a \u201c0\u201d durante um determinado intervalo de tempo \n\ndeterminado por cada um. Decorrido esse tempo para um dos Masters, este liberta a \n\nlinha SCL, o que n\u00e3o significa que esta passe automaticamente para o n\u00edvel l\u00f3gico \u201c1\u201d, \n\numa vez que outros Masters podem ainda n\u00e3o ter terminada a contagem a \u201c0\u201d. Nesta \n\n\n\n110 \n\n \n\nsitua\u00e7\u00e3o todos os Masters que tiverem libertado a linha SCL passam para um estado \n\nde wait, ficando a aguardar que a linha passe a \u201c1\u201d. A partir daqui, os Masters iniciam \n\na sua contagem a \u201c1\u201d, contudo, nesta situa\u00e7\u00e3o basta que o primeiro Master termine \n\nesse tempo para colocar automaticamente a linha de rel\u00f3gio a \u201c0\u201d. E o processo \n\nrepete-se. \n\nArbitragem \n\nNeste processo, os Masters que pretendem aceder ao barramento verificam o novo bit \n\ntransferido e comparam com aquele que eles pr\u00f3prios enviaram. O Master que tenha \n\nenviado um bit recessivo e tendo lido da linha de dados um bit dominante, perde \n\nautomaticamente o processo de arbitragem e: \n\n? Retira-se libertando a linha de dados, comutando para o modo Slave; \n\n? S\u00f3 pode voltar a tentar aceder ao barramento quando a linha de dados voltar \n\nao estado livre; \n\nExemplos de aplica\u00e7\u00f5es \n\nExemplos de dispositivos que podem comunicar segundo esta interface s\u00e3o: \n\n? Mem\u00f3rias; \n\n? ADCs e DACs \n\n? LCD drivers \n\n? Real-Time Clocks \n\n? TVs e Monitores \n\n? CPUs e Motherboards \n\n8.3 Serial Peripheral Interface (SPI) \n\nDefinida e desenvolvida pela Motorola, esta interface de comunica\u00e7\u00e3o \u00e9 utlizada num \n\ngrande n\u00famero de dispositivos, como por exemplo: sensores, cart\u00f5es de mem\u00f3ria, \n\nmem\u00f3rias externas, ADCs, DACs, Displays LCD, m\u00e1quinas fotogr\u00e1ficas, \n\nmicrocontroladores, etc. \n\n\u00c9 utilizado em liga\u00e7\u00f5es a curta dist\u00e2ncia e caracteriza-se por uma arquitetura Master-\n\nSlave com liga\u00e7\u00e3o ponto a ponto. Ao contr\u00e1rio do I2C, a comunica\u00e7\u00e3o \u00e9 bidirecional \n\nfull-duplex, ou seja, pode dar-se nos dois sentidos ao mesmo tempo. Funciona em \n\nmodo \u201cData-Exchange\u201d, sendo que cada dispositivo ao fim de N ciclos de rel\u00f3gio envia \n\numa palavra de N bits para o barramento e recebe outra com o mesmo comprimento. \n\n\n\n111 \n\n \n\nO sinal de rel\u00f3gio \u00e9 gerado pelo Master e disponibilizado a todos os Slaves \u2013 rel\u00f3gio \n\nexpl\u00edcito do Master. Nesta arquitetura, apenas pode existir um Master que inicia e \n\ncontrola a transfer\u00eancia de dados, sendo um \u00fanico Slave \u00e9 selecionado de cada vez. \n\nEsquema de Princ\u00edpio \n\n \n\nFigura 8.27 - Modelo de comunica\u00e7\u00e3o SPI \n\nEm cada dispositivo existe um shift-register, ao qual se juntam dois buffers: de \n\ntransmiss\u00e3o e rece\u00e7\u00e3o (Figura 8.27). \n\nA comunica\u00e7\u00e3o d\u00e1-se, ent\u00e3o da seguinte forma: a informa\u00e7\u00e3o \u00e9 enviada do buffer de \n\ntransmiss\u00e3o para o shift-register que, por sua vez a reencaminhada para outro shift-\n\nregister, depositando o seu conte\u00fado no buffer de rece\u00e7\u00e3o respetivo. \n\nSinaliza\u00e7\u00e3o \n\nS\u00e3o utilizadas duas linhas para dados, Serial Data In (SDI) e Serial Data Out (SDO) e \n\noutras duas para controlo, Serial Clock (SCK) e Slave Select (SS\\). As linhas de dados \n\ns\u00e3o utilizadas para transfer\u00eancia de dados entre os shift-registers dos dispositivos. \n\nA linha de rel\u00f3gio (SCK) tem um duty-cycle de 50% e \u00e9 utilizada pelo Master para \n\ndefinir a transi\u00e7\u00e3o (ascendente ou descendente) em que coloca um bit de informa\u00e7\u00e3o \n\nno barramento. A transi\u00e7\u00e3o oposta \u00e9 escolhida pelo Slave para o armazenar. A \n\nfrequ\u00eancia da onda deve ser igual ou inferior \u00e0 m\u00e1xima suportada pelo Slave com o \n\nqual vai comunicar. \n\nA linha de sele\u00e7\u00e3o do Slave (SS\\) como o nome indica \u00e9 utilizada para determinar \n\naquele com o qual o Master comunica a cada instante. Esta linha, quando inativa, p\u00e1ra \n\no sinal de rel\u00f3gio, deixando-o est\u00e1vel num n\u00edvel l\u00f3gico definido previamente. \n\n \n\n \n\n \n\n\n\n112 \n\n \n\nArquiteturas de Liga\u00e7\u00e3o \n\nExistem duas arquiteturas principais de liga\u00e7\u00e3o SPI. A Uma delas atribui sinais \n\nindependentes de ativa\u00e7\u00e3o a cada Slave (Figura 8.28), ou seja, apenas um est\u00e1 ativo \n\nem cada instante. Todos os outros ficam em alta imped\u00e2ncia. \n\nNa segunda arquitetura (Figura 8.29), o sinal de Slave Select \u00e9 comum a v\u00e1rios \n\ndispositivos, sendo que a sa\u00edda de dados de cada um se encontra ligada \u00e0 entrada de \n\ndados do seguinte. Esta \u201ccoopera\u00e7\u00e3o\u201d de Slaves permite transform\u00e1-los num Slave de \n\nmaior dimens\u00e3o. \n\n \n\n \n\nFigura 8.28 - Liga\u00e7\u00e3o Independente \n\n \n\nFigura 8.29 - Liga\u00e7\u00e3o em cascata \n\nTipos de Transfer\u00eancias \n\n? Bidirecional \u2013 em ambos os sentidos \u00e9 trocada informa\u00e7\u00e3o v\u00e1lida ao mesmo \n\ntempo \n\n\n\n113 \n\n \n\n? Master ? Slave (Opera\u00e7\u00e3o de escrita) \u2013 S\u00e3o transferidos dados v\u00e1lidos para o \n\nSlave e ignorados os que s\u00e3o recebidos na volta. \n\n? Slave ? Master (Opera\u00e7\u00e3o de leitura) \u2013 S\u00e3o recebidos dados v\u00e1lidos do Slave \n\ne ignorados aqueles que lhe s\u00e3o enviados \n\n8.4 Controller Area Network (CAN) \n\nEsta interface de comunica\u00e7\u00e3o foi desenvolvida em 1991 pela Bosch e utiliza \n\ncomunica\u00e7\u00e3o diferencial em par entran\u00e7ado. Pode funcionar com taxas de transmiss\u00e3o \n\nat\u00e9 1 Mbit/s e utilizar at\u00e9 40 n\u00f3s no mesmo barramento. A capacidade de dete\u00e7\u00e3o de \n\ndiferentes tipos de erros, a toler\u00e2ncia a interfer\u00eancias eletromagn\u00e9ticas e a baixa \n\nprobabilidade de n\u00e3o dete\u00e7\u00e3o de erros de transmiss\u00e3o fazem com que o CAN \n\napresente uma elevada robustez. \n\nCaracter\u00edsticas \n\nO CAN \u00e9 um barramento s\u00e9rie multi-master, ou seja, qualquer n\u00f3 do barramento pode \n\nproduzir e iniciar uma transmiss\u00e3o. Utiliza a rela\u00e7\u00e3o produtor-consumidor, podendo \n\nainda ocorrer transmiss\u00e3o em broadcast. A comunica\u00e7\u00e3o \u00e9 bidirecional, half-duplex, \n\ncom rel\u00f3gio impl\u00edcito, e a informa\u00e7\u00e3o produzida \u00e9 dividida em mensagens \n\n(encapsuladas em tramas), cada uma delas possuindo um ID \u00fanico que define a sua \n\nprioridade no acesso ao barramento. Quando menor o ID, maior ser\u00e1 a prioridade j\u00e1 \n\nque o processo de arbitragem entre masters utiliza a t\u00e9cnica de bit \n\ndominante/recessivo. \n\nTopologia de Rede \n\n \n\nFigura 8.30 - Topologia da rede CAN \n\nUm n\u00f3 liga-se ao barramento atrav\u00e9s de duas linhas: CAN_H e CAN_L, necessitando \n\nde uma resist\u00eancia de termina\u00e7\u00e3o entre elas na ordem dos 120 ? (Figura 8.30). \n\nInternamente, cada n\u00f3 necessita de um transceiver para convers\u00e3o de n\u00edveis de \n\ntens\u00e3o entre o barramento propriamente dito e o controlador CAN interno do \n\nmicrocontrolador/CPU (Figura 8.31). Como dito anteriormente, a comunica\u00e7\u00e3o \u00e9 \n\n\n\n114 \n\n \n\ndiferencial, o que significa que na rece\u00e7\u00e3o de dados o transceiver descrimina o n\u00edvel \n\nl\u00f3gico (\u201c0\u201d ou \u201c1\u201d) pela diferen\u00e7a entre os dois sinais constituintes do barramento, \n\nCAN_H e CAN_L, cujo resultado \u00e9 enviado para a linha Rx do controlador CAN. Na \n\ntransmiss\u00e3o, o n\u00edvel l\u00f3gico em Tx \u00e9 transformado em duas tens\u00f5es distintas em \n\nCAN_H e CAN_L. \n\n \n\n \n\nFigura 8.31 - Constitui\u00e7\u00e3o geral de um n\u00f3 da rede CAN \n\nNo que ao controlador CAN diz respeito, destacam-se os blocos internos (Figura 8.32): \n\n? Implementa\u00e7\u00e3o do Protocolo em hardware; \n\n? CPU interface \u2013 assegura a comunica\u00e7\u00e3o com o CPU/microcontrolador; \n\n? Hardware Acceptance Filter \u2013 respons\u00e1vel por filtrar as mensagens recebidas \n\natrav\u00e9s do seu ID; \n\n? Buffer de Mensagens para Transmiss\u00e3o \u2013 guarda os dados antes de os enviar; \n\n? Buffer de Mensagens de Rece\u00e7\u00e3o \u2013 guarda os dados para poderem ser \n\nacedidos pelo utilizador. \n\n \n\nFigura 8.32 - Controlador CAN \n\n \n\n \n\n\n\n115 \n\n \n\nTipos de tramas \n\n? Dados \u2013 enviada por um n\u00f3 produtor para um ou mais consumidores; \n\n? Remote Transmission Request \u2013 enviada por um n\u00f3 consumidor a solicitar uma \n\ndeterminada trama de dados; \n\n? Erro \u2013 usada para reportar um erro e sobrep\u00f5e-se a qualquer transmiss\u00e3o que \n\nse esteja a desenrolar; \n\n? Overload \u2013 usada para retardar o envio de nova trama, na situa\u00e7\u00e3o em que n\u00e3o \n\ntenha conseguido processar a \u00faltima trama enviada para o barramento. \n\nFormato da Trama Standard \n\nUma trama CAN Standard (Figura 8.33) \u00e9 composta sete grupos de bits. O primeiro \u00e9 \n\nSOF (Start of Frame) que correspondem a um bit dominante (\u201c0\u201d) e \u00e9 usado para \n\nsincroniza\u00e7\u00e3o do rel\u00f3gio dos n\u00f3s recetores. Segue-se o campo de arbitragem \n\nconstitu\u00eddo por 11 bits para o identificador da mensagem e 1 bit (RTR) para distin\u00e7\u00e3o \n\nentre trama de dados de Remote Transmission Request. Este campo define o master \n\nque pode iniciar a transmiss\u00e3o. O campo de controlo \u00e9 constitu\u00eddo por 6 bits, dos quais \n\no primeiro, extens\u00e3o identificadora, determina se se trata de uma trama Standard ou \n\nExtended. Seguem-se um bit dominante reservado, RB0, e 4 bits que especificam o \n\nn\u00famero de bytes de dados da mensagem. \n\nO campo de dados propriamente dito da mensagem tem espa\u00e7o para 8 bytes de \n\ndados. Segue-se o campo CRC, propositadamente inclu\u00eddo para dete\u00e7\u00e3o de erros, \n\ncom uma sequ\u00eancia de 16 bits. Esta sequ\u00eancia \u00e9 calculada pelo transmissor e recetor \n\nda mensagem, com base nos bits transmitidos, que caso difiram \u00e9 detetado um erro. O \n\ncampo de Acknowledge \u00e9 respons\u00e1vel pela valida\u00e7\u00e3o da trama. Assim, o produtor \n\nenvia um bit recessivo, que \u00e9 sobreposto por um ou mais consumidores com um bit \n\ndominante. Finalmente s\u00e3o introduzidos 7 bits recessivos sinalizando o final da trama. \n\n \n\n \n\nFigura 8.33 - Trama CAN Standard \n\n\n\n116 \n\n \n\n8.5 Pinos do LCD Flex-Cable \n\nSignal Pin No. (3.5\u201d) Description \n\nLED K 1,2 LED Cathode \n\nLED A 3,4 LED Cathode \n\nDISP 8 \nGeneral purpose output pin for LCD Display Enable, push-pull output, 4/8mA \n\nsink/source current. Control by writing to Bit 7 of REG_GPIO register. \n\nHSYNC 36 LCD Horizontal Sync, push-pull output, 4/8mA sink/source current. \n\nVSYNC 37 LCD Vertical Sync, push-pull output, 4/8mA sink/source current. \n\nDCLK 38 LCD Pixel Clock, push-pull output, 4/8mA sink/source current. \n\nDE 52 LCD Data Enable, push-pull output, 4/8mA sink/source current. \n\nR2 14 Bit 2 of Red RGB signals, push-pull output, 4/8mA sink/source current. \n\nR3 15 Bit 3 of Red RGB signals, push-pull output, 4/8mA sink/source current. \n\nR4 16 Bit 4 of Red RGB signals, push-pull output, 4/8mA sink/source current. \n\nR5 17 Bit 5 of Red RGB signals, push-pull output, 4/8mA sink/source current. \n\nR6 18 Bit 6 of Red RGB signals, push-pull output, 4/8mA sink/source current. \n\nR7 19 Bit 7 of Red RGB signals, push-pull output, 4/8mA sink/source current. \n\nG2 22 Bit 2 of Green RGB signals, push-pull output, 4/8mA sink/source current \n\nG3 23 Bit 3 of Green RGB signals, push-pull output, 4/8mA sink/source current \n\nG4 24 Bit 4 of Green RGB signals, push-pull output, 4/8mA sink/source current \n\nG5 25 Bit 5 of Green RGB signals, push-pull output, 4/8mA sink/source current \n\nG6 26 Bit 6 of Green RGB signals, push-pull output, 4/8mA sink/source current \n\nG7 27 Bit 7 of Green RGB signals, push-pull output, 4/8mA sink/source current \n\nB2 30 Bit 2 of Blue RGB signals, push-pull output, 4/8mA sink/source current. \n\nB3 31 Bit 3 of Blue RGB signals, push-pull output, 4/8mA sink/source current. \n\nB4 32 Bit 4 of Blue RGB signals, push-pull output, 4/8mA sink/source current. \n\nB5 33 Bit 5 of Blue RGB signals, push-pull output, 4/8mA sink/source current. \n\nB6 34 Bit 6 of Blue RGB signals, push-pull output, 4/8mA sink/source current. \n\nB7 35 Bit 7 of Blue RGB signals, push-pull output, 4/8mA sink/source current. \n\nXP 48 X +ve touch \n\nYM 49 Y \u2013ve touch \n\nXM 50 X \u2013ve touch \n\nYP 51 Y +ve touch \n\n3V3 9,10,11,41,42 3V3 Power \n\nGND \n12,13,20,21,28,\n\n29,53,54 \nGround \n\nNC \n5,6,7,39,40,43,4\n\n4,45,46,47 \nNo connect \n\nTabela 8.6 - Fun\u00e7\u00f5es de todos os pinos de entrada/sa\u00edda do LCD"}]}}}