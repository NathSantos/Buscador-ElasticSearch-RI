{"add": {"doc": {"field": [{"@name": "docid", "#text": "BR-TU.10929"}, {"@name": "filename", "#text": "16132_344654.pdf"}, {"@name": "filetype", "#text": "PDF"}, {"@name": "text", "#text": "PAULO RENATO DA COSTA MENDES\n\nPREDICTIVE CONTROL FOR ENERGY\nMANAGEMENT OF RENEWABLE\nENERGY BASED MICROGRIDS\n\nFLORIANO?POLIS\n2016\n\n\n\n\n\nUNIVERSIDADE FEDERAL DE SANTA\nCATARINA\n\nPROGRAMA DE PO?S-GRADUAC?A?O EM\nENGENHARIA DE AUTOMAC?A?O E SISTEMAS\n\nPREDICTIVE CONTROL FOR ENERGY\nMANAGEMENT OF RENEWABLE ENERGY\n\nBASED MICROGRIDS\n\nTese de doutorado submetida ao Programa de\nPo?s-Graduac?a?o em Engenharia de Automac?a?o e Sistemas\npara a obtenc?a?o do Grau de Doutor em Engenharia de\n\nAutomac?a?o e Sistemas.\n\nPAULO RENATO DA COSTA MENDES\n\nFloriano?polis, Agosto de 2016.\n\n\n\nFicha de identifica\u00e7\u00e3o da obra elaborada pelo autor,\natrav\u00e9s do Programa de Gera\u00e7\u00e3o Autom\u00e1tica da Biblioteca Universit\u00e1ria da UFSC.\n\nMendes, Paulo Renato da Costa\nPREDICTIVE CONTROL FOR ENERGY MANAGEMENT OF RENEWABLE\n\nENERGY BASED MICROGRIDS / Paulo Renato da Costa Mendes ;\norientador, Julio Elias Normey-Rico ; coorientador, Carlos\nBordons. - Florian\u00f3polis, SC, 2016.\n\n153 p.\n\nTese (doutorado) - Universidade Federal de Santa\nCatarina, Centro Tecnol\u00f3gico. Programa de P\u00f3s-Gradua\u00e7\u00e3o em\nEngenharia de Automa\u00e7\u00e3o e Sistemas.\n\nInclui refer\u00eancias \n\n1. Engenharia de Automa\u00e7\u00e3o e Sistemas. 2. Energy\nManagement. 3. Control of Hybrid Systems. 4. Distributed\nPredictive Control. I. Normey-Rico, Julio Elias. II.\nBordons, Carlos. III. Universidade Federal de Santa\nCatarina. Programa de P\u00f3s-Gradua\u00e7\u00e3o em Engenharia de\nAutoma\u00e7\u00e3o e Sistemas. IV. T\u00edtulo.\n\n\n\nPREDICTIVE CONTROL FOR ENERGY\nMANAGEMENT OF RENEWABLE ENERGY\n\nBASED MICROGRIDS\n\nPaulo Renato da Costa Mendes\n\n\u2018Esta tese de doutorado foi julgada aprovada para a obtenc?a?o do\nt??tulo de Doutor em Engenharia de Automac?a?o e Sistemas,\n\nA?rea de Concentrac?a?o em Controle, Automac?a?o e Sistemas, e\naprovada em sua forma final pelo Programa de Po?s-Graduac?a?o\nem Engenharia de Automac?a?o e Sistemas da Universidade\n\nFederal de Santa Catarina.\u2019\n\nJulio Elias Normey-Rico, Dr.\nOrientador\n\nCarlos Bordons Alba, Dr.\nCoorientador\n\nDaniel Ferreira Coutinho , Dr.\nCoordenador do Programa de Po?s-Graduac?a?o em Engenharia de\n\nAutomac?a?o e Sistemas\n\nBanca Examinadora:\n\nJulio Elias Normey-Rico, Dr.\nPresidente\n\nRicardo Hiroshi Caldeira Takahashi , Dr.\n\nAguinaldo Silveira e Silva, Dr.\n\nJorge Ota?vio Trierweiler, Dr.\n\nEduardo Camponogara, Dr.\n\nRodolfo Cesar Costa Flesch, Dr.\n\niii\n\n\n\n\n\nACKNOWLEDGMENTS\n\nI would like to thanks\n\nMy family that always encouraged me and support me at all times.\n\nMy advisor Julio Normey-Rico and my co-advisor Carlos Bordons for\nguidance, support, friendship and always have time to exchange ideas.\n\nProfessor Jose? Maestre and Dr. Luis Valverde for the support and\ncontributions to this work.\n\nMy friends and colleagues that participated in this journey, especially\nVilmarque Joa?o Junior, Marcelo Morato, Jose? Dietrich, Iaponan Cardins,\nCassio Monteiro, Christian Mendonc?a and my girlfriend Daniela Paiva.\n\nv\n\n\n\n\n\nResumo da tese de doutorado submetida a? Universidade\nFederal de Santa Catarina como parte dos requisitos para a\nobtenc?a?o do grau de Doutor em Engenharia de Automac?a?o\n\ne Sistemas.\n\nControle Preditivo para Gerenciamento de Energia\nde Micro-redes Baseadas em Energia Renova?vel\n\nPaulo Renato da Costa Mendes\n\nAgosto/2016\n\nvii\n\n\n\nOrientador: Julio Elias Normey-Rico, Dr.\nCoorientador: Carlos Bordons Alba, Dr.\nA?rea de Concentrac?a?o: Controle, Automac?a?o e Informa?tica\nIndustrial\nPalavras-chave: Gerenciamento de Energia, Microrredes, Con-\ntrole de Sistemas H??bridos, Controle Preditivo Distribu??do.\nNu?mero de Pa?ginas: xxv + 128\n\nO objetivo deste trabalho e? abordar a gesta?o de energia\ndos sistemas de gerac?a?o e armazenamento de energia. Estes\nsistemas sa?o atualmente uma realidade em pa??ses onde e? de-\nsejada uma diversificac?a?o das fontes de energia e uma maior\npenetrac?a?o das fontes renova?veis. Em particular, o Brasil\npossui uma matriz energe?tica diversificada com base em re-\ncursos h??dricos, biomassa (etanol), ga?s natural e petro?leo.\nMas, expectativa para o futuro pro?ximo e? um aumento da\nutilizac?a?o de fontes de energia renova?veis, principalmente so-\nlar e eo?lica. Dessa forma, este trabalho ataca um problema\necono?mico atual e importante para o Pa??s. Uma rede de\nenergia em grande escala pode ser subdividida em subsis-\ntemas chamados micro-redes, que podem ser vistos como um\nconjunto de geradores despacha?veis e/ou na?o-despacha?veis\nque utilizam energias fo?sseis e/ou renova?veis, armazenadores\nde energia e consumidores. Uma micro-rede pode operar\nem modo ilha, conectada com a rede principal e interligada\ncom outras micro-redes. Sabe-se que a operac?a?o ideal de\ncada unidade na?o garante o perfeito funcionamento global\nda micro-rede, o que leva a um comportamento inaceita?vel.\nAssim, torna-se necessa?ria a coordenac?a?o entre todos os el-\nementos da micro-rede. A mesma filosofia deve ser aplicada\nno problema de micro-redes interligadas. Do ponto de vista\nda modelagem, os modelos de sistemas de gesta?o de energia\nno n??vel superior te?m caracter??sticas h??bridas, devido a? ne-\ncessidade de introduzir varia?veis bina?rias, por exemplo, para\nmodelar a dina?mica de armazenamento ou prec?os diferentes\npara operac?o?es econo?micas como compra/venda de energia.\n\nviii\n\n\n\nAssim, uma abordagem natural para controlar esses sistemas\ne? a utilizac?a?o de controle preditivo, o qual ja? e? amplamente\nutilizado na indu?stria de processos e pode lidar com proble-\nmas h??bridos de optimizac?a?o. Em uma micro-rede operando\nem modo conectada a? rede principal o desafio de controle e?\nmaximizar o uso de fontes renova?veis, minimizar o uso de\ncombust??veis fo?sseis e a quantidade de energia comprada da\nrede de distribuic?a?o, amortecer flutuac?o?es de energia e aten-\nder a demanda. No caso de micro-redes interligadas e? dese-\njada uma estrate?gia de controle que permita a interac?a?o en-\ntre micro-redes para compartilhar fontes de energia e reduzir\no fluxo de energia com a rede de distribuic?a?o. Assim, para\numa u?nica micro-rede o controle centralizado parece uma boa\nopc?a?o, enquanto para micro-redes interligadas, quando o in-\nterca?mbio de informac?a?o e? limitado, o controle distribu??do\naparece como uma soluc?a?o interessante. Nesta tese e? con-\nsiderado o problema de controle de micro-redes em difer-\nentes cena?rios, dentre eles uma microrrede de laborato?rio\ncom armazenador de hidroge?nio, o estudo de microrredes in-\nterligadas e uma planta de gerac?a?o da indu?stria da cana de\nac?u?car. O objetivo principal e? propor soluc?o?es baseadas em\ncontrole preditivo para atender os requisitos de operac?a?o do\nsistema.\n\nix\n\n\n\n\n\nAbstract of the thesis presented to the Federal University of Santa\nCatarina as a partial fulfillment of the requirements for the degree of\n\nDoctor in Automation and Systems Engineering.\n\nPREDICTIVE CONTROL FOR ENERGY\nMANAGEMENT OF RENEWABLE ENERGY\n\nBASED MICROGRIDS\n\nPaulo Renato da Costa Mendes\n\nAgosto/2016\n\nxi\n\n\n\nAdvisor: Julio Elias Normey-Rico, Dr.\nCo-advisor: Carlos Bordons Alba, Dr.\nArea of Concentration: Control, Automation and Industrial\nInformatics\nKeywords: Energy Management, Microgrids, Control of Hy-\nbrid Systems, Distributed Predictive Control.\nNumber of Pages: xxv + 128\n\nThe objective of this thesis is to address the energy\nmanagement of power generation and energy storage sys-\ntems. These systems are nowadays a reality in countries\nwhere a diversification of energy sources and a higher pene-\ntration of renewable sources is desired. In particular, Brazil\nhas a diversified energy matrix based on water resources,\nbiomass (ethanol), natural gas and oil. But the expectation\nfor the near future is an increase in the use of renewable\nsources, mainly solar and wind. Thus, this work attacks a\ncurrent and important economic problem for the country. A\nlarge scale energy network can be subdivided into subsystems\ncalled Microgrids, that can be seen as set of dispatchable\nand/or non-dispatchable generators that uses fossil and/or\nrenewable energy, storage units and consumers. A microgrid\ncan operate in island mode, grid-connected mode and inter-\nconnected with other microgrids as the so called networked\nmicrogrids. It is known that an ideal operation of each unit\ndoes not guarantee the perfect operation of the overall mi-\ncrogrid, which leads to an unacceptable behavior. Thus it\nbecomes necessary coordination between all microgrid ele-\nments. The same philosophy should be applied in the net-\nworked microgrids problem. From modeling point of view,\nthe top level energy management system models have hybrid\ncharacteristics due to the need to introduce binary variables,\nfor example, to model storage dynamics or different prices\nfor economic operations like sell/purchase of energy. Thus, a\nnatural approach to control these systems is the use of pre-\ndictive control, which is already widely used in the process\n\nxii\n\n\n\nindustry and can deal with hybrid optimization problems.\nIn a microgrid operating in grid connected mode the con-\ntrol challenges are to maximize the use of renewable sources,\nminimize the use of fossil sources an the amount of energy\nbought from distribution network operator (DNO), mitigate\nenergy fluctuating and meet the demand. In an intercon-\nnected case a control strategy that allows the interaction\nbetween microgrids to share energy sources and reduce the\nenergy flow with DNO is desired. Thus for a single micro-\ngrid the centralized control seems to be a good option and for\nnetworked microgrids, when information sharing is limited,\nthe distributed control appears as an interesting solution. In\nthis thesis the problem of control of microgrids in different\nscenarios is considered, among them a laboratory microgrid\nwith hydrogen storage, the study of four interconnected mi-\ncrogrids and a sugar cane industry power plant. The main\nobjective is to propose solutions based on model predictive\ncontrol to attend the system operation requirements.\n\nxiii\n\n\n\n\n\nContents\n\n1 Introduction 1\n1.1 Objectives and Organization of the Thesis . . . . . . . . . . . 8\n\n2 Energy Hubs Modeling Framework 9\n2.1 Modeling Framework . . . . . . . . . . . . . . . . . . . . . . . 10\n\n2.1.1 Converters . . . . . . . . . . . . . . . . . . . . . . . . 10\n2.1.2 Storage Units . . . . . . . . . . . . . . . . . . . . . . . 13\n2.1.3 State-space Representation . . . . . . . . . . . . . . . 17\n\n2.2 Mixed Logical Dynamical Systems (MLD) . . . . . . . . . . . 17\n2.2.1 MLD Procedure applied to Storage Modeling . . . . . 20\n\n2.3 Interconnected Energy Hubs . . . . . . . . . . . . . . . . . . . 22\n2.4 Final Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . 24\n\n3 Model Predictive Control (MPC) 25\n3.1 State Space MPC . . . . . . . . . . . . . . . . . . . . . . . . . 25\n\n3.1.1 Prediction Model . . . . . . . . . . . . . . . . . . . . . 26\n3.1.2 Objective Function . . . . . . . . . . . . . . . . . . . . 28\n3.1.3 Obtaining the Control Law . . . . . . . . . . . . . . . 30\n\n3.2 Distributed MPC . . . . . . . . . . . . . . . . . . . . . . . . . 31\n3.2.1 Control Problem . . . . . . . . . . . . . . . . . . . . . 32\n3.2.2 Information Exchange . . . . . . . . . . . . . . . . . . 33\n3.2.3 Lagrange MPC . . . . . . . . . . . . . . . . . . . . . . 34\n\n3.3 Final Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . 38\n\n4 Hybrid Distributed MPC 39\n4.1 Problem setting . . . . . . . . . . . . . . . . . . . . . . . . . . 41\n4.2 Hybrid DMPC Framework . . . . . . . . . . . . . . . . . . . . 41\n\n4.2.1 Binary Search Algorithm . . . . . . . . . . . . . . . . 42\n4.2.2 Distributed Coordination . . . . . . . . . . . . . . . . 43\n4.2.3 Algorithm Convergence . . . . . . . . . . . . . . . . . 45\n\n4.3 Final Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . 47\n\n5 Microgrid Control 49\n\nxv\n\n\n\n5.1 Energy Management in Microgrids . . . . . . . . . . . . . . . 49\n5.2 Laboratory Microgrid Control . . . . . . . . . . . . . . . . . . 50\n\n5.2.1 V2G Experimental Microgrid . . . . . . . . . . . . . . 51\n5.2.2 System Modeling . . . . . . . . . . . . . . . . . . . . . 52\n5.2.3 Control Algorithm . . . . . . . . . . . . . . . . . . . . 54\n5.2.4 Experimental Results . . . . . . . . . . . . . . . . . . 60\n\n5.3 Networked Microgrids . . . . . . . . . . . . . . . . . . . . . . 65\n5.3.1 V2G Networked Microgrids . . . . . . . . . . . . . . . 65\n5.3.2 System Modeling . . . . . . . . . . . . . . . . . . . . . 65\n5.3.3 Control Algorithm . . . . . . . . . . . . . . . . . . . . 67\n\n5.4 Results . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 70\n5.5 Final Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . 74\n\n6 Sugar Cane Industry Case 81\n6.1 The Hybrid Generation Power System . . . . . . . . . . . . . 82\n6.2 System Modeling . . . . . . . . . . . . . . . . . . . . . . . . . 87\n\n6.2.1 Manipulated Variables . . . . . . . . . . . . . . . . . . 87\n6.2.2 Disturbance Vector . . . . . . . . . . . . . . . . . . . . 88\n6.2.3 System Output . . . . . . . . . . . . . . . . . . . . . . 88\n6.2.4 Stock Flows . . . . . . . . . . . . . . . . . . . . . . . . 88\n6.2.5 Final State-Space Representation . . . . . . . . . . . . 90\n\n6.3 Optimization Problems . . . . . . . . . . . . . . . . . . . . . . 91\n6.3.1 Biomass Mixture Optimization . . . . . . . . . . . . . 92\n6.3.2 Demand Optimization . . . . . . . . . . . . . . . . . . 93\n6.3.3 Control Structure . . . . . . . . . . . . . . . . . . . . . 93\n6.3.4 Final Control Algorithm . . . . . . . . . . . . . . . . . 96\n6.3.5 Simulation Results . . . . . . . . . . . . . . . . . . . . 96\n\n6.4 Final Remarks . . . . . . . . . . . . . . . . . . . . . . . . . . 102\n\n7 Conclusions and Future Works 105\n7.1 Contributions . . . . . . . . . . . . . . . . . . . . . . . . . . . 106\n7.2 Future Work . . . . . . . . . . . . . . . . . . . . . . . . . . . 108\n\nA Simulation Parameters 111\nA.1 Laboratory Microgrid Control . . . . . . . . . . . . . . . . . . 111\nA.2 Networked Microgrids . . . . . . . . . . . . . . . . . . . . . . 113\nA.3 Sugar Cane Industry Case . . . . . . . . . . . . . . . . . . . . 114\n\nxvi\n\n\n\nNomenclature\n\nAcronyms\n\nBS Binary Search\nBSDC Binary Search with Distributed Coordination\nCSMU Charging Station Management Unit\nCMIQP Centralized MIQP\nDMPC Distributed Model Predictive Control\nDNO Distribution Network Operator\nEMS Energy Management System\nMHL Metal Hydrid Level\nMISO Multiple inputs and single input\nMIMO Multiple inputs and multiple outputs\nMIQP Mixed Integer Quadratic Programming\nMLD Mixed Logical Dynamic\nMPC Model Predictive Control\nOLE Object Linking and Embedding\nOPC OLE for Process Control\nPLC Programmable Logic Controller\nQP Quadratic Programming\nSISO Single input and single output\nSIMO Single input and multiple outputs\nSOC State of charge\nSQP Sequential Quadratic Programming\nTIO-MPC Time Instant Optimization - MPC\nV2G Vehicle-to-grid\n\nxvii\n\n\n\n\n\nList of Symbols\n\nIndexes\nr Hub inputs\np Hub outputs\nq Inputs of the input storage units\nm Inputs of the output storage units\ns Storage interface\nL Converters\nE Storage units\nrad Radiation\ng Gas\ne Electricity\nh Heat\nE Model storage flow\nL Model input flow\n+ Storage charging\n? Storage discharging\nc Continuous variable\nl Discrete variable\nH2 Hydrogen\nDNO Distribution Network Operator\nB Battery\nS Solar\nW Wind\nev Electric vehicle\nez Electrolyzer\nfc Fuel cell\nRenewable Renewable energy source\nPV Ch Charging Station photovoltaic energy source\nin Input\n\nxix\n\n\n\nout Output\ni, j Hub index\n?,? Flow direction\ndem Demand\naug Augmented Lagrangian\nfix Fixed values for binary variables\nb binary\nTU Turbine\nC Boiler\nCHP Combined heat and power plant\nCh Chiller\nTC Heat exchanger\nEsc Escape\nNet Network\nProc Process\nSale Sale\nV Steam\nM Middle\nL Low\nVariables\nA,B,C,D State-space system matrices\n? Steady state conversion efficiency of the converter\nnr Number of hub inputs\nnp Number of hub outputs\ne Storage charge/discharge efficiency\nu Model input\nx State vector\ny Model output\n? Binary variable\nz Continuous auxiliary variable\n? Storage coupling matrix\n? Converter coupling matrix\n? Electric vehicle binary variable\nP Power\nw Interconnecting variables\n? Interconnecting matrix\n? Lagrange multipliers\nJ Objective function\nC Objective function cost\nCI Controller instance\n\nxx\n\n\n\nSCI Set of controller instances\nBCI Best cost instance\nQ Weighting matrix\nf Weighting vector\ne Error\n?c, ?b DMPC weights\nN Horizon\nMG Microgrid\nSP Set-point\nWind Wind speed\nIrradin Solar irradiation\nBag Bagasse\nStr Straw\nBg Biogas\n? blending factors\n\nxxi\n\n\n\n\n\nList of Figures\n\n2.1 SISO converter . . . . . . . . . . . . . . . . . . . . . . . . . . 11\n\n2.2 Hub with multiple converters . . . . . . . . . . . . . . . . . . 12\n\n2.3 Energy Hub that contains a photovoltaic panels, a CHP and\na battery bank . . . . . . . . . . . . . . . . . . . . . . . . . . 13\n\n2.4 Hub storage . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13\n\n2.5 Hub with multiple storage units . . . . . . . . . . . . . . . . . 15\n\n2.6 Interconnection variables between hub i and j . . . . . . . . . 23\n\n3.1 MPC block diagram. . . . . . . . . . . . . . . . . . . . . . . . 26\n\n4.1 Number of iterations and calculation time varying Nb. . . . . 47\n\n4.2 Input, output and state variables. (blue - u1, red - y, black -\nu2, magenta - wout) . . . . . . . . . . . . . . . . . . . . . . . 48\n\n5.1 Hylab microgrid . . . . . . . . . . . . . . . . . . . . . . . . . 51\n\n5.2 Control Structure . . . . . . . . . . . . . . . . . . . . . . . . . 55\n\n5.3 Implementation Flowchart . . . . . . . . . . . . . . . . . . . . 56\n\n5.4 Energy sources and storage units - Sunny day . . . . . . . . . 62\n\n5.5 Electric vehicles charge management - Sunny day . . . . . . . 62\n\n5.6 Energy sources and storage units - Cloudy day . . . . . . . . 63\n\n5.7 Electric vehicles charge management - Cloudy day . . . . . . 63\n\n5.8 Energy sources and storage units - Windy day . . . . . . . . . 64\n\n5.9 Electric vehicles charge management - Windy day . . . . . . . 64\n\n5.10 Network of Microgrids . . . . . . . . . . . . . . . . . . . . . . 66\n\n5.11 Control Structure . . . . . . . . . . . . . . . . . . . . . . . . . 68\n\n5.12 Number of iterations and calculation time varying Nb. . . . . 71\n\n5.13 Energy prices . . . . . . . . . . . . . . . . . . . . . . . . . . . 73\n\n5.14 Interconnected simulation energy sources. (blue - renewable\nenergy sources, red - charging station photovoltaic source,\nblack - power exchanged with DNO, cyan - battery power,\ngreen - Demand) . . . . . . . . . . . . . . . . . . . . . . . . . 75\n\nxxiii\n\n\n\n5.15 Isolated simulation energy sources. (blue - renewable energy\nsources, red - charging station photovoltaic source, black -\npower exchanged with DNO, cyan - battery power, green -\nDemand) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 76\n\n5.16 Battery SOC . . . . . . . . . . . . . . . . . . . . . . . . . . . 77\n5.17 Electric vehicles charge management (Isolated Microgrids) . . 77\n5.18 Energy sources during a fault. (blue - renewable energy sources,\n\nred - charging station photovoltaic source, black - power ex-\nchanged with DNO, cyan - battery power) . . . . . . . . . . . 78\n\n5.19 Interconnection variables in the two analyzed scenarios. . . . 79\n5.20 Number of iterations (without fault and during a fault) . . . 79\n\n6.1 Original Power Generation Plant . . . . . . . . . . . . . . . . 83\n6.2 Proposed Power Generation Plant . . . . . . . . . . . . . . . 84\n6.3 Biomass Mixture . . . . . . . . . . . . . . . . . . . . . . . . . 84\n6.4 Proposed Control Structure . . . . . . . . . . . . . . . . . . . 94\n6.5 System Disturbances . . . . . . . . . . . . . . . . . . . . . . . 98\n6.6 Electric power generation of the proposed system . . . . . . . 99\n6.7 Electric power generation of the original system . . . . . . . . 100\n6.8 Fulfillment of the Demands . . . . . . . . . . . . . . . . . . . 100\n6.9 Stocks of the proposed system . . . . . . . . . . . . . . . . . . 101\n6.10 Blending Factors of the proposed system . . . . . . . . . . . . 101\n6.11 Variables involved in steam production (proposed scenario) . 102\n6.12 Variables involved in hot water production (proposed scenario) 102\n\nxxiv\n\n\n\nList of Tables\n\n1.1 Brazilian Internal Energy Offer . . . . . . . . . . . . . . . . . 2\n1.2 Brazilian Internal Electrical Energy Offer . . . . . . . . . . . 3\n\n2.1 Coupling factors meaning . . . . . . . . . . . . . . . . . . . . 11\n\n4.1 Performance Indexes . . . . . . . . . . . . . . . . . . . . . . . 48\n\n5.1 Microgrid Units . . . . . . . . . . . . . . . . . . . . . . . . . . 52\n5.2 Microgrids Components . . . . . . . . . . . . . . . . . . . . . 67\n5.3 Analysis of Nb . . . . . . . . . . . . . . . . . . . . . . . . . . 72\n5.4 Performance Indexes . . . . . . . . . . . . . . . . . . . . . . . 72\n5.5 Energy exchanged with DNO . . . . . . . . . . . . . . . . . . 74\n\n6.1 Microgrid Equipments . . . . . . . . . . . . . . . . . . . . . . 85\n6.2 Microgrid Data . . . . . . . . . . . . . . . . . . . . . . . . . . 85\n6.3 Microgrids Subsystems Operating Points . . . . . . . . . . . . 86\n6.4 Microgrids Storage Units . . . . . . . . . . . . . . . . . . . . . 86\n6.5 Auxiliary Variables Index . . . . . . . . . . . . . . . . . . . . 92\n6.6 Biomass mixtures: Boiler gains and calorific power . . . . . . 93\n6.7 Full-Month Simulation Scenario Details . . . . . . . . . . . . 103\n6.8 Different Daily Simulation Scenarios . . . . . . . . . . . . . . 103\n\nxxv\n\n\n\n\n\nChapter 1\n\nIntroduction\n\nEfficient energy generation and consumption is a key factor to\nachieve ambitious goals for sustainable development and activities re-\nlated to air pollution and climate change. Efficient and safe power\ndistribution along with minimized and balanced electricity power con-\nsumption is nowadays an important part of the economic activity of\nmost countries. One of the largest issues is that generation power\nsystems have to supply energy at greatly varying demands. Abrupt\nchanges in the large-scale energy demand status can cause severe prob-\nlems to production facilities, and since these changes cannot be accu-\nrately predicted they may lead to outages.\n\nEnergy generation fundamentals of today are about to undergo\na profound change: affordable fossil fuel reserves are being reduced\nevery year while, at the same time, energy demand increases in every\ncountry [63]. Moreover, the aim to reduce greenhouse gas emissions is\nmoving its attention to more environmentally-friendly and sustainable\nenergy sources [104]. With an increased utilization of small distributed\nenergy resources for generation of electricity and heat [11], renewable\nenergy generation will constitute an important part of the overall energy\nscenario in the coming years.\n\nNotably, in the instance of this work, the Brazilian energy sce-\nnario will be taken into account. Brazil has an immensely diversified\nenergy matrix. This can be seen in Brazilian energy reports of 2015 [26]\n(related to the energy generation of 2014, seen in table 1.1): hydraulic\nenergy sums up to 11, 5% of total energy generation, almost 16% of\nthe generated energy came from sugar cane (ethanol and electric en-\nergy from biomass) and other bio-energy sources contributed with up\n\n\n\n2 1. Introduction\n\nto 12, 2% of total generation. The rest of Brazilian energy generation\ncorresponds to: natural gas, summing up 13, 5%, petroleum and de-\nrived sources, related with 39, 4%, nuclear sources, corresponding to\n1, 3% and coal, corresponding to 6% of the totality. In respect to the\nBrazilian electric matrix (seen in table 1.2), 74.6% of the total electric\nenergy was generated by renewable energy sources.\n\nThe investment in solar energy has vastly risen in recent years and\nBrazil has good climatological conditions in several regions to explore\nthis kind of energy source, showing competitive costs [108]. Solar and\nwind energies can be considered potential energy sources to enlarge\nthe renewable energy share in the Brazilian electric energy matrix for\nthe next years. According to [24] the share of wind energy in the\ntotal electric energy produced in 2024 will increase to 11.6% (24GW)\nwhile solar energy will contribute with 3.3% (7GW). Beyond that, the\nprospect to next years is that renewable energy sources will increase\ntheir contribution in 84% to the electric energy matrix.\n\nTable 1.1: Brazilian Internal Energy Offer\n\nEnergy Source Structure (%)\nNon-renewable 60.6\n\nPetroleum and derivatives 39.4\nNatural Gas 13.5\n\nMineral Coal and derivatives 5.7\nUranium (U3O8) and derivatives 1.3\n\nOther non-renewable 0.6\n\nRenewable 39.4\nHydraulics and Electricity 11.5\nFirewood and Charcoal 8.1\nSugar Cane derivatives 15.7\n\nOther Renewable 4.1\n\nTotal 100\n\nThe sugar cane and ethanol power plants are particularly signifi-\ncant to this study [53], as the sugar cane process has a great amount of\nresidue that can be treated as biomass. To allow technological improve-\nments [35] and to increase ethanol production, per ton of processed\nsugar cane, the amount of sugar cane fiber made available in the plant\nhas to be as great as possible. A plausible solution to resolve this matter\nis to harvest the crops of cane without pre-burning the crop area, and,\nby this, recover a significant portion of straw available in the canebrakes\n\n\n\n3\n\nTable 1.2: Brazilian Internal Electrical Energy Offer\n\nEnergy Source Structure (%)\nHydraulic 59.8\n\nSugar Cane derivatives 5.2\nWind 2\nSolar 0.003\n\nOther renewable 2.2\n\nPetroleum and derivatives 5.1\nNatural Gas 13.0\n\nMineral Coal and derivatives 2.9\nNuclear 2.5\n\nOther non-renewable 1.9\n\nImported 5.4\n\nTotal 100\n\n[22]. The straw is composed of unseasoned leafs, dry leafs and by the\nsugar cane pointer, and can be used, for example, to boost up heating\nboilers. This biomass is not yet exploited in its plenitude, although this\nsituation will be reversed in the near future, knowing that Brazilian en-\nvironmental legislation [73] predicts gradual prohibition of pre-burning\ncanebrakes. Apart from the straw, the bagasse is also an important\n[2] and useful residue of the sugar cane processing. The bagasse is the\nfinal residue of the compression process to retrieve the sugar cane juice\nand is commonly used in sugar cane energy plants. From the ethanol\nproduction process, it is, in the instance of this work, worth mention-\ning the vinasse. The vinasse [96] represents the residue made available\nafter the distillation of fermented sugar cane broth (garapa). For ev-\nery liter of ethanol produced, 12 liters of vinasse appear as left-overs.\nTypically, the vinasse is used as a fertilizer for newer crops, which is\nactually linked to environmental damaging issues, as contamination of\nsoil and underground water. Even if not often, the vinasse can be used\nas a renewable power source. This is grounded in the technology of\nanaerobic digestion of the vinasse, that ends up transformed in biogas.\nThis biogas can be used in thermodynamical applications: generation\nof heat and power. In sum, there are three very important renewable\nsources of energy in the sugar-ethanol plants: the bagasse, the straw\nand the vinasse.\n\nOne of the main problems associated with these kind of systems\nis the reliability and quality of the power supply. As a matter of fact,\n\n\n\n4 1. Introduction\n\nsince the renewable source is intermittent, unpredictable fluctuations\nmay appear in power output [3]. Also, electrical generation from re-\nnewable sources is not subjected to demand, which creates imbalance\nin the system. One way to overcome this problem is to include inter-\nmediate storage, such as batteries, water pumping, super-capacitors,\ncompressed air, fly wheels, superconducting magnetic energy storage\nunit, etc. [33]. This buffering capability can help to avoid the consid-\neration of renewable as an undispatchable source, due to its inherent\nunpredictability and variability.\n\nThe use of storage systems enables the opportunity to decide the\nmicrogrid optimal operating point both in the islanded and connected\nto the grid modes, being possible to manage the appropriate time to\nexchange energy with the external network. There are several energy\nstorage technologies and the possibility of hybridization among them\nhas aroused great interest [38], [54]. Specifically, the combination of\nhydrogen storage together with electric batteries and supercapacitors\nseems to be a suitable solution for renewable generation [62]. The use of\nhydrogen for storing electrical energy from renewable sources is based\non the possibility of producing hydrogen by electrolysis, store it and\nsubsequently use it again to generate electricity through fuel cells.\n\nA structural solution that has been studied in recent years is\nthe splitting of the electrical network into smaller self-generation units\nbased on renewable energy where the use of energy storage compen-\nsates the fluctuations in renewable generation and the randomness of\nconsumer behavior. Thus, the concept of microgrid, introduced by [68],\nbecomes a powerful tool to improve the electrical system quality and\nreliability. A microgrid is defined as a hybrid system which includes\nseveral sources and storage devices to fulfill the local loads [41]. Ac-\ncording to [86] a microgrid can be seen as a set of loads, generators\nand storage units whose management can be done independently or\nconnected to the external network in a coordinated way to contribute\nto the whole system stability.\n\nOn the other hand, V2G systems (Vehicle-to-grid) consist of the\nuse of electric car batteries, during periods when they are not used, as\nenergy storage units for an electrical network. Taking into account the\ncurrent size of the fleet and the expectation of a gradual increase in the\nnumber of electric vehicles, it is expected that the energy storage ca-\npacity that can be provided in a near future will be sufficient to balance\nthe supply and demand on an electricity grid or microgrid, and hence,\nimprove the performance and stability of the network. According to\nrecent publications of the Brazilian Science, Technology and Innova-\n\n\n\n5\n\ntion Ministry ([23], [25]), the use of electric vehicles connected to the\nsmart grid is a trend for the future and the development of algorithms\nfor managing the use of vehicle batteries is a strategic research area.\n\nIt is estimated that a electric vehicle is in motion only 4% of\ntime, so the rest of the time it could be available as an electrical en-\nergy storage unit [47]. Furthermore, in normal use, the car batteries are\nrecharged overnight (which is the period of low electricity demand) and\nare parked in the workplace during periods of high electrical demand,\nso this power could be used to meet the peak demand. This storage\ncapacity is especially useful with renewable energy sources, as the fluc-\ntuating nature makes it harder to adjust production and demand.\n\nIn addition, the V2G systems enable to set new business models\nin which new actors appear, such as Load Managers that would be\nresponsible for recharging infrastructure, providing service to vehicles,\nbuying or selling electrical energy and building relationships with the\nnetwork managers. In the last years control algorithms for charging\nelectric vehicles in intelligent networks appeared in the literature. In\n[28] and [97] the problem is solved by real-time optimization algorithms,\nwhereas in [52] an MPC-based algorithm is presented. Also solutions\nbased on hierarchical distributed algorithms have been presented ([5];\n[36]; [43]).\n\nRegarding modeling aspects, most part of the algorithms pro-\nposed in literature use very simplified models of power systems, vehicle\nmotion and load characteristics. In particular, the modeling framework\ncalled Energy hubs ([49], [31]) allows the integration of different forms\nof production and storage of a microgrid, V2G system [44] and the\ninterconnection of different microgrids or a microgrid connected to an\nelectric network.\n\nWith an increasing demand on improving productivity and effi-\nciency, the operation requirements of energy systems are getting tighter.\nThis leads to the necessity of investing on automatic operation and\ncontrol of the plants aimed to achieve an enhanced efficiency of the\nwhole plant. It is known that an optimal operation of each subsystem\ncomposing the energy plant does not ensure the optimal operation of\nthe whole system possibly leading to an even not admissible behavior.\nThis makes necessary the coordination between the elements of the\nwhole plant. This is typically carried out by a supervised automatic\nsystem which relies on an upper level in the control hierarchy of the\nplant. Thus, targets of each subsystem are provided by the upper level\nsuch that the quality of the service is ensured and, if possible, opera-\ntion is done close to the optimal operating point. From the efficiency\n\n\n\n6 1. Introduction\n\npoint of view, the best control technique should take into account si-\nmultaneously the efficient operation of each subsystem while quality\nrequirements are fulfilled.\n\nThe development of new results for modeling, identification and\ncontrol of hybrid energy systems including renewable energy would im-\nply a significant improvement in the operation, efficiency and safety\nof this class of relevant systems. Due to the incomplete nature of the\nresults on this topic, new methodologies and strategies are of potential\ngreat relevance in this emerging field.\n\nModel Predictive Control (MPC) is the most natural approach to\nthe optimal control of processes subject to constraints [17]. This ex-\nplains why MPC is the advanced control strategy that has the greatest\nacceptation in process industry. However, there are still many open\nissues related to MPC techniques to be applied to energy systems, such\nas cooperation, robustness, real-time optimization, that must be deeply\nexplored.\n\nIn general, microgrid management is carried out by heuristic al-\ngorithms [55], although there are applications that use MPC strategies,\nsuch as those presented in [38] and [112]. Optimal control of distributed\nenergy resources using model predictive control with battery storage\nsystem is developed in [82]. In the case of hybrid storage systems,\nMPC appears to be a good solution as shown in [30], [115] and [54].\n\nSeveral works ([59]; [126];[51]) use the hysteresis band (HB) method\nfor energy management of microgrids with hybrid storage. Regarding\nthe performance advantages of MPC over optimized hysteresis band,\nthere are several papers comparing these approaches and others ([113];\n[14]; [46]). The main difference between MPC and HB is that MPC\nguarantees optimality while HB does not. MPC solves an optimization\nproblem each sampling time to determine minimal running cost while\nmeeting the demand and considering technical and physical limits. A\ndramatic reduction in operation cost can be observed when comparing\nboth techniques [115].\n\nRecent works have brought to light MPC-based control struc-\ntures used to master microgrids with renewable sources. Reference\n[114] shows a hydrogen-based domestic microgrid being controlled by\nan MPC-based structure; [45] and [93] also refer to optimal generation\nfor renewable microgrids, considering hydrogen storage systems. [42]\nconsiders plug-in hybrid electric vehicles based on multi-carrier systems\nand [75] proposes a MPC to energy management of a microgrid con-\nnected to an electric vehicle charging station. In terms of renewable\nsource applications, [44] is specific about wind balancing capabilities\n\n\n\n7\n\nusing heuristics and MPC, whereas [76] focuses on a renewable micro-\ngrid in an isolated load area. Generic MPC-based structures are seen\nin [4] and [92]. Economic optimization is exposed in [15] and [91].\nCogeneration is discussed in [106] and [101].\n\nRecent studies have shown that connecting multiple microgrids\ncan further improve the system operation and reliability ([85], [37],\n[121]). Those benefits are assigned to some properties of networked\nmicrogrids, such as coordinated energy management and interactive\nsupport and exchange. According to [122], self-healing capability intro-\nduced by interconnecting microgrids, is an important feature in smart\ngrids, especially when a fault occurs in a part of the system.\n\nThe study of interconnected microgrids is a growing research field.\nA centralized control model for optimal management and operation of\na smart network of microgrids was presented in [88]. [83] and [77]\naddressed the optimal power dispatch problem considering uncertain-\nties in load and probabilistic modeling of generated power by renewable\nsmall-scale energy resources. A review on distributed control techniques\nfor all hierarchy levels and a discussion of future research trends in this\narea was presented in [125]. A game theoretic coalition formulation\nstrategy was proposed in [123] to allow the microgrids autonomously\ncooperate and self-organize into coalitions. In [121] a bi-level stochas-\ntic solution for the coordinated operation of multiple microgrids and a\ndistribution system is presented. A self-healing operation mode based\non average consensus algorithm for optimal operation of autonomous\nnetworked microgrids was developed in [122]. In [105] a distributed\nenergy management system for the optimal operation of alternating\ncurrent (AC) microgrids was designed with consideration of the under-\nlying power distribution network and the associated constraints.\n\nDue to the complexity of large-scale networks, the distribution of\nthe control effort between local control agents can be a very convenient\nchoice. In many cases, parts of the network belong to different organi-\nzations, which makes centralized control impossible to be implemented\n[31]. In interconnected microgrids scenario the coordination among\nall microgrids and between the microgrids and Distribution Network\nOperator (DNO) brings new challenges for the overall system energy\nmanagement. In this scenario a distributed control structure becomes\na good option for sharing information about energy exchange to de-\ncide the optimal operating point for the whole system. In the last\nyears many distributed control techniques were proposed in literature\n([71],[72],[1],[18]).\n\nThe control of hybrid energy systems including renewable and\n\n\n\n8 1. Introduction\n\nnon-renewable generation is an important problem to be studied in the\nfollowing years to allow the optimal operation of these new generation\nunits. The integration of V2G systems can be a key factor in network\nstability guarantee against load fluctuations. In this context this thesis\naims to contribute with this research area through the study and devel-\nopment of control algorithms applied to renewable energy microgrids.\n\n1.1 Objectives and Organization of the The-\nsis\n\nThis thesis has a general objective to develop MPC algorithms to\nthe economic management of hybrid energy systems based on renewable\nenergy sources. The specific objectives are:\n\n1. Model hybrid energy systems integrating renewable energy sources\n(wind and solar), hybrid storage units (batteries, hydrogen and\nbiomass) and electric vehicles (V2G).\n\n2. Develop load controllers strategies and manage the electric vehi-\ncles batteries usage as energy storage connected to microgrid in\nthe context of V2G systems.\n\n3. Apply the control algorithms to an experimental microgrid lo-\ncated at the Departamento de Ingenier??a de Sistemas y Automa?tica\n(DISA) of the Universidad de Sevilla (US) in Seville, Spain.\n\n4. Develop an Hybrid MPC and Distributed MPC strategies for the\noptimal economic management of single grid-connected micro-\ngrids and networked microgrids respectively.\n\n5. Apply these techniques in a Brazilian case study of hybrid power\nplants in sugar cane distilleries.\n\nThis thesis is organized as follows. In Chapter 2 the energy hub\nmodeling framework is described. Chapter 3 presents a review of MPC,\nHybrid MPC and Distributed MPC Strategies. Chapter 4 proposes an\nHybrid Distributed MPC algorithm. Chapter 5 focuses on the applica-\ntion of modeling and control methodologies described in previews chap-\nters to the problem of single grid-connected microgrid and networked\nmicrogrids. Finally, chapter 6 presents the case of hybrid power plants\nin sugar cane distilleries and the use of the discussed techniques to opti-\nmize their operation. The thesis ends with some conclusions presented\nin chapter 7.\n\n\n\nChapter 2\n\nEnergy Hubs Modeling\nFramework\n\nThis chapter presents a literature review of the energy hub mod-\neling methodology, introduced in [48]. An energy hub can be used to\nmodel the interface between energy producers, consumer and the trans-\nmission line. From the standpoint of the system, an energy hub can be\nidentified as a unit that provides the following features:\n\n1. input and output power;\n\n2. energy conversion;\n\n3. energy storage.\n\nThe hub serves as interface between the energy sources, producers\nand consumers or between the different energy sources. In practice a\nmicrogrid can be modeled as a hub and a power system can be divided\nin many microgrids interconnected by transmission lines, where each\nnetwork node corresponds to one hub. The system model is designed\nin two parts: power flow within and between hubs. The model is based\non some assumptions and simplifications:\n\n\u2022 it is considered that the network is in steady state. Such a state is\nachieved after the end of all transitory dynamics and all variables\noscillate uniformly or remain essentially constant;\n\n\u2022 the interconnection between hubs is carried out through inputs\nand outputs interconnection;\n\n\n\n10 2. Energy Hubs Modeling Framework\n\n\u2022 losses only occur in converter and storage unit elements;\n\n\u2022 within a hub, it is assumed that the flow is unidirectional from\nthe inputs to the outputs of the converters, except when consid-\nering the storage elements, where the bidirectional flow (charge/\ndischarge) is allowed.\n\n2.1 Modeling Framework\n\nHereafter the modeling of converters and storage elements will be\npresented. For a description of input and output variables a standard\nbased on the generic variable:\n\ng\nsup\nsub\n\n(k) (2.1)\n\nwas used, where g can be represented by y for outputs and u for inputs.\nWhen sub-index sub refers to input variables the letter r will be used;\nfor hub outputs, the letter p; to the inputs of the inputs storage units,\nthe letter q; for inputs of the output storage units, the letter m; and\nfor storage interface the letter s. The super-index sup is the element\ntype that the variable belongs, being L for converters and E to storage\nunits.\n\n2.1.1 Converters\n\nInput-output conversion can be described considering the con-\nverter as a black box. Converter combinations can lead to different\nhub input-output settings according the following four cases below:\n\n\u2022 single input and single output (SISO);\n\n\u2022 single input and multiple outputs (SIMO);\n\n\u2022 multiple inputs and single input (MISO);\n\n\u2022 multiple inputs and multiple outputs (MIMO).\n\nA single converter can be seen as presented in figure 2.1. This\nelement converts, in every time instant k, a generic r input flow uLr (k)\nof a generic hub into a generic p output flow yp(k), where superscript L\nis associated to converter input flows. The input-output conversion is\n\n\n\n2.1. Modeling Framework 11\n\ndefined through coupling factors ?Lp,r, which correspond to steady state\nconversion efficiency of the converter between the input and output\nflows:\n\nFigure 2.1: SISO converter\n\nyp(k) = ?\nL\np,ru\n\nL\nr (k) (2.2)\n\nwith uLr (k) > 0, which implies unidirectional flow from the input to\nthe output of a converter. From a physical point of view, coupling fac-\ntors have the meaning listed in table 2.1, considering lossy, lossless and\ngainy conversions. When considering applications where flow conserva-\ntion laws have to be fulfilled (such as energy-related systems), coupling\nfactors are limited in the sense that the output of a converter element\nmust be less than or equal to the input:\n\nyp(k) ? u\nL\nr (k) ? 0 ? ?\n\nL\np,r ? 1 (2.3)\n\nTable 2.1: Coupling factors meaning\n\nType of converter Coupling factor\nLossy conversion 0 ? ?Lp,r ? 1\nLossless conversion ?Lp,r = 1\nGainy conversion ?Lp,r ? 1\n\nConsidering the converter model described above, a generic hub\nis composed of a converter cluster, shown in figure 2.2, linking all\nflow inputs uL(k) =\n\n{\nuL1 (k), . . . , u\n\nL\nnr\n(k)\n\n}\nwith all flow outputs y(k) =\n\n{\ny1(k), . . . , ynp(k)\n\n}\n, where nr and np are the total number of hub in-\n\nputs and outputs respectively. A set of converters is expressed by the\nconverter coupling matrix ?L, which describes the flows from the input\nto the output and is composed by the converter coupling factors ?Lp,r.\n\n\n\n12 2. Energy Hubs Modeling Framework\n\nFigure 2.2: Hub with multiple converters\n\n?\n\n?\n?\n\ny1(k)\n...\n\nynp(k)\n\n?\n\n?\n?\n\n? ?? ?\n\ny(k)\n\n=\n\n?\n\n?\n?\n\n?L1,1 \u00b7 \u00b7 \u00b7 ?\nL\n1,nr\n\n...\n...\n\n...\n?Lnp,1 \u00b7 \u00b7 \u00b7 ?\n\nL\nnp,nr\n\n?\n\n?\n?\n\n? ?? ?\n\n?L\n\n?\n\n?\n?\n\nuL1 (k)\n...\n\nuLnr(k)\n\n?\n\n?\n?\n\n? ?? ?\n\nuL(k)\n\n(2.4)\n\nAs the coupling factors are assumed constant, equations (2.2) and\n(2.4) result in linear relations.\n\nApplication example\nIn this example, the concepts presented above are applied to\n\nmodel the energy hub shown in figure 2.3, composed of a photovoltaic\npanels, a CHP (combined heat and power plant) and a battery bank.\nFirst input uL1 (k) is referred to solar radiation, while second input u\n\nL\n2 (k)\n\nis referred to natural gas. First and second outputs y1(k), y2(k) are re-\nferred to electricity and heat demand respectively. Hub inputa?output\ndescription is obtained utilizing the converter coupling matrix ?L in\nequation (2.5).\n\n[\ny1(k)\ny2(k)\n\n]\n\n=\n\n[\n?L1,1 ?\n\nL\n1,2\n\n0 ?L2,2\n\n] [\nuL1 (k)\nuL2 (k)\n\n]\n\n(2.5)\n\nIn the example application described herein, coupling factors have\nthe physical meaning of energy conversion efficiencies ?. Specifically,\nthe photovoltaic panels are characterized by its radiationa? electric con-\nversion efficiency ?Srad,e. Analogously, the CHP is characterized by its\n\ngasa?electric conversion efficiency ?CHPg,e and its gas-heat conversion effi-\n\nciency ?CHPg,h . This way the converter coupling matrix has the following\nform:\n\n\n\n2.1. Modeling Framework 13\n\nFigure 2.3: Energy Hub that contains a photovoltaic panels, a CHP and a\nbattery bank\n\n? =\n\n[\n?Srad,e ?\n\nCHP\ng,e\n\n0 ?CHPg,h\n\n]\n\n(2.6)\n\n2.1.2 Storage Units\n\nThe modeling of a generic storage considers that the device is\ncomposed of an interface and an internal storage, as shown in figure\n2.4. The interface can be seen as a flow converter, which modulates a\ngeneric storage interface input flow uEs (k) into another generic storage\ninterface output flow u?Es (k). The converted energy is then stored in an\nideal internal stage. Mathematically, the storage interface is modeled\nanalogously to a converter device, where the steady-state input-output\nflow values are described by the relation:\n\nFigure 2.4: Hub storage\n\nu?Es (k) = es(k)u\nE\ns (k) (2.7)\n\n\n\n14 2. Energy Hubs Modeling Framework\n\nwhere es(k) represents the efficiency of the charge/discharge interface s\nof the Hub, which describes how much of the flow exchanged with the\nsystem affects the storage. This factor depends on the direction of the\nexchanged flow, if the storage is being charged or discharged:\n\nes(k) =\n\n{\ne+s if u\n\nE\ns (k) ? 0 (charging)\n\ne?s else (discharging)\n(2.8)\n\nwhere e+s and e\n?\ns are respectively the charging and discharging efficien-\n\ncies.\nFrom a discrete-time point of view, internal storage state xs at\n\nsampling time k + 1 depends on the state at previous sample k and on\nthe total exchanged flow u?Es (k) during the period ?T ranging from k\nto k + 1, assuming u?Es (k) to remain constant during ?T :\n\nxs(k + 1) = xs(k) + u?\nE\ns (k)?T (2.9)\n\nThus, vector xs(k + 1) containing all the storage states xs(k +\n1); s = 1, . . . , ns depends on the state vector at previous time step\nxs(k), on matrix ?\n\nE(k) containing all the interface efficiencies es(k); s =\n1, . . . , ns and on vector u\n\nE\ns (k) containing all the interface flow inputs\n\nuEs (k); s = 1, . . . , ns, where ns is the total number of storage elements:\n\n?\n\n?\n?\n\nx1(k + 1)\n...\n\nxns(k + 1)\n\n?\n\n?\n?\n\n? ?? ?\n\nxs(k+1)\n\n=\n\n?\n\n?\n?\n\nx1(k)\n...\n\nxns(k)\n\n?\n\n?\n?\n\n? ?? ?\n\nxs(k)\n\n+\n\n?\n\n?\n?\n\ne1(k)\n\n...\n\nens(k)\n\n?\n\n?\n?\n\n? ?? ?\n\n?E(k)\n\n?\n\n?\n?\n\nuE1 (k)\n...\n\nuEns(k)\n\n?\n\n?\n?\n\n? ?? ?\n\nuEs (k)\n\n(2.10)\n\nwhere\n\n?E(k) =\n{\n?E+, ?E?\n\n}\n=\n\n?\n\n?\n?\n\n{\ne\n+\n1 , e\n?\n1\n\n}\n\n...\n{\ne+ns, e\n\n?\nns\n\n}\n\n?\n\n?\n? (2.11)\n\nwhere each element of ?E(k) is a signal function of uEs (k), so, if u\nE\ns (k)\n\nis positive this means that the storage is charging and es(k) = e\n+\ns , oth-\n\nerwise uEs (k) ? 0 and the storage is discharging and es(k) = e\n?\ns .\n\nMultiple Storage\n\n\n\n2.1. Modeling Framework 15\n\nAs storage elements may be connected to both hub inputs and\noutputs, as shown in figure 2.5, a mathematical transformation of the\ncorresponding storage flows has to be performed in order to obtain an\ninput-output description independently of where the storage device is\nphysically connected.\n\nFigure 2.5: Hub with multiple storage units\n\nAs shown in figure 2.5, the flow u?Lr (k) entering the converter is\nequal to the hub input flow uLr (k) minus the input side storage flow\nuEq (k):\n\nu?Lr (k) = u\nL\nr (k)?u\n\nE\nq (k). (2.12)\n\nThe converter output can be described as:\n\ny?p(k) = yp(k) + u\nE\nm(k) (2.13)\n\nwhere y?p(k) is the converter output flow, yp(k) is the hub output flow\nand uEm(k) is the output storage flow. Using equation (2.2) in this case\ngives:\n\ny?p(k) = ?\nL\np u?\n\nL\nr (k). (2.14)\n\nSubstituting equations (2.12) and (2.13) into (2.14), both con-\nverter sides storage flows can be explicitly included in the following\ninput-output description:\n\nyp(k) = ?\nL\np,r\n\n(\nuLr (k)?u\n\nE\nq (k)\n\n)\n?uEm(k) = ?\n\nL\np,ru\n\nL\nr (k) + ?\n\nE\np,ru\n\nE\nr (k),(2.15)\n\n\n\n16 2. Energy Hubs Modeling Framework\n\nwhere ?Ep,r are the coupling factors related to storage variables u\nE\nr (k).\n\nVector y(k) contains all hub outputs yp(k) ?\n{\ny1(k), . . . , ynp(k)\n\n}\nand\n\ncan be extended in order to include storage elements through the stor-\nage coupling matrix ?E. Such a matrix describes how changes of the\nstorage flows affect the converter output flows, resulting in 2.16.\n\n?\n\n?\n?\n\ny1(k)\n...\n\nynp(k)\n\n?\n\n?\n?\n\n? ?? ?\n\ny(k)\n\n=\n\n?\n\n?\n?\n\n?L1,1 \u00b7 \u00b7 \u00b7 ?\nL\n1,nr\n\n...\n...\n\n...\n?Lnp,1 \u00b7 \u00b7 \u00b7 ?\n\nL\nnp,nr\n\n?\n\n?\n?\n\n? ?? ?\n\n?L\n\n?\n\n?\n?\n\nuL1 (k)\n...\n\nuLnr(k)\n\n?\n\n?\n?\n\n? ?? ?\n\nuL(k)\n\n(2.16)\n\n+\n\n?\n\n?\n?\n\n?E1,1 \u00b7 \u00b7 \u00b7 ?\nE\n1,ns\n\n...\n...\n\n...\n?Enp,1 \u00b7 \u00b7 \u00b7 ?\n\nE\nnp,ns\n\n?\n\n?\n?\n\n? ?? ?\n\n?E\n\n?\n\n?\n?\n\nuE1 (k)\n...\n\nuEns(k)\n\n?\n\n?\n?\n\n? ?? ?\n\nuE(k)\n\nApplication example\nConsider the hub shown in figure 2.3, which is composed of two\n\nconverters and one storage device: photovoltaic panels, CHP and bat-\ntery bank. The state x1(k) is related to the battery bank state of charge\nwhile the input uE1 is related to the charging/discharging interface. As\ndescribed herein, state variables can be modeled as:\n\nx1(k + 1) = x1(k) + e1(k)u\nE\n1 (k) (2.17)\n\nwhere\n\ne1(k) =\n\n{\ne\n+\n1 if u\n\nE\n1 (k) ? 0 (charging)\n\ne\n?\n1 else (discharging)\n\n(2.18)\n\nwith e+1 being the charge efficiency and e\n?\n1 the discharge efficiency.\n\nIncluding the storage input into the equation (2.5), results in:\n\n[\ny1(k)\ny2(k)\n\n]\n\n=\n\n[\n?L1,1 ?\n\nL\n1,2\n\n0 ?L2,2\n\n] [\nuL1 (k)\nuL2 (k)\n\n]\n\n+\n\n[\n?1\n0\n\n]\n\nuE1 (k) (2.19)\n\nwhen the battery bank is charging (uE1 ? 0) the direction of energy\n\n\n\n2.2. Mixed Logical Dynamical Systems (MLD) 17\n\nflow is from the converters to the storage, otherwise (uE1 &lt;0) and the\nstorage is providing energy to the first output.\n\n2.1.3 State-space Representation\n\nSummarizing equations (2.11) and (2.16) yields to a complete\nstate-state representation of a generic hub:\n\nx(k + 1) = x(k) + ?E(k)uE(k) (2.20)\n\ny(k) = ?LuL(k) + ?EuE(k),\n\nwhich can be condensed by defining the complete converter interface\nefficiency matrix ?i(k), the complete coupling matrix ?i and the com-\nplete hub input vector ui(k) as follows:\n\n?(k) =\n[\n0 ?E(k)\n\n]\n(2.21)\n\n? =\n[\n?L ?E\n\n]\n\nu(k) =\n[\nuL(k)T uE(k)T\n\n]T\n,\n\nwhich results in the following representation:\n\nx(k + 1) = x(k) + ?(k)u(k) (2.22)\n\ny(k) = ?u(k).\n\nUsing this formulation, a generic network hub can be described\nby the set of matrices H = {?(k), ?}.\n\n2.2 Mixed Logical Dynamical Systems (MLD)\n\nThis section is a literature review about Mixed Logical Dynamic\nsystems based in [7]. According to [29], the state-space representation\nof equation (2.22) is not linear as it includes bilinear terms related\nto equation (2.7) and (2.8). In order to avoid these terms, the state\nspace representation can be transformed into a Mixed Logical Dynamic\nsystem (MLD) [7], where logic, dynamics and constraints are integrated\naccording to:\n\n\n\n18 2. Energy Hubs Modeling Framework\n\nx(k + 1) = Ax(k) + B1u(k) + B2?(k) + B3z(k) (2.23)\n\ny(k) = Cx(k) + D1u(k) + D2?(k) + D3z(k) (2.24)\n\nE2?(k) + E3z(k) ? E1u(k) + E4x(k) + E5 (2.25)\n\nwhere x(k) =\n[\nxc(k) xl(k)\n\n]T\nis the state vector with xc(k) ? ?\n\nnc\n\nand xl ? {0, 1}\nnl, y(k) =\n\n[\nyc(k) yl(k)\n\n]T\nis the output vector with\n\nyc(k) ??\npc and yl(k) ?{0, 1}\n\npl, u(k) =\n[\nuc(k) ul(k)\n\n]T\nis the input\n\nvector with uc(k) ??\nmc and ul(k) ?{0, 1}\n\nml, z(k) ??rc are the con-\ntinuous auxiliary variables, ?(k) ?{0, 1}\n\nrl are the binary auxiliary vari-\nables, A, B1, B2, B3, C, D1, D2, D3, E1, E2, E3 and E4 are constant\nreal matrices, E5 is a real vector, nc > 0 and pc, mc, rc, nl, pl, ml, rl > 0.\nThe auxiliary variables are new variables introduced in the model to\ntransform the original model into a MLD model.\n\nMDL systems are able of modeling a broad class of systems, as the\nenergy hubs described previously. In order to transform the nonlinear\nmodel (2.22) into an MDL description, some basics on propositional\ncalculus and linear integer programming [7] should be firstly revised.\nTo that end, consider the statement X , [f(x) ? 0], where f : Rn ? R\nis linear, assume that x ? X, where X is a given bounded set, and\ndefine:\n\nM , max\n????\n\nx?X\n\nf(x) (2.26)\n\nm , min\n????\n\nx?X\n\nf(x) (2.27)\n\nIt is easy to verify that\n\n[f(x) ? 0]? [? = 1] is true iff f(x)? ? ??1 + m(1? ?) (2.28)\n\n[f(x) ? 0]? [? = 1] is true iff f(x) ? M?\n\n? [f(x) ? 0] is true iff f(x) ? ?\n\nwhere ? is a small tolerance beyond which the constraint is regarded\nas violated and standard Boolean algebra is utilized, which enables\n\n\n\n2.2. Mixed Logical Dynamical Systems (MLD) 19\n\nstatements X such as \u201cx > 0\u201d to be combined in compound statements\nby means of connectives: \u201c?\u201d (and), \u201c?\u201d (or), \u201c?\u201d (not), \u201c?\u201d (implies),\n\u201c?\u201d (if and only if). By property\n\nX1 ? X2 is the same as ? X1 ?X2 (2.29)\n\nand (2.28), it also follows\n\n[f(x) ? 0] ? [? = 1] is true iff f(x) ? ? + (m? ?)? (2.30)\n\n[f(x) ? 0] ? [? = 1] is true iff\n\n{\nf(x) ? M(1? ?)\n\nf(x) ? ? + (m? ?)?\n(2.31)\n\nFollowing the reasoning, it is possible to transform products of log-\nical variables, and of continuous and logical variables, in terms of linear\ninequalities, which can be done by the introduction of some auxiliary\nvariables. Specifically, the generic product term ?1?2 can be replaced\nby an auxiliary logical variable ?3 , ?1?2. Then, [?3 = 1] ? [?1 =\n1]? [?2 = 1], and therefore\n\n?3 = ?1?2 is equivalent to\n\n?\n\n?\n\n?\n\n??1 + ?3 ? 0\n??2 + ?3 ? 0\n\n?1 + ?2 ? ?3 ? 1\n(2.32)\n\nAlso, the term ?f(x), where f : ?n ? ?, can be replaced by an\nauxiliary real variable y , ?f(x), which satisfies [? = 0] ? [y = 0],\n[? = 1] ? [y = f(x)]. Thus, y = ?f(x) is equivalent to\n\ny ? M? (2.33)\n\ny ? m? (2.34)\n\ny ? f(x)?m(1? ?) (2.35)\n\n\n\n20 2. Energy Hubs Modeling Framework\n\ny ? f(x)?M(1? ?) (2.36)\n\nwhere M and m are defined as in (2.26) and (2.27).\n\n2.2.1 MLD Procedure applied to Storage Modeling\n\nAccording to [29], in order to convert the bilinear equation (2.7)\nin the MLD form and taking into account the concepts of propositional\ncalculus and integer linear programming, the following steps are per-\nformed:\n\n1. Condition uEs (k) ? 0 is associated with the binary variable ?s(k)\nso that\n\n[?s(k) = 1] ?\n[\nuEs (k) ? 0\n\n]\n(2.37)\n\nUsing transformations (2.30) and (2.31), equation (2.37) is repre-\nsented by inequalities\n\n?ms?s(k) ? u\nE\ns (k)?ms\n\n?(Ms + ?)?s(k) ??u\nE\ns (k)? ?\n\nwhere ? is a positive scalar and\n\nms , min????\nk??,s?Ns\n\nuEs (k)\n\nMs , max????\nk??,s?Ns\n\nuEs (k)\n\nand Ns is the storage units set.\n\n2. A new variable is defined zs(k) = u\nE\ns (k)?s(k) which can be rep-\n\nresented as\n\nzs(k) ? Ms?s(k)\n\nzs(k) ? ms?s(k)\n\nzs(k) ? u\nE\ns (k)?ms(1? ?s(k))\n\nzs(k) ? u\nE\ns (k)?Ms(1? ?s(k))\n\n\n\n2.2. Mixed Logical Dynamical Systems (MLD) 21\n\n3. The system evolution, (2.20), can be described by the following\nlinear relationships:\n\nxs(k + 1) = xs(k) + e\n?\ns u\n\nE\ns (k) +\n\n(\ne+s ?e\n\n?\ns\n\n)\nzs(k)\n\nIt should be noted that when uEs (k) > 0 so ?s(k) = 1 and\nconsequently zs(k) = u\n\nE\ns and equation results in xs(k + 1) =\n\nxs(k) + e\n+\ns u\n\nE\ns (k). When u\n\nE\ns (k) &lt;0 so ?s(k) = 0 and zs(k) = 0\n\nand model results in xs(k + 1) = xs(k) + e\n?\ns u\n\nE\ns (k) satisfying the\n\nimposed modeling conditions, but with a linear model.\n\nVector x(k+1) containing all the storage states, which was previ-\nously described by the nonlinear equation (2.10), can also be described\nby the following linear relationships:\n\n?\n\n?\n?\n\nx1(k + 1)\n...\n\nxns(k + 1)\n\n?\n\n?\n?\n\n? ?? ?\n\nx(k+1)\n\n=\n\n?\n\n?\n?\n\nx1(k)\n...\n\nxns(k)\n\n?\n\n?\n?\n\n? ?? ?\n\nx(k)\n\n+\n\n?\n\n?\n?\n\ne\n?\n1\n\n...\n\ne?ns\n\n?\n\n?\n?\n\n? ?? ?\n\n?E?\n\n?\n\n?\n?\n\nuE1 (k)\n...\n\nuEns(k)\n\n?\n\n?\n?\n\n? ?? ?\n\nuE(k)\n\n(2.38)\n\n+\n\n?\n\n?\n?\n\ne\n+\n1 ?e\n\n?\n1\n\n...\n\ne+ns ?e\n?\nns\n\n?\n\n?\n?\n\n? ?? ?\n\n?E+??E?\n\n?\n\n?\n?\n\nz1(k)\n...\n\nzns(k)\n\n?\n\n?\n?\n\n? ?? ?\n\nz(k)\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n?M\nm\n?m\nM\n?m\n\n?(M + ?(\u00b7))\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n? ?? ?\n\nE?\n\n?\n\n?\n?\n\n?1(k)\n...\n\n?ns(k)\n\n?\n\n?\n?\n\n? ?? ?\n\n?\n\n+\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n1(\u00b7)\n?1(\u00b7)\n1(\u00b7)\n?1(\u00b7)\n0(\u00b7)\n0(\u00b7)\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n? ?? ?\n\nEz\n\n?\n\n?\n?\n\nz1(k)\n...\n\nzns(k)\n\n?\n\n?\n?\n\n? ?? ?\n\nz(k)\n\n?\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n0(\u00b7)\n0(\u00b7)\n1(\u00b7)\n?1(\u00b7)\n1(\u00b7)\n?1(\u00b7)\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n? ?? ?\n\nEEu\n\n?\n\n?\n?\n\nuE1 (k)\n...\n\nuEns(k)\n\n?\n\n?\n?\n\n? ?? ?\n\nuE(k)\n\n+\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n0(\u00b7)f\n0(\u00b7)f\n?mf\nMf\n?mf\n??(\u00b7)f\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n? ?? ?\n\nE0\n\n\n\n22 2. Energy Hubs Modeling Framework\n\nwhere,\n\nM =\n\n?\n\n?\n?\n\nM1\n...\n\nMns\n\n?\n\n?\n? , Mf =\n\n?\n\n?\n\nM1\n\u00b7 \u00b7 \u00b7\nMns\n\n?\n\n? ,\n\nm =\n\n?\n\n?\n?\n\nm1\n...\n\nmns\n\n?\n\n?\n? , mf =\n\n?\n\n?\n\nm1\n\u00b7 \u00b7 \u00b7\nmns\n\n?\n\n? ,\n\na(\u00b7) =\n\n?\n\n?\n?\n\na\n\n...\n\na\n\n?\n\n?\n? , a(\u00b7)f =\n\n?\n\n?\n\na\n\u00b7 \u00b7 \u00b7\na\n\n?\n\n?\n\nwhere a(\u00b7) is a matrix with dimension ns \u00d7 ns and a(\u00b7)f is a column\nvector with ns rows.\n\nIntroducing equation (2.16) related to coupling factors and using\nthe condensed formulation (2.21), a generic hub can be expressed by the\nfollowing MDL form, which is analogous to the nonlinear state-space\nrepresentation in equation (2.22).\n\nx(k + 1) =Ax(k) + ?E?uE(k) +\n(\n?E+ ??E?\n\n)\nz(k) (2.39)\n\ny(k) =?LuL(k) + ?EuE(k) (2.40)\n\nE??+Ezz(k) ? E\nE\nu u\n\nE(k) + E0 (2.41)\n\n2.3 Interconnected Energy Hubs\n\nConsider a generic network composed of a set N = 1, . . . , nN of\ninterconnected hubs, where nN is the total number of hubs composing\nthe network. The dynamics of sub-network i ? N can be defined by\nthe following nonlinear time-invariant discrete-time state-space model:\n\nxi(k + 1) =xi(k) + ?i(k)ui(k) (2.42)\n\nyi(k) =?iui(k) + ?in,i?jwin,i?j(k), (2.43)\n\nwhere win,i?j(k) ? R\nnv is the interconnecting inputs vector and ?in,i?j ?\n\nRnp\u00d7nv is the input interconnecting matrix, np and nv are the total\nnumber of hub outputs and interconnecting constraints, respectively.\n\n\n\n2.3. Interconnected Energy Hubs 23\n\nThe \u201d\u2018?\u201d\u2019 indicates the power flow direction between the hub j and\nthe hub i. As discussed previously such a nonlinear state-space model\ncan be expressed in the following MDL form:\n\nxi(k + 1) =xi(k) + ?\nE?\ni u\n\nE\ni (k) +\n\n(\n?E+i ??\n\nE?\ni\n\n)\nzi(k) (2.44)\n\nyi(k) =?\nL\ni u\n\nL\ni (k) + ?\n\nE\ni u\n\nE\ni (k) + ?in,i?jwin,i?j(k) (2.45)\n\nEi,??i+Ei,zzi(k) ? E\nE\ni,uu\n\nE\ni (k) + Ei,0. (2.46)\n\nConsidering the interconnections among hubs, generic intercon-\nnecting variables between hub i and its neighbor j can be defined as\nseen in figure 5.19, where win,i?j(k) and wout,i?j(k) are, respectively,\ngeneric interconnecting input and output vectors of hub i related to its\nneighboring hub j, with:\n\nFigure 2.6: Interconnection variables between hub i and j\n\nwout,i?j(k) = ?out,i?jyi(k) (2.47)\n\nwhere ?out,i?j is the output interconnecting matrix referred to the cou-\npling of hub i with respect to its neighbor j. The \u201d\u2018?\u201d\u2019 indicates the\npower flow direction between the hub i and the hub j. Also, win,i?j(k)\nand wout,i?j(k) are defined as vectors containing, respectively, all inter-\nconnecting inputs and outputs of hub i with respect to its neighboring\nhub set Ni = 1, . . . , nNi. Also, interconnecting constraints have to be\nintroduced, as the interconnecting inputs of hub i with respect to hub\nj must be equal to the interconnecting outputs of hub j with respect\nto hub i, which results in the following equalities:\n\nwin,i?j(k) = wout,j?i(k) (2.48)\n\nwout,i?j(k) = win,j?i(k) (2.49)\n\n\n\n24 2. Energy Hubs Modeling Framework\n\nTaking into account the interconnections among hubs described\nabove, a generic hub i, part of network N, can then be described by\nthe set of matrices Hi = ?i, ?i, ?in,i?j, ?out,i?j.\n\n2.4 Final Remarks\n\nIn this chapter a literature review about energy hubs modeling\ntheory and its representation by MLD equations was presented, which\nis a important tool to model microgrids. In the chapter 3 a review on\nmodel predictive control applied to hybrid systems will be presented\nwhere the models developed here will be considered.\n\n\n\nChapter 3\n\nModel Predictive\nControl (MPC)\n\nThis chapter presents some concepts of model predictive control\n(MPC). First the state space MPC algorithm is revisited and some\nbasic characteristics are broached. Then the idea of distributed MPC\nis discussed and the Lagrange based DMPC algorithm is presented.\nFinally a framework to Hybrid distributed MPC is proposed and a\nconvergence analysis is performed.\n\n3.1 State Space MPC\n\nMPC has emerged in the last two decades as a powerful practi-\ncal control technique. It is one of the few advanced control techniques\nthat have achieved significant impact on industrial process control. The\nmain reason for this success is, perhaps, the ability of MPC to deal with\nthe following situations: the possibility to be applied in SISO (single\ninput single output) and MIMO (multiple inputs multiple outputs) sys-\ntems, feedback and feedforward actions can be included directly in the\nMPC formulation, soft and hard constraints can be included in the\nformulation of the control law through online optimization and the in-\ntrinsic compensation of process dead times [84].\n\nMPC is not a specific control strategy, but is the name given to a\nvery large set of control methods that have been developed considering\nsome common ideas and based on the concept of prediction. Figure 3.1\nshows the MPC general structure. From the past values of process in-\n\n\n\n26 3. Model Predictive Control (MPC)\n\nput and output, future predictions can be calculated using a prediction\nmodel. The prediction model is the most important controller element,\nonce it must be able to represent the process dynamics. In the linear\ncase, the process output prediction can be separated into two parts:\nthe free response that corresponds to the output prediction when only\npast values of the input are considered and the future control is con-\nstant and, the forced response that is obtained assuming null values for\nthe past inputs and variations in the future control action. With the\nvalues of future predictions, future reference, process constraints and\nobjective function, an optimization module computes the control signal\nto be applied to the process in the next step. Generally the purpose\nof the objective function is to minimize the error between the output\nprediction and the desired reference penalizing control effort [17]. The\nreceding horizon strategy is other important property of the MPC, as\nonly the first element of the obtained control vector is applied to the\nplant and the procedure is repeated on the next sample.\n\nFigure 3.1: MPC block diagram.\n\nAll MPC algorithms have some elements in common, being: the\nprediction model, the objective function and a method for obtaining the\ncontrol law. Different controllers in the literature differ in the way in\nwhich these elements are found [17]. Hereafter some of these concepts\nare presented.\n\n3.1.1 Prediction Model\n\nThe prediction model is composed of the process and disturbance\ndynamics and is the most important element in predictive control al-\ngorithms. As MPC bases its control law computation in the prediction\nmodel, all the advantages of predictive control may be lost if the model\nis not faithful to the process dynamics. Linear models are more common\nin practice and can be input-output (impulse response, step response\nand transfer function) or based on state space variables, as the one used\nin this thesis.\n\n\n\n3.1. State Space MPC 27\n\nThe main theoretical results of MPC related to stability come\nfrom a state-space formulation, which can be used for both monovari-\nable and multivariable processes and can easily be extended to nonlin-\near processes [17]. Consider a process with nx states, nu inputs and ny\noutputs is described by the following state space equations:\n\nx(k + 1) = Ax(k) + B?u(k)\n\ny(k) = Cx(k) + D?u(k) (3.1)\n\nwhere A, B, C, D are matrices with order nx \u00d7 nx, nx \u00d7 nu, ny \u00d7 nx,\nny \u00d7 nu; x is the state vector, u the input vector and y the output\nvector. In this model k represents the discrete time (the sampling time\nis not written explicitly for simplicity).\n\nThe future predicted values of process state and output can be\ncalculated recursively until k + j according to:\n\nx?(k + j|k) = A\nj\nx(k) +\n\nj?1\n?\n\ni=0\n\nA\nj?i?1\n\nB?u(k + i) (3.2)\n\ny?(k + j|k) = CA\nj\nx(k) +\n\nj?1\n?\n\ni=0\n\nCA\nj?i?1\n\nB?u(k + i) + D?u(k + j) (3.3)\n\nConsidering a prediction horizon of Np and a control horizon of\nNc ? Np, the future state and output predictions are given by:\n\n?\n\n?\n?\n?\n?\n\nx?(k + 1|k)\nx?(k + 2|k)\n\n...\nx?(k + Np|k)\n\n?\n\n?\n?\n?\n?\n\n? ?? ?\n\nx?\n\n=\n\n?\n\n?\n?\n?\n?\n\nA\nA2\n\n...\nANp\n\n?\n\n?\n?\n?\n?\n\n? ?? ?\n\nA\n\nx(k)+\n\n?\n\n?\n?\n?\n?\n\nB 0 \u00b7 \u00b7 \u00b7 0\nAB B \u00b7 \u00b7 \u00b7 0\n...\n\n...\n...\n\n...\n\nANp?1B ANp?2B \u00b7 \u00b7 \u00b7\n?Np?Nc\n\ni=0 A\niB\n\n?\n\n?\n?\n?\n?\n\n? ?? ?\n\nB\n\n?\n\n?\n?\n?\n?\n\n?u(k)\n?u(k + 1)\n\n...\n?u(k + Np ?1)\n\n?\n\n?\n?\n?\n?\n\n? ?? ?\n\nu\n\n(3.4)\n\n\n\n28 3. Model Predictive Control (MPC)\n\n?\n\n?\n?\n?\n?\n\ny?(k + 1|k)\ny?(k + 2|k)\n\n...\ny?(k + Np|k)\n\n?\n\n?\n?\n?\n?\n\n? ?? ?\n\ny?\n\n=\n\n?\n\n?\n?\n?\n?\n\nCA\nCA2\n\n...\nCANp\n\n?\n\n?\n?\n?\n?\n\n? ?? ?\n\nC\n\nx(k)+\n\n?\n\n?\n?\n?\n?\n\nCB D \u00b7 \u00b7 \u00b7 0\nCAB CB \u00b7 \u00b7 \u00b7 D\n\n...\n...\n\n...\n...\n\nCANp?1B CANp?2B \u00b7 \u00b7 \u00b7\n?Np?Nc\n\ni=0 CA\niB\n\n?\n\n?\n?\n?\n?\n\n? ?? ?\n\nD\n\n?\n\n?\n?\n?\n?\n\n?u(k)\n?u(k + 1)\n\n...\n?u(k + Np ?1)\n\n?\n\n?\n?\n?\n?\n\n? ?? ?\n\nu\n\n(3.5)\n\nor in a condensed form:\n\nx? = Ax(k) + Bu (3.6)\n\ny? = Cx(k) + Du (3.7)\n\nIt should be emphasized that the prediction computation depends\non the state vector measurement. As in many cases is not possible to\nobtain these variables directly, a state observer based on Kalman Filter\ncan be used [17].\n\n3.1.2 Objective Function\n\nThe various MPC algorithms use different cost functions for com-\nputing the control law. The most common objective is to minimize the\nerror between the future output y and desired reference w penalizing\nthe control increment ?u. The standard expression for this objective\nfunction is:\n\nJ =\n\nNp\n?\n\nl=N1\n\n?y?(k + l|k)??(k + l)?\n2\nQ\n+\n\nNc?\n\nl=1\n\n??u?(k + l ?1)?\n2\nR\n\n(3.8)\n\nwhere N1 e Np are the minimum and maximum prediction horizons\nwhile Nc is the control horizon. In this work the same horizons for\n\n\n\n3.1. State Space MPC 29\n\nall inputs and outputs was used. These indexes define the limits in\nwhich it is desirable for the output to follow the reference and when it\nis important to limit the control action. These horizons may be used\nto compensate transmission delays and non-minimum phase. Chang-\ning Nc is possible to adjust the time instants where control action is\npenalized. Q and R are real matrices used to weight error and control\neffort.\n\nIn some systems it is possible to know future values of the refer-\nence. For these systems MPC may use this data to compute the control\nlaw and allow the system to achieve quickly the new desired value. The\nreference vector ?(k + l) used in the objective function does not neces-\nsarily coincide with the current reference system. Typically, in practical\napplications, strategies are used to soften the reference changes, similar\nto the filters used in classical two-degree-of-freedom control structures.\n\nIn practice all processes are subject to constraints. The actuators\nhave a limited field of action and a determined slew rate. Constructive\nreasons, safety or environmental ones can cause limits in the process\nvariables as states and outputs. The operational conditions are nor-\nmally defined by the intersection of certain constraints, so that the\ncontrol system will operate close to the boundaries. The controller\nmust anticipate and correct these violations so they do not happen,\npreventing the system being unstable. In this context MPC controllers\nare effective, since they have the ability to predict possible violations\nover the prediction horizon including constraints on the optimization\nproblem [17].\n\nGenerally, bounds in the amplitude and in the slew rate of the\ncontrol signal and limits in states and outputs are considered [120].\nThe solution of the constrained MPC is carried out by minimizing the\ncost function through quadratic programming (QP) algorithms. These\nalgorithms solve problems like:\n\n\n\n30 3. Model Predictive Control (MPC)\n\nmin\nu\n\nJ =\n\nNp\n?\n\nl=N1\n\n?y?(t + l|t)??(t + l)?\n2\nQ\n+\n\nNc?\n\nl=1\n\n??u?(t + l ?1)?\n2\nR\n\n(3.9)\n\nSubject to :\n\nx(k + 1) = Ax(k) + Bu?(k)\n\ny?(k) = Cx(k) + Du?(k)\n\nu ? u?(k + l ?1) ? u\n\n?u ? u?(k + l)? u?(k + l ?1) ? ?u\n\nx ? x?(k + l) ? x\n\ny ? y?(k + l) ? y\n\nx(k) = x?(k)\n\nwhere, hat (a?) over variables is used to denote variables over the pre-\ndiction horizon, a and a? denote minimum and maximum allowed values\nrespectively, and a? refers to variables whose values are supposed to be\nknown, for example, initial conditions.\n\n3.1.3 Obtaining the Control Law\n\nTo compute the control action the following steps are executed:\n\n1. update the initial conditions x?(k);\n\n2. compute y?(k + l) as a function of future control actions;\n\n3. substitute y? and w in the objective function J;\n\n4. minimize J considering the system dynamics and constraints.\n\nThe result is a sequence of control actions that should be applied\nto the system. It is important to emphasize the concept of receding\nhorizon control, i.e., despite the solution of objective function results\nin an array of control actions through the horizon, only the first control\naction will be applied and all control actions will be recalculated in the\nnext step according to new information from the real system.\n\n\n\n3.2. Distributed MPC 31\n\n3.2 Distributed MPC\n\nLarge scale networks, like power distribution networks, traffic and\ntransportation systems, water distribution networks, logistic operations\nnetworks etc., are the pillars of our modern society. Networks of this\ntype are typically spread in a large geographical area, present a modular\nstructure consisting of many subsystems, have many actuators and sen-\nsors and in some cases the dynamics evolves over different time scales\n[78].\n\nIn complex or geographically-spread systems, such as large-scale\nnetworks, the distribution of the control effort among local control\nagents can be a very convenient choice. Also, for most networks, the\nmain obstacle to the centralized control is not only technical, but com-\nmercial and/or organizational. Typically, technical issues arise from\ncommunication delays and too high computational requirements. Com-\nmercial issues include unavailability of information from one network\noperator to another, restricted control access, and costs of sensors. In\nmany cases, parts of the network belong to different organizations,\nwhich makes centralized control impossible to implement. Also, ro-\nbustness and reliability of the network cannot be guaranteed when a\nsingle centralized control agent breaks down [29].\n\nIn order to distribute the control effort, the network may suit-\nably be divided into exactly defined subsystems, in order to reduce the\ndynamic coupling. Once partitioned, the overall control objective can\nbe distributed between local control agents, depending on the control\nstructure and the selected communication protocol. This distributed\napproach results in multi-agent control structures.\n\nThe modular nature simplifies the system maintenance, allows\nexpansions of the control system and provides robustness in compari-\nson with a centralized controller [71]. On the other hand, distributed\ncontrollers present lower performance in comparison with a centralized\ncontroller, that depends on the degree of interaction between the local\nsubsystems and the coordination mechanisms between the agents [71].\n\nIn the last years many distributed control techniques were pro-\nposed in literature ([71], [72], [79], [1], [18], [100], [20]). In [29] many\ndistributed network control structures described in literature ([118],\n[100], [67], [82]) were compared. From this assessment, the MPC con-\ntrol structure based on Lagrange multipliers (Lag-MPC), presented in\n([78],[32]), appears as a suitable solution for the network control prob-\nlem providing stability and optimality guaranties and good convergence\nrate. Hereafter the Lag-MPC structure, that will be applied in chapter\n\n\n\n32 3. Model Predictive Control (MPC)\n\n5 to the problem of networked microgrids, is presented in detail.\n\n3.2.1 Control Problem\n\nAccording [78], in a distributed control structure, the control ef-\nfort is shared by several agents and each agent solves the control prob-\nlem of its respective sub-network. Considering a generic network com-\nposed of a set N = 1, . . . , nN of interconnected sub-networks, and\nassuming one control agent for each sub-network i, the general network\ncontrol problem can be seen as a union of local control problems:\n\nmin\n?nN\n\ni=1\nJlocal,i (x?i(k + 1), u?i(k), y?i(k))\n\nx?1(k + 1) . . . x?nN (k + 1)\nu?1(k) . . . u?nN (k)\ny?1(k) . . . y?nN (k)\n\n(3.10)\n\nsubject to local dynamics:\n\nxi(k + 1) =Aixi(k) + Biui(k) + Bqiqi(k) + ?in1,i?jwin,i?j(k) (3.11)\n\nyi(k) =Cixi(k) + Diui(k) + Dqiqi(k) + ?in2,i?jwin,i?j(k) (3.12)\n\nwout,i?j(k) = ?out,i?jyi(k) (3.13)\n\nthe process constraints:\n\nxi ? x?i(k + l + 1) ? xi (3.14)\n\nui ? u?i(k + l) ? ui (3.15)\n\ny\ni\n? y?i(k + l) ? yi (3.16)\n\nxi(k) = x?i(k) (3.17)\n\nand the interconnecting constraints\n\nwin,i?j(k) = wout,j?i(k) (3.18)\n\nwout,i?j(k) = win,j?i(k) (3.19)\n\nwhere the sub-index j denotes the neighbor networks.\nA typical choice for the local objective function is [78]:\n\nJlocal,i (x?i(k + 1), u?i(k), y?i(k)) = (3.20)\n\nNp?1\n?\n\nl=0\n\n?\n\n?\n\nx?i(k + l + 1)\nu?i(k + l)\ny?i(k + l)\n\n?\n\n?\n\nT\n\nQi\n\n?\n\n?\n\nx?i(k + l + 1)\nu?i(k + l)\ny?i(k + l)\n\n?\n\n? + f\nT\ni\n\n?\n\n?\n\nx?i(k + l + 1)\nu?i(k + l)\ny?i(k + l)\n\n?\n\n?\n\nwhere Qi is a positive definite weighting matrices and fi is a weighting\n\n\n\n3.2. Distributed MPC 33\n\nvector.\n\n3.2.2 Information Exchange\n\nAs the use of a multi-agent control structure implies the informa-\ntion exchange between agents, it is important to analyse and choose the\nbest way of how these agents communicate. According to [80],[81] an\nagent can use different schemes for communication and decision mak-\ning:\n\n\u2022 synchronous/asynchronous;\n\n\u2022 iterative/non-iterative;\n\n\u2022 serial/parallel.\n\nIn a synchronous communication scheme each agent has to wait\nfor the rest until all of them have finished the current stage calculations.\nOn the other hand, in asynchronous communication each agent runs\nat its own speed, sending and receiving information and determining\nwhat actions should be performed at any time. This mode is potentially\nfaster than synchronous one but the price to pay is the uncertainty of\nthe information updated from neighbouring agents.\n\nNon-iterative communication protocols need smaller amount of\ninformation exchange and are potentially faster than iterative schemes,\nsince the time required to take a decision is smaller and only one it-\neration is performed. However, iterative communication schemes can\npotentially achieve solutions closer to the ideal. As the information\nexchange is carried out during the solution of local control problems, it\nis possible to satisfy the interconnection constraints.\n\nIn parallel communication schemes all agents perform the calcu-\nlating step at the same time, unlike the serial schemes in which there\nis only one agent, per time step, solving its local control problem. Par-\nallel schemes are potentially faster than serial schemes, but the serial\nschemes ensure that agents receive the most updated information from\nits neighbours.\n\nSynchronous communication have been widely studied in litera-\nture, such as synchronous non-iterative parallel schemes ([34], [60], [65])\nand both serial and parallel synchronous iterative schemes ([18], [50],\n[61], [78]). The multi-agent control structure discussed in this thesis\nuses synchronous iterative parallel communication, which is the most\ndeveloped and utilized communication scheme in literature to solve\nlarge-scale networked control problems.\n\n\n\n34 3. Model Predictive Control (MPC)\n\n3.2.3 Lagrange MPC\n\nThe Augmented Lagrange MPC used in this thesis was developed\nin [78]. In MPC control structure based on Lagrange multipliers, the\ngeneral control problem presented in (3.10) and (3.20) is divided into\nsub-problems and assigned to local control agents [78]. These agents\nuse an augmented Lagrangian formulation to solve the general control\nproblem. This methodology was first presented in [57] and [94] and\nlater new analytical convergence tests were provided in [8]. In a control\nscheme based on augmented Lagrange formulation each control agent\nincludes terms related to the interconnection constraints in its objective\nfunction. As described in [78] and [80], the set of local solutions ob-\ntained through an iterative process at each sampling period k is equiv-\nalent to the optimal solution calculated in a centralized way. Following\nis presented the Augmented Lagrange MPC formulation proposed by\n[78] to be implemented with a parallel communication protocol.\n\nIn order to divide the general network problem into local sub-\nproblems, the interconnecting constraints in (3.18), for all control agents\ni = 1, . . . , nN, are removed from the set of constraints and added to the\nobjective function in such a way that the following augmented Lagrange\nfunction is obtained:\n\nJaug\n(\n\nx?(k + 1), u?(k), y?(k), w?in(k), w?out(k), ??in(k)\n)\n\n=\n\nnN?\n\ni=1\n\n[\n\nJlocal,i (x?i(k + 1), u?i(k), y?i(k))\n\n+\n?\n\nj?Ni\n\n(\n??in,i,j(k)\n\nT\n(w?in,i?j(k) ? w?out,j?i(k))\n\n+\n?c\n2\n?w?in,i?j(k) ? w?out,j?i(k)?\n\n2\n2\n\n)]\n\n(3.21)\n\nwith\n\nw?in(k) =\n[\nw?in,1(k)\n\nT , . . . , w?in,nN (k)\nT\n]T\n\nw?out(k) =\n[\nw?out,1(k)\n\nT , . . . , w?out,nN (k)\nT\n]T\n\n??in(k) =\n[\n\n??in,1(k)\nT , . . . , ??in,nN (k)\n\nT\n]T\n\n,\n\nwhere ?c is a positive constant and ??in,i(k) are the Lagrange multipli-\ners associated with the interconnections of sub-network i ?N with its\n\n\n\n3.2. Distributed MPC 35\n\nneighboring sub-networks j ? Ni. Specifically, ??in,i,j(k) are the La-\ngrange multipliers related to the constraints w?in,i?j(k) = w?out,j?i(k).\nUsing Jaug and by duality theory, the overall control problem can be\nexpressed as:\n\nmax\n\n??in(k)\n\n?\n\n?\n\n?\n\nmin\nx?(k + 1), u?(k), y?(k),\nw?in(k), w?out(k)\n\nJaug\n\n?\n\n?\n\nx?(k + 1), u?(k),\ny?(k), w?in(k),\n\nw?out(k), ??in(k)\n\n?\n\n?\n\n?\n\n?\n\n?\n(3.22)\n\nsubject to sub-network dynamics, constraints and initial conditions.\nThe optimal solution to problem (3.22) for every instant k is found\n\niteratively by minimizing the objective function with fixed Lagrange\nmultipliers and then updating Lagrange multipliers using the values\nobtained after the minimization procedure [78]. The ideal solution is\nfound when the Lagrange multipliers converge to new values through\nan iteration procedure.\n\nThis solution is equivalent to the optimal solution of the central-\nized problem, under assumptions of objective functions convexity and\nsub-network models affinity [81]. Since these assumptions are satisfied\nby the objective functions Jlocal,i for all i ?N and by the sub-network\nmodel, both solutions to (3.10) and (3.22) coincide.\n\nFinally, the problem (3.22) must be divided into sub-problems in\norder to assign them to each of the local control agents. Such a di-\nvision cannot be directly done due to the presence of quadratic terms\nin the formulation. In order to approximate the aforementioned non-\nquadratic terms, the auxiliary problem principle ([6], [66], [98]) was\nutilized, whose implementation requires a parallel iterative process to\nbe done each time step k, where all the agents perform their local opti-\nmization problems at the same time and share between them the results\nof their computations. This way, the local problem can be written as\nfollows:\n\nmin Jlocal,i (x?i(k + 1), u?i(k), y?i(k)) +\nx?i(k + 1), u?i(k), y?i(k), Jinter,i (w?in,i(k), w?out,i(k))\nw?in,i(k), w?out,i(k)\n\n(3.23)\n\nwhere Jlocal,i is the local objective function defined in (3.20) and Jinter,i\n\n\n\n36 3. Model Predictive Control (MPC)\n\nis the following interconnection function:\n\nJinter,i(w?pin,i(k),w?\np\nout,i\n\n(k))=\n\n?\n\n?\n\n??\np\n\nin,i?j(k)\n\n??\np\n\nout,i?j(k)\n\n?\n\n?\n\nT\n?\n\n?\n\nw?\np\nin,i?j\n\n(k)\n\nw?\np\nout,i?j\n\n(k)\n\n?\n\n? (3.24)\n\n+\n?c\n2\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nw?\np?1\nin,j?i\n\n(k)?w?\np\nout,i?j\n\n(k)\n\nw?\np?1\nout,j?i\n\n(k)?w?\np\nin,i?j\n\n(k)\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n2\n\n2\n\n+\n?b??c\n\n2\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nw?\np\nin,i?j\n\n(k)?w?\np?1\nin,i?j\n\n(k)\n\nw?\np\nout,i?j\n\n(k)?w?\np?1\nout,i?j\n\n(k)\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n2\n\n2\n\nwhere ?c and ?b are positive constants, w?\np?1\nin,i?j(k) and w?\n\np?1\nout,i?j(k)\n\nare the own information set of the previous iteration, w?\np?1\nin,j?i(k) and\n\nw?\np?1\nout,j?i(k) are the information set collected from the neighbouring\n\nagent j ? Ni at the previous iteration, the superscript p represents the\n\nactual iteration at the time instant k and ??\np\n\nin,i?j(k) and ??\np\n\nout,i?j(k)\nare the Lagrange multipliers.\n\nAt each time step k, each local agent must perform the iterative\nalgorithm described below with parallel communication. One of the\nmain drawbacks of Lagrangian methods is the slow convergence [71].\nThe algorithm convergence speed can be improved through the so-called\nwarm start by initializing the interconnecting inputs and the Lagrange\nmultipliers every step to the values obtained from previous decision\nstep rather than initializing these values arbitrarily. The algorithm is\nimplemented according to the following steps:\n\n1. Make a measurement of current state x?i(k)\n\n2. Compute the optimal control sequence u??i (k). To do so, perform\nthe following steps:\n\n(a) Parameter initialization:\n\n\u2022 for k = 0\n\n\n\n3.2. Distributed MPC 37\n\np = 1\n\nei ? 1\n\n??\n0\n\nin,i?j(k) = 0\n\n??\n0\n\nout,i?j(k) = 0\n\nw?\n0\nin,i?j(k) = 0\n\nw?\n0\nout,i?j(k) = 0\n\nw?\n0\nin,j?i(k) = 0\n\nw?\n0\nout,j?i(k) = 0\n\n\u2022 for k > 0 use warm start\n\n??\n0\n\nin,i?j(k) = ??\np\n\nin,i?j(k ?1)\n\n??\n0\n\nout,i?j(k) = ??\np\n\nout,i?j(k ?1)\n\nw?\n0\nin,i?j(k) = w?\n\np\nin,i?j(k ?1)\n\nw?\n0\nout,i?j(k) = w?\n\np\nout,i?j(k ?1)\n\nw?\n0\nin,j?i(k) = w?\n\np\nin,j?i(k ?1)\n\nw?\n0\nout,j?i(k) = w?\n\np\nout,j?i(k ?1)\n\np = 1\n\nei ? 1\n\nfor all i ?N .\n\n(b) Solve the optimization problem in equation (3.23), subject\nto local dynamics and constraints.\n\n(c) Send w?\np\nin,i?j(k) and w?\n\np\nout,i?j(k) to neighbouring agents j ?\n\nNi and collect w?\n0\nin,j?i(k) and w?\n\np\nout,j?i(k) from them.\n\n(d) Upgrade the multipliers:\n\n??\np+1\nin,i?j(k)=??\n\np\n\nin,i?j(k)+?c(w?\np\nin,i?j\n\n(k)?w?\np\nout,j?i\n\n(k)) (3.25)\n\n??\np+1\nout,i?j(k)=??\n\np\n\nout,i?j(k)+?c(w?\np\nout,i?j\n\n(k)?w?\np\nin,j?i\n\n(k)) (3.26)\n\n\n\n38 3. Model Predictive Control (MPC)\n\n(e) Evaluate the stopping conditions:\n\np > p? (3.27)\n\nei =\n?\n?\n???\n\np+1\n\nin,i?j(k)? ??\np\n\nin,i?j(k)\n?\n?\n? ? e? (3.28)\n\nwhere p? is the maximum number of iterations allowed and e?\nis the maximum error allowed. If both conditions are false,\nmove on to next iteration p ? p + 1 and go to step 2b.\nIf (3.27) is true, go to step 3. If (3.28) is true, set agent\ni termination flag flagi(k) = 1. If all neighboring agents\nj ? Ni termination flags are equal to 1, go to step 3. If not,\nmove on to next iteration and go to step 2b [78].\n\n3. Implement the optimal control action u??i (k).\n\n4. Start a new control cycle k ? k + 1 and go to step 1.\n\nSelecting ?b ? 2?c and ? sufficiently small, and due to the fact\nthat the overall control problem is a convex space, the iterative algo-\nrithm described above converges to the minimum of the overall network\nproblem.\n\nThe positive scalar ?c penalizes the deviation from the intercon-\nnecting variable iterates that were computed during the last itera-\ntion. As additional parameter this scheme uses a positive scalar ?b.\nIf ?b ? ?c, then the term penalizes the deviation between the inter-\nconnecting variables of the current iteration and the interconnecting\nvariables of the last iteration of agent i; it thus gives the agent less\nincentive to change its interconnecting variables from one iteration to\nthe next. When ?b ? 2?c and ?, and moreover the overall combined\nproblem is convex, it can be proved that the iterations converge toward\nthe overall minimum for sufficiently small e? ([9], [66]).\n\n3.3 Final Remarks\n\nIn this chapter a literature review about centralized and dis-\ntributed MPC was presented. In the chapter 4 will be presented a\nDMPC algorithm for hybrid systems.\n\n\n\nChapter 4\n\nHybrid Distributed\nMPC\n\nThis chapter presents one of the contributions of this thesis. Hy-\nbrid systems are a class of dynamical systems whose evolution depends\non a coupling between continuous and binary variables. This kind of\nsystems has many applications, for example, in energy management\n([31], [82], [12], [75]), in hydrogen production ([103]), in supermarket\napplications ([99], [107]), in electric vehicles charging ([52]), in process\ncontrol ([27], [95], [21]) and in traffic light control ([102]).\n\nIn [7] a proposal was carried out to generalize MPC to hybrid\nsystems based on Mixed Logical Dynamical (MLD) modeling frame-\nwork. The solution of the hybrid MPC can be rewritten as a sequence\nof optimization problems defined as Mixed Integer Quadratic Program-\nming (MIQP), which is computationally complex. The most common\nmethods to solve MIQP problems are cutting-plane methods, decompo-\nsition methods, logic-based methods, and branch and bound methods.\nSeveral authors report that branch and bound is the most successful\nmethod for mixed integer programs [7]. A commonly used commercial\nsoftware is the solver CPLEX [58].\n\nThere are in literature other algorithms to deal with the presence\nof binary variables. In [102] and [116], the authors use a technique\ncalled TIO-MPC (Time Instant Optimization - MPC), where time in-\nstants are introduced as control inputs in place of binary variables. The\ntime instants when the changes of the structure state should occur are\noptimized for a selected number of changes, resulting in a real-valued\nprogramming problem. In [99] and [27], a technique is presented that\n\n\n\n40 4. Hybrid Distributed MPC\n\ndefines two new continuous manipulated variables for each binary ma-\nnipulated variable, which corresponds to the duration of the activa-\ntion/deactivation of the binary variables on the prediction horizon. In\nthis way the original problem is turned into a non-linear optimization\nwith continuous variables that can be solved using Sequential Quadratic\nProgramming (SQP). There are some works in literature focused on\ndistributed MPC to hybrid systems ([56],[13],[40]).\n\nIn networked hybrid systems, each subsystem has a certain num-\nber of binary variables that describe its discrete state. Let us assume\nthat controller i has nbi binary variables, which means that the con-\ntroller can be configured in 2nbi different ways. Considering that the\nsystem is composed by nN subsystems, from a global point of view, this\nimplies that there are\n\n?nN\ni=1 2\n\nnbi configurations for the binary variables\nin the system. There are two combinatorial explosions here. One is due\nto the local binary variables. Another is due to the joint action of the\nlocal controllers. All together may make the computation intractable\neven for systems with a low number of controllers.\n\nIn this section an approach is proposed to deal with both com-\nbinatorial explosions. First an algorithm is presented to deal with the\nbinary variables of the local controllers. The basic idea is to provide\nan easy way to solve this kind of problem without a MIQP solver. The\nproposed technique first decides about the values of the binary vari-\nables for each local controller and transforms the optimization problem\ninto a set of quadratic programs (QP). A finite set of instances of each\ncontroller is created with the possible solutions.\n\nTo overcome the limitations imposed by the second combinatorial\nexplosion, the one derived from the joint action of the controllers, it is\nassumed that a set of feasible combinations of binary decision variables\nexists. From a distributed optimization perspective, we have a problem\nwhere a set of agents must agree on the value of a set of continuous in-\nterconnection variables and the binary variables are computed by each\nlocal agent. In this work, we propose to improve the efficiency of this\napproach by iterating and checking which are the instances with the\nlowest performance. These instances are penalized at the next iteration\nstep so that their impact in the cost function is reduced. Likewise, the\ninstances with the best cost are rewarded with a higher weight in the\noverall optimization. Eventually, some of the instances are dismissed,\ne.g., when their weight is below a certain threshold or simply 0. This\nprocedure is repeated until there is only one instance left in each in-\nstance set or after a certain number of iterations has been achieved.\nIn this last case the instance with the optimal cost is chosen and its\n\n\n\n4.1. Problem setting 41\n\nvalue is assigned to the binary variables of the subsystem. In this way\na solution for the hybrid DMPC problem can be attained.\n\n4.1 Problem setting\n\nConsider a generic network composed of a set N = 1, 2, . . . , nN\nof nN interconnected sub-networks. The dynamics of each sub-network\ncan be described by the following MLD equations:\n\nx(k+1)=Ax(k)+B1u(k)+B2?(k)+B3z(k)+Dq1q(k)+?in1win,i?j(k) (4.1)\n\ny(k)=Cx(k)+D1u(k)+D2?(k)+D3z(k)+Dq2q(k)+?in2win,i?j(k) (4.2)\n\nwout,i?j(k)=?outy(k) (4.3)\n\nE2?(k)+E3z(k)?E1u(k)+E4x(k)+E5 (4.4)\n\nwhere x(k) =\n[\nxc(k) xl(k)\n\n]T\nis the state vector with xc(k) ? ?\n\nnc\n\nand xl ? {0, 1}\nnl, y(k) =\n\n[\nyc(k) yl(k)\n\n]T\nis the output vector with\n\nyc(k) ? ?\npc and yl(k) ? {0, 1}\n\npl, u(k) =\n[\nuc(k) ul(k)\n\n]T\nis the\n\ninput vector with uc(k) ? ?\nmc and ul(k) ? {0, 1}\n\nml, q(k) is a distur-\nbance vector, win,i?j(k) is a vector of input interconnected variables,\nwout,i?j(k) is a vector of output interconnected variables, z(k) ? ?\n\nrc\n\nare the continuous auxiliary variables, ?(k) ? {0, 1}\nrl are the binary\n\nauxiliary variables, A, B1, B2, B3, C, D1, D2, D3, Dq1, Dq2, ?in1,\n?in1, ?out, E1, E2, E3 and E4 are constant real matrices, E5 is a real\nvector, nc > 0 and pc, mc, rc, nl, pl, ml, rl > 0.\n\nIn this case, it is assumed that z(k) is defined as a product be-\ntween ?(k) and u(k). This product is expressed by the mixed-integer\nlinear inequalities in (4.4), by using propositional logic, as explained in\nchapter 2. The local objective function and constraints are the same\nas the ones defined in (3.20) and (3.14).\n\n4.2 Hybrid DMPC Framework\n\nThe optimization problem formulated previously includes binary\nand continuous manipulated variables that characterize a mixed inte-\nger optimization. In this section a framework to deal with this kind\nof problems in a distributed fashion will be presented. The proposed\nalgorithm is one of the contributions of this thesis. The main idea is\nto determine a set of possible solutions for the binary variables and\ncreate controller instances related to these solutions. These instances\n\n\n\n42 4. Hybrid Distributed MPC\n\nare tested by a competitive rule in an iterative procedure until the best\nsolution is found.\n\n4.2.1 Binary Search Algorithm\n\nFor each physical binary condition in a subsystem there are Np\nvariables related to the prediction horizon. Taking into account that in\na subsystem i there exist nbi physical binary conditions, the total num-\nber of binary variables in the optimization problem is nbi \u00d7Np, which\nresults in 2nbi\u00d7Np possible instances of the local controller. In practice,\nthis number can be reduced using some heuristics. For example it could\nbe assumed that the configuration should not change drastically from\none time instant to another, or that there are no changes in the value\nof the binary variables after a few steps in the horizon. Another way\nto deal with binary variables is performing a binary search over the\nprediction horizon. The controller instances are defined considering all\npossible combinations of the binary variables of the first two elements of\nthe horizon and assuming the remaining control actions to be constant\nand equal to the second instant.\n\nThus,\n\n? = ?fix (4.5)\n\nz = ?fix \u00d7u (4.6)\n\nwhere ?fix is a matrix with fixed values for all binary variables. This\nprocedure transforms the original optimization problem into a QP as\nthe binary variables are known.\n\nAfter solving the QP problems for the controller instances, a per-\nformance index, for example the objective function cost, is analyzed.\nThe instance that provides the best performance index is fixed for the\nfirst horizon instant and the next two time instants are tested. This\nprocedure is repeated until the end of the prediction horizon or can be\ntruncated in a certain instant called binary decision horizon Nb, which\nshould be lower or equal than the prediction horizon.\n\nA previous simulation study to investigate the algorithm behavior\nfor different values of Nb is recommended. According to the parsimony\nprinciple the best choice is one that provides a good compromise be-\ntween the number of iterations, the calculation time, the number of\nchanges through the prediction horizon for binary variables, and the\nperformance. Depending on the nature of the application, this algo-\nrithm can be applied to all binary variables together or independently,\n\n\n\n4.2. Hybrid DMPC Framework 43\n\nand leads a set of 4\u00d7Nb or 4\u00d7Ni\u00d7Nb controller instances respectively.\nAlgorithm 1 shows, the implementation used to solve the optimization\nproblem with all binary variables together.\n\nAlgorithm 1 Binary Search Algorithm\n\nInput: Nb\nOutput: CI,FCI,FIX\n\nInitialization :\nFIX = [];\nLOOP Process\n\n2: for i = 1 to Nb do\nif i = 1 {First instant} then\n\n4: Define ?fix =\n\n?\n\n?\n?\n?\n\n0 0{1\u00d7Np?1}\n0 1{1\u00d7Np?1}\n1 0{1\u00d7Np?1}\n1 1{1\u00d7Np?1}\n\n?\n\n?\n?\n?\n\nelse\n\n6: Define ?fix =\n\n?\n\n?\n?\n?\n\nFIX 0 0{1\u00d7Np?i}\nFIX 0 1{1\u00d7Np?i}\nFIX 1 0{1\u00d7Np?i}\nFIX 1 1{1\u00d7Np?i}\n\n?\n\n?\n?\n?\n\nend if\n8: for j = 1 to 4 do\n\nSolve the optimization problem for ?fix{j,1...Np}\n10: Compute the objective function cost Cj\n\nCompute the controller instance CIi,j.\n12: end for\n\nAnalyze Cj and choose the minimum cost Cmin = min Cj\n14: Update FIX with the value of ?fix that corresponds to Cmin\n\nend for\n16: With all values of ?fix defined, compute the Final Controller In-\n\nstance (FCI).\n\n4.2.2 Distributed Coordination\n\nIn this sub-section an algorithm for the coordination of a set of\nlocal controllers with continuous and binary decision variables is pre-\nsented. In particular, the binary decision variables at each local con-\ntroller are relaxed from the original MIQP problem by considering an\ninstance of the controller for each feasible combination of them. The\n\n\n\n44 4. Hybrid Distributed MPC\n\nnumber of initial controller instances can be reduced by using the al-\ngorithm presented in subsection 4.2.1. Then, a standard distributed\ncontrol problem in which a set of agents must agree on the value of\ncontinuous decision variables is used iteratively.\n\nAt each iteration, the instances with lowest expected performance\nare penalized and those with the best expected performance are re-\nwarded by modifying their corresponding weights in the overall opti-\nmization problem. Eventually, instances leading to the worst perfor-\nmance are dropped at each local controller. A way to determine which\ninstances will be dropped is to compute a cutoff index that consists\nin the middle point between the minimum and the maximum costs ob-\ntained by all active instances in current iteration. The process continues\nuntil there is only one instance at each local controller. The value of\nthe binary variables of the corresponding instance is then implemented\nin the system. This procedure is applied at each sampling period. One\nimportant characteristic of the proposed methodology is that during\nthe iterations the computational effort decreases proportionally to the\ndecreasing of possible instances, on the other hand, this algorithm does\nnot guarantee the solution optimality. These steps are formalized in\nAlgorithm 2.\n\nAlgorithm 2 Distributed Coordination Algorithm\n\nInput: iteration\nOutput: BCI\n\nif iteration = 1 {First iteration} then\n2: Solve the optimization problem using the binary search algorithm\n\nSave the initial set of controller instances SCI\n4: else\n\nCompute the cost vector C with all active controller instances in\nSCI\n\n6: Determine the minimum Cmin and maximum Cmax costs of C\nCompute cutoff index I = 0.5Cmin + 0.5Cmax\n\n8: Deactivate the instances in SCI with higher costs than the cutoff\nindex\nApply the instance with best cost BCI\n\n10: Repeat this procedure until the convergence of the distributed\nalgorithm\n\nend if\n\n\n\n4.2. Hybrid DMPC Framework 45\n\n4.2.3 Algorithm Convergence\n\nIn order to investigate the convergence and optimality properties\nof the proposed algorithm, a simulation analysis was performed. The\nsystem under study is a generic network composed by two identical\nsub-networks containing one binary variable. The sub-networks are\ninterconnected through two interconnection variables, and represented\nby equations (4.1 - 4.4) with the following matrices:\n\nu =\n[\nu1 u2 wout,i?j win,i?j ? z\n\n]T\n\nA = 1 Dq1 = Dq2 = C = 0 ?out =\n\n[\n0\n1\n\n]\n\nB =\n\n?\n\n?\n?\n?\n\nB1\n?in1\nB2\nB3\n\n?\n\n?\n?\n?\n\nT\n\n=\n[\n0 23.75 0 0 0 ?0.75\n\n]\n\nD =\n\n?\n\n?\n?\n?\n\nD1\n?in2\nD2\nD3\n\n?\n\n?\n?\n?\n\nT\n\n=\n\n[\n1 ?1 ?1 1 0 0\n0 0 1 0 0 0\n\n]\n\nEach local controller uses the following objective function:\n\nJlocal =\n?Np?1\n\nl=0 u?(k + l)\nT Qu?(k + l)\n\n+\n?Np?1\n\nl=0 (x?(k + l)? x?ref (k + l))\nT\nQx (x?(k + l)? x?ref (k + l))\n\n+\n?Np?1\n\nl=0 (u?(k + l)?u)\nT\nQe (u?(k + l)?u) (4.7)\n\nsubject to local dynamics (4.1) and (4.4) and following constraints:\n\nx ? x?(k + l + 1) ? x (4.8)\n\nu ? u?(k + l) ? u (4.9)\n\ny?(k + l) = ydem(k) (4.10)\n\nx(k) = x?(k) (4.11)\n\nfor l = 0, . . . , Np ? 1, where Q, Qx, Qe are positive definite weight-\ning matrices, and Np is the prediction horizon. With respect to the\nnotation, hat (a?) over variables is used to denote variables over the\nprediction horizon, a and a? denote minimum and maximum allowed\n\n\n\n46 4. Hybrid Distributed MPC\n\nvalues respectively, and a? refers to variables whose values are supposed\nto be known, for example, the initial conditions.\n\nA simulation with 24 steps was performed using the software Mat-\nlab [74] with Yalmip toolbox [69] and the solver CPLEX [58]. A pre-\ndiction horizon of N = 6 was used totalizing 6 binary variables per\nsub-network, i.e., 26 possible instances to the local controller, which\nresults in\n\n?2\ni=1 2\n\n6 configurations for the binary variables in the global\noptimization problem.\n\nFirst, the differences between the use of binary search algorithm\n(BS) and binary search with distributed coordination (BSDC) are in-\nvestigated. A simulation analysis to determine the influence of Nb,\ntesting Nb = 1 until Nb = 6 was performed. Figure 4.1 shows the num-\nber of iterations for each time instant and the calculation time for each\nNb. The number of iterations varies between 206 and 207 for BS and\n213 and 217 for BSDC, and the calculation time increases with Nb. The\nBSDC provides the solution with less time than BS for all values of Nb,\nwhich may be explained by the exclusion of instances that do not have\ngood performance during the iteration procedure. This way the num-\nber of optimization problems tested at each iteration is reduced. Both\nalgorithms presented similar dynamical behavior for all values of Nb,\nas can be seen in Figure 4.2. In this case, Nb = 1 was chosen because\nit provided the best compromise between the number of iterations and\nthe calculation time.\n\nTable 4.1 presents a comparison between the BS, the BSDC (both\nusing Nb = 1), the centralized MIQP (CMIQP) solved by the CPLEX\nbranch and bound solver and the all instances possible combinations\n(COMB). As expected, the computation time expended by BSDC was\nsmaller than BS and COMB, and closer to CMIPQ. Assuming that the\nCMIPQ is the best solution that can be computed, the total and the\naverage costs can be used to compare the algorithms with respect to the\ndistance from the optimum. All algorithms presented similar costs, but\nBS obtained the closest solution while BSDC obtained the farthest.\nIt is possible that, for one specific time instant, the exclusion of the\nworst performance instances performed by BSDC can miss untimely an\ninstance that can probably be the best at the end of iteration procedure\nwhen compared to BS. In despite of the proposed Hybrid DMPC being\na suboptimal algorithm, the reduction in calculation time provided by\nBSDC can be useful in applications with a great number of binary\nvariables.\n\n\n\n4.3. Final Remarks 47\n\n(a) Binary Search\n\n(b) Binary Search with Distributed Coordination\n\nFigure 4.1: Number of iterations and calculation time varying Nb.\n\n4.3 Final Remarks\n\nIn this chapter an hybrid DMPC framework was presented as\na contribution of this thesis and a discussion about convergence and\noptimality was performed. In the chapter 5 these algorithms will be\napplied to a microgrid energy management.\n\n\n\n48 4. Hybrid Distributed MPC\n\nFigure 4.2: Input, output and state variables. (blue - u1, red - y, black -\nu2, magenta - wout)\n\nTable 4.1: Performance Indexes\n\nBS BSDC CMIQP COMB\n\nTotal Iterations 206 213 ? 207\nTotal time (s) 35.44 14.85 3.23 2266.9\nAverage time (s) 1.48 0.62 0.14 94.45\nTotal cost 402.99 405.25 402.82 403.22\nAverage cost 16.79 16.88 16.78 16.80\n\n\n\nChapter 5\n\nMicrogrid Control\n\nThis chapter presents some concepts of microgrid control. First\nthe different control levels are discussed. Then a two level MPC algo-\nrithm is applied to a laboratory microgrid, and different weather con-\nditions are tested. Finally the problem of optimization of networked\nmicrogrids is discussed and a Hybrid distributed MPC is applied.\n\n5.1 Energy Management in Microgrids\n\nA microgrid is a concept which refers to a small-scale power sys-\ntem with a cluster of loads and distributed generators operating to-\ngether with energy management, control and protection devices and\nassociated software [111]. A microgrid can be a DC [124], AC or even\na high frequency AC grid [19] and hybrid AC/DC [110].\n\nMicrogrids are planned to operate in grid-connected and/or is-\nlanded mode. For each operating mode operational requirements are\ndifferent and distinct control schemes are required [111]. In grid-connected\nscenario, the microgrid sells/purchases energy with the Distribution\nNetwork Operator (DNO), which usually produces energy from fossil\nenergy sources. Minimize the amount of energy purchased from DNO is\nan important goal to reduce greenhouse gas emissions and promote sus-\ntainable consumption practices. An interesting alternative is to connect\nneighboring microgrids in a network so to cooperate each other [87].\n\nA crucial issue in microgrid operation is the use of energy storage,\nthat allows to compensate imbalances between consumption and gener-\nation and ensure the energy quality. According to ([38]) and ([54]) the\npossibility of hybridization among several energy storage technologies is\n\n\n\n50 5. Microgrid Control\n\nof great interest. In this chapter, the combination of hydrogen storage\ntogether with electric batteries is used to reduce the energy fluctuation\nand store energy in an experimental microgrid.\n\nFrom the control point of view, many authors ([16], [70], [117],\n[10], [86], [90], [89], [110]) agree on the existence of three control lev-\nels. The primary level operates on a fast time scale and maintains\nthe voltage and frequency stability during changes on the generation\nor load or after switching to the island mode. This control is imple-\nmented locally. The secondary level is responsible for ensuring that the\nvoltage and frequency deviations are adjusted to zero after a load or\ngeneration change is produced within the microgrid. It is responsible to\neliminate any steady-state error introduced by the primary control and\nis also used for synchronization with the DNO during the transition\nfrom island mode to grid connection.\n\nThe third level is related to energy management system (EMS)\nand is the main topic of this thesis. This tertiary control is used to\ncontrol the power flow between the microgrid and the DNO and for the\noptimal operation on large time scales. This level may include many\noptimization strategies, according to the time scales, and it includes\nplanning and economic dispatch. For a single microgrid the energy\nmanagement is usually done by a microgrid central controller (MGCC).\nIn case of networked microgrids a good solution is to use an agent-based\ndistributed EMS.\n\n5.2 Laboratory Microgrid Control\n\nThis section presents an economic optimization of a laboratory\nmicrogrid located at the University of Seville (US), Spain. The system\nmodeling was carried out using the Energy Hubs methodology.\n\nA hierarchical control structure is proposed based on Model Pre-\ndictive Control and acting in different time scales, where the first level is\nresponsible for maintaining the microgrid stability and the second level\nhas the task of performing the management of electricity purchase and\nsale to the power grid, maximize the use of renewable energy sources,\nmanage the use of energy storage units and perform the charge of the\nparked vehicles. Practical experiments were performed with different\nweather conditions of solar irradiation and wind.\n\n\n\n5.2. Laboratory Microgrid Control 51\n\n5.2.1 V2G Experimental Microgrid\n\nIn this work the experiments were carried out at HyLab microgrid\nconnected to an electric vehicle charging system. This microgrid was\ndesigned to study control strategies applied to energy management of\na network based on renewable energy sources and hydrogen storage\n([112], [113], [114]). The facility has special features that allow the\nimplementation and study of different operating modes and control\nstrategies. Figure 5.1 shows the outline of the studied system.\n\nFigure 5.1: Hylab microgrid\n\nTo replicate renewable energy systems, the microgrid has a pro-\ngrammable power supply that can emulate the dynamic behavior of a\nwind turbine and/or a photovoltaic field. It also includes a battery\nbank, an electronic load to emulate different consumption systems and,\nfinally, includes a hydrogen storage system comprising a PEM (Pro-\nton Exchange Membrane) electrolyzer to produce hydrogen, a metal\nhydride tank to store hydrogen and PEM fuel cell to produce energy.\nThe electric car charging station has the capacity to charge four cars\nsimultaneously. The charging station was emulated by a hardware-in-\nthe-loop methodology. The dynamics of the electric vehicle batteries\nwere simulated by a Simulink model and interfaced with the microgrid\nthrough the programmable power supply and the electronic load. The\n\n\n\n52 5. Microgrid Control\n\ntechnical characteristics of the equipments are summarized in table 5.1.\n\nTable 5.1: Microgrid Units\n\nEquipment Nominal Value\n\nProgrammable Power Supply 6kW\nElectronic Load 2.5kW\nElectrolyzer 0.23Nm3/h at 1kW\n\nMetal Hydride Tank 7Nm3 at 5bar\nFuel Cell 1.5kW at 20Nl\n\nBattery Bank C120 = 367Ah\n\nFrom the microgrid operation point of view, usually the energy\nproduced does not match the demand. Then, the excess of energy from\nrenewable sources can be stored in batteries or used to produce hy-\ndrogen through electrolysis. The hydrogen produced is stored in the\nmetal hydride tank. Finally, when power from renewable sources is not\navailable, the fuel cell uses hydrogen to supplement the lack of demand.\nAdditionally, the microgrid has a connection to the DNO allowing the\nenergy purchase and sale. The hybrid storage allows operation strate-\ngies on two time scales: the battery can absorb/provide small amounts\nof energy on fast transients while hydrogen storage supplements bigger\noscillations. In this sense, when the cars are parked, their batteries\ncan be used by the microgrid to expand the buffer capacity during fast\ntransients. The idea of the control system is then to compute the differ-\nent powers PRenewable (the generated renewable energy power), PDNO\n(the power exchanged with the DNO), PB (the power of the battery\nbank), PH2 (the power of the hydrogen storage) and PBev1, PBev2,\nPBev3, PBev4 (the powers of vehicle batteries) in such a way that the\nperformance of the overall system is optimized.\n\n5.2.2 System Modeling\n\nIn this section, the methodology presented in chapter 2 is applied\nto the microgrid and electric vehicles charging station modeling. As\nthe battery bank is considered to have the same charging/discharging\nefficiency it is not necessary to define binary variables for it. The bat-\nteries of electric vehicles are modeled in the same way as the microgrid\nbattery bank, however a binary variable ? is added, which is directly\nrelated to the physical connection between the vehicle and the charg-\ning station. This variable provides a change in the prediction model\n\n\n\n5.2. Laboratory Microgrid Control 53\n\nwithout using an hybrid modeling, as the value of ? is informed by\nthe vehicle connection and is not a decision variable. If the vehicle is\nconnected ? = 1 and a state related to electric vehicle battery SOC\nis enabled in the prediction model; if it is not ? = 0, and the state is\ndisabled. The final state equation of the electric cars batteries is\n\nx(k + 1) = ?x(k) + ??u(k) (5.1)\n\nTo model the hydrogen storage dynamics it is necessary to de-\nfine the variable zH2(k) = PH2(k)?H2(k) that is related to charg-\ning/discharging the hydrogen storage. To manage the purchase and sale\nof energy to the DNO, different weights for sale and purchase were used.\nTo make this possible a new variable zDNO(k) = PDNO(k)?DNO(k) was\ndefined and the corresponding MLD constraints were introduced. Thus,\nthe complete decision vector (manipulated variables) is:\n\nu=\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nu\nL\n\nu\nE\n\n?\n\nz\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n=\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nPRenewable\n\nPDNO\n\nPB\n\nPH2\n\nPBev1\n\nPBev2\n\nPBev3\n\nPBev4\n\n?H2\n\n?DNO\n\nzH2\n\nzDNO\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n(5.2)\n\nThe model in equation (2.39) can be rewritten in a condensed\nform:\n\nx(k + 1) = Ax(k) + ?u(k) (5.3)\n\ny(k) = ?u(k)\n\n\n\n54 5. Microgrid Control\n\nA =\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n1 0 0 0 0 0\n\n0 1 0 0 0 0\n\n0 0 ?1 0 0 0\n\n0 0 0 ?2 0 0\n\n0 0 0 0 ?3 0\n\n0 0 0 0 0 ?4\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n? =\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n0 0 ?1 0 0 0 0 0 0 0 0 0\n\n0 0 0 ?2 0 0 0 0 0 0 ?3 0\n\n0 0 0 0 ?4 0 0 0 0 0 0 0\n\n0 0 0 0 0 ?5 0 0 0 0 0 0\n\n0 0 0 0 0 0 ?6 0 0 0 0 0\n\n0 0 0 0 0 0 0 ?7 0 0 0 0\n\n?\n\n?\n?\n?\n?\n?\n?\n?\n\n?1=?B ?2=?\nFC\nH2,e\n\n?3=?\nE\ne,H2\n??FCH2,e\n\n?4=?1?Bev1 ?5=?2?Bev2 ?6=?3?Bev3 ?7=?4?Bev4\n\n? =\n[\n?S\nrad,e\n\n1 ?1 ?1 ?1 ?1 ?1 ?1 0 0 0 0\n]\n\nwhere ? is the storage and conversion efficiency, PRenewable is the gen-\nerated renewable energy power, PDNO is the power exchanged with the\nDNO, PB is the power of the battery bank, PH2 is the power of the\nhydrogen storage and PBev1, PBev2, PBev3 and PBev4 are the powers\nof vehicle batteries. The states are the battery bank SOC (state of\ncharge), the MHL (metal hydrid level) of the hydrogen storage and the\nSOC of each electric vehicle battery.\n\n5.2.3 Control Algorithm\n\nA two-level hierarchical control structure based on MPC, as shown\nin figure 5.2, is proposed. Both controllers were implemented in the\ntertiary level and act in different time scales. The MPC1 acts directly\non the microgrid and charging station with a sampling period of one\nsecond (Ts = 1s), and it is responsible for ensuring the constraints,\noperation conditions and power flow exchange between the microgrid\nelements and the charging station, following the upper level targets.\nThe MPC2 is designed to achieve the microgrid economic optimization\nmanaging the energy selling and purchasing. This controller uses a\nsampling period of five minutes (Ts = 5min). The Charging Station\nManagement Unit runs at the second level controller and manages the\nuse of electric vehicles batteries as a storage and guarantees that the\ncharging constraints (charging type and time) are satisfied. Figure 5.3\n\n\n\n5.2. Laboratory Microgrid Control 55\n\nshows the flowchart containing the steps for implementation the two-\nlevel MPC controller.\n\nFigure 5.2: Control Structure\n\nFirst Controller (MPC1)\n\nThe first MPC has the following objective function:\n\nJ1 =\n\nNc?1?\n\nl=0\n\nu?1(k + l)\nT\nQu1u?1(k + l)+ (5.4)\n\nNp?1\n?\n\nl=0\n\n(x?1(k + l)? x?ref (k + l))\nT\nQx1 (x?1(k + l)? x?ref (k + l)) +\n\nNc?1?\n\nl=0\n\n?u?1(k + l)\nT\nQ?u1?u?1(k + l)+\n\nNc?1?\n\nl=0\n\n(u?1(k + l)? u?T arget(k + l))\nT\nQT arget1 (u?1(k + l)? u?T arget(k + l))\n\nsubject to local dynamics (5.3) and the following constraints:\n\n\n\n56 5. Microgrid Control\n\nFigure 5.3: Implementation Flowchart\n\nx1 ? x?1(k + l + 1) ? x1 (5.5)\n\nu1 ? u?1(k + l) ? u1 (5.6)\n\ny?1(k + l) = ydem(k) (5.7)\n\nu?1(k + l) = PRenewable = PAvailable (5.8)\n\nu?Target(1, k + l) = u?2(k + l) (5.9)\n\nx1(k) = x?1(k) (5.10)\n\nfor l = 0, . . . , Np ? 1, where Qu1, Qx1, Q?u1 e QTarget1 are positive\ndefinite weighting matrices, Np and Nc are the prediction and control\nhorizon respectively 1. With respect to the notation, hat (a?) over vari-\nables is used to denote variables over the prediction horizon, ai and\na?i denote minimum and maximum allowed values respectively, and a?i\nrefers to variables whose values are supposed to be known, for example,\ninitial conditions. In this work we have assumed a bidirectional energy\nflow between the hub and the DNO so that the negative threshold is\n\n1The weighting matrices were formulated as: Q\u00b5 =\n\n?\n\n?\n\n?\n\nq\u00b51 \u00b7 \u00b7 \u00b7 0\n.\n.\n.\n\n...\n.\n.\n.\n\n0 \u00b7 \u00b7 \u00b7 q\u00b5n\u00b5\n\n?\n\n?\n\n?\n, for\n\n\u00b5 = {u1, x1, ?u1, Target1} where n\u00b5 is the number of variables \u00b5.\n\n\n\n5.2. Laboratory Microgrid Control 57\n\nused.\nMatrix Qu1 is adjusted to minimize the use of the DNO and the\n\nstorage units. Matrix Qx1 is used to maintain the value of SOC and\nMHL next to 50%. Matrix Q?u1 is adjusted to minimize the control\nincrements in the electrolyzer and fuel cell. Weights of matrix QTarget1\nare set to guarantee that the controller will follow the targets sent by\nthe second MPC.\n\nSecond Controller (MPC2)\n\nThe second MPC was implemented with the following objective\nfunction:\n\nJ2 =\n\nNc?1?\n\nl=0\n\nu?2(k + l)\nT\nQu2u?2(k + l) + f\n\nT\nu2u?2(k + l)+ (5.11)\n\nNc?1?\n\nl=0\n\n(u?2(k + l)? u?ref (k + l))\nT\nQe2 (u?(k + l)? u?ref (k + l)) +\n\nNp?1\n?\n\nl=0\n\n(x?2(k + l)? x?ref (k + l))\nT\nQx2 (x?2(k + l)? x?ref (k + l)) +\n\n(x?2(k + Np) ? x?ref (k + Np))\nT\nQNp (x?2(k + Np) ? x?ref (k + Np))\n\nsubject to local dynamics (5.3) and the following constraints:\n\nx2 ? x?2(k + l + 1) ? x2 (5.12)\n\nu2 ? u?2(k + l) ? u2 (5.13)\n\ny?2(k + l) = ydem(k) (5.14)\n\nx2(k) = x?2(k) (5.15)\n\nThe first term of the objective function is used for the manage-\nment of renewable energy sources and purchasing power for the DNO.\nThe weights Qu2 and fu2 are tuned according to the price of each energy\nsource. The second term is responsible for ensuring the maximum use\nof renewable energy sources in order to minimize the error between the\namount of power available and the amount of energy used. The third\nterm is responsible for maintaining the load level of storage around\n50% of the maximum. This way deviations form this value are allowed\nwhen there is need to store more energy or use the stored energy. This\nterm is also used to charge the batteries of electric vehicles according\n\n\n\n58 5. Microgrid Control\n\nto the charging type, as will be explained below. Finally, the fourth\nterm relative to the final state weights is introduced to ensure that the\nvehicle batteries will be fully charged at the end of the charging time.\n\nDifferent weights for sale and purchase were used to manage the\npurchase and sale of energy to the DNO. The part of the objective\nfunction related to the energy exchanged with the DNO is:\n\nJ2 =\n\nNp?1\n?\n\nl=0\n\nP?DNO(k + l)\nT QsaleP?DNO(k + l)+ (5.16)\n\nz?DNO(k + l)\nT (Qpurchase ?Qsale) z?DNO(k + l)+\n\nfsaleP?DNO(k + l) + (fpurchase ?fsale) z?DNO(k + l)\n\nNote that when power P?DNO > 0 we have ?DNO = 1 and z?DNO(k) =\nP?DNO(k), which means that energy is purchased from the DNO and\ntherefore the purchase weight is used. Otherwise P?DNO &lt;0 implies\n?DNO = 0 and z?DNO(k) = 0 and the sale weight is used. This makes\nit possible to use different weights for the same variable. The values of\nthe weights were adjusted according to the price of energy.\n\nCharging Station Management Unit\n\nA Charging Station Management Unit (CSMU) was designed to\nmanage the use of the electric vehicle batteries over the microgrid. The\nCSMU decides the operation mode of each electric vehicle battery and\ncommunicate it to the second level MPC. This supervisor was imple-\nmented by the algorithm 3.\n\nAt the time of vehicle connection to the charging station, the user\nmust inform the charging type ChT (slow or fast), the arrival time Ta\nand the parking time Tp. If slow charge is chosen the battery charges\nover the parking time using low-power charge. In the case of fast charge\nthe battery is charged with maximum power, this is done only half an\nhour before the pre-set parking time, and in the rest of the time the\nbattery is available for use as a storage for microgrid. During the period\nof slow or fast charge the weights Qx and QNp are tuned to a positive\nvalue in order to ensure that the load is charged on time. When the\nbattery is used as storage these weights assume null values.\n\n\n\n5.2. Laboratory Microgrid Control 59\n\nAlgorithm 3 Charging Station Management\n\nInput: Ta, Tp,ChT ,?,Time\nOutput: Qx, QNp,u\n1: for i = 1 to nc do\n2: if ?(i) = 1 {Test if there is a parked vehicle} then\n3: if ChT (i) = 1 {Fast Charge} then\n4: if Time ? Ta + Tp ?30 minutes then\n5: Set Qx(i, i) to the fast charge value\n6: Set QNp(i, i) to the fast charge value\n7: else {Use the battery as a grid storage}\n8: Set Qx(i, i) to zero\n9: Set QNp(i, i) to zero\n\n10: end if\n11: else {Slow Charge}\n12: Set Qx(i, i) to the slow charge value\n13: Set QNp(i, i) to the slow charge value\n14: Set u(i) to the slow charge value\n15: end if\n16: end if\n17: end for\n\nSwitching between electrolyzer and the fuel cell\n\nIn relation to the operation of the fuel cell and electrolyzer, it\nmust be taken into account that both equipments have a minimum\ntime to reach the steady state. Another important point is that abrupt\nswitching between them should be avoided to maximize the useful life.\nThus an algorithm was developed to attempt the following objectives:\n\n1. Minimal time between switch on and switch off (Ton(ez,fc)?Toff(ez,fc) ?\nTmin(ez,fc));\n\n2. Maintain the equipment on (or off) during the longest time inter-\nval;\n\n3. Number of switching in the horizon less than a maximum (MS).\n\nTo attempt the first objective the constraint (5.17) is added to the\noptimization problem while Ton(ez,fc) ? Toff(ez,fc) ? Tmin(ez,fc). This\nway no switching throughout the prediction horizon is guaranteed.\n\n??H2(k + l) = ??H2(k + l ?1) (5.17)\n\n\n\n60 5. Microgrid Control\n\nTo satisfy the second objective, an additional variable ???H2(k +\n\nl) = abs(??H2(k + l) ? ??H2(k + l ? 1)) is included, that is the absolute\nvalue of the binary variable increment and the following term is added\nto the objective function to minimize the number of switches:\n\nJ =\n\nNp?1\n?\n\nl=0\n\n???H2 (k + l)\nT Q??\n\nNp?1\n?\n\nl=0\n\n???H2(k + l) (5.18)\n\nFinally, the following constraint that imposes a maximum number\nof switches (MS) in the prediction horizon is introduced:\n\nNp?1\n?\n\nl=0\n\n???H2(k + l) ? MS (5.19)\n\nIn the proposed method, practical requirements, as the minimal\noperational time and reduced number of switching, are introduced ex-\nplicitly in the optimization problem. As the MPC methodology consists\nof solving an optimization problem for every instant of prediction hori-\nzon, the switching constraints are taken into account by the MPC over\nthe prediction horizon, influencing future decisions of energy manage-\nment. This way the algorithm provides an optimized solution to the\nhydrogen storage management problem.\n\n5.2.4 Experimental Results\n\nIn this section, the experimental results of the proposed control\nstrategy applied to the physical microgrid are presented. The control\nstrategy was implemented using the software Matlab [74] with Yalmip\ntoolbox[69] and solver CPLEX [58] connected to a Programmable Logic\nController (PLC) through OPC. The microgrid is equipped with a high\nnumber of sensors and actuators directly controlled by a PLC (Schnei-\nder M340). A hierarchical architecture is adopted for reliable microgrid\noperation. A lower control level is managed by the PLC which monitors\ncritical variables. If any of the critical variables (bus voltage, pressure,\ncurrent, SOC etc.) is out of safety bounds, the PLC stops the oper-\nation carrying out an emergency stop. Above this control layer, the\nMatlab interface allows to implement advanced controllers. This in-\nterface includes the estimation of the states, such as battery state of\ncharge (SOC) and Metal Hydride Level (MHL). All experiments were\nconducted during a period of 24 hours. Electric vehicles 1 and 3 receive\n\n\n\n5.2. Laboratory Microgrid Control 61\n\nfast charge while 2 and 4 receive slow charge. The microgrid control ob-\njectives are to maximize the use of renewable energy sources, make the\npurchase and sale management of electricity to the DNO, coordinate\nthe use of the battery bank and the hydrogen storage to minimize the\noscillations between the production and demand, perform the charging\nof electric vehicles and ensure the load demand at all periods of time.\nAll parameter values are presented in appendix A.\n\nThree different experiments were carried out for the controller\nvalidation. Three representative weather patterns were selected. In\nparticular, for the first experiment the electronic power supply was\nused to emulate a solar photovoltaic generator in a sunny day as shown\nin figures 5.4 and 5.5.\n\nDuring the period from 0h to 8h and from 19h to 24h, the bat-\ntery and the fuel cell worked uninterruptedly to provide most part of\nenergy required to meet the demand and reduce the amount of energy\nimported from the external grid. When there is high irradiation (8h to\n18h), part of energy excess is sold to the DNO and other part is used to\ncharge the battery and the hydrogen storage through the electrolyzer\noperation. This way the proposed control strategy provides an optimal\npower distribution between the batteries, the electrolyzer and exported\nto the grid, which is a fundamental difference of this controller com-\npared to traditional heuristic controllers. At the end of the day (18h to\n19h), when there is less irradiation, happened a switching between the\nfuel cell and the electrolyzer, respecting the minimum operation time\nof each equipment.\n\nAs can be seen in figure 5.5, when EV1 was parked at 7h, its\nbattery is used to avoid fluctuations, and after 8h EV1 was charged.\nThere exist some oscillations in the power of EV1 and EV3 during the\ncharge procedure that probably were caused by an aggressive tune of\nthe controller parameters. EV2 and EV4 were charged in a slow charge\nmode.\n\nThe second experiment was performed in a cloudy day scenario,\nas can be seen in figures 5.6 and 5.7. A cloudy day represents a great\nchallenge for renewable microgrids, since the control has to cope with\nhigh power fluctuations. In this sense the storage system should have\nthe ability to absorb such fluctuations. As the microgrid is composed\nby a hybrid storage system, it is expected that the battery bank absorbs\nhigh frequency oscillations while the hydrogen storage provides energy\nfor a long time when the irradiation is not sufficient to meet the demand.\nAnother challenge is to minimize the switching in the hydrogen storage\nwhich may be caused by oscillatory conditions.\n\n\n\n62 5. Microgrid Control\n\nFigure 5.4: Energy sources and storage units - Sunny day\n\nFigure 5.5: Electric vehicles charge management - Sunny day\n\nWhen the weather is cloudy, between 12h and 17 : 30h, the bat-\ntery bank and the batteries of electric vehicles absorbed most of the\npower fluctuation. It was observed a short switching between the elec-\ntrolyzer and the fuel cell, from 12h to 13h, that is caused by the radiance\noscillation. In the rest of the experiment the hydrogen storage provided\nenergy to the system at night and stored energy during the day. The\ndifference between the initial and the final MHL is greater than com-\npared to the sunny day experiment, that is expected once the radiance\nduring the day is not sufficient to replace the energy expended at night.\nThe radiance oscillation, caused by the clouds, affects directly the pro-\nfile of energy sold to the DNO and the battery life as the number of\ncharge/discharge cycles increase with fluctuation condition. Otherwise\n\n\n\n5.2. Laboratory Microgrid Control 63\n\nfuel cell and electrolyzer operation is less affected thanks to the algo-\nrithm presented in section 5.2.3 that limits the switching between both\nequipment.\n\nWhen EV1 was parked at 7h, its battery is used to provide energy\nto the load, and after 9h EV1 was charged as can be seen in figure\n5.7. The batteries of EV1 and EV3 were used to mitigate the power\nfluctuation during the cloudy period that caused energy oscillation,\nfrom 12h and 16h to EV1 and from 12h and 17 : 30h to EV3. A slow\ncharge was applied in EV2 and EV4.\n\nFigure 5.6: Energy sources and storage units - Cloudy day\n\nFigure 5.7: Electric vehicles charge management - Cloudy day\n\nThe third experiment was conducted using a wind turbine as re-\nnewable energy source and the results are shown in figures 5.8 and 5.9.\nIn this experiment, the fluctuations are not so abrupt like in the cloudy\n\n\n\n64 5. Microgrid Control\n\nday. However, it still presents a high stochastic behavior in the wind\nturbine production. There are some switching in the hydrogen storage,\nat 10h when a wind fluctuation happens and after 20h when it is neces-\nsary provide energy to the load. In this case the final value of MHL at\nthe end of the day is greater than at the beginning, as a consequence\nof the electrolyzer operation in most part of the day. The batteries of\nelectric vehicles are scarcely used by the microgrid as can be seen in\nfigure 5.9.\n\nIn all experiments there are four switches between the fuel cell\nand the electrolyzer. This occurs because of the effect of the proposed\nconstraints and the penalty function to maximize the operating time of\neach equipment (once it has been switched on).\n\nFigure 5.8: Energy sources and storage units - Windy day\n\nFigure 5.9: Electric vehicles charge management - Windy day\n\n\n\n5.3. Networked Microgrids 65\n\n5.3 Networked Microgrids\n\nThe objective of this section is to present a distributed energy\nmanagement system for optimizing direct current (DC) networked mi-\ncrogrids where each microgrid is composed by renewable energy sources\nand a V2G system to charge electric vehicles.\n\nThe microgrids are interconnected to each other and with the dis-\ntribution network operator (DNO) by a physical common bus. Again\nin this case the system modeling was carried out using the Energy Hubs\nmethodology. In normal operation the proposed energy management\nsystem (EMS) is responsible for performing the energy management\nbetween microgrids and purchase and sale energy to the DNO, maxi-\nmizing the use of renewable energy sources, managing the use of energy\nstorage units and performing the charge of the parked vehicles. During\na fault the EMS has the task of ensuring that all microgrids will co-\noperate to mitigate the fault effects. On the other hand the proposed\ncontroller performs, for each microgrid, the management of the use of\nrenewable energy sources, energy storage units, vehicles charge and the\npurchase and sale of electric power to the DNO.\n\n5.3.1 V2G Networked Microgrids\n\nThe analyzed network is composed of four microgrids as shown\nin figure 5.10, although the methodology can be used with a network\nof any number of microgrids. The microgrids are connected each other\nthrough a common physical point and it is assumed that each microgrid\ncan sell/purchase energy to DNO.\n\nThe microgrids are composed of a renewable energy source (so-\nlar/wind), a energy storage system (bank of batteries), an electric vehi-\ncle charging station and a load that represents residential or industrial\nconsumers. Microgrids 1 and 2 are composed of a grid of photovoltaic\npanels, while, 3 and 4 are powered by wind turbines. The charging\nstation has capacity to charge ten vehicles simultaneously and it is pro-\nvided with a photovoltaic energy source. For the battery bank and\nthe electric vehicle batteries different charge/discharge efficiencies were\nconsidered as pointed in [45] and [42]. The technical characteristics of\nall equipments are summarized in table 5.2.\n\n5.3.2 System Modeling\n\nAll the modeling aspects of the microgrids are equal to the ones\npresented in section 4.3. Hereafter the modeling aspects related to\n\n\n\n66 5. Microgrid Control\n\nFigure 5.10: Network of Microgrids\n\nthe connection between the microgrids are presented. The complete\n\ndecision vector (manipulated variables) is u =\n[\nuL uE ? z\n\n]T\n;\n\nwith uL = PDNO where PDNO is the power exchanged with DNO;\n\nuE =\n[\nPB PBev1 . . . PBev10\n\n]T\nwhere PB and PBev1to10 are re-\n\nspectively the power of battery bank and electric vehicles batteries; ? =\n[\n?DNO ?B ?Bev1 . . . ?Bev10\n\n]T\nwhere ?DNO, ?B and ?Bev1to10\n\nare binary variables; z =\n[\nzDNO zB zBev1 . . . zBev10\n\n]T\nwhere\n\nzDNO, zB and zBev1to10 are continuous auxiliary variables.\nAs all power generated by the renewable energy sources (photo-\n\nvoltaic and wind) has to be used by the system, they were modeled as\ndisturbances according to vector\n\nr=\n\n?\n\n?\n\nPRenewable\nPPV Ch\n\n?\n\n? (5.20)\n\nwhere PRenewable can be photovoltaic or wind energy source depending\non the microgrid and PPV Ch is the charging station photovoltaic energy\nsource. Interconnection variables that represent the power exchanged\namong the microgrids were inserted in the model through the following\nin/out interconnection vectors:\n\n\n\n5.3. Networked Microgrids 67\n\nTable 5.2: Microgrids Components\n\nPhotovoltaic panels Wind Turbines\nMicro Grid 1: PS = 1.5MWp Micro Grid 3: PW = 2MWp\nMicro Grid 2: PS = 2MWp Micro Grid 4: PW = 3MWp\n\nLi-Ion Battery bank\nPower: PB = 1MW Charge efficiency: ?Ch = 0.92\n\nCapacity: CB = 0.5MWh Discharge efficiency:?D = 0.95\n\nCharging Station\nPV panels: PS = 0.03MWp\n\nLi-Ion Ev Battery\nPower: PB = 0.06MW Charge efficiency: ?Ch = 0.92\n\nCapacity: CB = 0.023MWh Discharge efficiency:?D = 0.95\n\nwin,i?j=\n\n?\n\n?\n\n?\n\n?\n\nwin,i?j1\nwin,i?j2\nwin,i?j3\n\n?\n\n?\n\n?\n\n?\n\n,wout,i?j=\n\n?\n\n?\n\n?\n\n?\n\nwout,i?j1\nwout,i?j2\nwout,i?j3\n\n?\n\n?\n\n?\n\n?\n\n(5.21)\n\nwhere win,i?j is the power received by the microgrid i from the mi-\ncrogrid j and wout,i?j is the power sent from the microgrid i to the\nmicrogrid j. The model can be written in a condensed form:\n\nx(k + 1) =Ax(k) + ?u(k) (5.22)\n\ny(k) =?u(k) + Dr(k) + ?inwin,i?j(k) (5.23)\n\nwout,i?j(k) = ?out,i?jy(k) (5.24)\n\nE??+Ezz(k) ? E\nE\nu u\n\nE(k) + E0, (5.25)\n\nwhere the states are the battery bank SOC (state of charge) and the\nSOC of each electric vehicle battery.\n\n5.3.3 Control Algorithm\n\nThis section gives details of the proposed distributed predictive\ncontrol structure focusing on optimizing the operation. In this con-\ntrol structure, the global optimization problem is distributed between\nagents in the form of local optimization goals. Figure 5.11 shows the\ncontrol structure of each microgrid. The MPC is designed to achieve the\n\n\n\n68 5. Microgrid Control\n\nmicrogrid economic optimization managing the storage state of charge\nand the energy selling and purchasing to DNO. The CSMU, described in\nprevious section, manages the use of electric vehicles batteries as stor-\nage and guarantees that the charging constraints (charging type and\ntime) are satisfied. The microgrid interconnection selector is respon-\nsible for analyzing if the microgrid has excess or deficiency of energy\nand classifies the microgrids as an energy provider or receptor. In this\nway the interconnections are selected to manage the energy flow from\nproviders to receptors.\n\nFigure 5.11: Control Structure\n\nObjective Function\n\nThe optimization problem for each microgrid uses the following\nlocal objective function:\n\nJlocal =\n\nNp?1\n?\n\nl=0\n\nu?(k + l)\nT\nQu?(k + l) + f\n\nT\nu?(k + l)+\n\nNp?1\n?\n\nl=0\n\n(x?(k + l)? x?ref (k + l))\nT\nQx (x?(k + l)? x?ref (k + l)) +\n\n(x?(k + Np) ? x?ref (k + Np))\nT\nQNp (x?(k + Np) ? x?ref (k + Np))\n\n(5.26)\n\nsubject to local dynamics (5.22) and (5.25) and the following con-\nstraints:\n\n\n\n5.3. Networked Microgrids 69\n\nxi ? x?i(k + l + 1) ? xi (5.27)\n\nui ? u?i(k + l) ? ui (5.28)\n\ny?i(k + l) = ydem(k) (5.29)\n\nxi(k) = x?i(k) (5.30)\n\nfor l = 0, . . . , Np ? 1, where Q, Qx are positive definite weighting ma-\ntrices, f is a vector and Np is the prediction horizon. It was assumed a\nbidirectional energy flow between the microgrid and the DNO so that\nthe negative threshold is used.\n\nThe first term of the objective function is used for the manage-\nment of the renewable energy sources and for purchasing power from\nthe DNO. The weights Q and f are tuned according to the price of each\nenergy source. The second term minimizes the error between the state\nand the state reference and is responsible for maintaining the storage\nlevel around 50% of the total load, and allows deviations from this\nvalue when there is need to store more energy or use the stored energy.\nThe third term which weights the error between the final state and\ndesired value is introduced to ensure that the vehicle batteries will be\nfully charged at the end of the charging time. These last two terms are\nused to charge the batteries of electric vehicles according to the charg-\ning type, as will be explained below. As described in previous section\nthe different prices of energy sold/purchased with DNO are treated in\nthe optimization problem by a MLD transformation in the objective\nfunction.\n\nInterconnection Selector\n\nThe interaction between microgrids is only psychically possible\nwhen there is at least one microgrid with energy excess and another or\nothers with deficiency of energy. To impose this physical restriction an\ninterconnection selector was created, that classifies the microgrids. The\nalgorithm performs the logic test PRenewable+PPV Ch ? PDemand; if the\ntest is true the microgrid is classified as a provider (Qprovider = 1 and\nQreceptor = 0) and in case the test is false the microgrid is a receptor\n(Qprovider = 0 and Qreceptor = 1).\n\nIn order to ensure the energy flow direction, from providers to re-\nceptors, the following constraints were added to each local optimization\n\n\n\n70 5. Microgrid Control\n\nproblem:\n\nQreceptor\n?\n\nj=1?3\nwout,i?j =0 (5.31)\n\nQprovider\n?\n\nj=1?3 win,i?j =0 (5.32)\n\nQprovider\n?\n\nj=1?3 wout,i?j ??PRenewable+PPVCh?PDemand? (5.33)\n\nQreceptor\n?\n\nj=1?3 win,i?j ??PRenewable+PPVCh?PDemand? (5.34)\n\nThe first and second constraints were used to force null value to\nthe interconnection variable that will not be used. For example, if the\nmicrogrid is a provider just the output interconnection variables will\nbe used and the input variables will be null. The third and fourth\nconstraints were used to limit the energy flow between the microgrids.\n\nIn the studied system all microgrids can communicate each other\nby the interconnection variables and can buy/sell energy to the DNO.\nEach microgrid optimization problem has to satisfy the interconnec-\ntions constraints win,j?i = wout,i?j and wout,j?i = win,i?j. To en-\nsure that these constraints will be satisfied it is necessary to apply\na distributed control algorithm based on communication between the\nagents. This way, the Hybrid Distributed MPC framework presented\nin chapter 4 was used.\n\n5.4 Results\n\nThe proposed Hybrid DMPC strategy was applied to the net-\nworked microgrids described in section 5.3.1. A simulation with a pe-\nriod of 24 hours and a sampling time of 10 minutes was performed using\nthe software Matlab [74] with Yalmip toolbox[69] and solver CPLEX\n[58]. The control objectives of each microgrid are to maximize the use\nof renewable energy sources, make the purchase and sale management\nof electricity to the DNO, use the storage to minimize the oscillations\nbetween the production and demand, perform the charging of electric\nvehicles and ensure the load demand at all periods of time. From the\ninterconnected systems point of view it is desired to maximize energy\nexchange between microgrids in a way to reduce the amount of en-\nergy purchased from the DNO. In this simulation scenario renewable\nsources data extracted from experimental microgrid described in [113]\nwere used. All parameter values are presented in appendix A.\n\nAs each microgrid has 12 binary variables related to the physi-\ncal dynamics (one related to energy sells/purchases to DNO, another\nrelated to battery bank and ten related to electric vehicles) and a pre-\n\n\n\n5.4. Results 71\n\ndiction horizon of N = 6 was used, the total number of binary variables\nis 72. This way each microgrid has 272 possible instances to the local\ncontroller which results in\n\n?4\ni=1 2\n\n72 configurations for the binary vari-\nables in the global optimization problem.\n\nAs explained in chapter 3, the proposed algorithm reduces the\nset of controller instances to 4 using Nb = 1 and 24 for Nb = 6. A\nsimulation analysis to determine the influence of Nb, testing Nb = 1\nuntil Nb = 6 with N = 6 and Nc = 2 was performed. Figure 5.20 shows\nthe number of iterations for each time instant and the calculation time\nfor each Nb. To facilitate the figure visualization a zoom of the first ten\nhours is provided. In this case the number of iterations varies between\n1839 and 3693, and the calculation time increases with Nb. As shown\nin Table 5.3, Nb = 3 offers the best compromise between the number\nof iterations and the calculation time, getting 1094 iterations in 13.92\nminutes with an average time of 5.80 seconds per iteration. For the\nother values of Nb, the system presented peaks of maximum iterations\nbetween 17h and 20h. Hence, in this context the best choice is Nb = 3.\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n100\n\n200\n\n300\n\n400\n\n500\n\n600\nIterations\n\nN\nb\n\n= 1\n\nN\nb\n\n= 2\n\nN\nb\n\n= 3\n\nN\nb\n\n= 4\n\nN\nb\n\n= 5\n\nN\nb\n\n= 6\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n50\n\n100\n\n150\n\n200\n\n250\n\nT\nim\n\ne\n (\n\ns\ne\n\nc\no\n\nn\nd\n\ns\n)\n\nCalculation Time\n\nN\nb\n\n= 1\n\nN\nb\n\n= 2\n\nN\nb\n\n= 3\n\nN\nb\n\n= 4\n\nN\nb\n\n= 5\n\nN\nb\n\n= 6\n\nFigure 5.12: Number of iterations and calculation time varying Nb.\n\nTable 5.4 presents a comparison between the proposed hybrid\nDMPC framework and centralized MIQP (CMIQP) solved by CPLEX\nbranch and bound solver. As expected, the computation time expended\nby the hybrid DMPC was greater than the centralized solution and this\nresult is explained by the number of optimization problems solved at\neach iteration. However hybrid DMPC has an average calculation time\nof 5.8 seconds that is much smaller than the sampling of 10 minutes.\nBoth algorithms presented similar costs, a fact that shows that the\nproposed DMPC can deal properly with problems composed by a great\n\n\n\n72 5. Microgrid Control\n\nTable 5.3: Analysis of Nb\n\nIterations Total time (min) Average time (s)\n\nNb = 1 2949 17.3 7.21\nNb = 2 1839 15.7 6.56\nNb = 3 1094 13.92 5.80\nNb = 4 3687 32.13 13.39\nNb = 5 2214 27.33 11.39\nNb = 6 3693 37.65 15.65\n\nnumber of binary variables in a distributed fashion and provide a solu-\ntion close to the optimal obtained by centralized algorithm.\n\nTable 5.4: Performance Indexes\n\nHybridDMPC CMIQP\n\nIterations 1094 ?\nTotal time (min) 13.92 2.45\nAverage time (s) 5.8 1.01\nTotal cost 1.9 \u00d71015 1.81 \u00d71015\n\nAverage cost 1.31 \u00d71013 1.25 \u00d71013\n\nIn order to investigate the interconnection advantages a compar-\nison between the networked microgrids with distributed controller and\nthe isolated microgrids with local centralized controllers was performed.\nFigures 5.14 and 5.15 show the energy sources graphs for simulation\nwith interconnected and isolated microgrids respectively, while figure\n5.16 shows the state of charge of each microgrid in both simulation sce-\nnarios. To facilitate the visualization of charging station, photovoltaic\nsource and battery powers were plotted multiplied by a factor of 10.\nFigure 5.13 shows the sell and purchase prices of energy exchanged with\nDNO.\n\nIn respect to the amount of energy exchanged with the DNO, as\nshown in table 5.5, in networked arrangement all microgrids sold en-\nergy to DNO and only microgrids 1 and 2 purchased 0.067MWh and\n0.047MWh respectively. However in isolated scenario microgrids 1 and\n2 purchased more energy (3.85MWh and 10.02MWh) and microgrids 3\nand 4 sold a great amount of energy to DNO. As the prices of energy\nexchanged with DNO are variable over the day and the amount of en-\n\n\n\n5.4. Results 73\n\nFigure 5.13: Energy prices\n\nergy exchanged in both scenarios are different, there are distinct energy\ncosts for each microgrid. In isolated case all microgrids sold 980.41eand\npurchased 618.34etotalizing a profit of 362.07ewhile in the intercon-\nnected case the total profit is 932.19e. These differences between both\nschemes is because when microgrids are interconnected they exchange\nenergy with each other and consequently minimize the amount of en-\nergy purchased from DNO, while in isolated case microgrids just had\nthe DNO to exchange energy. From a sustainable viewpoint the net-\nworked case is better because it uses less DNO energy that is usually\ngenerated from fossil energy sources.\n\nAnalyzing figures 5.16 it is possible to see that in the isolated\ncase microgrids 1 and 2 had more variability of SOC in the battery\nbank than in the interconnected case. The reason of this fact is that\nwhen microgrids are interconnected all systems cooperate to mitigate\nthe power fluctuations while in the isolated case there is only battery\nbank for this function.\n\nDuring interconnected simulation microgrids 3 and 4 had excess\nof energy and were classified as providers while microgrids 1 and 2 as\nreceptors. The energy flow between microgrids is shown in figure 5.19\n(a). Microgrids cooperate each other in periods when, for one or more\nmicrogrids, demand is greater than power of energy source.\n\nFigure 5.17 displays the vehicles batteries management in isolated\ncase. For all microgrids Vehicles 2, 3, 6 and 10 use slow charge. Other\nvehicles use fast charge so that part of the time that they are connected\nto the microgrid they operate as storage elements and only in the last\n30 minutes the batteries are actually charged. This functionality was\n\n\n\n74 5. Microgrid Control\n\nTable 5.5: Energy exchanged with DNO\n\nEnergy (MWh) Cost (e)\nSold Purchased Sold Purchased\n\nInterconnected Case\n\nMG1 4.57 0.067 103.26 3.47\nMG2 3.34 0.047 75.33 2.46\nMG3 17.54 0 345.45 0\nMG4 20.8 0 414.08 0\nTotal 46.25 0.0114 938.12 5.93\n\nIsolated Case\n\nMG1 4.60 3.85 103.68 168.45\nMG2 3.41 10.02 77.26 449.89\nMG3 21.05 0 408.11 0\nMG4 30.00 0 391.36 0\nTotal 59.06 13.87 980.41 618.34\n\nbetter used in case of isolated microgrids, as highlighted in figure 5.17,\nbecause in this situation microgrids have only the storage units to deal\nwith fluctuations. In interconnected arrangement it was not necessary\nto use the electric vehicles as storage units because this fluctuations are\nhandled through interconnection.\n\nIn the second simulation a fault in the energy source of microgrid\n3 was applied starting at 10h and extinguishing at 14h. The main\npurpose of this test is to investigate how distributed controller deal\nwith disturbances and maintain interconnected system stability. As\nshown in figure 5.18, during the fault the amount of energy sold to\nDNO is reduced compared with no fault case. Part of this energy is\nexchanged between microgrids to support microgrid 3 as shown in figure\n5.19. During the fault the number of iterations increases compared to\nthe simulation without fault and in few moments reaches the maximum\nlimit of 600 iterations (see figure 5.20).\n\n5.5 Final Remarks\n\nIn this chapter the problem of control of microgrids integrating\nrenewable generation, hybrid storage technologies and an interaction\nwith a V2G system was presented. A hierarchical MPC structure was\nproposed to perform the economic optimization and management of\nstorage systems. Constraints and penalty functions were introduced\n\n\n\n5.5. Final Remarks 75\n\n0 5 10 15 20\n\nTime (h)\n\n-1\n\n0\n\n1\n\n2\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMicrogrid 1\n\n0 5 10 15 20\n\nTime (h)\n\n-1\n\n0\n\n1\n\n2\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMicrogrid 2\n\n0 5 10 15 20\n\nTime (h)\n\n-4\n\n-2\n\n0\n\n2\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMicrogrid 3\n\n0 5 10 15 20\n\nTime (h)\n\n-8\n\n-6\n\n-4\n\n-2\n\n0\n\n2\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMicrogrid 4\n\nFigure 5.14: Interconnected simulation energy sources. (blue - renewable\nenergy sources, red - charging station photovoltaic source, black - power\nexchanged with DNO, cyan - battery power, green - Demand)\n\nin order to deal with the switching between the fuel cell and the elec-\ntrolyzer and to maximize the time each equipment is on. The charging\nstation management algorithm performed the use of the electric vehicles\nbatteries as a microgrid storage.\n\nIn the second part of this chapter the control of networked micro-\ngrids was discussed. The hybrid DMPC developed in chapter 4 was used\nas energy management system to perform the economic energy man-\nagement and guarantee the cooperation between microgrids in normal\nand fault operation. The interconnection selector showed usefulness en-\nsuring the energy flow direction from providers to receptors. As shown\nin the simulation results, the proposed controller presented satisfactory\nresults for different operating conditions.\n\n\n\n76 5. Microgrid Control\n\n0 5 10 15 20\n\nTime (h)\n\n-5\n\n0\n\n5\nP\n\no\nw\n\ne\nr \n\n(M\nW\n\n)\nMicrogrid 1\n\n0 5 10 15 20\n\nTime (h)\n\n-5\n\n0\n\n5\n\nP\no\nw\n\ne\nr \n\n(M\nW\n\n)\n\nMicrogrid 2\n\n0 5 10 15 20\n\nTime (h)\n\n-2\n\n-1\n\n0\n\n1\n\n2\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMicrogrid 3\n\n0 5 10 15 20\n\nTime (h)\n\n-2\n\n-1\n\n0\n\n1\n\n2\n\n3\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMicrogrid 4\n\nFigure 5.15: Isolated simulation energy sources. (blue - renewable energy\nsources, red - charging station photovoltaic source, black - power exchanged\nwith DNO, cyan - battery power, green - Demand)\n\nTo complete the study of this thesis, in the chapter 6, the Brazilian\nenergy scenario will be taken into account by the modeling and control\nof a hybrid generation power plant on the sugar cane industry.\n\n\n\n5.5. Final Remarks 77\n\n0 5 10 15 20\n\nTime (h)\n\n20\n\n30\n\n40\n\n50\n\nS\nO\n\nC\n (\n\n%\n)\n\nNetworked Microgrids\n\nSOC MG1\n\nSOC MG2\n\nSOC MG3\n\nSOC MG4\n\n0 5 10 15 20\n\nTime (h)\n\n40\n\n50\n\n60\n\n70\n\n80\n\n90\n\n100\n\nS\nO\n\nC\n (\n\n%\n)\n\nIsolated Microgrids\n\nSOC MG1\n\nSOC MG2\n\nSOC MG3\n\nSOC MG4\n\nFigure 5.16: Battery SOC\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\nS\nO\n\nC\n (\n\n%\n)\n\nEv1\n\nEv2\n\nEv3\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\nS\nO\n\nC\n (\n\n%\n)\n\nEv4\n\nEv5\n\nEv6\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\nS\nO\n\nC\n (\n\n%\n)\n\nEv7\n\nEv8\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n20\n\n40\n\n60\n\n80\n\n100\n\nS\nO\n\nC\n (\n\n%\n)\n\nEv9\n\nEv10\n\nFigure 5.17: Electric vehicles charge management (Isolated Microgrids)\n\n\n\n78 5. Microgrid Control\n\n0 5 10 15 20\n\nTime (h)\n\n-2\n\n-1\n\n0\n\n1\n\n2\n\n3\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMicrogrid 1\n\n0 5 10 15 20\n\nTime (h)\n\n-2\n\n0\n\n2\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMicrogrid 2\n\n0 5 10 15 20\n\nTime (h)\n\n-4\n\n-2\n\n0\n\n2\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMicrogrid 3\n\n0 5 10 15 20\n\nTime (h)\n\n-2\n\n-1\n\n0\n\n1\n\n2\n\n3\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMicrogrid 4\n\nFigure 5.18: Energy sources during a fault. (blue - renewable energy\nsources, red - charging station photovoltaic source, black - power exchanged\nwith DNO, cyan - battery power)\n\n\n\n5.5. Final Remarks 79\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n0.01\n\n0.02\n\n0.03\n\n0.04\n\nP\no\nw\n\ne\nr \n\n(M\nW\n\n)\n\nMG1 ? MG2\n\nMG1 ? MG3\n\nMG1 ? MG4\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n0.02\n\n0.04\n\n0.06\n\n0.08\n\n0.1\n\nP\no\nw\n\ne\nr \n\n(M\nW\n\n)\n\nMG2 ? MG1\n\nMG2 ? MG3\n\nMG2 ? MG4\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n0.2\n\n0.4\n\n0.6\n\nP\no\nw\n\ne\nr \n\n(M\nW\n\n)\n\nMG3 ? MG1\n\nMG3 ? MG2\n\nMG3 ? MG4\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\nP\no\nw\n\ne\nr \n\n(M\nW\n\n)\n\nMG4 ? MG1\n\nMG4 ? MG2\n\nMG4 ? MG3\n\n(a) Networked Microgrids in normal operation\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMG1 ? MG2\n\nMG1 ? MG3\n\nMG1 ? MG4\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMG2 ? MG1\n\nMG2 ? MG3\n\nMG2 ? MG4\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n0.2\n\n0.4\n\n0.6\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMG3 ? MG1\n\nMG3 ? MG2\n\nMG3 ? MG4\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n0.5\n\n1\n\n1.5\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nMG4 ? MG1\n\nMG4 ? MG2\n\nMG4 ? MG3\n\n(b) Networked Microgrids during a fault\n\nFigure 5.19: Interconnection variables in the two analyzed scenarios.\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n100\n\n200\n\n300\n\n400\n\n500\n\n600\n\nIt\ne\n\nra\nti\no\n\nn\ns\n\nWithout fault\n\nDuring a fault\n\nFigure 5.20: Number of iterations (without fault and during a fault)\n\n\n\n80 5. Microgrid Control\n\n\n\nChapter 6\n\nSugar Cane Industry\nCase\n\nGiven the importance of sugar-ethanol power plants in the Brazil-\nian energy setting and knowing that these are mostly established in\nhigh insolation sites, they become potential candidates to be managed\nas distributed power plants of hybrid sources, as seen in [39], consid-\nering biomass, biogas, solar and wind power energy and natural gas.\nThus, the control of hybrid generation and storage, including renewable\nand non-renewable sources, is a significant issue to be studied in order\nto allow the optimal management and operation, carrying out a coordi-\nnation between legal standards, minimal environmental standards and\nstate of the art techniques [54], [38].\n\nMulti-carrier systems represent a crucial need for future research.\nTraditionally, energy networks have been considered employing only\none source of energy (for example, electricity or natural gas). Recent\nworks urge to combine modeling and scrutiny of energy systems in-\ncluding various energy carriers and system intercommunication and the\nintegrated planning of different networks [49].\n\nWith greater demands for improvements in production and effi-\nciency, the operational requisites of energy systems are evermore re-\nstrict and, for that, the operation and automatic control have to aim\noptimal efficiency of these energy plants. Knowing that individual op-\ntimal conditions of subsystems do not imply the optimal condition of\na whole system, a coordination between every subsystem of a whole\nenergy system becomes necessary. This coordination is typically done\nby an automatic supervisor, in a higher level in the hierarchy of the\n\n\n\n82 6. Sugar Cane Industry Case\n\ncontrol structure of these energy plants, and, by this, the operational\nset-points of each subsystem are brought so that the operation of the\nwhole energy system is near its optimal operational point.\n\nThis chapter presents the proposal of a new hybrid energy genera-\ntion system, with the reuse of the sugar cane residues coupled with the\nuse of other renewable sources, external to the plant, as photovoltaic\npanels and wind turbines, that aims to prevent and, when not possible,\nreduce emissions and the global environmental impact. The proposed\nmicrogrid is based on a real sugar cane processing unit, with the addi-\ntion of subsystems based on renewable generation. First some details\nabout the power plant will be presented and the modeling framework\nwill be detailed. Then an optimization of the hybrid energy system\nbased on MPC is proposed.\n\n6.1 The Hybrid Generation Power System\n\nIn this section a generic hybrid energy generation system, based\non a sugar cane processing plant, that produces sugar and ethanol is\nproposed. The energy power plant is based on a real Brazilian industrial\nplant, whose structure is seen in figure 6.1. The proposed system, shown\nin figure 6.2, is composed by the following subsystems:\n\n\u2022 two boilers, with different efficiencies;\n\n\u2022 two steam turbines, with different efficiencies;\n\n\u2022 one combined heat and power system (herein denoted as CHP);\n\n\u2022 one water chiller;\n\n\u2022 one hot water tank;\n\n\u2022 photovoltaic panels;\n\n\u2022 water heating solar panels;\n\n\u2022 one wind turbine;\n\n\u2022 two pressure reduction valves;\n\n\u2022 one heat exchanger;\n\n\u2022 stocks of bagasse, straw and compressed biogas;\n\n\u2022 a battery bank.\n\n\n\n6.1. The Hybrid Generation Power System 83\n\nThe tendered system, being a plausible adaptation from a real\nplant, is interesting in an economic and sustainable point-of-view, as\nit proposes the use of renewable sources and the recycling of the sugar\ncane residues. This implies directly on the increase of the total energy\ngeneration capacity and, also, on the efficiency and the sustainability of\nthe system - that, herein, does not use any fossil fuel or energy source\nexternal to the sugar-ethanol production process. The system aims\nto use the best possible technology, that conducts a dynamic between\nlegal norms, minimum environmental standards and the state of the\nart techniques. Figure 6.2 shows the outline of the proposed system.\nThe technical characteristics of these equipments can be seen in table\n6.1. Other important data to this study, like average bagasse income\nfrom the canebrakes, can be found in table 6.2.\n\nFigure 6.1: Original Power Generation Plant\n\nThe two boilers, here nominated better efficiency and lower effi-\nciency, produce, respectively, higher (67kg?) and middle pressure (21kg?)\nsteam. They are both powered by the biomass mixture of straw and\nbagasse. The lower efficiency boiler produces less amount of steam,\nwhich is used in order to comply to the process\u2019s (ethanol and sugar)\nmiddle pressure steam demands. The other boiler\u2019s steam is used to\npropel the plant turbines. The turbines, likewise the boilers, are here\nnominated better efficiency and lower efficiency. The better efficiency\nturbine has a low pressure steam residue (1.5kg?) that is used to meet\nthe process low pressure steam demands, while the lower efficiency tur-\nbine steam residue meets the middle pressure steam demands. Both\nturbines produce electric power that, with the CHP and the renewable\nenergy generation, are related to the electric demands. The CHP is a\n\n\n\n84 6. Sugar Cane Industry Case\n\nFigure 6.2: Proposed Power Generation Plant\n\nFigure 6.3: Biomass Mixture\n\ngas engine that uses energy present in the biogas to drive a crankshaft,\nthat, through an alternator, produces electric energy. With the com-\nbustion of the gas, heat is released and recovered to warm water, mak-\ning the CHP a highly efficient system. The CHP, in this scenario, is\nboosted by the compressed biogas, made from the vinasse. The use of\nintermediate storage units (battery bank and biomass stocks) allows the\nsystem to accumulate energy (or biomass, that can be converted into\nenergy) when the renewable generation is high and use it when there\nis no renewable production. All these subsystems operating points can\nbe seen in table 6.3. More specific data on the stocks can be found in\ntable 6.4.\n\nThe whole problem here studied is subject to several constraints.\nFirstly, the efficiencies of the boilers fluctuate according to the mixture\nof biomass that boosts them. The straw is a moist left-over from the\nsugar cane, so too much straw causes problems with the ignition of\n\n\n\n6.1. The Hybrid Generation Power System 85\n\nTable 6.1: Microgrid Equipments\n\nEquipment Efficiency Used Area Other\n\nBetter Eff. Boiler 87.8 % - -\nLower Eff. Boiler 76.5 % - -\nBetter Eff. Turbine 70 % - -\nLower Eff. Turbine 65 % - -\n\nHigh-Middle Press. Reducing Valve 25 % - -\nMiddle-Low Press. Reducing Valve 20 % - -\n\nCHP ? 90 % - -\nBattery Bank (charge) 95 % - -\n\nBattery Bank (discharge) 92 % - -\nPhotovoltaic panels 15.85 % 200m2 1.8MWpeak\nSolar Water Heater 68.7 % 150m2 -\n\nWind Turbine 20 % - -\nHeat Exchanger 60 % - -\nWater Chiller 78 % - -\n\nTable 6.2: Microgrid Data\n\nDays of Harvest 200 days/year -\nProduced Sugar Cane 1610kt?crop 335t?h\nRetrieved Bagasse 450.75kt?crop 93.90t?h\nRetrieved Straw 42.028kt?crop 8.756t?h\n\nAmount of Steam used in plant processes 5000t per day -\nAverage Middle Pressure Steam Demand 84t?h 21kg?\nAverage Low Pressure Steam Demand 125t?h 1.5kg?\n\nAverage Refrigeration Demands 67t?h ? 1.6\u00d710\n6 L per day\n\nAverage Power Process Demands 8MW 192MWh per day\n\nthe boilers. It is known that the best possible mixture of bagasse and\nstraw to boost boilers is 50% of each ([119],[109],[64]). The static gains\nof the boilers vary according to the mixture of biomass used; mixtures\nwith greater amount of straw have bigger calorific power, but are wet-\nter. This is an issue of optimal control, once the amount of bagasse,\navailable in a canebrake, is always bigger than the amount of straw -\nin the studied plant, there is an average income of 93t?h of bagasse and\n8.7t?h of straw. For this, this work takes into account biomass blending\nfactors, ?A and ?B, varying from 0.5 to 1, for each boiler, as seen in\nfigure 6.3.\n\nThe proposed plant has four demands to satisfy: electric power\ndemand, due to ethanol and sugar production process; middle and low\n\n\n\n86 6. Sugar Cane Industry Case\n\nTable 6.3: Microgrids Subsystems Operating Points\n\nBetter Efficiency Turbine 11 MW ? SP AT U ? 27 MW\nLower Efficiency Turbine 3 MW ? SP BT U ? 20 MW\n\nBetter Efficiency Boiler 105 t?h ?\nSP\n\nA\nTU\n\n160\n+\n\nSP\nB\nTU\n\n85\n+ QOutV ? 190 t?h\n\nLower Efficiency Boiler 18 t?h ? SP\nB\nC ? 58 t?h\n\nCHP 0.8 MW ? PotCHP ? 8 MW\n\nTable 6.4: Microgrids Storage Units\n\nMinimum Maximum\n\nBagasse Stock 2000 t 20000 t\nStraw Stock 0 2000 t\n\nCompressed Biogas Stock 10 m3 120 m3\n\nHot Water Tank 30 m3 300 m3\n\nBattery Bank ?3000 MWh 3000 MWh\n\npressure steam demands, defined by the process; refrigeration (cold wa-\nter) demands, also defined by the process. It is important to mention\nthat satisfying each demand alone is not adequate, as they are inextri-\ncably linked. As an example: increasing the amount of power supplied\nby the turbines also increases the amount of steam produced.\n\nThe electric power that has to be produced by the microgrid con-\nsists of two factors: the internal power demands, to maintain the sugar\ncane processing - in average 8MW, and the amount of energy that is\nsold to the Distribution Network Operator (DNO) (this is defined by a\nfixed contract, 11.52GWh per month). This power generation can be\ncontinuous, maintaining an average electric power, or varied, with dif-\nferent values of electric power made available at each hour of the day.\nThis is placed as the main optimization problem of this study, more\ndeeply discussed in further sections.\n\nThe steam demands of the system correspond to the sugar and\nethanol processing steam demands. These are used to boost water\nbombs, spray bombs, fans, chippers, shredders and other equipments.\nThe refrigeration demand of the microgrid is used to cool down gen-\nerators, oil tanks from the distillery process and other systems present\non the plant.\n\n\n\n6.2. System Modeling 87\n\n6.2 System Modeling\n\nIn this section the system modeling methodology is explained.\n\n6.2.1 Manipulated Variables\n\nThe system manipulated variables are:\n\n\u2022 The lower efficiency boiler set-point, SPBC (t?h);\n\n\u2022 The lower efficiency turbine set-point, SPBTU (kW);\n\n\u2022 The better efficiency turbine set-point, SPATU (kW);\n\n\u2022 The charge/discharge power the battery bank, PB (kW);\n\n\u2022 The CHP set-point, SPCHP (kW);\n\n\u2022 The water chiller set-point, SPch (m3?h);\n\n\u2022 The heat exchangers set-point, SPTC (m3?h);\n\n\u2022 The high-middle pressure reduction valve set-point, (QOutV t?h);\n\n\u2022 The middle-low pressure reduction valve set-point, (QMBV t?h);\n\n\u2022 The hot water escape flow, (QTankEsc m\n3?h);\n\n\u2022 The middle pressure steam escape flow, (QMEsc t?h);\n\n\u2022 The low pressure steam escape flow, (QBEsct?h) and\n\n\u2022 The instant electric power that is made available, by the micro-\ngrid, to the DNO (for sale), represented by (PNet (kW));\n\n\u2022 The binary variable associated with battery charge/discharge,\n(?B);\n\n\u2022 The auxiliary continuous variable associated with battery charge/discharge,\n(zB (kW))\n\nThese manipulated variables, will be treated as set-points by lower\nlevel internal controls. The internal control of each subsystem is not a\nconcern to this work. The complete manipulated variables vector is:\n\nu =\n[\nSP AT U SP\n\nB\nT U PNet SP\n\nB\nC Q\n\nOut\nV Q\n\nM\nEsc Q\n\nB\nEsc SPCHP\n\n]\n(6.1)\n\n[\nSPCh SPT C PB Q\n\nMB\nV Q\n\nT ank\nEsc ?B zB\n\n]T\n(6.2)\n\n\n\n88 6. Sugar Cane Industry Case\n\n6.2.2 Disturbance Vector\n\nThe external disturbances to the system are:\n\nz =\n[\nWindin Irradin Bagin Strin Bgin\n\n]T\n, (6.3)\n\nwhere Windin is the amount of wind (measured in km?h) present in the\nmicrogrid area, used by the wind turbines to generate electric power,\nand Irradin is the amount of solar irradiation (measured in W?m2) on\nthe microgrid solar panels (photovoltaic and water heating). As the\nwind and the solar irradiation are considered disturbances, in the rest of\nthis thesis they will be referred as non-dispatchable renewable sources.\nBagin, Strin and Bgin are measured in t?h and represent the income\nof bagasse, straw and compressed biogas to the respective stocks.\n\n6.2.3 System Output\n\nThe system output vector is defined as:\n\ny =\n[\nDP roc Q\n\nM\nV Q\n\nL\nV QCW PSale,\n\n]T\n(6.4)\n\nwith DProc the electric demand referred to the distillery process (kW);\nQMV the flow of middle pressure steam (t?h); Q\n\nL\nV the flow of low pressure\n\nsteam (t?h); QCW the flow of cold water required by the distillery pro-\ncess (m3?h); finally, PSale represents the electric power made available\nfor the DNO (kW).\n\n6.2.4 Stock Flows\n\nThe system state vector is defined as:\n\nx =\n[\nxB xBag xStr xBg xT\n\n]T\n, (6.5)\n\nwhere xB is the battery SOC; xBag, xStr and xBg are the stored\namount of bagasse, straw and biogas in their related stocks and xT\nis the hot water tank temperature. The stocks state equations were\nobtained by mass conservation principles as follows.\n\nBattery Bank\n\nThe battery bank was modeled by the MLD procedure described\n\n\n\n6.2. System Modeling 89\n\nin section 2.2.1. For this purpose it is necessary to define the aux-\niliary variable zbat = Pbat?bat that is related to the battery charg-\ning/discharging. The state equation for the battery SOC is\n\ndxB\n\ndt\n= ??\n\nbat\nPB +\n\n(\n?\n?\nbat\n??+\n\nbat\n\n)\nzB (6.6)\n\nwhere, ?+\nbat\n\nand ??\nbat\n\nare respectively the charging and discharging ef-\nficiencies, ?bat is a binary variable and zbat is a continuous auxiliary\nvariable.\n\nBagasse Stock\n\nThe percentage of bagasse in the stock xBag is defined as the\nbagasse income flow Bagin minus the bagasse outcome flow Bagout:\n\ndxBag\n\ndt\n= Bagin ?Bagout = Bagin ?\n\n(\n?AQ\n\nA\nE + ?BQ\n\nB\nE\n\n)\n(6.7)\n\nNotice that Bagout is a linear combination of Q\nA\nE and Q\n\nB\nE; ?A\n\nand ?B are the biomass blending factors, as seen in figure 6.3.\n\nStraw Stock\n\nThe amount of straw in the stock xStr is calculated by subtracting\nthe straw output flow Strout from the straw input flow Strin:\n\ndxStr\n\ndt\n= Strin ?Strout = Strin ? [(1??A)Q\n\nA\nE + (1??B)Q\n\nB\nE] (6.8)\n\nwhere Bagoutis a linear combination of Q\nA\nE and Q\n\nB\nE that represents the\n\nbiomass mixture that runs into each boiler, in the respective order.\n\nCompressed Biogas Stock\n\nThe rate of compressed biogas xBg can be modeled as the previous\nstates by calculating the balance between the biogas income Bgin and\noutcome Bgout flow:\n\n\n\n90 6. Sugar Cane Industry Case\n\ndxBg\n\ndt\n= Bgin ?Bgout (6.9)\n\nNotice that Bgout is a consequence of the CHP operating point,\nhere chosen by the manipulated variable SPCHP .\n\nHot Water Tank\n\nIn the same way percentage of hot water xTank in the tank is cal-\nculated by the mass balance between the hot water inflow and outflow:\n\ndxT\n\ndt\n= Tin ?Tout = (QS + QCHP + QTC)? (Q\n\nTank\nEsc + QCh) (6.10)\n\nwhere QS is the inflow of hot water from the solar panels, QCHP is the\nheated water flow from the CHP; QTC is the heated water flow from the\nheat exchanger; QCh is the hot water outflow to the chiller (consequence\nof chiller operating point chosen by the manipulated variable SPCh) and\nQTankEsc is the water tank escape flow.\n\n6.2.5 Final State-Space Representation\n\nThe final state-space representation relates the state vector x,\nseen in equation (6.5), to the decision vector u, seen in equation (6.1),\nand the disturbance vector z, seen in equation (6.3) using the energy\nhub methodology, already mentioned. The discrete-time state space\nequations are represented by the following matrices:\n\n\n\n6.3. Optimization Problems 91\n\nB=\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n0 0 0 0 0 0 0 0 0 0 ?\n?\n\nbat\n0 0 0 ?\n\n?\n\nbat\n??\n\n+\nbat\n\n?1 ?3 0 ?5 ?7 0 0 0 0 0 0 0 0 0 0\n\n?2 ?4 0 ?6 ?8 0 0 0 0 0 0 0 0 0 0\n\n0 0 0 0 0 0 0 ?9 0 0 0 0 0 0 0\n\n0 0 0 0 0 0 0 ?10 ?11 ?12 0 0 ?13 0 0\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nC=\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n0 0 0 0 0\n\n0 0 ?2,3 0 0\n\n0 0 0 ?3,4 0\n\n0 0 0 0 ?4,5\n\n0 ?5,2 0 0 0\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nF=\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?1,1 ?1,2 0 0 0\n\n0 0 0 0 0\n\n0 0 0 0 0\n\n0 0 0 0 0\n\n0 0 0 0 0\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nE=\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?1 ?3 ?5 0 0 0 0 ?9 0 0 ?12 0 0 0 0\n\n0 ?4 0 ?7 ?8 ?15 0 0 0 0 0 ?13 0 0 0\n\n?2 0 0 0 0 0 ?16 0 0 ?11 0 ?14 0 0 0\n\n0 0 0 0 0 0 0 0 ?10 0 0 0 0 0 0\n\n0 0 ?6 0 0 0 0 0 0 0 0 0 0 0 0\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nwhere A is an identity matrix that relates the next (k +1) system state\nvector with the previous (k) state vector. Following the Energy Hub\nmethodology, the variation of the stocks (between k and k + 1) is the\ninwards (or outwards) flow times the time interval ?T . D is a null ma-\ntrix, for the system output vector has no relationship with the system\nstate vector, at any given instant k. B expresses the relationship be-\ntween the next system state (x(k + 1)) and the manipulated variables\n(u(k)). C expresses the relationship between the next system state\n(x(k + 1)) and the external disturbances (z(k)). F shows the relation-\nship between the system outputs (y) and the external disturbances (z).\nThe matrices variables are detailed in table 6.5. KA and KB represent,\nrespectively, the static gains of the boilers, that vary according to ?A\nand ?B.\n\n6.3 Optimization Problems\n\nIn this section the control strategy to solve the optimization prob-\nlems is explained. There are two optimization obstacles to be solved:\nthe biomass mixture optimization and the demand optimization.\n\n\n\n92 6. Sugar Cane Industry Case\n\nTable 6.5: Auxiliary Variables Index\n\n?1 ?\n?A\n\n32000\u00d7KA\n\n1\nkW\n\n?3 ?\n?A\n\n17000\u00d7KA\n\n1\nkW\n\n?5 ?\n?B\n\n200\u00d7KB\n\nh\nt\n\n?7 ?\n?A\n\n200\u00d7KA\n\nh\nt\n\n?2 ?\n(1??A)\n\n3200\u00d7KA\n\n1\nkW\n\n?4 ?\n(1??A)\n\n1700\u00d7KA\n\n1\nkW\n\n?6 ?\n(1??B)\n20\u00d7KB\n\nh\nt\n\n?8 ?\n?A\n\n20\u00d7KA\n\nh\nt\n\n?9 ?0.011\n1\nkW\n\n?10 0.15\u00d710\n?2 1\n\nkW\n?11 ?0.42\n\nh\nm3\n\n?12\n1\n3\nh\nm3\n\n?13 ?1\nh\nm3\n\n? ? ?\n\n?2,3\n1\n\n200\nh\nt\n\n?3,4\n1\n20\nh\nt\n\n?4,5 0.416\u00d710\n?2 h\n\nt\n?5,2 0.466\u00d710\n\n?2 m2\n\nW\n\n?1 1 ?3 1 ?5 ?1 ?9 1\n\n?12 ?1 ?4 0.0117\nt\n\nkWh\n?7 1 ?8 1\n\n?13 ?1 ?2 0.625\u00d710\n?2 t\n\nkWh\n?11 ?0.025\n\nt\nm3\n\n?14 1\n\n?10 1 ?6 1 ?15 ?1 ?16 ?1\n\n?1,1 100\nW.h\nm\n\n?1,2 0.8km\n2\n\n? ?\n\n6.3.1 Biomass Mixture Optimization\n\nThe mixture optimization consists in maximizing the boiler gains\n(conversion factor from amount of biomass mixture to amount of pro-\nduced steam t/h?t/h), that fluctuate according to the biomass mixture\ncomposition. The more straw there is in the mixture, the greater the\ngains (up to 50% of straw, due to misture); this is seen in table 6.6.\nNotice that these blending factors (statistical dummy variables, ?A and\n?B) are respectively related to the high efficiency boiler and the lower\nefficiency boiler. QAE and Q\n\nB\nE represent the biomass mixture that runs\n\ninto each boiler, in the respective order. The amount of bagasse outflow\nand straw outflow from the stocks (Bagout and Strout) are shown in\nequations (6.7) and (6.8).\n\nIn the mixture optimization the boiler gains (conversion factor\nfrom amount of biomass mixture to amount of produced steam) fluctu-\nate according to the biomass mixture composition. The optimization\nhere proposed is solved by the optimizer, Opt?, that has to maintain\nthe blending factors as close to 0.5 as possible, knowing the future straw\nincome predictions. This is also subject to the following constraints:\n\n1. maintain the straw stock inside the 10 % and 100 % limits, where\nthe minimum of 10 % is a safety margin for one hour operation;\n\n2. try to maintain the straw stock near a reference of 20 %, whenever\npossible;\n\n3. preserve the blending factors as dummy variables (values from 0\nto 1);\n\n4. limit the outflow of straw.\n\n\n\n6.3. Optimization Problems 93\n\nTable 6.6: Biomass mixtures: Boiler gains and calorific power\n\nMixture Calorific Power B. Eff. Boiler Gain L. Eff. Boiler Gain\n100%Bagasse 2042.205 kCal?kg 2.14 t/h?t/h 1.284 t/h?t/h\n\n90%Bagasse + 10%Straw 2074.367 kCal?kg 2.1745 t/h?t/h 1.3041 t/h?t/h\n80%Bagasse + 20%Straw 2171.022 kCal?kg 2.275 t/h?t/h 1.3644 t/h?t/h\n70%Bagasse + 30%Straw 2253.348 kCal?kg 2.3607 t/h?t/h 1.4158 t/h?t/h\n60%Bagasse + 40%Straw 2338.029 kCal?kg 2.4487 t/h?t/h 1.4686 t/h?t/h\n50%Bagasse + 50%Straw 2408.374 kCal?kg 2.5219 t/h?t/h 1.5125 t/h?t/h\n\n100%Straw 2894.036 kCal?kg 3.026 t/h?t/h 1.8156 t/h?t/h\n\n6.3.2 Demand Optimization\n\nThe other optimization problem, solved by the MPC controller,\nMPCmain, is the main purpose of this study: the microgrid has to\nproduce (sell) the contract-defined amount of electric energy, while still\nmeeting all the system demands: internal power demand, steam de-\nmands and refrigeration demands.\n\nAs explained beforehand, the contract corresponds to the gener-\nation of 11.52GWh of electric energy, per month - herein treated as\na daily production of 384MWh. The optimization has to define the\nmanipulated vector (6.1) so that the daily production of energy cor-\nresponds to the contract and the system state vector (6.5) follows a\nreference state (for example: all stocks with 50 %). This is subject to\nthe following restrictions:\n\n1. the manipulated variables have to stay within physical limits;\n\n2. the system output vector (6.4) has to contemplate the system\ndemands;\n\n3. the system state vector (6.5) has to stay within bounded limits -\nevery stock has its operational band.\n\n6.3.3 Control Structure\n\nThe proposed control structure is comprised of two levels. The\nfirst level is associated with optimizing the biomass blending factors.\nThe second (and main) level is associated with complying the process\ndemands and producing the contract-defined amount of electric energy,\nin the most efficient and sustainable way possible.\n\nFigure 6.4 shows the proposed two-level hierarchical control struc-\nture based on MPC. Both the optimizer Opt? and the controller MPCmain\n\n\n\n94 6. Sugar Cane Industry Case\n\nare operating together, on the same time scale (sampling time ?T =\n1 h). The biomass mixture optimizer acts with information of the\nbiomass mixture flows (QAE(k) and Q\n\nB\nE(k)) and the straw stock per-\n\ncentage (XStr(k)) and transmits to the microgrid and the controller\nthe instant values of the blending factors (?A(k) and ?B(k)). The\nmain controller acts with past blending factor values (?A(k ? 1) and\n?B(k ? 1)), instant disturbance, system state and system output vec-\ntors values (z(k), x(k), y(k)) and handles the manipulated variables\n(acting on the microgrid).\n\nFigure 6.4: Proposed Control Structure\n\nMain Controller (MPCMain)\n\nThe main MPC has the following objective function:\n\nJMain =\n\nNc?1?\n\ni=0\n\n?PNet ? (Econtract ? Esum)/?T?\n2\nQP\n\n(6.11)\n\nNc?1?\n\ni=0\n\nquu?(k) +\n\nNp?1\n?\n\nl=0\n\n?x?(k + i) ? x?ref (k + i)?\n2\nQx\n\n+ q??\n\nwhere q? and qu are positive defined vectors, QP and Qx are pos-\nitive definite weighting matrices, Esum represents the electric energy\nthat has already been produced by the microgrid, at given iteration k;\nEcontract represents the daily production of 38MWh; the system state\nreference is put as x?ref; ? represents a slack variable that is to be min-\nimized, used in the constraints, see equation (6.15); Np represents the\nprediction horizon, while Nc represents the control horizon. As it can\nbe seen, (Econtract ? Esum) represents how much electric energy the\nmicrogrid still has to produce until the end of the day, due to contract\n\nrequirement. For this, when minimizing [PNet ?\n(Econtract?Esum)\n\n?T\n], the\n\n\n\n6.3. Optimization Problems 95\n\nmain controller forces the production of energy at iteration k to ap-\nproach the necessary amount to end the contract requirement, so, by\nthe end of the day, the amount of electric energy supplied to the DNO\nis the one defined by contract. The objective function (6.11) is subject\nto the following constraints:\n\nx ? x?(k + i + 1) ? x (6.12)\n\nu ? u?(k + i) ? u (6.13)\n\ny?(k + i) = Demands(k) (6.14)\n\n0 ? PNet(k) ? ? + ? (6.15)\n\nfor i = 0, . . . , Np ? 1, where ? represents the contract constant power\n(16MW, if maintained at every iteration k, the electric contract would\ncertainly be complied). The notation hat over variables (a?) is used to\ndenote variables over the prediction horizon, a and a? denote minimum\nand maximum allowed values respectively. The matrix QP is adjusted\nso that the electric energy production is prioritized; Qx is used to main-\ntain the system state vector values near a referenced region of 50 % of\nall stocks. The vector qu is used so that the production of energy comes\npreferably from the most efficient and sustainable energy sources and\nso that the use of the battery bank is minimized.\n\nBiomass Mixture Optimizer (Opt?)\n\nThe biomass mixture optimizer was implemented with the follow-\ning objective function:\n\nJOpt? =\n\nNp?1\n?\n\ni=0\n\n???A(k + i) ?0.5?\n2\nQA\n\n+\n\nNp?1\n?\n\ni=0\n\n???B(k + i) ?0.5?\n2\nQB\n\n+ (6.16)\n\nNp?1\n?\n\nl=0\n\n?\n?\n?x?Str(k + i + 1) ? x?\n\nref\nStr\n\n?\n?\n?\n\n2\n\nQStr\n\nsubject to the following constraints:\n\n\n\n96 6. Sugar Cane Industry Case\n\nxStr ? x?Str(k + i + 1) ? xStr (6.17)\n\n? ? ??A(k + i) ? ?A (6.18)\n\n?B ? ??B(k + i) ? ?B (6.19)\n\n0 ? [(1??A)Q\nA\nE + (1??B)Q\n\nB\nE)] ? Strout (6.20)\n\nThe first two terms of this objective function (6.16) represent the\napproach of the blending factors to the optimal factors (0.5 each). The\nthird term of (6.16) is so that the predicted future straw stock follows\na reference of 20 %, if possible. The weighting matrices QA, QB and\nQStr are tuned so that the optimizers main goal is to minimize ?A and\n?B.\n\n6.3.4 Final Control Algorithm\n\nAs seen in figure 6.4, the proposed control structure is composed\nof Opt? and MPCmain, working together. This is easier to grasp by\nthe understanding of algorithm 4. In this algorithm, it can be seen,\nafter the initialization of variables and the assembling of matrices, how\nthe control structure is iterating hourly to: reassemble matrix B (that\nchanges with ?A and ?B); call the main controller MPCmain (based\non the previous iteration model: ?A(k ? 1) and ?B(k ? 1)); compute\nKA,KB,Q\n\nA\nE and Q\n\nB\nE; call the optimizer Opt? to divulge the new blend-\n\ning factors (iteration k); reassemble B (for simulation of microgrid) and\napply decision vector to the microgrid; receive (measures) output and\nstate vectors.\n\n6.3.5 Simulation Results\n\nThe experimental results of the proposed control strategy, ap-\nplied to a simulated model of the studied microgrid, are presented in\nthis section. The control strategy was implemented using the software\nMatlab [74] with Yalmip toolbox[69] and solver CPLEX [58]. The ex-\nperiments described in this section represent the simulation of one day.\nThe microgrid control objectives are to maximize the use of renewable\nenergy sources, ensure the energy production defined by contract and\nensure the load demand at all periods of time. Figure 6.5 shows the\nsystem disturbances. In this simulation scenario the process data was\nextracted from a real power plant from state of Parana? 1.All parameter\n\n1For confidentiality issues the company name is not mentioned.\n\n\n\n6.3. Optimization Problems 97\n\nAlgorithm 4 Final Microgrid Control Algoritm\n\nInput: Ts, z\nOutput: x, y\n{Inicialize: Np, Nc, ?A[0], ?B[0], Potcontract, X,u}\n{Assemble Matrixes: A, B, C, D, E, F}\n{Assemble Matrixes: q?,qu, Qx, QP , QA, QB, QStr}\n\n1: for k = 1 to 24 do\n2: Assemble B with ?A[k ?1] and ?A[k ?1]\n\nPotsum = Potsum + u3[k ?1]\n3: Call: MPCmain[Potsum; X]\n\n{MPCmain returns u[k]}\nKA = lookup(?A[k ?1])\nKB = lookup(?B[k ?1])\n\n4: Compute: QAE and Q\nB\nE\n\n5: Call: Opt?[Q\nA\nE; Q\n\nB\nE; XStr]\n\n{Opt? returns ?A[k] and ?B[k]}\n6: Assemble B with ?A[k] and ?A[k]\n7: Apply u[k] to microgrid\n8: Receive y[k],x[k]\n9: end for\n\nvalues are presented in appendix A.\nFigure 6.6 shows a simulation scenario of the proposed microgrid\n\nand the use of each subsystem: electric power generated by the CHP,\nby the turbines and by the non-dispatchable renewable sources. The\npresence of the CHP and the non-dispatchable renewable sources in the\nproposed system implies reduction on the turbines energy production.\nAs can be seen in figures 6.5 and 6.6 the CHP use depends on the biogas\nincome behavior. The lower efficiency turbine generated around 3MW\nmost part of the day, increasing the production from 18h to 22h when\nthere is an electric demand peak and a reduction in the biogas income.\nThe better efficiency turbine contributed most part of the day with\naround 15MW with an increasing after 21h when a demand peak and\na reduction in the non dispatchable renewable sources occurs. At the\nend of the day the CHP and the non dispatchable renewable sources\ncontributed with 23.27 % (126.37MW) of the total daily production of\n542.97MW (the sum of CHP, both turbines and the non-dispatchaple\nrenewable sources was considered).\n\nOn the other hand, figure 6.7 shows a scenario of the original\nsystem. In this scenario only the turbines generated energy to attending\n\n\n\n98 6. Sugar Cane Industry Case\n\nFigure 6.5: System Disturbances\n\nthe demand and the energy sale contract. In both scenarios it can be\nseen that the generation is enough to comply to the energy contract.\nFigure 6.8 shows that both systems met all system demands.\n\nFigure 6.9 shows the stocks behavior of the proposed system. In\nthis simulation the battery bank acted to mitigate small energy im-\nbalances between the microgrid equipments, staying around 50 %. At\nthe end of the day, from 18h to 22h, when a high energy fluctuation\nhappened as a consequence of the electric demand peak, the battery\nbank presented a SOC variation of 25 % (between 50 % and 75 %) in\norder to absorb the energy generated excess. The biogas stock started\nwith 80 % and decreased until around 50 %, that is the state reference,\nand is directly related with the CHP production. The stock of bagasse\nis maintained continuously loaded, due to the great amount of income,\nas seen in figure 6.6. The straw stock, on the other hand, gradually\ndecreases, due to the biomass mixture optimization, and the smaller\namount of income.\n\nFigure 6.10 shows the optimizer Opt? performance when applied\nto the proposed and system. The optimizer Opt? is able to maximize\nthe gain of the boilers by reducing ?A and ?B to 0.5, whenever possi-\nble. It can be noticed that the optimizer cannot maintain the blending\nfactors at the optimal condition (0.5), because this forces the straw\noutcome flow to be too voluminous and violate the minimum straw\nstock constraint, as shown in figure 6.9. So, the blending factors are\ngradually tending to 1, except the ?B in proposed scenario, that are\nnear 0.5 as the lower efficiency boiler production is very low, due to the\nlow biomass mixture flow QBE.\n\n\n\n6.3. Optimization Problems 99\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n100\n\n200\n\n300\n\n400\n\n500\n\nE\nn\n\ne\nrg\n\ny\n (\n\nM\nW\n\nh\n)\n\nContract Energy Goal (MWh)\nTotal Energy Produced(MWh)\nCHP Energy(MWh)\nTurbines Energy(MWh)\nNon-dispatchable Renewable Energy(MWh)\nDemand(MWh)\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n5\n\n10\n\n15\n\n20\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nBetter Eff. Turbine Power (MW)\n\nLower Eff. Turbine Power (MW)\n\n0 5 10 15 20\n\nTime (h)\n\n-2\n\n0\n\n2\n\n4\n\n6\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nCHP Power(MW)\nBattery Bank Use(MW)\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n1\n\n2\n\n3\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nWind Turbine Power(MW)\nSolar Gen. Power(MW)\n\nFigure 6.6: Electric power generation of the proposed system\n\nThe behavior of the variables involved in steam production are\nshown in figure 6.11. As shown in figure 6.8 both steam demands are\nattended. As the high efficiency boiler presented a high steam produc-\ntion as a consequence of the both turbines energy production, the lower\nefficiency boiler is not widely used, and production was near the mini-\nmum all the time. The middle pressure steam demand is attended by\nthe high-middle pressure reduction valve and the lower efficiency boiler.\nAs this production is greater than the demand, the residual steam is\nconverted to low pressure steam. The low pressure steam demand is\nattended by the production of the lower efficiency turbine and the con-\nverted middle pressure steam. The steam excess is discarded by the\nmiddle and low pressure escape valves.\n\nFigure 6.12 shows the variables involved to attend to the refrig-\neration demands. As can be seen the CHP, the solar water heater and\n\n\n\n100 6. Sugar Cane Industry Case\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n200\n\n400\n\n600\nE\n\nn\ne\n\nrg\ny\n (\n\nM\nW\n\nh\n)\n\nContract Energy Goal (MWh)\nTotal Energy Produced(MWh)\nTurbines Energy(MWh)\nDemand(MWh)\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n5\n\n10\n\n15\n\n20\n\n25\n\nP\no\n\nw\ne\n\nr \n(M\n\nW\n)\n\nBetter Eff. Turbine Power (MW)\nLower Eff. Turbine Power (MW)\n\nFigure 6.7: Electric power generation of the original system\n\n0 5 10 15 20\n\nTime (h)\n\n5000\n\n6000\n\n7000\n\n8000\n\n9000\n\n10000\n\nP\no\nw\n\ne\nr \n\n(k\nW\n\n)\n\nPower Demand\nDemand Reference\n\n0 5 10 15 20\n\nTime (h)\n\n60\n\n80\n\n100\n\n120\n\n140\n\n160\n\n180\n\nS\nte\n\na\nm\n\n F\nlo\n\nw\n (\n\nM\ng\n /\n h\n\n) Middle Pressure Steam Demand\nMiddle Pressure Steam Demand Reference\n\n0 5 10 15 20\n\nTime (h)\n\n100\n\n150\n\n200\n\n250\n\n300\n\nS\nte\n\na\nm\n\n F\nlo\n\nw\n (\n\nM\ng\n /\n h\n\n) Low Pressure Steam Demand\nLow Pressure Steam Demand Reference\n\n0 5 10 15 20\n\nTime (h)\n\n40\n\n60\n\n80\n\n100\n\n120\n\n140\n\n160\n\nC\no\nld\n\n W\na\nte\n\nr \nF\n\nlo\nw\n\n (\nm3\n\n/\nh\n)\n\nCold Water Flow Demand\nCold Water Flow Demand Reference\n\nFigure 6.8: Fulfillment of the Demands\n\nthe heat exchanger are responsible for production. The water chiller is\nresponsible for consuming the hot water and attend the refrigeration\ndemand. The tank escape valve was not used because, as shown in\nfigure 6.9, the hot water tank level does not reach the maximum level.\n\nTable 6.7 evidences the energy gains and approximate economic\nprofit of using the CHP, the photovoltaic panels, and the wind turbine\nin a daily simulation. It was considered the average biogas production\nof 3750?h, from the anaerobic digestion of the vinasse and the Megawatt\naverage price as R$386.66. As expected the gain of the non dispatch-\nable sources depends on the weather condition that changes over the\nyear and presents stochastic behaviors as wind gusts and cloudy days.\nAmong the non dispatchable sources the wind turbine contributes with\n\n\n\n6.3. Optimization Problems 101\n\n0 5 10 15 20\n\nTime (h)\n\n40\n\n60\n\n80\n\nBattery Bank (%)\n\n0 5 10 15 20\n\nTime (h)\n\n20\n\n40\n\n60\n\n80\n\nBagasse Stock (%)\n\nStraw Stock (%)\n\n0 5 10 15 20\n\nTime (h)\n\n40\n\n60\n\n80\n\n100\n\nCompressed Biogas Stock (%)\n\nHot Water Tank (%)\n\nFigure 6.9: Stocks of the proposed system\n\n0 5 10 15 20\n\nTime (h)\n\n0.4\n\n0.6\n\n0.8\n\n1\nAlfa\n\nA\n (-)\n\nAlfa\nB\n\n (-)\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n1000\n\n2000\nQE\n\nA\n (Mg/h)\n\nQE\nB\n\n (Mg/h)\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n1000\n\n2000 Str\nin\n\n - Straw Income Flow (Mg/h)\n\nStr\nout\n\n - Straw Outcome Flow (Mg/h)\n\nFigure 6.10: Blending Factors of the proposed system\n\nmore energy and consequently more economic profit.\nA series of daily simulation scenarios, considering different predic-\n\ntion errors are detailed in table 6.8. It is important to notice that the\ntotal energy generation, in these simulations, has been set within a lim-\nited percentage (5 %) to the reference set-point production of 384MWh\nper day. Analyzing the table data it is possible to see that the predic-\ntion error in the renewable energy sources practically did not affected\nthe total energy generation. This occurs because the turbines and the\nCHP compensated the energy loss.\n\n\n\n102 6. Sugar Cane Industry Case\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n100\n\n200\n\n300\n\nS\nte\n\na\nm\n\n F\nlo\n\nw\n (\n\nM\ng\n\n/h\n)\n\nHigh-middle pressure reduction valve\nMiddle-low pressure reduction valve\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n50\n\n100\n\nS\nte\n\na\nm\n\n F\nlo\n\nw\n (\n\nM\ng\n\n/h\n)\n\nLower Efficiency Boiler\nLower Efficiency Turbine\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n20\n\n40\n\n60\n\nS\nte\n\na\nm\n\n F\nlo\n\nw\n (\n\nM\ng\n\n/h\n)\n\nMiddle pressure steam escape\nLow pressure steam escape\n\nFigure 6.11: Variables involved in steam production (proposed scenario)\n\n0 5 10 15 20\n\nTime (h)\n\n-150\n\n-100\n\n-50\n\n0\n\n50\n\nW\na\n\nte\nr \n\nF\nlo\n\nw\n (\n\nm\n3\n/h\n\n)\n\nWater chiller\nSolar Water Heater\nCHP\n\n0 5 10 15 20\n\nTime (h)\n\n0\n\n50\n\n100\n\n150\n\nW\na\n\nte\nr \n\nF\nlo\n\nw\n (\n\nm\n3\n/h\n\n) Heat exchanger\nEscape tank\n\nFigure 6.12: Variables involved in hot water production (proposed scenario)\n\n6.4 Final Remarks\n\nIn this chapter the study of a hybrid power plant based on a sugar\ncane industry was discussed. First the original process was described\nand after a new structure was proposed in order to increase and diver-\nsify the use of renewable energy and maximize the reuse of the sugar\ncane residues. The proposed system became more complex than the\noriginal and use the renewable sources and residues to attend a multi\ncarrier demands, being electrical, steam in different pressure levels and\ncold water for refrigeration. The energy hubs framework was applied\nto model the system. A two-level hierarchical MPC control structure\nwas proposed to perform the electric energy production optimization,\nmanagement of storage and subsystems and biomass blending opti-\nmization. As showed by the simulation results, the proposed control\n\n\n\n6.4. Final Remarks 103\n\nTable 6.7: Full-Month Simulation Scenario Details\n\nSubsystem Power Gains Economic Gains\n\nCHP 61.39 MWh R$23, 738.00\n\nPhotovoltaic Panels\n\nHigh Insolation 12.36 MWh R$4, 780.00\nMedium Insolation 9.51 MWh R$3, 677.00\nLow Insolation 6.34 MWh R$2, 451.00\n\nWind Turbine\n\nHigh Wind Speed 52.62 MWh R$20, 346.00\nMedium Wind Speed 29.66 MWh R$11, 470.00\nLow Wind Speed 16.61 MWh R$6, 423.00\n\nTable 6.8: Different Daily Simulation Scenarios\n\nError (%) Non-dispatchable Renewable Energy Total Energy Generation\n1% 42.573MWh 395.60MWh\n2% 42.143MWh 395.50MWh\n5% 40.853MWh 395.10MWh\n10% 38.703MWh 395.26MWh\n15% 36.553MWh 395.33MWh\n20% 34.400MWh 394.96MWh\n25% 32.252MWh 394.66MWh\n35% 30.108MWh 394.86MWh\n\nstructure presented satisfactory results. In the chapter 7, conclusions\nabout this thesis and future work are discussed.\n\n\n\n104 6. Sugar Cane Industry Case\n\n\n\nChapter 7\n\nConclusions and Future\nWorks\n\nThis thesis addressed the problem of energy management in mi-\ncrogrids including renewable energy, which is an important research\nsubject and interest of many countries since increasingly seeking of a\nsustainable world. Different MPC based solutions were presented tak-\ning into account the characteristic of the studied systems.\n\nFirst the integration of a V2G system with an experimental mi-\ncrogrid was discussed. A hierarchical control structure was developed\nto perform the energy management including the different equipment\ndynamics and control objectives. The proposed controller got good\nresults under sunny, cloudy and windy weather conditions.\n\nOther theme addressed in this thesis was the problem of con-\ntrolling networked microgrids. For this issue a hybrid distributed MPC\nwas developed. In the proposed approach the MIQP original local prob-\nlem was solved by a binary search algorithm that performs a sequence\nof quadratic programmings and the algorithm distributed nature was\nconsidered to coordinate the solution of the binary variables during the\niteration procedure. The proposed framework showed a good perfor-\nmance in a simulation scenario with different weather conditions and\nin presence of faults.\n\nFinally the Brazilian energy production scenario was explored.\nA sugar cane industry power plant was studied and a new structure\nwas proposed, where non-dispatchable renewable sources and reuse of\nbiomass were included in the plant structure. This power system is\ncomposed by different energy carriers which is a challenge to the con-\n\n\n\n106 7. Conclusions and Future Works\n\ntrol algorithm. The proposed controller had the objective to manage\ndifferent energy sources, meeting the demands and performing the op-\ntimization of bagasse and straw mixture.\n\n7.1 Contributions\n\nThe main contributions of this thesis can be highlighted as follows:\n\n\u2022 The development of a hybrid distributed MPC framework, where\nthe effect of subsystems interaction in the binary variables deci-\nsions is taken into account.\n\n\u2022 The study of the integration of a microgrid with electric vehicles\ncharging stations in a V2G philosophy. The proposed charging\nstation management proved very useful to manage the charge of\nelectric vehicles and their batteries usage as a storage to help on\nthe energy fluctuation mitigation.\n\n\u2022 A MPC strategy was proposed to deal with the switching between\nan electrolyzer and a fuel cell in a microgrid taking into account\nthe switching constraints providing an optimized solution to the\nhydrogen storage management problem.\n\n\u2022 The insertion of a MLD formulation on the MPC objective func-\ntion of the microgrid to manage the energy sell/purchase with\nthe distribution network operator (DNO), which proved to be an\ninteresting solution.\n\n\u2022 The use of the hybrid DMPC as energy management system to\nthe problem of networked microgrids based on renewable energy\nsources appeared as a good solution to perform the economic\nenergy management and guarantee the cooperation between mi-\ncrogrids in different weather and operating conditions.\n\n\u2022 The integration of the sugar cane power plant with non-dispatcha-\nble renewable sources, the use of biogas (generated from vinasse\nfermentation) with the CHP to generate energy and heat and\nthe mix between the bagasse and straw to improve the boilers\ncalorific power proved to be a sustainable solution once perform\nthe maximum use of the energy sources to generate electricity,\nsteam and cold water. The use of energy hubs to model the\nproposed system was very efficient once this methodology allows\nto integrate different energy carriers in the same model.\n\n\n\n7.1. Contributions 107\n\n\u2022 The development of a two-level hierarchical MPC strategy to per-\nform the management of different energy carriers. The proposed\ncontroller presented good results ensuring the electric energy pro-\nduction, managing the use of renewable energies and performing\nthe biomass blending optimization.\n\nAs a result of the study of energy management of renewable energy\nbased microgrids presented in the thesis the following publications were\nproduced:\n\n\u2022 Mendes P. R. C., Normey-Rico J. E., Bordons C.. Economic\nEnergy Management of a Microgrid Including Electric Vehicles.\nInnovative Smart Grid Technologies Latin America, 2015, Mon-\ntevideo - Uruguay.\n\n\u2022 Mendes P. R. C., Normey-Rico J. E., Valverde L., Bordons C..\nGestio?n Energe?tica de una Micro Red acoplada a un sistema V2G.\nXXXVI Jornadas de Automa?tica, 2015, Bilbao - Spain.\n\n\u2022 Mendes P. R. C., Maestre J. M., Normey-Rico J. E., Bordons\nC.. Binary Search Algorithm for Mixed Integer Optimization:\nApplication to energy management in a microgrid. European\nControl Conference, 2016, Alborg - Denmark.\n\n\u2022 Mendes P. R. C., Valverde L., Bordons C., Normey-Rico J. E..\nEnergy Management of an Experimental Microgrid coupled to a\nV2G system. Journal of Power Sources.\n\n\u2022 Mendes P. R. C., Bordons C., Normey-Rico J. E.. Distributed\nMPC for Energy Management of V2G Networked Microgrids.\nIEEE Transactions on Sustainable Energy. (under review)\n\n\u2022 Mendes P. R. C., Maestre J. M., Bordons C., Normey-Rico J.\nE.. Hybrid Distributed MPC. Journal of Process Control. (under\nreview)\n\n\u2022 Morato M. M., Mendes P. R. C., Bertol D. W., Cembranel D.,\nBordons C., Normey-Rico J. E.. Estudo de uma Planta H??brida de\nGerac?a?o de Energia na Indu?stria da Cana-de-ac?u?car. Congresso\nBrasileiro de Automa?tica, 2016, Vito?ria - Brazil.\n\n\u2022 Morato M. M., Mendes P. R. C., Bertol D. W., Cembranel D.,\nBordons C., Normey-Rico J. E.. Efficient Hybrid Generation\nPower Plants in the Sugar Cane Industry. Renewable Energy.\n(under review)\n\n\n\n108 7. Conclusions and Future Works\n\n\u2022 Morato M. M., Mendes P. R. C., Normey-Rico J. E. , Bordons C..\nOptimal Operation of Hybrid Power Systems Including Renew-\nable Sources in the Sugar Cane Industry. IET Renewable Power\nGeneration.\n\nDuring the period of Ph.D. studies about subspace predictive con-\ntrol were carried out and the following works were published:\n\n\u2022 Mendes P. R. C., Normey-Rico J. E., Joa?o V. Jr.. A Bilinear FSP-\nSPC in a Solar Desalination Plant Collector Field. International\nRenewable Energy Congress (IREC), 2014, Hammamet - Tunisia;\n\n\u2022 Mendes P. R. C., Normey-Rico J. E., Joa?o V. Jr., Cruz D. M..\nA Filtered Smith predictor based subspace predictive controller.\n19th World Congress of the International Federation of Automatic\nControl, Cape Town, South Africa.\n\n7.2 Future Work\n\nThe energy management of microgrids is an interesting and open\nresearch area involving different fields of knowledge. With respect to\nthe solutions presented in this thesis remarkable future research topics\nare:\n\n\u2022 The investigation of methods to accelerate the convergence of the\nproposed hybrid DMPC is an important issue thinking in the\napplication in a greater networked microgrids scenario.\n\n\u2022 The comparison of the proposed hybrid DMPC with other dis-\ntributed MPC algorithms.\n\n\u2022 The investigation of the effect of weather prediction errors in the\nHybrid DMPC and integration with robust and stochastic strate-\ngies to deal with this matter.\n\n\u2022 The investigation of the energy management of charging stations\nwith renewable energy sources and their impact in the charge\nelectricity price taken into account the Brazilian market.\n\n\u2022 The study of integrate many sugar cane power plants of the same\ncompany to cooperate each other and attend a multi objective\ncontract. In many cases one company is the owner of many sugar\ncane processing plants and it is expected that with this integration\n\n\n\n7.2. Future Work 109\n\nit is possible to attend a given contract by the overall company\ninstead of isolated contracts for each power plant. This way the\namount of energy sold to DNO as well as the economic gains tend\nto increase.\n\n\n\n110 7. Conclusions and Future Works\n\n\n\nAppendix A\n\nSimulation Parameters\n\nA.1 Laboratory Microgrid Control\n\nMPC1 - Model\n?B = 1.08\u00d710\n\n?5\n\n?FCH2,e = 8.55\u00d710\n?6\n\n?Ee,H2 = 2.97\u00d710\n?6\n\n?Bev1 = 2.3\u00d710\n?3\n\n?Bev2 = 2.3\u00d710\n?3\n\n?Bev3 = 2.3\u00d710\n?3\n\n?Bev4 = 2.3\u00d710\n?3\n\nMPC1 - Tuning Parameters\n\nNp1 = 5 Nc1 = 2 Qu1 = diag\n\n?\n\n?\n\n?\n\n?\n\n0 3 1 2 0\n\n0 0 0 0 2\n\n?\n\n?\n\n?\n\n?\n\nQx1 = diag\n([\n\n5\u00d7108 1 0 0 0 0\n])\n\nQ?u1 = diag(\n\n?\n\n?\n\n0 0 0 1 0\n\n0 0 0 100 1\n\n?\n\n?\n\nQTarget1 =diag\n\n?\n\n?\n\n?\n\n?\n\n0 100 60 1000 100\n\n10000 100 10000 0 0\n\n?\n\n?\n\n?\n\n?\n\nQ??1 = 100\n\nMPC1 - Constraints\nx1 = diag\n\n([\n\n20 20 0 0 0 0\n])\n\nx1 = diag\n([\n\n95 95 100 100 100 100\n])\n\n\n\n112 A. Simulation Parameters\n\nu1 = diag\n\n?\n\n?\n\n?\n\n?\n\n0 ?1600 ?900 ?900 ?100\n\n?100 ?100 ?100 0 0\n\n?\n\n?\n\n?\n\n?\n\nu1 = diag\n\n?\n\n?\n\n?\n\n?\n\n4650 6000 900 900 100\n\n100 100 100 1 900\n\n?\n\n?\n\n?\n\n?\n\nMPC2 - Model\n?B = 1.1\u00d710\n\n?3\n\n?FCH2,e = 0.85\u00d710\n?3\n\n?Ee,H2 = 0.3\u00d710\n?3\n\n?Bev1 = 2.31\u00d710\n?1\n\n?Bev2 = 2.31\u00d710\n?1\n\n?Bev3 = 2.31\u00d710\n?1\n\n?Bev4 = 2.31\u00d710\n?1\n\nMPC2 - Tuning Parameters\n\nNp2 = 12 Nc2 = 5 Qu2 = diag\n\n?\n\n?\n\n?\n\n?\n\n1\u00d7109 0 0 0 0 0\n\n0 0 0 0 0 0\n\n?\n\n?\n\n?\n\n?\n\nQx2 = diag\n([\n\n10 1 0 0 0 0\n])\n\nQ?u2 = diag\n\n?\n\n?\n\n?\n\n?\n\n0 0 0 0 10 10\n\n10 10 0 0 0 0\n\n?\n\n?\n\n?\n\n?\n\nQTarget2 = diag\n\n?\n\n?\n\n?\n\n?\n\n1\u00d7109 0 0 0 0 0\n\n0 0 0 0 0 0\n\n?\n\n?\n\n?\n\n?\n\nQ??2 = 100\n\nMPC2 - Constraints\nx2 = diag\n\n([\n\n20 20 0 0 0 0\n])\n\nx2 = diag\n([\n\n95 95 100 100 100 100\n])\n\nu2 = diag\n\n?\n\n?\n\n?\n\n?\n\n0 ?1600 ?900 ?900 ?100 ?100\n\n?100 ?100 0 0 0 0\n\n?\n\n?\n\n?\n\n?\n\nu2 = diag\n\n?\n\n?\n\n?\n\n?\n\n4650 6000 900 900 100 100\n\n100 100 1 1 6000 900\n\n?\n\n?\n\n?\n\n?\n\n\n\nA.2. Networked Microgrids 113\n\nA.2 Networked Microgrids\n\nTuning Parameters\n\nNp = 6 Nc = 2 Q1,2,3,4 = diag\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nqsale 1 0 0 0\n\n0 0 0 0 0\n\n0 0 0 0 0\n\n0 0 0 0 0\n\n0 0 0 0 0\n\n0 0 qpurchase?qsale 1 0\n\n0 0 0 0 0\n\n0 0 0 0 0\n\n0 0\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nQx1,2,3,4 = diag\n\n?\n\n?\n\n?\n\n?\n\n0.1 0 0 0 0\n\n0 0 0 0 0\n\n?\n\n?\n\n?\n\n?\n\nConstraints\n\nx1,2,3,4 = diag\n\n?\n\n?\n\n?\n\n?\n\n20 0 0 0 0\n\n0 0 0 0 0\n\n?\n\n?\n\n?\n\n?\n\nx1,2,3,4 = diag\n\n?\n\n?\n\n?\n\n?\n\n95 100 100 100 100\n\n100 100 100 100 100\n\n?\n\n?\n\n?\n\n?\n\nu1,2,3,4 = diag\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?50 ?1 ?0.06 ?0.06 ?0.06\n\n?0.06 ?0.06 ?0.06 ?0.06 ?0.06\n\n?0.06 ?0.06 0 0 0\n\n0 0 0 0 0\n\n0 0 0 0 0\n\n0 0 0 1 0\n\n0 0 0 0 0\n\n0 0 0 0 0\n\n0 0\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nu1,2,3,4 = diag\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n50 1 0.06 0.06 0.06\n\n0.06 0.06 0.06 0.06 0.06\n\n0.06 0.06 10 10 10\n\n1 1 1 1 1\n\n1 1 1 1 1\n\n1 1 50 1 0.06\n\n0.06 0.06 0.06 0.06 0.06\n\n0.06 0.06 0.06 0.06 10\n\n10 10\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n\n\n114 A. Simulation Parameters\n\nA.3 Sugar Cane Industry Case\n\nTuning Parameters\n\nNp = 12 Nc = 5 qu =\n\n?\n\n?\n\n?\n\n?\n\n0.3 0.6 0 10 0.4 5 5\n\n0.01 0 10\n\n0.5 0.35 2\u00d7106\n\n?\n\n?\n\n?\n\n?\n\nQx = diag\n([\n\n0.3 0 0 0 0\n])\n\nq? = 1\u00d710\n3\n\nQP = 0.5\n\nConstraints\nx = diag\n\n([\n\n10 10 10 10 10\n])\n\nx = diag\n([\n\n100 100 100 100 100\n])\n\nu = diag\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n11\u00d7103 3\u00d7103 0 0 0\n\n0 0 800 0 0\n\n?3\u00d7103 0 0\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\nu = diag\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n27\u00d7103 2\u00d7104 0 1\u00d7107 0\n\n0 0 8\u00d7103 0 0\n\n3\u00d7103 0 0\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n?\n\n\n\nBibliography\n\n[1] I. Alvarado, D. Limon, D. Mun?oz de la Pen?a, J.M. Maestre, M.A.\nRidao, H. Scheu, W. Marquardt, R.R. Negenborn, B. De Schut-\nter, F. Valencia, and J. Espinosa. A comparative analysis of dis-\ntributed mpc techniques applied to the hd-mpc four-tank bench-\nmark. Journal of Process Control, 21(5):800 \u2013 815, 2011. doi:\n10.1016/j.jprocont.2011.03.003. Special Issue on Hierarchical and\nDistributed Model Predictive Control.\n\n[2] J. M. Alves. Paradigma te?cnico e co-gerac?a?o de energia com\nbagac?o de cana de ac?u?car em goia?s / technical paradigm and\nenergy cogeneration from sugarcane bagasse in goia?s. Proceedings\nof the 6. Encontro de Energia no Meio Rural, 2006.\n\n[3] D. Anderson and M. Leach. Harvesting and redistributing renew-\nable energy: on the role of gas and electricity grids to overcome\nintermittency through the generation and storage of hydrogen.\nEnergy Policy, 32(14):1603 \u2013 1614, 2004. doi: 10.1016/S0301-\n4215(03)00131-9.\n\n[4] M. Arnold, R. R. Negenborn, G. Andersson, and B. De Schutter.\nModel-based predictive control applied to multi-carrier energy\nsystems. In Power Energy Society General Meeting, 2009. PES\n\u201909. IEEE, pages 1\u20138, 2009. doi: 10.1109/PES.2009.5275230.\n\n[5] S. Bashash and H. Fathy. Robust demand-side plug-in electric\nvehicle load control for renewable energy management. Amer-\nican Control Conference (ACC), pages 929\u2013934, 2011. doi:\n10.1016/S0005-1098(98)00178-2.\n\n[6] J. Batut and A. Renaud. Daily generation scheduling optimiza-\ntion with transmission constraints: a new class of algorithms.\nIEEE Transactions on Power Systems, 7:982 \u2013 989, 1992.\n\n\n\n116 BIBLIOGRAPHY\n\n[7] A. Bemporad and M. Morari. Control of systems integrating logic,\ndynamics, and constraints. Automatica, 35(3):407\u2013427, 1999. doi:\n10.1016/S0005-1098(98)00178-2.\n\n[8] D. P. Bertsekas. Constrained Optimization and Lagrange Multi-\nplier Methods. Athena Scientific, 1996.\n\n[9] D. P. Bertsekas and J. N. Tsitsiklis. Distributed Computation:\nNumerical Methods. Athena Scientific, New Hampshire, 1997.\n\n[10] A. Bidram and A. Davoudi. Hierarchical structure of microgrids\ncontrol system. IEEE Transactions on Smart Grid, 3(4):1963\u2013\n1976, 2012. doi: 10.1109/TSG.2012.2197425.\n\n[11] A. M. Borbely and J. F. Kreid. Distributed Generation: The\nPower Paradigm for the New Millennium. CRC Press, Boca Ra-\nton, 2001.\n\n[12] C. Bordons, F. Garcia-Torres, and L. Valverde. Optimal energy\nmanagement for renewable energy microgrids. Revista Iberoamer-\nicana de Automatica e Informatica industrial, 12(2):117\u2013132,\n2015. doi: 10.1016/j.riai.2015.03.001.\n\n[13] R. Bourdais and H. Gue?guen. Distributed predictive control\nfor complex hybrid system. the refrigeration system example.\nLarge Scale Complex Systems Theory and Applications, 9:388\u2013\n394, 2010. doi: 10.3182/20100712-3-FR-2020.00065.\n\n[14] Allal M. Bouzid, Josep M. Guerrero, Ahmed Cheriti, Mohamed\nBouhamida, Pierre Sicard, and Mustapha Benghanem. A survey\non control of electric power distributed generation systems for mi-\ncrogrid applications. Renewable and Sustainable Energy Reviews,\n44:751 \u2013 766, 2015. doi: 10.1016/j.rser.2015.01.016.\n\n[15] M. C. Bozchalui, S. A. Hashmi, H. Hassen, C. A. Can?izares, and\nK. Bhattacharya. Optimal operation of residential energy hubs in\nsmart grids. Smart Grid, IEEE Transactions on, 3(4):1755\u20131766,\n2012.\n\n[16] K. De Brabandere, K. Vanthournout, J. Driesen, G. Deconinck,\nand R. Belmans. Control of microgrids. In Power Engineer-\ning Society General Meeting, 2007. IEEE, pages 1\u20137, 2007. doi:\n10.1109/PES.2007.386042.\n\n\n\nBIBLIOGRAPHY 117\n\n[17] E. Camacho and C. Bordons. Model Predictive Control. Springer,\nLondon, 2007.\n\n[18] E. Camponogara, D. Jia, B. H. Krogh, and S. Talukdar. Dis-\ntributed model predictive control. IEEE Control Systems, 22(1):\n44\u201352, 2002. doi: 10.1109/37.980246.\n\n[19] S. Chakraborty, M. D. Weiss, and M. G. Simoes. Distributed\nintelligent energy management system for a single-phase high-\nfrequency ac microgrid. IEEE Transactions on Industrial Elec-\ntronics, 54(1):97\u2013109, 2007. doi: 10.1109/TIE.2006.888766.\n\n[20] P. D. Christofides, R. Scattolini, D. M. de la Pen?a, and\nJ. Liu. Distributed model predictive control: A tu-\ntorial review and future research directions. Comput-\ners &amp; Chemical Engineering, 51:21 \u2013 41, 2013. doi:\nhttp://dx.doi.org/10.1016/j.compchemeng.2012.05.011.\n\n[21] S. Cristea, C. de Prada, D. Sarabia, and G. Gutie?rrez. Aera-\ntion control of a wastewater treatment plant using hybrid nmpc.\nComputers &amp; Chemical Engineering, 35(4):638 \u2013 650, 2011. doi:\nhttp://dx.doi.org/10.1016/j.compchemeng.2010.07.021.\n\n[22] D. N. Dantas. Uso da biomassa de cana-de-ac?u?car para gerac?a?o\nde energia ele?trica: ana?lise energe?tica, exerge?tica e ambiental de\nsistemas de cogerac?a?o em sucroalcooleiras do interior paulista /\nUse of biomass sugarcane to generate electricity: energy analysis,\nexergetic and environmental cogeneration systems in sugarcane in\nSa?o Paulo State. PhD thesis, Universidade de Sa?o Paulo, 2010.\n\n[23] Ministe?rio de Minas e Energia. Redes ele?tricas inteligentes: con-\ntexto nacional / smart grids: national context. Technical report,\nMiniste?rio de Minas e Energia, 2012.\n\n[24] Ministe?rio de Minas e Energia. Plano decenal de expansa?o de\nenergia 2024. Technical report, Ministe?rio de Minas e Energia,\n2014.\n\n[25] Ministe?rio de Minas e Energia. Redes ele?tricas inteligentes dia?logo\nsetorial brasil-unia?o europeia (2014)\u00b4/ smart grids dialogue sector\nbrazil-european union (2014). Technical report, Ministe?rio de\nMinas e Energia, 2014.\n\n\n\n118 BIBLIOGRAPHY\n\n[26] Ministe?rio de Minas e Energia. Resenha energe?tica brasileira:\nExerc??cio de 2014 / brazilian energy review: Year 2014. Technical\nreport, Ministe?rio de Minas e Energia, 2015.\n\n[27] C. de Prada, I. Grossmann, D. Sarabia, and S. Cristea. A\nstrategy for predictive control of a mixed continuous batch pro-\ncess. Journal of Process Control, 19(1):123 \u2013 137, 2009. doi:\nhttp://dx.doi.org/10.1016/j.jprocont.2008.01.004.\n\n[28] S. Deilami, A. S. Masoum, P. S. Moses, and M. Masoum.\nReal-time coordination of plug-in electric vehicle charging in\nsmart grids to minimize power losses and improve voltage pro-\nfile. IEEE Trans. on Smart Grid, 2(3):456\u2013467, 2011. doi:\n10.1109/TSG.2011.2159816.\n\n[29] A. J. del Real. An Integrated Framework for Distributed Model\nPredictive Control of Large Scale Networks - Applications to\nPower Networks. PhD thesis, Universidad de Sevilla, 2011.\n\n[30] A. J. del Real, A. Arce, and C. Bordons. Hybrid model predictive\ncontrol of a two-generator power plant integrating photovoltaic\npanels and fuel cell. IEEE Conference on Decision and Control,\npages 5447\u20135452, 2007. doi: 10.1109/CDC.2007.4434550.\n\n[31] A. J. del Real, M. D. Galus, C. Bordons, and G. Andersson. Op-\ntimal power dispatch of energy networks including external power\nexchange. European Control Conference (ECC), pages 3616\u20133621,\n2009.\n\n[32] A. J. del Real, A. Arce, and C. Bordons. An integrated frame-\nwork for distributed model predictive control of large-scale power\nnetworks. IEEE Transactions on Industrial Informatics, 10(1):\n197\u2013209, 2014. doi: 10.1109/TII.2013.2273877.\n\n[33] R. Dell and D. Rand. Energy storage: a key technology for global\nenergy sustainability. Journal of Power Sources, 100(1):2\u201317,\n2001. doi: 10.1016/S0378-7753(01)00894-1.\n\n[34] W.B. Dunbar and R.M. Murray. Model predictive control of co-\nordinated multi-vehicle formations. Proceedings of the 41st IEEE\nConference on Decision and Control, pages 4631 \u2013 4636, 2002.\n\n[35] F. Ekardt and H. Von Bredow. Extended emissions trading ver-\nsus sustainability criteria: Managing the ecological and social\n\n\n\nBIBLIOGRAPHY 119\n\nambivalences of bioenergy. Renewable Energy L. &amp; Pol\u2019y Rev.,\npage 49, 2012.\n\n[36] Z. Fan. A distributed demand response algorithm and\nits application to phev charging in smart grids. IEEE\nTransactions on Smart Grid, 3(3):1280\u20131290, 2012. doi:\n10.1109/TSG.2012.2185075.\n\n[37] M. Fathi and H. Bevrani. Adaptive energy consumption schedul-\ning for connected microgrids under demand uncertainty. IEEE\nTransactions on Power Delivery, 28(3):1576\u20131583, 2013. doi:\n10.1109/TPWRD.2013.2257877.\n\n[38] G. Ferrari-Trecate, E. Gallestey, P. Letizia, M. Spedicato,\nM. Morari, and M. Antonine. Modeling and control of co-\ngeneration power plants: a hybrid system approach. IEEE Trans-\nactions on Control Systems Technology, 12(5):694\u2013705, 2004. doi:\n10.1109/TCST.2004.826958.\n\n[39] M. V. A. Costa Filho. Modelagem, controle e otimizac?a?o de pro-\ncessos da indu?stria do etanol / Modeling, control and optimization\nof processes in the ethanol industry. PhD thesis, Universidade\nFederal de Santa Catarina, 2013.\n\n[40] J. R. D. Frejo. Model Predictive Control for Freeway Traffic Net-\nworks. PhD thesis, University of Seville, 2015.\n\n[41] Q. Fu, A. Hamidi, A. Nasiri, V. Bhavaraju, S. B. Krstic,\nand P. Theisen. The role of energy storage in a microgrid\nconcept: Examining the opportunities and promise of micro-\ngrids. IEEE Electrification Magazine, 1(2):21\u201329, 2013. doi:\n10.1109/MELE.2013.2294736.\n\n[42] M. D. Galus and G. Andersson. Power system considerations\nof plug-in hybrid electric vehicles based on a multi energy carrier\nmodel. In Power Energy Society General Meeting, 2009. PES \u201909.\nIEEE, pages 1\u20138, July 2009. doi: 10.1109/PES.2009.5275574.\n\n[43] M. D. Galus and G. A. Simon Art. A hierarchical, distributed\npev charging control in low voltage distribution grids to ensure\nnetwork security. Power and Energy Society General Meeting,\n2012 IEEE, pages 1\u20138, 2012. doi: 10.1109/PESGM.2012.6345024.\n\n[44] M. D. Galus, R. La Fauci, and G. Andersson. Investigating phev\nwind balancing capabilities using heuristics and model predictive\n\n\n\n120 BIBLIOGRAPHY\n\ncontrol. Power and Energy Society General Meeting, 2010 IEEE,\npages 1\u20138, 2010. doi: 10.1109/PES.2010.5589267.\n\n[45] F. Garcia-Torres and C. Bordons. Optimal economical sched-\nule of hydrogen-based microgrids with hybrid storage using\nmodel predictive control. Industrial Electronics, IEEE Trans-\nactions on, 62(8):5195\u20135207, Aug 2015. ISSN 0278-0046. doi:\n10.1109/TIE.2015.2412524.\n\n[46] F. Garcia-Torres, L. Valverde, and C. Bordons. Optimal load\nsharing of hydrogen-based microgrids with hybrid storage using\nmodel predictive control. IEEE Transactions on Industrial Elec-\ntronics, PP(99):1\u20131, 2016. doi: 10.1109/TIE.2016.2547870.\n\n[47] M. Gautschi, O. Scheuss, and C. Schluchter. Simulation of\nan agent based vehicle-to-grid (v2g) implementation. Elec-\ntric Power Systems Research, 120:177 \u2013 183, 2009. doi:\nhttp://dx.doi.org/10.1016/j.epsr.2014.05.016.\n\n[48] M. Geidl. Integrated Modeling and Optimization of Multi-Carrier\nEnergy Systems. PhD thesis, ETH, Zurich, 2007.\n\n[49] M. Geidl, G. Koeppel, P. Favre-Perrod, B. Klockl, G. Andersson,\nand K. Frohlich. Energy hubs for the future. EEE Power and\nEnergy Magazine, 2007.\n\n[50] D. Georges. Decentralized adaptive control for a water distribu-\ntion system. 3rd IEEE Conference on Control Applications, pages\n1411 \u2013 1416, 1999.\n\n[51] D. Giaouris, A. I. Papadopoulos, C. Ziogou, D. Ipsakis, S. Voute-\ntakis, S. Papadopoulou, P. Seferlis, F. Stergiopoulos, and C. El-\nmasides. Performance investigation of a hybrid renewable\npower generation and storage system using systemic power\nmanagement models. Energy, 61:621 \u2013 635, 2013. doi:\nhttp://dx.doi.org/10.1016/j.energy.2013.09.016.\n\n[52] A. Di Giorgio, F. Liberati, and S. Canale. Electric vehicle\ncharging control in smartgrids: A model predictive control ap-\nproach. Control Engineering Practice, 22:147\u2013162, 2014. doi:\nhttp://dx.doi.org/10.1016/j.conengprac.2013.10.005.\n\n[53] J. R. P. Gonzalez. Libro Blanco de la Automatizacio?n y Con-\ntrol en la Industria de la Can?a de Azu?car, volume 1. Pro-\ngrama Iberoamericano de Ciencia y Tecnologia para el Desarrollo\n(CYTED), 2011.\n\n\n\nBIBLIOGRAPHY 121\n\n[54] W. Greenwell and A. Vahidi. Predictive control of voltage\nand current in a fuel cell-ultracapacitor hybrid. IEEE Trans-\nactions on Industrial Electronics, 57(6):1954\u20131963, 2010. doi:\n10.1109/TIE.2009.2031663.\n\n[55] W. Gu, Z. Wu, and X. Yuan. Microgrid economic optimal op-\neration of the combined heat and power system with renewable\nenergy. IEEE Power and Energy Society General Meeting, pages\n1\u20136, 2010. doi: 10.1109/PES.2010.5590140.\n\n[56] M. Heidarinejad, J. Liu, and P. D. Christofides. Distributed\nmodel predictive control of switched nonlinear systems with\nscheduled mode transitions. AIChE Journal, 59(3):860\u2013871, 2013.\ndoi: 10.1002/aic.14003.\n\n[57] M. Hestenes. Multiplier and gradient methods. Journal of Opti-\nmization Theory and Applications, 4:303 \u2013 320, 1969.\n\n[58] IBM ILOG. Cplex. 2007.\n\n[59] D. Ipsakis, S. Voutetakis, P. Seferlis, F. Stergiopoulos, S. Pa-\npadopoulou, and C. Elmasides. The effect of the hystere-\nsis band on power management strategies in a stand-alone\npower system. Energy, 33(10):1537 \u2013 1550, 2008. doi:\nhttp://dx.doi.org/10.1016/j.energy.2008.07.012.\n\n[60] D. Jia and B.H. Krogh. Distributed model predictive control.\nAmerican Control Conference, pages 2767 \u2013 2772, 2001.\n\n[61] D. Jia and B.H. Krogh. Min-max feedback model predictive con-\ntrol for distributed control with communication. American Con-\ntrol Conference, pages 4507 \u2013 4512, 2002.\n\n[62] H. Jiayi, J. Chuanwen, and X. Rongi. A review on dis-\ntributed energy resources and microgrid. Renewable and\nSustainable Energy Reviews, 12(9):2472 \u2013 2483, 2008. doi:\nhttp://dx.doi.org/10.1016/j.rser.2007.06.004.\n\n[63] T. B. Johansson. Renewable energy: sources for fuels and elec-\ntricity. Island press, 1993.\n\n[64] R. A. Roma?o Junior. Ana?lise da viabilidade do aproveitamento\nda palha da cana de ac?u?car para cogerac?a?o de energia numa usina\nsucroalcooleira / feasibility analysis of the use of straw of sugar\ncane for energy cogeneration in sugar and alcohol plant. Master\u2019s\nthesis, Universidade Estadual Paulista, 2009.\n\n\n\n122 BIBLIOGRAPHY\n\n[65] T. Keviczky, F. Borrelli, and G. J. Balas. A study on decentral-\nized receding horizon control for decoupled systems. American\nControl Conference, 6:4921 \u2013 4926, 2004.\n\n[66] B. Kim and R. Baldick. Coarse-grained distributed optimal power\nflow. IEEE Transactions on Power Systems, 12:932 \u2013 939, 1997.\n\n[67] T. Knudsen, K. Trangbk, and C. Kallese. Plug and play pro-\ncess control applied to a district heating system. IFAC World\nCongress, 2008.\n\n[68] R. H. Lasseter. Microgrids. IEEE Power Engineer-\ning Society Winter Meeting, 1:305\u2013308, 2002. doi:\n10.1109/PESW.2002.985003.\n\n[69] J. Lofberg. Yalmip: A toolbox for modeling and optimiza-\ntion in matlab. IEEE International Symposium on Computer\nAided Control Systems Design, pages 284\u2013289, 2004. doi:\n10.1109/CACSD.2004.1393890.\n\n[70] J.A. Pec?as Lopes, N. Hatziargyriou, J. Mutale, P. Djapic, and\nN. Jenkins. Integrating distributed generation into electric power\nsystems: A review of drivers, challenges and opportunities. Elec-\ntric Power Systems Research, 77(9):1189 \u2013 1203, 2007. doi:\nhttp://dx.doi.org/10.1016/j.epsr.2006.08.016.\n\n[71] J. M. Maestre and R. R. Negenborn. Distributed Model Predictive\nControl Made Easy. Springer-Verlag, London, 2014.\n\n[72] J. M. Maestre, M. A. Ridao, A. Kozma, C. Savorgnan, M. Diehl,\nM. D. Doan, A. Sadowska, T. Keviczky, B. De Schutter, H. Scheu,\nW. Marquardt, F. Valencia, and J. Espinosa. A comparison\nof distributed mpc schemes on a hydro-power plant benchmark.\nOptimal Control Applications and Methods, 36(3):306\u2013332, 2015.\nISSN 1099-1514. doi: 10.1002/oca.2154.\n\n[73] G. S. C. Magalha?es. Comercializac?a?o de energia ele?trica no ambi-\nente de contratac?a?o livre: Uma ana?lise regulato?rio-institucional a\npartir dos contratos de compra e venda de energia ele?trica / Elec-\ntricity trading in the free market: a regulatory and institutional\nanalysis from the purchase and sale of electricity. PhD thesis,\nUniversidade de Sa?o Paulo, 2009.\n\n[74] Mathworks. Matlab. 2009.\n\n\n\nBIBLIOGRAPHY 123\n\n[75] P.R.C. Mendes, J. E. Normey-Rico, and C. Bordons. Economic\nenergy management of a microgrid including electric vehicles.\nInnovative Smart Grid Technologies Latin America ISGT-LA,\npages 869\u2013874, 2015. doi: 10.1109/ISGT-LA.2015.7381269.\n\n[76] H. Morais, P. Ka?da?r, P. Faria, Z. A. Vale, and H.M.\nKhodr. Optimal scheduling of a renewable micro-grid in\nan isolated load area using mixed-integer linear program-\nming. Renewable Energy, 35(1):151 \u2013 156, 2010. doi:\nhttp://dx.doi.org/10.1016/j.renene.2009.02.031.\n\n[77] N. Nikmehr and S. N. Ravadanegh. Reliability evaluation of\nmulti-microgrids considering optimal operation of small scale en-\nergy zones under load-generation uncertainties. International\nJournal of Electrical Power &amp; Energy Systems, 78:80\u201387, 2016.\ndoi: doi:10.1016/j.ijepes.2015.11.094.\n\n[78] R. R. Negenborn. Multi-Agent Model Predictive Control with Ap-\nplications to Power Networks. PhD thesis, Delft University of\nTechnology, 2007.\n\n[79] R. R. Negenborn and J. M. Maestre. Distributed model pre-\ndictive control: An overview and roadmap of future research\nopportunities. IEEE Control Systems, 34(4):87\u201397, 2014. doi:\n10.1109/MCS.2014.2320397.\n\n[80] R. R. Negenborn, B. De Schutter, and J. Hellendoorn. Multi-\nagent model predictive control: A survey. Technical Report, Delft\nCenter for Systems and Control, 2004.\n\n[81] R. R. Negenborn, B. De Schutter, and J. Hellendoorn. Multi-\nagent model predictive control of transportation networks. IEEE\nInternational Conference on Networking, Sensing and Control,\n2006.\n\n[82] R. R. Negenborn, M. Houwing, B. De Schutter, and J. Hellen-\ndoorn. Model predictive control for residential energy resources\nusing a mixed-logical dynamic model. International Conference\non Networking, Sensing and Control, pages 702\u2013707, 2009. doi:\n10.1109/ICNSC.2009.4919363.\n\n[83] N. Nikmehr and S. N. Ravadanegh. Optimal power dis-\npatch of multi-microgrids at future smart distribution grids.\nIEEE Transactions on Smart Grid, 6(4):1648\u20131657, 2015. doi:\n10.1109/TSG.2015.2396992.\n\n\n\n124 BIBLIOGRAPHY\n\n[84] J. E. Normey-Rico and E. F. Camacho. Control of Dead-Time\nProcesses. Springer, Berlin, 2007.\n\n[85] H.S.V.S.K. Nunna and S. Doolla. Demand response in\nsmart distribution system with multiple microgrids. IEEE\nTransactions on Smart Grid, 3(4):1641\u20131649, 2012. doi:\n10.1109/TSG.2012.2208658.\n\n[86] D. E. Olivares, A. Mehrizi-Sani, A. H. Etemadi, C. A. Canizares,\nR. Iravani, M. Kazerani, A. H. Hajimiragha, O. Gomis-\nBellmunt, A. Saeedifard, R. Palma-Behnke, G. A. Jimenez-\nEstevez, and N. D. Hatziargyriou. Trends in microgrid control.\nIEEE Transactions on Smart Grid, 5(4):1905\u20131919, 2014. doi:\n10.1109/TSG.2013.2295514.\n\n[87] A. Ouammi, H. Dagdougui, L. Dessaint, and R. Sacile. Coordi-\nnated model predictive-based power flows control in a cooperative\nnetwork of smart microgrids. IEEE Transactions on Smart Grid,\n6(5):2233\u20132244, 2015. doi: 10.1109/TSG.2015.2396294.\n\n[88] A. Ouammi, H. Dagdougui, and R. Sacile. Optimal control\nof power flows and energy local storages in a network of mi-\ncrogrids modeled as a system of systems. IEEE Transac-\ntions on Control Systems Technology, 23(1):128\u2013138, 2015. doi:\n10.1109/TCST.2014.2314474.\n\n[89] O. Palizban and K. Kauhaniemi. Hierarchical control\nstructure in microgrids with distributed generation: Is-\nland and grid-connected mode. Renewable and Sus-\ntainable Energy Reviews, 44:797 \u2013 813, 2015. doi:\nhttp://dx.doi.org/10.1016/j.rser.2015.01.008.\n\n[90] O. Palizban, K. Kauhaniemi, and J. M. Guerrero. Microgrids in\nactive network management part i: Hierarchical control, energy\nstorage, virtual power plants, and market participation. Renew-\nable and Sustainable Energy Reviews, 36:428 \u2013 439, 2014. doi:\nhttp://dx.doi.org/10.1016/j.rser.2014.01.016.\n\n[91] A. Parisio and L. Glielmo. A mixed integer linear formulation\nfor microgrid economic scheduling. In Smart Grid Communica-\ntions (SmartGridComm), 2011 IEEE International Conference\non, pages 505\u2013510. IEEE, 2011.\n\n\n\nBIBLIOGRAPHY 125\n\n[92] A. Parisio, E. Rikos, and L. Glielmo. A model predictive control\napproach to microgrid operation optimization. Control Systems\nTechnology, IEEE Transactions on, 22(5):1813\u20131827, 2014. doi:\n10.1109/TCST.2013.2295737.\n\n[93] M. Petrollese. Optimal Generation Scheduling for Renewable Mi-\ncrogrids Using Hydrogen Storage Systems. PhD thesis, University\nof Cagliari, 2015.\n\n[94] M. Powell. Ch. A method for nonlinear constraints inminimiza-\ntion problems. Academic Press, New York, 1969.\n\n[95] C. Prada, M. Rodriguez, and D. Sarabia. On-line scheduling\nand control of a mixed continuous batch plant. Industrial &amp;\nEngineering Chemistry Research, 50(9):5041\u20135049, 2011. doi:\n10.1021/ie1014298.\n\n[96] E. E. Rego and F. M. Hernandez. Eletricidade por digesta?o\nanaero?bica da vinhac?a de cana-de-ac?u?car: contornos te?cnicos,\necono?micos e ambientais de uma opc?a?o / electricity through\nanaerobic digestion of vinasse from sugarcane: technical, eco-\nnomic and environmental contours of an option. Proceedings of\nthe 6. Encontro de Energia no Meio Rural, 2006.\n\n[97] P. Richardson, D. Flynn, and A. Keane. Optimal charging of elec-\ntric vehicles in low-voltage distribution systems. IEEE Transac-\ntions on Power Systems, 27(1):268\u2013279, 2012. doi: 10.1109/TP-\nWRS.2011.2158247.\n\n[98] C. Royo. Generalized Unit Commitment by the Radar Multiplier\nMethod. PhD thesis, Technical University of Catalonia, 2001.\n\n[99] D. Sarabia, F. Capraro, L. F.S. Larsen, and C. Prada.\nHybrid nmpc of supermarket display cases. Con-\ntrol Engineering Practice, 17(4):428 \u2013 441, 2009. doi:\nhttp://dx.doi.org/10.1016/j.conengprac.2008.09.003.\n\n[100] R. Scattolini. Architectures for distributed and hierarchical model\npredictive control - a review. Journal of Process Control, 19:723\n\u2013 731, 2009.\n\n[101] M. Schulze and P. C. Del Granado. Multi-period optimization\nof cogeneration systems: Considering biomass energy for district\nheating. In 2nd Power Systems Modeling Conference, 2009.\n\n\n\n126 BIBLIOGRAPHY\n\n[102] B. De Schutter and B. De Moor. Optimal traffic light control for a\nsingle intersection. European Journal of Control, 4(3):260 \u2013 276,\n1998. doi: http://dx.doi.org/10.1016/S0947-3580(98)70119-0.\n\n[103] A. Serna, J. E. Normey-Rico, and F. Tadeo. Model predictive\ncontrol of hydrogen production by renewable energy. In Renew-\nable Energy Congress (IREC), 2015 6th International, pages 1\u20136,\n2015. doi: 10.1109/IREC.2015.7110959.\n\n[104] S. Shafiee and E. Topal. When will fossil fuel reserves be dimin-\nished. Energy policy, 37(1):181\u2013189, 2009.\n\n[105] W. Shi, X. Xie, C. C. Chu, and R. Gadh. Distributed optimal\nenergy management in microgrids. IEEE Transactions on Smart\nGrid, 6(3):1137\u20131146, 2015. doi: 10.1109/TSG.2014.2373150.\n\n[106] J. B. M. Sa?nchez. Optimizacio?n de metodolog??as para la carac-\nterizacio?n de biocombustibles so?lidos procedentes de la industria\ndel olivar / optimization methods for the characterization of solid\nbiofuels from the olive industry, 2015.\n\n[107] C. Sonntag, A. Devanathan, S. Engell, and O. Stursberg. Hy-\nbrid nonlinear model-predictive control of a supermarket re-\nfrigeration system. In Control Applications, 2007. CCA 2007.\nIEEE International Conference on, pages 1432\u20131437, 2007. doi:\n10.1109/CCA.2007.4389437.\n\n[108] C. Tiba. Atlas Solarimerico do Brasil. Ed. Universita?ria da\nUFPE, Recife, Brazil, 2000.\n\n[109] G. Tolentino, H. O. Florentino, and M. M. P. Sartori. Mode-\nlagem matema?tica para o aproveitamento da biomassa residual\nde colheita da cana-de-ac?u?car com menor custo / mathematical\nmodeling for the use of residual biomass harvesting of sugarcane\nat lower cost. Bragantia, pages 729\u2013735, 2007.\n\n[110] E. Unamuno and J. A. Barrena. Hybrid ac/dc microgridspart\nii: Review and classification of control strategies. Renewable\nand Sustainable Energy Reviews, 52:1123 \u2013 1134, 2015. doi:\nhttp://dx.doi.org/10.1016/j.rser.2015.07.186.\n\n[111] T. S. Ustun, C. Ozansoy, and A. Zayegh. Recent developments in\nmicrogrids and example cases around the worlda review. Renew-\nable and Sustainable Energy Reviews, 15(8):4030 \u2013 4041, 2011.\ndoi: http://dx.doi.org/10.1016/j.rser.2011.07.033.\n\n\n\nBIBLIOGRAPHY 127\n\n[112] L. Valverde, C. Bordons, and F. Rosa. Power management using\nmodel predictive control in a hydrogen-based microgrid. Annual\nConference on IEEE Industrial Electronics Society, pages 5669\u2013\n5676, 2012. doi: 10.1109/IECON.2012.6389059.\n\n[113] L. Valverde, F. Rosa, and C. Bordons. Design, planning and\nmanagement of a hydrogen-based microgrid. IEEE Transac-\ntions on Industrial Informatics, 9(3):1398\u20131404, 2013. doi:\n10.1109/TII.2013.2246576.\n\n[114] L. Valverde, F. Rosa, A. Del Real, A. Arce, and C. Bor-\ndons. Modeling, simulation and experimental set-up of\na renewable hydrogen-based domestic microgrid. Jour-\nnal of Hydrogen Energy, 38(27):11672\u201311684, 2013. doi:\nhttp://dx.doi.org/10.1016/j.ijhydene.2013.06.113.\n\n[115] L. Valverde, C. Bordons, and F. Rosa. Integration of fuel cell tech-\nnologies in renewable-energy-based microgrids optimizing opera-\ntional costs and durability. IEEE Transactions on Industrial Elec-\ntronics, 63(1):167\u2013177, 2016. doi: 10.1109/TIE.2015.2465355.\n\n[116] H. van Ekeren, R. R. Negenborn, P. J. van Overloop, and B. De\nSchutter. Hybrid model predictive control using time-instant op-\ntimization for the rhine-meuse delta. In Networking, Sensing and\nControl (ICNSC), 2011 IEEE International Conference on, pages\n215\u2013220, 2011.\n\n[117] J. C. Vasquez, J. M. Guerrero, J. Miret, M. Castilla, and L. Gar-\ncia de Vicuna. Hierarchical control of intelligent microgrids.\nIEEE Industrial Electronics Magazine, 4(4):23\u201329, 2010. doi:\n10.1109/MIE.2010.938720.\n\n[118] A. Venkat, J. Rawlings, and S. Wright. ch. Distributed Model\nPredictive Control of Large-Scale Systems Assessment and Future\nDirections. Springer-Verlag, Berlin, 2007.\n\n[119] L. F. Viana. Potencial energe?tico do bagac?o e palhic?o de cana-\nde-ac?u?car, cv. SP80-1842, em a?rea de alambique artesanal / En-\nergy potential of bagasse and straw of sugarcane cv. SP80-1842\nin handmade alembic area. PhD thesis, Universidade Federal de\nLavras, 2014.\n\n[120] L. Wang. Model Predictive Control System Design and Imple-\nmentation Using MATLAB. Springer, London, 2009.\n\n\n\n128 BIBLIOGRAPHY\n\n[121] Z. Wang, B. Chen, J. Wang, M.M. Begovic, and C. Chen. Co-\nordinated energy management of networked microgrids in distri-\nbution systems. IEEE Transactions on Smart Grid, 6(1):45\u201353,\n2015. doi: 10.1109/TSG.2014.2329846.\n\n[122] Z. Wang, B. Chen, J. Wang, and C. Chen. Networked micro-\ngrids for self-healing power systems. IEEE Transactions on Smart\nGrid, 7(1):310\u2013319, 2016. doi: 10.1109/TSG.2015.2427513.\n\n[123] C. Wei, Z.M. Fadlullah, N. Kato, and A. Takeuchi. Gt-\ncfs: A game theoretic coalition formulation strategy for reduc-\ning power loss in micro grids. IEEE Transactions on Par-\nallel and Distributed Systems, 25(9):2307\u20132317, 2014. doi:\n10.1109/TPDS.2013.178.\n\n[124] X. Xu and X. Zha. Overview of the researches on distributed\ngeneration and microgrid. In International Power Engineering\nConference (IPEC 2007), pages 966\u2013971, 2007.\n\n[125] M. Yazdanian and A. Mehrizi-Sani. Distributed control tech-\nniques in microgrids. IEEE Transactions on Smart Grid, 5(6):\n2901\u20132909, 2014. doi: 10.1109/TSG.2014.2337838.\n\n[126] C. Ziogou, D. Ipsakis, C. Elmasides, F. Stergiopoulos, S. Pa-\npadopoulou, P. Seferlis, and S. Voutetakis. Automation in-\nfrastructure and operation control strategy in a stand-alone\npower system based on renewable energy sources. Jour-\nnal of Power Sources, 196(22):9488 \u2013 9499, 2011. doi:\nhttp://dx.doi.org/10.1016/j.jpowsour.2011.07.029."}]}}}