{"add": {"doc": {"field": [{"@name": "docid", "#text": "BR-TU.21276"}, {"@name": "filename", "#text": "4993_337432.pdf"}, {"@name": "filetype", "#text": "PDF"}, {"@name": "text", "#text": "FEDERAL UNIVERSITY OF SANTA CATARINA\nGRADUATE PROGRAM IN AUTOMATION AND SYSTEMS\n\nENGINEERING\n\nEduardo Otte H\u00fclse\n\nROBUST PRODUCTION OPTIMIZATION OF GAS-LIFTED OIL\nFIELDS\n\nFlorian\u00f3polis\n\n2015\n\n\n\n\n\nEduardo Otte H\u00fclse\n\nROBUST PRODUCTION OPTIMIZATION OF GAS-LIFTED OIL\nFIELDS\n\nDissertation presented to the Gra-\nduate Program in Automation and\nSystems Engineering in partial ful-\nfillment of the requirements for the\ndegree of Master in Automation and\nSystems Engineering.\n\nAdvisor: Prof. Eduardo Camponogara\n\nFlorian\u00f3polis\n\n2015\n\n\n\nFicha de identifica\u00e7\u00e3o da obra elaborada pelo autor,\n atrav\u00e9s do Programa de Gera\u00e7\u00e3o Autom\u00e1tica da Biblioteca Universit\u00e1ria da UFSC.\n\nH\u00fclse, Eduardo Otte\n   Robust production optimization of gas-lifted oil fields\n/ Eduardo Otte H\u00fclse ; orientador, Eduardo Camponogara -\nFlorian\u00f3polis, SC, 2015.\n   150 p.\n\n   Disserta\u00e7\u00e3o (mestrado) - Universidade Federal de Santa\nCatarina, Centro Tecnol\u00f3gico. Programa de P\u00f3s-Gradua\u00e7\u00e3o em\nEngenharia de Automa\u00e7\u00e3o e Sistemas.\n\n   Inclui refer\u00eancias \n\n   1. Engenharia de Automa\u00e7\u00e3o e Sistemas. 2. Robust\noptimization. 3. Production optimization. 4. Gas-lift\nsystems. I. Camponogara, Eduardo. II. Universidade Federal\nde Santa Catarina. Programa de P\u00f3s-Gradua\u00e7\u00e3o em Engenharia\nde Automa\u00e7\u00e3o e Sistemas. III. T\u00edtulo.\n\n\n\n\n\n\n\nACKNOWLEDGEMENTS\n\nI would like to express my sincere gratitude to the Federal University\nof Santa Catarina and to Petrobras for letting me fulfill my dream of\nachieving a Master degree. Through the course of these two years many\npeople contributed somehow to this final dissertation, I thank them all.\n\nTo my colleagues and now friends from GOS, our research group,\nespecially Thiago, Marco, Caio, Leonardo, Lauvir and Angelo, I am\nextremely grateful for the assistance, long discussions, teachings, the\ntrips and also for making the working environment so enjoyable and\nfun. This is for sure what I will remember the most from this time.\n\nTo all my colleagues and friends from other labs, especially Igor,\nRodrigo, Fernando and Patrick thanks for providing a nice scape in the\nleast enlightened moments.\n\nTo my friends who encourage me taking this step in life in special\nto Felipe and the Inpulse family.\n\nAlso many thanks to my family, Sergio, Elke, Augusto and Leticia,\nfor all the support they have given to me throughout my returning time\nat the University.\n\nMost of all, I am fully indebted to Eduardo Camponogara, my\nadvisor and friend, for without his early inspiration, coaching, trust and\nenthusiasm none of this would have happened.\n\n\n\n\n\nTo be uncertain is to be uncomfortable,\nbut to be certain is to be ridiculous.\n\n(Chinese Proverb)\n\n\n\n\n\nRESUMO ESTENDIDO\n\nCom a crescente demanda por energia f\u00f3ssil as operadoras\npetrol\u00edferas t\u00eam buscado determinar planos operacionais que oti-\nmizam a produc?\u00e3o dos campos em operac?\u00e3o para satisfazer a de-\nmanda do mercado e reduzir os custos operacionais. Neste con-\ntexto, a pesquisa operacional tem se mostrado uma importante fer-\nramenta para determinac?\u00e3o dos planos de produc?\u00e3o de curto prazo\npara campos de petr\u00f3leo complexos. Alguns trabalhos j\u00e1 desenvolve-\nram estrat\u00e9gias para a otimizac?\u00e3o integrada da produc?\u00e3o que visam\nauxiliar engenheiros de produc?\u00e3o e operadores a atingir condic?\u00f5es\nde operac?\u00e3o \u00f3timas. Estes avanc?os cient\u00edficos atestam o potencial da\n\u00e1rea de otimizac?\u00e3o integrada da produc?\u00e3o de campos, justificando\na busca por estrat\u00e9gias de otimizac?\u00e3o global e integradas de ativos.\nContudo, a incerteza dos par\u00e2metros que caracterizam o reservat\u00f3-\nrio, os poc?os, fluidos e os diversos processos de produc?\u00e3o n\u00e3o vem\nsendo considerada pelos modelos e algoritmos de otimizac?\u00e3o da\nproduc?\u00e3o di\u00e1ria. Considerando os modelos de produc?\u00e3o de curto\nprazo, estas incertezas podem ser atribu\u00eddas a erros de medic?\u00e3o,\ncomportamento oscilat\u00f3rio dos sistemas, modelos imprecisos, en-\ntre outros. A influ\u00eancia da incerteza dos par\u00e2metros em proble-\nmas de otimizac?\u00e3o tem, desde tempos, sido foco da comunidade de\nprogramac?\u00e3o matem\u00e1tica. E j\u00e1 foi verificado que soluc?\u00f5es de pro-\nblemas de otimizac?\u00e3o podem apresentar significativa sensibilidade\n\u00e0 pertubac?\u00f5es nos par\u00e2metros do dado problema, podendo levar a\nsoluc?\u00f5es n\u00e3o fact\u00edveis, sub\u00f3timas ou ambas. Assim, buscando tornar\nas abordagens de otimizac?\u00e3o existentes mais confi\u00e1veis e robustas\n\u00e0s incertezas intr\u00ednsecas dos sistemas de produc?\u00e3o, esta dissertac?\u00e3o\ninvestiga a modelagem e tratamento de incertezas na otimizac?\u00e3o\ndi\u00e1ria da produc?\u00e3o e prop\u00f5e formulac?\u00f5es em programac?\u00e3o mate-\nm\u00e1tica para otimizac?\u00e3o robusta da produc?\u00e3o de poc?os operados\npor gas-lift. As formulac?\u00f5es representam curvas amostradas atra-\nv\u00e9s de dados simulados ou medidos que refletem as incertezas dos\nsistemas de produc?\u00e3o. Estas representac?\u00f5es levam a formulac?\u00f5es\nrobustas em programac?\u00e3o matem\u00e1tica inteira mista obtidas pela\naproximac?\u00e3o das curvas de produc?\u00e3o atrav\u00e9s de linearizac?\u00e3o por\npartes. Al\u00e9m disso, este trabalho apresenta os resultados de uma\nanalise computacional comparativa da aplicac?\u00e3o da formulac?\u00e3o ro-\nbusta e da formulac?\u00e3o nominal a um campo de petr\u00f3leo em am-\nbiente de simulac?\u00e3o, por\u00e9m considerando simuladores multif\u00e1sicos\namplamente empregados pela ind\u00fastria do petr\u00f3leo e g\u00e1s, que re-\npresentam a fenomenologia muito pr\u00f3ximo da realidade.\n\nO primeiro cap\u00edtulo apresenta a problem\u00e1tica em que est\u00e3o\n\n\n\nenvolvidos os desenvolvimentos realizados nesta dissertac?\u00e3o e um\nresumo dos cap\u00edtulos subsequentes.\n\nNo segundo cap\u00edtulo alguns conceitos fundamentais s\u00e3o apre-\nsentados para a compreens\u00e3o do trabalho desenvolvido. Este cap\u00ed-\ntulo \u00e9 dividido em tr\u00eas partes. A primeira parte inicia apresentando\nbrevemente a ind\u00fastria de petr\u00f3leo e g\u00e1s com uma perspectiva his-\nt\u00f3rica, econ\u00f4mica e dos processos envolvidos. Na sequ\u00eancia s\u00e3o\nexpostos conceitos b\u00e1sicos de engenharia de petr\u00f3leo necess\u00e1rios\npara o entendimento do sistema de produc?\u00e3o utilizado ao longo a\ndissertac?\u00e3o \u2013 i.e. gas-lift. Finalmente, o problema de otimizac?\u00e3o da\nproduc?\u00e3o \u00e9 situado dentro do problema maior, que \u00e9 o gerencia-\nmento completo das operac?\u00f5es de um campo de petr\u00f3leo, seguido\nde uma revis\u00e3o da literatura no que se refere a abordagens cl\u00e1ssi-\ncas para otimizac?\u00e3o da produc?\u00e3o de campos operados por gas-lift.\nA segunda parte \u00e9 uma descric?\u00e3o compacta sobre modelagem de\nproblemas de otimizac?\u00e3o utilizando programac?\u00e3o matem\u00e1tica e na\nmenc?\u00e3o dos m\u00e9todos de soluc?\u00e3o deste tipo de problema utilizados\nna parte experimental desta dissertac?\u00e3o. A terceira parte comec?a\ncom uma revis\u00e3o sobre incerteza em problemas de otimizac?\u00e3o e so-\nbre as decis\u00f5es de modelagem enfrentadas quando na presenc?a de\nproblemas de otimizac?\u00e3o incertos. Na sequ\u00eancia o paradigma de\notimizac?\u00e3o robusta \u00e9 introduzido e \u00e9 apresentada uma compilac?\u00e3o\nde alguns dos principais resultados da \u00e1rea de otimizac?\u00e3o robusta\nlinear. Al\u00e9m disso, ao fim, alguns pontos espec\u00edficos da teoria de\notimizac?\u00e3o robusta s\u00e3o apresentados pela suas relev\u00e2ncias para o\ndesenvolvimento da teoria dos cap\u00edtulos seguintes.\n\nO terceiro cap\u00edtulo inicia com uma discuss\u00e3o sobre as origens\ndas incertezas nos modelos de produc?\u00e3o para ent\u00e3o prover uma re-\nvis\u00e3o bibliogr\u00e1fica dos poucos trabalhos que mencionam ou lidam\ncom incerteza em sistemas de produc?\u00e3o. Na sequ\u00eancia, a incerteza \u00e9\nexaminada na perspectiva do problema de otimizac?\u00e3o. Um sistema\nsimples \u00e9 usado para exemplificar a metodologia de otimizac?\u00e3o ro-\nbusta desenvolvida nesta dissertac?\u00e3o.\n\nO quarto cap\u00edtulo apresenta dois problemas padr\u00f5es de oti-\nmizac?\u00e3o da produc?\u00e3o, um contendo poc?os sat\u00e9lites e outro com\npoc?os e completac?\u00e3o submarina. Para ambos uma formulac?\u00e3o em\nprogramac?\u00e3o linear inteira mista \u00e9 descrita considerando valores no-\nminais para todos os par\u00e2metros. Ent\u00e3o, para cada problema uma\nreformulac?\u00e3o robusta \u00e9 implementada considerando incerteza nas\ncurvas de produc?\u00e3o do poc?o. A metodologia utilizada para o pri-\nmeiro problema \u00e9 a mesma detalhada no cap\u00edtulo tr\u00eas, e para o\nsegundo uma extens\u00e3o da metodologia \u00e9 proposta para poder lidar\n\n\n\ncom restric?\u00f5es de igualdade incertas.\nNo quinto cap\u00edtulo s\u00e3o apresentados resultados experimen-\n\ntais de um problema de otimizac?\u00e3o da produc?\u00e3o de um campo com\npoc?os sat\u00e9lites. Os resultados obtidos com otimizac?\u00e3o cl\u00e1ssica (no-\nminal) e com otimizac?\u00e3o robusta s\u00e3o ent\u00e3o comparados em um\ncampo de produc?\u00e3o sint\u00e9tico instanciado em um simulador multi-\nf\u00e1sico comercial. A soluc?\u00e3o robusta se mostrou indicada para cen\u00e1-\nrios de operac?\u00e3o mais cr\u00edticos onde factibilidade e seguranc?a s\u00e3o\nprioridade.\n\nNo cap\u00edtulo final uma an\u00e1lise dos resultados obtidos na dis-\nsertac?\u00e3o \u00e9 feita sob a perspectiva do poss\u00edvel emprego das t\u00e9cnicas\ndesenvolvidas na ind\u00fastria de \u00f3leo e g\u00e1s. Apesar de \u00e0 primeira vista\nos resultados serem conservadores e de sua utilizac?\u00e3o parecer limi-\ntada, existe potencial para a metodologia ser empregada no caso de\nsituac?\u00f5es que priorizam seguranc?a. Al\u00e9m disso a metodologia aqui\ndesenvolvida pode servir como ponto inicial para pesquisas e desen-\nvolvimentos futuros. Uma breve descric?\u00e3o de poss\u00edveis trabalhos fu-\nturos \u00e9 feita ao final deste cap\u00edtulo. O ap\u00eandice traz a descric?\u00e3o de\nalgoritmos de amostragem de curvas c\u00f4ncavas desenvolvidos para\nos experimentos num\u00e9ricos realizados na dissertac?\u00e3o.\n\nPalavras-chave: Otimizac?\u00e3o robusta. Otimizac?\u00e3o da produc?\u00e3o de\npetr\u00f3leo. Sistemas de gas-lift.\n\n\n\n\n\nABSTRACT\n\nManaging production of complex oil fields with multiple wells\nand coupled constraints remains a challenge for oil and gas op-\nerators. Some technical works developed strategies for integrated\nproduction optimization to assist production engineers in reaching\nbest operating conditions. However, these works have neglected the\nuncertainties in the well-performance curves and production pro-\ncesses, which may have a significant impact on the operating prac-\ntices. The uncertainties may be attributed to measurement errors,\noscillating behavior, and model inaccuracy, among others. To this\nend, this dissertation investigates how uncertainty might be consid-\nered in daily production optimization and proposes formulations\nin mathematical programming for robust production optimization\nof gas-lifted oil fields. The formulations represent system-measured\nand simulated sample curves that reflect the underlying uncertain-\nties of the production system. The representations lead to robust\nMixed-Integer Linear Programming (MILP) formulations obtained\nfrom piecewise-linear approximation of the production functions.\nFurther, this work presents results from a computational analysis of\nthe application of the robust and nominal formulations to a repre-\nsentative oil fields available in simulation software.\n\nKeywords: Robust optimization. Production Optimization. Gas-lift\nsystems.\n\n\n\n\n\nLIST OF FIGURES\n\n2.1 Well deliverability . . . . . . . . . . . . . . . . . . . . . . 34\n2.2 Gas-lift concept (Economides et al. [1]) . . . . . . . . . 36\n2.3 Typical well performance curves . . . . . . . . . . . . . . 39\n2.4 Multilevel control hierarchy (Foss and Jensen [2]) . . . . 41\n2.5 Instance (P) of an uncertain Linear Programming (LP)\n\nwith nominal data . . . . . . . . . . . . . . . . . . . . . 65\n2.6 Uncertain LP, nominal instance and robust counterpart . 66\n2.7 Uncertain equality constraint relaxation . . . . . . . . . 73\n\n3.1 Snapshot of an operational oilfield . . . . . . . . . . . . 76\n3.2 Well production curves as functions of nominal, +10\\%,\n\nand  - 10\\%, GLR (top), WC (center) and PI (bottom) . . 86\n3.3 Well-production curve and two of its possible piecewise-\n\nlinear approximation curves . . . . . . . . . . . . . . . . 88\n3.4 Steps of a Monte Carlo method for approximating \\scrU \\widehat qoil(qi,G)\n\nfor an uncertain gas-liquid ratio (GLR) . . . . . . . . . . 94\n3.5 Steps of a Monte Carlo method for approximating \\scrU \\widehat qoil(qi,G)\n\nfor uncertain GLR and water cut (WC) . . . . . . . . . . 95\n3.6 Well production envelope curves q\\mathrm{l}\\mathrm{o}\\mathrm{w}\\mathrm{e}\\mathrm{r} and q\\mathrm{u}\\mathrm{p}\\mathrm{p}\\mathrm{e}\\mathrm{r}, and\n\ntheir PWL functions q\\mathrm{o}\\mathrm{i}\\mathrm{l},\\mathrm{i}\\mathrm{n}\\mathrm{f} and q\\mathrm{o}\\mathrm{i}\\mathrm{l},\\mathrm{s}\\mathrm{u}\\mathrm{p} . . . . . . . . . . . 101\n\n4.1 Production network \u2013 satellite wells . . . . . . . . . . . . 104\n4.2 Production network \u2013 subsea completion . . . . . . . . . 111\n\n5.1 Production network . . . . . . . . . . . . . . . . . . . . . 122\n5.2 Experimental procedure diagram . . . . . . . . . . . . . 125\n5.3 Instances of the uncertain data . . . . . . . . . . . . . . 126\n5.4 Total production comparison for each scenario of opti-\n\nmization . . . . . . . . . . . . . . . . . . . . . . . . . . . 127\n\n1 Piecewise-linear curves for Test # 1 . . . . . . . . . . . . 149\n\n15\n\n\n\n\n\nLIST OF TABLES\n\n5.1 Operating scenarios . . . . . . . . . . . . . . . . . . . . . 121\n5.2 Nominal field data . . . . . . . . . . . . . . . . . . . . . 123\n5.3 Percentage variation from nominal value . . . . . . . . . 124\n5.4 Scenario 1 . . . . . . . . . . . . . . . . . . . . . . . . . . 128\n5.5 Scenario 2 . . . . . . . . . . . . . . . . . . . . . . . . . . 128\n\n1 \"Search method\" Algorithm 1 . . . . . . . . . . . . . . . 150\n2 \u201cCut method\u201d Algorithm 3 . . . . . . . . . . . . . . . . . 150\n\n17\n\n\n\n\n\nLIST OF ABBREVIATIONS AND ACRONYMS\n\nCO2 carbon dioxide . . . . . . . . . . . . . . . . . . . . . 32, 75\n\nH2S hydrogen sulfide . . . . . . . . . . . . . . . . . . . . 32, 75\n\nCC convex combination . . . . . . . . . . . . . . . . . . . 19, 90\n\nDCC disaggregated convex combination . . . . . . . . . . 19, 90\n\nDLog logarithmic version of DCC . . . . . . . . . . . . . . . . 90\n\nDoC Declaration of Commerciality . . . . . . . . . . . . . . . 31\n\nE&amp;P Exploration and Production . . . . . . . . . . . . . . . . 28\n\nFDP field development plan . . . . . . . . . . . . . . . . . 29, 31\n\nGLR gas-liquid ratio 15, 33, 34, 83, 85, 87, 93\u201395, 98, 106, 123,\n124\n\nGOR gas-oil ratio . . . . . . . . . . . . . . . . . . . . . . . . . 33\n\nID inside diameter . . . . . . . . . . . . . . . . 83, 84, 106, 123\n\nInc incremental . . . . . . . . . . . . . . . . . . . . . . . . . 90\n\nIPR inflow performance relationship . 33, 34, 37, 38, 83, 85, 106\n\nLHS left hand side . . . . . . . . . . . . . . . . . . 62, 63, 96, 97\n\nLog logarithmic version of CC . . . . . . . . . . . . . . . . . . 90\n\nLP Linear Programming . . . . . . . . . . . 15, 48, 49, 61\u201372, 98\n\nMC multiple choice . . . . . . . . . . . . . . . . . . . . . . . 90\n\nMILP Mixed-Integer Linear Programming 13, 45, 48, 49, 70, 73,\n74, 87, 92, 103, 109, 110, 119, 120\n\nMINLP Mixed-Integer Nonlinear Programming 45, 48, 49, 82, 87,\n103, 109\n\nNP-complete Non-deterministic Polynomial-time complete . 48\n\n19\n\n\n\nNP-hard Non-deterministic Polynomial-time hard . . . . . 48, 73\n\nNPV net present value . . . . . . . . . . . . . . . . . . . . . . 29\n\nPI productivity index . . . . . . . . . . . . . . . . . . 85, 87, 123\n\nPWL piecewise-linear . . . . . . . . . 44, 87\u201391, 103, 110, 143\n\nRC robust counterpart . . . . . . . 59, 63, 64, 67\u201369, 71, 73, 96\n\nRDO robust design optimization . . . . . . . . . . . . 57, 63, 71\n\nRHS right hand side . . . . . . . . . . . . . . . . . . . 61, 62, 97\n\nSAA sample average approximation . . . . . . . . . . . . . . 55\n\nSG specific gravity . . . . . . . . . . . . . . . . . . . . . 33, 123\n\nSOCP second-order cone programming . . . . . . . . . . . . 69\n\nSOS2 special ordered sets of type 2 . 45, 90\u201392, 100, 105, 107,\n108, 110, 112, 114, 119\n\nTPR tubing performance relationship . . . . . . . . . . . 33, 34\n\nWC water cut . . . . . . 15, 83, 85, 87, 94, 95, 98, 106, 123, 124\n\nWPC well performance curve . . . . . 37, 38, 43, 44, 46, 79, 82\n\n\n\nCONTENTS\n\n1 Introduction 23\n1.1 Problem statement . . . . . . . . . . . . . . . . . . . 23\n1.2 Objectives and contributions . . . . . . . . . . . . . . 24\n1.3 Organization of the dissertation . . . . . . . . . . . . 25\n\n2 Fundamentals 27\n2.1 Oil production . . . . . . . . . . . . . . . . . . . . . . 27\n\n2.1.1 Petroleum industry overview . . . . . . . . . . 27\n2.1.2 Exploration and Production . . . . . . . . . . 28\n2.1.3 Lifting methods . . . . . . . . . . . . . . . . . 33\n\n2.1.3.1 Gas Lift System . . . . . . . . . . . . 37\n2.1.4 Integrated operations . . . . . . . . . . . . . . 40\n\n2.1.4.1 Production optimization of gas-lifted\noil fields . . . . . . . . . . . . . . . . 42\n\n2.2 Optimization modeling . . . . . . . . . . . . . . . . . 46\n2.2.1 Mathematic programming . . . . . . . . . . . 47\n2.2.2 Solving optimization problems . . . . . . . . . 49\n\n2.3 Robust optimization . . . . . . . . . . . . . . . . . . . 50\n2.3.1 Optimization under uncertainty . . . . . . . . 51\n2.3.2 Robust optimization . . . . . . . . . . . . . . . 58\n2.3.3 Robust Linear Optimization . . . . . . . . . . 61\n\n2.4 Summary . . . . . . . . . . . . . . . . . . . . . . . . 74\n\n3 Robust production optimization methodology 75\n3.1 Uncertainty in oil production systems . . . . . . . . . 75\n3.2 Uncertain production optimization models . . . . . . 80\n\n3.2.1 Nominal MINLP production problem . . . . . 82\n3.2.2 Uncertainties in the MINLP production problem 84\n3.2.3 Nominal MILP production problem . . . . . . 87\n3.2.4 Uncertain MILP production problem . . . . . . 91\n\n3.3 Robust production optimization methodology . . . . 95\n3.4 Summary . . . . . . . . . . . . . . . . . . . . . . . . 101\n\n4 Robust production optimization models 103\n4.1 Robust Production Optimization \u2013 Satellite Wells . . . 103\n\n4.1.1 Problem Formulation . . . . . . . . . . . . . . 103\n4.1.2 Robust Formulation . . . . . . . . . . . . . . . 107\n\n4.2 Robust Production Optimization \u2013 Subsea Manifold . 109\n4.2.1 Problem Formulation . . . . . . . . . . . . . . 109\n4.2.2 Robust Formulation . . . . . . . . . . . . . . . 115\n\n\n\n22 Contents\n\n4.3 Summary . . . . . . . . . . . . . . . . . . . . . . . . 120\n\n5 Experiments 121\n5.1 Oil Field Scenario . . . . . . . . . . . . . . . . . . . . 121\n5.2 Uncertain Parameters . . . . . . . . . . . . . . . . . . 123\n5.3 Computational Results . . . . . . . . . . . . . . . . . 124\n5.4 Summary . . . . . . . . . . . . . . . . . . . . . . . . 128\n\n6 Conclusion 131\n6.1 Further developments . . . . . . . . . . . . . . . . . . 132\n\nReferences 135\n\nAPPENDIX A \u2014 Sampling Algorithms 143\n\n\n\n1 INTRODUCTION\n\nThis chapter presents an overview of the purpose and focus\nof the study, its significance, and how it was conducted. Each of the\nfollowing chapters is outlined at the end.\n\n1.1 PROBLEM STATEMENT\n\nIn the daily operation of an oil field many decisions have to\nbe taken that affect the volume of fluids produced. A decision made\nby a production engineer or field operator takes into account the ca-\npacities of the surface facility in processing, storing, and exporting\nfluids, the pressures and fluid handling limits in subsea equipment,\nthe restrictions coming from reservoir management, and all these\nare linked by production models that predict the production of the\nwells. Many studies have been carried out to propose mathemati-\ncal tools that help the decision-makers to select the best produc-\ntion plan. A particular type of oil field operation is required when\na gas-lift system is used, and there are several works that deal with\nthis problematic including [3, 4, 5, 6, 7, 8, 9, 10]. Each of these\nstudies suggests an approach to solve the daily production optimiza-\ntion problem considering an specific set of variables and constraints,\namong the many possible scenarios of optimization that arise when\ngas-lift is present. Although those approaches can consider variation\nin equipment operating conditions (e.g. failures and valves align-\nments) they all considered only nominal operating conditions of the\nwells which, despite being valid for a short time horizon, may vary\nsignificantly to the extent of compromising and even invalidating a\nnominal solution.\n\nUncertainty in production optimization problems could be\nfound in the definition of the system capacities as well as in the\nproduction models. In the latter, the lack of accuracy to predict the\nsystem production arise from measurement errors, unmodeled os-\ncillating behavior, and system trends evolving dynamically in time,\nwhich hinders the sampling of informative data. All happening in\na time scale that could affect a daily production optimization solu-\ntion. Few works have investigated manners of dealing with uncer-\ntainty in the scope of daily production optimization. The problem is\nin fact twofold: quantifying uncertain data [11], and handling the\nuncertainty in the optimization problems in order to provide a so-\nlution that is at least to some extent immune to data perturbation\n[12, 13, 14]. Besides the small number of studies on the latter issue,\n\n23\n\n\n\n24 Chapter 1. Introduction\n\nthere is only one that to some extent considered uncertainty explic-\nitly in the optimization problem [13], but only for few parameters.\n\nTo this end, this work presents a formulation for production\noptimization which can account explicitly for uncertainty that are\ninherent to production wells.\n\n1.2 OBJECTIVES AND CONTRIBUTIONS\n\nThe research purpose is to develop production optimization\nmodels that can produce practical and robust solutions when the\noperative scenario faces uncertainty in the parameters that charac-\nterize reservoirs, wells, or equipment.\n\nThe proposed production optimization models are designed\nbased on the theory developed for robust linear optimization [15,\n16, 17, 18], extending and adapting it to the specific requirements\nof this application. The robust production optimization models have\ntheir solutions compared to standard production optimization mod-\nels, which are based on nominal (i.e. expected value) parameter\nvalues, in order to highlight the benefits and drawbacks of the op-\ntimal robust solutions and to demonstrate the impact of using stan-\ndard optimal solutions in an uncertain scenario. Experiments are\nperformed by using synthetic but representative oil fields instanti-\nated in a commercial simulator.\n\nThe main contributions of this work can be synthesized as:\n\n\\bullet The development of a robust optimization methodology that\ncan be applied to several instances of gas-lift optimization\nproblems;\n\n\\bullet An analysis of the performance of standard and robust produc-\ntion optimization to oil fields operating under uncertainty, us-\ning their optimal solutions in multiphase simulation softwares.\n\nOne central assumption of this work is that each uncertain\nparameter can be modeled as a range of possible values, not re-\nquiring a complicated description. Intuitively this provides an easier\napproach for modeling uncertainty, however, even finding relevant\nbounds for the parameter values remains a practical and theoretical\nchallenge.\n\n\n\n1.3. Organization of the dissertation 25\n\n1.3 ORGANIZATION OF THE DISSERTATION\n\nThis dissertation is divided in six chapters and one appendix.\nChapter 2 reviews fundamental topics that are important for under-\nstanding the developments described in the following chapters. It\ncovers concepts of the oil and gas industry, with emphasis on gas-\nlift systems and daily production optimization, with a review of the\nmain works in this area. It also presents a short overview on opti-\nmization modeling and optimization under uncertainty. Still in this\nchapter, the main results from the theory of robust linear optimiza-\ntion are described. The focus is on selected topics and on important\nremarks about the theory that are important for the robust produc-\ntion optimization models proposed in this work.\n\nChapter 3 has a discussion on uncertainty in production sys-\ntems, with a review of the few works that consider uncertainty in\nshort-term production optimization. It also details some core results\nof this dissertation. A simplified gas-lift production system is used\nexplain how to model an uncertain production optimization prob-\nlem and from this uncertain model how to produce the proposed\nrobust optimization model.\n\nChapter 4 presents the results of the same methodology when\napplied to two production optimization problems with routing de-\ncisions, one for a group of satellite wells, and another to a group\nof wells with subsea manifolds. Chapter 5 has experimental results\ncomparing standard and robust solutions of one of the models de-\nveloped in the previous.\n\nA conclusion of the dissertation is presented in Chapter 6,\nwith comments on the results achieved and a perspective of further\ndevelopments from this work.\n\nFinally, Appendix A presents a proposed algorithm for sam-\npling the production curves that produces a piecewise-linear approx-\nimation curve with a given maximum error.\n\n\n\n\n\n2 FUNDAMENTALS\n\nThis chapter provides a compact but comprehensive view of\nthe core areas encompassed in this dissertation. The reader familiar\nwith the subject addressed in one of the sections may skip to the\nfollowing.\n\n2.1 OIL PRODUCTION\n\nThe challenges present in the integrated operations of the\nproduction of oil and gas reservoirs motivated the development of\nthis work. This section presents a short overview of the oil and gas\nindustry. The focus is kept on the production of oil and gas wells\nwith special attention to oil fields operated by gas-lift, which are\nthe ones considered in the subsequent chapters.\n\n2.1.1 Petroleum industry overview\n\nBy the beginning of the twenty-first century petroleum is still\none of the main traded natural resources. It is a very versatile com-\nmodity, being used as raw material for many products such as fuels\nfor internal combustion engines, fertilizers, pharmaceuticals, and\nplastics, to name a few.\n\nPetroleum is a fossil fuel, thus a non-renewable energy source,\nthat consists of hydrocarbons of various molecular weights. Many\ntheories exist about how this hydrocarbons were formed. One well-\nknown perspective is the organic theory, which states that oil and\ngas came from large quantities of organic matter buried underneath\nsedimentary rock and subjected to intense heat and pressure. Dura-\ntion and intensity, as well as the type of organic matter, determine\nthe characteristics of the hydrocarbons formed in this process. Af-\nter oil and natural gas were formed in the source rock, they tended\nto migrate to the surface by density-related mechanisms. Migration\noccurs through the pores interconnections in the sedimentary rock\nor through open fractures within non-porous rocks. Occasionally,\nthe crude hydrocarbons oozed to the surface in form of a seep, or\nspring. Sometimes structural or stratigraphic traps, covered by im-\npermeable rock layers, trapped the hydrocarbons thousand of me-\nters below the surface. These formations are what we know today\nas oil and gas reservoirs [19].\n\nOil seeping out of shallow accumulations is a common, world-\nwide phenomenon. In fact, even though historical records of petro-\nleum (in an unrefined state) usage go back to the ancient Babyloni-\n\n27\n\n\n\n28 Chapter 2. Fundamentals\n\nans and Egyptians, until the nineteenth century, oil and natural gas\nseeps were the main source of petroleum [20]. The modern history\nof petroleum began in the mid-1800s with the formulation of its first\nrefining process followed by the first oil-well drilled. The refined oil\nwas initially used to replace whale oil for lighting. However, it was\njust in the early twentieth century, with the introduction of the in-\nternal combustion engine, that demand skyrocketed and petroleum\nbecame one of the most valuable commodities traded on world mar-\nkets.\n\nThe growing demand for hydrocarbons over the last century\nhas pushed the exploration of oil and natural gas reservoirs in al-\nmost every world location they appear. Nowadays even remote loca-\ntions have been exploited. From the rainforests of central Africa to\nthe deserts of Libya, from the Arctic region to the deep waters more\nthan 200 km from the coast. Moreover the demand has driven the\nexploration of even deeper oil reservoirs, as the ones in the pre-salt\nlayers in the Brazilian coast, and the exploitation of unconventional\npetroleum deposit as the shale gas and the bituminous sands.\n\nIn addition to that, the more restrictive governmental policies\nand regulations and more severe environmental laws of today have\nimposed tougher operating conditions to the entire oil industry. All\nthese new challenges have been pushing the need of operational\ncost reduction, the better inventory and assets management and\nthe investment in new technologies for the entire productive chain.\n\nModern oil and gas industry can be divided in three major sec-\ntors: upstream, midstream and downstream. Upstream is involved\nwith exploration and production of oil and gas fields, as well as\ndrilling the wells. Midstream and downstream refer to oil process-\ning, storing, transporting, marketing and any oil operation after the\nproduction phase through the point of sale.\n\nThe present dissertation relates to the upstream sector, more\nprecisely to the production of oil and gas fields.\n\n2.1.2 Exploration and Production\n\nIn the petroleum industry Exploration and Production (E&amp;P)\nis another name for the upstream sector. Next the two main phases\nof E&amp;P are briefly described.\n\n\n\n2.1. Oil production 29\n\nExploration\n\nThe first step of exploration is based on extensive geophysi-\ncal and geological studies (specially seismic surveys) performed in\norder to find the location and evaluate the preliminary production\npotential of oil or gas deposits. Just after these studies that an ex-\nploration, or wildcat, well is drilled. The purpose of this type of well\nis to determine whether oil or gas exist in a subsurface rock forma-\ntion and to further estimate reserves and potential production. This\nis the most expensive phase of the exploration process [21]. If a\nwildcat well discovers oil or gas, the company might drill several\nconfirmation wells to verify the well tapped a rock layer with suffi-\ncient hydrocarbons for the company to develop it economically [20].\nThe analysis of the oil or gas field potential is also made through a\nreservoir characterization in terms of porosity (size of reservoir rock\npores) and permeability (level of reservoir rock pores interconnec-\ntivity), sedimentary basin analysis and studies of structural geology.\nThere are several tests available in the industry to collect data to\ninfer the aforementioned and other reservoir characteristics [21].\n\nOnce sufficient knowledge of the field is gathered, a hydro-\ncarbon recovery feasibility study is carried out. This study considers\neconomical feasibility (net present value (NPV) and capital versus\noperating cost profiles), field production strategies (e.g., to max-\nimize oil and gas recovery, or fast oil and gas recovery), produc-\ntion equipment options (accounting for operational flexibility and\nscalability), logistics for the production transportation, the underly-\ning risks to exploit the field (technical, operational, financial, and\ngeopolitical), and the environmental impact [22]. Based on these\nstudies a field development plan (FDP) is then prepared in order\nto achieve a desired production and the economical objective. This\nplan comprises all activities and processes necessary to develop a\nfield. It is important to notice that the FDP is continuously updated\nduring the lifetime of an oil field. The reasons are: newer and more\naccurate data is constantly been gathered from the field, different\nmarket conditions are imposed, new technologies appear, among\nothers. Some of the activities and processes are:\n\n\\bullet Drilling plans:\n\u2013 include drilling schedules, well placement and trajectories,\n\nand casing and cementing programs to have the wells at\nthe desired location;\n\n\u2013 they shall be elaborated for the development wells and for\n\n\n\n30 Chapter 2. Fundamentals\n\nthe injection wells. A development well designed to pro-\nduce oil (usually along with some gas) is called an oil\nwell. While a well that is planned to produce mainly gas is\ntermed a gas well. Injection wells are the wells drilled to\nimplement improved recovery techniques, e.g., waterflood-\ning, immiscible or miscible gas injection, chemical flooding\nand thermal recovery [22];\n\n\\bullet Design and sizing of other equipment and facilities:\n\u2013 in order to achieve target well rates and handle the stream\n\nvariation of produced and injected fluids. Also providing\nplans for upgrades and additions when required;\n\n\u2013 surface facilities and its equipment, which may include arti-\nficial lift surface equipment (e.g., gas-lift compressors, vari-\nable speed drives), power generators, multi-phase separa-\ntors and tanks;\n\n\u2013 subsea equipment that make up the distribution pipeline\nnetwork connecting the wellheads to the separation facility.\nSome examples are flowlines, subsea manifolds, headers,\nrisers and umbilicals;\n\n\u2013 downhole equipment that are installed inside the wellbore.\nThey are usually the casing, liners, production tubing and\nwellhead, but may also include, artificial lift equipment\n(e.g., gas-lift valves, electrical submersible pump string),\npackers, and various valves [21];\n\n\\bullet Operational policies:\n\u2013 are related to long-term strategic decision making, mid-\n\nterm strategic or operational decision making and even to\nshort-term operational decision making. In this way it com-\nprises the expertise of different management levels, from\nexecutive managers, to reservoir engineers and production\nengineers, on how to operate the oil field;\n\n\\bullet Reservoir depletion plan:\n\u2013 is designed by a reservoir management team and defines\n\nhow the reservoir should be exploited over time;\n\u2013 is closely related to the drilling plan to conform the sched-\n\nule with the available facility capacity and injection require-\nments. It also provides well rate forecasts to aid well de-\nsign, and multiple production scenarios to aid equipment\nand facility design.\n\n\n\n2.1. Oil production 31\n\nThe cycle of gathering fresh (field, economic, etc.) data to be\nanalyzed, evaluating that analysis and amending the FDP accord-\ningly, and finally implementing the required changes made in the\nplan and measuring their impact, is a decision-making process. Ob-\nserve that each part of the FDP has a different cycle frequency. This\nis directly related to the time constant of the various processes [23].\nThe operation of an oil field considering all these long, medium\nand short-term decision-making processes together is here referred\nas integrated operations and is further developed in Section 2.1.4.\n\nWhen a field is considered suitable for exploitation, and all\npaper work and licenses required by the competent authorities are\nsubmitted and acquired, all initial actions of the FDP can be ex-\necuted. For instance, according to Brazilian rules, this moment is\ndefined by the Declaration of Commerciality (DoC) of the field. It\nmarks the end of the exploration phase and the beginning of the\nproduction phase.\n\nProduction\n\nBefore the first drop of oil can be produced the first wells\nof the drilling schedule have to be constructed. A well is normally\ndrilled using a drilling rig and applying a variety of techniques de-\npending on the location, design and geological conditions [20]. Af-\nter drilling is finished a careful formation evaluation is performed\nto determine whether the specific well is economically productive.\nIf the test is positive the borehole is cased and cemented, otherwise\nis plugged and abandoned.\n\nAt this point, if the surface facilities are build, the surface\nequipment are installed, and the components that make up the dis-\ntribution pipeline network are laid down, the field is ready to start\nthe production.\n\nIn the petroleum industry, production is the phase of opera-\ntion that deals with bringing well fluids to the surface and prepar-\ning them for transportation to the refinery or processing plant [22].\nProduction comprises the following activities:\n\n(i) preparing and maintaining the borehole for production/injec-\ntion;\n\n(ii) managing reservoir injections and drainage;\n\n(iii) bringing fluids to the surface facilities;\n\n\n\n32 Chapter 2. Fundamentals\n\n(iv) separating into oil, gas, water and contaminants streams that\nare measured for quantity an quality.\n\nwhere all these activities must be carried on within very strict stan-\ndards for health, safety, environmental and social responsibility.\n\nActivity (i) are the operations of completion, well services and\nworkover. Completion consist of procedures that enables the well\nfluid to be produced. For the development wells this can include\npreparing the bottom hole, perforating and stimulating the produc-\ntion zones, running in the production tubing along with the re-\nquired downhole tools and installing the wellhead and Christmas\ntree [21]. After this point the well can be connected to the surface\nfacilities and it is ready to produce. On the other hand, well services\nand workovers are well interventions. These operations are usually\nintended to perform routine maintenance or to correct downhole\nequipment failure, excessive gas or water production, sand produc-\ntion or any problem affecting productivity [21].\n\nReservoir management (ii) is involved with the reservoir de-\npletion plan which defines how to use primary drive mechanisms\nto exploit hydrocarbon resources and how, when, or if these mecha-\nnisms should be supplemented for additional recovery. This plan is\ndeveloped with the input from several engineering disciplines.\n\nThe activity (iii) is made through a lifting method, which al-\nlows bringing well fluids to the surface. It also include the routing\nand choking operations within the distribution pipeline network\nconnecting the outlet valves of the production trees to the tanks\nand multiphase flow separators in surface facilities. More on lifting\nmethods in Section 2.1.3\n\nWell fluids, usually a mixture of oil, gas, water, and also CO2,\nH2S and sand, must be separated as they reach the surface. Wa-\nter must be treated before re-injection or disposal, while oil after\ntreated is transported from the well site. The gas can be either com-\npressed and exported, re-injected, used as lift-gas, serve as fuel, or\nflared by exception. The content of contaminants is continuously\nmeasured and actions are taken accordingly. All of these belong to\nactivity (iv).\n\nAmong all areas of production, the present work relates to the\noperations of well fluid flowing, more precisely on how to operate\nlifting methods in the context of integrated operations.\n\n\n\n2.1. Oil production 33\n\n2.1.3 Lifting methods\n\nFor the well fluid to flow from the inner parts of the reservoir\nto the surface facilities it has first to move through the reservoir\npores interconnections until it finds the reservoir-wellbore interface.\nThere, the fluid enters the wellbore by perforations. In order to flow\nfrom the bottomhole to the wellhead it has to overpower both, the\npressure resulting from the fluid weight in the production tubing\nand the pressure drop caused by frictional forces in the well. From\nthis point until it enters the separation equipment the flow still has\nto overcome additional pressure drops due to friction in pipelines\nand chocking effect in the choke valves.\n\nThe flow rate/pressure relation taking place from the inside\nof the reservoir to the wellbore interface is represented by the in-\nflow performance relationship (IPR), or just inflow. Complementar-\nily, the term tubing performance relationship (TPR), or more gener-\nically outflow performance, is used for the flow rate/pressure rela-\ntion existing in between the same interface and the surface equip-\nment [1].\n\nBoth inflow and outflow are extremely affected by the fluid\ncharacteristics \u2013 gas-oil ratio (GOR), GLR, water cut (water-liquid\nratio), oil and mixture viscosities, water, oil and gas specific gravity\n(SG), bubble point, etc. The IPR is also influenced by rock proper-\nties (i.e. porosity and permeability), flow regime, the structure of\nthe perforations, formation damage or stimulation, the reservoir in-\nternal energy source (drive mechanism and recovery methods), etc\n[24]. On the other hand, what further affects the outflow are the\nwell geometry, the production tubing size and material (friction ef-\nfects), the choking valves opening, the surface or subsea pipeline\nnetwork design, gas and liquid velocities, vertical and horizontal\nflow regimes, the surface equipment operating pressures and any\nenergy source added in the outflow path.\n\nFor example, the relationship between the liquid flow rate,\nq, and the bottomhole flowing pressure, pwf , for a well with high\nwater cut (greater than 80\\%), can be approximated as a straight\nline. However, for wells with lower water cut, with a considerable\nGOR, and flowing pressures below the bubble point pressure, gas\nstarts coming out the solution already inside the formation. The\nlower the pwf , the higher the quantity of free gas flowing through\nthe pores and narrow the space to the liquid to flow. In this case, the\nIPR is commonly approximated by a Vogel curve [25], as depicted in\nFigure 2.1. In the same Figure, a TPR curve is plotted. It represents\n\n\n\n34 Chapter 2. Fundamentals\n\nTPR\n\nIPR\n\nFlow rate, q\n\nB\not\n\nto\nm\n\nh\nol\n\ne\nFl\n\now\nin\n\ng\nP\n\nre\nss\n\nu\nre\n\n,\np\nw\nf\n\nFigure 2.1: Well deliverability.\n\nthe curve of a high-GLR fluid (or gas wells). In this scenario, for low\nliquid flow rates, q, the hydrostatic pressure drop decreases with\nincreasing flow rate. Yet, as q is incremented, frictional pressure\ndrop starts having a more important play and after the minimum\npwf it becomes dominant, with a relatively small positive slope. For\nlower GLR values the curve is likely to be almost flat, with only a\nvery small slope [1]. Another component of the TPR curve is the\nwellhead pressure, which is usually a design requirement, thus, it\nhas constant value for every flow rate. The IPR and TPR curves are\ncombined in graphics, as it is presented in Figure 2.1, to estimate\nthe well deliverability (expected production rate and bottomhole\nflowing pressure), which is the intersection of the two curves.\n\nThe energy required to initiate and maintain a well flowing\ncan come from within the reservoir (by natural and artificial man-\nners), but it can also be added inside the wellbore.\n\nFor recently drilled wells, it may be the case that the energy\nsource is exclusively provided by reservoir drive mechanism, such\nas depletion drive, water drive, gravity drainage or a combination\nof them. Reservoirs which the driving mechanisms are inefficient\nand by consequence retain large quantities of hydrocarbons, may\n\n\n\n2.1. Oil production 35\n\nemploy a series of process known as improved recovery methods.\nThese are classified as conventional methods \u2013 e.g. miscible gas in-\njection and waterflooding; or unconventional methods \u2013 e.g. steam\ninjection, or chemical flooding. The former helps to maintain a suffi-\ncient formation pressure, while the latter enables reducing the fric-\ntion between the fluid and the reservoir rocks [22].\n\nA well is called a natural flowing well, if it only uses the in-\nternal reservoir energy (commonly referred as reservoir pressure) to\nproduce the well fluids. In this case the energy source can come\neither from driving mechanisms or recovery methods. This is the\nsimplest and basic lifting method to be used in a well. In a natu-\nral flowing well the primary elements to control fluid flow are the\nchocking valves. However, as the reservoir pressure drops and fluid\nproduction cannot reach the surface an artificial lift method has\nto be used. Artificial lift methods can also be applied to natural\nflowing wells in order increase fluid flow rate. Unlike driving mech-\nanism and recovery methods, which only directly affect the inflow\nperformance, the artificial lift methods affect exclusively the out-\nflow performance. The basic function of an artificial lift method is\nto create the required differential pressure to drive fluids from the\nreservoir into the wellbore, which is known as pressure drawdown.\n\nThere are many artificial lift methods available. Choosing an\nartificial lift method is a matter of numerous factors like: fluid vis-\ncosity, fluid composition and presence of solids; wellbore tempera-\nture, depth and geometry (vertical, deviated, or horizontal); well\nlocation, whether onshore or offshore production and number of in-\nstallations; well productivity, installation and operational costs, and\naccessible infrastructure. Some of the most adopted methods in the\nindustry are as follows.\n\nSubsurface Sucker-Rod Pumps consist of the usual simple combi-\nnation of a cylinder and piston or plunger with a suitable in-\ntake valve and discharge valve for displacing the well fluid\ninto the tubing and to the surface [26]. Thus, it produces the\nwell fluids in batches.\n\nElectrical Submersible Pump is a system composed of multistage\ncentrifugal downhole pumps driven by a downhole electrical\nmotor and auxiliary equipment. Its operating principle is to\nuse the centrifugal pump to generate the required bottomhole\npressure drawdown that allows a desired flow rate. The use\nof a variable-speed drive allows a more flexible production\n\n\n\n36 Chapter 2. Fundamentals\n\nInjection \nValve\n\nFigure 2.2: Gas-lift concept (Economides et al. [1]).\n\noperation. It is perhaps the most versatile of the major oil-\nproduction artificial lift methods [26].\n\nGas Lift System is a method where an external source of high-pres-\nsure gas is injected continuously to the annular space of the\nwell at a given rate and enters the production tubing through\na gas-lift valve installed as deep as possible, given the gas com-\npression pressure. The injection gas mixes with the stream\nof well fluids and decreases the mixture density. Hence, the\nlower flowing pressure gradient reduces the flowing bottom-\nhole pressure to establish the drawdown required for attaining\na design production rate for the well (Figure 2.2) [26].\n\nThe explanation given above is for a continuous gas lift sys-\ntem, which is the lifting method considered in this dissertation. Nev-\nertheless, some wells, usually low production wells, also operate\n\n\n\n2.1. Oil production 37\n\nusing an intermittent gas lift system, which has a slightly different\noperating principle [27].\n\n2.1.3.1 Gas Lift System\n\nGas lift is the artificial lift method in which a high-pressure\ngas is injected in the production tubing providing energy to lift the\nwell fluids. Since the cost of compression far exceeds the cost of\ndownhole gas-lift equipment, the primary consideration in the se-\nlection of a gas-lift system to lift a well, a group of wells, or an\nentire field is the availability and compression cost of gas [26].\n\nFigure 2.2 illustrates a well operated by gas lift. In this type of\nsystem the production rate is controlled \u2013 using an injection valve \u2013\nby the rate of injection gas entering the lowest gas-lift valve. Notice\nthat the choking valves in the production tree, or sometimes at the\nproduction unit, can also be used to control the well flow as pre-\nviously mentioned. The upper gas lift valves are only necessary to\nhelp removing the completion fluid in start-up operations, a process\nwhich is called unloading a well. Thus, they remain closed during\nwell production.\n\nThere are many aspects in designing continuous gas lift sys-\ntems. Availability of high-pressure injection-gas, well fluid data, per-\nforations depth, completion fluid properties, expected IPR and re-\nquired wellhead flowing pressure are some of the information used\nto choose the size, material, amount and setting depth of the gas-lift\nvalves. Although the design of a gas-lifted system plays a key role\nin the potential well deliverability [1], in the present work, instead,\nwe are interested in the problem of operating an existing system. In\nthe following we focus on operational aspects of already installed\ngas lift systems.\n\nBertuzzi et al. (1953 apud Economides et al.[1], 2012) in\ndeveloping design procedures for gas-lift systems, introduced the\ngas-lift performance curve (a.k.a.1 well performance curve (WPC)),\nwhich is the steady state relationship between the gas-lift rate and\nthe rate of well fluid at the outlet. This makes the WPC the main\nmean in finding operating points for a gas-lifted well.\n\nFigure 2.3(a) illustrates typical WPCs. Curve A represents a\nnatural flowing well. As can be seen, any amount of gas injection\nalters its production. Curve C, on the other hand, represents a well,\nwhich requires a minimum gas injection in order to start flowing.\n\n1abbreviation for \u201calso known as\u201d\n\n\n\n38 Chapter 2. Fundamentals\n\nAlthough curves B and D refer respectively to the same wells of\ncurves A and C, the former are subjected to a higher pressure drop\nin the chocking valve of the production tree.\n\nThe characteristic shape of a WPC is depicted in Figure 2.3(b).\nThe shape depends on both, the well IPR and the different outflow\nperformance relationships generated at each gas-lift injection rate.\nFor instance, each point of the curve in Figure 2.3(b) is a mapping of\na different well deliverability (see Figure 2.1) at the corresponding\nconstant lifting gas injection rate. The varying outflow is a combina-\ntion of the hydrostatic pressure head and the friction pressure drop.\nWhile gradually increasing the gas injection results in a fluid den-\nsity reduction with modest friction pressures, continued increase in\nthe lift gas supply makes friction pressure losses in the tubing dom-\ninant and the production rate starts declining. This effect divides\na WPC in two regions that are highlighted in Figure 2.3(b). In re-\ngion (I) an increase in gas injection produce an increase of produc-\ntion, while in region (II) the production decreases as more gas is\ninjected. The transition point between the two regions is the point\nof optimum injection rate. When not considering production con-\nstraints this is the point of maximum production. In reality though,\noperators do not have an unlimited cost-free supply of lift gas, un-\npredicted gas slugging may happen in deviated wells, and excessive\npressure drawdown may cause formation or perforations damage.\nAll this limits the optimum lift gas injection rate that is then some-\nwhat lower than the peak value, located in the so called economical\nregion. Also note that in region (I), close to point of maximum pro-\nduction, q\\mathrm{m}\\mathrm{a}\\mathrm{x}oil , a large increase of gas injection grants only a small\ngain in oil flow rate.\n\nDeriving inflow and outflow relationships using only physi-\ncal equations is difficult, as many phenomenological model param-\neters are unknown and also because of the limited understanding\nof some of the physics involved. Therefore, pure physical WPC mod-\nels are uncommon and well performance curves are usually gener-\nated numerically by multiphase simulation software. These simu-\nlators approximate the real curve using available data (formation,\nfluid and composition data, wellbore and production string param-\neters), along with several models (phenomenological and empirical\n[24, 29, 30]), and applying appropriated calculation methods (e.g.\nnodal analysis [31]). After a well is producing, well tests are also an\nimportant source of information to derive models for the WPC. By\nthe use of operating data curve fitting techniques may be applied.\n\nMany of these simulators have embedded tools for finding the\n\n\n\n2.1. Oil production 39\n\nqoil\n\nqinj\n\nA\nB\nC\nD\n\nGas injection rate\n\nO\nil\n\np\nro\n\nd\nu\n\nct\nio\n\nn\nra\n\nte\n\n(a)\n\nqoil\n\nqinj\n\nO\nil\n\np\nro\n\nd\nu\n\nct\nio\n\nn\nra\n\nte\n\nGas injection rate\n\nq\\mathrm{m}\\mathrm{a}\\mathrm{x}oil\n\n(I) (II)\n\nEconomical region\n\n(b)\n\nFigure 2.3: Typical well performance curves.\n\n\n\n40 Chapter 2. Fundamentals\n\noptimal injection point for individual wells in an unconstrained situ-\nation. Nevertheless, for optimization under constrained production\nand considering multiple wells sharing the gas lift source or the dis-\ntribution pipeline, other tools have to be used. Section 2.1.4.1 gives\nan overview of such methods in the context of integrated opera-\ntions.\n\n2.1.4 Integrated operations\n\nThe integrated operation of an oil field in the course of the\nproduction phase is a complex task. During this phase an operator\ncompany has a main goal that usually is to optimize profitability\nwhile satisfying a number of constraints (physical, financial, regu-\nlatory and human). However, looking at each activity within the\nproduction phase, there are many other opposing and consonant\ngoals.\n\nThe list of goals includes: (i) minimize capital expenditures\nand operational costs by efficient investment strategies and opti-\nmal assets and supply chain management; (ii) maximize recovery\nusing improved recovery techniques, optimal well location and de-\nsign, and optimal production/injection targets; (iii) Sustain or in-\ncrease oil and gas production through well allocation, testing and\nrecompletion, and providing optimal setpoints for surface, subsea\nand downhole equipment; (iv) reduce the overall risk of decisions;\n(v) among others [32].\n\nSolving this huge problem is very challenging. Technological\ninnovations in hardware and software in the recent decades, such as\ntools for digital measurement and data processing, brought the con-\ncept of smart fields [33, 6] and real-time optimization [23, 34] to\nthe context of integrated operation of oil and gas producing systems.\nSaputelli et al. [23] define this concept as a process of measure-\ncalculate-control cycles at a frequency which maintains the system\u2019s\noptimal operating conditions within the time-constant constraints\nof the system.\n\nThe various decision-making processes associated with each\nobjective listed previously can be alternatively organized by their\ndifferent planning horizon as proposed by Saputelli et al. [35]. This\ndivision of the integrated operation problem into subproblems on\ndifferent time scales limits complexity, allowing the problem to be\ntractable. Similar hierarchical structure is found in Foss and Jensen\n[2]. They proposed a time scale division in long-term, medium-term\nand short-term. The decisions in operating an oil field are then\n\n\n\n2.1. Oil production 41\n\nFigure 2.4: Multilevel control hierarchy (Foss and Jensen [2]).\n\ngrouped in four levels (asset management, reservoir management,\nproduction optimization, and control and automation) within this\ntime frame. Figure 2.4 depicts this idea in what is called a multilevel\nproduction control hierarchy. The arrows connecting adjacent layer\nremind that decisions do influence other levels. Foss and Jensen [2]\npoint that a set of decisions in an upper-level imposes constraints\non a lower-level optimization problem to avoid a short-term pro-\nduction strategy harming long-term recovery. Further, lower-level\ninformation is used to align upper-level optimization with relevant\noperational information. It is also mentioned that decisions below\nthe dotted line are taken automatically, while decisions above have\nhuman participation, thus being semiautomatic.\n\nIn this work, we are interested in the production optimiza-\ntion layer. In this layer usually a production engineer is the one\nresponsible for taking many daily decisions in order to optimize the\nproduction of an oil field. The aim of many of the researches found\nin the area of production optimization is to provide the production\nengineers a tool that helps them make the best decisions to operate\ntheir field. Besides helping optimize production under normal con-\nditions, this kind of tool is particularly important to assist operation\nunder unusual situations, e.g. determining setpoints for the whole\nfield when one equipment fails.\n\n\n\n42 Chapter 2. Fundamentals\n\nIn general, decisions are: determining the setpoints for com-\npressors, choke valves, pressure controllers, and separation equip-\nment, setting manifold alignment, well allocation and establishing\ndownhole equipment operating points, among others. In order to\nfind the set of decisions that optimize production, the field operator\nmust have first a reliable production model. There are also many\nconstraints affecting the scope of this layer. Those arise from the\nreservoir management layer, e.g. production targets, or from physi-\ncal capacities of the surface, subsea and downhole equipment.\n\nNotice that each field will have a distinct set of decision vari-\nables and a different set of constraints, thus a different production\nmodel. In this dissertation we concentrate on typical gas-lifted oil\nfield operative scenarios as the background to develop our work.\n\n2.1.4.1 Production optimization of gas-lifted oil fields\n\nAt first sight the physical structure and components in a gas\nlift system, as presented in Section 2.1.3.1, may look basically the\nsame for each gas-lifted oil field. However, every gas-lift applica-\ntion has its particularities and the variation between them may be\nrather significant if considering production optimization. Some of\nthe components and their possible variations:\n\n\\bullet Separation units:\n\u2013 single or multiple units, allowing routing or not;\n\u2013 variable or fixed separation pressure;\n\u2013 liquid handling capacity;\n\n\\bullet Processing, Storage and Export units:\n\u2013 water treatment, storage and discharge capacities;\n\u2013 platform gas handling capacity;\n\u2013 compositional requirements and limits, e.g. contaminants;\n\n\\bullet Gas lift compressor:\n\u2013 compression capacity;\n\n\\bullet Subsea manifolds:\n\u2013 could be fixed routing or allow flexible routing of the fluid\n\nstream;\n\u2013 it may or may not admit flow splitting;\n\u2013 pressure and flow rate limits;\n\n\n\n2.1. Oil production 43\n\n\\bullet Flow lines:\n\u2013 could be individual for each well (i.e. satellite or platform\n\nwells) or could be shared by a group of wells (usually the\ncase when the production of subsea wells is directed to a\nsubsea manifold);\n\n\\bullet Choke valves:\n\u2013 could be installed in any point of the distribution pipeline\n\nnetwork. Typically each well has one located at the produc-\ntion tree, or in offshore production a surface choke at the\nplatform;\n\n\u2013 could have fixed or ranged opening;\n\n\\bullet Well:\n\u2013 many flow assurance issues are related to well character-\n\nistics. These may constraint the production to a maximum\nor a minimum value. Examples are:\n\\circ flow control to avoid gas or water coning;\n\\circ some wells may need a minimum production to ensure\n\na continuous flow;\n\\circ production may be limited to avoid formation and per-\n\nforations damage;\n\\circ injection valves may require minimum and maximum\n\nlift-gas flow;\n\\circ flow limits to avoid slugging.\n\nAdditionally, the production of individual wells may be lim-\nited due to different reservoir management reasons. Examining the\nlist given above one can see that some of the items are related to\nequipment settings \u2013 we will refer to them as decision variables,\nwhile others are related to constraints in the operation of gas-lifted\noil fields. The purpose of production optimization is to determine\nthe optimal setpoints for the relevant subset of decision variables,\ngiven some criteria (e.g. maximum amount oil produced) and re-\nspecting the system constraints.\n\nProduction optimization also requires a production model\nwhich establishes the relationship between the system variables and\nthe production of fluid from the wells. As it was previously men-\ntioned in Section 2.1.3.1 the most important model for gas lift sys-\ntems is the well performance curve (WPC). Moreover, in the pres-\nence of subsea completion, models of pressure drop versus multi-\nphase flow are also necessary because the production stream of\n\n\n\n44 Chapter 2. Fundamentals\n\ndifferent wells can be sharing the same flow line. Models used in\nthe production optimization of gas-lifted wells are normally based\non commercial multiphase flow simulators, either by querying the\nsimulator directly or by building tables of simulator predictions, so\ncalled proxy-models [11]. Since the surrogate models allow usage\nof a broader range of mathematical tools to aid solving the produc-\ntion optimization problem, many have been proposed. In the case of\nthe WPC, for example, it is possible to model it as third order poly-\nnomial, or with a second order polynomial plus a logarithmic term\nas proposed by Alarc\u00f3n et al. [36]. Nakashima and Camponogara\n[12] fit it with the composition of two exponential curves. Another\napproach is to use piecewise-linear (PWL) curves as in Camponog-\nara and De Conto; Gunnerud and Foss; Codas and Camponogara;\nSilva and Camponogara [37, 7, 8, 9], which dismisses the fitting\nstep required to other proxy-models.\n\nSeveral works have provided different approaches for solv-\ning the problem of production optimization of gas-lifted oil fields.\nThe strategies used vary from sensitivity analysis using simulation\ntools, to heuristic methods and mathematical programming meth-\nods. Those works also consider different gas-lift system scenarios.\nThat means, while some may consider gas compression unlimited\nothers do not; some consider that all wells are satellite while oth-\ners may consider subsea completion, thus contemplating pressure\nconstraints; Some may account for routing decisions and others not\nand so on. Following are some of the works that have applied math-\nematical programming methods to obtain optimal production plans.\n\nRedden et al. [3] developed a calculation technique for de-\ntermining the most profitable distribution of gas to wells in a con-\ntinuous gas-lift system. The procedure uses production data and\nvertical flow correlations to predict the production of the individual\ngas-lifted wells. The algorithm accounts for the constraints on gas\ncompression by iteratively reducing injection based on a ranking of\nwells. Their results were used to assist production in two operating\nfields.\n\nBuitrago et al. [4] were among the first in proposing a global\noptimization algorithm for lift-gas allocation considering compres-\nsion restrictions. Their algorithm combines a stochastic domain ex-\nploration and a heuristic calculation of a descent direction to avoid\nfind suboptimal solutions. They paid special attention to wells that\ndo not respond instantaneously to gas injection (as curve C and D\nin Figure 2.3(a)).\n\nKosmidis et al.; Kosmidis et al. [5, 38] addressed a more gen-\n\n\n\n2.1. Oil production 45\n\neral production system consisting of wells, manifolds, and separa-\ntors, and modeling pressure in the flow lines and facilities. The pro-\nduction optimization problem is cast as an Mixed-Integer Nonlinear\nProgramming (MINLP) problem that models pressure as a nonlinear\nfunction balancing the momentum of the flow lines. They proposed\na method for finding a local optimum of the MINLP program which\nsolves a sequence of MILP problems. While their work is focused\non oil field modeling, this paper develops efficient models and al-\ngorithms to find a globally optimal operating point for a simpler oil\nfield.\n\nCamponogara and De Conto [37] derived valid inequalities,\nfor which exact and approximate lifting procedures yield stronger\ninequalities. This was used to solve the problem of distributing a\nlimited rate of lift-gas, while respecting injection bounds and acti-\nvation precedence constraints. Numerical results show that these\ncover-based cuts can reduce the number of nodes explored in a\nbranch-and-bound search.\n\nRashid [39] solved a lift-gas allocation problem with gas con-\nstraints. He addresses the effects of interactions between wells by\ndeveloping an algorithm that iterates until convergence on well-\nhead pressures. A simulator was used in the loop to validate results,\ntest pressures, and generate curves. Separation constraints are not\ntaken into account.\n\nCampos et al. [6] established the main requirements for inte-\ngrated production optimization of large-scale oil fields. In the paper\nthey stressed the importance of accurate well models to predict con-\ning effects and integration with real-time optimization algorithms to\nreach optimal operating conditions. The importance of optimization\nalgorithms capable of dealing with flow routing is also recognized.\n\nGunnerud and Foss [7] presented an MILP formulation for\noil fields in a decentralized structure. This is achieved by model-\ning clusters of independent wells, manifolds, and pipelines while\nthe separation facilities are centralized in a platform. Piecewise lin-\nearization techniques based on special ordered sets of type 2 (SOS2)\nconstraints are used to approximate nonlinear functions. The contri-\nbution lies in efficient decomposition of the optimization problem\nby the application and assessment of the Lagrange relaxation and\nthe Dantzig\u2013Wolfe decomposition.\n\nCodas and Camponogara [8] designed two MILP formula-\ntions as alternative to the real MINLP problem of optimal lift-gas\nallocation with well-separator routing. The first (compact) was ob-\ntained using piecewise linearization of the nonlinear curves using\n\n\n\n46 Chapter 2. Fundamentals\n\nbinary variables to represent the linearization and the routing de-\ncisions. The second formulation (integrated) combines routing and\nlinearization variables together. Both structures are explored to de-\nsign extended cover cuts. Results showed that cutting planes were\nmore efficient for the integrated formulation, however the compact\nformulation has less variables.\n\nSilva and Camponogara [9] solved a global optimization prob-\nlem for gas-lift operations using different piecewise-linear models\nfor WPCs and pressure drop curves with domains spliced in hyper-\ncubes and simplexes. The problem consists of wells connected to\nsubsea manifolds which can be routed to different separation units.\nThey focus on a comparison of seven different formulations of the\nproblem.\n\nAll the aforementioned works deal with the problem of pro-\nduction optimization of gas-lifted oil fields in a particular way. In\nthis dissertation we take advantage of piecewise-linear models [40,\n9] to propose and study formulations of robust production optimiza-\ntion. More specifically, in Chapter 4 the formulation developed in\nSection 4.1 is based on models of Codas and Camponogara [8] and\nthe formulation from Section 4.2 is based on the formulations of\nSilva and Camponogara [9].\n\nProduction optimization models that to some extent try to\nhandle model uncertainty are not very common. In Chapter 3 we\npresent a literature review in this topic.\n\n2.2 OPTIMIZATION MODELING\n\nMathematical optimization, or just optimization, is a branch\nof applied mathematics that deals with the problem of, for a given\ncriteria, selecting the best element within a set of available alterna-\ntives. An optimization problem has the following elements:\n\nDecision variables are the variables whose values determine a so-\nlution to the problem.\n\nObjective function is an expression that relates the decision vari-\nables for an specific goal. This is the function for which a max-\nimum or a minimum value is being sought.\n\nConstraints are expressions relating the decision variables. They\ndefine the space of feasible solutions for the problem.\n\nMany applications of science, including optimization, make\nuse of models. The term model is usually employed for either con-\n\n\n\n2.2. Optimization modeling 47\n\ncrete or abstract structures used to represent a real object or system.\nThese structures are built for a specific purpose (i.e. help one know,\nunderstand, or simulate a subject the model represents). Thus, de-\npending upon the use to which a model is to be put, it can exhibit\nas many and as precise features and characteristics of the subject as\nrequired.\n\nAn optimization model is designed in order to represent an\noptimization problem. These models are usually mathematical, in\nthat algebraic symbolism (such as equations, inequalities and logi-\ncal dependencies) are used to mirror the internal relationships of\nthe problem (i.e. decision variables, objective functions and con-\nstraints). Often, practical problems can be modeled in more than\none standard or non-standard way. That is because modeling an op-\ntimization problem is not a straightforward task, and depends on\nthe model builder\u2019s experience, intuition, creativity and power of\nsynthesis [41].\n\nMany optimization models take standard forms. Examples of\nstandard alternatives are simulation models, constraint program-\nming, and mathematical programming. The latter is probably the\nmost commonly used standard type of model [41] and was chosen\nto represent the optimization problems throughout this dissertation.\n\n2.2.1 Mathematic programming\n\nMathematic programming is a modeling language largely em-\nployed to express optimization problems. It uses mathematical rela-\ntionships to represent the elements of an optimization problem.\n\nA general optimization problem P can be written in mathe-\nmatic programming as:\n\nP : Maximize f(\\bfitx )\nSubject to: gi(\\bfitx ) \\leq 0, i = 1, . . . , m\n\n\\bfitx \\in \\scrX \n\nwhere \\bfitx is the vector of decision variables, f : \\BbbR n \\rightarrow \\BbbR is the\nobjective function, gi : \\BbbR n \\rightarrow \\BbbR , i = 1, . . . , m are the constraints\nof the problem, which limit the space of feasible solutions, and \\scrX \nis a continuous subset in \\BbbR n. Depending on the nature of objective\nfunction, constraints, and decision variables an optimization model\ncan be classified within specific classes of problems. Below a list of\na few of these classes is presented:\n\n\n\n48 Chapter 2. Fundamentals\n\nLinear Programming (LP) is a class of optimization problems for\nwhich both objective function and constraints are linear in\nthe decision variables. A standard mathematical programming\nform of this class of problems is given by:\n\nPL : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\bfA \\bfitx \\leq \\bfb \n\\bfitx \\in \\BbbR n+\n\nwhere \\bfb \\in \\BbbR m and \\bfc \\in \\BbbR n are vectors2,3 and \\bfA \\in \\BbbR m\\times n is\na matrix. This sort of problem is widely used and has efficient\nalgorithms to solve it, as the Simplex algorithm and interior\npoint methods [42].\n\nMixed-Integer Linear Programming (MILP) has a similar formu-\nlation to Linear Programming, since objective function and\nconstraints must be linear. Nevertheless, in this class of prob-\nlems some of the decision variables belong to discrete domain.\n\nPMI : Maximize \\bfc \n\\intercal \\bfitx + \\bfh \\intercal \\bfity \n\nSubject to: \\bfA \\bfitx + \\bfG \\bfity \\leq \\bfb \n\\bfitx \\in \\BbbR n+\n\\bfity \\in \\BbbZ p+\n\nwhere \\bfb , \\bfc and \\bfh are vectors and \\bfA and \\bfG are matrices with\nconvenient dimensions. This class of problem is Non-deter-\nministic Polynomial-time hard (NP-hard), because any prob-\nlem in the Non-deterministic Polynomial-time complete (NP-\ncomplete) class can be reduced to a PMI in polynomial time,\nfor example, the satisfiability problem [43]. However, there\nare advanced algorithms for solving mixed-integer programs\nincluding, branch-and-bound, branch-and-cut, branch-and-pri-\nce, and cutting-plane methods [44].\n\nMixed-Integer Nonlinear Programming (MINLP) is a more gen-\n\n2In this dissertation we consider vectors as column matrices.\n3\\bfA \\intercal denotes the transpose of matrix \\bfA .\n\n\n\n2.2. Optimization modeling 49\n\neral form of optimization problem.\n\nPNL : Maximize f(\\bfitx , \\bfity )\nSubject to: gi(\\bfitx , \\bfity ) \\leq 0, i = 1, . . . , m\n\n\\bfitx \\in \\scrX \n\\bfity \\in \\scrY \n\nwhere f and gi, i = 1, . . . , m, are nonlinear real-valued func-\ntions on \\BbbR n+p and not necessarily continuous. \\scrY is a finite sub-\nset in \\BbbZ p+ and \\scrX is a continuous subset in \\BbbR n. There is no gen-\neral method to solve problems of this class and one must cope\nwith each problem individually in order to find an efficient al-\ngorithm, when it exists. A difficulty of any algorithm proposed\nto solve this class of problems \u2013 and any subclass containing\na nonlinear function \u2013 is the guarantee that it can be solved\nto global optimality and not only to provide an optimal so-\nlution within a near neighborhood (local optimum) [45]. A\nparticular subclass is the quadratic programming, which has a\nrelative easy solution when problem is convex.\n\nKeep in mind that the same optimization problem may be\nmodeled into distinct mathematical programming models, which\ncould even belong to different mathematic programming classes.\nThis illustrates the importance of modeling in optimization prob-\nlems.\n\n2.2.2 Solving optimization problems\n\nThe solution to an optimization problem lies within the fea-\nsible space delimited by its constrains. Yet, for the majority of the\noptimization problems, enumerating all feasible solutions is not a re-\nalistic strategy to find the optimal solution. Therefore more sophisti-\ncated alternatives have been developed. The task of finding a strat-\negy to solve an optimization problem modeled in mathematical pro-\ngramming is directly related to its classification (LP, MILP, MINLP,\netc.). A set of operations for solving a particular class of problem or\nmodel is known as an algorithm. Linear programming and integer\nprogramming, for example, have well-known algorithms for solv-\ning each problem. For instance, the most efficient general methods\napiece are the revised simplex algorithm and the branch-and-bound\nalgorithm. It is beyond of the scope of this dissertation to get into\nthe details of these algorithms. They are well described in Vanderbei\n[46] and Wolsey and Nemhauser [44] respectively.\n\n\n\n50 Chapter 2. Fundamentals\n\nSolvers\n\nFor frequently used algorithms there are very mature com-\nputer programs available off-the-shelf. Implementation of many of\nthese algorithms are commonly grouped into a computational pack-\nage and are commercial available for solving mathematical pro-\ngramming models. These packages, also referred as solvers, offer\nsome advantages. They are generally flexible to use, providing many\nprocedures and options (e.g. automatic problem reduction) to the\nuser [41]. State-of-the-art solvers represent many person-years of\nprogramming effort. In addition to algorithms that provide optimal\nsolutions (or at least certificated suboptimal solution) they also in-\nclude heuristic that help finding quality solutions efficiently. Though\nthis eases the model builder from the task of programming the com-\nputer to solve the model, it may complicate a fair comparison be-\ntween different model approaches for some computational indexes,\nparticularly regarding efficiency as time to solve an optimization\nproblem. Since the aim of this work is to confront optimization\nmodels, but mainly to compare its solutions \u2013 variables and objec-\ntive values at optimality, all results are obtained using commercial\nsolvers for the sake of simplicity.\n\nModeling languages\n\nA number of special purpose high level programming lan-\nguages, known as algebraic modeling languages, exist to aid users\nto structure and instantiate their model of an optimization prob-\nlem into solvers. They function as an interface between the model\nbuilder and the solver, greatly reducing the effort and increasing the\nreliability of formulation and analysis [47]. Modeling languages can\nprovide many advantages for the user as: a more natural input for-\nmat, higher level data structures, easier debugging, syntax based on\nconventional mathematical notation, etc. For those reasons all opti-\nmization models used in the experiments are implemented through\na modeling language. For reference, we chose the AMPL R\\bigcirc modeling\nlanguage [48], but any other similar one could have been used.\n\n2.3 ROBUST OPTIMIZATION\n\nFrom the second half of the twentieth century, mathemati-\ncal optimization has found widespread applications over different\nareas as engineering design, planning and scheduling of produc-\n\n\n\n2.3. Robust optimization 51\n\ntion systems, logistic problems, the study of physical and chemical\nsystems, and more. Already at the beginning, many researchers in\napplying optimization techniques to those problems identified that\nuncertainty is almost always present and that its effects can be a\nkey aspect in finding an optimal solution for real world problems.\nThis section provides a short overview of optimization under un-\ncertainty leading to an examination of one of its subfields, that is\nrobust optimization. Finally important results specific for robust lin-\near optimization are introduced.\n\n2.3.1 Optimization under uncertainty\n\nThe paradigm of making a decision without knowing what\ntheir full effects will be, distinguishes the field of optimization under\nuncertainty from other branches of optimization. In decision theory,\nuncertainty is defined as a state that limits the capability of predict-\ning a future outcome, or describing the current state of a system.\nWhat makes a system uncertain is particular to each system. Natural\nand technological systems are almost always confronted with uncer-\ntainty, and its possible sources may include the lack of proper mea-\nsurement/estimation systems, measurement/estimation errors (in\nphysical systems, technological process, environmental conditions\n. . . ), imperfect manufacturing process and material properties, im-\nplementation errors (coming, for example, from the impossibility\nto implement a solution exactly as it is computed), oversimplified\nmodels, etc [16, 49]. In real-world applications of optimization it is\ncommon to replace uncertain data by its nominal value \u2013 e.g. an ap-\nproximated or expected value. However, studies like the one carried\nout by Ben-Tal and Nemirovski [16], show that optimal solutions for\nthose problems may become severely infeasible or completely mean-\ningless from a practical viewpoint, if the nominal data is slightly\nperturbed. Consequently, in optimization, there is a real need for\nmethodologies that can account for the effects of uncertainty.\n\nThe pioneering work in the area of optimal decision-making\nunder uncertainty emerged in the nineteen fifties with the works\nof Dantzig; Bellman; Charnes and Cooper (1955, 1957, 1959 apud\nSahinidis[53], 2004), which are the seminal works for, respectively,\nstochastic programming, dynamic programming and optimization\nunder probabilistic constraints. Since then, new procedures and\ntechniques, for both modeling and algorithmic, have been devel-\noped in the field of optimization under uncertainty to support the\nmany areas of application where such problems appear.\n\n\n\n52 Chapter 2. Fundamentals\n\nAt the modeling side, one wants to consider the effects in-\ntroduced by uncertain elements into the underlying optimization\nmodels and evaluate how the unknown values affect the quality\nof the solution obtained. In this sense, a variety of peculiar model-\ning philosophies were established to deal with the paradigm needs.\nHence, when modeling under uncertainty additional concepts have\nto be considered. Below four of these concepts are presented. They\nconcern with how uncertainty is expressed in the optimization prob-\nlem, how to model uncertain elements, how to deal with uncer-\ntain objective functions, and also with how to treat uncertain con-\nstraints.\n\nInitially let\u2019s take a basic deterministic optimization problem,\nP, in the \\BbbR n:\n\nP : Maximize f(\\bfitx )\nSubject to: gi(\\bfitx ) \\leq 0, i = 1, . . . , m\n\n\\bfitx \\in \\scrX ,\n\nwhere f : \\BbbR n \\rightarrow \\BbbR , gi : \\BbbR n \\rightarrow \\BbbR , i = 1, . . . , m, and \\scrX \\subset \\BbbR n.\nProblem P does not regard for the presence of uncertainty in its\nmodel. This bring us to the first concept, that is, the modeler has\nto somehow represent the effects of uncertainty in the decision-\nmaking model. This in itself is a challenging subject, particular to\nthe model structure of each application. There is no general rule\nto help introducing uncertainty in an optimization model. Let\u2019s con-\nsider for now that the designer can come up with a representation\n\\~P, alternative to P. Such formulation would have an objective func-\ntion f(\\bfitx , w) and a feasible set given by \\{ \\bfitx : \\bfitx \\in \\scrX and gi(\\bfitx , w) \\leq \n0, i = 1, . . . , m\\} \\subset \\BbbR n, in which w stands for something uncertain \u2013\na parameter ranging over a space \\Omega representing its possible states.\n\nThis generic description leads us to the second concept. It\nconcerns the characteristics of the aforementioned space \\Omega , which\nis directly related with the model of the uncertain parameter. Rock-\nafellar [54] describes three modeling approaches for w.\n\nDeterministic modeling could refer to: (i) a mathematical formu-\nlation in which uncertainty plays no role as in model P ; (ii) a\nmathematical formulation that replace the random element w\nby some particular estimate \\widehat w (commonly the expected value\n\n\n\n2.3. Robust optimization 53\n\nof w, \\BbbE [w]). This produces a deterministic version of \\~P as,\n\n\\~Pdet : Maximize f(\\bfitx , \\widehat w)\nSubject to: gi(\\bfitx , \\widehat w) \\leq 0, i = 1, . . . , m\n\n\\bfitx \\in \\scrX .\n\nThose are widely used alternatives to cope with uncertainty\n(in fact, to avoid it) in practice. The reasons to use such models\ncan be the impossibility to add the effects of uncertainties in\nthe model \u2013 option (i), or the lack of adequate data to infer w,\nor even to software limitation for getting numerical solutions\nfor problem \\~P \u2013 option (ii).\n\nTwo common approaches to deal with uncertainty are sensi-\ntivity analysis and scenario optimization. Both use model \\~Pdet,\nbut in different ways.\n\n\\bullet Sensitivity analysis is performed to study the effect of\nchanges in the parameter values after a solution is ob-\ntained from a problem in the form of \\~Pdet. Thus, fixing\n\\bfitx to be \\bfitx  \\star (solution to \\~Pdet) and varying w in its full\nrange of possible values to see how the objective func-\ntion value is perturbed. This analysis is very limited to\nobserve full implications of uncertainty in the underlying\nproblem. Some drawbacks and limitations are discussed\nby Wallace [55].\n\\bullet Scenario optimization uses a number of scenarios (certain\n\nrepresentations of how the future might unfold) that can\nbe generated by simulation or using some kind of proba-\nbilistic model. Problem \\~Pdet is then solved for every sce-\nnario and their results \u2013 optimal solution, \\bfitx  \\star , and respec-\ntive objective function value \u2013 are grouped in a heuristic\nmanner. Also based on heuristics, these groups of solu-\ntions are inspected to decide the most appropriate solu-\ntion. Nevertheless, the approach can easily lead to faulty\nconclusions [54].\n\nStochastic modeling is applied when uncertain elements, i.e. w, in\na problem can be modeled as random variables. That means\n\\Omega is a probability space with a known probability distribution.\nNotice that this distribution could be obtained from statisti-\ncal data or simply chosen by educated guess. Either way, the\nmathematical treatment is the same.\n\n\n\n54 Chapter 2. Fundamentals\n\nRange modeling is an alternative modeling approach to the uncer-\ntain elements. Instead of assigning them a probability distri-\nbution, which is often unavailable, one can view its values as\nrestricted to a given interval (range). In this case \\Omega is a closed\nuncertainty set with no particular distribution. This is the type\nof modeling used in robust optimization.\n\n\\~P is a problem comprising uncertainty, but it is not yet an\n\u201coptimization problem\u201d [54]. To achieve that, one has to provide\na prescription of exactly what should be maximized over what. In\norder to make this point clearer, let\u2019s take each \u201cwhat\u201d at a time.\n\nThe first one relates to the objective function of problem \\~P\nand brings us to the third concept. When the decision has to be\nmade before any information about w is known other than the range\nit belongs or its probability distribution (depending on the type of\nuncertainty modeling), one might even know the space over which\nthe maximization is being performed \u2013 namely \\BbbR n or a subset \u2013\nanyhow the objective is still not well defined. For instance, choosing\na feasible \\bfitx does not provide a single objective function value, but\nan uncertain value f(\\bfitx , w), since w \\mapsto \\rightarrow f(\\bfitx , w) on \\Omega . There are\ntwo prevailing approaches to transform the objective function and\nthereafter be able to maximize it over \\bfitx . The idea is to change its\nresult from a function depending on \\bfitx to a number depending on \\bfitx \n[54].\n\nWorst-case approach considers only the worst outcome resulting\nfor choosing a given \\bfitx . It does not weight for the likelihood of\nthe events. This approach can be used along with stochastic or\nrange modeling of the uncertainties, nevertheless it is usually\nrelated to the latter. Therefore, the objective function f(\\bfitx , w)\nis replaced and the problem becomes of maximizing\n\n\\^f(\\bfitx ) := \\mathrm{i}\\mathrm{n}\\mathrm{f}\nw\\in \\Omega \n\nf(\\bfitx , w).\n\nThis has the same format of Wald\u2019s minimax (maximin) model\n[56] and it is the approach used in robust optimization.\n\nStochastic approach can be used when \\Omega is a probability space.\nIn this case, for a given \\bfitx , f(\\bfitx , w) can be understood as a\nrandom variable inheriting its distribution from w. There are\ndifferent manners to convert a random variable (dependent\non \\bfitx ) to a numerical quantity (also dependent on \\bfitx ). The\nmost common alternative is to use the \u201caverage outcome\u201d, that\n\n\n\n2.3. Robust optimization 55\n\nmeans, replacing the random variable by its expected value.\nThen, the objective function takes the form,\n\n\\^f(\\bfitx ) := \\BbbE w[f(\\bfitx , w)],\n\nwhere the expectation is given by a weighed sum or an inte-\ngral, if the underlying probability space is discrete, or contin-\nuous, respectively 4. Notice that more complex schemes may\nbe required to have a more realistic and reliable model. For\ninstance, it is possible to have an alternative objective func-\ntion given by \\varphi (\\bfitx ) := \\Phi ( \\^f(\\bfitx ), \\^\\^f(\\bfitx )), where \\^\\^f(\\bfitx ) denotes the\nvariance of f(\\bfitx , w), \\^f(\\bfitx ) the mean, and \\Phi provides a formula\nfor balancing the two quantities. It may also be appropriate\nin some situations, for example, to consider that \\bfitx affects the\nprobability distribution of w.\n\nWell, we are still left to clarify over \u201cwhat\u201d we are maximizing\nin problem \\~P. So, the forth concept is associated with the definition\nof the feasible region of the problem. Here it is worth taking a more\ngeneral formulation for the constraints specifying the feasible re-\ngion. Conventionally, a system of constraints can be represented by\ninequality constraints, equality constraints, and a subset of \\BbbR n, as\ndescribed below. \\left\\{  \n\n \ngi(\\bfitx , w) \\leq 0, i = 1, . . . , m\nhj(\\bfitx , w) = 0, j = 1, . . . , q\n\\bfitx \\in \\scrX \n\nIn other branches of optimization, constraints can be modeled in\nvarious equivalent forms. It is common to transform equalities to\nequivalent inequalities and the opposite. However, in the presence\nof uncertainty, conversions not always result in equivalent formula-\ntions and should be avoided whenever possible. Ben-Tal et al. [17]\nprovide an explanatory example of this phenomenon. Following, it\nis presented how uncertainty affects the modeling of equality and\ninequality constraints.\n\nEquality constraints can be used to model different aspects of a\nsystem. For example, they can be employed to express a state\n\n4A problem involving continuous random variables can be dis-\ncretized in various ways to avoid the multi-variate integration when\nevaluating the objective function. One possibility is to use simulation,\ne.g. sample average approximation (SAA).\n\n\n\n56 Chapter 2. Fundamentals\n\nvariable through a corresponding state equation, or to model\nphysical-based constraints, such as F = ma (in these cases at\nleast one variable is dependent and one is independent). They\nare also used to represent physical laws, as the principle of\nmass conservation, or as a designer-imposed constraint, such\nas dimensional constraints (for these cases all variables are\nindependent). Looking at the equality constraints in the set of\nequations above, for j = 1, . . . , q it is being demanded that\nhj(\\bfitx , w) = 0. However, requiring \\bfitx to make hj(\\bfitx , w) assume\na constant value zero is in conflict with the fact that the value\nhj(\\bfitx , w) could vary with respect of the unknown value of w.\nThis gives an image of how tricky are equality constraints in\nsuch scenario.\nIn general these constraints are very problematic when con-\ntaminated with uncertainty. Ben-Tal et al.; Rockafellar [17, 54]\nsuggest to refrain from this type of structure when possible.\nBut this is not always the case, so one way to get rid of equality\nconstraints is through substitution. For instance, usually state\nvariables (and its state equations) can be substituted into in-\nequalities constraints, thus eliminating these constraints. Sub-\nstitution cannot always be applied, so an alternative is to use\nthe constraint relaxation approach. Relaxation can be imple-\nmented in different manners, as using slack variables to relax\nthe equality constraints, or replacing the equality constraints\nby two inequalities. Another possible approach is satisfying\nthe equality constraint at its mean value. Although in a differ-\nent (but related) context, Rangavajhala et al. [49] provide an\ninteresting perspective on how to classify and deal with equal-\nity constraints.\n\nInequality constraints, as presented previously, are generally the\nsame as requiring that,\n\n\\^fi(\\bfitx ) \\leq 0, where \\^fi(\\bfitx ) := \\mathrm{s}\\mathrm{u}\\mathrm{p}\nw\\in \\Omega \n\nfi(\\bfitx , w).\n\nFrom this perspective the inequality is seen to have a \u201cworst-\ncase\u201d aspect. This is a conservative approach that reveals one\nend side of the intrinsic dilemma when optimizing under un-\ncertainty, that is, the trade-off between optimality and robust-\nness.\nWhen the restrictions are not so severe, thus a worst-case con-\ndition is not truly intended and specially if uncertainty has\n\n\n\n2.3. Robust optimization 57\n\na stochastic modeling, there are alternative modeling options\nfor the inequality constraints. One of them is to work with\nfinite penalty expressions incorporated to the objective func-\ntion in substitution to the hard constraints, with their infinite\npenalty aspect. Another approach is to use chance constraints.\nThe idea, then, is to relax the hard constraints probabilistically\n[54]. The general structure is in the form,\n\nprob[fi(\\bfitx , w) \\leq 0] := \\beta i,\n\nwhere \\beta i is the probability that the inequality holds for a given\n\\bfitx . For latter modifications the reformulated optimization prob-\nlem is called to be over soft constraints.\n\nEach alternative approach to restructure the underlying constraints\nhas its own drawbacks and advantages, in both, technical ramifica-\ntions and modeling aspects.\n\nThe four aforementioned concepts give a sense of how mod-\nels of decision-making under uncertainty may differ from determin-\nistic ones. Notice, however, that the modeling philosophies used\nwhen optimizing under uncertainty bring in also other concepts. For\nexample, throughout this dissertation we contemplate only single-\nstage uncertain problems, thus, logically, we consider that all the\nuncertainty reveals itself afterwards, when all decisions are already\nmade \u2013 otherwise they would not be uncertain problems after all.\nHowever, for two-stage and multi-stage problems the concept of\nprecedence between fixing the decision and making an observation,\nwhich make the uncertainty dissipate, is key to reformulate and\nsolve the problem.\n\nIt is also important to notice that the choice between the dif-\nferent alternatives for each concept is a responsibility of the decision-\nmaker when analyzing the basic problem; there is no general recipe.\nMixing the various formulations presented earlier to manage the un-\ncertainties produce families of problems with totally different struc-\ntures. It is to handle this families of problems that different subfields\nof optimization under uncertainty have been developed. Some have\na broader applicability such as stochastic programming (linear, inte-\nger, nonlinear), probabilistic (chance-constraint) programming, sto-\nchastic dynamic programming, fuzzy programming [53], and ro-\nbust optimization (linear, convex) [17], while others are application-\nspecific as robust design optimization (RDO) which is used in engi-\nneering design problems [49].\n\n\n\n58 Chapter 2. Fundamentals\n\nIn this work we use the concepts behind robust linear opti-\nmization to design the models for production optimization of gas-\nlifted oil fields considering the presence of uncertainty.\n\n2.3.2 Robust optimization\n\nThe idea of robustness of a solution is shared by many areas\nin applied science, as robust statistics, robust control and robust\noptimization. The connection between them are not always explicit,\nbut they all rely on approaches that provide solutions which, at least\nin some level, are immune, when the scenario of the problem is un-\ncertain. The conceptual roots behind robust optimization trace back\nto the first half of the twentieth century, precisely to Wald\u2019s contribu-\ntions to modern decision theory, with his minimax model [56]. How-\never, the field of study established today as robust optimization is\nconsider to have started only in 1973 with the work of Soyster[57],\nthough it was just with the terminology used in researches made\nin the 1990s \u2013 for convex programming [16, 58, 15, 59, 60] and\ninteger programming [61] \u2013 that optimization for worst-case value\nof parameters within a set has become effectively known as \u201crobust\noptimization\u201d [62]. Now, let\u2019s briefly examine the main concepts of\nthe robust optimization paradigm.\n\nFrom the previous section one can extract that uncertainty in\nan optimization problem, threatens the relevance of its solution in\ntwo facets:\n\n(i) on one hand, when implemented, the calculated optimal solu-\ntion, which is thought to be feasible, might actually violate the\nproblem constraints;\n\n(ii) and on the other hand, when indeed feasible, the solution\nmight be far from the true optimal value.\n\nAs it was pointed out in Section 2.3.1, there are many techniques\navailable to deal with these issues. Also in the previous section, it\nwas discussed that for each of these techniques, different assump-\ntions are made on the characteristics of the uncertainty and on how\nuncertain elements are structured in the optimization problem. The\nlist below present the key assumptions made for robust optimiza-\ntion [17].\n\nA.1. The uncertain data in a problem is modeled in terms of ranges.\nThe data can assume any value within a given uncertainty set,\nwhich has an unknown probability distribution.\n\n\n\n2.3. Robust optimization 59\n\nA.2. All the decision variables of the problem represent \u201chere and\nnow\u201d decisions \u2013 the problem must be solved, and their values\nmust be chosen, before the actual data \u201creveals itself\u201d.\n\nA.3. The constraints of the problem are \u201chard\u201d. Meaning that viola-\ntion of the constraints cannot be tolerated, when data is within\nthe prespecified uncertainty set. Any solution of the problem\nis then called robust feasible.\n\nA.4. The objective is also worst-case oriented. So the optimal solu-\ntion is the least worst for all possible uncertain data realization.\n\nBy itself, the robust optimization methodology presented above can\nbe applied to every uncertain optimization problem where one can\nseparate numerical data (that can be partly uncertain) from the\nstructure of a problem (that is known in advance and common for\nall instances of the uncertain problem).\n\nIn robust optimization, an uncertain optimization problem is\ndefined as a collection \\{ \\mathrm{m}\\mathrm{a}\\mathrm{x}\\bfitx \\{ f(\\bfitx , \\bfitw ) : gi(\\bfitx , \\bfitw ) \\leq 0,\\forall i\\} : \\bfitw \\in \\scrW \\} \nof optimization problems of a common structure with data (\\bfitw ) vary-\ning in a given uncertainty set \\scrW , with its characteristics given by\nA.1. The solution of this collection of problems should be a fixed vec-\ntor that must remain feasible for all constraints, regardless of which\nvalues reveal later as real for (\\bfitw ), given only the values are within\n\\scrW . Thus, A.2 and A.3 will hold. In order to assure that the objective\nis worst-case oriented (A.4), it is sufficient to evaluate, within the\nrobust feasible solutions \\bfitx , its smallest value \\mathrm{i}\\mathrm{n}\\mathrm{f}\\{ f(\\bfitx , \\bfitw ) : \\bfitw \\in \\scrW \\} \nover all realizations of the data from the uncertainty set. Thus, the\nbest possible robust feasible solution is the one that solves the opti-\nmization problem,\n\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\n\\bfitx \n\n\\biggl\\{ \n\\mathrm{i}\\mathrm{n}\\mathrm{f}\n\n\\bfitw \\in \\scrW \nf(\\bfitx , \\bfitw ) : gi(\\bfitx , \\bfitw ) \\leq 0,\\forall i, \\forall \\bfitw \\in \\scrW \n\n\\biggr\\} \n,\n\nor, which is equivalent, by epigraph reformulation, to the optimiza-\ntion problem,\n\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\n\\bfitx ,t\n\\{ t : t - f(\\bfitx , \\bfitw ) \\leq 0, gi(\\bfitx , \\bfitw ) \\leq 0,\\forall i, \\forall \\bfitw \\in \\scrW \\} .\n\nThe latter problem is called the robust counterpart (RC) of the origi-\nnal uncertain optimization problem. The feasible/optimal solutions\nto the RC are called robust feasible/robust optimal solutions to the\n\n\n\n60 Chapter 2. Fundamentals\n\nuncertain problem. The robust optimization methodology, in its sim-\nplest version, proposes to associate with an uncertain problem its ro-\nbust counterpart and to use, as \u201creal life\u201d decisions, the associated\nrobust optimal solutions [17].\n\nNotice that the robust counterpart problem may have infinite\nconstraints, i.e., is a semi-infinite problem [63], and as such it looks\ncomputationally intractable. In fact, in general, the robust problem\nis intractable, however, many interesting classes of problems admit\nefficient solution and much of the literature in the 1990s and 2000s\nhas focused on specifying classes of functions gi, coupled with dif-\nferent types of uncertainty sets \\scrW , that yield tractable problems\n[62].\n\nIn their book, Ben-Tal et al. [17], split the research questions\nrelated to robust optimization in three main categories.\n\n(i) Extensions of the robust optimization paradigm. These might\nbe necessary because the assumptions A.1-A.4, which point\nto a robust counterpart of the original problem, while mean-\ningful in various applications, in some others might not be\nsuitable to reflect the relation between the problem and the\nuncertain data.\n\n(ii) Both, investigating tractability issues of robust counterparts,\nand identifying the cases where the robust counterpart of an\nuncertain problem admits a computationally tractable equiv-\nalent reformulation. This is considered the main theoretical\nchallenge in the field of robust optimization.\n\n(iii) Applications of robust optimization to specific optimization\nproblems.\n\nThe main objective of this dissertation falls exactly in Category (iii).\nInsights of the importance of the research made in Category (ii) are\ngiven in the next section. Category (i) is disregarded in this work\nand hereafter we continue using the standard assumptions stated\nearlier for the robust optimization paradigm, although extensions\nto the paradigm might provide key mathematical tools for further\ndevelopments of the present work (see Chapter 6).\n\nTo further explain the methodology offered by robust opti-\nmization and because the framework used herein for optimizing\ngas-lift oil fields is of linear programming programs, in the next sec-\ntion, the particular case of robust linear optimization is discussed.\n\n\n\n2.3. Robust optimization 61\n\n2.3.3 Robust Linear Optimization\n\nLinear programs are perhaps the most applied modeling struc-\nture in optimization problems. The canonical LP has the form,\n\nPcan : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\bfA \\bfitx \\leq \\bfb \n\\bfitx \\geq \\bfzero ,\n\n(2.1)\n\nHowever, in a general form, LPs can contain inequalities, equalities\nand box constraints as,\n\nPgen : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\bfA \\bfitx \\leq \\bfb \n\\bfE \\bfitx = \\bfe \n\n\\bfl \\leq \\bfitx \\leq \\bfu .\n\n(2.2)\n\nwhere \\bfc , \\bfl , \\bfu \\in \\BbbR n, \\bfb \\in \\BbbR m, \\bfe \\in \\BbbR p, \\bfA \\in \\BbbR m\\times n and \\bfE \\in \\BbbR p\\times n\nare data vectors and matrices, and \\bfitx \\in \\BbbR n is the vector of decision\nvariables. As commented in the previous sections, for a number of\nreasons, real-world problems might have a mixture of uncertain and\nwell-known elements in its data. The uncertain entries in the data\nmatrices and vectors of Formulation (2.2) would then render an\nuncertain LP problem,\n\n\\~Pgen : Maximize \\~\\bfc \n\\intercal \\bfitx \n\nSubject to: \\~\\bfA \\bfitx \\leq \\~\\bfb \n\\~\\bfE \\bfitx = \\~\\bfe \n\n\\~\\bfl \\leq \\bfitx \\leq \\~\\bfu ,\n\n(2.3)\n\nwhere all (\\~\\bfc , \\~\\bfb , \\~\\bfA , \\~\\bfe , \\~\\bfE ,\\~\\bfl , \\~\\bfu )5 could have uncertain data within its\nvalues. Notice that some of the data might be certain.\n\nFurther, without lost of generality, it can be assumed that the\nobjective function and the right hand side (RHS) of the inequali-\nties are not subjected to uncertainty, since Formulation (2.3) can\nalways be manipulated and these uncertain elements inserted in an\n\n5As a convention, we indicate that a matrix or vector has at least\none uncertain entry by adding a tilde (~) over it.\n\n\n\n62 Chapter 2. Fundamentals\n\naugmented matrix \\~\\bfA as,\n\n\\~Pgen : Maximize\n\\bigl[ \n\\bfzero \\intercal 1 0\n\n\\bigr] \\left[  \\bfitx t\nv\n\n\\right] \n \n\nsubject to:\n\\biggl[ \n\n\\~\\bfA \\bfzero  - \\~\\bfb \n - \\~\\bfc \\intercal 1 0\n\n\\biggr] \\left[  \\bfitx t\nv\n\n\\right] \n \\leq \\bfzero \n\n\\biggl[ \n\\~\\bfE 0 0\n\\bfzero 0 1\n\n\\biggr] \\left[  \\bfitx t\nv\n\n\\right] \n = \\biggl[ \\~\\bfe \n\n1\n\n\\biggr] \n\\~\\bfl \\leq \\bfitx \\leq \\~\\bfu \nt \\in \\BbbR ,\n\n(2.4)\n\nwhere v and t are auxiliary variables used as an artifice, only to\nremove uncertain coefficients from the RHS of the inequalities and\nfrom the objective function and move them all to the left hand side\n(LHS) of the inequality constraints. Therefore the previous model\nfor \\~Pgen can actually be seen as,\n\n\\~Pgen : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\~\\bfA \\bfitx \\leq \\bfb \n\\~\\bfE \\bfitx = \\~\\bfe \n\n\\~\\bfl \\leq \\bfitx \\leq \\~\\bfu ,\n\n(2.5)\n\nwhere now only ( \\~\\bfA , \\~\\bfe , \\~\\bfE ,\\~\\bfl , \\~\\bfu ) would have uncertain elements.\nThe strategy performed with the uncertain data structures in\n\nthe objective (\\~\\bfc ) and in the RHS of inequality constraints (\\~\\bfb ), by\ninserting them inside matrix \\~\\bfA , cannot be used with uncertain data\nstructures in equality constrains ( \\~\\bfE , \\~\\bfe ) or box constraints (\\~\\bfl , \\~\\bfu ). In\nfact, for \\~\\bfe , it is possible to get it into an augmented \\~\\bfE , in the same\nfashion that it is done with \\~\\bfb , and thus having a certain RHS \\bfe for\nequality constraints.\n\nAlthough for certain LPs it is straightforward to transform a\nmodel in the format of Formulation (2.2) into (2.1), thus including\ninformation of \\bfl , \\bfu , \\bfe , \\bfE into augmented versions of \\bfc , \\bfb , \\bfA , the\nsame is not true for uncertain LPs.\n\nThe complication with both transformations, the one of equal-\nity and the one of box constraints, is related with a general issue\nof uncertain equality constraints (the first is explicitly an uncertain\n\n\n\n2.3. Robust optimization 63\n\nequality constraint, while for the second, uncertain equalities would\nappear at the end of the transformation).\n\nLet\u2019s take the uncertain equality constraints in Formulation\n(2.5). The trouble comes from \\bfitx having to be chosen before the real\nvalues of ( \\~\\bfE , \\~\\bfe ) are observed, thus forcing the uncertain equations\nin the LHS to be a constant value. As commented by Rockafellar,\nthe more you think about it, the more you wonder whether this\neven makes sense. Consequently, for most results in optimization\nunder uncertainty, and in all the major results in robust linear op-\ntimization, equality constraints are treated as being certain. Unless,\nof course, when considering constraints on recourse actions taken\nafter the real values for \\~\\bfE are observed. But this assumption do not\nfollow the classic paradigm of robust optimization presented earlier\nand so this case is not treated here.\n\nHowever, for some real-world problems, we cannot neglect\nthat equality constraints will have uncertain data. Later in this sec-\ntion, insights of how to handle the uncertain equalities are dis-\ncussed. Those are borrowed from a remotely related area called\nRDO. Thereby, until that point, and when it is not explicitly men-\ntioned, all equality constraints are considered to be constituted of\ncertain data with the same occurring for the box constraints.\n\nFor now, by disregarding uncertain entries in matrix \\~\\bfE and\nin vectors \\~\\bfe , \\~\\bfl , \\~\\bfu , it is possible to transform Formulation (2.5) to\ninclude their information inside matrix \\~\\bfA and arrive at a canonical\nuncertain LP formulation,\n\n\\scrP : Maximize \\bfc \\intercal \\bfitx \nSubject to: \\~\\bfA \\bfitx \\leq \\bfb \n\n\\bfitx \\geq \\bfzero ,\n(2.6)\n\nwhere uncertainty is associated only with matrix \\~\\bfA and with \\scrP be-\ning the family of all LP programs (P) defined by \\bfc , \\bfb and some\nrealization of \\~\\bfA . Each program of this type is called an instance of\nthe uncertain LP program, including the broadly used program with\nnominal values \\=\\bfA \\in \\~\\bfA ,\n\n(Pnom) : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\=\\bfA \\bfitx \\leq \\bfb \n\\bfitx \\geq \\bfzero .\n\n(2.7)\n\nNow let\u2019s take the uncertain LP \\scrP in the form given in Formu-\nlation (2.6). The first step in order to establish its robust counterpart\n\n\n\n64 Chapter 2. Fundamentals\n\n(RC) formulation, which will provide the robust solution, is to de-\nfine an uncertain and bounded set \\scrU that encompasses all possible\nrealizations of uncertainty in matrix \\~\\bfA . A robust feasible solution\nto the robust counterpart of \\scrP should, by definition, satisfy all re-\nalizations of the constraints induced by the uncertainty set \\scrU , and\nthe robust optimal solution is a robust feasible solution with the\nbest possible value of the objective. Since Formulation (2.6) has a\ncertain objective function, its RC is simply defined to be the opti-\nmization problem,\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\~\\bfA \\bfitx \\leq \\bfb , \\forall \\~\\bfA \\in \\scrU \n\\bfitx \\geq \\bfzero .\n\n(2.8)\n\nBefore going any further, let\u2019s depict some of the concepts de-\nvelop heretofore. Figure 2.5 illustrates the nominal instance (Pnom)\nof an uncertain LP with a decision vector \\bfitx \\in \\BbbR 2, five constraints\nand a linear objective given by \\bfc . The yellow area F(Pnom) represents\nthe feasible region of the nominal instance and \\bfitx  \\star \n\n(Pnom)\nis the optimal\n\ndecision vector.\nIn Figure 2.6 the limit points of the feasible region (dashed\n\nline) and optimal solution \\bfitx  \\star \n(Pnom)\n\nof the nominal instance (Pnom)\nare kept the same as in Figure 2.5. An uncertain LP, associated with\n(Pnom), \\scrP , is added to Figure 2.6. \\scrP has four of the five constraints\nhaving uncertain parameters taking their values from the convex\nand closed uncertainty set \\scrU . Note that the uncertain problem is\nin reality an infinite set of instances (P), with the same form of\n(Pnom), each taking a different set of parameters values from \\scrU . So\nthe hatched region F\\scrP represents the region containing the limit\npoints for all possible instances (P) induced by \\scrU . Clearly, as de-\npicted, the limit points of the nominal instance are contained in the\nregion F\\scrP . It is also evident that in this case the optimal solution\nfor the nominal instance is not optimal for other instances of the\nproblem. Most importantly, this nominal optimal solution is in fact\ninfeasible for many realizations of the data in the uncertainty set\n\\scrU . Finally, the khaki region F\\scrU has the set of robust feasible solu-\ntions, where solutions are always feasible, regardless of the values\nassumed by the constraint matrix \\~\\bfA . \\bfitx  \\star P\\scrU is the robust optimal solu-\ntion for this uncertain problem.\n\nIt is not at all clear when Formulation (2.8) is efficiently solv-\nable, since as written P\\scrU may have infinitely many constraints. How-\never, despite the robust problem normally being intractable, depend-\n\n\n\n2.3. Robust optimization 65\n\n1\n\n2\n\n3\n\n4\n\nx1\n\n1 2 3 4 5 x2\n\nF(Pnom)\n\n\\bfc \\bfitx  \\star \n(Pnom)\n\nFigure 2.5: Instance (P) of an uncertain LP with nominal data.\n\ning on the geometries of the uncertainty set \\scrU it is possible to lead\nP\\scrU to an explicit robust counterpart of nice analytical structure and\nwhich can be solved by high-performance optimization algorithms.\n\nUncertainty models\n\nThe uncertainty set models investigated in the literature can\nbe classified in two frameworks which are referred as column-wise\nuncertainty models and row-wise (a.k.a. constraint-wise) uncertainty\nmodels.\n\nColumn-wise uncertainty was first considered by Soyster. In\nthis model each column \\~\\bfa j of the constraint matrix \\~\\bfA \\in \\BbbR m\\times n\nis only known to belong to a given subset \\scrU j \\subset \\BbbR m (uncertainty\nset). If \\scrU j is a singleton, then the parameters associated with the\ncorresponding decision variable xj has no uncertainty. The robust\n\n\n\n66 Chapter 2. Fundamentals\n\n1\n\n2\n\n3\n\n4\n\nx1\n\n1 2 3 4 5 x2\n\nF\\scrP \n\nF\\scrU \n\nF(Pnom)\n\n\\bfc \\bfitx  \\star \n(Pnom)\n\n\\bfitx  \\star P\\scrU \n\nFigure 2.6: Uncertain LP, nominal instance and robust counterpart.\n\ncounterpart would then be,\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to:\nn\\sum \n\nj=1\n\nxj\\~\\bfa j \\leq \\bfb , \\forall (\\~\\bfa j \\in \\scrU j, j = 1, . . . , n)\n\n\\bfitx \\geq \\bfzero .\n\n(2.9)\n\nAs it is shown in [57], solving Formulation (2.9) is equivalent to\nsolve an ordinary LP in the form,\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\bfA \\ast \\bfitx \\leq \\bfb \n\\bfitx \\geq \\bfzero .\n\n(2.10)\n\nwhere each entry a\\ast ij = \\mathrm{s}\\mathrm{u}\\mathrm{p}\\~\\bfa j\\in \\scrU j (\\~\\bfa j)i, since from Formulation (2.9)\nwe are restricting all variables to be nonnegative. For negative vari-\nables, it would be the case to get the infimum of the parameters.\nNote that this supremum values can be efficiently determined if the\nuncertainty set \\scrU j is either closed convex or of finite cardinality. As\n\n\n\n2.3. Robust optimization 67\n\nobserved by many authors, column-wise uncertainty models lead\nto extremely conservative solutions. Each constraint of the robust\ncounterpart (2.10) corresponds to the case when every coefficient\nin the uncertain constraint matrix assumes its worst-case value at\nthe same time, regardless the geometry of \\scrU j.\n\nOn the other hand, row-wise uncertainty has received atten-\ntion only in more recent decades. In this class of models, a vector \\~\\bfa i\nrepresents the parameters of the i\\mathrm{t}\\mathrm{h} constraint of matrix \\~\\bfA \\in \\BbbR m\\times n\nand takes its values in the uncertainty set \\scrU i \\subset \\BbbR n. For a row-wise\nuncertainty model the RC is,\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\~\\bfa \\intercal i \\bfitx \\leq bi, \\forall \\~\\bfa i \\in \\scrU i, i = 1, . . . , m\n\\bfitx \\geq \\bfzero .\n\n(2.11)\n\nIntuitively, \\~\\bfa \\intercal i \\bfitx \\leq bi, \\forall \\~\\bfa i \\in \\scrU i, if and only if, \\mathrm{m}\\mathrm{a}\\mathrm{x}\\{ \\~\\bfa i\\in \\scrU i\\} \\~\\bfa \n\\intercal \n\ni \\bfitx \\leq bi.\nThose are called subproblems and their underlying structure deter-\nmine the complexity for solving the robust counterpart formulation,\nwhich now has the general form,\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\mathrm{m}\\mathrm{a}\\mathrm{x}\n\\{ \\~\\bfa i\\in \\scrU i\\} \n\n\\~\\bfa \\intercal i \\bfitx \\leq bi, \\forall i\n\n\\bfitx \\geq \\bfzero .\n\n(2.12)\n\nNotice that this formulation differs significantly from the re-\nsults of Soyster. The equivalence between (2.9) and (2.10) is par-\nticular to column-wise uncertainty and do not hold for row-wise\nuncertainty. In fact, typically, the RC of the problem with row-wise\nuncertainty is not an LP program and will depend on the geometry\nof \\scrU i. Row-wise uncertainty is a more general case of uncertainty\nset than column-wise uncertainty, in the sense that with the former\nthe RC is capable to reflect the fact that regularly the elements of\nthe constraints cannot be simultaneously at their worst values.\n\nFollowing the robust counterpart, Problem (2.12), is reformu-\nlated for three different uncertainty set geometries: box, polyhedral\nand ellipsoidal uncertainty.\n\nBox Uncertainty: A box uncertainty set \\scrU i of a particular row i\ncan be defined as the Cartesian product of the intervals of validity\nfor all coefficients \\~aij in that row. With each entry \\~aij being mod-\neled as a bounded random variable that takes values in a interval\n\n\n\n68 Chapter 2. Fundamentals\n\n[a\\mathrm{l}ij, a\n\\mathrm{u}\nij] defined by its upper and lower bounds (where for the cer-\n\ntain parameters a\\mathrm{l}ij = a\n\\mathrm{u}\nij), the RC (2.12) becomes,\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to:\nn\\sum \n\nj=1\n\na\\mathrm{u}ijxj \\leq bi, \\forall i\n\n\\bfitx \\geq \\bfzero .\n\n(2.13)\n\nWhich is an LP program, with the same size of the original uncer-\ntain problem. Notice that boxed row-wise uncertainty set produce\nequivalent robust results as convex closed column-wise uncertainty\nsets.\n\nPolyhedral Uncertainty: An uncertainty set with polyhedral ge-\nometry encloses the possible values of uncertain vector of coeffi-\ncients \\~\\bfa i in row i to \\scrU i = \\{ \\bfa i : \\bfD i\\bfa i \\leq \\bfd i\\} . The robust counterpart\ncan be written as,\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\mathrm{m}\\mathrm{a}\\mathrm{x}\n\\{ \\bfD i\\bfa i\\leq \\bfd i\\} \n\n\\bfa \\intercal i \\bfitx \\leq bi, \\forall i\n\n\\bfitx \\geq \\bfzero .\n\n(2.14)\n\nObserve that \\bfitx is not a variable of optimization in the internal op-\ntimization problems, so the dual of the subproblem for each con-\nstraint i is,\n\n\\mathrm{m}\\mathrm{a}\\mathrm{x} \\bfa \\intercal i \\bfitx \n\ns.t. \\bfD i\\bfa i \\leq \\bfd i\n\\Leftarrow \\Rightarrow \n\n\\mathrm{m}\\mathrm{i}\\mathrm{n} \\bfd \\intercal i \\bfitp i\n\ns.t. \\bfD \\intercal i \\bfitp i = \\bfitx \n\\bfitp i \\geq 0\n\nand therefore, as presented by Bertsimas et al. [18], the robust coun-\nterpart (2.14) can be rewritten as,\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\bfd \\intercal i \\bfitp i \\leq bi, \\forall i\n\\bfD \\intercal i \\bfitp i = \\bfitx , \\forall i\n\\bfitp \\geq \\bfzero \n\\bfitx \\geq \\bfzero ,\n\n(2.15)\n\n\n\n2.3. Robust optimization 69\n\nwhere \\bfitx and \\bfitp are, respectively, the vector of primal and dual vari-\nables, and (\\bfD i, \\bfd i) define the uncertain polyhedron of the param-\neters in row i. Although the size of such problems grows polyno-\nmially in size of the nominal problem and the dimensions of the\nuncertainty set, the robust counterpart remains a LP problem.\n\nEllipsoidal Uncertainty: In the late 90s, Ben-Tal and Nemirovski\n[15, 16], and El Ghaoui and Lebret [59, 60] proposed the use of\nellipsoidal uncertainty sets. Those works were a significant step for-\nward for developing a more complete theory for robust optimiza-\ntion. The ellipsoidal geometry enables flexibility in modeling the\nrelationship between the uncertain parameters, and so it allows to\nremove the most unlikely outcomes from consideration. Also, con-\ntrolling the size of the ellipsoidal sets can be interpreted as tun-\nning the trade off between robustness and performance. A draw-\nback of modeling \\scrU i as an ellipsoidal set is the increased complexity\nof the resulting problem. For example, for a given \\scrU i = \\{ \\bfa i : \\bfa i =\n\\=\\bfa i + Qi\\bfitv i, with | | \\bfitv i| | 2 \\leq \\rho i\\} , where \\=\\bfa i denotes the nominal value\nfor parameters in row i, \\rho i the ellipsoids radius, and Qi is a positive\ndefinite matrix defining the shape of the ellipsoid, the RC turns into\na second-order cone programming (SOCP) problem in the form,\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\=\\bfa \\intercal i \\bfitx + \\rho i| | Q\n\\intercal \n\ni \\bfitx | | 2 \\leq bi, \\forall i\n\\bfitx \\geq \\bfzero .\n\n(2.16)\n\nAlthough more demanding computationally than LP models, this\nnonlinear, but convex, model can be solved efficiently by interior-\npoint methods [15, 18].\n\nThe three uncertainty model geometries presented above are\nperhaps the most used ones in robust linear optimization, but they\nare not the only ones that lead to tractable versions of the robust\ncounterpart problem. Other examples are, norm uncertainty and\ncardinality constrained uncertainty sets [64]. For further informa-\ntion, Bertsimas et al. [18] provide a compact overview of the current\nstate-of-the-art for robust optimization (linear and convex) with re-\nspect to tractability issues.\n\nAdditional Remarks\n\nThe theory of robust linear optimization presented through-\nout this section relates to the problem statement itself, specially to\n\n\n\n70 Chapter 2. Fundamentals\n\nshow how uncertainty models play a key role in designing a solvable\nrobust version of the nominal/uncertain problem. This is by far the\nmain concern of the field. However, there are other specific aspects\nof robust problems that are relevant to our application. Below, three\nimportant aspects to linear robust optimization are considered. The\nfirst one relates to duality in robust problems. The second is on how\nuncertain equality constraints could be handle in robust optimiza-\ntion. Finally, the third is on the extensions of the above theory to\nMixed-Integer Linear Programming (MILP) problems.\n\nDuality: From the two frameworks of uncertainty set models pre-\nsented, column-wise and row-wise, the former is at least as con-\nservative as the latter, regardless the geometry proposed for the\nuncertainty set. As a result of the lack of modeling flexibility and\nthe overly conservative solutions produced by column-wise models,\nfrequently row-wise uncertainty models are preferred. Nevertheless,\nsome problems have its parameters intrinsically related in a column-\nwise fashion. For those problems, a first reasonable idea would be\nto use duality theory to generate the dual of the column-wise un-\ncertain linear problem, which would be a row-wise uncertain linear\nprogram \u2013 assuming, of course, the same uncertainty model for the\ncolumns of the given linear program and for the corresponding rows\nin the dual [65],\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to:\nn\\sum \n\nj=1\n\nxj\\~\\bfa j \\leq \\bfb , \\forall \\~\\bfa j \\in \\scrU j, \\forall j\n\n\\bfitx \\geq \\bfzero \n\n\\Updownarrow \n\nD\\scrU : Minimize \\bfb \n\\intercal \\bfity \n\nSubject to:  - \\~\\bfa \\intercal j\\bfity \\leq  - cj, \\forall \\~\\bfa j \\in \\scrU j, \\forall j\n\\bfity \\geq \\bfzero .\n\nThe problem is that, even though D\\scrU being a row-wise uncertain LP\nas (2.11), strong duality, in general, does not hold for uncertain LPs.\nThat is intuitive, since the primal and dual problems are seeking for\na robust solution, both are paying a price for uncertainty that will\n\n\n\n2.3. Robust optimization 71\n\nreflect in their objective value. I.e., in maximizing the primal, its ro-\nbust optimal solution value will be (in general) less than the primal\n\u201cnominal\u201d optimal solution value (for the LP instance with nominal\ndata), and in minimizing the dual, the solution will be larger when\ncompared to the nominal dual solution; so a gap will exist.\n\nThus, there is no advantage in converting column-wise to\nrow-wise uncertain problems in order to solve robust linear opti-\nmization problems, as the solutions of the primal and dual are not\nequivalent [65].\n\nEquality constraints: It has been pointed out that uncertain equal-\nity constraints are in general problematic, and therefore they have\nbeing considered certain for the results presented so far (in accor-\ndance with the main results in robust linear optimization). Still, one\ncannot ignore the fact that uncertain equality constraints can occur\nin optimization problems.\n\nIn order to increment the robust optimization methodology\npresented earlier in this section to account for uncertain equalities,\nwe address their issues using some of the insights mentioned in\nSection 2.3.1. Those insights were taken mainly from [49, 66] and\nthe references therein, which focus on a distinct area of robust op-\ntimization called robust design optimization (RDO). Rangavajhala\nand Messac [66] consider three prevailing equality constraint for-\nmulation approaches in the literature of RDO:\n\n(1) equality constraint relaxation approach\n\n(2) satisfying the equality constraint at its mean value\n\n(3) elimination of the equality constraint through substitution.\n\nBased on some of those ideas we enhance the robust linear\noptimization methodology presented here by adding the following\nsteps:\n\n(i) Whenever possible, the first step in finding a RC should be to\neliminate uncertain \u201cstate equations\u201d (which are equality con-\nstraints) by the substitution of the corresponding \u201cstate vari-\nables\u201d into inequality constraints or the objective function. An\n\n\n\n72 Chapter 2. Fundamentals\n\nexample of this procedure is given below.\n\n\\mathrm{m}\\mathrm{a}\\mathrm{x} c2x2\n\ns.t. \\~a11x1 + a12x2 \\leq b1\n\\~e11x1 + x2 = e1\n\nx1, x2 \\geq 0\n\n\\Leftarrow \\Rightarrow \n\n\\mathrm{m}\\mathrm{a}\\mathrm{x} ( - \\~e11c2)x1\ns.t. (\\~a11  - a12\\~e11)x1 \\leq . . .\n\n. . . (b1  - a12e1)\nx1 \\geq 0\n\n(ii) For the uncertain equality constraint that cannot be eliminated\n(usually, e.g., physics-based constraints as mass balance equa-\ntions), we propose to relax the constraint by replacing it by\ntwo inequalities that keep the original constraint satisfied to\nthe maximum extent possible. Therefore, for a give uncertain\nLP that has passed through step (i) and has the format,\n\n\\~Pgen : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\~\\bfA \\bfitx \\leq \\bfb \n\\~\\bfE \\bfitx = \\bfe \n\n\\bfitx \\geq \\bfzero ,\n\n(2.17)\n\nusing the equality relaxation approach the uncertain problem\nwill have the form,\n\n\\~Pgen : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\~\\bfA \\bfitx \\leq \\bfb \\biggl[ \n\\~\\bfE \n\n - \\~\\bfE \n\n\\biggr] \n\\bfitx \\geq \n\n\\biggl[ \n\\bfe \n - \\bfe \n\n\\biggr] \n\\bfitx \\geq \\bfzero ,\n\n(2.18)\n\nThen the robust counterpart of Formulation (2.18) can be pro-\nduced using any of the theory presented up to here.\n\nFigure 2.7 illustrates the concept of equality relaxation. F\\bfE = is the\nfeasible region for a certain equality constrain (e.g. with nominal\nvalues for \\bfE ). The intersection of regions F\\~\\bfE \\geq and F - \\~\\bfE \\geq is the\nfeasible region of a relaxed uncertain equality constraint given by\n\\~\\bfE = \\bfe . Remember that certain equality constraints can instead be\nconverted to two inequalities and be added to matrix \\~\\bfA .\n\nInteger variables: The robust optimization paradigm set in Sec-\ntion 2.3.2 and 2.3.3 has no restriction in considering part of the de-\ncisions variables to be integer. Thus, it is possible to apply the robust\n\n\n\n2.3. Robust optimization 73\n\n1\n\n2\n\n3\n\n4\n\nx1\n\n1 2 3 4 5 x2\n\nF - \\~\\bfE \\geq \n\nF\\~\\bfE \\geq \n\nF\\bfE =\n\nFigure 2.7: Uncertain equality constraint relaxation.\n\noptimization methodology to an uncertain MILP and render a ro-\nbust counterpart of the problem. However, tractability issues arising\nfrom uncertain linear optimization and uncertain mixed-integer lin-\near optimization problems need quite different approaches [17]. For\nexample, the resulting robust formulations involving conic quadratic\nproblems, when data vary in ellipsoidal sets, cannot be directly ap-\nplied to discrete optimization [67].\n\nKouvelis and Yu [61] propose a framework specific for dis-\ncrete optimization problems, which uses a set of possible scenarios\nfor the data instead of continuous uncertainty sets. Under their ap-\nproach, the RC to a number of polynomially solvable discrete opti-\nmization problems becomes NP-hard. Averbakh [68], in considering\ninterval representation for uncertain data (the same idea as in the\npreviously referred box uncertainty), show that polynomial solvabil-\nity is preserved.\n\nIn a framework similar to the one used in Section 2.3.3, Bert-\nsimas and Sim [67] present for cardinality constrained uncertainty\nsets that the robust counterpart of an uncertain MILP problem is\nstill tractable. Since box uncertainty set are a special case of cardi-\n\n\n\n74 Chapter 2. Fundamentals\n\nnality constrained uncertainty sets, the results in [67] can promptly\nbe extended to a box uncertainty model. Thus, the robust formula-\ntion (2.13) is tractable, even when coming from an uncertain MILP\nproblem.\n\nFor further developments on robust discrete optimization see\n[69] and the references therein.\n\n2.4 SUMMARY\n\nThis chapter brought in an overview of fundamental topics\nrelated to the core work of this dissertation. First, the oil and gas\nindustry was briefly presented, followed by basic concepts from\npetroleum engineering that are required for understanding the pro-\nduction system \u2013 i.e. gas-lift, which is used as our object of study.\nThen the production optimization problem was situated within the\nentire operation of an oil field, and a literature review of classi-\ncal approaches for production optimization of gas lifted oil fields is\nmade. The second part was a compact description of modeling op-\ntimization problems using mathematical programming and on the\nmeans chosen for solving the numerical experiments of this disser-\ntation. The final part, starts with a discussion of uncertainty in opti-\nmization problems and on modeling decisions that one has to face\nwhen dealing with uncertain optimization problems. Then the clas-\nsic paradigm of robust optimization is introduced. Finally, a com-\npilation of some of the main results in the area of robust linear\noptimization is presented, along with some important remarks that\nrelates with the work that is developed in the following chapters of\nthis dissertation.\n\n\n\n3 ROBUST PRODUCTION OPTIMIZATION METHODOLOGY\n\nThis chapter details the steps required to design robust opti-\nmization models. It starts describing how uncertainty appears in oil\nproduction systems. Then it analyzes the effects of uncertainty in\na simplified production optimization problem. Finally it presents a\nmethodology to design a robust production optimization model to\nthis simplified example, which can be extended to more complex\nproduction systems.\n\n3.1 UNCERTAINTY IN OIL PRODUCTION SYSTEMS\n\nProduction systems in the context of oil and gas fields include\nall elements from the reservoir interface to the export lines. The pro-\nduction itself is a mass flow mixture of hydrocarbon with different\nmolecular weights, as well as water, sand, H2S, CO2 and possibly\nother components. The production in a production system travels\nas a multiphase flow from the reservoir to the well inlet, then from\nthe bottomhole through the production tubing and flow lines un-\ntil it reaches the processing facilities for separation and later to be\nstored or exported, as illustrated in Figure 3.1. In order to enable\nor enhance the potential hydrocarbon recovery from the reservoir,\nimproved recovery methods as waterflooding can be used. On the\nother hand, artificial lift methods, as gas-lift systems, can be em-\nployed to allow a greater use of this reservoir potential, by artifi-\ncially increasing the pressure difference in the reservoir-wellbore\ninterface.\n\nAn operative oilfield requires the integrated operation of sev-\neral areas. Operational and strategical decisions from different sub-\nsystems and in different planning horizons impact each other. Due\nto the high complexity of the entire integrated operation, it has\nbeen suggested a hierarchical division of the decisions [2]. Those\nare grouped in layers according to their \u201ctime constant\u201d as depicted\nin Figure 2.4. In this way the problem of each layer can be solved in-\ndependently, although a higher level typically specifies constraints\non a lower level to link these problems.\n\nHere we are interested in the short-term production optimiza-\ntion layer. At this level the aim is to optimize the daily/weekly\nproduction. Decisions at this level are mostly semiautomatic, thus\npetroleum engineers, aided by recommendation tools, decide the\nbest operation plan according to the scenario of operation for that\nday. The objective is usually to maximize oil/gas production or some\n\n75\n\n\n\n76 Chapter 3. Robust production optimization methodology\n\nFigure 3.1: Snapshot of an operational oilfield.\n\nother specific criteria. The possible decision variables of this layer\nvary according to the different production equipment installed and\ntheir available corresponding setpoints. However, in general, the\ndecision variables include well allocation, manifold alignment, pro-\nduction choke settings, and when existent, artificial lift equipment\noperating points. In the scope of production optimization various\nfactors can restrict production. Constraints could come from down-\nhole, for example, limits on pressure drawdown to avoid formation\ndamage (skin effect), or from subsea equipment, as fluid handling\ncapacities and pressure limits in the flow lines and manifolds, or\nfrom the surface equipment capacities, as limits on compression ca-\npacity for lift gas or fluid handling capacity in separators and tanks.\nThe reservoir management layer (see Figure 2.4) can also establish\nconstraints to the production optimization layer, e.g. production tar-\ngets.\n\nA production model that predicts the effects of the decision\nvariables on the production is required to perform a production opti-\nmization. Usually production optimization uses steady-state models\nof the production system. These models are generally based on mul-\ntiphase flow simulators, either by querying the simulator directly or\n\n\n\n3.1. Uncertainty in oil production systems 77\n\nby using simulator data and fitting proxy-models with them. Simula-\ntors use physical equations and empirical relationships (derived in\nlaboratories), to establish the relation between decision variables\nand production. The simulator models normally include many pa-\nrameters. Some of these parameters are well established physical\nproperties that tend not to vary in time, as pipeline dimensions, that\nare accurately and easily available from the installation projects.\nOther parameters are measurements from the production system,\nwhich may or may not have an easy/costless availability. For some\nother parameters it is required to perform laboratory experiments\nor to use the experience in the field to find values that make the\nmodel fit the production data. System identification is also an alter-\nnative to models based on simulators, though this also rely on data\nthat might not be promptly and frequently available to update the\nmodels.\n\nElgs\u00e6ter et al. [11] suggest three reasons why production\nmodels may not describe production accurately.\n\n\\bullet One reason is model related, in which the underlying structure\nof the model is insufficient to predict correctly the production.\nFor instance, unmodeled disturbances which may significantly\ninfluence production but are not accounted for.\n\n\\bullet A second reason may be measurement uncertainty, since any\nmodel to some extent relies on measured data. The causes for\nthis type of uncertainty are many. For example, measurements\nare susceptible to incorrect calibration of measurement equip-\nment. An even more common cause are errors originated in\nindirect measurements, estimates of physical quantity. For in-\nstance, measurements of total produced single oil and gas rate\nphases might be available, however total water rates might\nonly be estimated by adding different measured water rates\nafter separation and processing.\n\n\\bullet A third reason may be the lack of informative data. Which\ncould be in the sense that the data used to determine the pa-\nrameters might be outdated, e.g., due to the costs and risks\ninvolved to perform some tests and measurements. Though, it\ncould also be in the sense that the data may have insufficient\nexcitation to uniquely determine the parameters of the model.\nThe latter is a fairly common situation since, for example, to\ndetermine the rates of oil, gas and water produced from indi-\nvidual wells, the production of a single well is usually routed\n\n\n\n78 Chapter 3. Robust production optimization methodology\n\nto a dedicated test separator where the rate of each separated\ncomponent is measured. Since it is not always possible to per-\nform multi-rate tests a well may operate in a condition differ-\nent from the one which it was tested.\n\nBieker et al. [34] also pointed out two important issues with\nthe models that are somehow related to these three later reasons for\nmodel inaccuracy. One of the issues is that models for production\noptimization are mostly pure steady-state, but, although reservoir\nchanges caused by the drainage process occur in a time constant\nthat can be ignored for this optimization, there are usually other\ntransients happening during normal operation and their effects may\nhave a significant impact on the capacity of the model to predict\nthe production. The other issue is in line with the first. For using\ntransient data to determine parameters for a steady-state model can\nresult in erroneous parameter values. In practice all of those factors\nare usually present to some extent.\n\nThe standard approaches to production optimization (Sec-\ntion 2.1.4.1) simply disregard all the uncertainty mentioned above\n\u2013 which reflects in models inaccuracy, and considers nominal mod-\nels, namely the production models that reflect the average observed\nbehavior. However, for optimization problems, such approach may\nrender the solution suboptimal and even infeasible when the actual\nmodels deviate significantly from the nominal conditions [16]. In\nfact, in a technological survey of 2007 [34] the authors state that\nthe handling of model uncertainty is a key challenge for the success\nof production optimization. The challenge is actually twofold. The\nfirst relates to the need to identify and characterize the uncertain-\nties in a production system, to have a model for them. The second\none is the design of production optimization models that somehow\ncan handle the uncertainties. Both issues have their importance and\ndefinitely the latter is highly dependent to the former.\n\nIn the context of the reservoir management layer (see Fig-\nure 2.4) modeling and incorporating uncertainty to the problem\nhas received an increased attention in the last decade. The inter-\nested reader can refer to [70, 71, 72] and the references therein to\nlearn more about the recent activities.\n\nYet, uncertainty in production optimization has received less\nattention. Here is a non-exhaustive list of works that to some extent\ntry to model uncertainty or to consider uncertainty in the produc-\ntion optimization problem.\n\nElgs\u00e6ter et al. [11] discussed the estimation of uncertainty\n\n\n\n3.1. Uncertainty in oil production systems 79\n\nin production optimization resulting from fitting models to produc-\ntion data with low information content. It also showed how system\nidentification could be used to design models for production opti-\nmization based on production data. However they do not develop\nan approach to handle uncertainty in itself.\n\nCamponogara and Nakashima [73] proposed dynamic pro-\ngramming algorithms to solve the problem of distributing a limited\nrate of lift-gas. Their formulation introduced precedence constraints\non the activation of the wells and allows multiple WPC for one well\nto encompass uncertainty in these curves. It solves a max-min prob-\nlem. An advantage of dynamic programming is the achievement of\na family of solutions covering the whole range of lift-gas injection\nbut it is difficult to add constraints to this problem.\n\nBieker et al. [13] dealt with uncertainty by formulating an\noptimization problem based on a priority list. They proposed to use\ninformation about the uncertainties of the gas or water oil ratios\nto find the order of opening and closing the wells to maximize the\nexpected total oil production rate from the wells.\n\nElgs\u00e6ter et al. [14] proposed an iterative approach to access\nthe results of optimization in an uncertain scenario. Thus, uncer-\ntainty is not handled in the optimization problem, but in a post-\noptimization stage.\n\nAs a preliminary result of the work developed during this dis-\nsertation, H\u00fclse and Camponogara [74] proposed an strategy of\nenvelope curves to encapsulate the uncertainty of the production\ncurves, and produce a robust solution for production optimization\nproblem. Uncertainty is modeled as a range and as non-probabilistic.\nThis strategy turned out to be in line with the results obtained by\nSoyster [57] for robust optimization.\n\nThere are not many works considering uncertainty for short-\nterm production optimization, but model uncertainty is inherent\nto production systems. This leaves open for investigation the two\nchallenges mentioned earlier: uncertainty identification/modeling\nand optimization models that can incorporate uncertain production\nmodels.\n\nIn this dissertation we focus on the latter issue and take for\ngranted that the uncertainties can be identified and modeled. How-\never, it is important to have a brief discussion on the former issue,\nsince both are closely related. In this work, instead of considering\nthat uncertainty has a stochastic model with a probabilistic descrip-\ntion, which could be given or estimated, we assume that uncertainty\nhas a simpler model, a set-based one (range model), with an unde-\n\n\n\n80 Chapter 3. Robust production optimization methodology\n\nfined probabilistic distribution. Ben-Tal et al. [17] point out some\nadvantages for this approach:\n\n\\bullet More often than not, there are no reasons to assign a stochas-\ntic nature to the uncertainty.\n\n\\bullet Even when perturbations can be considered as stochastic, it\nmight be difficult to specify reliably data distribution.\n\nWe do agree that the first point might not always be true in the\ncontext of production optimization, but the second fits for most sit-\nuations. Anyway, here it is important to make two notes. Although\nintuitively range modeling requires a least sophisticated uncertainty\nquantification system than stochastic modeling, which, by the way,\ncould be a practical benefit for this approach, implying in an eas-\nier creation, maintenance, and usage of the uncertainty models, we\nunderstand that even coming up with meaningful ranges for the un-\ncertain parameters may be a complex task. In the same line, it is\nnatural that when a perturbation has a stochastic nature, and it is\nprovided with a relevant stochastic definition, its much more infor-\nmative description has the potential to produce a less conservative\nand more practical decision \u2013 if associated with a corresponding\nstochastic production optimization model.\n\nAs previously stated, our main objective is to design a produc-\ntion optimization methodology that accounts for uncertainties in\nthe production model and thus generates a solution that has robust-\nness against parameters perturbation. The present work follows the\nRobust Optimization paradigm to address parameter uncertainty in\nan optimization problem. This approach assumes that the uncer-\ntainty model is set-based instead of stochastic. Also, it constructs a\nsolution that is optimal and immune to any realization of the uncer-\ntainty in a given set, but in a deterministic rather than a probabilis-\ntic sense [18].\n\nIn the next section we develop the idea behind this paradigm\nwhen applied to an oilfield production problem. More specifically,\nwe choose typical continuous gas-lifted oilfield schemes to analyze\nthe proposed methodology.\n\n3.2 UNCERTAIN PRODUCTION OPTIMIZATION MODELS\n\nContinuous gas-lift, or just gas-lift, is an artificial lift system\nwhere a controlled stream of compressed gas is injected in the well\n\n\n\n3.2. Uncertain production optimization models 81\n\nannulus. From there, it enters the production tubing through gas-\nlift valves, where it mixes with the reservoir fluids reducing the fluid\ndensity, thus enabling or enhancing the well production to reach the\nsurface facilities (Figure 2.2). Different gas-lift producing system\nlayouts exist, but all of them share most of these features:\n\n\\bullet a lift gas compression system, which has a compression capac-\nity.\n\n\\bullet a gas-lift manifold, where gas-lift chokes are used to control\nthe gas flow rate to individual wells;\n\n\\bullet gas-lift manifolds and valves, which allow the gas enter the\nproduction tubing;\n\n\\bullet a production choke in the wellhead to control the well head\nflowing pressure;\n\n\\bullet flow lines to drive the production to the surface facilities. The\npipelines may have fluid handling capacities;\n\n\\bullet a well might have its production drained through an exclusive\nflow line (named satellite or platform well) or its production\nmight pass first to subsea manifolds which are used to gather\nand route the production of different wells before it reaches\nthe platform; manifolds pressure limits may apply;\n\n\\bullet one or more separation facility to which production can be\nrouted. They do not only separate the gas to be treated and\nsent for recompression, but they also separate the oil from the\nwater and contaminants. Liquid handling limits apply to the\nequipment.\n\nIn order to introduce the proposed robust production opti-\nmization methodology and examine it step by step, we consider a\nsimplified gas-lift scheme, a toy example, but one that is representa-\ntive enough to our purpose. It consists of a single platform well that\nproduce a stream of gas, oil and water to a single multiphase sep-\narator. Production is enhanced by a gas-lift system, where a choke\nvalve can control the gas injection rate for this well. The production\nchoke valve is considered to be always fully opened, thus not being\na decision variable.\n\n\n\n82 Chapter 3. Robust production optimization methodology\n\n3.2.1 Nominal MINLP production problem\n\nAssuming a nominal production model \u2013 e.g., one based on\nexpected parameters values \u2013 the production optimization prob-\nlem can be viewed as solving a conceptual MINLP problem, in the\nsense that well-production functions, a.k.a well performance curves\n(WPCs)s, are not explicitly available. Here, for simplicity, the objec-\ntive function is considered the maximization of oil production of the\nwell. The conceptual MINLP formulation follows:\n\nP : \\mathrm{m}\\mathrm{a}\\mathrm{x} \\widehat f = qoil (3.1a)\n\\mathrm{s}.\\mathrm{t}. : qinj \\leq Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj (3.1b)\n\nqr = \\widehat qr(qinj, G) \\cdot y,\\forall r \\in \\scrR (3.1c)\nqinj \\geq y \\cdot q\\mathrm{m}\\mathrm{i}\\mathrm{n}inj (3.1d)\nqinj \\leq y \\cdot q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj (3.1e)\nqSr \\leq q\n\nS,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nr , \\forall r \\in \\scrR (3.1f)\n\nqSr = qr, \\forall r \\in \\scrR  - \\{ gas\\} (3.1g)\nqSgas = qinj + qgas (3.1h)\n\ny \\in \\{ 0, 1\\} (3.1i)\n\nThe decision variables of the formulation are:\n\n\\bullet qninj is the rate of lift-gas injection into the well n;\n\n\\bullet qr is the rate of phase r produced according with the concep-\ntual production function \\widehat qr of the well;\n\\bullet qSr is the total flow of phase r received by the separator;\n\n\\bullet y \\in \\{ 0, 1\\} is a well allocation variable. It takes 1 when well is\nactive or else 0;\n\nNotice that qr and qSr are not actual decision variables. They are\nonly used to define a given flow rate. Although the term is not pre-\ncise to define this type of variable, heretofore we refer to them as\nstate variables, in the sense that they are just used to describe the\nmathematical \u201cstate\u201d of the system. The parameters are as follows:\n\n\\bullet \\scrR = \\{ oil, gas, water\\} has the mixed-flow phases: oil, gas, and\nwater;\n\n\\bullet Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj is the available lift-gas rate;\n\n\n\n3.2. Uncertain production optimization models 83\n\n\\bullet q\\mathrm{m}\\mathrm{i}\\mathrm{n}inj is the lower bound for injection rate, established for ex-\nample, by the production engineer for flow assurance.\n\n\\bullet q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj is the upper bound for lift gas injection. It could be set,\ne.g., to avoid slugging.\n\n\\bullet q\\mathrm{m}\\mathrm{a}\\mathrm{x}oil , q\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\ngas , q\n\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\nwater are limits on oil, gas, water handling of the\n\nseparator;\n\n\\bullet G is the set of parameters and correlations that characterize\nthe well-production curves of the well. Since this is a satellite\nwell, it includes the separator inlet pressure, the pipeline in-\nside diameter (ID), vertical elevations, and horizontal length,\nthe production tubing ID, length, and trajectory, the fluid data,\nas gas-liquid ratio (GLR), WC, specific densities, and bubble\npoint pressure, the inflow performance relationship (IPR) and\nits parameters, the vertical and horizontal flow pattern corre-\nlations, to name a few.\n\nand with the functions:\n\n\\bullet \\widehat f is the total oil production from the well;\n\\bullet \\widehat qr(qinj, G) is the conceptual function that relates the flow of\n\ncomponent r produced by the well define by G with the rate\nof lift-gas injected to this well (qinj).\n\nConstraint (3.1b) represents the lift gas compression capacity for\nthe gas lift compressor. The well production as a function of the lift-\ngas injection rate is modeled by Eq. (3.1c). Limits on lift-gas injec-\ntion and separation capacities are given by constraints (3.1d)-(3.1e)\nand (3.1f), respectively. Eqs. (3.1g)-(3.1h) have the production ar-\nriving at the separation unit.\n\nNote that for simplicity the production system constraints\nare only in the availability of lift gas, limits on gas injection, and\nfluid handling capacity in the separator. However, mathematical pro-\ngramming allows to describe other possible system constraints. For\ninstance, through constraints such as,\n\nqoil + qwater \\geq y \\cdot q\\mathrm{m}\\mathrm{i}\\mathrm{n}liq (3.1j)\nqoil + qwater \\leq y \\cdot q\\mathrm{m}\\mathrm{a}\\mathrm{x}liq (3.1k)\n\nit is also possible to specify, for example, a target flow, obtained\nfrom the reservoir management layer, or a liquid flow rate limit to\navoid formation or perforations damage.\n\n\n\n84 Chapter 3. Robust production optimization methodology\n\nUncertainty in Formulation (3.1) can be viewed as affecting\nthe parameters defining the system limits and capacities \u2013 i.e., Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj ,\nand qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}r , \\forall r \\in \\scrR \u2013 and the functions defining the multiphase\nproduction.\n\n3.2.2 Uncertainties in the MINLP production problem\n\nFor uncertainty in limits and capacities, the uncertainty model\nassociated to each of the uncertain parameters is explicitly present\nin the uncertain optimization problem. However, for uncertain val-\nues coming from the well-production functions this is not all clear.\nLet\u2019s for now focus on the latter uncertainty manifestation.\n\nIn fact, here we have to make a point. The well-production\nfunctions \\widehat qr represents the real relationship between lift-gas injec-\ntion, qinj, and the production of component r, qr. We assume in this\nwork that given the \u201creal\u201d set of parameters and correlations (G), a\nmultiphase flow simulator is capable of mirroring the steady-state\nbehavior of the real well-production function. This assumption is\nnot completely unjustified. First, as it was said, there is no precise\nand explicit formulation for the real well-production function due\nto the complex fluid dynamics involved. Therefore, the only alter-\nnative other than simulation to obtain useful data for the optimiza-\ntion problem, it is to dispose of enough and constantly updated\nwell-test data (in number and in range of excitations) to then be\nfitted to a particular model. In practice, with few exceptions, this\nis an unrealistic scenario and with insufficient data, models based\non system identification would also not be a perfect representation.\nSecond, we must have a baseline production function formulation\nfor comparison. Because real data is hard to obtain in quantities\nrequired for study, we use the simulated curves as our baseline.\nThird, there are many reliable multiphase flow simulators that are\nalready widely used to aid engineering projects. So for now on,\nwe treat the functions, \\widehat qr(qinj, G), that were referencing to the real\nwell-production functions, as being the well-production curves gen-\nerated by simulation, since we consider that both are equivalent.\n\nBy using the simulated curves, one is able to analyze the im-\npact of uncertainty in the well-production function. Uncertainty in\\widehat qr(qinj, G) appears in the set of parameters and correlations G. Yet,\nnot all parameters have the same susceptibility to perturbations.\nFor instance, production tubing length and ID usually have accu-\nrate known values, and even if the ID of a tubing can decrease by\nwax deposition, this phenomenon happens in a time scale that can\n\n\n\n3.2. Uncertain production optimization models 85\n\nbe disregard for the short-term production optimization problem.\nEmpirical relations as the fluid flow correlations and the IPR that af-\nfect significantly the shape of the well-production curve, although\nuncertain in the beginning of the life of a well, over time, by cal-\nibration they tend to produce reliable representations that do not\nchange greatly in the time frame of production optimization. How-\never, there are key parameters in modeling well-production curves\nthat are susceptible to the effects of uncertainty, as: the fluid data,\nsuch as the GLR and WC, and the reservoir data such as the produc-\ntivity index (PI).\n\nIn order to get a feeling of exactly how the changes of dif-\nferent parameters affect the shape of the well-production curve, let\nus consider a hypothetical \\pm 10\\% variation from a nominal value of\nGLR, WC, and PI, individually. The effects of each parameter in the\nliquid production curve (\\widehat qliq(qinj, G)), which is the sum of \\widehat qoil and\\widehat qwater, are illustrated in Figure 3.2, where colored regions represent\ninstances of this curve depending on the possible values assumed\nby GLR, WC and PI. In Figure 3.2(a) one can observe that there are\ntwo distinct regions, one before and one after the injection point\nthat induces the maximum liquid production rate. Before this point,\n\nqliq\n\nqinj\n\n\\widehat qliq(qinj, GLRnominal)\\widehat qliq(qinj, GLR+10\\%)\\widehat qliq(qinj, GLR - 10\\%)\nGLR(0\\%,+10\\%)\nGLR( - 10\\%,0\\%)\n\n(a)\n\n\n\n86 Chapter 3. Robust production optimization methodology\n\nqliq\n\nqinj\n\n\\widehat qliq(qinj, WCnominal)\\widehat qliq(qinj, WC+10\\%)\\widehat qliq(qinj, WC - 10\\%)\nWC(0\\%,+10\\%)\nWC( - 10\\%,0\\%)\n\n(b)\n\nqliq\n\nqinj\n\n\\widehat qliq(qinj, PInominal)\\widehat qliq(qinj, PI+10\\%)\\widehat qliq(qinj, PI - 10\\%)\nPI(0\\%,+10\\%)\nPI( - 10\\%,0\\%)\n\n(c)\n\nFigure 3.2: Well production curves as functions of nominal, +10\\%,\nand  - 10\\%, GLR (top), WC (center) and PI (bottom).\n\n\n\n3.2. Uncertain production optimization models 87\n\na higher GLR is a benefit for the production, helping to elevate the\nliquid stream. However, after the point of maximum production, a\nhigher ratio of gas coming from the formation works against the\nflow of fluid, as an extra friction force. In Figure 3.1(b), for a same\ngas injection rate the production of liquid tend to be higher for\nlower water ratios, since in general water is denser than the oil.\nHowever, for some WC values this may be the other way around,\nsince water is less viscous than oil. For Figure 3.1(c), as expected, a\nhigher PI induces more liquid production for any lift gas rate.\n\nNotice that those are qualitative illustrations of the effects of\nuncertainty in the well-production function, and quantifying it is\nmuch more difficult due to the nonlinearities and conceptual aspect\nof \\widehat qr.\n3.2.3 Nominal MILP production problem\n\nNow let\u2019s focus again on the nominal MINLP production prob-\nlem (3.1). Both the simulated well-production curve and the real\nwell-production function are conceptual, since one cannot have a\nexplicit formulation for them. Thus, problem (3.1) continues to be\na conceptual MINLP regardless the assumption we made earlier re-\nplacing the real function by the simulated one. Conceptual mathe-\nmatical programming problems in general cannot be solved directly.\nApproximating these functions by fitting and validating simulated\nsample data \u2013 or even real measurements \u2013 to nonlinear models\nwould yield to an approximated MINLP formulation, but this is in\nitself a challenging problem.\n\nThis motivates the use of PWL models to represent the afore-\nmentioned relations, which arise directly from the sample data \u2013\nreal or simulated. The PWL approach leads to an MILP approxima-\ntion of the optimization problem, meaning that a solution close to\nthe global optimum may be reached considering a sufficient number\nof sample points, and using, for example, off-the-shelf and special-\nized algorithms.\n\nFigure 3.3 illustrates examples of a PWL approximation curves\nof a well-production curve. Notice that depending on the sample\npoints used as the base for the linear model, the PWL curves differ.\nFor instance, it is clear that, unless for the extremal sample points\nof gas injection (qinj), the piecewise-linear curves PWL1 and PWL2\nwould predict a distinct oil production value (qoil) for any lift gas\nrate, (see Figure 3.3). It is also clear that any piecewise-linear ap-\nproximation assumes a different function value when compared to\n\n\n\n88 Chapter 3. Robust production optimization methodology\n\nqoil\n\nqinj\n\n\\widehat qoil(qinj, G)\nPWL1\nPWL2\n\nFigure 3.3: Well-production curve and two of its possible piecewise-\nlinear approximation curves.\n\nthe original function value. This happens for any point in the do-\nmain that is not a sample point \u2013 given the original function has\nnon zero concavity in its entire domain. This means that by using\na PWL approximation for the well-production curve, model uncer-\ntainty would be introduced in the optimization problem. Well, this\nis not an exclusive issue of piecewise-linearization, since for fitting\nany proxy model to sample data would generate a model that to\nsome extent has inaccuracy in predicting the original function value.\n\nMany possible sources of uncertainty in the production mod-\nels have already been presented and this is just another one to add\nto the count. Unlike the other sources of uncertainty this one is not\nrelated to the system, but it is introduced to make the optimization\nproblem tractable. Since this is a perturbation inserted by the model\nbuilder it is intuitive to think that preventive actions that might at\nleast diminish its effects might exist. In fact, there are a few possi-\nbilities.\n\nOne that first comes to mind would be to use as many as possi-\nble/available sample points to come up with a tight piecewise-linear\n\n\n\n3.2. Uncertain production optimization models 89\n\nrepresentation. This approach has two issues. On one hand, depend-\ning on the simulation time and on the size of the problem, getting\nthe sample data may become a time consuming pre-optimization\nstep. On the other hand, for more complex optimization problems\nthe size of the PWL models could become an issue (i.e. adding to\nmany additional variables) yielding to harder to solve or even an\nunsolvable problem.\n\nA procedure to remedy the latter issue is presented by Codas\net al. [75]. It starts with the idea presented above, getting a high\nresolution piecewise-linear model, then it applies a greedy heuristic\nto reduce the number of sample points, while ensuring a maximum\nerror with respect to the tight piecewise-linear representation. The\nproblem with this approach is that it does not handle the issue of\ngetting an overly detailed representation. Also it assumes that for\nany point in the domain, the difference between conceptual func-\ntion value and the value predicted by the tight PWL function is not\ngreater than the maximum tolerated error sought by the algorithm.\n\nAn approach to remedy both issues of a tight piecewise-lin-\near representation is to design an iterative process for solving the\noptimization problem. Starting with a small number of sampling\npoints the problem is solved, and solution is compared to a simula-\ntion of the complete production scenario running with the decision\nvariable values calculated by the optimization problem. If all vari-\nables are in a given pre-specified maximum error the solution of\nthe optimization problem is kept, otherwise, the production curves\nare oversampled according to some heuristic, and the process starts\nover until the tolerance is achieved. This approach has been used\nwith success in [76], although being very sensitive since it relies\ngreatly on the heuristics for being efficient. A drawback is that it\ncompares the curves in a post-optimization stage.\n\nHere we propose an alternative approach to those. This is\nonly applicable to piecewise-linearization of conceptual well-pro-\nduction curves, or any conceptual function that has a convex or con-\ncave shape. It explores the fact that an error function, defined as the\nconceptual function minus its piecewise-linear approximation, is a\nconvex function. Thus, it uses line-search without derivative meth-\nods [77] in a recursive algorithm to provide sampling points and\ngenerates a PWL approximation curve that guaranties a maximum\nerror for all the domain. The algorithm does not ensure that the\nminimum number of sample points for a given tolerance would be\nobtained, but experimental results showed it is close enough. In Ap-\npendix A we go into the details of the algorithm.\n\n\n\n90 Chapter 3. Robust production optimization methodology\n\nBy using one of the techniques mentioned above, and there-\nfore having a PWL model that is of reasonable size and that has\na negligible approximation error, it is possible to replace the simu-\nlated well-production function by its approximated piecewise-linear\nfunction, assuming no extra uncertainty is being added to the prob-\nlem.\n\nThe general mathematical models for multidimensional piece-\nwise-linear approximation include the convex combination (CC),\nthe logarithmic version of CC (Log), the disaggregated convex com-\nbination (DCC), its logarithmic version DLog, the incremental (Inc),\nthe multiple choice (MC) model, and special ordered sets of type 2\n(SOS2) [40]. The SOS2 model is implemented in software by the\nbranch-and-bound algorithm, whereas the other models are made\nexplicit in the mathematical programming formulation using binary\nvariables and additional constraints. Specific production optimiza-\ntion formulations for each of this piecewise-linear models are pre-\nsented by [9]. A general MILP approximated formulation for Prob-\nlem 3.1 (P ) that is independent of the model chosen for piecewise\nlinearization follows1:\n\n\\=P : \\mathrm{m}\\mathrm{a}\\mathrm{x} \\=qoil (3.2a)\n\\mathrm{s}.\\mathrm{t}. : qinj \\leq Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj (3.2b)\n\nqinj =\n\\sum \nqi\\in \\scrK \n\n\\lambda qi \\cdot qi, (3.2c)\n\n\\=qr =\n\\sum \nqi\\in \\scrK \n\n\\lambda qi \\cdot \\widehat qr(qi, G), \\forall r \\in \\scrR (3.2d)\\Bigl( \n\\lambda qi\n\n\\Bigr) \n\\scrK \n\ninduces a PWL function (3.2e)\n\n\\=qSr \\leq q\nS,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nr , \\forall r \\in \\scrR (3.2f)\n\n\\=qSr = \\=qr, \\forall r \\in \\scrR  - \\{ gas\\} (3.2g)\n\\=qSgas = qinj + \\=qgas (3.2h)\n\ny \\in \\{ 0, 1\\} (3.2i)\n\nwhere \\=P is an MILP approximation of problem P . The additional\nvariables for Problem (3.2) are:\n\n\\bullet \\=qr is the rate of phase r produced according with the piecewise-\nlinear function;\n\n1actually it could be any of the aggregated, SOS2 or Incremental\nPWL models.\n\n\n\n3.2. Uncertain production optimization models 91\n\n\\bullet \\=qSr is the approximated total flow of component r flowing to\nthe separator;\n\n\\bullet \\lambda qi \\in [0, 1] is a weighting variable associated with the (qi)th\nbreakpoint of the piecewise-linear production function.\n\nalso the following parameters are introduced:\n\n\\bullet \\scrK has the breakpoints of the production function; Breakpoints\nare of type (qi), where qi is a lift gas injection rate;\n\n\\bullet \\widehat qr(qi, G) is the nonlinear production function evaluated in the\nbreakpoint qi \\in \\scrK to form a sampling point.\n\nThe production of the well as a function of the lift-gas in-\njection rate is modeled by Eqs. (3.2c)-(3.2d). Eq. (3.2e) induces a\npiecewise-linear function of the production curves. Notice that a full\nrepresentation of the piecewise-linear model depends on the PWL\nmodel chosen. For instance, for a SOS2 model one has to add to\nthe previous set of constraints of Formulation (3.2) the following\nequations, \\sum \n\nqi\\in \\scrK \n\\lambda qi = y (3.2j)\n\n\\lambda qi \\geq 0, \\forall qi \\in \\scrK (3.2k)\\Bigl( \n\\lambda qi\n\n\\Bigr) \nqi\\in \\scrK \n\nare SOS2. (3.2l)\n\nOther models for piecewise-linearization may have impact on solv-\ning time [9], but the formulations will be equivalent regardless of\nthe chosen PWL model. The equations not described here have\nsimilar or identical counterparts in Formulation (3.1). Also note\nthat Eqs. (3.1d)-(3.1e) are eliminated in \\=P by considering the ex-\ntreme breakpoints are such that, \\mathrm{m}\\mathrm{i}\\mathrm{n}\\{ qi : qi \\in \\scrK \\} = q\\mathrm{m}\\mathrm{i}\\mathrm{n}inj and\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\\{ qi : qi \\in \\scrK \\} = q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj\n\n3.2.4 Uncertain MILP production problem\n\nFormulation (3.2) is an approximation of Formulation (3.1)\nand uncertainty affects both likewise. However, the linear model \\=P\nallows the use of more powerful tools, so we analyze the impact\nof uncertainty in the optimization problem through this framework.\nAs previously mentioned uncertainty could arise in equipment ca-\npacities and in the well-production function, more precisely in the\n\n\n\n92 Chapter 3. Robust production optimization methodology\n\nparameters that define the production curve. For our toy example,\nwe identify the elements that could have uncertain values as being\nQ\\mathrm{m}\\mathrm{a}\\mathrm{x}inj , q\n\nS,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nr , \\forall r \\in \\scrR and \\widehat qr(qi, G), \\forall r \\in \\scrR , \\forall qi \\in \\scrK . Notice that in\n\nthe linear optimization problem these elements are all parameters.\nEven the functions \\widehat qr, since in fact, what is being used are their eval-\nuations for specific injection rates, qi. To make the notation clearer,\nlet\u2019s denote that a parameter is uncertain by adding a tilde (~) over\nit.\n\nIt is possible to divide the uncertain parameters into two\ngroups. One containing \\~Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj and \\~q\n\nS,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nr , in which the uncertain\n\nelement appears directly in the optimization problem, and one with\\widehat qr(qi, \\~G). For this second group the uncertainty is in reality present\nin some of the parameters of the set \\~G, which of course, indirectly\nmakes the function value for each injection point, also uncertain.\nGiven the uncertain parameters above, an uncertain MILP version\nof \\=P can be written as:\n\n\\~P : \\mathrm{m}\\mathrm{a}\\mathrm{x} \\~qoil (3.3a)\n\n\\mathrm{s}.\\mathrm{t}. : qinj \\leq \\~Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj , \\~Q\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\ninj \\in \\scrU Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj (3.3b)\n\nqinj =\n\\sum \nqi\\in \\scrK \n\n\\lambda qi \\cdot qi, (3.3c)\n\n\\~qr =\n\\sum \nqi\\in \\scrK \n\n\\lambda qi \\cdot \\widehat qr(qi, \\~G), \\widehat qr(qi, \\~G) \\in \\scrU \\widehat qr(qi,G), . . .\n. . . \\forall r \\in \\scrR \n\n(3.3d)\n\n\\~qSr \\leq \\~q\nS,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nr , \\~q\n\nS,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nr \\in \\scrU qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}r , \\forall r \\in \\scrR (3.3e)\n\n\\~qSr = \\~qr, \\forall r \\in \\scrR  - \\{ gas\\} (3.3f)\n\\~qSgas = qinj + \\~qgas (3.3g)\n\ny \\in \\{ 0, 1\\} (3.3h)\\sum \nqi\\in \\scrK \n\n\\lambda qi = y (3.3i)\n\n\\lambda qi \\geq 0, \\forall qi \\in \\scrK (3.3j)\\Bigl( \n\\lambda qi\n\n\\Bigr) \nqi\\in \\scrK \n\nare SOS2. (3.3k)\n\nwhere \\~qr and \\~qSr are state variables related respectively to \\=qr and\n\\=qSr . Yet, those are defined by equations containing uncertain param-\neters. All other parameters and variables are the same as in Formu-\nlation (3.2) except for the uncertain parameters \\~Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj , \\~q\n\nS,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nr , and\n\n\n\n3.2. Uncertain production optimization models 93\n\n\\widehat qr(qi, \\~G), each one associated with a space \\scrU representing its possi-\nble states. Here we denote each \\scrU as being an uncertainty set, since\nan uncertain element is modeled as a range of possible values, with\nan undefined probabilistic distribution. However, in other uncertain\noptimization frameworks, where, for example, parameters are ran-\ndom variables, \\scrU could assume the role a of probability state space.\n\nThe uncertainty sets \\scrU Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj and \\scrU qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}r can be explicitly de-\nfined, provided a range model for the respective parameters are\navailable. Defining \\scrU \\widehat qr(qi,G) is not as straightforward. What we as-\nsume is to have an uncertainty model for each uncertain parameter\nin \\~G. But since \\widehat qr are conceptual functions it is not possible to ana-\nlytically arrive to an explicit model for \\scrU \\widehat qr(qi,G). So there is a need\nfor using approximation techniques, such as, Monte Carlo methods.\nIn general these methods have the following steps [78]:\n\n(I) Define a domain of possible inputs;\n\n(II) Generate inputs randomly over the domain;\n\n(III) Perform a deterministic computation on the inputs;\n\n(IV) Aggregate the results.\n\nLet\u2019s exemplify this latter idea. Imagine that for all parame-\nters in the set \\~G, the only one that has an uncertain value is GLR. We\nthen assume to have an explicit uncertainty model \\scrU GLR for the pa-\nrameter \\~GLR as depicted in Figure 3.4. Now, for example, in order to\ndefine a range model for the uncertainty set \\scrU \\widehat qoil(qi,G) of the uncer-\ntain parameter \\widehat qoil(qi, \\~G), one has to apply a Monte Carlo method.\nThe first step is already given because the range model \\scrU GLR defines\nthe domain of possible inputs. The second is to randomly, and con-\nveniently, choose input points within the domain. The third step is\nto use the simulated function to calculate the oil flow rates for that\nspecific injection rate qi for each of the selected inputs. Finally, from\nthe set of results one has to compute the maximum and the mini-\nmum values. Those are used to define a range model for \\scrU \\widehat qoil(qi,G).\nAll these steps are illustrated in Figure 3.4.\n\nThe second step is the most critical one and requires experi-\nence with the nonlinearities of the production function to achieve a\nreliable final result. For instance, since what is being sought are the\nextremal values assumed by \\widehat qoil(qi, \\~G), which could be directly used\nto define a range model for the uncertainty set \\scrU \\widehat qoil(qi,G), it is intu-\nitive to think that by choosing the extremal points of \\scrU GLR would\n\n\n\n94 Chapter 3. Robust production optimization methodology\n\nqinjqi\n\nqoil\n\n\\~GLR\n\n\\scrU \\widehat qoil (qi,G)\n\n\\scrU GLR\n\n\\widehat qoil(qi, G)\n\n\\widehat qoil(qinj, GLRnominal)\\widehat qoil(qinj, \\~G)\n\nI\nIV\n\nII\n\nIII\n\\widehat qoil(qi, \\~G)\n\nFigure 3.4: Steps of a Monte Carlo method for approximating\n\\scrU \\widehat qoil(qi,G) for an uncertain GLR.\n\nbe enough. For many situations this is true, but the nonlinearities\nleave no guaranty.\n\nNotice that when more than one parameter of \\~G is uncertain,\none has to use an uncertainty set \\scrU G as the domain of possible in-\nputs. This set defines the correlation between the uncertain param-\neters. While for uncorrelated data \u2013 or lack of knowledge about pos-\nsible correlations, one would use an n-box model (a box in the \\BbbR n)\nfor \\scrU G, the method presented earlier allows the use of any shape for\nthis uncertainty set. Figure 3.5 illustrates this for a well-production\ncurve that has as uncertain parameters GLR and WC.\n\nThere are many possible mathematical representations for\nthe uncertainty sets of Formulation (3.3). They can be, for example,\nrepresented by a central element and a symmetrical offset, or by the\nnominal value and asymmetrical offsets. For convenience, we chose\na representation based on the limiting points, with tags \\mathrm{i}\\mathrm{n}\\mathrm{f} and \\mathrm{s}\\mathrm{u}\\mathrm{p}.\nSo, for instance, \\~Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj \\in \\scrU Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj and \\scrU Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj = [Q\n\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\ninj,\\mathrm{i}\\mathrm{n}\\mathrm{f}, Q\n\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\ninj,\\mathrm{s}\\mathrm{u}\\mathrm{p}]. In\n\norder to simplify the notation for \\widehat qr(qi, \\~G), \\scrU \\widehat qr(qi,G) is defined as\n[\\widehat qr,\\mathrm{i}\\mathrm{n}\\mathrm{f}(qi), \\widehat qr,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi)]\n\n\n\n3.3. Robust production optimization methodology 95\n\nqinjqi\n\nqoil\n\n\\~GLR\n\n\\~WC\n\n\\scrU \\widehat qoil (qi,G)\n\n\\scrU GLR\n\n\\widehat qoil(qi, G)\n\n\\scrU WC\n\\scrU G\n\n\\widehat qoil(qinj, GLRnominal)\\widehat qoil(qinj, \\~G)\n\nI\n\nIV\nII\n\nIII\\widehat qoil(qi, \\~G)\n\nFigure 3.5: Steps of a Monte Carlo method for approximating\n\\scrU \\widehat qoil(qi,G) for uncertain GLR and WC.\n\nNow that all uncertainty sets \\scrU Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj , \\scrU qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}r , and \\scrU \\widehat qr(qi,G) can\nbe defined, the uncertain optimization problem \\~P has a complete\ndescription and we can move ahead to build a robust formulation\nof the production optimization problem.\n\n3.3 ROBUST PRODUCTION OPTIMIZATION METHODOLOGY\n\nUncertain optimization problems cannot be solved directly\nsince their structure is not the same as in standard optimization\nmodels. Various paradigms exist to transform an uncertain opti-\nmization problem into a corresponding one for which a solution\ncan be computed. Each of these paradigms follows distinct mod-\neling philosophies to perform the transformation of the uncertain\nproblem, and for each one a subfield of optimization under uncer-\ntainty has emerged. Examples of these areas of study are stochastic\nprogramming, stochastic dynamic programing and robust optimiza-\ntion.\n\nIn the present work we explore the possibilities offered by\n\n\n\n96 Chapter 3. Robust production optimization methodology\n\nthe robust optimization paradigm. We are motivated by its simpler\nassumptions regarding the modeling of uncertainty and also for the\npossibility to generate simpler to compute robust counterpart (RC)\nproblems when compared to other paradigms for optimizing under\nuncertainty.\n\nThe standard robust optimization paradigm follows four basic\nmodeling philosophies that in short are [17]:\n\n\\bullet the uncertain data in a problem is modeled in terms of ranges;\n\n\\bullet decisions must be taken before any uncertain data become\nknown;\n\n\\bullet constraints of the problem are \u201chard\u201d;\n\n\\bullet the objective is worst-case oriented.\n\nIn particular, it is used as support, the theory developed in a sub-\narea called robust linear optimization, since all starting point uncer-\ntain models are linear in its variables.\n\nBefore starting building a RC it is necessary to identify how\nthe uncertain parameters of problem \\~P relate to each other. For in-\nstance, in robust optimization there are two frameworks referred to\nas column-wise and row-wise (a.k.a. constraint-wise). In the column-\nwise framework, the uncertain parameters associated with the same\nvariable are grouped under an uncertainty set that has a geometry\nreflecting the relationship between the individual uncertainty range\nmodels. For the row-wise framework, however, the parameters in a\nsame constraint/objective are gathered in an uncertainty set. These\nsets that establish the correlated domain of possible value for each\ngroup of parameters are known respectively as column-wise uncer-\ntainty models and row-wise uncertainty models, depending on the\nframework chosen.\n\nIn order to analyze which of the frameworks is more suitable\nfor problem \\~P , let us reformulate it into a canonical form similar\nto:\n\n\\mathrm{m}\\mathrm{a}\\mathrm{x} \\bfc \\intercal \\bfitx \n\ns.t.: \\~\\bfA \\bfitx \\leq \\bfb \n\\bfitx \\geq \\bfzero ,\n\nfor \\~aij \\in \\scrU aij (for all uncertain coefficients of \\~\\bfA ). Notice that all\nuncertainty is on the left hand side (LHS) of the constraints. Thus,\nstarting with problem \\~P (Eqs. (3.3)), this is achieved by first re-\nplacing all the state variable occurrences by their corresponding\n\n\n\n3.3. Robust production optimization methodology 97\n\nequations. Then, by epigraph reformulation the uncertain objective\nequation is inserted in the constraints using an auxiliary variable\nt. In the next step, another auxiliary variable, v, is used to place\nthe uncertain elements in the RHS into the LHS. Finally since all\nremaining equality constraints contain only certain parameters it is\npossible to simply transform them into two inequalities. Therefore,\nfor a decision vector,\n\n\\bfitx \\intercal =\n\\Bigl[ (\\forall qi \\in \\scrK )\n\\lambda qi . . . y t v\n\n\\Bigr] \n\\bfc , \\bfb , and \\~\\bfA would be,\n\n\\bfc \\intercal =\n\\Bigl[ (\\forall qi \\in \\scrK )\n0 . . . 0 1 0\n\n\\Bigr] \n,\n\n\\bfb \\intercal =\n\\Bigl[ \n0 0 0 0 0 0 0 1  - 1\n\n\\Bigr] \n,\n\n\\~\\bfA =\n\n\\left[ \n                  \n\n(\\forall qi \\in \\scrK )\n\n(3.3a)  - \\widehat qoil(qi, \\~G) . . . 0 1 0\n(3.3b) qi . . . 0 0  - \\~Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj\n(3.3e) \\widehat qoil(qi, \\~G) . . . 0 0  - \\~qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}oil\n(3.3e) \\widehat qwater(qi, \\~G) . . . 0 0  - \\~qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}water\n(3.3e) qi + \\widehat qgas(qi, \\~G) . . . 0 0  - \\~qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}gas\n(3.3i) 1 . . .  - 1 0 0\n(3.3i)  - 1 . . . 1 0 0\n\n0 . . . 0 0 1\n\n0 . . . 0 0  - 1\n\n\\right] \n                  \n\n,\n\nIn analyzing matrix \\~\\bfA , one can see that:\n\n\\bullet there are uncertain coefficients relating with each other in\nboth fashions, column-wise and row-wise;\n\n\\bullet row-wise correlations happen in rows 1, 3-5, between the coef-\nficients \\widehat qr(qi, \\~G). For example, in the first row, the coefficients\n\n\n\n98 Chapter 3. Robust production optimization methodology\n\n\\widehat qoil(qi, \\~G), \\forall qi \\in \\scrK relate with each other. However, the rela-\ntionship that a value in \\scrU \\widehat qr(qi,G) has with all other breakpoints\nqi \\in \\scrK is given by the the production function \\widehat qoil. That means\nit could be difficult to establish these row-wise uncertainty set\nmodels, since they depend on the implicit nonlinearities of the\nproduction functions.\n\n\\bullet column-wise correlations happen in columns 1-| K| , (| K| +3).\nFor the last column, it is intuitive to consider that the coef-\nficients \\~qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}r are related by a straight-line linking the min-\nimum possible capacities in each \\scrU \n\nq\nS,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nr\n\nfor each r \\in \\scrR , to\nthe maximum capacities. For the first | K| columns the rela-\ntion is between the production curves values for each phase,\nat a same breakpoint qi. Clearly the relationships that arise are\nbased on WC and GLR values. If those are certain the column-\nwise uncertainty models would also be a straight-line, other-\nwise, if there is a range of possible values of WC or GLR, the\ncolumn-wise uncertainty models would be polyhedron.\n\n\\bullet For uncorrelated coefficients, either in row-wise or column-\nwise uncertainty models, the coefficient can take any value\nwithin the its original range of possibilities.\n\nBased on the considerations above, the column-wise framework is\nchosen. This means that the uncertain problem has in fact the fol-\nlowing structure,\n\n\\mathrm{m}\\mathrm{a}\\mathrm{x} \\bfc \\intercal \\bfitx \n\ns.t.:\n| K| +3\\sum \nj=1\n\nxj\\~\\bfa j \\leq \\bfb , \\forall (\\~\\bfa j \\in \\scrU j, j = 1, . . . , | K| + 3)\n\n\\bfitx \\geq \\bfzero .\n\nwhere \\scrU j is the uncertainty set model relating the individual uncer-\ntainty models for the uncertain parameters in column j. As it was\nshown by Soyster, solving this formulation is equivalent to solve an\nordinary LP in the form,\n\nP\\scrU : Maximize \\bfc \n\\intercal \\bfitx \n\nSubject to: \\bfA \\ast \\bfitx \\leq \\bfb \n\\bfitx \\geq \\bfzero .\n\nwhere each entry a\\ast ij = \\mathrm{s}\\mathrm{u}\\mathrm{p}\\~\\bfa j\\in \\scrU j (\\~\\bfa j)i. Notice that this is the same\nas getting the supremum values of the projection of \\scrU j over the\n\n\n\n3.3. Robust production optimization methodology 99\n\nuncertainty space of each individual uncertain parameter. Thus, this\nstrategy disregards the relations imposed by \\scrU j to the uncertain\ncoefficients.\n\nTherefore, for our problem the matrix \\bfA \\ast is,\n\n\\bfA \\ast =\n\n\\left[ \n                  \n\n(\\forall qi \\in \\scrK )\n(3.3a)  - \\widehat qoil,\\mathrm{i}\\mathrm{n}\\mathrm{f}(qi) . . . 0 1 0\n(3.3b) qi . . . 0 0  - Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj,\\mathrm{i}\\mathrm{n}\\mathrm{f}\n(3.3e) \\widehat qoil,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi) . . . 0 0  - qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}oil,\\mathrm{i}\\mathrm{n}\\mathrm{f}\n(3.3e) \\widehat qwater,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi) . . . 0 0  - qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}water,\\mathrm{i}\\mathrm{n}\\mathrm{f}\n(3.3e) qi + \\widehat qgas,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi) . . . 0 0  - qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}gas,\\mathrm{i}\\mathrm{n}\\mathrm{f}\n(3.3i) 1 . . .  - 1 0 0\n(3.3i)  - 1 . . . 1 0 0\n\n0 . . . 0 0 1\n\n0 . . . 0 0  - 1\n\n\\right] \n                  \n\nwhere the \\mathrm{i}\\mathrm{n}\\mathrm{f} and \\mathrm{s}\\mathrm{u}\\mathrm{p} elements come from the definitions of the\nuncertainty sets \\scrU Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj , \\scrU qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}r , and \\scrU \\widehat qr(qi,G).\n\nFrom the formulation based on matrix \\bfA \\ast one can, by intro-\nducing convenient state variables and by suppressing variables t\nand v, arrive at a robust counterpart formulation in the form,\n\nPRC : \\mathrm{m}\\mathrm{a}\\mathrm{x} \\=qoil,\\mathrm{i}\\mathrm{n}\\mathrm{f} (3.4a)\n\\mathrm{s}.\\mathrm{t}. : qinj \\leq Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj,\\mathrm{i}\\mathrm{n}\\mathrm{f} (3.4b)\n\nqinj =\n\\sum \nqi\\in \\scrK \n\n\\lambda qi \\cdot qi, (3.4c)\n\n\\=qr,\\mathrm{i}\\mathrm{n}\\mathrm{f} =\n\\sum \nqi\\in \\scrK \n\n\\lambda qi \\cdot \\widehat qr,\\mathrm{i}\\mathrm{n}\\mathrm{f}(qi), \\forall r \\in \\scrR (3.4d)\n\\=qr,\\mathrm{s}\\mathrm{u}\\mathrm{p} =\n\n\\sum \nqi\\in \\scrK \n\n\\lambda qi \\cdot \\widehat qr,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi), \\forall r \\in \\scrR (3.4e)\n\\=qSr,\\mathrm{s}\\mathrm{u}\\mathrm{p} \\leq q\n\nS,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nr,\\mathrm{i}\\mathrm{n}\\mathrm{f} , \\forall r \\in \\scrR (3.4f)\n\n\\=qSr,\\mathrm{s}\\mathrm{u}\\mathrm{p} = \\=qr,\\mathrm{s}\\mathrm{u}\\mathrm{p}, \\forall r \\in \\scrR  - \\{ gas\\} (3.4g)\n\\=qSgas,\\mathrm{s}\\mathrm{u}\\mathrm{p} = qinj + \\=qgas,\\mathrm{s}\\mathrm{u}\\mathrm{p} (3.4h)\n\ny \\in \\{ 0, 1\\} (3.4i)\n\n\n\n100 Chapter 3. Robust production optimization methodology\n\n\\sum \nqi\\in \\scrK \n\n\\lambda qi = y (3.4j)\n\n\\lambda qi \\geq 0, \\forall qi \\in \\scrK (3.4k)\\Bigl( \n\\lambda qi\n\n\\Bigr) \nqi\\in \\scrK \n\nare SOS2. (3.4l)\n\nwhere PRC is a robust version of problem P . The additional state\nvariables for the robust problem are:\n\n\\bullet \\=qr,\\mathrm{i}\\mathrm{n}\\mathrm{f} is the infimum of the production phase r of the well;\n\n\\bullet \\=qh,\\mathrm{s}\\mathrm{u}\\mathrm{p} is the supremum of the production phase r of the well;\n\n\\bullet \\=qSr,\\mathrm{i}\\mathrm{n}\\mathrm{f} is the infimum flow of phase r flowing to the separator;\n\n\\bullet \\=qSr,\\mathrm{s}\\mathrm{u}\\mathrm{p} is the supremum flow of phase r flowing to the separa-\ntor;\n\nalso the following parameters are introduced:\n\n\\bullet Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj,\\mathrm{i}\\mathrm{n}\\mathrm{f} is the lower bound value for an uncertain lift gas com-\npression capacity;\n\n\\bullet qS,\\mathrm{m}\\mathrm{a}\\mathrm{x}r,\\mathrm{i}\\mathrm{n}\\mathrm{f} is the lower bound value for an uncertain handling ca-\npacity of component r in the separator;\n\n\\bullet \\widehat qr,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi)/\\widehat qr,\\mathrm{i}\\mathrm{n}\\mathrm{f}(qi) is upper/lower bound value of production\nof phase r for an injection rate of qi according with the pro-\nduction function \\widehat qr; Notice, that the existence of upper and\nlower bound values could be due to any uncertain parameters\nin \\~G, which also define the production function.\n\nNote that the set of Equations (3.2) is similar to the set of Equations\n(3.4). In fact, problem PRC can be seen as having two piecewise-\nlinear production curves enveloping all the uncertainty of the each\nwell-production curve (see, Figure 3.6). The robust formulation uses\nsufficiently conservative objective and constraints in order to satisfy\nthe system constraints for any realization of the uncertainties of the\nproblem.\n\nThe methodology followed for the toy example can be easily\nextended to more complex production optimization problems. In\nChapter 4 two distinct standard production models are investigated.\nIn Section 4.1 a similar methodology is applied to an optimization\nproblem with complexity similar to the one studied in [8], with\n\n\n\n3.4. Summary 101\n\nqoil\n\nqinj\n\n\\=qoil,\\mathrm{s}\\mathrm{u}\\mathrm{p}\n\n\\widehat qoil(qinj, \\~G), \\~G \\in \\scrU G\\=qoil,\\mathrm{i}\\mathrm{n}\\mathrm{f}\n\nFigure 3.6: Well production envelope curves q\\mathrm{l}\\mathrm{o}\\mathrm{w}\\mathrm{e}\\mathrm{r} and q\\mathrm{u}\\mathrm{p}\\mathrm{p}\\mathrm{e}\\mathrm{r}, and\ntheir PWL functions q\\mathrm{o}\\mathrm{i}\\mathrm{l},\\mathrm{i}\\mathrm{n}\\mathrm{f} and q\\mathrm{o}\\mathrm{i}\\mathrm{l},\\mathrm{s}\\mathrm{u}\\mathrm{p}.\n\nsatellite wells and routing decisions. Following, in Section 4.2, with\nslightly modifications this methodology is used for a production op-\ntimization scenario with subsea completion, similar to the structure\nof the problem presented in [9]. Next, in Chapter 5, the modeling re-\nsults of the first problem, are subjected to a computational analysis,\nby applying the solutions of the robust and nominal formulations to\na representative oil field available in simulation software.\n\n3.4 SUMMARY\n\nThis chapter started discussing the causes of uncertainty in\nproduction models, and then provided a review of a few works that\nhave mentioned or dealt with uncertainty in production systems.\nFollowing, uncertainty is examined in the perspective of production\noptimization problems. A toy example was used to exemplify the\nrobust optimization methodology designed in this dissertation.\n\n\n\n\n\n4 ROBUST PRODUCTION OPTIMIZATION MODELS\n\nThis chapter is divided in two sections. In each of them a\ndifferent standard production optimization problem is presented.\nThen, the concepts developed in Chapter 3 are used to produce a\nrobust counterpart of the problem. For the model in Section 4.2\nthe methodology is extended to account for uncertainty in equality\nconstraints.\n\n4.1 ROBUST PRODUCTION OPTIMIZATION \u2013 SATELLITE WELLS\n\nThis section presents a robust production optimization model\nfor a production system of a group of satellite wells operated by gas\nlift which allows for the routing of production flows from wells to\nseparators. The contents of this section were published in [74], but\nin a distinct format.\n\n4.1.1 Problem Formulation\n\nLet us consider the deterministic optimization problem de-\nscribed in [8] which consists in distributing a limited rate of pres-\nsurized gas, with the selection of production routing under multi-\nple constraints. Such scenarios appear in multi-reservoir production\nsystems, in which wells are satellite but can have their production\nrouted to different separators. Figure 4.1 has the production net-\nwork of the problem dealt in this section. Here, for simplicity, the\nobjective function is considered the maximization of oil production\nof a group of wells. Considering nominal values for all parameters of\nthe problem, the production optimization problem can be viewed as\nsolving a conceptual MINLP problem, in the sense that well produc-\ntion functions and other relationships are not explicitly available.\nAs shown in Section 3.2.3 these functions can be evaluated by simu-\nlation software approximated with piecewise-linear (PWL) models.\nProvided the breakpoints are well defined to approximate the well-\nproduction functions, it is possible to render the conceptual MINLP\na MILP problem. The nominal production optimization problem sug-\ngested in this chapter extends the compact formulation from [8] to\naccount for the distinct operating pressure of the separator to which\neach well may be connected:\n\n\\=P : \\mathrm{m}\\mathrm{a}\\mathrm{x}\n\\sum \nn\\in \\scrN \n\n\\=qnoil, (4.1a)\n\n103\n\n\n\n104 Chapter 4. Robust production optimization models\n\ns\n\nQ\\mathrm{m}\\mathrm{a}\\mathrm{x}inj\n\nn = 1\n\nqninj\n\nn n = N\n\nGL Compressor\n\nGL Manifold\n\nWells\n\nRouting\n\nSeparators\n\nGas \u2013 Oil \u2013 Water\n\nqnh\n\nyn, zn,s\n\nq\nn,s\nh\n\nq\ns,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nh\n\ns = 1 s = S\n\nFigure 4.1: Production network \u2013 satellite wells.\n\nsubject to a limited compression capacity:\n\ns.t. :\n\\sum \nn\\in \\scrN \n\nqninj \\leq Q\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\ninj , (4.1b)\n\nand for each well n \\in \\scrN :\n\nq\nn,s\ninj =\n\n\\sum \nqi\\in \\scrK n,s\n\n\\lambda n,sqi \\cdot qi, \\forall s \\in \\scrS n, (4.1c)\\sum \ns\\in \\scrS n\n\nq\nn,s\ninj = q\n\nn\ninj, (4.1d)\n\n\n\n4.1. Robust Production Optimization \u2013 Satellite Wells 105\n\n\\=q\nn,s\nh =\n\n\\sum \nqi\\in \\scrK n,s\n\n\\lambda n,sqi \\cdot \\widehat qh(qi, Gn,s), \\forall s \\in \\scrS n, \\forall h \\in \\scrH , (4.1e)\\sum \ns\\in \\scrS n\n\n\\=q\nn,s\nh = \\=q\n\nn\nh, \\forall h \\in \\scrH , (4.1f)\\sum \n\ns\\in \\scrS n\n\nzn,s = yn, (4.1g)\n\nwith a SOS2 piecewise-linear model, for all well n \\in \\scrN and separa-\ntor s \\in \\scrS n:\\sum \nqi\\in \\scrK n,s\n\n\\lambda n,sqi = zn,s, (4.1h)\n\n\\lambda n,sqi \\geq 0, \\forall qi \\in \\scrK \nn,s, (4.1i)\\Bigl( \n\n\\lambda n,sqi\n\n\\Bigr) \nqi\\in \\scrK n,s\n\nare SOS2, (4.1j)\n\nand for each separator s \\in \\scrS :\n\n\\=qsh \\leq q\ns,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nh , \\forall h \\in \\scrH , (4.1k)\\sum \n\nn\\in \\scrN s\n\n\\=q\nn,s\nh = \\=q\n\ns\nh, \\forall h \\in \\scrH  - \\{ gas\\} , (4.1l)\\sum \n\nn\\in \\scrN s\n\n(\\=qn,sgas + q\nn,s\ninj ) = \\=q\n\ns\ngas, (4.1m)\n\nwith:\n\nyn \\in \\{ 0, 1\\} , \\forall n \\in \\scrN , (4.1n)\nzn,s \\in \\{ 0, 1\\} , \\forall n \\in \\scrN , \\forall s \\in \\scrS n. (4.1o)\n\nThe variables of the formulation are:\n\n\\bullet qninj is the rate of lift-gas injection into well n;\n\n\\bullet qn,sinj is the lift-gas injection rate of well n when routed to sep-\narator s;\n\n\\bullet \\=qnh is the rate of component h produced according with the\npiecewise-linear function of well n;\n\n\\bullet \\=qn,sh is the component h of production rate from well n when\ndirected to separator s;\n\n\n\n106 Chapter 4. Robust production optimization models\n\n\\bullet \\=qsh is the approximated total flow of component h flowing to\nthe separator s;\n\n\\bullet yn \\in \\{ 0, 1\\} is 1 when well n is active or else 0;\n\n\\bullet zn,s \\in \\{ 0, 1\\} assumes value 1 if well n is connected to separa-\ntor s, and 0 otherwise;\n\n\\bullet \\lambda n,sqi \\in [0, 1] is a weighting variable associated with the break-\npoint qi \\in \\scrK n,s of the piecewise-linear production function of\nwell n to separator s;\n\nThe parameters are as follows:\n\n\\bullet \\scrN = \\{ 1, . . . , N\\} is the set of gas-lifted wells and \\scrN s \\subseteq \\scrN is\nthe subset of wells that can be connected to separator s;\n\n\\bullet \\scrS = \\{ 1, . . . , S\\} is the set of separators and \\scrS n \\subseteq \\scrS is the subset\nof separators that can received production of a given well n;\n\n\\bullet \\scrH = \\{ oil, gas, water, liq\\} has the liquid-flow (liq) and also the\nmixed-flow components: oil, gas, and water; liquid-flow is the\nsum of the water and oil flow rates;\n\n\\bullet \\scrK n,s has the breakpoints of the production function of well n\nto separator s; Breakpoints are of type (qi), where qi is a lift\ngas injection rate;\n\n\\bullet Gn,s is the set of parameters and correlations that character-\nize the well-production curves of the well n when directed to\nseparator s. Since this is a satellite well, it includes the separa-\ntor inlet pressure pssep, the pipeline ID, vertical elevations, and\nhorizontal length, the production tubing ID, length, and tra-\njectory, the fluid data, as gas-liquid ratio (GLR), WC, specific\ndensities, and bubble point pressure, the inflow performance\nrelationship (IPR) and its parameters, the vertical and hori-\nzontal flow pattern correlations, to name a few.\n\n\\bullet \\widehat qh(qi, Gn,s) is the nonlinear production function of component\nh of well n to separator s evaluated at breakpoint qi \\in \\scrK to\ndefine a sampling point;\n\n\\bullet Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj is the available lift-gas rate;\n\n\\bullet qs,\\mathrm{m}\\mathrm{a}\\mathrm{x}oil , q\ns,\\mathrm{m}\\mathrm{a}\\mathrm{x}\ngas , q\n\ns,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nwater and q\n\ns,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nliq are limits on oil, gas, water\n\nand liquid handling of separator s.\n\n\n\n4.1. Robust Production Optimization \u2013 Satellite Wells 107\n\nThe production of each well as a function of the lift-gas injection\nrate and routing is modeled by Eqs. (4.1c)-(4.1f). Constraints (4.1g)-\n(4.1h) dictate the routing from wells to separators. They ensure that\nwell production is not split in the flow lines: the production of well\nn sent to separator s is null if zn,s = 0, otherwise it is bounded by\nthe capacity of the separator.\n\nEqs. (4.1h)-(4.1j) induces a piecewise-linear function of the\nproduction curves through a SOS2 model. Fluid handling capacities\nfor the separators are given by constraints (4.1k). Eqs. (4.1l)-(4.1m)\ndescribe the flow rates arriving at the separators.\n\n4.1.2 Robust Formulation\n\nFormulation (4.1) considers nominal values for all parame-\nters. As discussed in the previous chapter a few of these parame-\nters may not be precisely known for one of the many reasons ex-\nplained in Section 3.1. In this model, for simplicity, let us consider\nthat all parameters have accurate values but some parameters of\nthe set Gn,s, which define the production curves. We denote this set\nthat have the uncertain parameters \\~Gn,s. Thus, instead of nominal\nsampling point values, what appears are uncertain sampling points\\widehat qh(qi, \\~Gn,s) induced by the uncertain values of the parameters in\n\\~Gn,s. Here we assume as given the uncertainty range models \\scrU Gn,s\nthat represent the uncertainty in the parameters of \\~Gn,s as given. By\nhaving these models and applying the procedure described in Sec-\ntion 3.2.4 \u2013 Monte Carlo method, it is possible to design the uncer-\ntainty range models \\scrU \\widehat qh(qi,Gn,s) for the sampling points \\widehat qh(qi, \\~Gn,s),\nwhich are the uncertain parameters that would in fact appear in\nan uncertain formulation of \\=P . The mathematical representation of\nthese models is \\scrU \\widehat qh(qi,Gn,s) = [\\widehat q n,sh,\\mathrm{i}\\mathrm{n}\\mathrm{f}(qi), \\widehat q n,sh,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi)].\n\nIn line with the discussions of Section 3.3, we consider a\ncolumn-wise relationship between the individual uncertain parame-\nters \\widehat qh(qi, \\~Gn,s). Therefore, the robust production optimization prob-\nlem can be viewed as:\n\nPRC : \\mathrm{m}\\mathrm{a}\\mathrm{x}\n\\sum \nn\\in \\scrN \n\n\\=qnoil,\\mathrm{i}\\mathrm{n}\\mathrm{f} (4.2a)\n\nsubject to a limited compression capacity:\n\ns.t. :\n\\sum \nn\\in \\scrN \n\nqninj \\leq Q\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\ninj , (4.2b)\n\n\n\n108 Chapter 4. Robust production optimization models\n\nand for each well n \\in \\scrN :\n\nq\nn,s\ninj =\n\n\\sum \nqi\\in \\scrK n,s\n\n\\lambda n,sqi \\cdot qi, \\forall s \\in \\scrS n (4.2c)\\sum \ns\\in \\scrS n\n\nq\nn,s\ninj = q\n\nn\ninj, (4.2d)\n\n\\=q\nn,s\nh,\\mathrm{i}\\mathrm{n}\\mathrm{f} =\n\n\\sum \nqi\\in \\scrK n,s\n\n\\lambda n,sqi \\cdot \\widehat q n,sh,\\mathrm{i}\\mathrm{n}\\mathrm{f}(qi), \\forall s \\in \\scrS n, \\forall h \\in \\scrH , (4.2e)\n\\=q\nn,s\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p} =\n\n\\sum \nqi\\in \\scrK n,s\n\n\\lambda n,sqi \\cdot \\widehat q n,sh,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi), \\forall s \\in \\scrS n, \\forall h \\in \\scrH , (4.2f)\\sum \ns\\in \\scrS n\n\n\\=q\nn,s\nh,\\mathrm{i}\\mathrm{n}\\mathrm{f} = \\=q\n\nn\nh,\\mathrm{i}\\mathrm{n}\\mathrm{f}, \\forall h \\in \\scrH , (4.2g)\\sum \n\ns\\in \\scrS n\n\nzn,s = yn, (4.2h)\n\nwith a SOS2 piecewise-linear model, for all well n \\in \\scrN and separa-\ntor s \\in \\scrS n:\\sum \nqi\\in \\scrK n,s\n\n\\lambda n,sqi = zn,s (4.2i)\n\n\\lambda n,sqi \\geq 0, \\forall qi \\in \\scrK \nn,s (4.2j)\\Bigl( \n\n\\lambda n,sqi\n\n\\Bigr) \nqi\\in \\scrK n,s\n\nare SOS2 (4.2k)\n\nand for each separator s \\in \\scrS :\n\n\\=qsh,\\mathrm{s}\\mathrm{u}\\mathrm{p} \\leq q\ns,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nh , \\forall h \\in \\scrH , (4.2l)\\sum \n\nn\\in \\scrN s\n\n\\=q\nn,s\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p} = \\=q\n\ns\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p}, \\forall h \\in \\scrH  - \\{ gas\\} (4.2m)\\sum \n\nn\\in \\scrN s\n\n(\\=qn,sgas,\\mathrm{s}\\mathrm{u}\\mathrm{p} + q\nn,s\ninj ) = \\=q\n\ns\ngas,\\mathrm{s}\\mathrm{u}\\mathrm{p} (4.2n)\n\nwith:\n\nyn \\in \\{ 0, 1\\} , \\forall n \\in \\scrN , (4.2o)\nzn,s \\in \\{ 0, 1\\} , \\forall n \\in \\scrN , \\forall s \\in \\scrS n. (4.2p)\n\nwhere PRC is a robust version of problem \\=P . The additional vari-\nables for the robust problem are:\n\n\n\n4.2. Robust Production Optimization \u2013 Subsea Manifold 109\n\n\\bullet \\=qn,sh,\\mathrm{i}\\mathrm{n}\\mathrm{f} (\\=q\nn,s\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p}) is the infimum (supremum) of the production\n\ncomponent h from well n directed to separator s.\n\n\\bullet \\=qnh,\\mathrm{i}\\mathrm{n}\\mathrm{f} is the infimum production rate of component h of well\nn;\n\n\\bullet \\=qsh,\\mathrm{s}\\mathrm{u}\\mathrm{p} is the supremum production rate of component h flow-\ning to separator s;\n\nalso the following parameters are introduced:\n\n\\bullet \\widehat q n,sh,\\mathrm{i}\\mathrm{n}\\mathrm{f}(qi) and \\widehat q n,sh,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi) are respectively the lower and upper\nlimits of the range model which defines the uncertainty set\n\\scrU \\widehat qh(qi,Gn,s). This relates to the production of component h as-\nsociated with the breakpoint qi of well n when connected to\nseparator s;\n\nNote that the set of Eqs. (4.2) is similar to the set of Eqs. (4.1).\nHaving introduced the notation above, the robust formulation of\nthe lift-gas allocation problem is an MILP problem defined on the\nvariables qn,sinj , q\n\nn\ninj, \\=q\n\nn,s\nh,\\mathrm{i}\\mathrm{n}\\mathrm{f} , \\=q\n\nn,s\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p}, \\=q\n\nn\nh,\\mathrm{i}\\mathrm{n}\\mathrm{f} , \\=q\n\ns\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p}, yn, zn,s and \\lambda \n\nn,s\nqi\n\n. The\nsolution it produces is robust optimal, in the sense that is the best\nsolution within the set that satisfies any realization of the uncertain\nparameters that are within the uncertainty set.\n\n4.2 ROBUST PRODUCTION OPTIMIZATION \u2013 SUBSEA MANIFOLD\n\nThis section describes a robust production optimization model\nof a more complex production system, which consists of a group of\ngas-lifted wells whose production travel through subsea manifolds\nand shared flow lines. Routing decisions also apply, but due to the\nsubsea completion, pressure constraints exist.\n\n4.2.1 Problem Formulation\n\nOptimal production plans for multi-reservoir fields with sub-\nsea completion require models that consider pressure constraints\nbesides the usual flow constraints, when operating conditions vary\ndue to routing operations and equipment failure. Let us consider\nthe daily production optimization problem with nominal parame-\nters formulated in Silva and Camponogara [9] as a MINLP. It con-\nsists in distributing a limited rate of pressurized gas, with the se-\nlection of production routing under separation capacity, and flow\n\n\n\n110 Chapter 4. Robust production optimization models\n\nand pressure constraints. Figure 4.2 has the production network of\nthe problem dealt in this section. Silva and Camponogara propose\nseveral MILP reformulations for the nonlinear problem, each using\na different PWL model. Below it is presented one approximation\nbased on the SOS2 model. Here, for simplicity, the objective func-\ntion is considered the maximization of oil production of a group of\nwells.\n\n\\=P : \\mathrm{m}\\mathrm{a}\\mathrm{x}\n\\sum \nn\\in \\scrN \n\n\\=qnoil (4.3a)\n\nsubject to a limited compression capacity:\n\ns.t. :\n\\sum \nn\\in \\scrN \n\nqninj \\leq Q\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\ninj , (4.3b)\n\nand for each well n \\in \\scrN :\n\nq\nn,m\ninj =\n\n\\sum \n(qi,p)\\in \\scrV n,m\n\n\\lambda n,mqi,p \\cdot qi, \\forall m \\in \\scrM n, (4.3c)\\sum \nm\\in \\scrM n\n\nq\nn,m\ninj = q\n\nn\ninj, (4.3d)\\sum \n\n(qi,p)\\in \\scrV n,m\n\\lambda n,mqi,p \\cdot p \\leq p\n\nm \\leq \n\\sum \n\n(qi,p)\\in \\scrV n,m\n\\lambda n,mqi,p \\cdot p + . . .\n\n. . . pm,\\mathrm{m}\\mathrm{a}\\mathrm{x}(1 - zn,m), \\forall m \\in \\scrM n,\n(4.3e)\n\n\\=q\nn,m\nh =\n\n\\sum \n(qi,p)\\in \\scrV n,m\n\n\\lambda n,mqi,p \\cdot \\widehat qh(qi, p, Gn,m), \\forall m \\in \\scrM n, \\forall h \\in \\scrH , (4.3f)\\sum \nm\\in \\scrM n\n\n\\=q\nn,m\nh = \\=q\n\nn\nh, \\forall h \\in \\scrH , (4.3g)\\sum \n\nm\\in \\scrM n\n\nzn,m = yn, (4.3h)\\Bigl( \n\\lambda n,mqi,p\n\n\\Bigr) \n\\scrV n,m\n\ninduces a PWL function, \\forall m \\in \\scrM n, (4.3i)\n\nand for each manifold m \\in \\scrM :\n\n\\=qmh \\leq q\nm,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nh , \\forall h \\in \\scrH , (4.3j)\n\n\\=qmh =\n\\sum \n\nn\\in \\scrN m\n\n\\=q\nn,m\nh , \\forall h \\in \\scrH  - \\{ gas\\} , (4.3k)\n\n\\=qmgas =\n\\sum \n\nn\\in \\scrN m\n\n(\\=qn,mgas + q\nn,m\ninj ), (4.3l)\n\n\n\n4.2. Robust Production Optimization \u2013 Subsea Manifold 111\n\nm\nm = 1 m = M\n\nQ\\mathrm{m}\\mathrm{a}\\mathrm{x}inj\n\nn = 1\n\nqninj\n\nn n = N\n\nGL Compressor\n\nGL Manifold\n\nWells\n\nRouting\n\nSeparators\n\nGas \u2013 Oil \u2013 Water\n\nqnh\n\nyn, zn,m\n\nq\nn,m\nh\n\nq\ns,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nh\n\nqmh\n\nManifolds\n\nFigure 4.2: Production network \u2013 subsea completion.\n\n\n\n112 Chapter 4. Robust production optimization models\n\n\\=qmliq =\n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot qliq, (4.3m)\n\n\\=qmwater =\n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot wc \\cdot qliq, (4.3n)\n\n\\=qmgas =\n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot glr \\cdot qliq, (4.3o)\n\n\\=\\Delta pm =\n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot \n\n\\widehat \\Delta p(qliq, glr, wc, Im), (4.3p)\npm = pmsep +\n\n\\=\\Delta pm, (4.3q)\n\npm,\\mathrm{m}\\mathrm{i}\\mathrm{n} \\leq pm \\leq pm,\\mathrm{m}\\mathrm{a}\\mathrm{x}, (4.3r)\nzn,m \\leq ym, n \\in \\scrN m, (4.3s)\\sum \nn\\in \\scrN m\n\nzn,m \\geq ym, (4.3t)\\Bigl( \n\\gamma mqliq,glr,wc\n\n\\Bigr) \n\\scrT m\n\ninduces a PWL function, (4.3u)\n\nwith:\n\nyn \\in \\{ 0, 1\\} , \\forall n \\in \\scrN , (4.3v)\nym \\in \\{ 0, 1\\} , \\forall m \\in \\scrM , (4.3w)\nzn,m \\in \\{ 0, 1\\} , \\forall n \\in \\scrN , \\forall m \\in \\scrM n. (4.3x)\n\nFor Eq. (4.3i) the SOS2 model the following equations apply for\neach well n \\in \\scrN and manifold m \\in \\scrM n:\n\n\\sum \n(qi,p)\\in \\scrV n,m\n\n\\lambda n,mqi,p = zn,m, (4.4a)\n\n\\eta n,mp =\n\\sum \n\nqi\\in \\scrV \nn,m\n\\mathrm{q}\\mathrm{i}\n\n\\lambda n,mqi,p ,\\forall p \\in \\scrV \nn,m\n\\mathrm{p} (4.4b)\n\n\\eta n,mqi =\n\\sum \n\np\\in \\scrV n,mp\n\n\\lambda n,mqi,p ,\\forall qi \\in \\scrV \nn,m\n\\mathrm{q}\\mathrm{i}\n\n(4.4c)\n\n\\lambda n,mqi,p ,\\in [0, 1], \\forall (qi, p) \\in \\scrV \nn,m, (4.4d)\\Bigl( \n\n\\eta n,mp\n\n\\Bigr) \np\\in \\scrV n,m\\mathrm{p}\n\n,\n\\Bigl( \n\\eta n,mqi\n\n\\Bigr) \nqi\\in \\scrV \n\nn,m\n\\mathrm{q}\\mathrm{i}\n\n, are SOS2 (4.4e)\n\n\n\n4.2. Robust Production Optimization \u2013 Subsea Manifold 113\n\nand for Eq. (4.3u) the SOS2 model for each manifold m \\in \\scrM :\\sum \n(qliq,glr,wc)\\in \\scrT m\n\n\\gamma mqliq,glr,wc = ym, (4.4f)\n\n\\eta mqliq =\n\\sum \n\nglr\\in \\scrT mglr\n\n\\sum \nwc\\in \\scrT mwc\n\n\\gamma mqliq,glr,wc,\\forall qliq \\in \\scrT \nm\n\\mathrm{q}\\mathrm{l}\\mathrm{i}\\mathrm{q}\n\n, (4.4g)\n\n\\eta mglr =\n\\sum \n\nqliq\\in \\scrT m\\mathrm{q}\\mathrm{l}\\mathrm{i}\\mathrm{q}\n\n\\sum \nwc\\in \\scrT mwc\n\n\\gamma mqliq,glr,wc,\\forall glr \\in \\scrT \nm\n\nglr , (4.4h)\n\n\\eta mwc =\n\\sum \n\nqliq\\in \\scrT m\\mathrm{q}\\mathrm{l}\\mathrm{i}\\mathrm{q}\n\n\\sum \nglr\\in \\scrT mglr\n\n\\gamma mqliq,glr,wc,\\forall wc \\in \\scrT \nm\n\nwc , (4.4i)\n\n\\gamma mqliq,glr,wc,\\in [0, 1], \\forall (qliq, glr, wc) \\in \\scrT \nm, (4.4j)\\Bigl( \n\n\\eta mqliq\n\n\\Bigr) \nqliq\\in \\scrT m\\mathrm{q}\\mathrm{l}\\mathrm{i}\\mathrm{q}\n\n,\n\\Bigl( \n\\eta mglr\n\n\\Bigr) \nglr\\in \\scrT mglr\n\n,\n\\Bigl( \n\\eta mwc\n\n\\Bigr) \nwc\\in \\scrT mwc\n\n, are SOS2 (4.4k)\n\nThe decision variables of the Formulation (4.3)-(4.4) are:\n\n\\bullet qninj is the rate of lift-gas injection into well n and q\nn,m\ninj is the\n\nlift-gas injection rate of well n when routed to manifold m;\n\n\\bullet \\=qnh is the rate of component h produced according with the\npiecewise-linear function of well n;\n\n\\bullet \\=qn,mh is the component h of the approximated production rate\nfrom well n when directed to manifold m;\n\n\\bullet \\=qmh is the approximated total flow of component h flowing\nthrough manifold m;\n\n\\bullet pm is the pressure in manifold m;\n\n\\bullet yn \\in \\{ 0, 1\\} is 1 when well n is active or else 0;\n\n\\bullet ym \\in \\{ 0, 1\\} is 1 when manifold m is active or else 0;\n\n\\bullet zn,m \\in \\{ 0, 1\\} assumes value 1 if well n is connected to mani-\nfold m, and 0 otherwise;\n\n\\bullet \\=\\Delta pm is the pressure drop in the flowline connecting manifold\nm to its separator according with the piecewise-linear func-\ntion;\n\n\n\n114 Chapter 4. Robust production optimization models\n\n\\bullet \\lambda n,mqi,p \\in [0, 1] is a weighting variable associated with the (qi, p)\nth\n\nbreakpoint of the piecewise-linear production function of well\nn to manifold m;\n\n\\bullet \\gamma mqliq,glr,wc \\in [0, 1] is a weighting variable associated with the\n(qliq, glr, wc)\n\nth breakpoint of the piecewise-linear pressure drop\nfunction in the pipeline connecting manifold m to its separa-\ntor;\n\n\\bullet \\eta n,mqi , \\eta \nn,m\np , \\eta \n\nm\nglr, \\eta \n\nm\nwc, \\eta \n\nm\nqliq\n\nare auxiliary SOS2 variables.\n\nthe parameters are as follows:\n\n\\bullet \\scrN = \\{ 1, . . . , N\\} is the set of gas-lifted wells and \\scrN m \\subseteq \\scrN is\nthe subset of wells that can be connected to manifold m;\n\n\\bullet \\scrM = \\{ 1, . . . , M\\} is the set of manifolds and \\scrM n \\subseteq \\scrM is the\nsubset of manifolds that can received production of a given\nwell n;\n\n\\bullet \\scrH = \\{ oil, gas, water, liq\\} has the liquid-flow (liq) and also the\nmixed-flow components: oil, gas, and water; liquid-flow is the\nsum of the water and oil flow rates;\n\n\\bullet Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj is the available lift-gas rate;\n\n\\bullet qm,\\mathrm{m}\\mathrm{a}\\mathrm{x}oil , q\nm,\\mathrm{m}\\mathrm{a}\\mathrm{x}\ngas , q\n\nm,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nwater and q\n\nm,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nliq are limits on oil, gas, water\n\nand liquid handling of the separator connected to manifold m;\n\n\\bullet pm,\\mathrm{m}\\mathrm{i}\\mathrm{n}(pm,\\mathrm{m}\\mathrm{a}\\mathrm{x}) is the minimum (maximum) operational pres-\nsure for manifold m;\n\n\\bullet pmsep is the operational pressure of the separator connected to\nmanifold m.\n\n\\bullet Gn,m is the set of parameters and correlations that character-\nize the well-production curves of the well n when directed to\nmanifold m.\n\n\\bullet Im is the set of parameters and correlations that define the\npressure drop in the pipeline connecting manifold m to its\nrespective separator.\n\n\\bullet \\widehat qh(qi, p, Gn,m) is the nonlinear production function of compo-\nnent h of well n to manifold m evaluated at the breakpoint\n(qi, p) \\in \\scrV n,m to define a sampling point;\n\n\n\n4.2. Robust Production Optimization \u2013 Subsea Manifold 115\n\n\\bullet \\widehat \\Delta p(\\cdot ) is the nonlinear pressure-drop curve between manifold\nand its separator as a function of the liquid rate, the gas-liquid\nratio and the water-cut of the fluid passing through the flow-\ning line. \\widehat \\Delta p(qliq, glr, wc, Im) is the evaluation of this function\nat the breakpoint (qliq, glr, wc) \\in \\scrT m to define a sampling\npoint, for the flow line leaving manifold m;\n\n\\bullet \\scrV n,m has the breakpoints of the production function for well n\nwhen connected to manifold m; Breakpoints are of type (qi, p),\nwhere qi is a lift-gas injection rate and p is a pressure in the\nmanifold;\n\n\\bullet \\scrT m has the breakpoints of the pressure-drop function for man-\nifold m; Breakpoints are of type (q\\mathrm{l}\\mathrm{i}\\mathrm{q}, glr, wc), where q\\mathrm{l}\\mathrm{i}\\mathrm{q} is the\nliquid rate, glr is the gas-liquid ratio and wc is the water-cut\nof the fluid in manifold m;\n\nIn order to apply the SOS2 model we have to consider that \\scrV n,m and\n\\scrT m are full grids, thus \\scrV n,m := \\scrV n,m\\mathrm{q}\\mathrm{i} \\times \\scrV \n\nn,m\np and \\scrT m := \\scrT m\\mathrm{q}\\mathrm{l}\\mathrm{i}\\mathrm{q}\\times \\scrT \n\nm\nglr \\times \n\n\\scrT mwc . Where \\scrV n,m\\mathrm{q}\\mathrm{i} and \\scrV \nn,m\np are respectively the set of breakpoints\n\nfor lift-gas injection rates and upstream pressure for each well n to\nmanifold m, and \\scrT m\\mathrm{q}\\mathrm{l}\\mathrm{i}\\mathrm{q} , \\scrT \n\nm\nglr and \\scrT \n\nm\nwc are the set of breakpoints for\n\nliquid rate, gas-liquid ratio and water-cut for each manifold m.\nThe production of each well as a function of the lift-gas injec-\n\ntion rate, manifold pressure and routing is modeled by Eqs. (4.3c)-\n(4.3g). In this formulation constraint (4.3h) dictates the routing\nfrom wells to manifolds/separators and ensure that there is no flow\nsplitting. Separation capacities are given by constraint (4.3j). Eqs.\n(4.3k)-(4.3l) have the mass balance, while the pressure balance\nbetween manifolds and separators is given by constraints (4.3q).\nThe pressure drop as a function of the resulting gas-liquid ratio,\nwater-cut and total liquid rate in each manifold is modeled by Eqs.\n(4.3m)-(4.3p). Eq. (4.3r) has the pressure limits for the manifolds\nand Eqs. (4.3s)-(4.3t) ensure manifold that if a manifold is not ac-\ntive no well can route its production to it. Finally Eqs. (4.4) induce a\npiecewise-linear function of the production curves and the pressure\ndrop curves.\n\n4.2.2 Robust Formulation\n\nFormulation (4.3)-(4.4) disregards any uncertainty in the val-\nues of the parameters and considers expected values for all of them.\nAs in Section 4.1, let us assume that uncertainty is only in some of\n\n\n\n116 Chapter 4. Robust production optimization models\n\nthe parameters in the set Gn,m that define the production curves.\nWe denote this set of uncertain parameters \\~Gn,m. All other parame-\nters have known and accurate values.\n\nAgain, instead of nominal sampling point values, what comes\nout of the formulation described above are the uncertain sampling\npoints \\widehat qh(qi, p, \\~Gn,m) induced by the uncertain values of the param-\neters in \\~Gn,m. Considering the uncertainty range models \\scrU Gn,s that\nrepresent the uncertainty in the parameters of \\~Gn,s are given, it is\npossible to obtain approximated uncertainty sets \\scrU \\widehat qh(qi,p,Gn,m) for\nthe sampling points \\widehat qh(qi, p, \\~Gn,m). This can be performed using, for\nexample, Monte Carlo methods (see Section 3.2.4). The mathemat-\nical representation of these uncertainty sets can be \\scrU \\widehat qh(qi,p,Gn,m) =\n[\\widehat q n,mh,\\mathrm{i}\\mathrm{n}\\mathrm{f} (qi, p), \\widehat q n,mh,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi, p)].\n\nIn line with the discussions of Section 3.3, we also consider a\ncolumn-wise relationship between the individual uncertain param-\neters \\widehat qh(qi, \\~Gn,s). However, differently than in the example of Sec-\ntion 3.3 and the problem of Section 4.1, for the problem above,\neven after eliminating the state variables one is still left with un-\ncertain equality constraints. Those are the mass balance equations\n(4.3m)-(4.3o).\n\nAs explained in the final remarks of Section 2.3.3, standard\nrobust optimization theory does not consider problems with uncer-\ntainty in equality constraints. In order to handle uncertain equal-\nity constraints using the same framework detailed in the previous\nchapter, we have to modify formulation \\=P . That can be achieved\nrelaxing the uncertain equality constraints by replacing them with\ntwo appropriate uncertain inequalities. The uncertain counterparts\nof Eqs. (4.3m)-(4.3o), eliminating the state variables \\=qmliq, \\=q\n\nm\nwater, and\n\n\\=qmgas, would then become for all manifolds m \\in \\scrM :\n\nEq. (4.3m)\n\n\\left\\{     \n    \n\n\\~qmliq  - \n\\sum \n\n(qliq,glr,wc)\\in \\scrT \nm\n\n\\gamma mqliq,glr,wc \\cdot qliq \\geq 0,\n\n - \\~qmliq +\n\\sum \n\n(qliq,glr,wc)\\in \\scrT \nm\n\n\\gamma mqliq,glr,wc \\cdot qliq \\geq 0\n(4.5a)\n\nEq. (4.3n)\n\n\\left\\{     \n    \n\n\\~qmwater  - \n\\sum \n\n(qliq,glr,wc)\\in \\scrT \nm\n\n\\gamma mqliq,glr,wc \\cdot wc \\cdot qliq \\geq 0,\n\n - \\~qmwater +\n\\sum \n\n(qliq,glr,wc)\\in \\scrT \nm\n\n\\gamma mqliq,glr,wc \\cdot wc \\cdot qliq \\geq 0\n(4.5b)\n\n\n\n4.2. Robust Production Optimization \u2013 Subsea Manifold 117\n\nEq. (4.3o)\n\n\\left\\{     \n    \n\n\\~qmgas  - \n\\sum \n\n(qliq,glr,wc)\\in \\scrT \nm\n\n\\gamma mqliq,glr,wc \\cdot glr \\cdot qliq \\geq 0,\n\n - \\~qmgas +\n\\sum \n\n(qliq,glr,wc)\\in \\scrT \nm\n\n\\gamma mqliq,glr,wc \\cdot glr \\cdot qliq \\geq 0\n(4.5c)\n\nwhere \\~qmliq, \\~q\nm\nwater, and \\~q\n\nm\ngas are defined as,\n\n\\~qmliq =\n\\sum \n\nn\\in \\scrN m\n\n\\sum \n(qi,p)\\in \\scrV n,m\n\n\\lambda n,mqi,p \\cdot \\widehat qliq(qi, p, \\~Gn,m), . . .\n. . . \\forall \\widehat qliq(qi, p, \\~Gn,m) \\in \\scrU \\widehat qliq(qi,p,Gn,m)\n\n\\~qmwater =\n\\sum \n\nn\\in \\scrN m\n\n\\sum \n(qi,p)\\in \\scrV n,m\n\n\\lambda n,mqi,p \\cdot \\widehat qwater(qi, p, \\~Gn,m),\n\\forall \\widehat qwater(qi, p, \\~Gn,m) \\in \\scrU \\widehat qwater(qi,p,Gn,m)\n\n\\~qmgas =\n\\sum \n\nn\\in \\scrN m\n\n\\sum \n(qi,p)\\in \\scrV n,m\n\n\\lambda n,mqi,p \\cdot \\widehat qgas(qi, p, \\~Gn,m),\n\\forall \\widehat qgas(qi, p, \\~Gn,m) \\in \\scrU \\widehat qgas(qi,p,Gn,m)\n\nWith this substitution it is possible to use the same steps used in\nSection 3.3 to find the robust counterpart problem. Therefore, the\nrobust production optimization problem can be viewed as:\n\nPRC : \\mathrm{m}\\mathrm{a}\\mathrm{x}\n\\sum \nn\\in \\scrN \n\n\\=qnoil,\\mathrm{i}\\mathrm{n}\\mathrm{f} (4.6a)\n\nsubject to a limited compression capacity:\n\ns.t. :\n\\sum \nn\\in \\scrN \n\nqninj \\leq Q\n\\mathrm{m}\\mathrm{a}\\mathrm{x}\ninj , (4.6b)\n\nand for each well n \\in \\scrN :\nq\nn,m\ninj =\n\n\\sum \n(qi,p)\\in \\scrV n,m\n\n\\lambda n,mqi,p \\cdot qi, \\forall m \\in \\scrM n, (4.6c)\\sum \nm\\in \\scrM n\n\nq\nn,m\ninj = q\n\nn\ninj, (4.6d)\\sum \n\n(qi,p)\\in \\scrV n,m\n\\lambda n,mqi,p \\cdot p \\leq p\n\nm \\leq \n\\sum \n\n(qi,p)\\in \\scrV n,m\n\\lambda n,mqi,p \\cdot p + . . .\n\n. . . pm,\\mathrm{m}\\mathrm{a}\\mathrm{x}(1 - zn,m), \\forall m \\in \\scrM n,\n(4.6e)\n\n\\=q\nn,m\nh,\\mathrm{i}\\mathrm{n}\\mathrm{f} =\n\n\\sum \n(qi,p)\\in \\scrV n,m\n\n\\lambda n,mqi,p \\cdot \\widehat q n,mh,\\mathrm{i}\\mathrm{n}\\mathrm{f} (qi, p), \\forall m \\in \\scrM n, \\forall h \\in \\scrH , (4.6f)\n\n\n\n118 Chapter 4. Robust production optimization models\n\n\\=q\nn,m\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p} =\n\n\\sum \n(qi,p)\\in \\scrV n,m\n\n\\lambda n,mqi,p \\cdot \\widehat q n,mh,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi, p), \\forall m \\in \\scrM n, \\forall h \\in \\scrH , (4.6g)\\sum \nm\\in \\scrM n\n\n\\=q\nn,m\nh,\\mathrm{i}\\mathrm{n}\\mathrm{f} = \\=q\n\nn\nh,\\mathrm{i}\\mathrm{n}\\mathrm{f}, \\forall h \\in \\scrH , (4.6h)\\sum \n\nm\\in \\scrM n\n\n\\=q\nn,m\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p} = \\=q\n\nn\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p}, \\forall h \\in \\scrH , (4.6i)\\sum \n\nm\\in \\scrM n\n\nzn,m = yn, (4.6j)\\Bigl( \n\\lambda n,mqi,p\n\n\\Bigr) \n\\scrV n\n\ninduces a PWL function, \\forall m \\in \\scrM n, (4.6k)\n\nand for each manifold m \\in \\scrM :\n\\=qmh,\\mathrm{s}\\mathrm{u}\\mathrm{p} \\leq q\n\nm,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nh , \\forall h \\in \\scrH , (4.6l)\n\n\\=qmh,\\mathrm{s}\\mathrm{u}\\mathrm{p} =\n\\sum \n\nn\\in \\scrN m\n\n\\=q\nn,m\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p}, \\forall h \\in \\scrH  - \\{ gas\\} , (4.6m)\n\n\\=qmgas,\\mathrm{s}\\mathrm{u}\\mathrm{p} =\n\\sum \n\nn\\in \\scrN m\n\n(\\=qn,mgas,\\mathrm{s}\\mathrm{u}\\mathrm{p} + q\nn,m\ninj ), (4.6n)\n\n\\=qmh,\\mathrm{i}\\mathrm{n}\\mathrm{f} =\n\\sum \n\nn\\in \\scrN m\n\n\\=q\nn,m\nh,\\mathrm{i}\\mathrm{n}\\mathrm{f}, \\forall h \\in \\scrH  - \\{ gas\\} , (4.6o)\n\n\\=qmgas,\\mathrm{i}\\mathrm{n}\\mathrm{f} =\n\\sum \n\nn\\in \\scrN m\n\n(\\=q\nn,m\ngas,\\mathrm{i}\\mathrm{n}\\mathrm{f} + q\n\nn,m\ninj ), (4.6p)\n\n\\=\\Delta pm =\n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot \n\n\\widehat \\Delta p(qliq, glr, wc, Im), (4.6q)\npm = pmsep +\n\n\\=\\Delta pm, (4.6r)\n\npm,\\mathrm{m}\\mathrm{i}\\mathrm{n} \\leq pm \\leq pm,\\mathrm{m}\\mathrm{a}\\mathrm{x}, (4.6s)\nzn,m \\leq ym, n \\in \\scrN m, (4.6t)\\sum \nn\\in \\scrN m\n\nzn,m \\geq ym, (4.6u)\\Bigl( \n\\gamma mqliq,glr,wc\n\n\\Bigr) \n\\scrT m\n\ninduces a PWL function, (4.6v)\n\nwith:\n\nyn \\in \\{ 0, 1\\} , \\forall n \\in \\scrN , (4.6w)\nym \\in \\{ 0, 1\\} , \\forall m \\in \\scrM , (4.6x)\nzn,m \\in \\{ 0, 1\\} , \\forall n \\in \\scrN , \\forall m \\in \\scrM n. (4.6y)\n\n\n\n4.2. Robust Production Optimization \u2013 Subsea Manifold 119\n\nand the equality relaxation approach \u2013 Eqs. Eq. 4.5a-Eq. 4.5c \u2013 re-\nsult in the following constraints, for all m \\in \\scrM :\n\n\\=qmliq,\\mathrm{i}\\mathrm{n}\\mathrm{f} \\leq \n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot qliq, (4.7a)\n\n\\=qmliq,\\mathrm{s}\\mathrm{u}\\mathrm{p} \\geq \n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot qliq, (4.7b)\n\n\\=qmwater,\\mathrm{i}\\mathrm{n}\\mathrm{f} \\leq \n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot wc \\cdot qliq, (4.7c)\n\n\\=qmwater,\\mathrm{s}\\mathrm{u}\\mathrm{p} \\geq \n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot wc \\cdot qliq, (4.7d)\n\n\\=qmgas,\\mathrm{i}\\mathrm{n}\\mathrm{f} \\leq \n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot glr \\cdot qliq, (4.7e)\n\n\\=qmgas,\\mathrm{s}\\mathrm{u}\\mathrm{p} \\geq \n\\sum \n\n(qliq,glr,wc)\\in \\scrT m\n\\gamma mqliq,glr,wc \\cdot glr \\cdot qliq, (4.7f)\n\nand the SOS2 models for \\lambda n,mqi,p and \\gamma \nm\nqliq,glr,wc\n\nremain the same as in\nEqs. (4.4).\n\nFormulation (4.4)-(4.6)-(4.7) (PRC) is a robust version of For-\nmulation (4.3)-(4.4) ( \\=P ). The additional variables for the robust\nproblem are:\n\n\\bullet \\=qn,mh,\\mathrm{i}\\mathrm{n}\\mathrm{f} (\\=q\nn,m\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p}) is the infimum (supremum) of the production\n\ncomponent h from well n directed to manifold m.\n\n\\bullet \\=qnh,\\mathrm{i}\\mathrm{n}\\mathrm{f} (\\=q\nn\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p}) is the infimum (supremum) production rate of\n\ncomponent h of well n;\n\n\\bullet \\=qmh,\\mathrm{i}\\mathrm{n}\\mathrm{f} (\\=q\nm\nh,\\mathrm{s}\\mathrm{u}\\mathrm{p}) is the infimum (supremum) production rate of\n\ncomponent h flowing to manifold m;\n\nalso the following parameters are introduced:\n\n\\bullet \\widehat q n,mh,\\mathrm{i}\\mathrm{n}\\mathrm{f} (qi, p) and \\widehat q n,mh,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi, p) are respectively the lower and up-\nper limits of the range model which defines the uncertainty set\n\\scrU \\widehat qh(qi,Gn,m). This relates to the production of component h as-\nsociated with the breakpoint (qi, p) of well n when connected\nto manifold m.\n\nNote that the set of Eqs. (4.4)-(4.6)-(4.7) is similar to set of Eqs.\n(4.3)-(4.4). PRC is also an MILP, but solving it produces a solution\n\n\n\n120 Chapter 4. Robust production optimization models\n\nthat satisfies any realization of the uncertain parameters that are\nwithin the uncertainty set and that is robust optimal.\n\n4.3 SUMMARY\n\nThis chapter presented two standard production optimization\nproblems. For both a MILP formulation was described considering\nnominal values for all parameters. For each problem, one containing\nsatellite wells and one with wells and subsea completion, a robust\nreformulation of the problem was implemented considering uncer-\ntainty in the well-production curves. The methodology used was\nsimilar to the one detailed in Chapter 3, but for the second prob-\nlem the methodology is extended to account for uncertain equality\nconstraints.\n\n\n\n5 EXPERIMENTS\n\nIn order to analyze the influence of uncertain parameters on\ndaily production optimization, a synthetic but representative oil\nfield was instantiated in a commercial multiphase flow simulator.\nThe experimental scenario consists of the production plant layout,\nwells, processing facilities, and other equipment. The uncertainty\narises in some of the parameters that characterize the wells of the\noil field. The remainder of the chapter presents the oil field, the\nparameters that are assumed uncertain, and experimental results\ncontrasting the performance of nominal and robust optimization of\ngas-lifted oil field with satellite wells.\n\n5.1 OIL FIELD SCENARIO\n\nThe oil field has a structural configuration similar to the in-\nstances considered by Codas and Camponogara [8], which consists\nof one lift-gas compressor, two separation facilities, and five satellite\nwells, which were modified so that three wells have routing options\nand the remaining two have fixed routings to the separation units.\nFigure 5.1 illustrates this production network. For the equipment,\nonly gas compression capacity and liquid separation limits are im-\nposed. Two scenarios are created by combining different capacities\nfor compressor and separators. Moreover, we consider distinct sep-\naration pressures for the separation unit. Table 5.1 gives the param-\neters and other data defining the production scenarios. The oil field\nis instantiated in the multiphase flow simulator Pipesim, which is\nwidely used by the Oil and Gas Industry. The well production curves\nare also obtained from the same simulator. Field data used to repre-\nsent the synthetic oil field is extracted from the five wells described\nin [79]. Some minor changes are made to adapt the length of the\nflow lines to suite the installation of routing valves and the connec-\ntions to two separators. The simulator default values are used for\n\nTable 5.1: Operating scenarios.\n\nCompressor Separator 1 Separator 2\n\u2014 p1sep = 250 psia p\n\n2\nsep = 150 psia\n\nScenario Q\\mathrm{m}\\mathrm{a}\\mathrm{x}inj q\n1,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nliq q\n\n2,\\mathrm{m}\\mathrm{a}\\mathrm{x}\nliq\n\n1 7 mmscf/d 3500 STB/d 3700 STB/d\n2 5 mmscf/d 3000 STB/d 3000 STB/d\n\n121\n\n\n\n122 Chapter 5. Experiments\n\nGL Compressor\n\nGL Manifold\n\nWells\n\nRouting\n\nSeparators\n\nGas - Oil - Water\n\nFigure 5.1: Production network.\n\nthe parameters and correlations that are not described in the paper.\nTable 5.2 presents part of the nominal values for the field data used\nin the simulated oil field.\n\nSince the idea is to compare the results produced by standard\nproduction optimization using nominal data and robust production\noptimization, it is necessary to generate the piecewise-linear produc-\ntion curves for the standard problem. The well production curves\nare obtained by sampling the Pipesim simulator, using Algorithm 1\nwhich is presented and detailed in Appendix A. The breakpoints for\neach production curve are defined allowing a maximum approxima-\ntion error of 0.25\\% (\\varepsilon \\%).\n\n\n\n5.2. Uncertain Parameters 123\n\nTable 5.2: Nominal field data.\n\nWell \\# (n) 1 2 3 4 5\nGLR [scf/STB] \\bftwo \\bffive \\bfzero \\bfthree \\bfzero \\bfzero \\bfthree \\bffive \\bfzero \\bfthree \\bffive \\bfzero \\bfthree \\bftwo \\bfzero \nWC [fraction] \\bfzero .\\bfsix \\bfzero .\\bfseven \\bfzero .\\bfeight \\bfzero .\\bfseven \\bfzero .\\bfsix \nSG Gas [fraction]\\ast 0.8\nSG Oil [\\circ API]\\ast 35\nSG Water [fraction]\\ast 1.07\nReservoir pressure [psia] 1750 1850 1900 1850 1800\nPI [STB/d/psi] 2 2.5 3 3.7 2.5\nReservoir temperature [\\circ F] 180 190 190 190 190\nDepth of perforations [ft] 4600 5000 5900 5900 5500\nTubing ID [inches] 2.875 3 2 2 2\nCasing ID [inches]\\ast 6.366\nWellhead temperature [\\circ F]\\ast 110\nFlow lines ID [inches]\\ast 4\nFlow line length[ft] 8000 5000 4000 5000 6000\n\n\\ast same values for all the wells\n\n5.2 UNCERTAIN PARAMETERS\n\nAlthough the robust formulation for production optimization\npresented in Section 4.1.2 allows selecting as uncertain any param-\neter of Table 5.2 \u2013 which characterize the production curves, the\nstudies herein model uncertainties only in the gas-liquid ratio (GLR)\nand water cut (WC). This choice is not arbitrary because GLR and\nWC play a major part in characterizing a well behavior: these param-\neters tend to exhibit a higher short-term variability when compared,\nfor example, with reservoir pressure and flow line ID. Another good\ncandidate for uncertainty modeling would be the productivity in-\ndices, but for the present experiment their values are considered\nknown and unique.\n\nTable 5.3 has the percentage variation for GLR and WC for\neach well n from its nominal values presented in Table 5.2. This\nmeans that GLR and WC of each well does not have a unique and\ndeterministic value. On the contrary, it is unknown but belongs to a\ngiven set centered at the nominal value, varying according with an\nunknown probability distribution. Notice that the percentage varia-\ntions are merely illustrative, as they are not based on any study.\n\nWe define that for each well, the parameters composing this\nuncertainty set are not correlated, therefore the sets have the shape\n\n\n\n124 Chapter 5. Experiments\n\nTable 5.3: Percentage variation from nominal value.\n\nWell \\# (n) 1 2 3 4 5\nGLR \\pm 20\\% \\pm 25\\% \\pm 20\\% \\pm 6\\% \\pm 15\\%\nWC \\pm 10\\% \\pm 20\\% \\pm 5\\% \\pm 10\\% \\pm 10\\%\n\nof a box in \\BbbR 2. In order to generate the uncertainty set for the pro-\nduction value of each breakpoint, we developed a script in Python\n(programming language) that interacts with the simulator. It imple-\nments a Monte Carlo method to define upper (\\widehat q n,sh,\\mathrm{s}\\mathrm{u}\\mathrm{p}(qi)) and lower\n(\\widehat q n,sh,\\mathrm{i}\\mathrm{n}\\mathrm{f}(qi)) bound values for the breakpoints, which are used directly\nin the robust formulation (4.2).\n\n5.3 COMPUTATIONAL RESULTS\n\nAll optimization problems are modeled in AMPL program-\nming language and solved using IBM ILOG CPLEX 12.6 solver. The\noptimization models use data gathered in the steps described in Sec-\ntion 5.1 and 5.2. All those steps are depicted in the upper half of\nFigure 5.2, which is a diagram describing the entire experimental\nprocedure. For each operating scenario (see Table 5.1) standard and\nrobust production optimization models are solved. The calculated\nnominal-optimal and robust-optimal solutions \u2013 lift-gas injections\nand routing decisions \u2013 are stored.\n\nThe solutions are used as the operating settings for the syn-\nthetic oil field instantiated in the multiphase flow simulator. How-\never, since our oil field has uncertain parameters, which have values\nmodeled by ranges, we have to artificially create hypothetical in-\nstances of the oil field. This is achieved by randomly choosing values\nfor the uncertain parameters within its range model. An instance, a\nrandom selection of all uncertain parameters, is here referred as a\ncase. Figure 5.3 has the GLR and WC values selected for each well\nin each case. The hatched area corresponds to the bounds given in\nTable 5.3 for the respective uncertainty regions of each well. For\neach scenario of optimization, the total oil production obtained in\nevery instance of the synthetic oil field using the robust setpoints\nis in the last row of Table 5.4 and 5.5. The values for the total oil\nproduction induced by nominal setpoints are in the middle rows of\nthe same tables. In order to provide a benchmark for the oil produc-\ntions mentioned above, we solved optimization problems for each\noil field instance using production curves modeled with the exact\n\n\n\n5.3. Computational Results 125\n\nNominal\nparameters\n\nvalues\n\nbreakpoints\n\nUncertain\nparameters\n\nranges\n\nPWL well-\nproduction curve\n\nPWL envelope\ncurves\n\nScenario of\nconstratins\n\nRouting and lift-gas injection decisions\n\nMultiphase production\nin the separators\n\nPossible realization\nof the uncertain\n\nparameters\n\nStandard Formulation Robust Formulation\n\n(AMPL programming language)\n+\n\n(IBM ILOG CPLEX 12.6 solver)\n\nSynthetic production \ncurves\n\n(multiphase flow simulator)\n\nMonte Carlo\nMethod\n(python)\n\nSampling algorithm\n(python)\n\nSynthetic oil field\n(multiphase flow simulator)\n\nFigure 5.2: Experimental procedure diagram.\n\n\n\n126 Chapter 5. Experiments\n\nFigure 5.3: Instances of the uncertain data.\n\ndata for each respective case. The solutions of these optimization\nproblems were than used in same particular oil field simulator in-\nstance. The total oil production achieved is referred as a theoretical,\nor let\u2019s say utopic, solution for the problem. Those values are also\nin Table 5.4 and 5.5.\n\nFigure 5.4 condensates all the information on these tables.\nNominal solutions are plotted next to the robust solution in each\nthe corresponding scenario and case. The theoretical solution is also\ndepicted in dashed bars. As expected, for each scenario, the theoret-\nical total production differs depending on the case taken. For the\nfirst scenario, which is less restrictive, the nominal solution induces\n\n\n\n5.3. Computational Results 127\n\nFigure 5.4: Total production comparison for each scenario of opti-\nmization.\n\n\n\n128 Chapter 5. Experiments\n\nTable 5.4: Scenario 1.\n\nOil field Instances (Cases)\nNominal 1 2 3\n\nSolution q\\mathrm{o}\\mathrm{i}\\mathrm{l} q\\mathrm{o}\\mathrm{i}\\mathrm{l} q\\mathrm{o}\\mathrm{i}\\mathrm{l} q\\mathrm{o}\\mathrm{i}\\mathrm{l}\nTheoretical 2304 2523 1945 2513\nNominal 2304 2521 1942 2496\nRobust 2265 2456 1867 2482\n\n\\ast oil rates in [STB/d]\n\nTable 5.5: Scenario 2.\n\nOil field Instances (Cases)\nNominal 1 2 3\n\nSolution q\\mathrm{o}\\mathrm{i}\\mathrm{l} q\\mathrm{o}\\mathrm{i}\\mathrm{l} q\\mathrm{o}\\mathrm{i}\\mathrm{l} q\\mathrm{o}\\mathrm{i}\\mathrm{l}\nTheoretical 2035 2244 1772 2263\nNominal 2035 Unfeasible Unfeasible 2208\nRobust 1719 1784 1721 1657\n\n\\ast oil rates in [STB/d]\n\nan average oil production that is about 2\\% higher than the produc-\ntion obtained with robust optimization. In the second scenario, for\nthe oil field instances of cases 1 and 2, separation capacities are vi-\nolated by the nominal solution. This trend of a higher performance\nof the nominal solution over the robust solution in a optimization\nscenario where constraints are not so tight is expected. However, for\nthis scenario when both solutions are feasible the robust approach\nproduces 25\\% less oil than the nominal. It is important to notice that\nthe difference between the optimal objective function (total oil pro-\nduction) calculated using piecewise-linear functions and obtained\nby simulation (using the optimized injections and routings) is, for\nall cases, less than 0.6\\% for both scenarios, which validates the use\nof the Algorithm 1 for sampling the production curves.\n\nThe results obtained suggest the use of robust solutions un-\nder critical situations, when operation is not allowed to suffer with\nconstraint violations, or as a safe set of initial operational setpoints,\nthat would then be further modified to enhance production.\n\n5.4 SUMMARY\n\nThis chapter presented experimental results for the produc-\ntion optimization problem with satellite wells. Results of robust and\n\n\n\n5.4. Summary 129\n\nstandard solutions are compared in synthetic oil field instantiated\nin a commercial multiphase flow simulator. A Robust solution is\nindicated for critical operational scenarios where feasibility takes\nprecedence over production maximization.\n\n\n\n\n\n6 CONCLUSION\n\nThe daily operation of an oilfield in an optimal manner is a\ntask of high complexity. In order to propose the optimal setpoints\nfor operating an oil field, operators and petroleum engineers had\ncount in the past, and still today, with their practical and theoretical\nknowledge, on the wells and equipment behavior, and with simula-\ntion tools, which mimic the oil fields, and enable sensitivity and sce-\nnario analysis. All this is not always sufficient to produce the actual\noptimal setpoints, specially under unconventional operating scenar-\nios, e.g. an equipment is down due to failure or maintenance, a new\nwell is put into operation. More recently, mathematical tools have\nbeing designed to help operators to take the appropriate decisions\nthat would lead to an optimal operation. These tools are based on\nmathematical programming models which are used to solve a pro-\nduction optimization problem. Modeling is a key aspect of those\napproaches, since the strategies to solve the optimization problems\nare directly linked to the mathematical characteristics of the pro-\nduction models.\n\nSpecifically for oil fields operated by gas-lift systems, there\nare many different modeling approaches that were designed to solve\ndistinct production problems. For example, some can only handle\nunconstrained problems, while others only satellite wells, others are\nvery complete and can deal with subsea completion, routing deci-\nsions and more. However, the absolute majority of those modeling\napproaches do not account for uncertainties that might influence\nthe quality of the models and consequently the results of the opti-\nmization problems. Uncertainty is inherent to production systems.\nIt could arise from measurement errors, lack of informative data,\nand insufficiently detailed models, among others.\n\nIn this dissertation we proposed a methodology to incorpo-\nrate uncertainty in the parameters of the wells and equipment into\nthe production models used for optimization. Then, starting with\nthe uncertain production models, we used the results from the ro-\nbust linear optimization theory to develop robust MILP formula-\ntions for the production optimization problem. The robust formu-\nlations are independent of the parameters chosen to carry the un-\ncertainties. They also do not require knowledge of probability distri-\nbutions, only assuming that the uncertain parameters are confined\nwithin a known set.\n\nFor two standard production optimization of gas-lifted oil\nfield problems the methodology is applied and the resulting robust\nproduction optimization models are presented. The first consists in\n\n131\n\n\n\n132 Chapter 6. Conclusion\n\ndistributing a limited rate of pressurized gas for a group of gas-lifted\nsatellite wells, with the selection of production routing under mul-\ntiple constraints. The second problem is similar, but the gas-lifted\nwells have their production traveling through subsea manifolds and\nshared flow lines. Thus, pressure constraints apply. For the latter\nproblem uncertain equality constraints appear and we had to ex-\ntend the classical theory for robust linear optimization to account\nfor this type of structure.\n\nFor an oilfield scenario containing satellite wells, robust and\nstandard (this based on nominal values) optimization problems are\nsolved. A comparison between both solutions, when applied to dif-\nferent realizations within the uncertainty sets, shows that the stan-\ndard solution may lead to an unfeasible operation, whereas the ro-\nbust solution always gives a feasible operating condition. However,\nfor some scenarios of the constraints the robust approach may pro-\nvide a too conservative solution with underproduction. This seems\nto be a drawback for using the robust solution. In most operational\nsituations, that may actually be true. Nevertheless, for critical sit-\nuations, when even slight infeasibility is not an option, the robust\nsolution can provide the best guideline for field operators.\n\n6.1 FURTHER DEVELOPMENTS\n\nFuture work will consider the influence of other parameters\nand their variation, since the uncertain parameters may not vary as\nsignificantly as assumed in the experiments.\n\nWe also leave two suggestions with regards to the conser-\nvatism of the robust solution and its potential to be used in real\nworld application.\n\nOne suggestion relates to the choice in this dissertation to\nseek for column-wise uncertainty models for the uncertain param-\neters in production optimization problems. This framework is no-\ntably more conservative. Under mild assumptions that were not\nmade in our developments, it is possible to create a row-wise un-\ncertainty model. This would lead to a different robust production\noptimization model and perhaps a less conservative solution. An-\nother strategy in this same line would be to adapt the cardinality\nconstrained uncertainty set developed by Bertsimas and Sim [64]\nto be used for production optimization problems.\n\nA second suggestion is to use a distinct robust paradigm other\nthan the classical one used here. Another approach idea would be\n\n\n\n6.1. Further developments 133\n\nto solve a series of robust problems in a path to the real optimal oil\nfield operation, in a multistage setting. The first stage would pro-\nvide solutions similar to the ones of this dissertation. However, for\nany forthcoming stage an evaluation of the impacts of the applica-\ntion of the previous solution would be used to refine the problem\nand reduce the level of uncertainty. The idea of this method is to\ncreate a safe path to optimality.\n\n\n\n\n\nREFERENCES\n\n1 ECONOMIDES, M. J. et al. Petroleum production systems. 2nd. ed.\nUpper Saddle River, NJ: Prentice Hall, 2012.\n\n2 FOSS, B. A.; JENSEN, J. P. Performance Analysis for Closed-Loop\nReservoir Management. SPE Journal, v. 16, n. 01, p. 183\u2013190, apr.\n2011.\n\n3 REDDEN, J.; SHERMAN, T.; BLANN, J. Optimizing gas-lift systems.\nFall Meeting of the Society of Petroleum Engineers of AIME, 1974.\n\n4 BUITRAGO, S.; RODRIGUEZ, E.; ESPIN, D. Global optimization\ntechniques in gas allocation for continuous flow gas lift systems. SPE\nGas Technology Symposium, 1996.\n\n5 KOSMIDIS, V. D.; PERKINS, J. D.; PISTIKOPOULOS, E. N.\nOptimization of Well Oil Rate Allocations in Petroleum Fields.\nIndustrial &amp; Engineering Chemistry Research, v. 43, p. 3513\u20133527, 2004.\n\n6 CAMPOS, S. et al. Urucu Integrated Production Model. Proceedings\nof SPE Intelligent Energy Conference and Exhibition, n. 2005, p. 1\u201321,\n2010.\n\n7 GUNNERUD, V.; FOSS, B. Oil production optimization-A piecewise\nlinear model, solved with two decomposition strategies. Computers and\nChemical Engineering, v. 34, n. 11, p. 1803\u20131812, 2010.\n\n8 CODAS, A.; CAMPONOGARA, E. Mixed-integer linear optimization\nfor optimal lift-gas allocation with well-separator routing. European\nJournal of Operational Research, v. 217, n. 1, p. 222\u2013231, feb. 2012.\n\n9 SILVA, T. L.; CAMPONOGARA, E. A computational analysis of\nmultidimensional piecewise-linear models with applications to oil\nproduction optimization. European Journal of Operational Research,\nElsevier B.V., v. 232, n. 3, p. 630\u2013642, feb. 2014.\n\n10 LIMA, T. et al. Modeling of flow splitting for production\noptimization in offshore gas-lifted oil fields: Simulation validation and\napplications. Journal of Petroleum Science and Engineering, Elsevier,\nv. 128, p. 86\u201397, 2015.\n\n11 ELGS\u00c6TER, S.; SLUPPHAUG, O.; JOHANSEN, T. A. Production\noptimization; System Identification and Uncertainty Estimation.\nIntelligent Energy Conference and Exhibition, 2008.\n\n135\n\n\n\n136 References\n\n12 NAKASHIMA, P.; CAMPONOGARA, E. Solving a gas-lift\noptimization problem by dynamic programming. IEEE Transactions on\nSystems, Man, Cybernetics \u2014 Part A, v. 36, n. 2, p. 407\u2013414, 2006.\n\n13 BIEKER, H. P.; SLUPPHAUG, O.; JOHANSEN, T. A. Well\nManagement Under Uncertain Gas/ or Water/Oil Ratios. Proceedings of\nDigital Energy Conference and Exhibition, p. 1\u20136 \u2013 SPE106959, 2007.\n\n14 ELGS\u00c6TER, S. M.; SLUPPHAUG, O.; JOHANSEN, T. A. A\nstructured approach to optimizing offshore oil and gas production\nwith uncertain models. Computers &amp; Chemical Engineering, v. 34, p.\n163\u2013176, 2010.\n\n15 BEN-TAL, A.; NEMIROVSKI, A. Robust solutions of uncertain linear\nprograms. Operations Research Letters, v. 25, n. 1, p. 1\u201313, aug. 1999.\n\n16 BEN-TAL, A.; NEMIROVSKI, A. Robust solutions of linear\nprogramming problems contaminated with uncertain data. Math.\nProgramming, v. 88, n. 3, p. 411\u2013421, sep. 2000.\n\n17 BEN-TAL, A.; GHAOUI, L. E.; NEMIROVSKI, A. Robust\nOptimization. New Jersey: Princeton University Press Requests, 2009.\n\n18 BERTSIMAS, D.; BROWN, D. B.; CARAMANIS, C. Theory and\nApplications of Robust Optimization. SIAM Review, v. 53, n. 3, p.\n464\u2013501, jan. 2011.\n\n19 DENEHY, D. Oil &amp; gas: the production story. 2nd. ed. Austin, TX:\nThe University of Texas at Austin, 2008.\n\n20 BOMMER, P. A primier of oilwell drilling. 7th. ed. Austin, TX: The\nUniversity of Texas at Austin, 2008.\n\n21 THOMAS, J. E. Fundamentos de engenharia do petr\u00f3leo. 2nd. ed.\nRio de Janeiro, RJ: Editora Interci\u00eancias, 2001.\n\n22 DENEHY, D. Fundamentals of Petroleum. 5th. ed. Austin, TX: The\nUniversity of Texas at Austin, 2011.\n\n23 SAPUTELLI, L. et al. Promoting Real-Time Optimization of\nHydrocarbon Producing Systems. Proceedings of Offshore Europe,\np. 1\u20139, 2003.\n\n24 BEGGS, H. Production Optimization: using NODAL analysis. 2nd.\ned. Tulsa, Oklahoma: Oil &amp; Gas Consultants Intl., 2003.\n\n\n\nReferences 137\n\n25 VOGEL, J. V. Inflow Performance Relationships for Solution-Gas\nDrive Wells. Journal of Petroleum Technology, v. 20, n. 01, p. 83\u201392, apr.\n1968.\n\n26 BRADLEY, H.; GIPSON, F. (Ed.). Petroleum engineering handbook.\n3rd. ed. Richardson, TX: Society of Petroleum Engineers, 1987.\n\n27 SANTOS, O. G.; BORDALO, S. N.; ALHANATI, F. J. S. Study of the\ndynamics, optimization and selection of intermittent gas-lift methods \u2014\na comprehensive model. Journal of Petroleum Science and Engineering,\nv. 32, p. 231\u2013248, 2001.\n\n28 BERTUZZI, A.; WELCHON, J.; POETTMAN, F. Description and\nAnalysis of an Efficient Continuous-Flow Gas-Lift Installation. Journal\nof Petroleum Technology, v. 5, p. 271\u2013278, 1953.\n\n29 TRIBBE, C.; M\u00dcLLER-STEINHAGEN, H. M. An evaluation of the\nperformance of phenomenological models for predicting pressure\ngradient during gas-liquid flow in horizontal pipelines. International\nJournal of Multiphase Flow, v. 26, p. 1019\u20131036, 2000.\n\n30 ULLMANN, a.; BRAUNER, N. Closure relations for two-fluid\nmodels for two-phase stratified smooth and stratified wavy flows.\nInternational Journal of Multiphase Flow, v. 32, p. 82\u2013105, 2006.\n\n31 MACH, J.; PROANO, E.; BROWN, K. E. A nodal approach for\napplying system analysis to the flowing and artificial lift oil or gas well.\nSPE, 1979.\n\n32 SAPUTELLI, L.; NIKOLAOU, M.; ECONOMIDES, M. J.\nSelf-Learning Reservoir Management. SPE Reservoir Evaluation &amp;\nEngineering, v. 8, n. 06, p. 534\u2013547, apr. 2005.\n\n33 CAMPONOGARA, E. et al. An automation system for gas-lifted\noil wells: Model identification, control, and optimization. Journal\nof Petroleum Science and Engineering, Elsevier B.V., v. 70, n. 3-4, p.\n157\u2013167, 2010.\n\n34 BIEKER, H. P.; SLUPPHAUG, O.; JOHANSEN, T. A. Real-Time\nProduction Optimization of Oil and Gas Production Systems: A\nTechnology Survey. SPE Production &amp; Operations, n. December 2006, p.\n11\u201313, 2007.\n\n35 SAPUTELLI, L. et al. A Critical Overview of Artificial Neural\nNetwork Applications in the Context of Continuous Oil Field\n\n\n\n138 References\n\nOptimization. Proceedings of SPE Annual Technical Conference and\nExhibition, p. 1\u20132, 2002.\n\n36 ALARC\u00d3N, G. A.; TORRES, C. F.; GOMEZ, L. E. Global\noptimization of gas allocation to a group of wells in artificial lift using\nnonlinear constrained programming. Journal of Energy Resources\nTechnology, v. 124, n. 4, p. 262\u2013268, 2002.\n\n37 CAMPONOGARA, E.; De Conto, A. M. Lift-Gas Allocation under\nPrecedence Constraints: MILP Formulation and Computational\nAnalysis. IEEE Transactions on Automation Science and Engineering, v. 6,\nn. 3, p. 544\u2013551, 2009.\n\n38 KOSMIDIS, V. D.; PERKINS, J. D.; PISTIKOPOULOS, E. N. A mixed\ninteger optimization formulation for the well scheduling problem\non petroleum fields. Computers and Chemical Engineering, v. 29, p.\n1523\u20131541, 2005.\n\n39 RASHID, K. Optimal allocation procedure for gas-lift optimization.\nIndustrial and Engineering Chemistry Research, v. 49, p. 2286\u20132294,\n2010.\n\n40 VIELMA, J. P.; AHMED, S.; NEMHAUSER, G. Mixed-Integer\nModels for Nonseparable Piecewise-Linear Optimization: Unifying\nFramework and Extensions. Operations Research, v. 58, n. 2, p.\n303\u2013315, apr. 2010.\n\n41 WILLIAMS, H. P. Model building in mathematical programming.\n5th. ed. London: Wiley, 2013.\n\n42 DANTZIG, G. B.; THAPA, M. N. Linear Programming. New York,\nNY: Springer-Verlag, 1997.\n\n43 WOLSEY, L. Integer Programming. 1st. ed. New York, NY:\nWiley-Interscience, 1998.\n\n44 WOLSEY, L.; NEMHAUSER, G. L. Integer and Combinatorial\nOptimization. 1st. ed. New York, NY: Wiley-Interscience, 1999.\n\n45 LI, D.; SUN, X. Nonlinear Integer Programming. New York, NY:\nSpringer, 2006.\n\n46 VANDERBEI, R. J. Linear Programming - Foundations and\nExtensions. New Jersey: Springer, 2008.\n\n\n\nReferences 139\n\n47 FOURER, R. Algebraic Modeling Languages for Optimization.\nNorthwestern University, 2013.\n\n48 FOURER, R.; GAY, D. M.; KERNINGHAN, B. W. AMPL - A Modeling\nLanguage for Mathematical Programming. New York, NY: Thomson\nBrooks/Cole, 2003.\n\n49 RANGAVAJHALA, S.; MULLUR, A.; MESSAC, A. The challenge of\nequality constraints in robust design optimization: examination and\nnew approach. Structural and Multidisciplinary Optimization, v. 34,\nn. 5, p. 381\u2013401, mar. 2007.\n\n50 DANTZIG, G. B. Linear Programming under Uncertainty.\nManagement Science, v. 1, n. 3-4, p. 197\u2013206, apr. 1955.\n\n51 BELLMAN, R. Dynamic Programming. 1. ed. Princeton, NJ, USA:\nPrinceton University Press, 1957.\n\n52 CHARNES, A.; COOPER, W. W. Chance-constrained programming.\nManagement Science, v. 6, n. 1, p. 73\u201379, 1959.\n\n53 SAHINIDIS, N. V. Optimization under uncertainty: State-of-the-art\nand opportunities. Computers and Chemical Engineering, v. 28, p.\n971\u2013983, 2004.\n\n54 ROCKAFELLAR, R. T. Optimization under uncertainty. Seattle, WA:\nUniversity of Washington, 2001.\n\n55 WALLACE, S. W. Decision making under uncertainty: Is sensitivity\nanalysis of any use? . Operations research, v. 48, n. 1, p. 20\u201325, feb.\n2000.\n\n56 WALD, A. Statistical Decision Functions Which Minimize the\nMaximum Risk. Annals of Mathematics, v. 46, n. 2, p. 265\u2013280, 1945.\n\n57 SOYSTER, A. L. Convex programming with set-inclusive\nconstraints and applications to inexact linear programming. Operations\nresearch, v. 21, n. February 2015, p. 1154\u20131157, 1973.\n\n58 BEN-TAL, A.; NEMIROVSKI, A. Robust Convex Optimization.\nMathematics of Operations Research, v. 23, n. i, p. 769\u2013805, 1998.\n\n59 EL GHAOUI, L.; LEBRET, H. Robust Solutions to Least-Squares\nProblems with Uncertain Data. SIAM Journal on Matrix Analysis and\nApplications, v. 18, p. 1035\u20131064, 1997.\n\n\n\n140 References\n\n60 EL GHAOUI, L.; OUSTRY, F.; LEBRET, H. Robust Solutions to\nUncertain Semidefinite Programs. SIAM Journal on Optimization, v. 9,\nn. 1, p. 33\u201352, 1998.\n\n61 KOUVELIS, P.; YU, G. Robust Discrete Optimization and its\nApplications. 1. ed. Boston, MA: Kluwer Academic Publishers, 1997.\n\n62 BERTSIMAS, D.; THIELE, A. Robust and data-driven optimization:\nModern decision-making under uncertainty. INFORMS Tutorials in . . . ,\nn. March, p. 1\u201339, 2006.\n\n63 GUERRA V\u00c1ZQUEZ, F. et al. Generalized semi-infinite\nprogramming: A tutorial. Journal of Computational and Applied\nMathematics, v. 217, p. 394\u2013419, 2008.\n\n64 BERTSIMAS, D.; SIM, M. The price of robustness. Operations\nresearch, v. 52, n. 1, p. 35\u201353, feb. 2004.\n\n65 MINOUX, M. Robust Linear Programming with Right-Hand-Side\nUncertainty, Duality and Applications. In: Encyclopedia of Optimization,\nSecond Edition. New York, NY: Springer, 2009. p. 3317\u20133327.\n\n66 RANGAVAJHALA, S.; MESSAC, A. Designer\u2019s preferences\nregarding equality constraints in robust design optimization. Structural\nand Multidisciplinary Optimization, v. 41, n. 1, p. 17\u201338, jul. 2009.\n\n67 BERTSIMAS, D.; SIM, M. Robust discrete optimization and\nnetwork flows. Mathematical Programming, v. 98, n. 1-3, p. 49\u201371, sep.\n2003.\n\n68 AVERBAKH, I. On the complexity of a class of combinatorial\noptimization problems with uncertainty. Mathematical Programming,\nv. 90, n. 2, p. 263\u2013272, 2001.\n\n69 ATAMT\u00dcRK, A. Strong formulations of robust mixed 0-1\nprogramming. Mathematical Programming, v. 108, n. 2-3, p. 235\u2013250,\n2006.\n\n70 VAN ESSEN, G. M. et al. Robust Optimization of Oil Reservoir\nFlooding. In: Conference on Control Applications. [S.l.: s.n.], 2006. p.\n699\u2013704.\n\n71 CHEN, C.; LI, G.; REYNOLDS, A. Robust constrained optimization\nof short and long-term NPV for closed-loop reservoir management. SPE\nReservoir Simulation Symposium, n. February, p. 1\u201323, 2011.\n\n\n\nReferences 141\n\n72 CAPOLEI, A. et al. A mean\u2013variance objective for robust\nproduction optimization in uncertain geological scenarios. Journal\nof Petroleum Science and Engineering, Elsevier, v. 125, n. 1, p. 23\u201337,\n2015.\n\n73 CAMPONOGARA, E.; NAKASHIMA, P. H. R. Solving a gas-lift\noptimization problem by dynamic programming. European Journal of\nOperational Research, v. 174, p. 1220\u20131246, 2006.\n\n74 H\u00dcLSE, E. O.; CAMPONOGARA, E. A mathematical programming\nformulation for robust production optimization of gas-lifted oil fields.\nIn: RODRIGUES, H. et al. (Ed.). Engineering Optimization 2014.\nLisbon: CRC Press, 2014. p. 891\u2013896.\n\n75 CODAS, A. et al. Integrated production optimization of oil fields\nwith pressure and routing constraints: The Urucu field. Computers &amp;\nChemical Engineering, Elsevier Ltd, v. 46, p. 178\u2013189, nov. 2012.\n\n76 AGUIAR, M. A. S.; CAMPONOGARA, E.; SILVA, T. L. A\nmixed-integer convex formulation for production optimization of\ngaslifted oil fields with routing and pressure constraints. Brazilian\nJournal of Chemical Engineering, v. 31, n. 2, p. 439\u2013455, 2014.\n\n77 BAZARAA, M. S.; SHERALI, H. D.; SHETTY, C. Nonlinear\nProgramming: Theory and Algorithms. 3rd. ed. New Jersey:\nWiley-Interscience, 2006.\n\n78 KALOS, M. H.; WHITLOCK, P. a. Monte Carlo Methods. 2nd. ed.\nWeinheim: Wiley, 2008. 203 p.\n\n79 SAEPUDIN, D. et al. Optimization of Gas Injection Allocation\nin Multi Gas Lift Wells System. In: . [S.l.]: Proceedings of the\nInternational Conference on Engineering Optimization, 2008.\n\n80 STONE, H. Approximation of curves by line segments.\nMathematics of Computation, v. 15, n. 73, p. 40\u201340, 1961.\n\n81 CANTONI, A. Optimal Curve Fitting With Piecewise Linear\nFunctions. IEEE Transactions on Computers, C-20, n. 1, p. 59\u201367, 1971.\n\n\n\n\n\nAPPENDIX A \u2014 SAMPLING ALGORITHMS\n\nApproximating a complicated function by piecewise functions\nis an alternative to reduce complexity. This is a common approach\nin optimization to create tractable versions of originally hard to\nsolve problems. In this line, the most ordinary approach is to build\npiecewise-linear (PWL) functions, where in each interval a linear\nfunction is used to represent the original function. When the orig-\ninal function is well defined (with known derivatives), or at least\nhas a mathematical description, many algorithms exist to find the\nappropriate breakpoints that define the intervals, and to designate\ntheir linear approximations, e.g. [80, 81].\n\nHowever, if the original function is conceptual (i.e., has no\nmathematical description) those algorithms do not apply. Some al-\ngorithms have been proposed for this situation [75], but they rely\non the fact that a very fine sampling step is performed a priori. Then\nunnecessary breakpoints are removed. The remaining points delimit\nthe intervals and are used to define the linear functions.\n\nDepending on the accuracy required, acquiring this overly\nsampled set of breakpoints may be time consuming. We notice, how-\never, that a special set of conceptual functions can be seen as qua-\nsiconvex and that it is possible to explore this structure even if the\nfunction does not have a mathematical formulation. Following, two\nalgorithms are suggested. For a given maximum tolerated error they\ndetermine breakpoints that define the intervals and the respective\nlinear functions that approximate the original function. Both algo-\nrithms are based on the fact that, if a conceptual function is quasi-\nconcave the error between this function and a linear approximation\nof it is also a quasiconcave function. Also, the two are only applica-\nble to univariate functions.\n\nALGORITHMS\n\nLet \\widehat g(x) be an unidimensional conceptual function with a con-\ncave shape in the interval [l, u] \\subset \\BbbR . An algorithm receives as input\na subset [a, c] \\subseteq [l, u] and a maximum tolerable approximation error\n(i.e. absolute error) \\varepsilon . Then, it attempts to find a set of breakpoints\n\\scrB = \\{ b1 = a, b2, . . . , bT  - 1, bT = c\\} , with b1 &lt;b2 &lt;\\cdot \\cdot \\cdot &lt;bT , that\ndefine a piecewise-linear function,\n\n\\widehat h(x) =\n\\Biggl\\{ \\widehat h(bk,bk+1)(x) = \\alpha k \\cdot x + \\beta k if bk \\leq x \\leq bk+1, . . .\n\n. . . k = \\{ 1, . . . , T  - 1\\} .\n\n143\n\n\n\n144 APPENDIX A \u2014 Sampling Algorithms\n\nwhere,\n\n\\alpha k =\n\\widehat g(bk+1) - \\widehat g(bk)\n\nbk+1  - bk\n, \\beta k =\n\n\\widehat g(bk) \\cdot bk+1  - \\widehat g(bk+1) \\cdot bk\nbk+1  - bk\n\nwhich is an approximation of the function \\widehat g(x). \\alpha k and \\beta k induce\neach individual linear segment to pass through the point (bk, \\widehat g(bk))\nand (bk+1, \\widehat g(bk+1)). The algorithm select the breakpoints ensuring\nthat \\widehat e(x) \\leq \\varepsilon , \\forall x \\in [a, c], where \\widehat e(x) = \\widehat g(x)  - \\widehat h(x) is the absolute\nerror of approximation. More specifically,\n\n\\widehat e(x) =\n\\Biggl\\{ \\widehat e(bk,bk+1)(x) = \\widehat g(x) - \\widehat h(bk,bk+1)(x) if bk \\leq x \\leq bk+1, . . .\n\n. . . k = \\{ 1, . . . , T  - 1\\} .\n\nFollowing, we proposed two heuristics to achieve this result.\n\n\u201cSearch method\u201d algorithm\n\nThe heuristic used for Algorithm 1 is based on finding the\nmaximum of \\widehat e(x) for a given interval. Then, if this value is larger\nthan \\varepsilon , three actions are taken: the breakpoint corresponding to\nthe maximum point is added to set \\scrB , the interval is split at this\nbreakpoint, and the procedure is called recursively for the two new\nintervals. The process stops when all intervals covered have a \\widehat e(x)\nnot greater than \\varepsilon .\n\nBecause \\widehat e(x) is defined by \\widehat g(x), which has no mathemati-\ncal description, thus no derivative explicitly available, one has to\nuse derivative-free methods, as line search without using derivative\nmethods [77], in order to compute the operators \\mathrm{m}\\mathrm{a}\\mathrm{x} and \\mathrm{a}\\mathrm{r}\\mathrm{g}\\mathrm{m}\\mathrm{a}\\mathrm{x}\nin Algorithm 1. Four methods were studied: bisection method, di-\nchotomous search, the golden section method, and the Fibonacci\nmethod. All of these methods have the same basic goal. For a func-\ntion \\widehat e(x), x \\in [a, c], they start with the initial interval and after\na series of iterations they return an interval [a \\star , c \\star ] of length 2\\delta .\nx \\star \\in [a \\star , c \\star ], where x \\star = \\mathrm{a}\\mathrm{r}\\mathrm{g}\\mathrm{m}\\mathrm{a}\\mathrm{x}x\\{ \\widehat e(x)\\} . The choice of the grid\nlength \\delta affects directly the convergence of any of the methods. For\na smaller grid length the number of iterations is higher\n\nTheoretically, in analyzing the number of iterations required\nby the methods above, the dichotomous search method presents\nas the most efficient one. However, in experimental results using\na quasiconcave function \\widehat e(x) with values obtained in a simulator,\nthe golden section method presented similar efficiency but more ro-\n\n\n\n145\n\nAlgorithm 1: \u201cSearch method\u201d algorithm\n1 input : \\widehat g(x), [a, c], \\varepsilon \n2 \\scrB \\leftarrow  - \\{ a, c\\} \n3 \\scrB \\leftarrow  - search(a, c, \\varepsilon , \\scrB )\n4 return \\scrB \n\nProcedure search(at, ct, \\varepsilon , \\scrB )\n5 compute \\widehat g(at) and \\widehat g(ct)\n6 define \\widehat h(at,ct)(x)\n7 e\\mathrm{m}\\mathrm{a}\\mathrm{x} \\leftarrow  - \\mathrm{m}\\mathrm{a}\\mathrm{x}x\\{ \\widehat e(at,ct)(x) : at \\leq x \\leq ct\\} \n8 x \\star \\leftarrow  - \\mathrm{a}\\mathrm{r}\\mathrm{g}\\mathrm{m}\\mathrm{a}\\mathrm{x}x\\{ \\widehat e(at,ct)(x) : at \\leq x \\leq ct\\} \n9 if e\\mathrm{m}\\mathrm{a}\\mathrm{x} \\geq \\varepsilon then\n\n10 \\scrB \\leftarrow  - \\scrB \\cup \\{ x \\star \\} \n11 \\scrA \\leftarrow  - search(at, x \\star , \\varepsilon , \\scrB )\n12 \\scrB \\leftarrow  - \\scrB \\cup \\scrA \n13 \\scrA \\leftarrow  - search(x \\star , ct, \\varepsilon , \\scrB )\n14 \\scrB \\leftarrow  - \\scrB \\cup \\scrA \n15 return \\scrB \n\nbust results. Therefore, this is the technique chosen for Algorithm 1.\nAlgorithm 2 presents the golden section method.\n\n\u201cCut method\u201d algorithm\n\nThe heuristic used for Algorithm 3 is based on the golden sec-\ntion method for line search without derivatives. It starts sampling\ntwo points within the initial interval using the golden ratio \\phi as a\nrule. Then it evaluates the error function in the limiting points and\nin the two intermediary points. If one or more values are higher\nthan \\varepsilon , then it adds the breakpoints associated with the higher er-\nror to set \\scrB and recursively calls the the procedure for the intervals\nbefore and after this breakpoint. However, if all errors are lower\nthan \\varepsilon , then it still has to check if a higher error value does not exist\nfor a value in the domain. Nevertheless it has to check it around the\nbreakpoint with the higher error.\n\nThe entire procedure is performed recursively until the inter-\nval checked is smaller than a given grid length \\delta .\n\n\n\n146 APPENDIX A \u2014 Sampling Algorithms\n\nAlgorithm 2: Golden section method\n1 input : \\widehat e(x), [a, c], \\delta \n2 \\phi \\leftarrow  - 0.618\n3 k \\leftarrow  - 1\n4 ak \\leftarrow  - a\n5 ck \\leftarrow  - b\n6 \\sigma k \\leftarrow  - ak + (1 - \\phi )(ck  - ak)\n7 \\mu k \\leftarrow  - ak + \\phi (ck  - ak)\n8 while ck  - ak \\geq \\delta do\n9 compute \\widehat e(\\sigma k) and \\widehat e(\\mu k)\n\n10 if \\widehat e(\\sigma k) > \\widehat e(\\mu k) then\n11 ak+1 \\leftarrow  - \\sigma k\n12 ck+1 \\leftarrow  - ck\n13 \\sigma k+1 \\leftarrow  - \\mu k\n14 \\mu k+1 \\leftarrow  - ak+1 + \\phi (ck+1  - ak+1)\n15 else\n16 ak+1 \\leftarrow  - ak\n17 ck+1 \\leftarrow  - \\mu k\n18 \\sigma k+1 \\leftarrow  - ak+1 + (1 - \\phi )(ck+1  - ak+1)\n19 \\mu k+1 \\leftarrow  - \\sigma k\n20 k \\leftarrow  - k + 1\n21 x \\star \\leftarrow  - ak+ck\n\n2\n\n22 return \\widehat e(x \\star ), x \\star \n\nImportant remarks\n\nAbsolute error vs. relative error: Algorithm 1 and Algorithm 3\nrely on the fact that given a concave function \\widehat g(x) its correspond-\ning absolute error function will also be concave. However, convexity\nis not maintained for the relative error function. In practice, some-\ntimes it is more convenient to require a piecewise linearization that\nhas a maximum relative error \\varepsilon \\% than a maximum absolute error \\varepsilon .\nNote that it is possible to modify both algorithms to account for this.\nThe idea is that in each interval that is being tested (each recourse)\na corresponding absolute error has to be calculated. For example,\nbefore any of the procedures \u2013 search() or cut() \u2013 is called, one has\nto compute \\varepsilon = \\varepsilon \\% \\cdot \\mathrm{m}\\mathrm{i}\\mathrm{n}\\{ \\widehat e(a), \\widehat e(b)\\} , where a and b are the limits\nof the interval being checked in a recourse. With this approach we\nguarantee an upper bound for the absolute errors being checked in\n\n\n\n147\n\nAlgorithm 3: \u201cCut method\u201d algorithm\n1 input : \\widehat g(x), [a, c], \\varepsilon , \\delta \n2 \\scrB \\leftarrow  - \\{ a, c\\} \n3 \\scrB \\leftarrow  - cut(a, c, a, c, \\varepsilon , \\delta , \\scrB )\n4 return \\scrB \n\nProcedure cut(at, ct, af, cf, \\varepsilon , \\delta , \\scrB )\n5 if ct  - at \\leq \\delta then\n6 return \\scrB \n7 \\sigma \\leftarrow  - at + (1 - \\phi )(ct  - at)\n8 \\mu \\leftarrow  - at + \\phi (ct  - at)\n9 compute \\widehat g(af), \\widehat g(at), \\widehat g(\\sigma ), \\widehat g(\\mu ), \\widehat g(ct) and \\widehat g(cf)\n\n10 define \\widehat h(af,cf)(x)\n11 e\\mathrm{m}\\mathrm{a}\\mathrm{x} \\leftarrow  - \\mathrm{m}\\mathrm{a}\\mathrm{x}\\{ \\widehat e(af,cf)(at), \\widehat e(af,cf)(\\sigma ), \\widehat e(af,cf)(\\mu ), \\widehat e(af,cf)(ct)\\} \n12 case \\widehat e(af,cf)(\\sigma ) > \\varepsilon and \\widehat e(af,cf)(\\mu ) > \\varepsilon \n13 if \\widehat e(af,cf)(\\sigma ) > \\widehat e(af,cf)(\\mu ) then\n14 \\scrB \\leftarrow  - \\scrB \\cup \\{ \\sigma \\} \n15 \\scrB \\leftarrow  - \\scrB \\cup cut(at, \\sigma , at, \\sigma , \\varepsilon , \\delta , \\scrB )\n16 \\scrB \\leftarrow  - \\scrB \\cup cut(\\sigma , bt, \\sigma , bt, \\varepsilon , \\delta , \\scrB )\n17 else\n18 \\scrB \\leftarrow  - \\scrB \\cup \\{ \\mu \\} \n19 \\scrB \\leftarrow  - \\scrB \\cup cut(at, \\mu , at, \\mu , \\varepsilon , \\delta , \\scrB )\n20 \\scrB \\leftarrow  - \\scrB \\cup cut(\\mu , bt, \\mu , bt, \\varepsilon , \\delta , \\scrB )\n21 case \\widehat e(af,cf)(\\sigma ) > \\varepsilon \n22 \\scrB \\leftarrow  - \\scrB \\cup \\{ \\sigma \\} \n23 \\scrB \\leftarrow  - \\scrB \\cup cut(at, \\sigma , at, \\sigma , \\varepsilon , \\delta , \\scrB )\n24 \\scrB \\leftarrow  - \\scrB \\cup cut(\\sigma , \\mu , \\sigma , \\mu , \\varepsilon , \\delta , \\scrB )\n25 case \\widehat e(af,cf)(\\mu ) > \\varepsilon \n26 \\scrB \\leftarrow  - \\scrB \\cup \\{ \\mu \\} \n27 \\scrB \\leftarrow  - \\scrB \\cup cut(\\sigma , \\mu , \\sigma , \\mu , \\varepsilon , \\delta , \\scrB )\n28 \\scrB \\leftarrow  - \\scrB \\cup cut(\\mu , ct, \\mu , ct, \\varepsilon , \\delta , \\scrB )\n29 otherwise\n30 case \\widehat e(at) = e\\mathrm{m}\\mathrm{a}\\mathrm{x}\n31 \\scrB \\leftarrow  - cut(at, \\sigma , af, cf, \\varepsilon , \\delta , \\scrB )\n32 case \\widehat e(\\sigma ) = e\\mathrm{m}\\mathrm{a}\\mathrm{x}\n33 \\scrB \\leftarrow  - cut(at, \\mu , af, cf, \\varepsilon , \\delta , \\scrB )\n34 case \\widehat e(\\mu ) = e\\mathrm{m}\\mathrm{a}\\mathrm{x}\n35 \\scrB \\leftarrow  - cut(\\sigma , ct, af, cf, \\varepsilon , \\delta , \\scrB )\n36 case \\widehat e(ct) = e\\mathrm{m}\\mathrm{a}\\mathrm{x}\n37 \\scrB \\leftarrow  - cut(\\mu , ct, af, cf, \\varepsilon , \\delta , \\scrB )\n38 return \\scrB \n\n\n\n148 APPENDIX A \u2014 Sampling Algorithms\n\nan interval. This is possible because the function is concave thus the\nminimum in any interval will be a limit point of this interval.\n\nIdeal Effectiveness: Ideally, it is desired that the algorithms do\nnot only provide an ordinary set of breakpoints that produce a\npiecewise-linear approximation for a given maximum error, but ac-\ntually the smaller set of breakpoints for that required error. Both\nalgorithms do not achieve this goal. However, using an algorithm\nthat is not presented here but that was designed with this objective,\nexperimental results showed similar results to Algorithm 1.\n\nExtension to higher dimensions: The use of the algorithms pre-\nsented here are limited to univariate functions. This reduce the num-\nber of situation where the algorithms may be applied. Once multi-\ndimensional search methods without using derivatives exit [77], it\nis intuitive to think that, for example, Algorithm 1 could be easily\nextended. However, this may not be trivial, since higher dimensions\nusually introduce more complexity for problems. Thus, this is left\nfor future investigation.\n\nEXPERIMENTAL RESULTS\n\nAlgorithm 1 and Algorithm 3 were tested using a multiphase\nflow simulator to produced the quasiconcave functions \\widehat g(x) and the\nalgorithms themselves were implemented in Python (programming\nlanguage). For both algorithms the experimental results presented\nbelow are using the same initial interval [0, 2], function \\widehat g(x) and\nminimum grid length \\delta = 1\\times 10 - 5. The only parameter that changes\nin each of the five tests is the desired maximum relative error \\varepsilon \\%.\nThe results for each test include:\n\n\\bullet Calls: is the number of queries made to the simulator to eval-\nuate function \\widehat g(x) in a point of its domain;\n\\bullet Breakpoints: is the number of points defining the piecewise-\n\nlinear curve, which guarantee a required maximum the rela-\ntive error \\varepsilon \\%.\n\nThe experimental results using Algorithm 1 are in Table 1 and for\nAlgorithm 3 are in Table 2. Figure 1 illustrates the piecewise-linear\ncurve formed by the breakpoints obtained by both algorithms.\n\n\n\n149\n\n(a) \u201cSearch method\u201d - Test #1\n\n(b) \u201cCut method\u201d - Test #1\n\nFigure 1: Piecewise-linear curves for Test # 1.\n\n\n\n150 APPENDIX A \u2014 Sampling Algorithms\n\nTable 1: \"Search method\" Algorithm 1.\n\nTest \\varepsilon \\% Calls Breakpoints\n\n\\#1 1\\% 132 6\n\\#2 0.5\\% 189 9\n\\#3 0.25\\% 241 12\n\\#4 0.1\\% 345 20\n\\#5 0.01\\% 813 65\n\nTable 2: \u201cCut method\u201d Algorithm 3.\n\nTest \\varepsilon \\% Calls Breakpoints\n\n\\#1 1\\% 57 7\n\\#2 0.5\\% 64 10\n\\#3 0.25\\% 95 16\n\\#4 0.1\\% 145 44\n\\#5 0.01\\% 279 112\n\nNotice that in Algorithm 1 tended, in similar tests, to produce\na smaller number of breakpoints compared to Algorithm 3. How-\never, the latter used less function evaluations to achieve its results.\nTherefore, one has to choose whether to pay a higher \u201cprice\u201d earlier,\nwhen producing the piecewise-linearization or later when using the\npiecewise-linear function in a optimization problem.\n\nAn advantage of both methods, when compared to the afore-\nmentioned sampling algorithm presented by Codas et al. [75], is in\nthe reduced number of function evaluations performed. In fact, the\nalgorithm in [75] does not sample the curve directly, but it reduces\nthe number of points of an input oversampled curve. This input sam-\nple set has to be sufficiently large for the algorithm to be effective\nand guarantee a maximum required error. In the example above the\nvalue of \\delta was chosen to match the maximum accuracy of the sim-\nulator. Thus, to provide a safe input sampling set for the reduction\nalgorithm, since the interval the function is being approximated is\n[0, 2], a fine sampling could mean up to 2 \\times 105 evaluations of the\nfunction. Note that this number is much larger than the number of\nevaluations required by the algorithms presented above for any of\nthe errors considered (see Tables 1 and 2).\n\n\n\tResumo Estendido\n\tAbstract\n\tList of Figures\n\tList of Tables\n\tList of Abbreviations and Acronyms\n\tContents\n\tIntroduction\n\tProblem statement\n\tObjectives and contributions\n\tOrganization of the dissertation\n\n\tFundamentals\n\tOil production\n\tPetroleum industry overview\n\tExploration and Production\n\tLifting methods\n\tGas Lift System\n\n\tIntegrated operations\n\tProduction optimization of gas-lifted oil fields\n\n\n\tOptimization modeling\n\tMathematic programming\n\tSolving optimization problems\n\n\tRobust optimization\n\tOptimization under uncertainty\n\tRobust optimization\n\tRobust Linear Optimization\n\n\tSummary\n\n\tRobust production optimization methodology\n\tUncertainty in oil production systems\n\tUncertain production optimization models\n\tNominal MINLP production problem\n\tUncertainties in the MINLP production problem\n\tNominal MILP production problem\n\tUncertain MILP production problem\n\n\tRobust production optimization methodology\n\tSummary\n\n\tRobust production optimization models\n\tRobust Production Optimization \u2013 Satellite Wells\n\tProblem Formulation\n\tRobust Formulation\n\n\tRobust Production Optimization \u2013 Subsea Manifold\n\tProblem Formulation\n\tRobust Formulation\n\n\tSummary\n\n\tExperiments\n\tOil Field Scenario\n\tUncertain Parameters\n\tComputational Results\n\tSummary\n\n\tConclusion\n\tFurther developments\n\n\tReferences\n\tAPPENDIX A \u2014 Sampling Algorithms"}]}}}