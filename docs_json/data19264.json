{"add": {"doc": {"field": [{"@name": "docid", "#text": "BR-TU.23287"}, {"@name": "filename", "#text": "7390_RonaldoBrunoM.pdf"}, {"@name": "filetype", "#text": "PDF"}, {"@name": "text", "#text": "UNIVERSIDADE DE SAO PAULO\n\nINSTITUTO DE FisICA DE sAo CARLOS\n\nDepartamento de Fisica e Informatica\n\nPESQUISA EM INSTRUMENTACAo ELETRONICA\nMICROPROCESSADA PARA A MEDIDA DE\n\nPARAMETROS FISICOS E QUIMICOS DA AGUA\n\nUSP / iFQSC j SB!\n\nill~II~1111111~lllllllllIllllli\n6-2-'001f2.9\n\nDisserta<;ao apresentada ao\nInstituto de Fisica de Sao Carlos,\nda Universidade de Sao Paulo,\npara obten<;ao do titulo de Mestre\nem Ciencias (Fisica Aplicada).\n\nSao Carlos\n1997\n\n\n\nBruno, Ronaldo\nPesquisa em Instrumentayao Eletronica Microprocessada para a Medida de\n\nParametros Fisicos e Quimicos da AguaJRonaldo Bruno.-Sao Carlos, 1997.\n145p.\n\n1. Instrumentayao\nI. Titulo\n\n\n\nUNIVERSIDADE\nDE sAo PAULO\n\n:-'v. Dr. Carlos Botelho. 1465\nCEP 13560-250 - Sao Canos - SP\nBrasii\n\nFone (016) 272-6222\nFax (016) 272-2218\n\nMEMBROS DA COMiSsAo JULGADORA DA DISSERTAc;:Ao DE MESTRADO DE\nRONALDO BRUNO APRESENT ADA AO INSTITUTO DE FISICA DE SAG CARLOS, DA\nUNIVERSIDADE DE SAG PAULO, EM 28 DE FEVEREIRO DE 1997.\n\n\n\n\u2022 Ao Prof. Valentin Obac Roda, meu orientador. pelo carMer,\nserenidade, apoio e total disponibilidade.\n\n\u2022 Aos amigos Maximilian Luppe, Raul Junji Nakashima e Jose Pott, os\nquais contribuiram para urn otimo ambiente de trabalho.\n\n\u2022 Ao pessoal do Laboratorio de Instrumentayao: Lirio, Bene, Marcos,\nAilton e Ivanilda.\n\n\u2022 A Wladerez da seyao de alunos sempre simpatica e atenciosa.\n\n\u2022 Ao pessoal do Laboratorio de Hidniulica e Saneamento, Julio Cesar\nTrofino e Paulo Fragiacomo pelo inestimavel auxilio no\ndesenvolvimento do medidor de turbidez.\n\n\u2022 Ao Newton da Industria FAC LTDA, pela enorme gentileza em\nfomecer 0 sensor de oxigenio dissolvido.\n\n\u2022 Ao Mateus (Ressonancia Mag.) pelo auxilio na linguagem Visual\nBasic.\n\n\n\n\n\nLista de Figuras iv\nLista de Ta belas vi\nRes umo vii\nAbstract viii\n1. Introdu~ao 1\n2. Instrumentos 5\n\n2.1. Condutivimetro 5\n2.1.1 Introduyao 5\n2.1.2 Definiyao e unidades 5\n2.1.3 Natureza da Condutividade 6\n2.1.4 Considerayoes pniticas 8\n2.1.5 Preparo de Soluyao Padrao 9\n2.1.6 Medidor de Condutividade 10\n\n2.2. Medidor de pH 14\n2.2.1 Introduyao 14\n2.2.2 Definiyao 14\n2.2.3 0 Sensor 15\n2.2.4 Circuito de entrada 17\n2.2.5 Medidor de pH 19\n\n2.3. Medidor de Turbidez 22\n2.3.1 Introduyao 22\n2.3.2 Principio da Medida 23\n2.3.3 Aspectos Construtivos 24\n2.3.4 Circuito do Turbidimetro 26\n2.3.5 Preparo da Soluyao Padrao 27\n\n2.3.5.1 Roteiro para preparayao das soluyoes 28\n2.3.6 Calibrayao e Desempenho do Turbidimetro 28\n\n2.4. Termometro 31\n2.5. Medidor de Oxigenio 32\n\n2.5.1 Introduyao 32\n2.5.2 Principio de Medida 33\n2.5.3 Caracteristicas dos Sensores de Oxigenio Dissolvido 35\n\n2.5.3.1 Eletrodo Principal (Catodo) 35\n2.5 .3.2 Membrana 36\n2.5 .3.3 Temperatura 37\n2.5.3.4 Pressao 37\n\n2.5.4 Unidades 37\n2.5.5 Preparo das Soluyoes Padrao e Eletr6lito do Sensor. 38\n\n2.5.5.1 Soluyao Padrao 38\n2.5.5.2 Eletr6lito 39\n\n2.5.6 Circuito do Medidor de Oxigenio Dissolvido 39\n2.5.7 Calibrayao 40\n\n2.6. Medidor de Profundidade 41\n\n\n\n2.6.1 Introdu<;ao .f 1\n2.6.2 Princi pia de Medida 42\n2.6.3 Sistema Medidor 42\n\n3. Circuito PrincipaL 47\n3.1. Introduc;ao 47\n3.2. Microcontrolador PIC16C84 48\n\n3.2.1 Programa<;ao das Portas 50\n3.3. Interface RS232 51\n3.4. Conversor AID 53\n3.5. Multiplexac;ao da Entrada AnaI6gica 54\n3.6. Escalas Automaticas 56\n3.7. Interrupc;ao - Medidor de Profundidade 57\n3.8. Fontes de Alimentac;ao 58\n\n4. Programa\u00ab;ao 60\n4.1. Introduc;ao 60\n4.2. Programa em Linguagem Montadora do PIC16C84 61\n\n4.2.1 Watch Dog Timer. 68\n4.2.2 Interrupyao 69\n4.2.3 Rotinas de imp1ementa<;ao da RS232 69\n\n4.2.3.1 Rotina de transmissao 70\n4.2.3.2 Rotina de recep<;ao 70\n\n4.3. Programa de Visualizac;ao dos Dissolvido Dados 71\n4.3.1 Introduyao 71\n4.3.2 Visao Gera1 do Programa Desenvo1vido 72\n4.3.3 Jane1a Principal (MAIN) 74\n\n4.3.3.1 Menu 74\n4.3.3.2 Botao Power 77\n4.3.3.3 Botao Save 77\n4.3.3.4 Botao Reset 77\n4.3.3.5 Rotina Principal (Main Routine) 78\n4.3.3.6 Rotina de Inicializa<;ao (Form) 79\n4.3.3.7 VEX da Porta Serial.. 80\n4.3.3.8 Timer da Aquisiyao de Dados 80\n4.3.3.9 Timer do WatchDog Timer 81\n\n4.3.4 Janela para Manipulayao de Arquivos (FILES) 82\n4.3.4.1 Comando \"Ok\" 83\n4.3.4.2 Sub-rotinas Auxiliares 84\n\n4.3.4.2.1 Sub-rotina N_ADF (New Acquisition Data File) 84\n4.3.4.2.2 Sub-rotina 0_ADF (Open Acquisition Data File) 84\n4.3.4.2.3 Sub-rotina O_CF (Open Calibration File) 84\n4.3.4.2.4 Sub-rotina S_CF (Save Calibration File) 85\n\n4.3.5 Janela para Visualizayao de Arquivos de Dados (DATA VIEW) 85\n4.3.6 Janela de Ca1ibrayao do Medidor de pH (PHCAL) 86\n\n4.3 .6. 1 B 0tao .,Start\" 87\n4.3.6.2 Botao \"Cancel\" 88\n4.3.6.3 Timers 1 e 2 (buffers 1 e 2) 88\n\n4.3.7 Janela de Ca1ibrayao do Medidor de Oxigenio Dissolvido (02CAL) 89\n\n\n\n4.3.8 Janela de Apresentac;ao do Programa (STARTUP) 89\n5. Transmissao dos Dados via Radiofreqiiencia 92\n\n5.1 Introdu~ao 92\n5.2 Sistema de Transmissao 92\n5.3 Transmissor 93\n5.4 Receptor 94\n5.5 Desempenho do Sistema 97\n\n6. Conclusao 99\n6.1 Introdu~ao 99\n6.2 Otimiza~ao do Projeto 100\n\n6.2.1 Medidor de Profundidade ,. 100\n6.2.2 Fonte de alimentac;ao 101\n\n6.3 Trabalhos Futuros 101\n6.3.1 Sistema com Data Logger , 101\n6.3.2 Sistema automatico de medidas 102\n6.3.3 Sistema Telemetrico via Radiofrequencia 102\n6.3.4 Sistema Telemetrico via Internet 102\n\nBibliografia 103\nApendices 106\n\nApendice A - Esquemas dos Circuitos 106\nApendice B - Programac;ao em Linguagem Montadora do PIC16C84 115\nApendice C - Descric;ao das Variaveis do Programa em Visual Basic 123\nApendice D - Programa em Visual Basic 126\n\n\n\nLista de Figuras\nFigura 1 - Ilustrayao do principio de uma celula de dois eletrodos 6\n\nFigura 2 - Circuito equivalente de uma celula de dois eletrodos 8\n\nFigura 3 - Dependencia, com relayao ao material dos eletrodos. da faixa de\n\ncondutividade utilizavel de uma celula de dois eletrodos 10\n\nFigura 4 - Dependencia, com relayao a freqtiencia, da faixa de condutividade\nutilizavel de uma celula de dois eletrodos de ayo inox 11\n\nFigura 5 - Celula de dois eletrodos 12\n\nFigura 6 - Diagrama em blocos do condutivimetro 12\n\nFigura 7 - Principio de medida da condutividade 13\n\nFigura 8 - Sensor de pH integrado 17\n\nFigura 9 - Resposta tipica de urn sensor integrado 18\n\nFigura 10 - Circuito de entrada para 0 sensor de pH integrado 18\n\nFigura 11 - Sinal do sensor de pH modificado pelo circuito de entrada 19\n\nFigura 12 - Esquema basico de urn turbidimetro 25\n\nFigura 13 - Fonte de tensao regulada para a hlmpada do turbidimetro 26\n\nFigura 14 - Circuito de amplificayao e adaptayao do sinal do foto-sensor 27\n\nFigura 15 - Linearizayao da escala de alta sensibilidade do turbidimetro 29\n\nFigura 16 - Linearizayao da escala de baixa sensibilidade do turbidimetro 30\n\nFigura 17 - Circuito de ligayao do LM 35D 32\n\nFigura 18 - Polarograma do sensor de oxigenio dissolvido 34\n\nFigura 19 - Desenho do sensor de oxigenio dissolvido 35\n\nFigura 20 - Sensor de oxigenio com compensayao de pressao 36\n\nFigura 21 - Circuito do medidor de oxigenio dissolvido 40\n\nFigura 22 - Sistema proposto para a medida de profundidade 42\n\nFigura 23 - Sistema do medidor de profundidade 44\n\nFigura 24 - Sinais gerados quando 0 encoder gira no sentido anti-horario 45\n\nFigura 25 - Sinais gerados quando 0 encoder gira no sentido horario 45\n\nFigura 26 - Circuito que gera os sinais de pulso e sentido 45\n\nFigura 27 - Formas de onda dos sinais do foto-transistor. 46\n\nFigura 28 - Diagrama em blocos do circuito da sonda 49\n\n\n\nFigura 29 - Esquema de transmissao de dados no padrao RS232 53\n\nFigura 30 - Palavra de 16 bits gerada pelo conversor AID 54\n\nFigura 31 - Protocolo de comunicayao do MAX187 54\n\nFigura 32 - Esquema da multiplexayao do canal ana16gico do MAX187 56\n\nFigura 33 - Diagrama em blocos do circuito da [onte 59\n\nFigura 34 - Fluxograma do programa em assembler do PICI6C84 64\n\nFigura 35 - Fluxograma da rotina que escolhe a escala do condutivimetro 66\n\nFigura 36 - Fluxograma da rotina que escolhe a escala do turbidimetro 67\n\nFigura 37 - Temporizayao da leitura de urn byte recebido pela porta serial. 71\n\nFigura 38 - Janela principal do analisador de agua 75\n\nFigura 39 - Exemplo das janelas da barra de menu 75\n\nFigura 40 - Janela para manipulayao de arquivos 83\n\nFigura 41 - Janela para visualizayao dos dados enviados pela sonda 86\n\nFigura 42 - Janela de calibrayao do medidor de pH 87\n\nFigura 43 - Janela de calibrayao do medidor de oxigenio dissolvido 90\n\nFigura 44 - Tela de Apresentayao do Analisador Virtual de Agua 91\n\nFigura 45 - Transmissor de dados em 3.57MHz 94\n\nFigura 46 - Sinal digital da porta serial e portadora modulada em amplitude 95\n\nFigura 47 - Receptor de dados e audio em 3.57 MHz 96\n\n\n\nTabela 1 - Mobilidade dos ions (cations e anions) em funyao da temperatura 7\n\nTabela 2 - Condutividade em funyao da concentrayao da soluyao 10\n\nTabela 3 - Dados do turbidimetro construido. Escala de alta sensibilidade 29\n\nTabela 4 - Dados do turbidimetro construido. Escala de baixa sensibilidade 30\n\nTabela 5 - Valores medidos com 0 turbidimetro montado em comparayao com os\n\npadr5es preparados 31\n\nTabela 6 - Solubilidade do oxigenio em funyao da temperatura 38\n\nTabela 7 - Seleyao das entradas ana16gicas 51\n\nTabela 8 - Seleyao das escalas do condutivimetro em funyao dos bits RB 1 e RB5 51\n\nTabela 9 - Niveis 16gicos das saidas dos transistores comandados pelo CD4028B. .. 55\n\nTabela 10 - Palavra de 12 bits gerada pelo conversor AID 63\n\nTabela 11 - Func;:5esda barra de menu 76\n\n\n\no presente trabalho prop5e a construyao de urn instrumento microprocessado\nmultissensor para a medida de parametros tlsicos e quimicos da agua. As variaveis\nmedidas sac: temperatura, turbidez, pH, oxigenio dissolvido, condutividade e\nprofundidade. 0 sistema e composto por uma sonda multissensora e urn micro\npadrao IBM/PC que permite a visualizayao e armazenagem dos dados. No circuito da\nsonda sac utilizados componentes recentes como 0 microcontrolador PIC16C84 e 0\nconversor AID serial de 12 bits MAX187. 0 programa para 0 PC foi desenvolvido na\nlinguagem Visual Basic 3.0 em ambiente Windows. A comunicayao entre a sonda e 0\nPC e feita atraves da porta serial RS232.\n\n\n\nThe present work proposes the development of a multi sensor microprocessor-\nbased instrument for the measurement of physical and chemical water parameters.\nThe water parameters that can be measured are: temperature, pH, dissolved oxygen,\nconductivity and depth. The system includes the multisensor instrument and an\nIBM/PC microcomputer that allows data recording and viewing. The instrument\ncircuit is based on recent components such as the microcontroller PIC16C84 and the\n12-bit AID converter MAXI8? The PC software was developed in Visual Basic 3.0\nfor Windows. The multi sensor communicates with the PC by RS 232 serial cable.\n\n\n\n1. Introdu~ao\n\nCom 0 crescimento da populayao e 0 consequente aumento das atividades\n\nindustriais. a estudo das caracteristicas fisicas e quimicas da agua tern se tornado\n\ncada vez mais importante. Tal estudo tern aplicac;oes em divers as areas, como: no\n\ncontrole da qualidade das aguas de abastecimento, na caracterizac;ao dos efluentes\n\nliquidos de aguas residuarias industriais au domesticas e na caracterizac;ao de\n\ndiferentes corpos de aguas naturais, como rios, lagos, POyOSetc.\n\nA completa caracterizayao de urn corpo de agual32J envolve a medida de\n\nmuitos parametros. No entanto, usualmente, a avaliac;ao da qualidade da agua da-se\n\nem func;ao da utilizac;ao da me sma. Assim, selecionam-se apenas as parametros\n\nrelevantes a fim de otimizar tanto 0 equipamento como 0 processo de medida. as\n\nparametros mais comuns no estudo de aguas sao a temperatura, a pH. a\n\ncondutividade. a concentrac;ao de gases dissolvidos, a turbidez. a car, a penetrac;ao de\n\nluz. entre outras.\n\nAte pouco tempo atras, e ainda hoje em paises pouco desenvolvidos. essas\n\nmedidas eram feitas individualmente, par diferentes instrumentos. atraves da coleta\n\nde amostras. Isso limita 0 numero de medidas. dificulta 0 controle continuo e impede\n\n\n\na automayao do processo de avaliayao da qualidade da agua. Alem disso. certas\n\npropriedades sao interdependentes, variando simultaneamente.\n\nRecentemente, equipamentos de medida com sensores multiplos. que\n\npenn item quantificar simultaneamente algumas variaveis, tern sido desenvolvidos em\n\ndiferentes paises e tern contribuido significativamente para a melhoria do processo de\n\nmediyao, bem como oferecendo uma abordagem mais eficiente na soluyao de\n\ndiferentes problemas. Como exemplo, as alterayoes de algumas caracteristicas da\n\nagua de urn rio ocasionadas por descargas de poluentes podem ser analisadas com\n\nprecisao atraves da utilizayao de sensores multiplos instalados em pontos\n\neqiiidistantes a partir de uma fonte pontual. Um rio e um fluxo de agua onde a\n\nvelocidade das mudanyas e urn problema quando se realizam medidas discretas. Um\n\noutro exemplo e urn lago, 0 qual e urn estoque de agua, que leva mais tempo para ser\n\nlimpo ou depurado criando gradientes ou estratos com caracteristicas distintas\n\nlevando a uma compartimentalizayao do sistema. 0 esforyo amostraL portanto. e\n\nmuito mais intenso para uma caracterizayao dos diferentes compartimentos. Muitos\n\nestudos nesses sistemas ficam prejudicados pela ausencia de uma tccnologia\n\nadequada para as mediyoes das variaveis hidrol6gicas.\n\nCom a utilizayao de microprocessadores e possivel 0 desenvolvimento de\n\nequipamentos bastante versateis e especificos que, alem de coletar dados de maneira\n\neficiente. permitem urn pre-processamento e armazenamento dos mesmos. Urn\n\ninstrumento microprocessado permite, ainda. a transmissao digital do valor da\n\nvariavel medida de urn ponto ao outro. Isso evita interferencias causadas por campos\n\nmagnericos. campos eletricos e umidade nos cabos, pois 0 sinal digital e muito mais\n\nimune a essas interfcrencias que os debeis sinais anal6gicos gcrados Delos sensorc:o.\n\n\n\nNo presente trabalho de rnestrado foi desenvolvido urn instrurnento\n\nrnicroprocessado para a rnediyao de parametros fisicos e quirnicos da agua, rnais\n\nespecificarnente temperatura, pH, turbidez, condutividade especifica e concentrayao\n\nde oxigenio dissolvido. Esse instrumento consiste em uma sonda multissensora\n\nsustentada por urn cabo de ayo, a qual faz a aquisiyao dos dados e os envia\n\ndigitalmente no padrao RS232 a urn microcomputador do tipo lap-top, situado em\n\numa embarcayao, contendo urn programa de visualizayao e armazenamento de dados.\n\nNo circuito eletr6nico da sonda foram utilizados componentes de ultima\n\ngerayao. notadamente 0 rnicrocontrolador PIC16C84 e 0 conversor AID MAXI87. 0\n\nPIC 16C84 pertence a uma familia de microcontroladores RISC, fabricada pela\n\nArizona Microchip. Os componentes dessa familia saG bastante compactos. cada urn\n\napresentando urn grupo diferente de recursos. Assim, de acordo com a aplicac;ao,\n\nescolhe-se 0 componente mais adequado. 0 PIC16C84 e dotado de EEPROM\n\nintema, 0 que facilita muito a fase de depurayao do programa. Alem disso, devido ao\n\nfato do microcontrolador possuir poucas instruyoes, 0 aprendizado da linguagem\n\nmontadora e muito rapido. 0 MAX187 e urn conversor AID de 12 bits com saida\n\nserial alojado num encapsulamento de apenas 8 pinos. 0 pequeno tamanho do CI\n\naliado aos circuitos embutidos. tais como uma referencia de tensao e circuito de\n\nsample-hold. sirnplifica a placa de circuito impressa, com 0 conseqtiente aumento da\n\nconfiabilidade. Na parte analogica do circuito vale ressaltar a ausencia de resistores\n\nvariaveis, que sempre sofrem variayao de valor devido ao envelhecimento.\n\no sistema como urn todo, baseia-se na tecnica de instrumentac;ao virtual. a\n\nqual utiliza a tela de urn microcomputador para visualizar e controlar graficamente\n\ninstrumentos remotos. Para a implementayao desse sistema. construiu-se urn\n\n\n\nprograma na linguagem Visual Basic. Esta linguagem segue a filosofia atual de\n\nprogramayao: a programayao utilizando objetos visuais. A abordagem visual permite\n\na construyao de interfaces graficas de alta qualidade com urn minimo de esforyo na\n\nprogramayao.\n\nA apresentayao deste trabalho esta dividida em quatro partes principais: 0\n\ncapitulo 2 trata do projeto dos instrumentos, 0 capitulo 3 trata do circuito geral da\n\nsonda, no capitulo 4 encontram-se os assuntos relacionados aos programas tanto em\n\nlinguagem montadora como em Visual Basic e nos apendices estao os esquemilticos\n\nde todos os circuitos bem como a listagem completa dos programas desenvolvidos.\n\nNo capitulo 2 incluiu-se 0 projeto de urn medidor de profundidade, essencial no\n\nlevantamento dos panlmetros da agua de urn lago. No capitulo 5 e apresentada uma\n\naltemativa para a transmissao dos dados via cabos: a transmissao via radiofreqih~ncia.\n\n\n\n2.1. Condutivimetro\n\n2.1.1 Introdu~ao\n\nDiferentemente da malOna dos metodos de amilise quimica que utilizam\n\nmedidas eletricas, a condutividade[IJ e uma medida nao-seletival]J. Ou seja, todos os\n\nions presentes numa soluc;ao sao detectados. A contribuic;ao de cada ion no valor\n\ntotal da medida depende da sua mobilidade, carga e concentrac;ao[11. Os sensores\n\nutilizados sao passivos necessitando de uma fonte extema para a gerac;ao de urn sinal\n\no qual alimenta urn amplificador.\n\nApesar da nao-seletividade a condutividade tern grande importlncia e e. com\n\nexcec;ao da medida de pH, a tecnica eletroquimica mais utilizada no monitoramento\n\nde aguas.\n\nA condutividade K e definida como sendo a condutfmcia G de uma celula de\n\ndois eletrodos pIanos com area de 1cm] distanciados de Iem. Tal tipo de celula po de\n\nser caracterizado pela sua constante[1] k = d/A de aeordo com a figura 1. Apesar\n\ndessa expressao. 0 valor de k e, na prcitica. calculado com base em soluc;6es com\n\ncondutividade eonhecida. Isto e feito pois. como po de ser visto na figura 1. ocorre\n\n\n\nFigura 1 - Ilustrac,:ao do principio de uma celula de do is eletrodos. As linhas de campo eletrico nao\nterminam na borda dos eletrodos. Logo, a constante k = dJA da celula nao pode ser calculada apenas\ncom base nas dimensoes geomMricas\n\n\n\nTabela 1[1] - Mobilidade dos ions (cations e anions) em fun<;ao da temperatura em solu<;ao aquosa.\nOs valores constantes na tabela foram extrapolados para concentra<;ao zero. Os ions Ht e OH- seguem\nurn mecanismo diferente de transporte, baseado em pontes de hidrogenio entre os ions e os dipolos da\nagua.\n\nions oDe 18De 25De 100De\nH 225 315 350 637\nLi' 19 \"\" 39 120.J.J\nNa- 26 43 50 150\nK- 40 64 74 200\nAg \" ...\u2022 53 62 180.J.J\n\n1/2Ca2- 31 50 60 187\n1/3La)' r 60 70 220~)\n\nOR 105 174 200 446\nCl' 41 66 76 207\nr 42 67 77\n\nNO.1' 40 63 71 189\nMnOj' 36 53 6\"_1\n112SO/ 41 69 80 256\n\nMobilidade }\"em n-1.em2\n\n\n\nr--------l\nI C, l\nI f?2 I\n\nFigura 2 - Circuito cquivalente de uma celula de dois eJetrodos. A resistencia de interesse esta\nrepresentada por R,. 0 retiingulo pontilhado engloba os componentes que representam as interavoes\ndos eletrodos com a soluvao. Os componentes que estao fora do retangulo sao devidos as conexoes\nextemas (cabos etc.).\n\n\n\ncaso C2 Alem disso uma pequena corrente de fuga pode surgir por efeito semelhante\n\nao que ocorre numa pilha eletroquimica. Neste caso essa corrente indesejavel indica\n\numa alterayao no valor medido de Rx e no circuito equivalente e representada por R2\u2022\n\nVale ainda observar que esses efeitos aumentam com 0 valor da condutividade. Logo\n\neles acabam impondo urn limite superior na faixa de medidas.\n\nPara minimizar os efeitos de polarizayao dois procedimentos basicos sao\n\ntornados: uso de tensao altern ada de freqiiencia adequada e uso de materiais\n\nconvenientes na fabricayao dos eletrodos.\n\nNa figura 3 e mostrada a influencia do material usado nos eletrodos no valor\n\nda constante da celula, no caso k = 1.00 cm'l. Note que com 0 aumento da\n\ncondutividade a partir de urn determinado valor ocorre urn aumento aparente da\n\nconstante k.\n\nNa figura 4 tem-se 0 incremento da constante k inicialmente igual a 1.00 cm,j\n\ncom relayao a freqiiencia e ao valor da condutividade.\n\n2.1.5 Preparo de SolU(;ao Padrao\n\nNa definiyao de condutividade fez-se referencia a constante da celula, que\n\ncompoe 0 sensor, a qual deve ser obtida experimentalmente atraves de soluyoes com\n\ncondutividade conhecida. Urn metodo simples de obtenyao de soluyoes padronizadas\n\ne 0 seguinte: dissolvem-se 74.55lg de KCL seco em 1 litro de agua pura. Essa\n\nsoluyao possui concentrayao de 1 mol/L. As concentrayoes de 0.1 e 0.01 mol/L sao\n\nobtidas por diluiyao simples da soluyao de 1 mol/L. As condutividades dessas\n\nsoluyoes nas varias temperaturas podem ser vistas na tabela 2.\n\n\n\nTemperatura Concentra~ao (Mol/I)\n(0C)\n\n0.1 0.05* 0.01 0.005* 0.001 * 0.0005*\n\n15 92.54m IO.48m 5.50m 1.147m 576.311 115.711 58.011\n20 102.09m 11.67m 6.13m 1.278m 642.211 129.011 64.611\n25 111.80m 12.88m 6.77m 1.4l3m 710.011 142.611 71.411\n\n130\nk I\n120\n\n100\nI I\n\n!\n\nI\n1J 20 50 100 200 500 2 5 10 20 50 100 200 500 1000\n--(.uS/cm)---+--------(, mS/cm)----\n\nFigura 3[11 - Dependencia, com rela<;ao ao material dos eletrodos. da faixa de condutividade\nutilizavel de uma celula de dois eletrodos. A celula, nesse caso. s6 deve ser utilizada na faixa onde\nk=I.OOcm,l. (a) a<;o inox; (b) carbono sinterizado; (c) a<;o in ox coberto com uma camada de carbeto\nde titiinio; (d) Platina\n\n\n\n130\n\nk\n\n120\n\n10 20 50 100 200 500\n()-IS I em)\n\n5 10 20 50 100 200 500 1000\n---~----(mS/em)\n\nFigura 411] - Dependencia, com relavao it freqiiencia, da faixa de condutividade utilizavcl de uma\ncelula de dois eletrodos de avo inox. A faixa utilizavel deve ser onde k= 1.OOcm i.\n\natendendo as especifica<;5es iniciais. Ha diversas geometrias e materiais111 disponiveis\n\n\n\nOscilador\n1KHz\n\nRetificador onda\ncompleta\n\nFiltro Passa- Saida\nbaixa\n\n\n\n\\ Oscilodor\n\nFigura 7 - Em ambos esquemas tem-se urn amplificador inversor com tres possibilidades de ganho\n(tres escalas). 0 ganho e dado pelo quociente do resistor de realimentac;ao pelo resistor de entrada. Se\na amplitude do oscilador e fixa, entao a saida do amplificador e inversamente proporcional ao resistor\nde entrada. No caso, a saida e diretamente proporcional it condutividade, pois maior a condutividade\nmenor a resistencia equivalente da soluc;ao.\n\n\n\n\n\no coeficiente de atividade sao a temperatura, a forc;a i6nica, a constante dieletrica, a\n\ncarga do ion, 0 tamanho dos ions e a densidade do solvente.\n\nA escala usual para a medida de pH e baseada na constante de dissociac;ao da\n\nagua, Kw = af{+ . aOl/ Em agua pura as concentrac;oes desses ions sao iguais a 10-7 M\n\na 25\u00b0C. Sendo Kw constante, fixada a temperatura, sao, entao, estabelecidos os\n\nlimites de 0 a 14 para a medida de pH.\n\nEm soluc;oes fortemente acidas ou alcalinas valores fora dessa faixa podem\n\nser encontrados. Todavia, em geral, nao ha interesse prMico na medida de pH dessas\n\nsoluc;oes.\n\no sensor[8] para medida de pH funciona atraves da diferenc;a de potencial\n\ngerada por uma celula galvanica[8] (eletrodo + eletrodo de referencia). Esses eletrodos\n\napresentam, em geral, resistencias internas de ate IGO (l00) e sao muito suscetiveis\n\na polarizac;ao. Logo, 0 circuito de entrada[9] que capta 0 sinal gerado pelo eletrodo\n\ndeve apresentar alta impedancia (>10120) e baixa corrente de off-set \u00ab10-12 A).\n\no potencial produzido pelo eletrodo segue a seguinte expressao:\n\nE = Eo + 2.303 (RT/F) log faf{+J,\n\nconhecida como equac;ao de Nernstl6J, onde:\n\nE = potencial do eletrodo em V/pH\n\nEo = potencial assimetrico, 0 qual varia com 0 passar do tempo (idade)\n\nR = constante gasosa (8.3144 J KI mol-I)\n\nT = temperatura em Kelvin\n\naT/= atividade dos ions hidrogenio\n\n\n\nPara 0 sensor integrado[5J (eletrodo e eletrodo de referencia), temos,\n\nsimplificadamente:\n\nv = tensao produzida nos terminais do sensor\n\nVo = tensao de off-set variavel com 0 passar do tempo.\n\nT = temperatura em DC\n\npH = valor do pH da amostra\n\nA tensao Vo teoricamente deveria ser nula. Na pr<itica a mesma apresenta urn\n\npequeno valor (positivo ou negativo) que varia de acordo com 0 sensor e com 0\n\npassar do tempo (idade do sensor).\n\nNa figura 8 e mostrado urn sensor integrado tipico e na figura 9, a resposta\n\ndesse tipo de sensor.\n\nDevido a resposta do sensor vanar com 0 passar do tempo e com a\n\ntemperatura, e semprc necessaria uma rotina de calibrayaol'J] antes de serem\n\nrealizadas medidas nas quais deseja-se grande precisao. A calibrayao e feita tomando\n\ncomo referencia soluyoes com valores conhecidos de pH. Podem-se usar uma OU\n\nmais soluyoes padronizadas, normal mente duas ja fornecem boa precisao. No caso de\n\ncalibrayao por uma unica soluyao consegue-se apenas 0 \"zeramento\" do off-set. Ja\n\ncom duas soluyoes alem do off-set, ajusta-se, tambem, 0 ganho do sensor. Ainda.\n\npara medidas nas quais deseja-se extrema acuracidade e usual escolher as soluyoes\n\nconhecidas com valores pr6ximos aos que serao lidos.\n\n\n\n--10\n\n9\n\n----6\n5\n4\n\n-3\n-2\n1\n\nFigura 8 - Sensor de pH integrado. 1, Membrana de vidro; 2, Eletr6lito intemo de referencia; 3, tela\nde metal; 4, Sistema de referencia intemo; 5, Conexao intema: 6, Cabe<;a do eletrodo; 7, Conexao\nintema; 8. Abertura para recarregamento do eletr6lito; 9, Cabe<;a do eletrodo; 10, Cabo de conexao.\n\n\n\n\u2022\u2022V(mV)\n600 .\n\n500\n400\n\n.~\n- ~-\n\n678\n~\n\npH100\n200 .\n\n300\n400\n500\n600\n\nFigura 9 - Resposta tearica de urn sensor integrado - Eletrodo i eletfodo de refer':ncia. A QGCI\ncurva apresenta inclinay30 de 54.20mv/oC: a 25\u00b0e, 59. 16m V /loC e a lOO\u00b0e, 74.04m V /0e.\n\n*-.L----<> G N D AI3\n\nFigura 10 - Circuito de entrada para 0 sensor de pH integrado. 0 primeiro operacional cria a\nentrada de alta impedancia. 0 segundo inverte 0 sinal e soma uma componente de tensao continua\nfixa. Assim 0 sinal de saida do circuito torna-se unipolar e diretarnente proporcional ao pH.\n\n\n\n----~\n\n12 13 14 pH\n\nFigura 11 - Sinal do sensor modificado pelo circuito de entrada. A modificayao aumenta 0 ganho.\ntoma a correspondencia pH-tensao diretamente proporcional e faz com que 0 sinal seja apenas\npositivo (unipolar).\n\n\n\nm(T) = -(54.20 + 0.198T) . G(_)\n\npH=V-V(7)+7.\nmeT)\n\n\n\nT\"-V(7)\npH == + 7\n\nmeT)\n\nVI-l\"c\nM==---\n\npHI- pHc\n\n\n\nCtemp = L1T. G(_). (-0.198),\n\nv - V(7)\npH= . +7.\n\nm(T)\n\n\n\n2.3.2 Principio da Medida\n\nA unidade de medida da turbidez e 0 NTU - Nephelometric Turbidity\n\nUnits[!O]. 0 metodo escolhido para a medida de turbidez baseia-se na reflexao de luz\n\npelas particulas em suspensao. A amostra e iluminada convenientemente, como\n\nmostrado mais adiante. e faz-se a detecyao da luz refletida. Existem outros metodos\n\npara esse tipo de medida. Dentre eles 0 que se baseia na intensidade de luz\n\ntransmitida.\n\nA atribuiy30 de val ores de NTU e feita atraves da comparayao da intensidade\n\nde luz refletida pel a amostra, sob condiyoes detinidas, com a intensidade de luz\n\nrefletida por uma suspens30 padr30 de referencia[JoJ. Quanto maior a quantidade de\n\nluz refletida maior a turbidez.\n\nAlguns fatores[lO]afetam sensivelmente a medida da turbidez:\n\n- particulas flutuantes, podem obstruir a passagem da luz indicando valores\n\nmais baixos de turbidez;\n\n- particulas pesadas, as quais sedimentam rapidamente:\n\n- bolhas de ar. refletem significativamente a luz; logo ocorre uma indicay30\n\nde turbidez maior que a real;\n\n- a presenya de cOlOray30 na soluyao absorve a luz proveniente da fonte\n\nluminosa fazendo 0 turbidimetro indicar baixos valores:\n\n-valores de turbidez maiores que 40 NTU; em medidas nas quais deseja-se\n\nalta acuracidade a amostra deve ser diluida e ser medida novamente. 0 valor da\n\nturbidez da soluy3o original e, entao, calculado com base na proporyao da diluiy30\n\nfeita. Esse procedimento so e possivel em amostras analisadas em laboratorio.\n\n\n\nInstrumentos de campo de mediyao continua medem diretamente incorrendo em uma\n\nmargem de erro maior.\n\nExistem diversas maneiras de construir urn turbidimetro. Urn exemplo esta\n\nmostrado na figura 12. Esse modelo foi usado na construc;ao do turbidimetro do\n\npresente trabalho.\n\nAlgumas considerayoes[JOJ devem ser feitas acerca da construyao do\n\nturbidimetro :\n\n- Entre a lfunpada e a entrada do tubo deve haver uma lente para concentrar a\n\nluz proximo ao ponto de detecyao, aumentando a eficiencia e diminuindo 0\n\nespalhamento;\n\n- A distancia, ao longo do tubo, da fonte de luz (lampada) e 0 ponto de\n\ndetecyao nao deve ser superior a 1Ocm:\n\n- 0 angulo entre 0 caminho da luz incidente e 0 detector deve ser de 90\u00b0;\n\n- 0 detector deve aceitar luz incidente com urn angulo solido de no maximo\n\n- 0 tubo que contem a amostra deve ser construido internamente em vidro\n\nincolor e mantido absolutamentc limpo. Externamente. esse tuba deve ser recoberta\n\ncom material (tinta, plastico etc.) preta, a que evita reflexoes internas e interferencia\n\nda luz externa:\n\n\n\nr Sensor optico(fototransistor)\n\n~--...\nI .me )\n\n~ Tubodevidropreto\n\n\n\n\n\no = Baixo sensibilidode\n1 ::: Alto sensibilidode\n\nFigura 14 - Circuito de amplifical;:3o e adaptal;:3o do sinal proveniente do foto-sensor do\nturbidimetro\n\n\n\nDuas soluyoes iniciais devem ser preparadas:\n\nSolucao 1: Dissolver 1.00g de sulfato de hidrazina em agua e diluir ate 100ml\n\nnum balao volumetrico.\n\nSolucao 2: Dissolver 10.00g de hexametilenotetramina em agua c diluir ate\n\n100ml num balao volumetrico.\n\nNum terceiro balao volumetrico de 100ml misturar 5ml da soluyao 1 com 5ml\n\nda soluy3.o 2. Diluir ate a marca e agitar. Mantenha a mistura numa\n\ntemperatura de 25 \u00b1 3\u00b0e e aguarde 24 horas. A soluyao resultante apresenta 0\n\nvalor de 400 NTU. Diluindo-se convenientemente essa soluyao chega-se aos\n\nvalores desejados de turbidez.\n\nA soluyao de 400 NTU deve ser usada dentro de um meso As soluyoes\n\nderivadas devem ser usadas dentro de uma semana. A nao observfmcia desses\n\nprazos ocasiona erros na leitura da turbidez, pois pode ocorrer aglutinayao das\n\nparticulas em suspensao.\n\nApos a construyao do turbidimetro fez-se um levantamento da sua resposta\n\nem tensao em funy3.o da turbidez das amostras, tanto na escala de baixa sensibilidade\n\ncomo na de alta. Nas figuras 15 e 16 encontram-se as curvas levantadas e nas tabelas\n\n\n\nTurbidimetro (alta sensibilidade)\ny = -8E-05x3 + 0,0108x2 + 0,2292x + 0,65\n\n:J 40,00\nI-\nZ\n\n~ 30,00\n\"0:e\n::l\nI-\n\n\u2022 Turbidez\n__ Polinomio\n\n0,00\n0,00\n\nFigura 15 - Linearizayao da escala de alta sensibilidade do turbidimetro, 0 polin6mio de 3\u00b0 grau\nfoi calculado atraves dos dados contidos na tabela 3,\n\nTurbidez Tensao(%) 1 Tensao(%) 2 Tensao(%) 3 Media\n0,00 0,81 0.46 0.83 0.70\n4.00 7.50 7.00 7.00 7.17\n\n20.00 39.50 38.00 37.00 38.17\n40.00 64.50 65.80 66.80 65.70\n50.00 89.50 91.00 90.00 90.17\n\n\n\nTurbidimetro (baixa sensibilidade)\ny = -2E-05x4 + 0,0084x3 - 0,2841x2 + 8,8719x + 0,0636\n\n400,00\n\n350,00\n\n300,00\n\nS 250,00I-\n~\nN 200,00\n0>\n\"0:e 150,00\n:l\nI-\n\n100,00\n\n50,00\n\n0,00\n0,00\n\n\u2022 Turbidez\n__ Pollnomio\n\nFigura 16 - Lineariza<;:ao da escala de baixa sensibilidade do turbidimetro. 0 polinomio de 4\u00b0 grau\nfoi calculado atraves dos dados contidos na tabela 4.\n\nTurbidez Tensao(%11 Tensao(%) 2 Tensao(%) 3 Media\n0.00 0.00 0.00 0.00 0.00\n\n50.00 6.76 6.76 6.76 6.76\n80.00 12.80 11.56 12.33 12.23\n\n100.00 15.70 15.70 15.14 15.51\n200.00 29.00 28.60 27.60 28.40\n400.00 38.00 43.50 41.70 41.07\n\n\n\nTabela 5 - Valores medidos com 0 turbidimetro montado em compara~ao COIll os padroes\npreparados.\n\n._' ...\nPadrao Medida 1 Medida 1 Medida 3 Media Erro\n(NTU) Turbidimetro limpo (%)\n0 0.5* 0.8* 0.8* 0.7*\n4 3.1 * 3.0* 3.0* 3.0* 24.2\n20 20.6 20.6 19.3 20.2 0.8\n40 41.5 41.7 39.2 40.8 2.0\n50 51.6 51.5 50.9 51.3 2.7\n50 ** 54 54 52 53.3 6.7\n80 82 82 73 79.0 1.3\n100 100 102 90 97.3 2.7\n200 202 209 173 194.7\n\n\"1 ...,\n.... I\n\n400 430 448 427 435.0 8.8\n\n* Esses valores san dependentes do ojf~setldrift do amplificador usado no circuito. No momenta da\nmedida nao estavam disponiveis operacionais com baixo off-set/drift\n** Escala de baixa sensibilidade.\n\n\n\nVcc 2K2\n\nI_L_M_3 5_D_I~aid:\\/\\/\\;~-\ngnd\n\n+7.5V\nII\n\n----~ entrada\n(AID)\n\n-- gnd\n\n\n\nNo presente trabalho, utilizou-se urn sensor comercial no projeto da sonda.\n\nLogo, a abordagem limitou-se a urn breve estudo dos aspectos construtivos a fim de\n\nobter informac;oes acerca do comportamento eletrico e, assim, projetar urn circuito\n\nde condicionamento de sinal, bem como rotinas de calibrac;ao, para esse tipo de\n\n2.5.2 Principio de Medida\n\nA quantidade de oxigenio dissolvido e baseada na medida da corrente eletrica\n\ngerada devido a aplicac;ao de uma tensao em dois eletrodos imersos em uma soluc;ao\n\neletrolitica[ 12].\n\nUtilizando-se urn eletrodo de metal nobre, ouro ou platina, polarizado\n\nnegativamente de 0.6 a 0.8V em relac;ao a urn outro eletrodo de referencia de\n\nAg/ AgCl ambos imersos numa soluc;ao de KCl isolada por uma membrana[l3] semi-\n\npermeavel. consegue-se a reduc;ao[l4]do O2 no primeiro eletrodo. A reac;ao de reduc;ao\n\nimplica num \"consumo\" de eletrons, que e a corrente eletrica, proporcional it\n\nquantidade de O2 reduzida.\n\nA razao da utilizac;ao de tensoes da ordem de 0.6 a 0.8V e dada pelo grafico\n\nde tensao-corrente conhecido como polarogramd12] mostrado na figura 18. De 0 a\n\n0.6V a corrente aumenta com 0 aumento da tensao. De 0.6 a 0.8V praticamente nao\n\nha variac;ao da corrente com relac;ao it tensao. A partir de 0.8V a corrente cresce com\n\no aumento da tensao devido principalmente a eletr6lise da agua. Fixando-se uma\n\ntensao na faixa de 0.6 a 0.8V obtem-se. entao. uma leitura de corrente diretamente\n\nproporcional a quantidade de ions reduzidos.\n\n\n\n-~-~----~~--~--~--\n-- --------------\n\nI\nI\nI\n\nTensao de polariza\\(ao = -D.N I\nI\nI\n\nI\n2D\n\nFigura 18 - A esquerda esta a corrente gerada por urn sensor de oxigenio dissolvido em fUny30 da\ntens30 aplicada (porcentagern de oxigenio fixa). A dire ita. a corrente em fUny30 da porcentagern de\noxigenio (tensao fixa).\n\n\n\nao Amplificador\n\n+\n\nFigura 19 - Desenho do sensor de oxigenio dissolvido utilizado na avaliayao do desempenho da\nsonda proposta.\n\n\n\nao Amplificador\n\n+\n\nFigura 20 - Sensor de oxigenio com compensa<;:ao de pressao. A membrana de compensa<;:ao, nao\npermeavel, torna a pressao no eletr6lito igual it pressao extema.\n\n\n\nA sensibilidade dos sensores de oxigenio aumenta com a temperatura de\n\nmaneira exponencial. Logo, a compensaryao deve ser feita atraves de tabelas que\n\ncontem a resposta do sensor para cada temperatura. No caso de instrumentos digitais\n\nessas tabelas podem ser convertidas em curvas e implementadas via software, como\n\nfoi feito nesse trabalho.\n\nAlem da variaryao da sensibilidade do sensor com a temperatura, a\n\nsolubilidade do O2 tambem varia com a temperatura, 0 que e compensado da mesma\n\nmaneira atraves de tabelas. Na tabelal17] 6 esti a solubilidade do 00 nas diversas\n\nA solubilidade[15] do O2 varia tambem com a pressao, sendo essa variaryao\n\nlinear e diretamente proporcional a variaryao da pressao. Assim. dependendo da\n\naltitude na qual se faz a medida deve-se corrigir 0 valor da solubilidade do 02'\n\na) Porcentagem: calibra-se 0 instrumento com base em duas soluryoes uma\n\nsem oxigenio (0%) e uma outra saturada de ar ou oxigenio puro (100%).\n\nb) mg/l ou ppm: com base na porcentagem e tabelas de solubilidade calcula-\n\nse a concentraryao do oxigenio na soluryao. Por exemplo, uma amostra esta a 20DC e a\n\n760mmHg. e a medida acusa 30% de oxigenio. Consultando-se a tabela 6 encontra-sc\n\n\n\n8.84mg/l na saturayao. Logo, a concentrayao de oxigenio nessa amostra e 0.3 x 8.84\n\n= 2.65mg/l. E importante observar que se a pressao na qual a amostra se encontra for\n\ndiferente da pressao no momento da calibrayao, e necessario fazer a correyao.\n\nTabela 6[17] - Solubilidade do oxigenio em func;:aoda temperatura.\n\nTemp. 0.0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9\n0 14.16 14.12 14.08 14.04 14.00 13.97 13.93 13.89 13.85 13.81\nI 13.77 13.74 13.70 13.66 13.63 13.59 13.55 13.51 13.48 13.44\n2 13.40 13.37 13.33 13.30 13.26 13.22 13.19 13.15 13.12 13.08\n3 13.05 13.01 12.98 12.94 12.91 12.87 12.84 12.81 12.77 12.74\n4 12.70 12.67 12.64 12.60 12.57 12.54 12.51 12.47 12.44 12.41\n5 12.37 12.34 12.31 12.28 12.25 12.22 12.18 12.15 12.12 12.09\n6 12.06 12.03 12.00 11.97 11.94 11.91 11.88 11.85 11.82 11.79\n7 11.76 11.73 11.70 11.67 11.64 11.61 11.58 11.55 11.52 11.50\n8 11.47 11.44 11.41 11.38 11.36 11.33 11.30 11.27 11.25 11.22\n9 11.19 11.16 11.14 11.11 11.08 11.06 11.03 11.00 10.98 10.95\n\n10 10.92 10.90 10.87 10.85 10.82 10.80 10.77 10.75 10.72 10.70\n11 10.67 10.65 10.62 10.60 10.57 10.55 10.53 10.50 10.48 10.45\n12 10.43 10.40 10.38 10.36 10.34 10.31 10.29 10.27 10.24 10.22\n13 10.20 10.17 10.15 10.13 10.11 10.09 10.06 10.04 10.02 10.00\n14 9.98 9.95 9.93 9.91 9.89 9.87 9.85 9.83 9.81 9.78\n15 9.76 9.74 9.72 9.70 9.68 9.66 9.64 9.62 9.60 9.58\n16 9.56 9.54 9.52 9.50 9.48 9.46 9.45 9.43 9.41 9.39\n17 9.37 9.35 9.33 9.31 9.30 9.28 9.26 9.24 9.22 9.20\n18 9.18 9.17 9.15 9.13 9.12 9.10 9.08 9.06 9.04 9.03\n19 9.01 8.99 8.98 8.96 8.94 8.93 8.91 8.89 8.88 8.86\n20 8.84 8.83 8.81 8.79 8.78 8.76 8.75 8.73 8.71 8.70\n21 8.68 8.67 8.65 8.64 8.62 8.61 8.59 8.58 8.56 8.55\n22 8.53 8.52 8.50 8.49 8.47 8.46 8.44 8.43 8.41 8.40\n23 8.38 8.37 8.36 8.34 8.33 8.32 8.30 8.29 8.27 8.26\n24 8.25 8.23 8.22 8.21 8.19 8.18 8.17 8.15 8.14 8.13\n25 8.11 8.10 8.09 8.07 8.06 8.05 8.04 8.02 8.01 8.00\n26 7.99 7.97 7.96 7.95 7.94 7.92 7.91 7.90 7.89 7.88\n27 7.86 7.85 7.84 7.83 7.82 7.81 7.79 7.78 7.77 7.76\n28 7.75 7.74 7.72 7.71 7.70 7.69 7.68 7.67 7.66 7.65\n29 7.64 7.62 7.61 7.60 7.59 7.58 7.57 7.56 7.55 7.54\n30 7.53 7.52 7.51 7.50 7.48 7.47 7.46 7.45 7.44 7.43\n31 7.42 7.41 7.40 7.39 7.38 7.37 7.36 7.35 7.34 7.33\n32 7.32 7.31 7.30 7.29 7.28 7.27 7.26 7.25 7.24 7.23\n33 7.22 7.21 7.20 7.20 7.19 7.18 7.17 7.16 7.15 7.14\n34 7.13 7.12 7.11 7.10 7.09 7.08 7.07 7.06 7.05 7.05\n35 7.04 7.03 7.02 7.01 7.00 6.99 6.98 6.97 6.96 6.95\n\n\n\na) Solucao com nivel zero de oxigenio (0%): existem substancias que reagem\n\ncom 0 oxigenio dissolvido consumindo-o. Urn exemplo e 0 Sulfito de S6dio\n\n(Na2S03). Este deve ser dissolvido na solw;ao na propon;ao de lOOmg de sulfito por\n\nSml de soluyao.\n\nb) Solucao saturada de oxigenio (100%): urn metodo simples para obter uma\n\nsoluyao com lOO% de oxigenio dissolvido consiste em borbulhar ar ou oxigenio num\n\nrecipiente contendo urn liquido, geralmente agua destilada, livre de materia viva que\n\npossa consumir oxigenio. Esse borbulhamento deve durar pelo menos 30min, pois 0\n\ntempo para ocorrer 0 equilibrio e grande.\n\no tipo de eletr6lito varia muito em funyao do tipo de sensor utilizado. Devido\n\nao con sumo de ions, 0 eletr6lito deve ser trocado periodicamente. No sensor utilizado\n\nnesse trabalho a composiyao do eletr6lito e a seguinte:\n\n-0.3 Mol de KCI\n\n-0.15 Mol de NaH2P04\n\n-aproximadamente 3 moles de NaOH, que sao adicionados ate obter-se\n\no circuito de urn medidor de oxigenio deve ser capaz de fomecer uma tensao\n\nfixa entre 0.6 e 0.8V (0.7V nesse trabalho) e de medir a corrente gerada pelo sensor.\n\nA intensidade dessa corrente, como mencionado anteriormente, varia muito em\n\nfunc;ao da area do eletrodo. Assim, 0 circuito que mede a corrente deve ser proietado\n\n\n\n5V6 BK2\nIII IC\n\n'\" '\"I()\n\nrGNDAI2\n\n\n\npara 90% do valor e 80s para 100% do valor. Vale observar, ainda, que existe urn\n\ntempo relativamente grande, cerca de 5rnin, para 0 sensor estabilizar logo que e\n\nligado (aplica<;ao dos 0.7V).\n\nDevido a estratifica<;ao que ocorre em aguas com pouca agita<;ao,\n\nnotadarnente nos lagos, os parametros fisicos e quimicos da agua variam ao longo da\n\nprofundidade. Logo, torna-se indispensavel agregar a um grupo de medidas a\n\nprofundidade na qual 0 mesmo e realizado.\n\nAte pouco tempo atras, media-se a profundidade atraves de marcas no cabo\n\nque sustentava os instrurnentos. Esse metodo e bastante impreciso e incomodo, alem\n\nde nao ser passivel de automa<;ao.\n\nExistem varios rnetodos eletronicos para a medi<;ao de profundidade em\n\nrela<;ao a superficie. 0 rnais adequado para 0 caso de uma sonda microprocessada e\n\nmedir a pressao, atraves de um sensor especifico, e, considerando a densidade[18] da\n\nagua, calcular a profundidade.\n\nNo presente trabalho, nao se conseguiu um sensor de pressao comercial e\n\ntarnpouco houve interesse na constru<;ao de urn, principalrnente pela cornplexidade\n\nrnecanica de tal instrurnento. Assirn, optou-se par urn outro metodo de rnedida 0 qual\n\nrnede, eletronicamente, 0 cornprirnento do cabo lan<;ado ao lago.\n\n\n\n\n\no foto-transistor. Assim sac gerados pulsos eletricos a medida que a polia gira. De\n\nacordo com 0 numero de \"dentes\" do encoder tem-se a precisao da contagem. Por\n\nexemplo: deseja-se uma precisao de lcm na mediyao da profundidade. Admitindo-se\n\numa polia de 2.87cm de raio, tem-se urn perimetro de 2m = 2 x 3.14 x 2.87 = 18cm.\n\nLogo, a cada volta da polia sac lanyados ao lago 18cm de cabo. Assim, se 0 encoder\n\ntiver 18 \"dentes\". urn pulso sera gerado a cada centimetro.\n\nA detecyao do sentido de rotayao da polia vem da analise dos sinais gerados\n\npelos dois sensores posicionados convenientemente. Na figura 24 estao mostradas as\n\nformas de onda colhidas nos foto-transistores posicionados conforme a figura 23 com\n\na polia girando no sentido anti-horario. Os sinais sac defasados de 90\u00b0, num arranjo\n\nconhecido como quadratura[22J\u2022\n\nUrn dos sinais e tornado como referencia. no caso a borda de subidal do sinal\n\n1. A quantidade de puisos e contada a cada borda de subida do sinal 1. Na figura 25 0\n\nmesmo arranJo da figura 24 e mostrado, porem com a polia girando no sentido\n\nhorario.\n\nComparando-se as formas de onda da figura 24 com as da figura 25, nota-se\n\nque no momenta em que ocarre a borda de subida do sinal 1 0 nivel do sinal 2 varia\n\nem funyao do sentido de rotayao. Se 0 sentido e anti-harario, 0 nivel do sinal 2 e zero\n\n(branco). E, se 0 sentido e horario, 0 nivel do sinal 2 e urn (preto). Desta maneira. a\n\ndetecyao do sentido e feita atraves da amostragem do sinal 2 com base na borda de\n\nsubida do sinal 1. Na figura 26 esta urn exemplo de circuita que realiza a funyao da\n\namostragem. Com base nos sinais produzidas pelo circuito da figura 26, 0 contador\n\n\n\nFigura 23 - A esquerda, 0 encoder utilizado. A direita, 0 sistema de detecyao optico. Note 0\nposicionamento dos sensores, com defasagem de 90\u00b0\n\n\n\nPreto = 1\nBranco = 0\n\n! sentido de\n! rotac;;ao\n\nFigura 24 - Sinais gerados quando 0 encoder gira no sentido anti-honirio. Quando 0 sensor I\ndetecta a passagem do branco para 0 preto 0 sensor 2 esta detectando 0 branco.\n\nPreto = 1\nBranco = 0\n\nsentido de\nrotac;;aoI\n\nsensor 2 I\n\nI\nI\nI\nI\n\nFigura 25 - Sinais gerados quando 0 encoder gira no senti do horario. Quando 0 sensor I dctecta a\npassagem do branco para 0 pre to 0 sensor 2 esta detectando 0 preto.\n\nt Q\nCk\n\nD\n\nO=anti-horario\nl=horario\n\n\n\nin_--r:'~\n~~\n\nI\nRef = O.lV\n\n\\\n\n\\ Ref = O.lV\n\nFigura 27 - No grMico estao mostradas as formas de onda dos sinais do foto-transistor e da saida\ndo comparador. A direita. 0 comparador.\n\n2 lnterrup.;ao e uma func;ao dos microprocessadores, em geral ativada por hardware, a qual desvia a\nexecuc;ao do program a principal para uma subrotina qualquer. A interrupc;ao pode ou nao ser atendida\npelo microprocessador deoendendo da sua programac,;ao\n\n\n\no circuito proposto para a sonda esta dividido basicamente em duas partes: a\n\nunidade central e os circuitos dos instrumentos. Estes ultimos sac descritos em\n\ndetalhe no capitulo que trata dos instrumentos. Todos eles entregam it unidade central\n\nurn sinal ana16gico na faixa de 0 a 5V. Apenas 0 medidor de profundidade trabalha\n\ncom sinais digitais especificos.\n\nPor motivos de portabilidade e compatibilidade escolheu-se utilizar a porta\n\nserial RS232f23J,padrao nos micros IBM/PC, para realizar a transferencia de dados\n\nentre a sonda eo PC.\n\nNa figura 28, esta 0 diagrama em blocos do circuito, que e composto por urn\n\nmicrocontrolador RISC (PIC l6C84)f24J, urn conversor AID serial de l2bits\n\n(MAXI 87)[25J.2 chaves anal6gicas (DG20I)126J, urn multiplexador (CD4028B), 4\n\nfontes de alimentavao duplas, 1 adaptador RS232, 5 circuitos de condicionamento e\n\ncontrole dos sinais dos instrumentos e 0 circuito do me did or de profundidade.\n\nNa figura 1 do apendice A, esta 0 diagrama esquematico que serve de base\n\npara a explicavao das funvoes da unidade central.\n\n\n\n3 Host e urn computador que controla outro, geralmente centralizando 0 controle\n4 RISe - Reduced instruction Set Computer - Microprocessador com pequeno conjunto de instrw;:oes.\n5 EEPROM - Eletric Eraseble Programable Read Only Memory - Memoria na qual se po de gravar\ndados os quais SaG retidos mesmo retirando a alimental;:ao. No entanto com a aplical;:ao de sinais\neletricos convenientes pode-se apagar ou mesmo reprogramar 0 conteudo da memoria\n6 Bidirecional significa uma porta que pode ser programada para atuar como entrada ou como said\"\n\n\n\nMedidor de\nTurbidez\n\n---\u00b7\u00b7---r- _ -\n\nI\n\nMedidor de\nCondutividade\n\nAdaptador\nRS232\n\nMedidor de\nDO\n\nChave\nAna16gica\n\nMedidor de\nTemperatura\n\n+ 12V extemos\n\nI\n\nMedidor de\nProfundidade\n\n\n\n3.2.1 Programa~ao das Portas\n\nPorta A\n\nRA2, RAl, RAO: pinos de saida formando uma palavra de 3 bits a qual\n\nendere9a 0 muhiplexador da entrada anal6gica de acordo com a tabela 7.\n\nRA3: pino de saida que comanda a escala automatica do turbidimetro. Assim:\n\nRA3=O --+ baixa sensibilidade;\n\nRA3= 1 --+ aha sensibilidade.\n\nRA4: pino de entrada 0 qual Ie 0 sentido do deslocamento do medidor de\n\nprofundidade.\n\nPorta B\n\nRBO: pino de entrada de interrup9ao utilizado para a contagem de pulsos do\n\nmedidor de profundidade.\n\nRBI, RB5: pinos de saida que comandam, de acordo com a tabela 8, a escala\n\nautomatica do condutivimetro.\n\nRB2: pino de entrada que recebe os dados do conversor AID.\n\nRB3: pino de saida que envia 0 sinal de clock para a comunica9ao serial\n\nsincrona com 0 conversor AID.\n\nRB6: pino de saida que envia os dados pel a RS232\n\nRB7: pino de entrada que recebe os dados pela RS232\n\n\n\nEntradas anaLOgicas RA2 RAi RAO\nAIO 0 0 0\nAll 0 0 1\nAI2 0 1 0\nAI3 0 1 1\nAI4 1 0 0\n\nRBi\no\no\n1\n1\n\nRB5\no\n1\no\n1\n\nSensibilidade\nAlta\n\nMedia\nPequena\n\nX\n\n\n\n7 Transistor no corte significa que 0 mesmo nao esta conduzindo, ou seja apresentando alta\nimpediincia entre coletor e emissor.\n8 Transistor na satura~ao significa que 0 mesmo esta conduzindo, ou seja apresentando baixa\nimpediincia entre coletor e emissor.\ny A comunica~ao serial assincrona nao utiliza sinal de clock. Esse tipo de comunica<;:ao baseia-se em\ntemporiza<;:ao pre-determinada. 0 sincronismo e feito no inicio da transmissao, quando 0 start-bit e\nrecebido, e, a partir dai. cada dispositivo conta seu proprio tempo para realizar a transmissao e\nrecep<;:ao dos dados.\n10 Baud = bits s\n\n\n\n....................... ---------------:0; :2;3:4:5:6:7:\n\nFigura 29 - Esquema de transmissao de dados no padrao RS232. No meio fisico (cabo) esse sinal e\ninvertido.\n\n\n\nFigura 30 - Palavra de 16 bits colocada no registrador de deslocamento ao final de cada conversao.\no primeiro bit e 0 sinalizador de fun de conversao (EOC).\n\ncs ~S SS...---------------'\nSCLl( ----fL--ss S\nOOJT~~\n\n\u2022 ~Eoe\nINTERFACE OCIOSA __ I 4 E~~:~R~S~\"I \u2022... Eoe \u2022..\u2022 1\n\n12 x 0.250115' 3.25j!s\n\nTOTAl. 12.2S1ts\n\n--1--ll\\1S--I~1\n(Ies) .. ,\n\n\n\nTabela 9 - Niveis logicos das saidas dos transistores comandados pelo CD4028B em funyao do\nendereyamento.\n\nD C B A SO Sl S2 S3 S4\n0 0 0 0 0 1 1 1 1\n0 0 0 1 1 0 1 1 1\n0 0 1 0 1 1 0 1 1\n0 0 1 1 1 1 1 0 1\n0 1 0 0 1 1 1 1 0\n\nII Chave analogica e urn dlspositivo eletronico que atua de maneira similar a urn rele. Com 0 rnesrna\npode-se controlar dig:italmente a conexao de urn sinal analoQ.icC'\n\n\n\nSinol~\nAI0\n\n\n\no processo de como e feita a sele~ao automatica esta no capitulo 4 que trata\n\nda descri~ao do programa em linguagem montadora do PICI6C84.\n\no medidor de profundidade, descrito no capitulo 2 item 2.6, gera dois sinais:\n\nurn sinal tipo transi~ao referente aos pulsos do encoder e urn outro sinal de nivel\n\nreferente ao sentido de rota~ao. 0 sinal de transi<;ao ativa a interrupc,:ao atraves da\n\nentrada de interrup<;ao RBO/INT. 0 sinal de nivel e lido pelo pino de entrada RA4. 0\n\nprocesso de rnedic;:aoda profundidade pode ser visto nos capitulos 2 e 4, que tratam\n\ndos instrurnentos e do programa em linguagem montadora respectivarnente.\n\no PIC 16C84 atende a interrupc;:ao depois de 5 cicJos de clock. Com urn crista]\n\nde 4MHz cada cicJo dura 1flS (0 clock internamente e dividido por 4). Assim, atende-\n\nse a intcrrupc,:ao em 5fls. A rotina de contagem gasta aproximadamente 13fls. Logo.\n\ntem-se 18flS na contagem de urn pulso do encoder. No medidor proposto a precisao\n\ndesejada e de 1cm. Considerando-se 5m/s como a velocidade maxima de descida da\n\nsonda, 0 que e bastante rapido, tem-se a gera<;ao de 500 pulsos por segundo. ou\n\npulso a cada 2000fls.\n\nAs (micas rotinas que dependem de temporizac;:ao preCIsa, e poderiam\n\neventual mente sofrer com a interrup9ao, sao as rotinas que implementam a interface\n\nserial RS232. A transmissao de urn byte a 2400 bauds leva 4.166ms e cada bit leva\n\n416.6flS. Se 0 periodo das interrupc;:oes e no minimo 2000fls. entao no pior caso um\n\nbyte sofreria duas interrup90es atingindo a transmissao de dois hits distintos. Cada hir\n\natingido teria seu tempo de durac,:ao aumentado em 18flS. Como a RS232 Ie 0 nivel\n\ndo sinal no meio do periodo, ou seja a 208.3flS do inicio, esse acrescimo nao causa\n\n\n\nproblema. Se, em todo caso, houver urn erro na transmissao serial, este e detectado\n\npOlS, como explicado no capitulo 4 (descric;ao do programa em linguagem\n\nmontadora), juntamente com os bytes de informac;ao sao enviados bytes de\n\nverificac;ao. Nesse caso, 0 grupo de bytes com erro e desprezado.\n\nA fim de simplificar a alimentac;ao do circuito e preyer 0 uso de bateria, 0\n\nsistema foi projetado para ser alimentado com tensao extern a simples de + 12Y. No\n\nentanto, internamente ha a necessidade de outras tens5es, inclusive com fontes\n\nisoladas galvanicamente. Para os circuitos digitais foi escolhida a tensao de +5V,\n\nderivada diretamente dos + 12Y. 1a os circuitos anal6gicos necessitam de fontes\n\nsimetricas de tensao, isto e, fonte positiva e negativa. Alem disso, devido aos\n\ninstrumentos trabalharem simultaneamente no mesmo fluido (agua), os circuitos dos\n\nmedidores de pH. de oxigenio dissolvido e de condutividade nao podem ter fontes\n\ncom terra comum, caso contrario ocorre interferencia devido a corrente i6nica que\n\nflui de urn sensor ao outro.\n\nDesta maneira para obter as fontes requeridas, construiu-se uma fonte\n\nchaveada baseada em urn transformador com quatro enrolamentos secundarios\n\nisolados. Tres deles formam as fontes para os medidores de pH, de oxigenio\n\ndissolvido e de condutividade. A quarta fonte tern 0 OV aterrado servindo aos\n\ncircuitos restantes da sonda.\n\nDe acordo com a figura 33, a fonte e constituida por urn CI especifico para\n\nfontes chaveadas (SG3524), 0 qual gera uma onda quadrada na frequencia de 40KHz.\n\n\n\nRetificacao +7.5V\nFiltragem -7.5V pH\nEstabilizacao 0V\n\n+1 Y Retificacao +7.5V\nFiltragem -7.5V 02\nEstabilizacao 0V\n\n'<t\nN Retificacao +7.5VL[)\nto Filtragem -7.5V Condutividade()\n(f) Estabilizocoo 0V\n\nRetificacao +7.5V\nFiltragem -7.5V Gerol\nEstabilizacao 0V\n\n\n\n4. Programa~ao\n\no sistema de medidas proposto e composto por dois equipamentos distintos: a\n\nsonda e urn micro padrao IBM/PC. As funyoes de aquisiyao e transmissao dos dados\n\nda sonda sao controladas por urn microcontrolador PIC 16C84, 0 qual possui urn\n\nprograma em linguagem montadora[24]na sua memoria interna EEPROM de 1Kbytes.\n\nA listagem completa do programa esta no apendice B.\n\nNo micro IBM/PC, alem da comunicayao serial, encontram-se as funyoes de\n\nvisualizayao, gravayao e analise dos dados bem como as rotinas de calibrayao dos\n\ninstrumentos que requerem tais procedimentos.\n\nDevido a grande variedade de linguagens e programas que a plataforma\n\nIBM/PC permite utilizar, no inicio do trabalho houve uma certa duvida na escolha da\n\nlinguagem que seria utilizada para a construyao do programa para 0 Pc. 0 requisito\n\nbasico na escolha foi a apresentayao grafica, a qual deveria ser no padrao Windows.\n\nTentou-se, inicialmente, 0 uso do Visual C++, 0 qual cria programas executaveis\n\nbastante rapidos em Windows. No entanto, dado ao pouco conhecimento na area de\n\nprogramayao, e nao sendo esse 0 objeto principal do trabalho, nao se conseguiram\n\nresultados imediatos. Partiu-se, entao, para uma linguagem mais simples mas que\n\nainda atendesse as exigencias iniciais. Nao havendo necessidade de velocidade de\n\n\n\n12 Toda a programayao em Visual Basic foi baseada no proprio help do Visual Basic e no livro\nindicado na referencia.\n\n\n\nCanal AN4 (Temperatura) 1) MSB\n2)LSB\n3) Byte de verificac;ao\n\nCanal AN3 (pH) 4) MSB\n5) LSB\n6) Byte de verificac;ao\n\nCanal AN2 (Oxigenio dissolvido) 7) MSB\n8) LSB\n9) Byte de verificac;ao\n\nCanal ANt (Turbidez) 10) MSB\n11) LSB\n12) Byte de verificac;ao\n\nCanal ANO (Condutividade) 13) MSB\n14) LSB\n15) Byte de verificac;ao\n\nProfundidade 16) MSB\n17) LSB\n18) Byte de verificac;ao\n\nEscalas 19) Escala do Condutivimetro\n20) Escala do T urbidimetro\n\n\n\nbits 7 6 5 4 3\n,.,\n\n1 0..\nMSB 1 BII BIO B9 B8 B7 B6 B5\nLSB B4 B3 B2 BI BO 0 0 0\n\nOOh ~ sensibilidade baixa\nOlh ~ sensibilidade alta\n\nOOh ~ sensibilidade alta\nOlh ~ sensibilidade media\n02h ~ sensibilidade baixa\n\n\n\n1 ransmlle para 0 PC os dados da conversao\n+h\\'le de verifica~ao (XOR)\n\nl sim\nTransmlle valor da profundidade +hrle de\n\nveritica~ao\n\nI ransmite escala, do condutivimetro c 0\ntllrbidirnetw\n\nFigura 34 - Fluxograma do program a em assembler do PIC 16C84. Por questoes de c1areza alguns\nblocos sao explicados a parte e referenciados atraves dos simbolos Rot I. Rot2. Rot3. Rot4 e RotS.\n\n\n\nRotl- Rotina de inicializacao\n\nNessa parte do programa 0 microcontrolador realiza as seguintes tarefas:\n\n-Programa 0 Watch Dog Timer, detalhado mais adiante, para Iseg.;\n\n-Zera 0 contador da profundidade;\n\n-Configura a interrupc;;ao, habilitando-a;\n\n-Programa pinos da porta B de acordo com 0 descrito no capitulo 3;\n\n-Atribui nivel inicial dos sinais SCLK e CS do conversor AID;\n\n-Seleciona escala de alta sensibilidade do condutivimetro;\n\n-Seleciona escala de alta sensibilidade do turbidimetro;\n\n-Programa pinos da porta A de acordo com 0 descrito no capitulo 3;\n\n-Zera contador do seletor de escalas do condutivimetro:\n\n-Desabilita todas as entradas analogicas.\n\nRot2- Selecao da porta analo!!ica\n\nExiste urn contador (reg. F ISh) que conta de 5 a 1. Atraves da rotina\n\nP_ANALG, apendice B, faz-se a relac;;aoentre 0 numero do contador e 0 enderec;;o da\n\nporta analogica. Assim, conforrne 0 contador vai sendo diminuido as portas\n\nanalogicas vao sendo selecionadas. Quando 0 comador chega a zero. significa que\n\ntodas as portas ja foram acessadas e 0 programa, entao, reinicia. Vale observar que e\n\nnecessario aguardar urn tempo entre a selec;;aoda porta e a conversao AID. Devido a\n\nmultiplexac;;ao da entrada analogica ter sido feita de maneira discreta, existe urn\n\ntempo de acomodac;;ao do sinal quando 0 mesmo e chaveado. Aproveitando 0 tempo\n\n\n\n~\nI\n\nAguarda OAs para\ncstabi Iiza~ao da lcnsao do\ncondutivimetro cm fun~ao\nda tmea de eseala.\n\n~ Diminui scnsibilidadc\n\n~ Aumenta scnsibilidadc ~\n\n\n\n~ Diminui sensibilidade\n\ni\u2022Rctorna\n\n\n\nqual, na realidade, dura apenas 8.5/ls. E chamada, entao, uma outra rotina\n\n(RECDADO) a qual Ie 0 byte mats significativo da palavra de 16 bits que 0\n\nconversor gera. Esse byte e armazenado no registrador f13h. A rotina RECDADO e\n\nchamada uma segunda vez, retirando , desta vez, 0 byte menos significativo. Esse\n\nbyte e armazenado em f12h.\n\nEm resumo, a cada chamada de LECONV uma conversao e feita retomando\n\nnos registradores f13h e f12h os bytes correspondentes ao valor convertido.\n\no TYatch Dog Timer, ja mencionado no capitulo 3, e uma funyao muito\n\ninteressante, encontrada em toda a linha PIC, a qual reinicializa 0 microcontrolador\n\ntoda vez que este, por um motivo qualquer, tern a execuyao do seu programa\n\ninterrompida.\n\no funcionamento do Watch Dog Timer (WDT) baseia-se num oscilador RC\n\nintemo independente do clock, 0 qual aumenta urn contador que pode ser zerado por\n\nsoftware. Quando ocorre transbordamento nesse contador 0 microcontrolador e\n\nreinicializado. 0 tempo para ocorrer transbordamento pode ser programado dentro de\n\naproximadamente 18ms a 2.3s. Quando se habilita 0 funcionamento do WDT e\n\nnecessario inserir, nos layos do programa, uma instruyao que zera 0 registrador do\n\nWDT num periodo men or que 0 tempo programado para ocorrer transbordamento.\n\nAssim quando a execuyao e interrompida nao ocorre 0 zeramento e. ap6s 0 tempo\n\n\n\nNo caso presente 0 WDT foi programado para 1s. A instruyao que zera 0\n\nWDT e a CLRWDT, a qual pode ser vista em varios pontos do programa mostrado\n\nno apendice B.\n\nComo ja descrito no capitulo 2 a medida da profundidade da sonda utiliza a\n\nfunyao de interrupyao do microcontrolador. Essa funyao, estando habilitada, permite\n\ninterromper a execuyao do programa em qualquer ponto transferindo-a para 0\n\nendereyo 0004h, no caso do PIC16C84. Nesse endereyo existe urn jump para uma\n\nsub-rotina (ROTINT) que executa as funyoes de aumentar ou diminuir 0 valor de\n\numa palavra de 16bits, a qual corresponde ao valor da profundidade.\n\nNos PIC's a interrupyao pode ser programada para ser ativada tanto por uma\n\nborda de subida como por uma borda de descida. No caso presente, essa foi\n\nprogramada para ser sensivel a borda de descida.\n\nAlguns microcontroladores possuem intemamente, implementada em\n\nhardware, uma interface serial RS232. No entanto, 0 PIC16C84 nao possui tal\n\nrecurso. Assim, foi necessarIO implementar a interface serial via programayao.\n\nCriaram-se duas rotinas: uma para transmissao (TXPIC) e outra para recepyao\n\n(RXPIC). Ambas trabalham com taxa de transmissao fixa, em 2400 bauds. Essa taxa\n\ne baseada em temporizayoes derivadas de atrasos inseridos na execuyao do programa.\n\nComo esses atrasos dependem do clock, as rotinas apresentadas aqui operam em\n\n2400 bouds apenas, para urn clock de 4MHz num microcontrolador PIC 16C84. Se\n\n\n\nhouver mudan~a no clock ou no microcontrolador a temporiza~ao precisani ser\n\nrevista.\n\nEscolheu-se operar a 2400 bauds, 8 bits de dados 1 stop bit e urn start bit.\n\nDesta mane ira, a transmissao de urn byte corresponde a 10 bits. Cada bit dura, entao,\n\n1/2400=416.6/-1s. A leitura de urn bit da-se no meio de seu periodo. Isto e, a leitura e\n\nfeita a 208.3/-1s a partir do inicio do bit. Para auxiliar as rotinas de transmissao e\n\nrecep~ao foram criadas duas rotinas de temporiza~ao: a DELA Yl, a qual gera 208/-15\n\ne DELA Y2. a qual gera 416/-1s.Esses valores sao aproximados.\n\nEssa rotina Ie bit a bit 0 registrador f20h que deve conteI' 0 byte a ser\n\ntransmitido. 0 pino RB6, saida da serial, e entao posto em nivel zero ou nivel urn de\n\nacordo com os bits do registrador f20h. Os bits VaGsendo colocados em sequencia.\n\ndo menos significativo para 0 mais significativo. na porta RB6 aguardando-se 416/-1s\n\nentre a mudan~a dos mesmos. Alem disso, no inicio e colocado 0 start bit (=0) e no\n\nfinal 0 stop bit (=1). A figura 29 do capitulo 3 exemplifica essa sequencia.\n\n4.2.3.2 Rotina de recep~ao\n\nQuando a RS232 esta ociosa 0 nivel do sinal fica em 1 (nivellogico). 0 inicio\n\nda transmissao e detectado quando 0 start bit e enviado (nivel=O). Assirn. para\n\ndetectar 0 inicio de uma transmissao a rotina RXPIC permanece 0 tempo todo lendo\n\no nivel do pino RB7, destinado a recep~ao da RS232. Quando 0 nivel cai a zero.\n\naguarda-se 416/-1s. 0 que significa a passagem do start bit. Em seguida, inicia-se urn\n\ncontador para nortear a leitura dos 8 bits e aguarda-se 208/-1s.Este e 0 ponto medio\n\ndo primeiro bit (hitO). Faz-se, entao, a leitura do nivel do pino RB7 e armazena-se c'\n\n\n\n208ets Stop bit ~\\\nI \\,\n\n416~s I 416~s 416flS\n..----.~!+----++-----+' \\\n\n- - -'. - - - - ~ - - .- - - - - - - - - - - - - - - - - ------\n:0:1 '2:3:4:5:6:7\n\nbyte\n\n\n\no Visual Basic tern 0 seu funcionamento baseado em janelas e elementos\n\n(objetos) graficos. Cada elemento gratico, que pode ser urn desenho, urn texto, uma\n\nimagem capturada etc, esta associado a urn conjunto de sub-rotinas. Assim, conforme\n\nesse elemento e ativado, atraves do mouse, por exemplo, os comandos contidos nas\n\nsub-rotinas sac executados.\n\no programa desenvolvido possui os seguintes recursos:\n\n\u2022 comunica((ao serial pela RS232 a 2400 bauds tendo como op((ao as portas\n\n\u2022 rotinas para a calibra((ao dos instrumentos que medem oxigenio\n\ndissolvido e pH;\n\n\u2022 grava((ao em arquivo padrao dos dados recebidos em dais modos:\n\nautomatico, com interval a de 1s a 60s, e manual;\n\n\u2022 visualiza<;ao digital e anal6gica dos dados recebidos com mudan((a\n\nautomatica de escalas;\n\n\u2022 visualiza((ao e impressao de arquivos ja gravados;\n\n\u2022 grava((ao dos parametros da calibra((ao.\n\nPara tanto, a programa conta com 6 janelas as quais sao chamadas de acordo\n\ncom as comandos dados pel a uswirio. Ha uma janela de apresentayao, janela\n\nprincipal a qual fica ativa 0 tempo todo, uma janela para a visualizayao do arquivo no\n\nqual sao gravados os dados recebidos, uma janela para selecionar arquivos para\n\n\n\n13 Na realidade, intemarnente ao rnicrocornputador cada cornando e processado em serie em ordern\ndeterminada pelo proprio software. No entanto, 0 usmirio tern a irnpressao do paralelisrno. Vale\n\n\n\noDservar. ainda. que deve-se ter aten<;:ao quando ha ocorrencIa de rotmas concorrentes ocm e difll: I\nsaDer qUal sera exccutao<1 nnmelr\n\n\n\n\u2022 receiving data\n\neom.Port: 4\nCalibration FileflllIIllll: c:\\virt-_\\iritcal_ca1\nData Acquisition FileN-= c:\\Yirt .\u2022\u2022\u2022\u2022\u2022\\dat.l_dat\nN\u2022\u2022\u2022\u2022be. 01 AcquititioM done: 7\n\n, A\"'l- Node: M\u2022\u2022\u2022\u2022\u2022\u2022\u2022 aquiaition\n\nSit'Itl I\nD~elTme\n\n01-14-1!r.17\n14:57:30\n\nffi\n'7 8 1:kaltne\n\n. p 12\n14\n\n'Help\nManual AcqUisitiOn\nAutomatic Acquisition\nSet Acquisition Step ...\n\nComm F'ort ~\n\n\" pH Temp Conection 0 n\n\" Condutivimerer Temp Correction On\n\nComm1 DaComrn2\nComrn3 Date\n\nTime\n~ Cornm4\n\n\n\nTitulo na barra\nFile\n\nSave Calibration\nPrint\n\npH\nturbidimeter\n\nManual Acquisition\nAutomatic Acquisition\nSet Acquisition Step\n\nComm Port\npH Temp. Corr.\n(on/off)\nCondutiv. Temp.\nCorr. (on/off)\n\nAbre urn novo arquivo para a grava~ao\ndos dados recebidos da sonda\nAbre urn arquivo de uma calibra~ao ja\nfeita\nSalva a calibra~ao atual\nChama a janela de visualizac;:ao dos\ndados, na qual se encontra 0 comando\n\n. ..\npara lmpnmlr\nSalva a configura~ao atual e sai do\nprograma\n\nChama a janela de calibra~ao do pH\nChama a janela de calibra~ao do\nturbidimetro\nChama a janela de calibra~ao do\nmedidor de oxigenio dissolvido\n\nChama a janela que mostra 0 arquivo\nde dados atual ou gravado\n\nSeleciona aquisi~ao manual\nSeleciona aquisir;:ao automatica\nChama uma caixa de dialogo na qual 0\nusuario coloca 0 periodo das\naquisi~6es\nSeleciona porta serial (l,2.3 ou 4)\nHabilita ou nao a corre~ao automatica\nde temperatura (nao implementado)\nHabilita ou nao a corre~ao automatica\nde temperatura (nao implementado)\n\nHelp Topics Nao implementado\nAbout Water Analizer Nao implementado\n\n\n\no botao Power serve para ligar e desligar 0 analisador. Existe uma variavel\n\nPowerOn que tern 0 seu valor booleano (true/false) trocado a cada vez que 0 botao e\n\npressionado. Alem disso, a sub-rotina verifica 0 valor de PowerOn; se for True a\n\nrotina principal (r6tulo Main Routine) e chamada. A rotina principal fica ativa\n\nenquanto Power On =True.\n\nEsse botao somente e mostrado quando a gravayao dos dados e manual -\n\nMenu Options Manual Acquisition. A cada vez que e pressionado 0 conjunto de\n\nmedidas atual (no momenta do pressionamento) e gravado no disco. Alem dos dados\n\nenviados pela sonda SaDinseridas, tambem, a data e a hora.\n\no botao de Reset tern a funyao de zerar 0 contador que armazena 0 valor da\n\nprofundidade. Esse contador nao e implementado no PC mas sim no\n\nmicrocontrolador. Desta manelra, e necessario enVIar urn comando ao\n\nmicrocontrolador PIC16C84 para que 0 mesmo possa realizar 0 zeramento do\n\ncontador. A cada vez que 0 botao de Reset e acionado, urn byte (A7h) e enviado ao\n\n\n\n2)imprime na tela mensagens acerca do andamento do\nprocessamento;\n\n3)indica, atraves de retulos, 0 tipo de calibrac;;ao usada nos\nmedidores de pH e oxigemio dissolvido (\"Uncalibrated\", \"Calibrated\nby 1pt\" e \"Calibrated by 2pt\")';\n\n4 )inicializa a porta serial escolhida com os parametros: 2400\nbauds, sem paridade, palavra de 8 bits e 1 stop bit;\n\n5)implementa um objeto visual (imitando um led quadrado), 0\nqual plsca enquanto ha transferencia de dados na porta serial. Se\npor algum motivo ocorrer interrupc;;ao na comunicac;;ao 0 objeto\npara de piscar;\n\n6)testa se 0 botao de Reset do contador da profundidade foi\npressionado; se foi envia 0 byte A7h para 0 microcontrolador;\n\n7)envia 0 byte OAh requisitando ao microcontrolador um grupo\nde medidas;\n\n9)aguarda a chegada de 20bytes, correspondente ao grupo de\nmedidas;\n\n10)se apes 0 envio do byte OAh 0 grupo de medidas nElO\nchegar dentro de 1 seg, a func;;ao Watch Dog Timer implementada\nem Visual Basic e acionada. Esta func;;ao e explicada adiante em\ndetalhes;\n\n11japes a chegada dos 20 bytes 0 buffer da serial e lido e, ao\nmesmo tempo, esvaziado;\n\n13)os 20 bytes sao, entao, separados a fim de extrair a\ninformac;;ao neles contida. 0 valor das medidas, 0 qual e enviado\npor 2 bytes, e concatenado numa unica palavra e convertido para\numa escala de 0 a 100%. Assim, as rotinas sUbsequentes tratam\ncom valores padronizados;\n\n14)a fim de obter uma leitura mais confiavel os valores\nmostrados na tela e/ou arquivados em disco sac decorrentes da\nmedia de 4 valores medidos\n\n\n\n15)alem dos valores medidos sac retirados do grupo de 20\nbytes as informac;:oes da profundidade e das escalas do\nturbidfmetro e do condutivfmetro;\n\n16)mostra 0 valor da temperatura num r6tulo e num painel\nanal6gico (Gauge);\n\n17)mostra 0 valor do pH num r6tulo e num painel anal6gico\n(Gauge). Para cada tipo de calibrac;:ao existe um conjunto de\nexpressoes que 0 programa seleciona com base em variaveis\nglobais atualizadas pelas rotinas de calibrac;:ao;\n\n18)mostra a porcentagem de oxigenio dissolvido num r6tulo e\nnum painel anal6gico (Gauge);\n\n19)mostra 0 valor da turbidez num r6tulo e em um painel\nanal6gico (Gauge). Como a turbidez e medida em duas escalas 0\nprograma seleciona 0 fator de escala e escolhe tanto a unidade\nque aparece no r6tulo como 0 fundo do painel anal6gico;\n\n20)mostra 0 valor da condutividade num r6tulo e num painel\nanal6gico (Gauge) A condutividade e medida em tres escalas\nAssim, 0 programa determina a unidade a ser mostrada no r6tulo e\nno painel anal6gico;\n\n23)se a opc;:aode aquisic;:ao automatica e selecionada, entao a\nrotina que grava 0 grupo de medidas e acionada;\n\n24 )volta para 0 item 2) enquanto 0 botao Power nao for\npressionado novamente:\n\n26)implementa as rotinas de tratamento de erro. mostrando\ncaixas de mensagens indicando 0 erro ocorrido. Foram previstas 3\npossibilidades:\n\n-\"Device unavailable\", erro normalmente causado par\nproblemas na comunicac;:ao serial;\n\n-\"Overflow\", erro causado por calibrac;:ao mal feita:\n-\"Division by zero\", erro causado, tambem, par calibrac;:ao mal\n\nfeita;\n\n\n\n2)Estabelece 2s. como periodo de gravar;:ao dos dados\nadquiridos, caso a opr;:ao Aquisir;:ao Automatica seja selecionada;\n\n4)Se 0 arquivo de gravar;:ao dos dados nao tem nome, 0 nome\nNONAME.OAT e atribufdo, eo mesmo e mostrado na tela;\n\n5)Prepara 0 arquivo de gravar;:ao dos dados, escrevendo 0 seu\ncaber;:alho;\n\n6)Le 0 arquivo de configurar;:ao (CFG.OAT) e inicializa as\nvariaveis com base nas informar;:oes gravadas;\n\n7)Le 0 arquivo de calibrar;:ao (NOME.OAT) e inicializa as\nvariaveis com base nas informar;:oes gravadas;\n\n8)Mostra na tela 0 tipo de calibrar;:ao utilizada nos medidores de\npH e oxigenio dissolvido;\n\n9)lmplementa as rotinas de tratamento de erro, que neste caso\nreferem-se a erros na abertura de arquivos. Uma caixa de\nmensagem e mostrada indicando 0 erro e a possivei solur;:ao;\n\n1)Aumenta um contador, 0 qual e mostrado na tela para\ninformar ao usuario quantos grupos de dados ja foram gravados;\n\n\n\n2)Concatena numa string todas as variaveis que serao\ngravadas;\n\n3)Grava essa string no arquivo NOMEDAT, incluindo-a junto\naos dados ja gravados;\n\n4)lnclui a string na variavel usada pela janela (form) que mostra\nos dados gravados em disco;\n\n1)0 objeto visual (imitando um led quadrado) tem a sua cor\ntrocada de verde piscante para vermelha continua. Esse estado\nperdura ate que a comunicar;ao seja recuperada;\n\n\n\n2)duas mensagens sac mostradas de maneira alternada em\nsubstitui9aO da mensagem \"receiving data ... \": \"Communication\nerror.\" e \"Trying to recover. .. \";\n\n4)esvazia 0 buffer da serial. Isto e necessario pois 0 buffer\npode conter alguns dados colocados em ordem errada devido ao\ndefeito na comunica9ao;\n\n5)requisita a sonda, enviando 0 byte OAh, um novo grupo de\nmedidas;\n\n6)implementa as rotinas de tratamento de erro. Estas sac as\nmesmas da rotina principal, ja descritas;\n\n\n\n:iIeName: c:\\virt-wa\\cal1.cal\nitic- c;l~al __ ~\u00b7 r.U'IDT h'A,aloalAUC ..1_.\n\nIOepth:O\n\nFile Names:\nIdata2.dat\n\ncfg.dat\ndatal.dat\nnoname.dat\n\nOk .. ]\n\nCancel J\n\nL 7ift04de~\n\n3)verifica qual 0 comando que chamou a janela de files e, de\nacordo com a origem, chama a sub-rotina adequada;\n\n4)implementa as rotinas de tratamento de erro. Sao 5\npossibilidades de erro, todas relacionadas com 0 acesso ao disco:\n\n4.1) \"File not found\";\n4.2) \"I/O error\";\n4.3) \"Disk not ready\";\n4.4) \"Path not found\";\n4.5) \"Bad file name\";\n\nAo ocorrer 0 erro uma caixa de mensagem e mostrada na tela\nindicando 0 erro ocorrido;\n\n\n\n1)verifica se a usuario digitou a nome do arquivo com a\nextensao apropriada (.dat). Se a usuario nao colocou, a sub-rotina\na insere automaticamente;\n\n3)abre um arquivo com a nome especificado e escreve a\ncabec;alho no mesmo;\n\n1)Abre a arquivo, atribuindo as dados contidos no mesmo a\numa variavel tipo string;\n\n\n\n2)a string elida caractere a caractere. A separac;:ao dos dados\ne feita atraves de espac;:os, e 0 final de arquivo e marcado com a\npalavra EOF. Um vetor e criado, sendo cada elemento um dado;\n\n3)os elementos do vetor sac atribufdos as variaveis envolvidas\nna calibrac;:ao;\n\n1)verifica se 0 usuano digitou 0 nome com a extensao\napropriada (.cal). Se nao digitou, a extensao e inserida\nautomaticamente;\n\n2)concatena em uma variavel tipo string as variaveis envolvidas\nna calibrac;:ao, separando-as por espac;:os e marcando 0 fim de\narquivo com a palavra EOF;\n\n\n\n;e\n[nt TemplC) pH 02(%) TuINTU) CdlluS) Prof(m) Hora Dala\niOI 25.4 8.25 8.06 14.4 313.8 0 14:59:38 01-14-1997 =1:q, 25.4 8.25 8.06 14.4 313.8 0 14:59:38 01-14-1997\n0 25.4 8.25 8.06 14.4 313.8 0 14:59:38 01-14-1997\n\nld, 25.4 8.25\n8.06 14.4 313.7 0 14:59:38 01-14-1997\n\n25.4 8.25 8.06 14.4 313.7 0 14:59:38 01-14-1997\n\n\u2022 25.4 8.25 8.06 14.4 313.9 0 14:59:39 01-14-1997-_. 25.4 8.25 8.06 14.4 313.9 0 14:59:39 01-14-1997..-\n25.4 8.25 8.06 14.4 313.9 0 14:59:39 01-14-1997\n25.4 8.25 8.06 14.6 3137 0 14:59:39 01-14-1997\n25.4 8.25 8.06 14.6 313.7 0 14:59:39 01-14-1997\n\n;:: 25.4 8.25 8.06 14.6 313.7 0 14:59:39 01-14\u00b71997\n25.4 8.25 8.06 14.5 313.8 0 14:59:40 01-14-1997\n\nr\n25.4 8.25 8.06 14.5 313.8 0 14:59:40 01-14\u00b71997\n25.4 8.25 8.06 14.5 313.8 0 14:59:40 01-14-1997\n25.3 8.25 8.06 14.6 313.7 0 14:59:40 01-14-1997\n25.3 8.25 8.06 14.6 313.7 0 14:59:40 01-14-1997\n25.3 8.25 8.06 14.6 313.7 0 14:59:40 01-14-1997\n25.4 8.25 8.06 14.6 313.8 0 14:59:41 01-14-1997\n25.4 8.25 8.06 14.6 313.8 0 14:59:41 01-14-1997 .:J\n\n)tE\n\n<;> Current data\n'load~FIIet I'-'-\"~'-'~\"--\"1\n\n~\n\nPrint .... ,\nt' File data\n\nL....~~: ...::.i __ .i.\n\n---- -\n\nFigura 41 .. Janela para visualizayao dos dados enviados pela sonda.\n\n\n\npH Calibr alion a\n\nBuffer 1 1708 I\n\n~f 12504C 1\nJ\n\n'Cancel j\n\nh::\u00b7..\u00b7B\u00b7.\u00b7.\u00b7.\u00b7.\u00b7u\u00b7.-\u2022.. ~~f\u00b7.\u00b7~\u00b7~I\u00b7.\u00b7.\u00b7.\u00b7.~~\u00b7.\u00b7\u00b7.\u00b7.\u00b7.?.:. .... 1J. 1 c= n.) 1 ~U!ferx~ J\n\n1)Verifica se 0 analisador esta ligado. Se nao estiver uma\ncaixa de mensagem e mostrada na tela instruindo 0 usuario a ligar\no analisador;\n\n\n\n2)Verifica qual foi 0 buffer selecionado, testando 0 r6tulo que\nindica 0 buffer selecionado. Se foi 0 buffer1, e habilitado 0 timer1.\nSe foi 0 buffer2, e habilitado 0 timer2;\n\n2)Cancela 0 buffer selecionado, atualizando a variavel global\nque indica se um determinado buffer foi ou nao utilizado;\n\n3)Envia mensagem a tela dizendo que a calibrac;:ao do buffer\nem questao foi cancelada;\n\n4)Atualiza a informac;:ao de status que indica 0 tipo de\ncalibrac;:ao utilizado (\"uncal\", \"1 pt\" ou \"2pt\");\n\n1)Cria-se uma variavel local a sub-rotina que guarda 0 valor do\npH num determinado instante (pH local);\n\n2)Calcula-se a diferenc;:a entre 0 valor do pH local e 0 ph atual -\naquele que esta vindo constantemente da sonda;\n\n3)Cada vez que a diferenc;:a e menor que 0.02 um contador e\naumentado;\n\n\n\n4)0 indicador de pregresso e alimentado com 0 valor do\ncontador;\n\n5)Quando 0 contador chega a 10, 0 processo de calibrac;ao e\nparalisado, pois significa que a medida esta estavel e, portanto,\nvalida para ser armazenada;\n\n6)A variavel global, que indica se um buffer foi utilizado ou nao,\ne atualizada;\n\n7)0 valor do buffer, a temperatura do mesmo e 0 valor do pH\nlido sac associados as variaveis (globais) que armazenam os\nparametres da calibrac;ao;\n\n\n\n1udiu 0-\n\nft<mto. a\n\nde!t\n\n~\n\n~a\n\n~tU1t4\n\nda~\n\n~\n\n'Pe:tfflite M\n\n~\n\n~ C()ffl\n\nO-~da\nattit\u00abde f/\n~\n\n-- 00 Calibration !IS \u00a31\n\n____Tref 125_4\n\nAltitude 1850\n\n~elect 0% or 100% and press \u00b7\u00b7Start\" ... - -\n\nII 0% 100%\n\n-i\n\neancel J\n\n0% j Close 1,100% J\n\n/\ns~o- /\nft<mto. a de!t\n\n~\n\n\n\nVirtual Water Analyzer\nr-d \u2122\n\n\" \"'\" {~'\\,,- .~ V . \u2022~~ ~.,U\n\n\n\n5. Transmissao dos Dados via Radiofreqiiencia\n\nAo longo do projeto da sonda, cogitou-se a possibilidade de realizar a\n\ntransmissao dos dados sem fazer uso de cabos eletricos. Uma alternativa e a\n\ntransmissao via radiofrequencia com a sonda sendo alimentada par bateria.\n\nPar questoes de limita9ao de tempo e conhecimento. e dada a abardagem\n\nquase que total mente experimental, os dispositivos de transmissao e recep9ao nao\n\nfaram agregados formalmente ao projeto da sonda. No entanto, fez-se a inclusao\n\ndeste capitulo uma vez que urn transmissor e um receptor de dados foram\n\ndesenvolvidos e testados, contudo separadamente da sonda.\n\nA propaga9ao de ondas eletromagneticas na agua[30] encontra muitas\n\ndificuldades devido aos altos valares de condutividade e de constante dieletrica da\n\nmesma. A sonda multissensora e sustentada par um cabo metalico, 0 qual vai da\n\nsonda ate a superficie externa da agua . Valendo-se de sse fato. a ideia do sistema\n\n\n\n)4 Portadora e urn sinal de alta freqliencia 0 qual tern urn parametro (freqliencia, amplitude ou fase)\nvariado segundo urn outro sinal de menor freqliencia. 0 sinal de menor freqliencia (sinal modulante)\npode ser recuperado mediante it detec~ao do parametro variado.\n\n\n\nC2\n10n\n\nT RlXl 1M\n3.57MHzD.I\n\nCl\n0.1U'I\n\nt1~'\"\"\n8lK\n\ni3cC3-.L9P\nC4\n\n~P\n\nC7\nI10n\n\n\n\nI\nI\n\n1 0 1 1 0 0 1 0 1\n\n~\n\n\n\n\u2022 l<et.,.\"ciO VonCMll em runcoo do ,..ewoel do I-'ortodoro.\"DA 1ge1<\n\ni C7 ----l.....\n\nI\"'I\nI -\n\ni~\\,-\n\\\n\nDetector\nde env.\n\nC6\n\nT'<f\n\n+: U1:A~~FF~'\"R16 _'I\n1~\n\nH.\"\n'\"\n\nC2\n22r.F\n\nI\n\nC15\n21uf D6\n\n\u2022 ( , I~ ,\n\nD\n-7 * ---22uF\nl LC16\n\n\n\no comparador converte 0 sinal de pequena intensidade da saida do detector de\n\nenvolt6ria para os niveis compativeis com a interface RS232. 0 mesmo ocorre com 0\n\namplificador de audio, caso 0 modo audio seja utilizado.\n\nA interface RS232 exige sinais positivos e negativos na faixa de -12 a + 12V,\n\nsendo que a mesma funciona tambem na faixa de -5 a +5V. A fim de permitir que 0\n\ncircuito funcione a partir de uma unica bateria, incluiu-se urn circuito gerador de\n\ntensao negativa, como mostrado na figura 47.\n\nPor motivos de viabilidade pr:itica 0 teste do sistema foi dividido em duas\n\npartes: teste de transmissao de urn tom de audio com 0 transmissor submerso e teste\n\nde transmissao de dados (de urn PC para outro PC) fora d' agua.\n\no primeiro teste foi realizado a uma profundidade de 3 metros em agua doce\n\ncom 0 transmissor alimentado por urn bateria de 9V e urn sinal de audio de onda\n\nquadrada na frequencia de 1KHz. Com 0 receptor alimentado tambcSm por uma\n\nbateria de 9V foi possivel a detec((ao do sinal de 1KHz. Como cabo de sustenta((ao.\n\nutilizou-se urn cabo elcStricoflexivel de bitola 1.5mm2\u2022\n\no segundo teste foi realizado entre dois micros do tipo IBM/PC localizados\n\nem salas diferentes distanciados de aproximadamente 6 metros. 0 transmissor foi\n\nalimentado com urn bateria de 9V e sua entrada de dados foi conectada it saida da\n\nporta serial RS232 de urn dos PC's. 0 receptor foi alimentado tambcSm por uma\n\nbateria de 9V e sua saida de dados foi conectada it entrada da porta serial RS232 do\n\noutro Pc. A saida do transmissor conectou-se urn cabo flexivel, 0 qual foi estendido\n\n\n\nate ficar proximo do receptor, sem conexao eletrica. Com dois softwares bastante\n\nsimples escritos em Visual Basic, urn para transmissao e outro para recepyao, fez-se a\n\ntransmissao, de caracter a caracter, de urn micro para outro. de urn texto de\n\naproximadamente 10000 caracteres em diversas taxas de transmissao (de 1200 a\n\no desempenho do sistema foi extremamente satisfatorio. Para uma utilizayao\n\nreal sera necessario implementar urn algoritmo de detecyao de erros e fazer a\n\ntransmissao dos dados em grupos de bytes.\n\n\n\n6. Conclusao\n\n6.1 Introdm;ao\n\no presente trabalho teve como objetivo 0 desenvolvimento de urn\n\ninstrumento microprocessado para a medida de parametros fisicos c quimicos da\n\nagua. 0 projeto envolveu 0 uso de componentes recentes e tecnicas modemas de\n\nprogramac;ao. 0 microcontrolador PIC 16C84 e 0 conversor AID MAX 187\n\npermitiram a confecc;ao de uma placa de circuito impressa bastante compacta, pois\n\npossuem urn numero reduzido de pinos e requerem poucos componentes extemos. Ja\n\na programac;ao em Visual Basic mostrou-se plenamente adequada ao\n\ndesenvolvimento do sistema, uma vez que nao exige muito conhecimento do\n\nprogramador e produz programas de alta qualidade e de facil expansao.\n\no circuito da sonda juntamente com 0 programa em Visual Basic\n\napresentaram urn desempenho bastante satisfat6rio. A operac;ao e a visualizac;ao dos\n\ninstrumentos virtuais ficaram bem facilitadas devido aos recursos graficos\n\ndisponiveis.\n\nInfelizmente, por falta de recursos a montagem completa da sonda nao foi\n\npossive!, uma vez que a mesma implicaria em gastos com oficina mecanica e compra\n\nde sensores especificos como 0 de pH e 0 de oxigenio dissolvido. Na avaliac;ao dos\n\ncircuitos utilizaram-se sensores de laborat6rio.\n\n\n\n6.2 Otimiza~ao do Projeto\n\n6.2.1 Medidor de Profundidade\n\no medidor de profundidade sugerido no projeto apresenta urn desempenho\n\nsatisfatorio, podendo ser implementado sem nenhum problema. No entanto, 0\n\nmetodo proposto traz alguns inconvenientes de ordem pnitica na manipulac;ao da\n\nsonda:\n\n\u2022 0 cabo de sustentac;ao da sonda po de nao descer perpendicularmente a\n\nsuperficie da agua, como no caso de urn rio com correnteza. Neste caso, 0\n\nmedidor indicaria uma profundidade maior que a real;\n\n\u2022 0 medidor deve ser zerado na superficie da agua, ja que 0 mesmo mede 0\n\ncomprimento relativo de cabo que passa pela polia;\n\n\u2022 E necessario haver, na superficie da agua, urn aparato medinico e\n\neletronico a fim de implementar 0 medidor.\n\nUma altemativa para a medic;ao de profundidade e a medida indireta, atraves\n\nde urn sensor de pressao. Esse sensor seria alojado junto aos outros instrumentos e\n\nseu sinal seria enviado, tambem, junto com os sinais dos outros instrumentos. A\n\npressao e proporcional a profundidade e a densidade do liquido. Assim, conhecendo-\n\nse a pressao e a densidade, pode-se calcular a profundidade. 0 problema da diferenc;a\n\nde densidade de uma agua para outra pode ser resolvido considerando-se 0 valor da\n\ncondutividade, pois a quantidade de sais na agua influencia diretamente esse ultimo\n\npanlmetro. 0 sensor de pressao nao foi implementado devido a falta de recursos para\n\na compra do mesmo.\n\n\n\n6.2.2 Fonte de alimenta~ao\n\nAs fontes de alimentayao isoladas galvanicamente sao de fundamental\n\nimportancia para evitar layos de terra entre os instrumentos. 0 sistema de fonte\n\nsugerido funcionou de maneira razoavel. Contudo, restaram, ainda, algumas\n\npequenas interferencias devido ao transformador. A construyao desse componente e\n\ncritica e nao houve tempo suficiente para urn desenvolvimento mais criterioso do\n\no sistema proposto preve 0 uso de urn lap-top como unidade de visualizayao\n\ne armazenamento de dados. No entanto, 0 uso de urn lap-top em campo pode trazer\n\nproblemas, pois esses equipamentos sao, ainda, pouco robustos. Uma soluyao para\n\nesse problema seria a construyao de urn microcomputador dedicado, baseadoem urn\n\nmicrocontrolador PICou INTEL 8031, que faria a comunicayao com a sonda,\n\nmostraria os dados de forma resumida num display de cristal liquido e armazenaria\n\nos dados numa memoria nao volcitil. Posteriormente, essa unidade microprocessada\n\nseria conectada a urn PC, via porta serial RS232, transferindo os dados para analise.\n\n\n\nTanto 0 sistema com lap-top como 0 sistema com data logger podem ser\n\nevoluidos para urn sistema automatico de medidas, 0 qual nao necessita de urn\n\noperador. 0 cabo da sonda seria acoplado a uma polia motorizada, a qual faria os\n\nmovimentos de descida e subida da sonda. Assim, de pedodo a pedodo 0 lap-top ou\n\no data logger seria retirado e seus dados transferidos para urn pc.\n\nUnindo a ideia do sistema automatico de medidas com a ideia de transmissao\n\ndos dados via radiofreqiiencia, urn sistema de telemetria poderia ser feito com poucas\n\nmodificac;:oes no projeto original. 0 sistema de polia motorizada ficaria em uma b6ia,\n\nna superficie da agua, juntamente com 0 transmissor/receptor e a antena. 0\n\nmicrocomputador PC situado a distancia receberia os dados enviados pela sonda.\n\nPara isso ser possivel seria necessario apenas aumentar a freqiiencia do\n\ntransmissor/receptor sugeridos no capitulo 5, de modo a obter urn tamanho de antena\n\nmais adequado.\n\no Visual Basic oferece recursos de comunicac;:ao via rede de computadores\n\nbastante simples de serem implementados. Com poucas modificac;:oes no programa e\n\npossivel estabelecer uma comunicac;:ao atraves da rede mundial Internet entre\n\ncomputadores conectados a mesma. Assim, pode-se receber instantaneamente os\n\ndados da sonda, mesmo que esta esteja a milhares de quilometros de distancia.\n\n\n\nBibliografia\n\n[1] OEHME, F. - Liquid Electrolyte Sensors: Potenciometry, Amperometry, and\n\nConductometry. IN: GOPEL, W.; HESSE, l; ZEMELlN., Sensors: A\n\ncomprehensive survey. New York, VCH, 1991. V.2 p.3l4 -339\n\n[2] COVINGTON, A. K. - Introduction: Basic Electrode Types, Classification, and\n\nSelectivity Considerations. IN: COVINGTON, A. K .. Ion Selective Electrode\n\nMethodology. Florida, CRC Press, 1979. VI p.1 - 18\n\n[3] MILLMAN, J.; HALKIAS, C. C. - Eletronica: Dispositivos e Circuitos. Sao\n\nPaulo, McGraw Hill do Brasil, 1981. V2 p.635 - 639\n\n[4] MILLMAN, J.; HALKIAS, C. C. - Eletronica: Dispositivos e Circuitos. Sao\n\nPaulo, McGraw Hill do Brasil, 1981. V2 p.561 - 593\n\n[5] COLE-PARMER INSTRUMENT COMPANY - Catalogo 1989-1990 - USA\n\n[6] OEHME, F. - Liquid Electrolyte Sensors: Potenciometry, Amperometry, and\n\nConductometry. IN: Gapel, W.; Hesse, 1.; Zemel,lN., Sensors: A comprehensive\n\nsurvey. New York. VCH, 1991. V.2 p.24l- 268\n\n[7J WESTCOTT, c.c. - Principles of pH Measurements. IN: Westcott, C.c. - pH\n\nMeasurements. New York, Academic Press, 1978. p.1-16\n\n[8] WESTCOTT, c.c. - Electrodes. IN: Westcott, c.c. - pH Measurements. New\n\nYork, Academic Press, 1978. p.41-78\n\n[9] WESTCOTT, C.c. - The pH Meter. IN: Westcott. c.c. - pH Measurements.\n\nNew York, Academic Press, 1978. p.17-39\n\n\n\n[10] U.S. ENVIRONMENTAL PROTECTION AGENCY - Manual for Methods\n\nfor Chemical Analysis of Water and Wates - Washington DC 1974. p.29S-298\n\n[11] NATIONAL SEMICONDUCTOR DATA BOOK - Data Acquisition Linear\n\nDevices - 1989. P.6-12 a 6-17\n\n[12] LEE, YOUNG H.; TSAO, GEORGE T. - Dissolved Oxygen Electrodes\n\n[13] KORYTA, JIRl. - Ions, electrodes and membranes. - Membranes. New York,\n\nJohn Wiley &amp; Sons, 1982. p.12S-lS0\n\n[14] ATKINS, P. W. - General Chemistry. - Redox Reactions. New York, Scientific\n\nAmerican Books, 1989. p. 96-109\n\n[15] ATKINS, P. W. - General Chemistry. - The Properties of Solutions. New York,\n\nScientific American Books, 1989. p. 400-420\n\n[16] MANUAL DE INSTRUc;OES - FAC 204A O2 Analyzer. Industria FAC\n\nLTDA. Sao Carlos\n\n[17] HUTCHINSON - A Treatise on Limnology - Oxygen in Lake Waters. New\n\nYork, John Wiley &amp; Sons, 1957. p. 580\n\n[18] HUTCHINSON - A Treatise on Limnology - The Properties of Water. New\n\nYork, John Wiley &amp; Sons. 1957. p. 206 a 208\n\n[19] AN ENGINEERING HANDBOOK - DC Motors Speed Controls Servo\n\nSystems. Electro-Craft Corporation. Hopkins, 1980. p. 7-1 a 7-18\n\n[20] MILLMAN, J.; HALKIAS, C. C. - Eletronica: Dispositivos c Circuitos.\n\nCaracteristicas de urn Diodo de Jun9aO. Sao Paulo, McGraw Hill do Brasil. 1981. VI\n\n\n\n[21] MILLMAN, J.; HALKIAS, C. C. - Eletronica: Dispositivos e Circuitos. -\n\nCaracteristicas do Transistor. Sao Paulo, McGraw Hill do Brasil, 1981. VI p.144 -\n\n145\n\n[22] GAYAKWAD, R.; SOKOLOFF, L. - Analog and Digital Control Sytems -\n\nControl Systems Components. New Jersey, Prentice-Hall. Inc., 1988. p. 83 a 87.\n\n[23] RS232 Interfacing: Manual de Referencia.\n\n[24] MICROCHIP DATA BOOK - Arizona, 1992\n\n[25] MAXIM - New Releases Data Book - Volume IV.\n\nhttp://www.maxim-ic.com - arquivos em formato PDF\n\n[26] INTERSIL DATA BOOK - 1988. p.8-32 a 8-35\n\n[27] TEXAS INSTRUMENT - The TTL Data Book. Dallas, 1973. p.274 a 277.\n\n[28] TAUB, HERBERT - Circuitos Digitais e Processadores - Flip-flops,\n\nRegistradores e Contadores. Sao Paulo, McGraw-HilL 1984. p.150 a 155.\n\n[29] HOLZNER, STEVEN - Visual Basic for Windows - Rio de Janeiro, Campos,\n\n1994.\n\n[30] COLIN, ROBERT E. - Antennas and Radiowave Propagation - Radiowave\n\nPropagation. USA, McGraw-Hill, 1985. p.434 a 444.\n\n[31] The ARRL Handbook for Radio Amateurs - Modulation and Demodulation.\n\nNewington, American Radio Realy League, 1992. p 9-8 a 9-10\n\n[32] BLACK, E. PETER - Watershed Hydrology - Water in the Hydrosphere.\n\nSyracuse, Prentice Hall, 1991. p 233 a 246.\n\nhttp://www.maxim-ic.com\n\n\nApendices\n\no apendice A e composto pelos esquemliticos dos circuitos desenvolvidos.\nEsses esquematicos foram impressos diretamente pelo programa Tango-Schematic 0\nqual possui formato proprio de impressao. Nas paginas seguintes encontram-se os\nesquemas relacionados abaixo:\n\nEsquema 1 - Unidade Central\nEsquema 2 - Fontes de Alimentayao\nEsquema 3 - Condutivimetro\nEsquema 4 - Medidores de Temperatura, Turbidez, pH e Oxigenio Dissolvido\nEsquema 5 - Medidor de Profundidade\nEsquema 6 - Transmissor de Dados e Audio em CW/AM 3.57 MHz\nEsquema 7 - Receptor de Dados e Audio em CW/AM 3.57 MHz\n\n\n\nL it'Jl [ ~,~'(' I 111\" :F,\n,\n\n1 c-,intJ; /\\10~- [11 ['.\n':,1 14\n\n~\n~.;\n\n-V 1 ''vt\n=, ';1,1[1 \\/Pp\n\n---2..L\n\n-LL\n~- [ 54 c 3\n\nr~;i'J [i AI~' - 1(0 elm AID[14 [, ?i\np,\n\nIin\n0\n\nIN4\n\n-:::h-\n- ..--f- S4\n'81 .t,Ie -\n\nU4\n\n--.l2..-\n\n11\n\nu'\nVCC~\"1 S~\n\nL S~~' S3 15\n\n, 14SC\\ C 1\n\n~ 1 ,~i B\n, 17\n\nC\n..--\u00a3..-\n\n-,;,-) D ~\n~ 10 -S6 A\n\n~ eNe' S5 ~-\n,:fl40:?E.B\n\n\" F'L4\n\n+5~ MCl\"'\n\n~VSS\n\nF: Rae II~T\n\nREO'\n,----\u00a3- RC;\n\n11,1, ' :: il f\n\n~FI Il'~\n\nRAI ~\n\nI' AQ --..22.-,\n\nCLeclUT\nI .. t SV\n\nVD[)~\n\n\" ~A 8\nCOt JC'I-.!TI\\il f,.i E1 RO\n\n\n\n\\/1 G VO\n\nW7805CTB\n\n+ 12\\.'\n\n100uH\nL1\n\n+ C' 9\n\nINV +5 REF 15 ..I:our\nNI VCC 15\n\n3 EB 14\n4 CB 13 R30\n\n1 K\n\n5 12 R31GND CA\nI K\n\n6 RT EA 11\n\nCT 10 IKR2j\n2.2nF 8 9COMP\n\n'\" 47KSGj524 \"us\n'\"':Eo 1 uF\n\ni S\\\n\np, (, rneljldc,r de oXlqenlo dlssolvldo\n\n~5129f\n\nMAXS02\n\nDrown bv\nSheet of\n\nD\n\n\n\nR21\n\n~.\n\nC'B\n5f<f\n\n+\n+\n\nAlTA\nl.tEOIA\n\nPEOU[NA.\n\nDate 2S 1296\nfCilenome PICMAXS03\n\n\n\n~C'!i[iAI2\n\n\"Sc R48 82K\nR49 22K\nR50 8K:\n\n::\n\n+7 ~v-'-\"\"\"'----.l\"'.\"\"'---_c>-s'NAl AI4\n\n~ 2ZtI\n\nMedldores de 'J emperaturu, 1UI bide:. pH\ne Oxigen1o Dissolvido\n\n\n\n3 eLF'\nu\n\n4093\nU l1A\n\n0 20\nS[T\n\nU 2f.-..\n\n25 1296\n\nF'ICMA\\ S05\n\n\n\n(, 1(~l~~FI\n\n17089f,\n\nPICMAX 506\n\n\n\n~\n\n\"r~1\nJ3pF\n(I\n\nIh\np,\n\n1708.9(;\n\nPICMAX.s0~\n\nDrown bv\nSheet 7\n\nD\n\n\n\nSTART\n\nORG 0\nGOTO INICIO\n\nORG 4\nGOTO ROTINT\n\nORG 5\nINICIO\n\nMOVLW OXBE\nMOVWF OXBl\n\nMOVViJ OXO\nMOVWF OX2A\nMOVWF OX2B\n\nMOVLW OX90\nMOVWF OXOB\n\nMOVLW OXBS\nTRIS OX6\n\nBCF OX6,3\nBSF OX6,4\n\nBCF OX6,1\n\nBCF OX6,S\n\nMOVViJ OXI\nt-10VWF OX22\n\nBSF OXS,3\n\nMOVLvJ OXIO\nTRIS OXS\n\nCLR~ OXIO\n\nMOVLW OXFF\n\nMOVWF OXS\n\n;Nivel inicial do SCLK\n;Nivel inicial do CS\n\n;Programa condutivimetro com alta\n;sensib\n\n;Registrador que guarda escala do\n;Turbidimetro\n;Programa turbidimetro com alta\n;sensibilidade\n\n;Zera contador do seletor autm.\n;(alta sens.)\n;Desabilita todas as entradas\n;analogicas\n\n\n\ni-------------------------------------------------------------------\niRotina principal: recebe dado serial enviado pelo hOSL.\n\nInicia as S conversoes, transmit indo 3 byLes a cada\nconversao. 2 bytes da palavra de dados de I6bits e\n1 byte de verificacao composto por OU EXCLUSIVO dos\nbyLes de dados.\nOrdem de envio: MSB, LSB e Byte de verificacao.\nOrdem de envio dos dados das entradas analogicas:\nAN4, AN3, AN2, ANI, ANO, Prof\n\niNo final, saG transmitidos dois bytes que contem a escala do\nicondutivimetro e do turbidimetro\n\nMOVWF\nCALL\n\nMOVWF\nMOVF\nANOLI'J\nIORWF\n\n~10VWF\n\nL7 CALL\n\nMOVF\n\nSUBLW\nBTFSC\nCALL\n\nMOVF\nSUBLW\nBTFSC\nGOIO\n\nGOTO\n\nLI\nt-10VF\n\nSUBL;!\nSTFSS\nGOTO\nCALL\n\nGOTO\n\nL4 t-10VF\n\nSUBUJ\nBIFS:\"\nGOTO\nCI.LL\n\nGeT\n\nOXIS\nP ANALG\n\nOX2F\nOXS,O\nOXB\nOX2F,O\n\nOXA7\nOX3,2\nZERAPROF\n\nOX20,O\nOXP.\nOX3,2\n\nO:C\nOX3,2\nL4\nCON OUT\n\nLS\nTURBID\n\nilnicia contador (FISH) das portas\nianalogicas\n\niConverLe contador em bits de 0 a 4 na\niporta A (selecao de entradas analg.;\ni flS=S indica porta 4, flS=4 indica\n;porta 3\n\n;Operacoes de AND e OR para manter\n;0 bit A3 inalterado\n\n;Testa se byte recebido\n;valor aa profundidade\n\n;TesLa se byte recebido = OAh\n;Se for, inicia processo de conversac\n\n;Se byte recebido nao e A7 e neD OA,\n;aguarda nova comunicacac\n\n;Coloca numero da porLa seleclonada\n;para teste\n\n;Verific2 58 por~a anal.\n;selecionada=conduci '.-.(fI5=1\u00b7\n\n;Rotina para escolher a escala\n;adequacia\n\n;Coloca numero da porta seleclonacia\n;para\nites-ce\n;Test2 S::?: p=,r~L2 ~.:~=- (t'Jrt<~_j. ~ I':=J~.\n;selecionada (fIS=2)\n;Rotina para escolner a escala\n;adequad2\n\n\n\nL5 CALL LECONV\n\nL6 DECF OX15,1\nMOVF OX15,O\n\nCALL P ANALG\n\nMOVWF OX2F\ntvlOVF OX5,O\nANDLW OX8\nIORWF OX2F,O\n\nMOVWF OX5\n\nMOVF OX13,O\nMOVWF OX20\nCALL TXPIC\n\nMOVF OX12,O\nMOVWF OX20\nCALL TXPIC\n\nMOVF OX13,O\nXORWF OX12,O\ntvlOVWF OX20\nCALL TXPIC\n\nMOVF OX15,O\nBTFSS OX3,2\nGOTO Ll\n\nMOVF OX2B,O\nMOVWF OX20\nCALL TXPIC\n\nMOVF OX2A,O\nMOVWF OX20\nCALL TXPIC\nMOVF OX2B,O\nXORvJF OX2A,O\nMOVWF OX20\nCALL TXPIC\n\nMOVF OXI0,O\n~10VWF OX20\nCALL TXPIC\n\nMOVF OX22,O\nMOVWF OX20\nCp\"LL TXPIC\n\nGOTO L3\n\n;Decrementa F15 de uma unidade\n;Carrega W corn 0 numero da proxima\nporta analogica\n\n;Converte contador ernbits de 0 a 4 na\n;porta A (selecao de entradas analg.)\n\n;Operacoes de AND e OR para manter\n;0 bit A3 inalterado\n\n;Gera byte de verificacao\n;Byte de verificacao = f13 XOR f12\n\n;Transmi~e by~e MSB do valor da\n;Profundidade\n\n;Transmite byte LSB do valor da\n;Profundidade\n\n;Rotina que converte 0 numero do contador de en~rada analogica e~\n;bits aa por~a p,\nP ANALG\n\nADDWf\nRETLW\n\n2,1\nOX4 ;numero adicional para ajuste do\n\n;contado::\n\n\n\nRETLW\nRETLW\nRETLW\nRETLW\nRETVil\n\nOXO\nOXI\nOX2\nOX3\nOX4\n\niRotina que escolhe a escala adequada para 0 Turbidimetro\nTURBID\nKl CLRWDT ;Reset WatchDogTimer\n\nCALL LECONV\n\nMOVF OX13,O\nSUBLW OXFE\nBTFSC OX3,O\nGOTO K2\n\nBTFSS OX22,O\nGOTO K3\n\nBCF OX22,O\nBCF OX5,3\nGOTO Kl\n\nMOVF OX13,O\nSUBLvl OX86\nBTFSS OX3,O\nGOTO K3\n\nBTFSC OX22,O\nGOTO K3\n\nBSF OX22,O\nBSF OX5,3\nGOTO Kl\n\nRETURN\n\niRotina que escolhe a escala adequada para 0 condu~ivime~rc\nCONDUT\nH2 CALL LECONV iFaz conversao\n\nMOVF\nSIJBLW\nBTFSC\n\nMOVF\nSIJBLW\nBTFSC\n\nINCF\nCALL\n\nMOVF\nSUBLW\nBTFSS\n\nOX13,O\nOXFE\nOX3,O\n\nOXIO,O\nOX2\nOX3,2\n\nOXIO,l\nPROG SEL\n\nOX13,O\nOX82\nOX],\n\niTesta se valor lido>98,4 . Se nao for\nivai para HI\n\niTesta se contador=2 (pequena\nisensibilidade)\n\niPrograma 0 seletor, diminuindo a\nisensib.\n\n\n\nGOTO\nMOVF\nBTFSC\n\nGOTO\n\nDECF\n\nCALL\n\nGOTO\n\nH3 RETURN\n\n;Ratina para\nPROG SEL\n\nMOVF\nBTFSS\nGOTO\nBCF\nBCF\nGOTO\n\nH3\nOXI0,1\nOX3,2 ;Testa se cantadar=O (alta\n\n;sensibilidade)\n\n;Pragrama a seletar, aumentanda a\n;sensib.\n\nMOVF\nSUBLW\nBTFSS\nGOTO\nBCF\nBSF\nGOTO\n\nMOVF\nSUBLW\nBTFSS\nGOTO\nBSF\nBCF\n\nMOVLW\nMOVWF\nCALL\nCALL\nCALL\nCALL\n\nDECFSZ\nGOTO\n\nOXI0,1\nOX3,2\nJl\nOX6,1\nOX6,5\nJ3\n\nOXI0,0\nOXI\nOX3,2\nJ2\nOX6,1\nOX6,5\nJ3\n\nOXI0,0\nOX2\nOX3,2\nJ3\nOX6,1\nOX6,5\n\nOXFF\nOX23\nDELAY2\nDELAY2\nDELAY2\nDELAY2\n\nOX23,1\nJ4\n\n;Recebe byte serial, par RB7 a 2400 baud, e a armazena em F20h\nRXPIC\nCl CLRWDT ;Zera WatchDagTimer\n\nBTFSC\nGOTO\n\nOX6,7\nCl\n\n\n\nCALL DELAY2 ;Insere delay de 416us\nCALL DELAYl ;Insere \"1/2\" delay de 208us\n\nMOVLW OX8 ;Carrega contador (fl4H)\nMOVWF OX14\n\nC7 BTFSS OX6,7 ;Le bit em RB7\nGOTO C4\nBSF OX3,0 ;Coloca \"1\" no Carry\nGOTO C5\n\nC4 BCF OX3,O ;Coloca \"0\" no Carry\n\nC5 RRF OX20 ;Posiciona bit lido\n\nCALL DELAY2 ;Insere delay de 416us\n\nDECFSZ OXI4,1 ;Testa fim da contagem (1-8)\nGOTO C7\n\nC8 BTFSS OX6,7 ;Confirma \"Stop Bit\"\nGOTO C8\n\nRETURN\n\n;Le byte em F20h e envia, serialmente, por RB6 a 2400 baud\nTXPIC\n\nBCF OX6,6 ;Envia \"Start Bit\"\nCALL DELAY2 ;Insere delay de 416us\n\nMOVLW OX8 ;Carrega contador (f14H)\nMOVWF OX14\n\nB5 RRF OX20 ;Posiciona, no Carry, 0 bit\n;a ser lido\n\nBTFSS OX3,0 ;Le bit a-craves do Carry\nGOTO B2\nBSF OX6,6 ;Envia \"1 \" na saida serial\nGOTO B3\n\nB2 BCF OX6,6 ;Envia \"0\" na saida serial\nB3 CALL DELAY2 ;Insere delay de 416us\n\nDECFSZ OXI4,1 ;Testa fim da contagern (1-8)\nGOTO B5\n\nBSF OX6,6 ;Envia \"Stop Bit\"\nCALL DELAY2 ;Insere delay de 416t.:s\n\nRETURN\n\n;------Rotina para ler dados do conversor MAXI8~--------------------\no conversor MF~187 trabalha com palavras de 16bits\nAs palavras sac recebidas a 2 bytes por palavra\nPalavra de dados: F13h (MSB) E F12h (LSB)\n\nFl3\nFl2\n\nlXXX XXXX\nXXX X xooo\n\nAs palavras sac recebidas serialmente\nDados: (recebida do conversor) porta RB2\n\n\n\nA rotina LECONV coloca os dados lidos do conversor ern F13h e\nF12h\n\nA conversao eh feita assirn que 0 sinal de CS vai para nivel\nbaixo(CS=O)\n\nLECONV\nBCF\n\nCALL\nMOVF\n\nCALL\nMOVF\n\nBSF\nRETURN\n\nRECDADO\nOXOF,O\n\nRECDADO\nOXOF,O\n\n;Recebe 1st byte de dados e guarda ern\n;f13h\n\n;Recebe 2nd byte de dados e guarda ern\n;f12h\n\nRECDADO\nMOVLW\nMOVWF\n\nBTFSS\nBCF\n\nNOP\nNOP\nNOP\nNOP\nNOP\nNOP\n\nDECFSZ\nGOTO\nRETURN\n\nOX8\nOX14\n\nOX6,2\nOXOF,O\n\nOX14,1\nE1\n\n;Rotaciona reg OFh (posiciona bitO pi\n;escrita)\n;Seta bitO=l, se bit em DOUT=O entao 0\n;proximo BFC faz a troca\n;Le dado na porta RB2 (DOUT conversor)\n;Coloca bit lido na posicao bit=O\n;do registrador fOFn\n\n;Acerta 0 \"duty cycleU do clock\n;em aproximadamente 50\n\nDELAY 1\nMOVLW\nMOVWF\n\nGl DECFSZ\nGOTO\nRETURN\n\nOX44\nOX2l\nOX21,1\nGl\n\n\n\nDELAY2\nMOVLW\nMOVWF\n\nG2 DECFSZ\nGOTO\nRETURN\n\nOX88\nOX21\nOX21,1\nG2\n\nDELAY3\nIvJOVLW\nMOVWF\n\nG3 DECFSZ\nGOTO\nRETURN\n\nOXOF\nOX21\nOX21,1\nGl\n\nROTINT\nCLRWDT\nMOVLW\nMOVWF\n\nGOTO\nINCF\nBTFSC\nINCF\nRETFIE\n\nDECREM\nMOVF\nBTFSC\nDECr\nDECr\n\nOXI0\nOXOB\n\nDECREM\nOX2A\nOX3,2\nOX2B\n\nOX2A,1\nOX3,2\nOX2B\nOX2A\n\n;Zera valor da profundidade\nZERAPROF\n\nMOVLloi\nMOVWr\nMOVWF\nRETURN\n\nOXO\nOX2.n.\nOX2B\n\n;Zera WatchDogTirne~\n;Reabilita interrupcao\n\n;Testa se deve incrernentar ou\n;decrernentar\n\n;Incrernenta LSB\n;Testa se LSB=O (overflow)\n;Incrernenta MSB (vai urn)\n\n;Testa se LSB ja eh zero\n;Se for decrernenta MSB e LSB\n;Se nao, decrernenta apenas LSB\n\n\n\n\n\nSTU: String que contem 0 valor instantaneo da turbidez\n\nSCOND: String que contem 0 valor instantaneo da condutividade\n\nSOX: String que contem 0 valor instantiineo da % de 02 dissolvido\n\nSPROF: String que contem 0 valor instantiineo da profundidade\n\nSTIME: String que contem 0 valor instantiineo da hora\n\nSDATE: String que contem 0 valor instantaneo da data\n\nTEMP: Valor instantiineo da temperatura\n\nPH: Valor instantiineo do pH\n\nTV: Valor instantiineo da turbidez\n\nCOND: Valor instantiineo da condutividade\n\nOX: Valor instantiineo da porcentagem de oxigenio dissolvido\n\nPROF: Valor instantiineo da profundidade\n\nAC_Num: lnteiro LONG que totaliza 0 numero de aquisi~oes gravadas\n\nV(5): Array que guarda os valores de tensao (%) correspondentes a:\n\nV(O)=TEMP\n\nV(l)=PH\n\nV(2)=OX\n\nV(3)=TU\n\nV(4)=COND\n\nPHWINDOW: Guarda 0 estado do foco dajanela de calibra~ao. Variavel\n\nusada para redesenhar a janela quando 0 botao de\n\nD_Reset: Variavel global que e igualada a urn a cada vez que se deseja zerar\no contador de profundidade.\n\nDAF _NAME.DAT: Contem os dados da aquisi~ao no seguinte formato abaixo.\n\nOs dados sao colocados em linha separados por espa~os. A primeira\n\nlinha contem 0 titulo de cada coluna.\n\nCALF _NAME.CAL: Contem os dados da calibra~ao. Cada linha possui os pariimetros\n\nde urn instrumento separados por espa~os. A seqUencia e pH, Turbidez e 02.\n\nPH_CALIPH_CAL2VPHIPHITPHIVPH2PH2TPH2VTUITUIVTU2\n\nTU2 DO CALO DO CAll 00 VDOO VDOIOO TDOO TDOlOO- -\n\n\n\n00000000\n\n1 0 VPH 1 PH 1 TPH 1 0 0 0\n\no 1 0 0 0 VPH2 PH2 TPH2\n\nSem calibrac;:ao\n\nCalibrac;:ao por 1 ponto\n\nSem calibrac;:ao\n\no 0 VDOO VDO 100 TDOO TDO 100\n1 0 VDOO VDO 100 TDOO TDO 100\n\no 1 VDOO VDO 100 TDOO TDO 100\n1 1 VDOO VDO 100 TDOO TDO 100\n\nSem calibrac;:ao\n\nSem calibrac;:ao\n\nSem calibrac;:ao\n\nCalibrado\n\nCFG.DA T: Contem a ultima configurac;:ao do menu feita pelo uswirio. Cada vez\n\nque 0 program a e carregado a configurac;:ao e restaurada. Os dados saD\ncolocados em uma (mica linha separados por espac;:os.\n\nCALF_NAME: ultimo nome do arquivo de calibrac;:ao usado pelo uswirio\n\nACQUISITION: Manual/Auto\n\nCOMM PORT: 1/2/3/4\n\nPH TEMP CORR: On/Off- -\n\n\n\nSub New_DA_Click 0\nFiles.Ext.Text = \"'.dat\"\nFiles.File1.Pattern = Files.Ext.Text\nFiles.Caption = \"New Acquisition Data File\"\nFiles.Show\n\nEnd Sub\n\nSub Open_CF _Click 0\nFiles.Ext.Text = \"'.cal\"\nFiles.File1.Pattern = Files.Ext.Text\nFiles.Caption = \"Open Calibration File\"\nFiles.Show\n\nEnd Sub\n\nSub Save_C_Click 0\nFiles.Ext.Text = \"'.cal\"\nFiles.File1.Pattern = Files.Ext.Text\nFiles.Caption = \"Save Calibration File\"\nFiles.Show\n\nEnd Sub\n\nSub Print_Click 0\nData_A_Click\n\nEnd Sub\n\nSub Exit_Click 0\nPowerOn = False\n\n'Grava a configurayElo atual do programa\n'Inicia a concatenayElo da vari,'lVel Config\n\nConfig = CALF_Name &amp; Space(1) 'Grava 0 arquivo de calibrayElo\nConfig = Config &amp; ACQUISITION &amp; Space(1) 'Grava 0 modo de aquisiyElo\nConfig = Config &amp; COMM_PORT &amp; Space(1) 'Grava a numero da porta serial\nConfig = Config &amp; PH_TEMP _CORR &amp; Space(1) &amp; COND_TEMP _CORR &amp; Space(1) 'Grava 0 modo de\n\ncorreyElo de temperatura (pH e Cond)\nConfig = Config &amp; \"EOF\" &amp; Space(1)\n\n'Atualiza 0 arquivo Config.dat\nOpen CurDir$ &amp; \"\\Cfg.dat\" For Output As #1\n\nPrint #1, Config\nClose\nEnd\n\n\n\nSub pHCAL_Click 0\nPH_CAL_ WINDOW.Show\nPHWINDOW = \"Active\"\n\nEnd Sub\n\nSub Dissolved_O_Click 0\nDO_CAL_WINDOW.Show\nDOWINDOW = \"Active\"\n\nEnd Sub\n\nSub Data_A_Click 0\nDataView.Show\n\nEnd Sub\n\nSub ManuaLA_Click 0\nManual_AChecked = True\nAutomatic_AChecked = False\nACQUISITION = \"Manual\"\nManual_Ac_PaneI.Visible = True\n\nde dados\nManual_Ac_Save.Visible = True\nSamples_Number.Text = \"Manual aquisition\"\n\nEnd Sub\n\n'Seleciona 0 tipo de aquisiyao desejada (auto/manual)\n'Mostra a janela que permite 0 usuario gravar manual mente um grupo\n\nSub Automatic_A_Click 0\nAutomaticAChecked = True 'Atribui valores as variaveis que indicam a opyao selecionada no menu\nManual_AChecked = False\nACQUISITION = \"Auto\" 'Seleciona 0 tipo de aquisiyao desejada (auto/manual)\nManual_Ac_PaneI.Visible = False 'Esconde a janela que permite 0 usuario gravar manualmente um grupo\n\nde dados\nManual_Ac_Save.Visible = False\nSamples_Number.Text = \"Automatic acquisition (1 save every\" &amp; AcquJrequency &amp; \"sec.)\" 'Mostra a\n\nopyao selecionada na janela de status\nAcquisition_Timer. Interval = Acqu_Frequency * 1000 'Seleciona 0 intervalo das aquisiyoes\n\nEnd Sub\n\nSub SetAS_Click 0\nMsg = \"Saves an acquisition every ... seconds (min=1 max=60)\"\nTitle = \"Acquisition Saving Step\"\nACF = 10 'Default\n\n'Verifica a faixa de 1 to 60 seg\nAgain:\n\nACF = Val(lnputBox$(Msg, Title))\nIf ACF &lt;1 Then AcquJrequency = 1\nIf ACF > 60 Then Acqu_Frequency = 60\n\n\n\nAcquJrequency = ACF\n'Mostra a 0P9ao selecionada na janela de status\n\nCall Automatic_A_Click\nEnd Sub\n\nSub Comm1_Click 0\nCOMM_PORT = 1\nComm1.Checked = True\nComm2.Checked = False\nComm3.Checked = False\nComm4.Checked = False\nCommPortNum.Text = COMM_PORT\n\nEnd Sub\n\nSub Comm2_Click 0\nCOMM_PORT = 2\nComm1.Checked = False\nComm2.Checked = True\nComm3.Checked = False\nComm4.Checked = False\nCommPortNum.Text = COMM_PORT\n\nEnd Sub\n\nSub Comm3_Click 0\nCOMM_PORT = 3\nComm1.Checked = False\nComm2.Checked = False\nComm3.Checked = True\nComm4.Checked = False\nCommPortNum.Text = COMM_PORT\n\nEnd Sub\n\nSub Comm4_Click 0\nCOMM_PORT = 4\nComm1.Checked = False\nComm2.Checked = False\nComm3.Checked = False\nComm4.Checked = True\nCommPortNum.Text = COMM_PORT\n\nEnd Sub\n\nSub pH_ TC_Click 0\npH_ TC.Checked = Not pH_ TC.Checked\nIf pH_ TC.Checked = True Then PH_TEMP _CORR = \"On\" Else PH_TEMP _CORR = \"Off'\n\nEnd Sub\n\nSub Condutivimeter_ TC_Click 0\nCondutivimeter_ TC.Checked = Not Condutivimeter_ TC.Checked\nIf Condutivimeter_ TC.Checked = True Then COND_ TEMP _CORR = \"On\" Else COND_ TEMP _CORR = \"Off'\n\nEnd Sub\n\nSub Power_Click 0\nIf SerialComm.PortOpen = True Then SerialComm.PortOpen = False\nPowerOn = Not PowerOn\nIf PowerOn = True Then PowerLight.BackColor = &amp;HFF Else PowerLight.BackColor = &amp;HCOCOCO\nIf PHWINDOW = \"Active\" Then PH_CAL_ WINDOW.SetFocus\n\n\n\nIf DOWINDOW = \"Active\" Then DO_CAL_WINDOW.SetFocus\nIf PowerOn = True Then Call MainRoutine_Click\nWdgTimer.Enabled = False\nRdataLed.BackColor = &amp;HCOCOCO\nMessages.Text = \"Off'\nAcquisition_ Timer.Enabled = False\n\nEnd Sub\n\nSub Manual_Ac_Save_Click 0\nAcquisition_Num.Text = AC_Num\nTB = Chr$(9)\n\n'Constr6i uma string que contem todos os valore atuais\nDA_ Var = STEMP &amp; TB &amp; SPH &amp; TB &amp; SOX &amp; TB &amp; STU &amp; TB &amp; SCOND &amp; TB &amp; SPROF &amp; TB &amp; STIME &amp; TB\n\n&amp; SDATE &amp; TB\n'Grava 0 grupo atual de dados\n\nOpen DAF _Name For Append As #1\nPrint #1, DA_ Var\n\nClose\nAC_Num = AC_Num + 1 'Conta 0 numero de aquisic;oes feitas\nDataView.DataTextCur.Text = DataView.DataTextCur.Text &amp; DA_Var &amp; Chr$(13) &amp; Chr$(10)\n\nEnd Sub\n\nSub Command1_Click 0\n'Seta uma variavel que permite 0 envio ao PIC do byte que zera 0 contador de profundidade\n\nD_Reset = True\nEnd Sub\n\nSub MainRoutine_Click 0\n'Se ocorrer algum erro a execuc;ao e transferida para 0 r6tulo Erro\n\nOn Error GoTo Erro\n'Mostra mensagens\n\nMessages.FontSize = 10\nMessages.Text = \"Starting Analizer ...\"\n\n'VtempO: valores recebidos do PIC16C84 - VO: Media de VtempO\nStatic Vtemp(5), AVERG(10), TOO As Single\nStatic Rdata, N_MED, N, Com Error As Integer\n\n'Mostra 0 modo de calibrac;ao do medidor de pH: uncal, 1pt or 2pt\nIf PH_CAL 1 = 1 And PH_CAL2 = 1 Then\n\npH_Status. Text = \"Calibrated by 2pt\"\nElself PH_CAL 1 = 1 Then\npH_Status.Text = \"Calibrated by 1pt\"\nElse\npH_Status.Text = \"Uncalibrated\"\n\nEnd If\n'Mostra 0 modo de calibrac;ao do medidor de DO: uncal or calibrated\n\nIf DO_CALO = 1 And DO_CAL 100 = 1 Then\nDO_Status.Text = \"Calibrated\"\nElse\n\n\n\nDO_Status.Text = \"Uncalibrated\"\nEnd If\n\n'Numero de medidas para 0 calculo da media\nN_MED = 4\n\n'Inicializa a porta serial\nSerialComm.CommPort = COMM_PORT\nSerialComm.Settings = \"2400,N,8, 1\"\nSerialComm.PortOpen = True\nFor T = 1 To 10000: Next T\nSerialComm.PortOpen = False\nFor T = 1 To 10000: Next T\nSerialComm.PortOpen = True\n\n'Mostra mensagens\nMessages.ForeColor = &amp;HCOOOOO\nMessages.Text = \"receiving data\"\n\n'Inicia comunica9ao com a sonda (PIC16C84)\nWhile PowerOn = True\n\n'Implementa um led piscante\nRdata = Not Rdata\nIf Rdata = True Then RdataLed.BackColor = &amp;HFFOO&amp; Else RdataLed.BackColor = &amp;HO\n\n'Retorna de um erro na comunica9ao\nCE:\n'La90 para 0 calculo da media\n\nFor N = 1 To N_MED\n'Se 0 botao de reset for pression ado, entao um byte (A7h) e enviado ao PIC para zerar 0 contador de\nprofundidade\n\nIf D_Reset = True Then SerialComm.Output = Chr$(167): D_Reset = False\n'Envia um byte ao PIC16C84 para 0 infcio da conversao (OAh)\n\nSerialComm.Output = Chr$(10)\n'Habilita 0 Watch Dog Timer. Se os dados nao vierem dentro de 1 segundo 0 sistema\n'e reinicializado tentando uma nova comunica9ao\n\nWdgTimer.Enabled = True\n'Aguarda a chegada dos dados enviados pelo PIC16C84\n\nDo\ndummy = DoEventsO\n\nLoop Until SerialComm.lnBufferCount >= 20\n'Desabilita Watch Dog Timer\n\nWdgTimer.Enabled = False\nMessages.Text = \"receiving data\"\n\n'Le 0 buffer da porta serial, esvaziando-o\nDataBlock = SerialComm.lnput\n\n'Agrupa numa palavra de 16bits os dois bytes enviados pelo PIC e verifica 0 byte XOR\n'Converte todos os valores recebidos para a faixa de 0 a 100%\n\nFor i = 0 To 4\nIf (Asc(Mid(DataBlock, 1 + 3' i, 1)) Xor Asc(Mid(DataBlock, 2 + 3' i, 1))) = Asc(Mid(DataBlock, 3 + 3 *\n\ni, 1)) Then\nVtemp(i) = (32!' (Asc(Mid(DataBlock, 1 + 3 * i, 1)) -128) + (Asc(Mid(DataBlock, 2 + 3 * i, 1)) / 8)) /\n\nAVERG(i) = AVERG(i) + Vtemp(i)\nElse\n\nGoTo CE 'Se ocorrer erro, reinicializa comunica9ao\nEnd If\n\nNext i\nNext N\n\n'Calcula a media dos valores\nFori=OT04\n\nV(i) = AVERG(i) / N_MED\nAVERG(i) = 0\n\nNext i\n\n\n\n'Extrai 0 valor da profundidade\nV(5) = 255# * Asc(Mid(OataBlock, 16, 1)) + Asc(Mid(OataBlock, 17, 1))\nV(5) = V(5)' 165280 * 100\n\n'Extrai a escala do Condutivimetro\nCond_Scale = Asc(Mid(OataBlock, 19, 1))\n\n'Extrai a escala do Turbidimetro\nTurb_Scale = Asc(Mid(DataBlock, 20,1))\n\n'Mostra 0 valor da temperatura\nTEMP = 4.096 * V(O)\nSTEMP = Format$(TEMP, \"0.0\")\nGauge_Temp.Value = TEMP * 10\nOigi_ Temp.Caption = STEMP &amp; \" C\"\nPH_CAl_WINDOW.Temp_PH_Ref.Text = STEMP &amp; \"C\" 'mostra 0 valor da temperatura do buffer\n\n'Mostra 0 valor do pH\nIf PH_CAl1 = 1 And PH_CAl2 = 1 Then\n\nCTEMP = (TEMP - (TPH 1 + TPH2) 1 2) * .1259\nMR = (VPH1 - VPH2) 1 (PH1 - PH2)\nPH = (V(1) - (7 - PH1) * MR - VPH1) 1 (CTEMP + MR) + 7\n\nEiself PH_CAl1 = 1 Then\nMR = 3.448 + .01259 * TEMP\nPH = (V(1) - (3.448 + .01259 * TPH1) * (7 - PH1) - VPH1) 1 MR + 7\n\nElse\nPH = (V(1) - 32.61) 1 (3.448 + .01259 * TEMP) + 7\n\nEnd If\nSPH = Format$(PH, \"0.00\")\nGauge_pH.Value = PH * 100 'Ajuste da escala\nDigi_pH.Caption = SPH\n\n'Mostra 0 valor da concentra9ao de oxigenio dissolvido\nTOO = (TO0100 + TOOO) 1 2\nIfTDO &lt;17.5 Then\n\nSOlUB = .0063 * TOO * TOO - .3875 * TOO + 14.158\nElse\n\nSOlUB = -3,2192 * log(TOO) + 18.478\nEnd If\nSOlUB = (Pressure 1760) * SOlUS\nIf DO_CAlO = 1 And DO_CAl100 = 1 Then\n\nMR = 100 1 (VD01 00 - VOOO)\nox = MR * (V(2) - VDOO)\nConc_OX = OX * SOLUB/100\nSOX = Format$(Conc_OX, \"0.00\")\nGauge_02.Value = Conc_OX * 100\nDigi_02.Captlon = SOX &amp;\" mg/l\"\n\nElse\nOX = V(2)\nSOX = Format$(OX, \"0.00\")\nGauge_02.Value = OX * 100\nDigi_02.Caption = SOX &amp;\" mg/l\"\n\nEnd If\n'Mostra 0 valor da turbidez\n\nSelect Case Turb_Scale\nCase 0\n\nTU = -.00002 * V(3) \"4 + .0084 * V(3) \" 3 - .2841 * V(3) \" 2 + 8.8719 * V(3) + .0636\nSTU = Format$(TU, \"0\")\nGauge_ Turb2Value = TU\nGauge_ Turb2.Visible = True\nGauge_ Turb1.visible = False\n\nCase 1\nTU = -.00008 * V(3) \" 3 + .0108 * V(3) \" 2 + .2292 * V(3)\nSTU = Formal$rTU, \"0.0\")\n\n\n\nGauge_ Turb1. Value = TU * 10\nGauge_ Turb2Visibie = False\nGauge_ Turb1.Visible = True\n\nEnd Select\nDigi_ Turb.Caption = STU &amp; \" NTU\"\n\n'Mostra 0 valor da condutancia especifica\nSelect Case Cond_Scale\nCase a\n\nCOND = V(4) * .734 - .7 'Ajuste de off-set e ganho\nSCOND = Format$(COND, \"0.0\")\nGauge_CondO.Value = COND * 10\nGauge_CondO.Visible = True\nGauge_Cond1Visible = False\nGauge_Cond2.Visible = False\nDigi_Condut.Caption = SCOND &amp; \" uS/em\"\n\nCase 1\nCOND = (V(4) - .0001) * 8.85 'Ajuste de off-set e ganho\nSCOND = Format$(COND, \"0.0\")\nGauge_Cond1.Value = COND\nGauge_CondO.Visible = False\nGauge_Cond1.Visible = True\nGauge_Cond2Visible = False\nDigi_Condut.Caption = SCOND &amp; \" uS/em\"\n\nCase 2\nCOND = V(4) * .08771 'Ajuste de off-set e ganho\nSCOND = Format$(COND, \"0.00\")\nGauge_Cond2.Value = COND * 100\nGauge_CondOVisible = False\nGauge_Cond1.Visible = False\nGauge_Cond2.Visible = True\nDigi_Condut.Caption = SCOND &amp; \" mS/cm\"\n\nEnd Select\n'Mostra a profundidade\n\nPROF = V(5)\nSPROF = Format$(PROF, \"0\")\nDepth.Text = SPROF\n\n'Mostra a data e a hora\nSTIME = TimeS\nSDATE = Date$\nDispTime = STIME\nDispDate = SDATE\n\n'Inicia a gravay80 dos dados adquiridos\nIf ACQUISITION = \"Auto\" Then Acquisition_ Timer.Enabled = True Else Acquisition_ Timer.Enabled = False\ndummy = DoEventsO\n\nWend\n'Termina a gravayao dos dados adquiridos\n\nAcquisition_ Timer.Enabled = False\n'Fecha porta serial\n\nIf SerialComm.PortOpen = True Then SerialComm.PortOpen = False\nGo T0 NoError\nErro:\n\nCommError = \"Communication falilure. Check if the selected Comm number matchs the hardware conection\"\nCalError = \"Calibration failure. Runs Calibration again.\"\nSelect Case Err\n\nCase 68 'Device unavailable, causado por erro na comunicayElo\nMsgBox CommError, 16\n\nCase 6 'Overflow, causado principalmente por erro na calibrayao\nMsgBox CalError, 16\n\nCase 11 'Division by zero. causado principalmente por erro na calibrayElo\n\n\n\nMsgBox CalError, 16\nEnd Select\nPowerOn = False\nPowerLighl.BackColor = &amp;HCOCOCO\n\nResume NoError\nNoError:\nEnd Sub\n\nSub Form_Load 0\nOn Error GoT 0 Erro3\n'Rotinas de Inicializac;:ao\n\nPHWINDOW = \"Closed\"\nDOWINDOW = \"Closed\"\nStatic CF _Menu(1 OJ, CAL_ Var_Sub(19) As String\nAcquJrequency = 2 'Seta intervalo default como sendo 2 seg\nPowerOn = False 'Inicializa 0 botao de On/Off\nTB = Chr$(9}\n\n'Inicializac;:ao\nSTEMP = \"0\"\nSPH = \"0\"\nSTU = \"0\"\nSCOND = \"0\"\nSOX = \"0\"\nSPROF = \"0\"\nSTIME = \"0\"\nSDATE = \"0\"\nAC_Num = 0\nPressure = 760\n\n'Se 0 usuario nao da um nome ao arquivo de aquisic;:ao de dados, entao os dados SEW gravados num arquivo de\nnome NONAME.DAT\n\nDAF _Name = CurDir$ &amp; \"\\NONAME.dat\"\nAcquFileName.Text = DAF _Name 'Mostra 0 nome do arquivo de aquisic;:ao\n\n'Escreve 0 cabec;:alho on arquivo\nOpen DAF _Name For Output As #1\n\nPrint#1, \"Temp(C)\" &amp; TB &amp; \"pH\" &amp; T8 &amp; \"02(%)\" &amp; TB &amp; \"Tu(NTU}\" &amp; T8 &amp; \"Cdt(uS)\" &amp; T8 &amp; \"Prof(m)\" &amp;\nTB &amp; \"Hora\" &amp; TB &amp; \"Data\"\n\nClose\n'Abre 0 arquivo de configurac;:ao (Config.dat)\n\nOpen CurDir$ &amp; \"\\Cfg.dat\" For Input As #1 'Carrega a ultima configurac;:ao do programa\nConfig = Input$(LOF(1), #1)\n\nClose #1\n'Le a string Config e a separa em substrings relacionadas com a configurac;:ao do menu do programa\n\nj = 1\nk = 1\ni = 1\nDo\n\ni = InStr(k, Config, \" \")\nCF _MenuU) = Mid$(Config, k, i - k)\nj = j + 1\nk = i + 1\n\nLoop Until CF _MenuU - 1) = \"EOF\"\n'Faz a atribuic;:ao das variaveis do Menu e dos arquivos\n\nCALF_Name = CF _Menu(1)\nACQUISITION = CF _Menu(2)\nCOMM_PORT = Val(CF _Menu(3))\nPH.TEMP.CORR = CF. Menu(4)\n\n\n\nCOND_ TEMP _CORR = CF _Menu(5)\n'Restaura a ultima configura9ao do Menu\n\nSelect Case ACQUISITION\nCase \"Manual\"\n\nCall Manual_A_Click\nCase \"Auto\"\n\nCall Automatic_A_ Click\nEnd Select\nSelect Case COMM_PORT\nCase 1\n\nCall Comm1_Click\nCase 2\n\nCall Comm2_ Click\nCase 3\n\nCall Comm3_Click\nCase 4\n\nCall Comm4_Click\nEnd Select\nIf PH_TEMP _CORR = \"On\" Then pH_ TC.Checked = True Else pH_ TC.Checked = False\nIf COND_ TEMP _CORR = \"On\" Then Condutivimeter_ TC.Checked = True Else Condutivimeter_ TC.Checked =\n\nFalse\n'Inicializa as variaveis de calibra9ao com 0 ultimo arquivo de calibra9ao utilizado\n\nOpen CALF_Name For input As #1\nCAL_VAR = Input$(LOF(1), #1)\n\nClose #1\nCalFileName.Text = CALF_Name 'Mostra 0 nome do arquivo de calibra9ao\n\n'Le a string CAL_VAR e a separa em substrings relacionadas com a configura9ao do menu do programa\nj = 1\nk = 1\ni = 1\nDo\n\ni = InStr(k, CAL_ VAR, \" \")\nCAL_Var_SubU) = Mid$(CAL_VAR, k, i - k)\nj = j + 1\nk = i + 1\n\nLoop Until CAL_Var_SubU -1) = \"EOF\"\n'Faz a atribui9ao das variaveis de calibra9ao\n\nPH_CAL 1 = Val(CAL_Var_Sub(1))\nPH_CAL2 = Val(CAL_Var_Sub(2))\nVPH1 = Val(CAL_Var_Sub(3))\nPH1 = Val(CAL_Var_Sub(4))\nTPH1 = Val(CAL_Var_Sub(5))\nVPH2 = Val(CAL_ Var_Sub(6))\nPH2 = Val(CAL_Var_Sub(7))\nTPH2 = Val(CAL_Var_Sub(8))\nVTU1 = Val(CAL_Var_Sub(9))\nTU1 = Val(CAL_Var_Sub(10))\nVTU2 = Val(CAL_ Var_Sub(11))\nTU2 = Val(CAL_Var_Sub(12))\nDO_CALO = Val(CAL_Var_Sub(13))\nDO_CAL 100 = Val(CAL_Var_Sub(14))\nVDOO = Val(CAL_ Var_Sub(15))\nVD0100 = Val(CAL_Var_Sub(16))\nTOOO = Val(CAL_Var_Sub(17))\nTO0100 = Val(CAL_Var_Sub(18))\n\n'Mostra 0 modo de calibra9ao do medidor de pH: uncal, 1pt or 2pt\nIf PH_CAL 1 = 1 And PH_CAL2 = 1 Then\n\npH_Status.Text = \"Calibrated by 2pt\"\nElself PH_CAL 1 = 1 Then\n\n\n\npH_Status. Text: \"Calibrated by 1pt\"\nElse\npH_Status. Text : \"Uncalibrated\"\n\nEnd If\n'Mostra 0 modo de calibrayEio do medidor de DO: uncal, calibrated\n\nIf DO_CALO: 1 And DO_CAL 100: 1 Then\nDO_Status.Text: \"Calibrated\"\nElse\nDO_Status.Text: \"Uncalibrated\"\n\nEnd If\nPress_Status: \"P:\" &amp; Pressure &amp; \"mmHg\"\n\nGoTo NoError3\nErro3:\n\nFE : \"First time running. Before exiting give a name to the Calibration File and save it\"\nSelect Case Err\n\nCase 53, 57, 71, 76, 52 'Erro de arquivo\nMsgBox FE, 48\n\nEnd Select\nCALF_Name: \"\"\n\nResume NoError3\nNoError3:\n\nStartup. Present Timer.Enabled : True\nEnd Sub\n\nSub Acquisition_ Timer_Timer 0\nAC_Num : AC_Num + 1 'conta 0 numero de aquisiyoes feitas\nAcquisition_Num.Text: AC_Num\nTB: Chr$(9)\n\n'Constr6i uma string que contem todos os valores atuais\nDA_ Var : STEMP &amp; T8 &amp; SPH &amp; T8 &amp; SOX &amp; T8 &amp; STU &amp; T8 &amp; SCOND &amp; T8 &amp; SPROF &amp; T8 &amp; STIME &amp; T8\n\n&amp; SDATE &amp; T8\n'Grava em disco 0 grupo de dados atual\n\nOpen DAF _Name For Append As #1\nPrint #1, DA_ Var\n\nClose\n'Adiciona 0 novo grupo de valores na janela de visualizayEio dos dados (DataView)\n\nDataViewDataTextCur.Text: DataViewDataTextCur.Text &amp; DA_ Var &amp; Chr$(13) &amp; Chr$(10)\nEnd Sub\n\nSub WdgTimer_ Timer 0\nStatic toggle As Integer\n\n'Mud a 0 led piscante para um led com cor vermelha continua\nRdataLed.8ackColor: &amp;HFF\n\n'Alterna as mensagens de status\ntoggle: Not toggle\nSelect Case toggle\nCase True\n\nMessages.Text: \"Communication Error.\"\nCase False\n\nMessages.Text: \"Trying to recover ...\"\nEnd Select\n\n'Trata erros\n\n\n\nOn Error GoTo Erro2\n'Esvazia 0 buffer da porta serial\n\nLixo = SerialComm.lnput\n'Envia ao PIC16C84 um outro byte\n\nSerialComm.Output = Chr$(10)\nGoTo NoError2\nErro2:\n\nCommError = \"Communication falilure. Check if the selected Comm number matchs the hardware conection\"\nCalError = \"Calibration failure. Runs Calibration again.\n\nSelect Case Err\nCase 68 'Device unavailable, causado por erros na comunicayao\n\nMsgBox CommError, 16\nCase 6 'Overflow, causado principalmente par erro na calibrayao\n\nMsgBox CalError, 16\nCase 11 'Division by zero, causado principalmente por erro na calibrayao\n\nMsgBox CalError, 16\nEnd Select\nPowerOn = False\nPowerLight.BackColor = &amp;HCOCOCO\nWdgTimer.Enabled = False\n\nResume Next\nNoError2:\nEnd Sub\n\nSub Command1_Click 0\n'Trata erro\n\nOn Error GoTo Erro\n'Define 0 caracter TAB\n\nTB = Chr$(9)\n'Pae um \"\\\" se 0 caminho nao tem\n\nIf Dir1.Path = \"c:\\\" Then\nFile_Name.Text = Dir1.Path + File_Name.Text\n\nElse\nFile_Name.Text = Dir1.Path + \"\\\" + File_Name.Text\n\nEnd If\n'Seleciona a vari<3vel para receber 0 nome do arquivo e grava os parametros da calibrayao\n\nSelect Case Files.Caption\nCase \"New Acquisition Data File\"\n\nN_ADF 'Chama sub-rotina\nCase \"Open Acquisition Data File\"\n\nO_ADF 'Chama sub-rotina\nCase \"Open Calibration File\"\n\nO_CF 'Chama sub-rotina\nCase \"Save Calibration File\"\n\nS_CF 'Chama sub-rotina\nEnd Select\nFiles.Hide 'Esconde a janela de arquivos (Files)\nMain.AcquFileName.Text = DAF _Name ' Mostra 0 nome do arquivo de dados\n\nGoTo NoError\nErro:\n\nFNF = \"File not found\"\n10 = \"I/O error. Try Again\"\nDNR = \"Disk not readY\"\n\n\n\nPNF = \"Path not found\"\nBFN = \"Bad file name\"\nSelect Case Err\n\nCase 53 'File Not Found\nMsgBox FNF, 16\n\nCase 57 'I/O error\nMsgBox 10,16\n\nCase 71 'Disk not ready\nMsgBox DNR, 16\n\nCase 76 'Path not found\nMsgBox PNF, 16\n\nCase 52 'Bad file name'\nMsgBox BFN, 16\n\nEnd Select\nCall Command2_Click 'Cancela\n\nResume NoError\nNoError:\nEnd Sub\n\nSub N_ADF 0\nStatic DA_File As String\n\nOAF_Name = File_Name.Text\n'Procura a extensao \".dat\". Se nao ha, uma e colocada.\n\nIf InStr(1 , OAF_Name, \".\") = a Then OAF_Name = OAF_Name &amp; \".dat\"\nAC_Num = a 'Zera 0 numero de aquisir;6es feitas\nMain.Acquisition_Num.Text = AC_Num 'Atualiza a janela de status\n\n'Escreve 0 caber;alho\nOpen OAF_Name For Output As #1\n\nPrint #1, \"Temp(C)\" &amp; TB &amp; \"pH\" &amp; TB &amp; \"02(%)\" &amp; TB &amp; \"Tu(NTU)\" &amp; TB &amp; \"Cdt(uS)\" &amp; TB &amp;\n\"Prof(m)\" &amp; TB &amp; \"Hora\" &amp; TB &amp; \"Data\"\n\nClose\nMain.Enabled = True 'Habilita 0 controle na janela principal\nMain.SetFocus\nDataView.Enabled = True\n\nEnd Sub\n\nSub O_ADF 0\nStatic DAJile As String\n\nOAF_Name_Load = File_Name.Text\nOpen OAF _Name_Load For Input As #1\n\nDAJile = Input$(LOF(1), #1)\nClose #1\n\nDataViewDataTextFile.Text = DAJile 'Mostra todo 0 arquivo carregado\nDataViewDataTextFile.Visible = True\nMain.Enabled = True 'Habilita controle na janela principal\nDataView.Enabled = True 'Habilita controle na janela de visuaiizar;ao dos dados (DataView)\nDataView.SetFocus\nDataView.FileData.Value = True\nDataView.Caption = \"Data View - \" &amp; OAF _Name_Load\n\n\n\nSub O_CF 0\nStatic CAL_Var_Sub(19) As String\n\nCALF_Name = File_Name.Text\nOpen CALF _Name For Input As #1\n\nCAL_ Var = Input$(LOF(1), #1)\nClose #1\nMain.CaIFileName.Text = CALF_Name 'Mostra 0 nome do arquivo de calibra9ao\n\n'Le a string CAL_ Var e a separa criando as substrings relacionadas a ultima configura9ao do menu\nj = 1\nk = 1\ni = 1\nDo\n\ni = InStr(k, CAL_ Var, II \")\nCAL_Var_SubU) = Mid$(CAL_Var, k, i - k)\nj = j + 1\nk = i + 1\n\nLoop Until CAL_Var_SubU -1) = \"EOF\"\n'Faz a atribui9ao das variaveis de calibra9ao\n\nPH_CAL 1 = Val(CAL_ Var_Sub(1))\nPH_CAL2 = Val(CAL_ Var _Sub(2))\nVPH1 = Val(CAL_Var_Sub(3))\nPH1 = Val(CAL_Var_Sub(4))\nTPH1 = Val(CAL_Var_Sub(5))\nVPH2 = Val(CAL_ Var_Sub(6))\nPH2 = Val(CAL_Var_Sub(7))\nTPH2 = Val(CAL_ Var_Sub(8))\nVTU1 = Val(CAL_Var_Sub(9))\nTU1 = Val(CAL_Var_Sub(10))\nVTU2 = Val(CAL_Var_Sub(11))\nTU2 = Val(CAL_ Var_Sub(12))\nDO_CALO = Val(CAL_Var_Sub(13))\n00_ CAL 100 = Val(CAL_ Var_Sub(14))\nVDOO = Val(CAL_Var_Sub(15))\nVD0100 = Val(CAL __Var_Sub(16))\nTOOO = Val(CAL_Var_Sub(17))\nTD0100 = Val(CAL_Var_Sub(18))\n\nMain.Enabled = True 'Habilita controle na janela principal (Main)\nDataView.Enabled = True\nMain.SetFocus\n\nSub\n\nSub S_CF 0\nCALF _Name = File_Name.Text\n\n'Procura pela extensao II .cal\". Se nao ha, uma e colocada\nIf InStr(1 , CALF_Name, \".\") = a Then CALF_Name = CALF_Name &amp; \".cal\"\n\n'F az a concatena9Eto da variavel CAL_ Var, juntando todas as variaveis de calibra9Eto\nCAL_ Var = PH_CAL 1 &amp; Space(1) &amp; PH_CAL2 &amp; Space(1) &amp; VPH1 &amp; Space(1) &amp; PH1 &amp; Space(1) &amp;\n\nTPH1 &amp; Space(1) &amp; VPH2 &amp; Space(1) &amp; PH2 &amp; Space(1) &amp; TPH2 &amp; Space(1) &amp; VTU1 &amp; Space(1) &amp; TU1 &amp;\n\n\n\nSpace(1) &amp; VTU2 &amp; Space(1) &amp; TU2 &amp; Space(1) &amp; DO_CALo &amp; Space(1) &amp; DO_CAL 100 &amp; Space(1) &amp; VDOo &amp;\nSpace(1) &amp; VD0100 &amp; Space(1) &amp; TOOo &amp; Space(1) &amp; TO01oo &amp; Space(1) &amp; \"EOF\" &amp; Space(1)\n\nOpen CALF _Name For Output As #1\nPrint #1, CAL_ Var\n\nClose\nMain.CaIFileName.Text = CALF_Name 'Mostra 0 nome do arquivo de calibray80\n\nMain.Enabled = True 'Habilita contrale na janela principal (Main)\nDataView.Enabled = True\nMain. SetFocus\n\nSub\n\nSub Command2_ Click 0\nFiles.Hide\nMain.Enabled = True\nDataView.Enabled = True\nMain.SetFocus\n\nSub\n\nSub Dir1_Change 0\nFile1.Path = Dir1.Path 'Atribui 0 caminho do diret6rio a lista de arquivo\nLabel3.Caption = Dir1.Path 'Mostra 0 caminho do diret6rio\n\nSub\n\nSub Drive1_Change 0\nDir1.Path = Drive1.Drive 'Muda 0 drive na lista de diret6rio\n\nSub\n\nSub Ext_Change 0\nFiles.File1.Pattern = Files.Ext.Text 'Muda a extens80 dos arquivos mostrados\n\nSub\n\nSub File1_Click 0\nFile_Name.Text = File1.FileName 'Mostra 0 nome do arquivo selecionado\n\nSub\n\nSub Form_Load 0\nMain.Enabled = False\nDataView.Enabled = False\n\nSub\n\nD3. Sub-Rotinas da Janela de Visualiza.;ao dos Dados\n(DATAVIEW)\n\nSub Command1_Click 0\nFiles.Ext.Text = \"'.dat\"\nFiles.File1.Pattern = Files.Ext.Text\nFiles.Caption = \"Open Acquisition Data File\"\nFiles.Show\n\nEnd Sub\n\n\n\nSub Command2_Click 0\nSelect Case CurData.Value\nCase True\n\nPrinter. Print TextHeader. Text\nPrinter. Print DataTextCur.Text\n\nCase False\nPrinter. Print Data TextFile. Text\n\nEnd Select\nEnd Sub\n\nSub Command3_Click 0\nDataView.Hide\n\nEnd Sub\n\nSub CurData_ Click (Value As Integer)\nDataTextCur.Visible = True\nDataTextFile.visible = False\nDataView.Caption = \"Data View - \" &amp; DAF _Name\n\nEnd Sub\n\nSub FileData_Click (Value As Integer)\nDataTextCur.Visible = False\nDataTextFile.Visible = True\nDataView.Caption = \"Data View - \" &amp; DAF _Name_Load\n\nEnd Sub\n\nSub Form_Load 0\nDataView.Caption = \"Data View - \" &amp; DAF _Name\ntb = Chr$(9)\nHeader = \"Temp(C)\" &amp; tb &amp; \"pH\" &amp; tb &amp; \"02(%)\" &amp; tb &amp; \"Tu(NTU)\" &amp; tb &amp; \"Cdt(uS)\" &amp; tb &amp; \"Prof(m)\" &amp; tb &amp;\n\n\"Hora\" &amp; tb &amp; \"Data\" &amp; Chr$(13) &amp; Chr$(1 0)\nTextHeader. Text = Header\nCurData.Value = True\n\nEnd Sub\n\nSub Command1_Click 0\n'Verifica se 0 analisador esta Iigado\n\nIf PowerOn = False Then\nMsgBox \"Turn first the analizer on\". 16\n\n\n\nElse\n'Inicia a calibrayao do padrao selecionado\n\nCal_Message.ForeColor = &amp;HFFOOOO\nCal_Message = \"Wait. ..\"\nSelect Case Disp_Buffer.Caption\nCase \"Buffer 1\"\n\nTimer1.Enabled = True\nCase \"Buffer 2\"\n\nTimer2.Enabled = True\nEnd Select\n\nEnd If\nEnd Sub\n\nSub Command4_Click 0\n'Termina 0 processo de calibrayao\n\nTimer1. Enabled = False\nTimer2.Enabled = False\nProgress_Meter. Value = 0\n\n'Cancela a calibrayao do padrao selecionado\nSelect Case Disp_Buffer.Caption\nCase \"Buffer 1\"\n\nPH_CAL 1 = 0\nBuffer_Value.Text = 4\nCal_Message.ForeColor = &amp;HFF\nCal_Message,Caption = \"Buffer 1 calibration canceled\"\n\nCase \"Buffer 2\"\nPH_CAL2 = 0\nBuffer_Value.Text = 10\nCal_Message.ForeColor = &amp;HFF\nCal_Message.Caption = \"Buffer 2 calibration canceled\"\n\nEnd Select\n'Atualiza a mensagem de status do pH\n\nIf PH_CAL 1 = 1 And PH_CAL2 = 1 Then\nMain.pH_Status.Text = \"Calibrated by 2pt\"\n\nEiself PH_CAL 1 = 1 Then\nMain.pH_Status,Text = \"Calibrated by 1pt\"\n\nElse\nMain.pH_Status.Text = \"Uncalibrated\"\n\nEnd If\nEnd Sub\n\nSub Timer1_ Timer ()\nStatic LOCAL_ VPH, DIF As Single\nStatic k As Integer\n\n'Calcula a diferenya entre 0 valor atual do pH e 0 anterior\nDIF = Abs(LOCAL_VPH - V(1))\nLOCAL_VPH = V(1)\n\n'Cada vez que a diferenya e menor que 0.02 0 contador k e incrementado\nIf DIF &lt;.02 Then k = k + 1\n\n'Quando k=1 0 0 processo de calibrayao termina\nIf k = 10 Then VPH1 = LOCAL_ VPH: PH1 = Val(Buffer_ Value.Text): Cal_Message.Caption = \"1st Point\n\nCalibrated\": Timer1.Enabled = False: PH_CAL 1 = 1: TPH1 = TEMP k = 0\nProgress,Meter.Value = k\n\n\n\nSub Timer2_ Timer ()\nStatic LOCAL_ VPH, DIF As Single\nStatic k As Integer\n\n'Calcula a diferen9a entre 0 valor atual do pH e 0 anterior\nDIF = Abs(LOCAL_VPH - V(1))\nLOCAL_VPH = V(1)\n\n'Cad a vez que a diferen9a e menor que 0.020 contador k e incrementado\nIf DIF &lt;.02 Then k = k + 1\n\n'Quando k=1 0 0 processo de calibra9ElO termina\nIf k = 10 Then VPH2 = LOCAL_ VPH: PH2 = Val(Buffer_ Value.Text): Cal_Message.Caption = \"2nd Point\n\nCalibrated\": Timer2.Enabled = False: PH_CAL2 = 1: TPH2 = TEMP: k = 0\nProgress_Meter.value = k\n\nEnd Sub\n\nD4.5 Sub-rotinas dos objetos restantes\n\nSub BuffeU_Click ()\nDisp_Buffer.Caption = \"Buffer 1\"\nBuffer_ Value.Text = PH1\nTemp_PH_Ref.Text = TPH1\n\nEnd Sub\n\nSub Buffer_2_Click ()\nDisp_Buffer.Caption = \"Buffer 2\"\nBuffer_ Value. Text = PH2\nTemp_PH_Ref.Text = TPH2\n\nEnd Sub\n\nSub Command3_Click ()\nPH_ CAL_ WINDOW. Hide\nPHWINDOW = \"Closed\"\n\n'Atualiza a mensagem de status do pH\nIf PH_CAL 1 = 1 And PH_CAL2 = 1 Then\n\nMain.pH_Status.Text = \"Calibrated by 2pt\"\nEiself PH_CAL 1 = 1 Then\n\nMain.pH_Status.Text = \"Calibrated by 1pt\"\nElse\n\nMain.pH_Status.Text = \"Uncalibrated\"\nEnd If\n\nEnd Sub\n\nSub Form_Load ()\n'Inicializa a janela de calibra9ElO com 0 Buffer 1\n\nDisp_Buffer = \"Buffer 1\"\nBuffer_Value.Text = PH1\n\nEnd Sub\n\n\n\nSub Command1_Click ()\n'Verifica se 0 analisador esta ligado\n\nIf PowerOn = False Then\nMsgBox \"Turn first the analizer on\", 16\n\nElse\n'inicia a calibra9ElO do ponto selecionado\n\nCal_Message.ForeColor = &amp;HFFOOOO\nCal_Message = \"WaiL\"\nSelect Case Disp_DO.Caption\nCase \"0%\"\n\nTimer1.Enabled = True\nCase \"100%\"\n\nTimer2.Enabled = True\nEnd Select\n\nEnd If\n'Mostra a temperatura de refencia\n\nTemp_DO_Ref.Text = STEMP\nEnd Sub\n\nSub Command4_Click ()\n'Paralisa 0 processo de calibra9Elo\n\nTimer1.Enabled = False\nTimer2.Enabled = False\nProgress_Meter.Value = 0\n\n'Cancela 0 ponto de calibra9ElO selecionado\nSelect Case Disp_DO.Caption\nCase \"0%\"\n\nDO_CALO = 0\nCal_Message.ForeColor = &amp;HFF\nCal_Message.Captlon = \"0% calibration canceled\"\n\nCase \"100%\"\nDO_CAL 100 = 0\nCal_Message,ForeColor = &amp;HFF\nCal_Message.Caption = \"100% calibration canceled\"\n\nEnd Select\n'Atualiza a mensagem de status do medidor de ox. dissol.\n\nIf DO_CALO = 1 And DO_CAL 100 = 1 Then\nMainDO_Status.Text = \"Calibrated\"\n\nElse\nMainDO_StatusText = \"Uncalibrated\"\n\nEnd If\nEnd Sub\n\n\n\nSub Timer1_ Timer 0\nStatic LOCAL_ VDO, DIF As Single\nStatic k As Integer\n\n'Calcula a diferenya entre 0 valor atual da concentrayao de DO e 0 anterior\nDIF = Abs(LOCAL_ VDO - V(2))\nLOCAL_ VDO = V(2)\n\n'Cad a vez que a diferenya e men or que 0.02 0 contador k e incrementado\nIf DIF &lt;.02 Then k = k + 1\n\n'Quando k=1 00 processo de calibrayao termina\nIf k = 10 Then VDOO = LOCAL_ VDO: Cal_Message.Caption = \"0% Point Calibrated\": Timer1.Enabled = False:\n\nDO_CALO = 1: TOOO = TEMP: k = 0:\nProgress_MeterValue = k\n\nEnd Sub\n\nSub Timer2_ Timer 0\nStatic LOCAL_ VDO, DIF As Single\nStatic k As Integer\n\n'Calcula a diferenya entre 0 valor atual da concentrayao de DO e 0 anterior\nDIF = Abs(LOCAL_VDO - V(2))\nLOCAL_ VDO = V(2)\n\n'Cad a vez que a diferenya e menor que 0.02 0 contador k e incrementado\nIf DIF &lt;.02 Then k = k + 1\n\n'Quando k=10 0 processo de calibrayao termina\nIf k = 10 Then VD0100 = LOCAL_VDO: Cal_Message.Caption = \"100% Point Calibrated\": Timer2.Enabled =\n\nFalse: DO_CAL100 = 1: T00100 = TEMP: k = 0\nProgress_Meter. Value = k\n\nEnd Sub\n\nD4.5 Sub-rotinas dos objetos restantes\n\nSub Command3_Click 0\nDO_CAL_WINDOWHide\nDOWINDOW = \"Closed\"\n\n'Atualiza a mensagem de status do medidor de oxig. dissol.\nIfDO_CALO = 1 And DO_CAL100 = 1 Then\n\nMain.DO_Status.Text = \"Calibrated\"\nEiself PH_CAL 1 = 1 Then\nElse\n\nMain.DO_Status.Text = \"Uncalibrated\"\nEnd If\n\nEnd Sub\n\nSub Form_Load 0\n'Inicializa a janela de calibrayao do ox. dis. com 0 ponto de 0%\n\nDisp_DO = \"0%\"\nEnd Sub\nSub Ponto_O_Click 0\n\nDisp_DO.Caption = \"0%\"\nTemp_DO_Ref.Text = TOOO\n\nEnd Sub\n\n\n\nDisp_DO.Caption = \"100%\"\nTemp_DO_Ref.Text = TD0100\n\nEnd Sub\n\nSub Ponto_O_Click 0\nDisp_DO.Caption = \"0%\"\nTemp_DO_Ref.Text = STEMP\n\nEnd Sub\n\nSub Ponto_100_Click ()\nDisp_DO.Caption = \"100%\"\nTemp_DO_Ref.Text = STEMP\n\nEnd Sub\n\nSub Press_Sox_Change ()\nAltitude = Val(Press_Box.Text)\nIf Altitude> 0 And Altitude &lt;5000 Then\n\nPressure = -.08 * Altitude + 760\nElse\nEnd If\nMain.Press_Status = \"P=\" &amp; Pressure &amp; \"mmHg\"\n\nEnd Sub\n\nSub Form_Load ()\nLoad Main\n\nEnd Sub\n\nSub Present_ Timer_Timer ()\nMain.Show\nPresent Timer.Enabled = False\n\nEnd Sub"}]}}}