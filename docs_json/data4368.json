{"add": {"doc": {"field": [{"@name": "docid", "#text": "BR-TU.06769"}, {"@name": "filename", "#text": "11345_348508.pdf"}, {"@name": "filetype", "#text": "PDF"}, {"@name": "text", "#text": "FEDERAL UNIVERSITY OF SANTA CATARINA GRADUATE PROGRAM IN SYSTEMS AND AUTOMATION ENGINEERING\nThiago Lima Silva\nCONTRIBUTIONS TO MODELING AND OPTIMIZATION OF OIL PRODUCTION SYSTEMS\nThiago Lima Silva\nCONTRIBUTIONS TO MODELING AND OPTIMIZATION OF OIL PRODUCTION SYSTEMS\nThesis presented to the Graduate Program in Systems and Automation Engineering in partial fulfillment of the requirements for the degree of Doctor in Systems and Automation Engineering.\nAdvisor: Prof. Eduardo Camponogara, Ph.D. Co-advisor: Prof. Bjarne Anton Foss, Dr.\nFicha de identifica\u00e7\u00e3o da obra elaborada pelo autor, atrav\u00e9s do Programa de Gera\u00e7\u00e3o Autom\u00e1tica da Biblioteca Universit\u00e1ria da UFSC.\nSilva, Thiago Lima\nContributions to Modeling and Optimization of Oil Production Systems / Thiago Lima Silva ; orientador, Eduardo Camponogara, coorientador, Bjarne Anton Foss, 2017.\n157 p.\nTese (doutorado) - Universidade Federal de Santa Catarina, Centro Tecnol\u00f3gico, Programa de P\u00f3s Gradua\u00e7\u00e3o em Engenharia de Automa\u00e7\u00e3o e Sistemas, Florian\u00f3polis, 2017.\nInclui refer\u00eancias.\n1. Engenharia de Automa\u00e7\u00e3o e Sistemas. 2. Mixed Integer Programming. 3. Production Optimization. 4. Gas-Lift Systems. 5. Reservoir Management. I. Camponogara, Eduardo. II. Foss, Bjarne Anton. III. Universidade Federal de Santa Catarina. Programa de P\u00f3s-Gradua\u00e7\u00e3o em Engenharia de Automa\u00e7\u00e3o e Sistemas. IV. T\u00edtulo.\nThiago Lima Silva\nCONTRIBUTIONS TO MODELING AND OPTIMIZATION OF OIL PRODUCTION SYSTEMS\nThis Thesis is recommended in partial fulfillment of the requirements for the degree of \u201cDoctor in Systems and Automation Engineering\u201d, which has been approved in its present form by the Graduate Program in Systems and Automation Engineering.\nFlorian\u00f3polis, April 19th 2017.\nProf. Daniel Coutinho, Dr. Graduate Program Coordinator Coordinator\nDissertation Committee:\nProf. Eduardo Camponogara, Ph.D.\nAdvisor\nProf. Bjarne Anton Foss, Dr. Co-advisor\nProf. Denis Jos\u00e9 Schiozer, Dr.\nProf. Regis Kruel Romeu, Dr.\nProf. Erlon Cristian Finardi, Dr.\nProf. Ubirajara Franco Moreno, Dr.\nProf. Juliano de Bem Francisco, Dr.\nProf. F\u00e1bio Luis Baldissera, Dr.\nTo my dear parents ...\nTo those who believed ...\nACKNOWLEDGEMENTS\nI would like to thank the Federal University of Santa Catarina (UFSC) and the Norwegian University of Science and Technology (NTNU) for hosting me in a friendly and engaging environment through the course of theses years. I also thank Petrobras, Statoil, CNPq and Capes for the financial support which have allowed me to fulfill my dream of achieving a PhD degree.\nFirstly and foremost, i would like to express my sincere gratitude to my supervisor and friend professor Eduardo Camponogara. Without his guidance, inspiration, and support, this dissertation would not have been possible. Thank you for believing in me and keeping me motivated at every obstacle and challenge that appeared in the way.\nI would also like to thank my co-supervisor professor Bjarne Foss for the opportunity to pursue my doctoral internship at NTNU under his supervision. Bjarne gave me freedom to follow my own path, while contributing to improve the work quality in crucial moments. I will not forget the amazing experience of living in Trondheim and changes that came with it.\nSomeone who deserves a special acknowledgement is my friend Andr\u00e9s Codas, who was a close collaborator and technical advisor during my internship at NTNU. Every time i was stuck, Andr\u00e9s kept me motivated and challenged me to do my best. I also thank Milan Stanko and Mathias Bellout for their collaboration, discussions and motivation during the internship.\nTo my family Ruy, L\u00facia, Paula, and M\u00e1cio for their support and unconditional love, which kept me motivated to reach the end. To \u00edtala for her love, daily care, and partnership in every step of the PhD, including the move to Norway.\nTo my colleagues and fellows from the Group of Systems Optimization (GOS), specially Agustinho (in memoriam), Caio, Leonardo, Marco, Hulse, Lauvir, Ricardo, Benetti, Bryant, Jean, Igor and Amanda, i am very grateful for the collaboration, discussions and for making the working environment so enjoyable.\nAt last but not least, to my true friends, in particular Vanderlei, Shirlei, Rattus, Leo, Larissa, M\u00e1rio, Sidnea, Vit\u00f3ria for their companionship in special moments of my life.\n\u201cMathematics, rightly seen, possesses not only truth but supreme beauty\u201c, Bertrand Russell.\nRESUMO ESTENDIDO\nA abordagem tradional para operar uma plataforma de petr\u00f3leo consiste na tomada de decis\u00e3o com base em an\u00e1lises de sensibilidade usando ferramentas de simula\u00e7\u00e3o e heur\u00edsticas. Entretanto, esta estrat\u00e9gia pode tem um custo computacional elevado em circunst\u00e2ncias n\u00e3o usuais, al\u00e9m de n\u00e3o assegurarem um modo de opera\u00e7\u00e3o \u00f3timo para a plataforma. Ao inv\u00e9s disso, especialmente com alta varia\u00e7\u00e3o dos pre\u00e7os do petr\u00f3leo nos mercados internacionais, as ind\u00fastrias petrol\u00edferas est\u00e3o investindo no desenvolvimento de estrat\u00e9gias \u00f3timas com o intuito de melhorar as margens de ganho econ\u00f4mico. Uma alternativa que tem ganhado aceita\u00e7\u00e3o na ind\u00fastria \u00e9 a otimiza\u00e7\u00e3o baseada em modelo, a qual pode ser vista como a integra\u00e7\u00e3o de modelos matem\u00e1ticos e algoritmos para a obten\u00e7\u00e3o de ferramentas efetivas de otimiza\u00e7\u00e3o. Esta tese prop\u00f5e modelos e metodologias para a otimiza\u00e7\u00e3o da produ\u00e7\u00e3o de campos de petr\u00f3leo no curto- e longo-prazo.\nNo curto-prazo, as contribui\u00e7\u00f5es s\u00e3o um estudo compreensivo de modelos lineares por partes multidimensionais para otimiza\u00e7\u00e3o da produ\u00e7\u00e3o di\u00e1ria e a modelagem da divis\u00e3o de fluxos em redes de escoamento submarinas de sistemas de produ\u00e7\u00e3o em alto-mar. A primeira consiste de um framework unificado de modelos de lineariza\u00e7\u00e3o por partes para a aproxima\u00e7\u00e3o de fun\u00e7\u00f5es n\u00e3o-lineares multidimensionais relacionadas a processos de produ\u00e7\u00e3o petr\u00f3leo. Com o uso destes modelos, o problema n\u00e3o-linear de otimiza\u00e7\u00e3o da produ\u00e7\u00e3o se torna um problema de programa\u00e7\u00e3o linear inteira-mista, para o qual algoritmos especializados e solvers comerciais conseguem obter solu\u00e7\u00f5es \u00f3timas de forma eficiente. Foram realizadas an\u00e1lises computacional e de simula\u00e7\u00e3o para avaliar a efici\u00eancia e qualidade de aproxima\u00e7\u00e3o dos modelos em um campo de petr\u00f3leo sint\u00e9tico constru\u00eddo em um simulador de escoamento multif\u00e9sico comercial.\nA segunda contribui\u00e7\u00e3o consiste de um modelo para divis\u00e3o de fluxos em redes de escoamento submarinas. Apesar de se tratar de uma pr\u00e1tica recorrente em opera\u00e7\u00f5es em alto-mar, onde os po\u00e7os podem estar conectados \u00e0s unidades de processamento por m\u00faltiplas rotas, modelos de otimiza\u00e7\u00e3o dispomveis na literatura assumem rotas \u00fanicas. Um modelo de roteamento autom\u00e1tico que decide sobre rotas \u00fanicas ou m\u00faltiplas foi desenvolvido e validado contra o processo simulado. O modelo foi empregado na otimiza\u00e7\u00e3o de um campo de petr\u00f3leo sint\u00e9tico, onde as estrat\u00e9gias \u00f3timas com roteamento m\u00faltiplo induziram maior produ\u00e7\u00e3o do que as estrat\u00e9gias com roteamento \u00fanico.\nNo longo-prazo, a contribui\u00e7\u00e3o \u00e9 uma metodologia que trata restri\u00e7\u00f5es referentes \u00e0 rede de escoamento nos problemas de gerenci-\namento de reservat\u00f3rios, particularmente em processos recupera\u00e7\u00e3o avan\u00e7ada por inunda\u00e7\u00e3o de \u00e1gua. Restri\u00e7\u00f5es referentes \u00e0 rede de escoamento e unidade de processamento s\u00e3o tipicamente limitadas ou desconsideradas nas pol\u00edticas de gerenciamento de reservat\u00f3rios. O presente trabalho prop\u00f5e a otimiza\u00e7\u00e3o do problema integrado com uma formula\u00e7\u00e3o de m\u00faltiplos tiros, o qual \u00e9 um m\u00e9todo de controle adequado para problemas com m\u00faltiplas restri\u00e7\u00f5es em vari\u00e1veis de sa\u00edda de simula\u00e7\u00f5es. A metodologia foi empregada na otimiza\u00e7\u00e3o de um reservoir bif\u00e1sico produzindo para uma rede de escoamento com restri\u00e7\u00f5es n\u00e3o-lineares referentes \u00e0 opera\u00e7\u00e3o de bombas submers\u00edveis el\u00e9tricas. A capacidade do m\u00e9todo de lidar com as restri\u00e7\u00f5es de rede foi avaliada comparando-se os resultados obtidos com a abordagem que considera restri\u00e7\u00f5es de rede com os resultados das abordagens tradicionais, as quais negligenciam o sistema de escoamento em rede. As contribui\u00e7\u00f5es do trabalho, vistas sob a \u00f3tica de opera\u00e7\u00f5es integradas, podem dar suporte a engenheiros de produ\u00e7\u00e3o e reservat\u00f3rio em processos de tomada de decis\u00e3o em campos de petr\u00f3leo do mundo real.\nPalavras-chave: Otimiza\u00e7\u00e3o da produ\u00e7\u00e3o no curto-prazo e longo-prazo. Modelos Lineares por Partes Multidimensionais. Divis\u00e3o de Fluxos em Redes de Escoamento. Restri\u00e7\u00f5es de Rede em Gerenciamento de Reservat\u00f3rios.\nABSTRACT\nThe traditional approach for the operation of an oil platform has been to make decisions based on sensitivity analysis using simulation software and heuristics. However, this strategy can be rather timeconsuming and does not necessarily ensure an optimal production policy. Instead, oil companies are investing towards the development of optimal strategies in order to improve economic margins. An alternative that is gaining acceptance in the industry is model-based optimization, which may be seen as the integration of mathematical models with algorithms into effective optimization tools. This dissertation proposes models and optimization tools for production optimization of oil fields in the short-term and long-term horizons.\nIn the short-term, the contributions are a comprehensive study of multidimensional piecewise-linear models for daily production optimization and the modeling of flow splitting in subsea gathering networks. Because much of the literature was scattered, the first contribution consists of a common framework with the existing multidimensional piecewise-linear models for nonlinear function approximations appearing in oil production processes. Such models allow to transform the nonlinear production optimization problem into a mixed-integer linear program, for which off-the-shelf solvers can obtain optimal solutions. Computational and simulation analyses are performed to evaluate the efficiency and approximation quality of these models for a realistic oil field built in a commercial multiphase flow simulator. The second contribution consists of a model for flow splitting in subsea gathering networks. Despite being a common practice in offshore operations, where the wells can be connected to processing facilities by multiple routes, previous optimization models assumed single routes. An automatic routing model which decides upon single or multiple routing was developed and validated against simulation software. The model was further employed in the optimization of a synthetic oil field, where the optimal strategies with flow splitting yielded higher production rates than single-routed ones.\nIn the long-term, the contribution is a methodology to handle network output constraints in reservoir management problems, particularly in water-flooding processes. Since full-field implicit simulations are prohibitively costly, reservoir management policies are typically developed with standalone reservoir models, while the constraints regarding the network are limited or fully disregarded. We propose to optimize the integrated problem with a multiple shooting formulation, which is a control method suitable for problems with numerous output constraints.\nThe methodology is employed in the optimization of a two-phase blackoil reservoir producing to a gathering network with nonlinear constraints regarding the operation of electrical submersible pumps. The method\u2019s capability to handle network constraints is assessed by constrasting its results against conventional approaches which neglected the gathering network system. These contributions, seen from the integrated operations perspective, may support production and reservoir engineers in decision making processes of real-world fields.\nKeywords: Short- and Long-term Production Optimization. Multidimensional Piecewise-Linear Models. Flow Splitting in Gathering Networks. Network Constraints in Reservoir Management.\nLIST OF FIGURES\n1.1\tThe field life cycle and typical cumulative cash flow [1].\t30\n1.2\tMultilevel control hierarchy. Adapted from [2]................ 32\n2.1\tGas-lifted production system with multiple well-manifold\nroutes........................................................ 39\n2.2\tStructure of the production network........................... 42\n2.3\tNonlinear functions involved in the oil production process. 44\n2.4\tOne-dimensional PWL Function.................................. 46\n2.5\tTwo-dimensional PWL function.................................. 47\n2.6\tJ1 triangulation domain....................................... 47\n2.7\tProduction system network with gas-lifted wells............... 59\n3.1\tFlow splitting illustration................................... 71\n3.2\tGas-lifted well in pipesim.................................... 76\n3.3\tIllustrative Scenario Modeled with\tPipesim.................... 77\n3.4\tSplitting simulation analysis................................. 78\n3.5\tIllustrative offshore gas-lifted field........................ 80\n3.6\tProduction system network with gas-lifted wells............... 89\n3.7\tProcedure to refine piecewise-linear functions................ 91\n4.1\tESP-lifted well [3]...........................................106\n4.2\tESP operating envelope........................................107\n4.3\tIllustrative gathering network................................109\n4.4\tSoftware Architecture ........................................120\n4.5\tReservoir Model...............................................122\n4.6\tProduction gathering network..................................123\n4.7\tWell control refinement.......................................127\n4.8\tOutput of heuristic for p5....................................128\n4.9\tOptimal NPV values network unconstrained and constrained scenarios......................................130\n4.10\tESP constraints of well p5...................................131\n4.11\tOptimal NPVs for the network unconstrained and constrained scenarios......................................132\n4.12\tESP constraints of well p5...................................133\nA.1\tNetwork unconstrained: injection profile\tof wells i1 and i2.141\nA.2\tNetwork\tunconstrained:\tproduction profile of well\tp1.\t.\t.\t142\nA.3\tNetwork\tunconstrained:\tproduction profile of well\tp2.\t.\t.\t142\nA.4\tNetwork\tunconstrained:\tproduction profile of well\tp3.\t.\t.\t143\nA.5\tNetwork\tunconstrained:\tproduction profile of well\tp4.\t.\t.\t143\nA.6\tNetwork\tunconstrained:\tproduction profile of well\tp5.\t.\t.\t144\nA.7 Network constrained: injection profile of wells i1 and i2.\t144\nA.8 Network constrained: production profile of well p1. ... 144\nA.9 Network constrained:\tproduction\tprofile\tof\twell p2.\t.\t.\t.\t145\nA.10 Network constrained:\tproduction\tprofile\tof\twell p3.\t.\t.\t.\t145\nA.11 Network constrained:\tproduction\tprofile\tof\twell p4.\t.\t.\t.\t146\nA.12 Network constrained:\tproduction\tprofile\tof\twell p5.\t.\t.\t.\t146\nA.13 Greedy strategy: injection profile of wells i1 and i2. . . . 146\nA.14 Greedy strategy:\tproduction\tprofile\tof\twell pl........147\nA.15 Greedy strategy:\tproduction\tprofile\tof\twell p2........147\nA.16 Greedy strategy:\tproduction\tprofile\tof\twell p3........148\nA.17 Greedy strategy:\tproduction\tprofile\tof\twell p4........148\nA.18 Greedy strategy:\tproduction\tprofile\tof\twell p5........149\nLIST OF TABLES\n2.1\tWell parameters............................................ 60\n2.2\tFormulation Size........................................... 61\n2.3\tHypercube Approximation: High Gas-Compression Capacity ............................................... 62\n2.4\tHypercube Approximation: Medium Gas-Compression Capacity ............................................... 62\n2.5\tHypercube Approximation: Low Gas-Compression Capacity ............................................... 63\n2.6\tSimplex Approximation: High Gas-Compression\tCapacity\t63\n2.7\tSimplex Approximation: Medium Gas-Compression Capacity ............................................... 64\n2.8\tSimplex Approximation: Low Gas-Compression\tCapacity\t64\n2.9\tHypercube Approximation............................. 65\n2.10\tSimplex Approximation.............................. 66\n2.11\tOptimal solution per well with a fine simplex resolution\t66\n2.12\tOptimal solution per well with a fine hypercube\tresolution\t67\n3.1\tSimulation Analysis of Splitting.................... 79\n3.2\tSets of automatic routing MILP model................ 81\n3.3\tParameters of automatic routing MILP model.......... 82\n3.4\tVariables of automatic routing MILP model........... 82\n3.5\tFunctions of automatic routing MILP model........... 83\n3.6\tWell parameters for flow splitting analysis......... 89\n3.7\tWell-production approximations...................... 92\n3.8\tJumper pressure drop approximations................. 92\n3.9\tPressure drop approximations in the flowlines....... 92\n3.10\tComputational results.............................. 94\n3.11\tOptimal solution per well for the single and automatic\nrouting models with high gas-lift availability. ........... 94\n3.12\tOptimal flow distribution in the single and automatic\nrouting models with high gas-lift availability. ........... 95\n4.1\tNetwork Graph Sets.........................................108\n4.2\tNetwork simulation variables ..............................109\n4.3\tOil Relative Permeabilities................................121\n4.4\tReservoir parameters.......................................122\n4.5\tPipeline features..........................................123\n4.6\tNPVs obtained with long-term and greedy strategies . . 132\nAD Automatic Differentiation ..............................106\nAMPL A Mathematical Programming Language................ 48,\t81\nBHP Bottom-Hole Pressure....................... 119, 120, 126\nCC Convex Combination....................... 39, 49-52, 64, 79\nCLRM Closed-Loop Reservoir Management...................... 86\nDCC Disaggregated Convex Combination .\t36, 37, 49-52, 64, 79\nDLog Logarithmic Disaggregated Convex Combination . 37, 38, 49-52, 64\nEOS Equation of State ..................................... 92\nESP Electrical Submersible Pump .... ix, 88, 93-95, 103-105, 108-114, 116-119, 121, 122, 124, 126\nFD Finite Differences......................................106\nFDP Field Development Plan................................. 19\nFP Feasibility Pump........................................114\nFPSO Floating Production\tStorage and Offloading............ 68\nGLR Gas-Liquid Ratio ....................... 59-61, 65, 76, 77\nGOR Gas-Oil Ratio.......................................... 48\nHIPPS High-Integrity Pressure Protection System ....\t70, 74\nID Inner Diameter................................... 47,\t48, 76\nIMPES IMplicit Pressure-Explicit Saturation................ 91\nInc incremental........................... 43,\t45, 49, 51, 52, 64\nIO Integrated Operations................................... 17\nLog Logarithmic Convex Combination . 40, 41, 49, 51, 52, 55, 64, 125\nMC Multiple Choice.......................... 41, 42, 49-52, 64\nMILP Mixed-Integerar Linear Programming xi, 25, 31, 33, 34, 36,\n47-49, 55-58, 61, 62, 65, 69-73, 81, 83, 84, 125\nMINLP Mixed-Integer Nonlinear Programming 26, 31, 33, 56, 125\nMPWL Multidimensional Piecewise-Linear 25, 26, 56, 84, 123-126\nMRST Matlab Reservoir Simulator Toolbox.................. 90,\t91\nMS Multiple Shooting.............. 87, 88, 100, 102, 122, 125, 126\nNPV Net Presente Value . ix, xi, 85, 86, 100, 101, 113, 114, 118, 120, 122, 123\nODE Ordinary Differential Equation . . . 105, 106, 108, 122, 126\nPI Productivity Index........................................ 65\nPWL Piecewise-Linear ix, 33-36, 42, 49, 50, 53, 66, 70-72, 74, 75,\n78, 79, 84\nR Roughness....................................... 47, 48, 76\nREMSO REduced Multiple Shooting Optimizer ....\t108, 115\nrSQP reduced Sequentially Quadratic Programming 102, 115, 121, 122, 126\nSOS2 Special Ordered Sets of Type 2 33, 35, 40, 45, 46, 49-51, 55,\n62, 63, 70, 71, 79, 81, 125\nSQP Sequentially Quadratic Programming ................ 117,\t126\nSS Single Shooting.......................................86,\t100\nWCUT Water Cut................................ 48,\t60, 65, 76, 77\nCONTENTS\n1\tIntroduction\t29\n1.1\tMotivation......................................... 29\n1.2\tResearch Objectives................................ 33\n1.3\tOutline of Contributions and Organization.......... 33\n2\tPiecewise-Linear Approximation for Short-Term Produc-\ntion\tOptimization\t37\n2.1\tIntroduction....................................... 37\n2.2\tProblem Context.................................... 38\n2.3\tProblem Formulation................................ 40\n2.4\tLiterature Review.................................. 43\n2.5\tPiecewise-Linear Approximation..................... 45\n2.5.1\tBrief Introduction to Piecewise-Linear Models\t46\n2.5.2\tDisaggregated Convex Combination Models\t.\t48\n2.5.3\tMultiple Choice Model..................... 53\n2.5.4\tIncremental Model ........................... 55\n2.5.5\tSOS2 Model................................ 57\n2.6\tModeling and Analysis.............................. 59\n2.6.1\tProduction System......................... 59\n2.6.2\tComputational Analysis ...................... 60\n2.6.3\tSimulation Analysis....................... 64\n2.6.4\tDiscussion................................ 66\n2.7\tSummary and Synthesis of Contribution.............. 67\n3\tModeling of Flow Splitting in Gathering Networks\t69\n3.1\tIntroduction....................................... 69\n3.2\tFlow Splitting Modeling and Validation ............ 70\n3.2.1\tNonlinear Model........................... 71\n3.2.2\tPiecewise-Linear Approximation............ 73\n3.2.3\tSimulation-Based Validation............... 76\n3.3\tApplication to Production Optimization............. 80\n3.3.1\tMixed-Integer Linear Programming Model .\t.\t81\n3.4\tModel Synthesis and Computational Analysis ....\t88\n3.4.1\tThe Gas-Lifted Oil Production System ....\t88\n3.4.2\tModel Synthesis.............................. 90\n3.4.3\tComputational Analysis ...................... 93\n3.5\tSummary and Synthesis of Contribution.............. 95\n4\tNetwork Constrained Reservoir Optimization\t97\n4.1\tIntroduction....................................... 97\n4.2\tBrief Literature Review............................100\n4.3\tPetroleum Production Process.......................100\n4.3.1\tReservoir Model..............................101\n4.3.2\tNetwork Model................................103\n4.4\tReservoir Control Optimization.....................112\n4.4.1\tMultiple Shooting Formulation................112\n4.4.2\tNetwork Constraints.........................114\n4.4.3\tPressure Drop Sensitivities.................117\n4.4.4\tAdjoint Sensitivity Analysis................118\n4.5\tNumerical and Simulation Analysis..................120\n4.5.1\tReservoir Description.......................121\n4.5.2\tProduction Gathering Network ...............122\n4.5.3\tOptimization Problem Statement..............125\n4.5.4\tHeuristic for a Feasible Start..............126\n4.5.5\tCase Studies................................129\n4.6\tConcluding Remarks.................................133\n4.7\tSummary and Synthesis of Contribution..............134\n5\tConcluding Remarks\t135\n5.1\tSummary of Contributions...........................136\n5.2\tFurther Developments ..............................138\nAppendix A - Detailed results of\tChapter 4\t141\nReferences\t151\n1\tINTRODUCTION\n1.1\tMOTIVATION\nAlthough technological advances have increased the diversity of energy resource alternatives, fossil energy remains a primal source of energy in the modern world. Over the past decades, petroleum companies have fostered advances on monitoring tools and data sensoring technology to provide means to calibrate process models and support engineers in decision making processes. However, with high oil prices, the margins were large and companies had limited incentives to invest towards the development of optimal strategies. The current decrease in oil prices should drive oil companies to apply advanced methods, in particular mathematical optimization, in order to improve long term and short term margins.\nA host of innovations have been considered to improve operations and the ultimate recovery of oil fields including advanced simulation, downhole sensors, remote control devices, and real-time information systems which are collectively referred to as Smart Fields [4, 5]. These modern fields are being deployed with the aim to drive production and economic gains by effectively integrating subsea equipment with the technology available in the platforms in order to develop efficient plans and reduce operational costs. Because Smart Fields is an evolving technology, engineers still rely on sensitivity analysis using simulation software and heuristics to decide upon the operational plans and respond to unanticipated events, such as compressor failure and pipeline clogging. However, this strategy can be rather time-consuming and does not necessarily ensure a mode of operation that enhance oil production and therefore the value of assets.\nAn alternative that is gaining acceptance in the industry is model-based optimization, which may be seen as the integration of mathematical models with algorithms into effective optimization tools. These approaches can be effective provided that process models are routinely updated with field data to reflect the prevailing system conditions. Although recent technology has enabled frequent model updates, the practical use of model-based optimization demands integrated decisions for processes with different time-scales and complexities. For instance, while reservoir engineers make decisions using mathematical models governed by partial differential equations, which simulate the dynamics of fluids in porous media, production engineers typically adopt mixed-integer programming models to decide daily operational plans for the platform. Therefore, the challenge today is on the development of models and optimization tools for Integrated Operations (IO) that can conciliate different processes and technologies.\nThe impact of mathematical models and tools in IO decisions may be seen from the broader perspective of the field life cycle. The life cycle of a petroleum field can be divided in several multi\ndisciplinary activities carried out at the various stages of field development, as depicted in Figure 1.1. The figure depicts the typical\no\nE \u00ab3\n5\np\ncn\ncd\no\n0)\nZ5\nE\nZ5\no\n500\n400\n300\n200\n100\n0\n-100\n-200\n-300\n-400\n-500\nTime (years)\n! 10 11 12 13 14 15 16 17 18 1920 21 2:\n1 2 3 4 5\nFigure 1.1: The field life cycle and typical cumulative cash flow [1].\ncumulative cash flow in each phase of the field life cycle. Notice that initially the cash flow is negative, and only after the production phase starts it becomes positive. The field life cycle can be divided in the following phases:\n1.\tGaining Access.\nThe first step taken by an oil company is the decision about what regions are worth for production and exploration of hydrocarbons. For this decision, an evaluation of technical, political, economic, and environmental aspects of the regions under consideration need to be performed to decide upon the acquisition of the rights for exploration of the reserves. Some important issues related to this decision are determining the potential size of hydrocarbons to found and produced in the region and technical challenges for exploration and production of hydrocarbons. If the risk analysis indicates that the region has a good potential to make profit for the company, the licensing contract is signed with the local government to explore the area for a certain amount of time and the fiscal regime are also defined in this phase.\n2.\tExploration Appraisal.\nThe exploration phase is a high-risk activity that starts after licensing and gaining access of a region of interest. In this phase, geological and seismic surveys are developed and contrasted against the political and fiscal conditions of the country to determine the probability of success of exploration ventures. Once the presence of hydrocarbons has been confirmed by an\nexploration well, an appraisal program is carried out with the drilling of further wells with the aim of a better description and accurate estimation of the resources in place. The appraisal continues until enough information and data is gathered to develop a feasibility study in order to determine if at least one development plan is profitable, or to conclude that the area is not economically viable.\n3.\tDevelopment.\nBased on the feasibility study, if the area is economically viable, a Field Development Plan (FDP) is put in practice. The main goal of this phase is to design the project specification for the subsurface and surface facilities, the operational plans, and a proposal for the required investments. Once the FDP is approved, a detailed design, fabrication, installation of the facilities follows, procurement of the materials of construction, even as the commissioning of all plant and necessary equipment.\n4.\tProduction.\nThis phase starts when the first commercial quantity of hydrocarbons flows through the well-head. It marks a turning point in the cash flow since now some profit is made with oil selling on the market to pay back the prior investments. Based on all information gathered up to the first oil appears, development planning and production are developed based on the expected production profile of the field, which typically depends on the mechanism providing the driving force in the reservoir. The production profile is characterized by three phases:\n\u2022\tBuild-up period: as the facilities are progressively installed, recently drilled wells start to produce to the stream going to the platform.\n\u2022\tPlateau period: when the installations are complete, a plateau production is reached and the field produce to its maximum capacity, ideally for as long as possible.\n\u2022\tDecline period: as the field matures, field production starts to decline and the field remains active until the cash flow is not favorable anymore.\n5.\tDecommissioning.\nThe field is decommissioned when the net cash flow becomes permanently negative, i.e., the incomes are not sufficient to cover operating costs. In this phase, the facilities are disposed so that the environmental impact is minimized and unnecessary expenditures are avoided. In some cases, opportunities may be available to explore nearby reserves using the existing\ninfrastructure, but management the decommissioning costs is an issue that most companies will have to face at some point.\nAlthough each stage may look independent, the decisions of each phase impact significantly in the next phases. The decisions of the development phase, for instance, may impact in the reservoir recovery strategy. These decisions are traditionally supported by numerical reservoirs simulators, which are used to forecast recovery processes of given production schemes and the impact of changes in well operating conditions. However, once the development phase is finished, the reservoir recovery optimization is limited by the facilities that are already installed in the field.\nThe decisions of the field life cycle can be conceptually divided in several layers depending on the time frame, as shown in Figure 1.2. The top layer concerns the asset management decisions which focus on reducing investments and minimizing risks of the field operation for the life cycle of the reservoir. Reservoir management decisions\nFigure 1.2: Multilevel control hierarchy. Adapted from [2].\nData aquisition Control inputs system\nseek to improve the recovery factor in the medium and long-term horizons, which extend from months to a couple of years. Such decisions involve drainage strategies, infrastructure development plans, well design and placement in the reservoir, production and injection target rates for the wells. Production optimization is the layer below which seeks for platform settings on daily or weekly operations that maximize the field performance while the operational constraints are satisfied. Shorter-term operational decisions regarding the control and automation of the platform aim to keep operations stable and mitigate disturbances. This requires feedback control of field pressures, flow rates and temperatures in a range from seconds to hours, being performed automatically without human intervention.\n1.2\tRESEARCH OBJECTIVES\nThe decisions regarding the operation of the wells are disputed since they are performed by both reservoir and production engineers, often with rather different operational strategies. On the one hand, reservoir engineers seek for optimized well controls that maximize the reservoir oil recovery for the long-term horizon, while production engineers typically have the goal to produce as much as possible in every depletion state of the reservoir. To this end, this dissertation focuses on the interface between reservoir management and production optimization layers, considering the impact that operational constraints, on the gathering network and surface facilities, will have on reservoir and daily production optimization. The main challenge lies on the integration of these two different layers given their different time scales and heterogeneous simulation tools.\nThe research objective of this dissertation is to develop optimization models and methodologies for short-term and long-term production optimization of oil fields. In the short-term, the dissertation presents a comprehensive study of multidimensional piecewise-linear models for daily production optimization and the modeling of flow splitting in production gathering networks of offshore systems. In the long-term, a methodology is proposed to consider network constraints in reservoir management problems, particularly in water-flooding processes. These results, seen from the standpoint of integrated operations, may be used to support production and reservoir engineers in decision making processes of real-world fields.\n1.3\tOUTLINE OF CONTRIBUTIONS AND ORGANIZATION\nAn outline and main contributions of this dissertation follows:\n\u2022\tChapter 2 contains a unified framework for piecewise-linear approximation of nonlinear functions with application to shortterm production optimization. This contribution was motivated by the need of standard representation of multidimensional piecewise-linear models, allowing their application and comparative analysis in short-term production optimization. Much of the literature was scattered and not presented under a common framework. The unified framework for piecewise-linear approximation considered all the existing multidimensional models.\n\u2022\tChapter 3 presents a nonlinear model of flow splitting in pipelines and suitable approximations for mathematical optimization. Splitting of flows have become common practice in the industry, particularly in offshore operations in which wells are connected to processing equipment by multiple routes. Despite\nthis common practice, the previous optimization models available in the literature assumed single routes. Piecewise-linear proxy models were proposed for modeling flow splitting and further validated against simulation models.\n\u2022\tChapter 4 proposes a methodology for network-constrained reservoir production optimization. To date, the existing methodologies for long-term reservoir production optimization rely on simple models to account for network constraints. The deployment of modern inflow control devices creates degrees of freedom in the production gathering network, enabling the use of methodologies that ensure reservoir control policies that feasible with respect to the network and processing facilities. A multiple-shooting strategy to optimize oil reservoirs was extended to simultaneously account for network constraints. Effectively, the reservoir equations, the network flow and pressure constraints, and the well-inflow models were explicitly represented in the multiple shooting formulation.\nAt the end, Chapter 5 presents a conclusion for this dissertation with a summary of achievements and perspectives for future research. Chapters 2, 3, and 4 are based on the following selected publications:\n\u2022\tSilva, T. L.; Codas, A.; Camponogara, E. (2012): \u201cA Computational Analysis of Convex Combination Models for Multidimensional Piecewise-Linear Approximation in Oil Production Optimization\u201d. In: Proceedings of the IFAC Workshop on Automatic Control in Offshore Oil and Gas Production, Trondheim, Norway, 2012.\n\u2022\tSilva, T. L.; Camponogara, E.; Teixeira, A. F.; Sunjerga, S. (2013): \u201cA Mixed-Integer Linear Programming Model for Automatic Routing Decisions in Oil Production Optimization\u201d. In: Proceedings of IEEE International Conference on Automation Science and Engineering (CASE), Madison, USA, 2013.\n\u2022\tSilva, T. L.; Camponogara, E. (2014): \u201cA Computational Analysis of Multidimensional Piecewise-Linear Models with Applications to Oil Production Optimization\"\". European Journal of Operational Research, v. 232 (3), pp. 630-642.\n\u2022\tSilva, T. L.; Camponogara, E.; Teixeira, A. F.; Sunjerga, S. (2015): \u201cModeling of Flow Splitting for Production Optimization in Offshore Gas-Lifted Oil Fields: Simulation Validation and Applications\u201d. Journal of Petroleum Science and Engineering, v. 128, pp. 630--642.\n\u2022\tSilva, T. L.; Codas, A.; Stanko, M.; Camponogara, E.; Foss, B. A. (2016): \u201cNetwork Constrained Reservoir Optimization\"\".\n1.3.\tOutline of Contributions and Organization\n35\nSubmitted to SPE Reservoir Evaluation Engineering Journal on June 2017.\nIn addition to the publications that form the basis of this dissertation, the author has contributed in other publications during the PhD studies:\n\u2022\tAguiar, M. A. S. ; Camponogara, E. ; Silva, T. L. \u201cA Mixed-Integer convex formulation for production optimization of gas-lifted oil fields with routing and pressure constraints. In: Brazilian Journal of Chemical Engineering (print version), v. 31, p. 439-455, 2014.\n\u2022\tNeto, L. R.; Camponogara, E.; Hardt, R. ; Silva, T. L. \"\"A piecewise linear-quadratic approximation for production optimization of gas-lifted oil fields. In: IEEE International Conference on Automation Science and Engineering (CASE), Gothenburg, p. 793-798, 2015.\n\u2022\tCamponogara, E. ; Teixeira, A. F.; Hulse, E. O.; Silva, T. L.; Sunjerga, S.; Miyatake, L. K. \u201cAn integrated methodology for production optimization from multiple offshore reservoirs in the Santos Basin\"\". In: IEEE Transactions on Automation Science and Engineering, v, 14 (2), p. 669-680, 2017.\n2\tPIECEWISE-LINEAR APPROXIMATION FOR SHORT-TERM PRODUCTION OPTIMIZATION\nProduction optimization of gas-lifted oil wells under facility, routing and pressure constraints is a challenging problem, which has attracted the interest of operations engineers aiming to drive economic gains and scientists for its inherent complexity. The hardness of this problem rests on the non-linear characteristics of the multidimensional well production and pressure drop functions, as well as the discrete routing decisions. To this end, this Chapter develops several Mixed-Integerar Linear Programming (MILP) formulations using Multidimensional Piecewise-Linear (MPWL) models to approximate the non-linear functions. Computational and simulation analyses are performed considering a synthetic but realistic oil field modeled with a multiphase-flow simulator. The purpose of the analyses is to assess the relative performance of the MILP formulations and their impact on the simulated oil production. Most MPWL approximations and the computational analyses which are discussed in this Chapter were developed in the master\u2019s dissertation of Silva[6]. During the Ph.D. studies, the main contribution was the multidimensional approximation based on the Incremental model and a simulation analysis of all MPWL approximations against a commercial multiphase flow simulator. Further, a journal paper compiling all results was written during the first year of the doctoral studies. This Chapter is based on the following papers:\n\u2022\tSilva, T. L.; Codas, A.; Camponogara, E. (2012): \u201cA Computational Analysis of Convex Combination Models for Multidimensional Piecewise-Linear Approximation in Oil Production Optimization\u2019\u2019. In: Proceedings of the IFAC Workshop on Automatic Control in Offshore Oil and Gas Production, Trondheim, Norway, 2012.\n\u2022\tSilva, T. L.; Camponogara, E. (2014): \u201cA Computational Analysis of Multidimensional Piecewise-Linear Models with Applications to Oil Production Optimization\u2019\u2019. European Journal of Operational Research, v. 232 (3), pp. 630-642, 2014.\n2.1\tINTRODUCTION\nIn response to the increasing demand for petroleum and highly competitive markets, oil companies have been investing in innovative technologies to increase production and cut operational costs. Today, offshore platforms are being equipped with remote measuring sensors and real-time control, optimization and information systems. The oilfields that employ these technologies are often referred to as Smart Fields [7]. Smart Fields technologies provide field data that are valuable for tunning simulation models to reproduce the\nobserved behavior. With reliable simulation models, production engineers can develop daily operational plans and respond effectively to unanticipated contingencies. However, significant challenges in science and technology should be overcome before Smart Fields becomes a widely applied technology.\nIn existing oil fields, operational plans are reached promptly often based on a sensitivity analysis that uses simulation tools and heuristics. Even though these methods can obtain good operational plans, they do not necessarily ensure a mode of operation that maximizes the daily production, which may incur losses to the company. On the other hand, mathematical programming methods can be used to help production engineers to reach optimal daily operational plans.\nThe optimization of offshore production units entails modeling and solving MINLPs that represent the underlying complex phenomena involved in oil production, flow and processing. Owing to the complex nonlinear functions and discrete variables, the direct solution of MINLPs that arise in oil production optimization is not effective, giving rise to the need of computationally tractable approximations. This dissertation investigates at great length the approximation of such nonlinear functions with multidimensional piecewise-linear models. In order to assess the implications and performance of the multidimensional models, a representative simulation scenario is considered for the computational and approximation analysis.\nThis Chapter begins by stating the MINLP that consists in defining the lift-gas injection rates of the wells and the routing of wells to manifolds, while meeting physical and technological constraints. In the sequence, a brief literature review of mathematical programming methods for short-term production is presented. Then, a review of existing MPWL models is developed for general functions, in particular, for two-dimensional well production curves. The results of computational and simulation analyses are then reported. Finally, it is presented a synthesis of the contribution of this Chapter to the modeling and optimization of production units of oil fields.\n2.2\tPROBLEM CONTEXT\nA typical offshore gas-lifted production system consists of: (i) a reservoir which is the porous media containing the hydrocarbons to be produced; (ii) production wells which transfer the fluids from the reservoir to gathering network; (iii) a subsea manifold which is responsible for gathering and transferring the well flows to the surface facilities; (iv) the flowlines and pipelines; (v) processing facilities which separate the multiphase flow in oil, gas and water; and (vi) compressors which pressurize the gas to be used as an artificial\nlift method. Figure 2.1 depicts a production system with a reservoir, five production wells, manifolds, and the processing facilities. The\nProcessing system\nCompressor\tf\nSeparated gas\nManifolds\n)il-Watejr\nRouting valves\n\u2014eSh\u2014\n\u2014\n\u2014e5<k---bb+i\nOil + Water + Gas\n\nGfs-lift\nWater treatment unit\tO\n\u2014-cSb\n\u2014\n---c3=b\n\u2014>b}\nInjection chokes\no o o o o\nReservoir\nFigure 2.1: Gas-lifted production system with multiple wellmanifold routes.\nrouting valves in between the wells and the manifolds are on-off control valves which are used to select fluid routes. The production entering the separator is processed and the outlet gas is pressurized by the compression unit before gas-lift injection. The gas-lift rates are controlled through valves, namely the injection chokes. The oil is stocked in tanks before exportation and the water is sent to a treatment unit for disposal.\nThe production is limited by the pressure in the reservoir, the productivity of the wells and by the capacities in the processing facilities such as compression limits, water treatment capacity, and liquid handling capacity. Along the daily operation, a set of decisions should be taken by the operators while honoring such limitations in order to maximize the oil production. Among such decisions are the choke openings, the well-manifold routings and the gas-lift rate delivered to each well. Although sensitivity analyses may help engineers in the decision making, mathematical programming tools are suitable to optimize the production system even under unusual operating conditions.\n2.3\tPROBLEM FORMULATION\nThe problem of optimizing the daily production of a gas-lifted oil field taking into account constraints on lift-gas availability, separation capacity, well-manifold routing, and pressure constraints can\nformulated as a mixed-integer non-linear program:\t\nPOP : max f =\tg(qm) -\tc(q\u00a1n)\t(2.1a)\n\t\nS.t. :\tqn\tq\t'\t(2.1b)\nn\\in\\scrN\t\nFor all n \\scrN :\t\nn.min\tn\tn.max q ,\tyn\tq\\mathrm{i}\tyn\t(2.1c)\nzn,m\tyn\t(2.1d)\n\t\n\\bfqn,m = qn>m(pm,qn)zn,m, \\forallm\t\\scrMn\t(2.1e)\nZn,mqn,L\t\\bfqn,m\tZn,mqn\u2019U, \\forallm\t\\scrMn\t(2.1f)\n\\bfqm =\t\\bfqn\u2019m\t\\scrM\t(2.1g)\n\t\npm = pm\u2019s + Apm(qm), \\forallm \\in\\scrM\t(2.1h)\npm,min\tpm\tpm,max\t(2.1i)\nyn\t{0,1}, \\foralln \\in\\scrN\t(2.1j)\nZn,m\t\\{0, 1}, \\foralln\t\\scrN, \\forallm \\scrMn\t(2.1k)\nwith decision variables for optimization being:\n\u2022\tq\u2122 is the lift-gas rate injected into well n;\n\u2022\tyn takes on value 1 when well n is producing and 0 otherwise.\n\u2022\tzn,m assumes value 1 if the production of well n is directed to manifold m, and 0 otherwise;\n\u2022\tqh\u2019m is the flow of phase h \\in\\scrH directed from well n to manifold m, and qn,m = (qh'm : h \\scrH) is the vector of all phase flows;\n\u2022\t=\t\u00a3 qn\u2019m is the total flow received by manifold m;\n\u2022\tpm is the pressure of manifold m;\nwith parameters:\n\u2022\tN is the number of oil wells, \\scrN = {1,..., N}, and \\scrNm \\subseteq \\scrN is the subset of wells whose production can be directed to manifold m;\n\u2022\tM is the number of manifolds, \\scrM = \\{1,..., M} and \\scrMn \\subseteq \\scrM is the subset of manifolds that can receive production from well n. The production of each manifold is processed by a dedicated separator;\n\u2022\t\\scrH = {o, g, w} has the phase flows, namely oil (o), gas (g), and water (w);\n\u2022\tq;max models the lift-gas that can be delivered by the compression station;\n\u2022\tq\u201d\u2019mm and q\u201d,max are bounds on the lift-gas injection for well n typically used to ensure production stability, avoid slugging, and follow a recovery policy for the reservoir;\n\u2022\tpm,s is the operational pressure of the separator connected to manifold m;\n\u2022\tq\u201d,L and qn,u are vectors with lower and upper bounds on the production of well n;\n\u2022\tqm,s is the processing capacity of the separator of manifold m;\n\u2022\tpm,mm (pm,max)\tm\\mathrm{i}n\\mathrm{i}mum (maximum) operational pres-\nsure for manifold m;\nand with functions:\n\u2022\tf is a function composed by a function g that represents the economic benefit from oil production and a function c which represents the lift-gas injection cost, however any other continuous function can be considered such as the total oil production;\n\u2022\tqh\u2019m(pm, q?)\tfl\u00b0w \u00b0f phase h sent by well n to manifold\nm given as a function of the manifold pressure and lift-gas injection, and \\bfqn,m(pm,q?) = (q?,m(pm,q?) : h \\scrH) is the vector of all phase flows;\n\u2022\tApm(qm) represents the pressure drop in the pipeline connecting manifold m to its adjoint separator.\nAmong the decision variables for optimization, the ones that are actually controlled in the oil field are the well activation decisions yn, the routing decisions zn,m, and the lift-gas rates qf.\nThe nonlinearity in the production optimization problem arises from the nonlinear nature of the well production function qf,m and the pressure drop \\Deltapm in pipelines, which later will be approximated with piecewise-linear models. This problem extends the work of [8] by explicitly modeling pressure drops and considering pressure constraints.\nThe gas compressing capacity and the bound on lift-gas injection for the wells are defined by constraints (2.1b) and (2.1c) respectively.\nThe well-manifold routing constraints (2.1d)-(2.1e) ensure that the production of each well will be sent to precisely one manifold when the well is producing, i.e. yn = 1. The production of well n sent to manifold m is zero if not routed to this manifold, i.e. zn,m = 0, however the production becomes bounded by q\u201d,L and qn,u if well n is routed to manifold m.\nThe operational limits for well production, the mass balance equations, and separation capacity are established by constraints (2.1f) and (2.1g), while the pressure balance between manifolds and separators are given by constraints (2.1h) and (2.1i).\nFigure 2.2: Structure of the production network.\nFigure 2.2 illustrates the structure of the oil production system and the semantics of the decision variables. The available liftgas rate (q\\mathrm{m}ax) is distributed to the active wells (qf : n \\scrN)\nwhich in turn yield multiphase flows that are directed to manifolds (qn,m : n , m \\scrMn) and then to the separators (qm). These flows induce pressure drops in the pipelines (Apm(qm)) which are limited by the separator\u2019s capacity (qm,s).\nThe Mixed-Integer Nonlinear Programming (MINLP) problem given above is a conceptual formulation because the well production and pressure drop relations are not known explicitly. An MINLP approximation may be obtained by fitting nonlinear models to sample data provided by a simulator or real measurements from the oil field. However, the synthesis and validation of such models are themselves a challenge, motivating the development of piecewise-linear models directly from the sample data to yield an MILP approximation. Since the true MINLP is not known, this dissertation will compare the predictions induced by the piecewise-linear schemes against to the corresponding values provided by a simulator. This means that a solution close to the global optimum may be reached by solving the MILP formulation considering a sufficiently high number of sample points.\nThe inherent nonlinearity of the well production curve and the pressure drop function combined with the presence of discrete variables complicates significantly the optimization of daily production problems in oil platforms. From sampled data collected in a commercial multiphase flow simulator, such functions are depicted in Figures 2.3(a) and 2.3(b) respectively. The well production curve represents the liquid flow rate produced by the well as a function of the well-head pressure and the gas-lift rate injected at the bottom of the well. The pressure drop is a function of the phase flows in the pipeline. Both functions are nonconvex and smooth, but might change with different fluid properties and features of well tubings and flowlines of the gathering system.\n2.4\tLITERATURE REVIEW\nAlthough several works have applied mathematical programming methods to obtain optimal production plans [9, 10, 11, 12, 8], only a limited number of works considered pressure drop in pipelines which cannot be neglected when the operating conditions vary due to routing operations and equipment failure, for instance.\nBeggs and Brill [13] were among the first to study the representation of pressure in oil production systems, who proposed correlations between the pressure drop and flow in pipelines. Litvak and Darlow [14] developed analytic and piecewise-linear models for representing pressure equations. The first represents more precisely the physical phenomenon and is routinely used in software for simulating flows in oil production systems. The second technique approximates pressure drops as a function of the outlet pressure and the oil, gas, and water flows.\n5\nWCUT = 10%\n(b) Pressure Drop Function\nFigure 2.3: Nonlinear functions involved in the oil production process.\nMore recent works in oil production optimization considering complex operations, such as routing and pressure drop, can be roughly divided in MINLP and MILP methods. Kosmidis et al. [15] and Kosmidis et al. [16] presented an MINLP optimization formulation of a production network with naturally producing and gas-lifted wells. The MINLP problem is solved by a sequence of MILP problems following a sequential linear programming strategy. On the other hand, Gunnerud and Foss [17] presented an MILP formulation for oil fields structured in clusters of independent wells, manifolds, and pipelines while the separation facilities are centralized in a platform. Piecewise linearization techniques based on Special Ordered Sets of Type 2 (SOS2) constraints are used to approximate nonlinear functions.\nBecause the complex behavior of well production and pipeline pressure drop are not explicitly known, the synthesis of an MINLP problem will entail fitting sample data from a simulator to nonlinear models, a task that itself is challenging and dependent on the space of models considered. On the other hand, piecewise-linear models have the advantage of not needing the synthesis of such relationships, being defined directly from the sample points, a property that motivates the dissertation herein.\nAlthough some works have represented pressure drops with piecewise-linear models, a comprehensive analysis of the existing models for piecewise linearization in oil production optimization is lacking. To this end, this dissertation presents a computational and simulation analysis of piecewise-linear models for hypercube- and simplex-based approximations of the function domains, considering an oil field modeled with a standard multiphase-flow simulator.\n2.5\tPIECEWISE-LINEAR APPROXIMATION\nThe formulation of the gas-lift optimization problem presented in the previous section is non-convex due to the non-linear nature of the well production curves and the flow-line pressure drops. The feasible space for well production can be non-convex regardless of the well production function being concave. Further, the flow-line pressure-drop functions are multidimensional relationships available in phenomenological simulators, making it a challenge to be modeled and used in optimization software even when the relationships are univariate.\nHowever, non-convex piecewise-linear models can be used to approximate such complex non-linear functions, allowing the resulting MILP formulations to be solved by specialized algorithms and off-the-shelf solvers. Usually, the latter approach takes advantage on the first since it benefits from the state-of-the-art technology implemented in the solvers [18]. In this dissertation, we approximate the non-linear functions with Piecewise-Linear (PWL) models and\nsolve the gas-lift distribution problem with an MILP solver.\nThis section starts with a brief introduction to the existing MILP models for multidimensional piecewise-linear approximation and then presents the corresponding MILP approximation formulations of problem P.\n2.5.1\tBrief Introduction to Piecewise-Linear Models\nThe definition of piecewise-linear function is borrowed from [18] who review existing MILP models for piecewise linearization. According to Vielma et al. [18], a continuous function f : T> \u2014> R with compact domain T> C Rd is piecewise-linear if, and only if, there exists a family of polytopes P, such that UpepP = P, {mp}pep C Rd, and {cp}pep, where:\n/(x) = m'pX + cp, Vx G P, P G P\t(2.2)\nLet V(P) be the set of vertices of polytope P and V(P) = Upep V(P) be the set of all vertices.\nFigures 2.4 and 2.5 show one-dimensional and two-dimensional illustrative PWL functions respectively. The domain of the first one is D = [0,4], which is represented by a family of polytopes P = {P!,P2,P3,P4}, where Px = [0,1], P2 = [1,2], P3 = [2,3], and P4 = [3,4], and V(Px) = \\{0,1}, V(P2) = \\{1,2}, V(P3) = \\{2,3},\nFigure 2.5: Two-dimensional PWL function.\n2\n1\t\\ Ps Pi \\\tP12 / /P13\t\\ P21 -?20\t^28 /\tP29\t\n0\tP3 / J/ Ps\t\\P14 P11V\tPio/ P22\t\\p30 -T27 \\\t\n-1\t\t\u25a0Uo/h / \"15\t^\\P23 -Pl 8\t\t\n-2\tPl / / Ps\t\\-P16 P9 \\\tPit/ /P24\t^\\P32 P25\\\t\n\t-2\t-1\t0\t1\t2\nFigure 2.6: J1 triangulation domain.\nand V(P4) = {3,4}, with the graph points \\scrG = {(x, f (x)) : x \\scrD} being \\{(0,8), (1,28), (2,14), (3,25), (4,21)}.\nThe two-dimensional PWL function approximates the non-convex function f (x, y) = e-y + e-x \u2014 x2 + xy \u2014 2y depicted in Figures 2.5 and 2.6. Its domain \\scrD = [\u20142, 2]2 is partitioned in a set of polytopes \\scrP = \\{P1,P2, . ..,P|\\scrP|} which can be hypercubes or simplexes. According to [19], the J1 (Union Jack) triangulation yields a subdivision of the domain space which is compatible with all PWL models, except the SOS2 model. Figure 2.6 shows the J1 triangulation for the two-dimensional PWL function depicted in Figure 2.5.\nThe MILP models available to approximate multidimensional functions can represent the PWL functions of many different ways: convex combination of the vertices of one single polytope, set of hyperplane equations and linear inequalities, and incrementally from a set of ordered polytopes (simplexes) and vertices.\n2.5.2\tDisaggregated Convex Combination Models\nThese formulations split the domain of the function in a set of polytopes P \\scrP. Each polytope P has a set of vertices V(P), and for each vertex v V(P) of this polytope, there is an associated continuous variable \\lambdaP\\bfv. The representation of a graph point of the function is described as the convex combination of the vertices of each polytope.\nDisaggregated Convex Combination\nThe Disaggregated Convex Combination (DCC) model does not require any special property for its polytopes. This model was studied by [20], [21], [22], and [23]. The MILP reformulation of the production function \\bfqn,m(pm, q\") using the DCC model is given by following set of equations:\nFor all n \\scrN :\nq = o\"\t(2.3\u201c)\nm\\in\\scrMn P\\inPn-m (q\\mathrm{i},p\\mathrm{r}) \\inV(P)\npm\tPp\\mathrm{r},\t\\in\\scrM\"\t(2.3b)\np\\in\\scrPn,m (q\\mathrm{i},p\\mathrm{r})\\inV(P)\nPm E E\tPP\\mathrm{r} + pm\u2019maX(1 - Zn,m),\nP\\in\\scrPn,m (q\\mathrm{i},p\\mathrm{r})EV(P)\t(2.3c)\n\\forallm \\scrMn\nA\"i\u2019Z\u2019P \\bfqn,m(qpp\\mathrm{r}) =\t' ,\np\\inpn.m (qi,p\\mathrm{r})\\inv(P)\t(2.3d)\n\\forallm \\scrMn\nzn,m\\bfqn,L\t\\bfqn\u2019\\mathrm{U}zn,m, \\forallm Mn\t(2.3e)\n\\lambdapm;P\t0, \\forallm Mn, P\t(qi,pr) V(P)\t(2.3f)\n= ynpm,\t\\in\\scrMn,P \\scrPn,m\t(2.3g)\n(qi,pr)ev (P)\ny\",m = zn,m, \\forallm Mn\t(2.3h)\nP r- pn,m\nypm e {0,1}, \\forallm eMn,P e \\scrPn\u2019m\n(2.3i)\nhaving the following extra parameters:\n\u2022\t\\scrKn,m and \\scrRn,m are the sets of breakpoints for the lift-gas rate injected in well n and pressure of manifold m;\n\u2022\t\\scrPn,m is the set of polytopes in the production function domain for well n when its production is directed to manifold m, and the set of vertices \\scrV(\\scrPn,m) := \\scrKn,m \\scrRn,m is defined by the Cartesian product of set of breakpoints for the lift-gas rate and manifold pressure;\nand extra variables:\n\u2022\t\\scrMs\tweighting variable of a breakpoint pair in \\scrKn,m\n\\scrRn,m \\forallhat belongs to a polytope P \\scrPn,m. When manifold m receives the production of well n, zn,m takes on value 1 and the respective convex combination becomes active;\n\u2022\typm is \\bullet binary variable associated to each polytope P \\scrPn,m which assumes value 1 when the convex combination is limited to polytope P. According to constraint (2.3g), only the vertices of P can be part of the convex combination that defines the lift-gas injection qf into well n and the manifold pressure pm;\n\\bullet \\scrKn,m \\scrMs\tpiecewise-linear approximation of \\scrKn,m.\nIn the same way, the pressure drop functions Ap(qm) are piecewise linearized with each model. For simplicity, we show only the reformulation for the well production curves. Then, the objective function given in Equation (2.1a) is recast as a piecewise-linear form:\nmax f=\tg(\\scrKm) - ^2 c(q\")\n(2.4)\nLogarithmic Disaggregated Convex Combination\nThe Logarithmic Disaggregated Convex Combination (DLog) model aims to reduce the binary variables and extra constraints of the DCC model. In this formulation, each polytope P \\scrP is represented with a binary vector y \\{0,1} \\lceillog2 \\scrP\\rceil using an injective function B : \\scrP \\rightarrow \\{0,1} \\lceillog2 \\scrP\\rceil. Some binary variables are required to enforce\t(P) Xp,v to be one when y = B(P). Let B(P) be\nthe value in position l of the binary code associated to polytope P.\t(B,l) is the set of polytopes whose binary codes have value\nj G {0,1} in position l, and L(\\scrP) is the set of indexes for the entries of a binary code B(P):\n(B, l) := {P G \\scrP : B(P) = j}, j G {0,1}\nL(\\scrP) := {v.^\t. i\\scrPi\\rceil}.\nBased on the works of [24, 25, 26], the well performance curve qn,m is then approximated with a piecewise-linear function using the DLog model as follows:\nFor all n G :\n\\lambdaPPtp * = \u00ab\"\nminscrMn p(qi,pI)in_V(p)\n\\lambdan-m:ppmathrm{r}\tpm, \\forallm e\n(qi,pr)eV (p )\nE\t\\lambdan^m,ppmathrm{r} + pm,maX(1 - Zn,m) > pm,\n(q\\mathrm{i},p\\mathrm{r})inV (p )\nE\np pn,m\nE\np pn,m\n(2.5a)\n(2.5b)\n(2.5c)\n\\forallm G \\mathrm{r}n\nE\np pn,m\nmathrm{r}n,m(qin,pmathrm{r}) = ~n,m,\n(q\\mathrm{i},p\\mathrm{r})inV (p )\n(2.5d)\n\\forallm G Mn\nZn,mmathrm{r}n,L\tmathrm{r}n,m\tqn,UZn,m\n\\lambdan-mf\t0, \\forallm G \\mathrm{r}n, P G \\scrPn,m, (qi,pr) G V(P)\n= zn,m, \\forallm G\n(qi,pr)eV (p )\nyin,m,\\forallm e\\mathrm{r}n, pinpl,n,m (b,l) (qi,p\\mathrm{r})inV(p)\n''qiyPr\np pn,m\n(2.5e)\n(2.5f)\n(2.5g)\n(2.5h)\nl G \\scrL(\\scrPnm)\n(1 - y?,m),\\forallm eMn, pinpO,n,m(B,l) (q\\mathrm{i},p\\mathrm{r})inV(P)\nl G\tnm)\ny?,m G {0,1},\\forallm G \\mathrm{r}n,l G \\scrL(\\scrPn\u2019m)\n(2.5i)\n(2.5j)\nhaving the additional variable:\n\u2022 yn,m i\\sum a binary variable associated with the lth entry of the binary code of each polytope, which induces the branching scheme in the weighting \\lambda variables.\nand extra parameters:\n\u2022\tscrP1,P,m(B,l) and scrP0,P,m(B,l) are the polytope sets associated to the injective function B which maps polytopes to binary vectors, grouping polytopes according to the index l and its binary representation B, where scrPj,P,m(B,l) := {P in scrPP,m : B(P)i = j}, j in {0,1};\n\u2022\tscrL(scrPn,m) := {1,..., Plog2 |scrPP,m|rceil} is the set of indexes mapped by the binary vectors to represent each polytope P in scrPn,m.\nConvex Combination\nThe production function qP,m(pm,qP) of well n depends on the pressure of the manifold m to which it is connected, pm, and the lift-gas injection rate, q\u201d. This curve is represented by a piecewise-linear function using the Convex Combination (CC) model as follows:\nFor all n in scrN :\nq\u201d =\t\\lambdanm q\t(2.6a)\nminscrMn (qi,pI)inV(scrP)\n\\lambdanm p. leq pm leq\t\\lambdans. p\\mathrm{r}\n(qi,pr)eV(scrP)\t(gi,pr)eV(scrP)\t(2.6b)\n+pm,max(1 _ Zn,m), forallm in scrM,\n\\bfqP,m =\t\\lambdapm q\u201d\u2019m(qi,p\\mathrm{r}), forallm in Mn\t(2.6c)\n(gi,pr)escrV (scrP)\nz\u201e,mq\u201d,L leq \\bfqP,m leq q\u201d,Uz\u201e,m, forallm in scrMp\t(2.6d)\nA\u201d\u2019X geq 0, forallm in , (q\\mathrm{i},p\\mathrm{r}) in scrV(scrP)\t(2.6e)\n\\lambdaPm = zn,\u2122, forallm in\t(2.6f)\n(gi,pr)escrV(scrP)\n\\lambdanp\u2122r leq\ty\u201d,m, forallm inscrMn, (qi,pr) inscrV(scrP) (2.6g)\np inscrP n,rn(q.,pr )\nyP,m = zn,m, forallm in Mn\t(2.6h)\np n,m\ny\u201d,m in {0,1}, forallP inscrP\u201d,\u2122\t(2.6i)\nwhere scrPP,m(q\\mathrm{i},p\\mathrm{r}) = {P in scrPP,m : (q;,pr) in V(P)} and ypm chooses the polytope.\nLogarithmic Convex Combination\nNew concepts are introduced to implement the branching scheme proposed by [26]. Let \\scrSe = {so,..., sn} be the set of breakpoints on axis e and \\scrIe := \\{[s0, si],..., [sn-1, sn]} be the intervals of breakpoints. Let \\scrIe(s) :=\t\\scrIe : s \\scrI} be the intervals\ncontaining s. Let \\Xie([si, si+1]) = i +1 be the index of an interval [si ,si+1] \\scrIe. Let B : \\{1,..., |\\scrIe|\\} \\rightarrow \\{0,1} \\lceillo\\mathrm{g}2(|\\scrIe|)i be a SOS2 compatible function, meaning that B(i) and B(i + 1) differ only in one bit according to the Gray code property. The vertices of the domain is \\scrV(\\scrP) = S1\tSd and d is the dimension. The first\nphase of the branching scheme uses the sets J+B l := \\{s \\scrSe : B(\\Xie(\\scrI))i = 1,\\forall\\scrI Te(s)}1 and := \\{s \\in\\scrSe : B(Se(\\scrI))&lt;= 0, \\forall\\scrI \\scrIe(s)} where l \\Phi(Se) = \\{1, 2,..., \\lceillog2(|Se| \u2014 1)\\rceil\\} is the position of the binary code used to represent the intervals on axis e. Notice that the number of intervals is precisely one less the number of breakpoints.\nThe second phase selects a simplex of the hypercube obtained in phase one using the sets \\scrLr,s = {v \\scrV(\\scrP) : \\bfvr is even and vs is odd} and \\scrRr,s = {v \\scrV(\\scrP) : vr is odd and vs is even, \\forallr, s D = \\{1,..., d}, such that r &lt;s.\nTo piecewise linearize \\bfqn,m(pm, q.n), the Logarithmic Convex Combination (Log) model builds the \\mathrm{J}1 triangulation and restricts the convex combination to a single simplex implicitly through the branching scheme. This is achieved with the following equations:\nFor all n \\scrN, m \\scrM\u201e, l\t\\Phi(\\scrKn\u2019m) :\nEn,m\nq J +\tPrE\\scrRn\u2019m\nqi\\inJ axis(\\scrKn>m) ,B ,l\nsum\nEn,m\nAqi'Pr\nJaxis(\\scrKn>m) ,B ,l\t\"\nFor all n\t\\scrN, m\t\\scrMn, l\t\\Phi(\\scrRn,m) :\nsumsum\nqi\\in\\scrKn,m\nn,m AQi,Pr\nn,m\nxl ,\n,m\nxl \u2019\nJ{xis(\\scrRn,m),B,i\nsum\nsum\nq.t\\scrK\tP\\mathrm{r}EJa.xis(\\scrRn,m),B,l\nn,m AQi,Pr\nn,m (1 \u2014 xl,\n(2.7a)\n(2.7b)\n(2.7c)\n(2.7d)\n<\n<\n<\n(1\u2014*r)\n)\n1J+b l\tse\\mathrm{t} breakpoints s on axis e such that the binary\ncode of all intervals that contain s has value 1 at the lth position of the code.\nFor all n \\scrN, m \\scrMn, (r, s) rn\u2019m :\n(2.7e)\nn,m (qi,Pr)\\in\\scrLr\u2019s\n\\lambdanm \\leq\t(1 - ynm\t(2.7f)\n.\t{0,1}, \\foralln\t\\in\\scrN,m\t\\scrMn, l\t\\Phi(\\scrKn\u2019m)\t(2.7g)\nxnm\t\\{0,1}, \\foralln\t\\scrN, m\t\\scrMn, l\t\\in \\Phi(\\scrRn\u2019m)\t(2.7h)\ny\u201d\u2019am \\in \\{0,1}, n\t\\scrN, m\t\\scrMn, (r, s) \\in Tn\u2019m\t(2.7i)\nhaving the following extra parameters:\n\u2022\t\\Phi(\\scrS) = {l,\u2022\u2022\u2022, M\\scrSI- 1)_l};\n\u2022\taxis(Q) is the axis that contains the breakpoint set \\scrQ;\n\u2022\trn\u2019m := \\{(r, s)\tD \\times D : r &lt;s};\n\u2022\t\\scrLnsm = \\{v \\scrV(\\scrPn,m) : \\bfvr \\forall\\Phi \\lambda\\v\\lambda\\leq and vs is odd} and \\scrR\"\u2019m = {v \\scrV(\\scrPn,m) : \\bfvr is odd and vs is even}, \\forallr, s D such that r &lt;s;\nand extra variables:\n\u2022\tx^m and x?m are binary variables that induce the first phase\nof Log branching, for each entry l\t\\Phi(\\scrKn,m) and l\t(\\scrRn,m)\nrespectively;\n\u2022\ty^\u2019\u2122 \\forall\\Phi a binary variable that induces the second phase of the Log branching for each (r, s) \\Gamman,m.\nThe complete Log model for the piecewise-linear approximation of the well-production functions consists of the Equations (2.6a)-(2.6f) and (2.7). A complete example of the Log model for a 2dimensional function is found in [27].\n2.5.3\tMultiple Choice Model\nThe Multiple Choice (MC) model approximates the original function using hyperplane equations for each polytope function. The domain is divided into a set of polytopes P \\scrP, which are described by a set of linear inequalities APxP bPyP. A domain point x is represented by the summation of all domain variables xP. For each polytope there is an associated hyperplane function that linearizes the original function inside that polytope. Finally, only one polytope\ncan be active, which has an active domain point and its corresponding function value. This formulation was studied in [28], [20], and [21]. The non-convex function \\bfqn,P(pP, q\u201d) is approximated with a PWL function using the MC model as follows:\nFor all n \\scrN :\nn,p\nQi \u2019\nEn,p,P q\u201d ,\np r- pn,m\n,p,P\tn.max n,p\nq\u201d\nEn,p\nqn\nP\\in\\scrMn\nPm\tJZ P\u201d\u2019m\u2019P,\tMn\np p pn,m\npm\npn\u2019P,P+pp,max(i -\nPp pn,m\n\\bfq\u201d,p = sum\tMP,P\nP pn,m\nn.rn.P\nP\u2019 ,-npn,P . P\\mathrm{r}\nzn,p), Vm\t^\\scrMn\nn,p n, + \\bfcP yP\t,\n(2.8a)\n(2.8b)\n(2.8c)\n(2.8d)\n(2.8e)\n(2.8f)\n0\n\\forallm \\scrMn\nz\tan\u2019L &lt;a\u201d,P &lt;an\u2019uz&lt;/n,^H\t\u2014 H\t\u2014 H\t</n,p\t\t\t(2.8g) (2.8h)\nn,P \\bfAP\tn,P,P Q , , pn,P,P\t\\bfbP,Py\u201d,P, \\forallm \\in\\scrMn ,P \\scrP\u201d,p\t\nsum\ty\u201d,P = Z\u201d,P, \\forallm\t\\scrMn\t\t(2.8i)\nPpp n,m\t\t\t\npn,P,P pr\t0, \\forallm\t\\scrMn, P\t\\scrP\u201d,p\t\t(2.8j)\ny\u201d,P\t{0,1}, \\forallm\t\\scrMn, P \\scrP\u201d,P\t(2.8k)\nwith additional variables:\n\u2022 q\u201d,P,P is the lift-gas injection rate for well n when it belongs to polytope P\t\\scrPn,P;\n\\bullet p\u201d,p,P\tmanifold m pressure in polytope P \\scrPn,P;\n\u2022\tyP>,P\ta binary variable that takes on value 1 when polytope\np \\scrPn,p\tactive, and 0 otherwise;\nand extra parameters:\n\u2022\tM\u201d,P\twith the coefficients of the hyperplanes that\napproximate the vector function qn,P within the polytope P \\scrP n,p;\n\u2022 is a vector of constants for the hyperplanes that approximate qn,m within P in scrPn,m;\nbullet \\bfApm and bpm describe the linear inequalities that define polytope P in scrPn,m. Since the matrix \\bfAP\u2019m may not be full rank, Equation (2.8b) is needed to force\tto zero when yP\u2019m\ntakes on value zero. In this case, the pressure pf\u2019m\u2019P does not need to be driven to zero because pm will become a free variable, bounded by other wells connected to manifold m.\n2.5.4\tIncremental Model\nThe incremental (Inc) approximates the original function incrementally with an ordered set of simplexes and vertices, which must induce a triangulation of the domain of the function. When approximating multivariate functions, this model requires the set of polytopes scrP to be a triangulation scrT with special ordering properties:\nO1: The simplexes in scrT must be ordered as T,...,such that Ti cap Ti+i = emptyset for i in {1,..., |scrT| - 1}.\nO2: The vertices of each simplex Ti must be ordered as v0,..., v|V(Ti)|-1 suc\\bfc\tviV(Ti)|-1 = v0+1 for i in {1,..., |scrT| \u2014 1}.\nThese properties ensure a total ordering among the simplexes and vertices in the domain, which is required to incrementally represent the graph of the function, scrG = {(x, f (x)) : x in dom(f)}. [29] showed that such conditions are met by several triangulations, inclusive the J1 (\u201cUnion Jack\u201d). [30, 31, 32, 29, 33] have studied the Inc model which is also referred to as the delta method. More recently, [18, 20, 32] began calling it the incremental model. Below, the equations based on the incremental model are presented to approximate the non-convex function q\"\u2019\"in\nFor all n\ninscrN :\nn,m\nq \u2019\n|Tn-m| |V(Tj)|-1\nn,m\tn,m n,m n^my\nqi\u20191\u20190Zn\u2019m +\t\\deltaj\u2019k\tq\\mathrm{i}\u2019j\u2019k \u2014 qi\u2019j\u20190 ,\nj = 1 k=1\n(2.9a)\nforallm in scrMn\n\\scrTn,ml |V (Tj )|_1\nm\tn,m\np geq P\\mathrm{r}\u20191\u20190Zn,m\nj=1\nn,m n,m n,m \\\n+ X X j [pr\u2019j\u2019k \u2014 PT\u2019jfi) ,\nk=i\n(2.9b)\nforallm in scrMn\n\\Tn\u2019m | |V (T, )|-1\np\" &lt;n,rn z\t.\t\\delta-,m /pn,m_ pn,m\\\nP\tpr,1,0Z-,m ' 2.^\t2.^ j \\P\\mathrm{r},j,k\tPr,j,0) (2 9c)\nj=1\tk=1\t\u25a0\t'\n+pm\u2019max(1 - z-,m), \\forallm\t\\scrM-\n|Tn\u2019m| |V(Tj)|-1\n\\bfqn,m _ \\bfqn,m(nn,rn n,m )z\t.\t\\deltan,m\nQ _\t(qi, 1,0, P\\mathrm{r}, 1,0 )zn,m I /\t,\t\\deltaj,k\nj=1\tk=1\nj - q-m( j \u2022\t,\t\\in \\scrM-\nz\u201e,mq\u201d,L \\leq q-,m \\leq q-,Uz\u201e,m, \\forallm \\scrM-\n|V (Ti)|-1\n\\sum\t\\delta-,m \\leq z\u201e,m, \\forallm \\scrM-\nk=1\n\\delta-f > 0, \\forallm \\in\\scrM-, j \\{1,.|\\scrT-,m|}, k \\in\\{1,..., |V(Tj)|- 1} w-,m \\leq\t.(Tj)|_1, \\forallm \\in\\scrM-,\nj \\{1,..., |\\scrT -,m|- 1}\n|V (T, )|-1\n\\sum jm,fc \\leq w-,m, \\forallm \\in\\scrM-,\nk=1\nj \\in\\{1,..., |\\scrT -,m|- 1}\nw-,m \\{0,1}, \\forallm \\scrM-, j \\{1,..., |\\scrT-,m| - 1}.\n(2.9d)\n(2.9e)\n(2.9f)\n(2.9g)\n(2.9h)\n(2.9i)\n(2.9j)\nhaving the additional variables:\n\u2022 \\delta-,m\ta weighting variable that incrementally represents the\ndomain into a single polytope;\n\u2022 w-,m assumes value 1 when the variable \\delta\",f\"\tof the\nj\tPP (Tj)|-1\nsimplex T\\widehat\t\\scrTn,m takes on value 1, for all \\widehat \\leq j. In this case,\nTj+1 is the active simplex of the domain;\nand extra parameters:\n\u2022\tbreakpoint of the lift-gas injection rate for vertex\nk of simplex j of well n;\n\u2022 P-jm\tbreakpoint of the pressure of manifold m for vertex\nk of simplex j;\n\u2022\tscrTn,m is the set of simplexes that make up the family of polytopes in the domain of the production function bulletn,m when well n is routed to manifold m;\n\u2022\tV(T) is the set of vertices of the simplex T scrT scrTn,m.\nThe Inc model requires an ordering of the polytopes and vertices according to properties 01 and 02. In this dissertation, the J1 triangulation was used for all simplex-based approximation models, inclusive Inc. To find such an ordering of the J1 triangulation, the approach below was followed:\n1.\tAn undirected graph scrG = (scrP, \u00a3) is obtained to represent each polytope (simplex) as a vertex P, where an edge (P, P\\prime) scrT \u00a3 if and only if V(P) cap V(P\\prime) = emptyset;\n2.\tA weight cp,p\\prime = 1/(|V(P) cap V(P\\prime)|) is assigned to each edge, being inversely proportional to the number of shared vertices between P and P\\prime;\n3.\tA Hamiltonian path \\scrC for scrG is found by a reduction to the traveling salesman problem which is solved using the Concorde solver.\n4.\tFinally, an ordering of the vertices is obtained by following the\npath \\scrC, moving from one polytope Pk to the next Pk+i and selecting the common vertice\t= v0+1 at random.\n2.5.5\tSOS2 Model\nIn a pioneer work, Beale and Tomlin [34] proposed a new representation for piecewise-linear functions based on the convex combination of the weighting variables A\u2019s associated with the vertices of the function domain. Among these weighting variables, only two of them can be nonzero and consecutive in the branch-and-bound algorithm. Such sets are called S0S2 and the constraints that use these sets are called S0S2 constraints.\nNowadays some general purpose solvers support S0S2 constraints. [35] presented an example that illustrates how the S0S2 constraints can be treated in a branch-bound procedure. Assume that {A\u00b0,...,\tare S0S2, and let {\\lambda\u00b0, \\lambda1,...,\tbe solution of the linear relaxation of the problem, where ~k1,\t> 0 for\nsome k^,k2 scrT {0,..., k(j)}, ki &lt;k2, and k2 \u2014 ki > 2. This violation of the S0S2 constraint can be ruled out in the branch-and-bound search by introducing the constraints \\lambdaj = \u25a0 \u25a0 \u25a0 = A^1 = 0 in one branch, and Aj'1 +2 = \u25a0 \u25a0 \u25a0 =\t= 0 in the other.\nBeale[36] showed how to extend SOS2 constraints to multidimensional piecewise-linear functions. Instead of using binary variables, convex combinations are limited to a hypercube of the function domain using a linked chain of SOS2 constraints. The equations that represent the well-performance curve qn,m(pm, q\") are reformulated with SOS2 constraints as follows:\nFor all n G N :\nq\" =\tq> m\\xiMn qi\\xiscrKn\u2019m pIEscrRn-m\t(2.10a)\nE E\tpr &lt;pm, v\u2122 \u25a0\t(2.10b)\nqiEscrKn,m pi\\xiscrRn,m\t\npm\tE E\tpr+pm,max(1 - zn,m),\t(2.10c)\nqiEscrKn,m pr\\xiscrRn,m\t\nMn\t\n\\bigl(\"\u2019m =\t\u00a3\t\u00a3\tq\"\u2019m(qi,pr), Vm M\"\t(2.10d)\nqi escrKn-m prescrRn-m\t\nz^mq^ &lt;q\"\u2019m &lt;q\"\u2019UZ\"\u2019m, Vm\tMri\t(2.10e)\n> 0, Vq;\tscrK\"\u2019m, m M\", pr\tscrR\"\u2019m\t(2.10f)\nE E\t= Z\"\u2019m, Vm\tM\",\t(2.10g)\nqiEscrKn,m pr\\xiscrRn,m\t\nm = E \u25a0,w\t(2.10h)\npr\\xiscrRn.m\t\n, Vpr\tescrR\".\t(2.10i)\nqiEscrKn,m\t\n(CEscrKn.m , \u00abDscrRn.m HPC SOS2\t(2.10j)\nhaving additional variables\n\u2022\tis an auxiliary variable which takes on the value of the\nsummation of the weighting variables\tover all manifold\npressures pr for a particular injection rate q\\bigr);\n\u2022\t\\etap\u2019m is an auxiliary variable which takes on the value of the\nsummation of the weighting variables\tover all q; for a\nparticular manifold pressure pr.\nThe auxiliary variables\tand\tcompose the linked chain\nof SOS2 constraints that divides the domain in a grid. The SOS2 constraints (2.10j) limit the convex combination of the weighting variables to be within a single polytope (hypercube).\n2.6\tMODELING AND ANALYSIS\nThis section presents a computational and simulation analysis of the MILP formulations developed for the oil production optimization problem subject to routing and pressure constraints. The oil production system used as a testbed is a synthetic but representative oil field modeled with a multiphase flow simulator widely used by oil operators. The computational analysis evaluates the performance of the MILP reformulations for both hypercube and simplex approximations. Finally, a simulation analysis is performed to analyze the mean errors and respective overall benefit of these models compared to the results obtained with the multiphase flow simulator.\n2.6.1\tProduction System\nThe production system has N =16 wells and M = 2 manifolds as illustrated in Figure 2.7. All production wells can send their production to both manifolds, i.e. \\scrNm = \\scrN, \\forallm G \\scrM. Each manifold is connected to a dedicated separator.\nFigure 2.7: Production system network with gas-lifted wells.\nThe wells and manifolds are topologically divided into two groups: the wells 1-8 are 1 km away from manifold 1, and 10 km away from manifold 2, while the wells 9-16 are 1 km away from manifold 2, and 10 km away from manifold 1. The pipelines connecting wells and manifolds have 4 inches of Inner Diameter (ID), and 0.001 inches of Roughness (R). With this topological structure, qn,mi (pr,q;) > qn,m2(pr,Qj) if well n is closer to manifold 1 than manifold 2 for a given manifold pressure p\\mathrm{r} and lift-gas injection rate .\nThe Gas-Oil Ratio (GOR) and Water Cut (WCUT) fractions are given constants for each well. The liquid flow rate of each well behaves according the equation = J;(p\\mathrm{R}_pwf), where = qo + qw, pwf is the bottom-hole pressure, J; is the well productivity index, ana p\\mathrm{R} is the reservoir static pressure. Table 2.1 presents the well parameters with the units of GOR, WCUT, p\\mathrm{R}, and J; being sm3/sm3, %, psi, and STB/d/psi, respectively.\nTable 2.1: Well parameters\nn\tGOR\tWCUT\tp\\mathrm{R}\tJi\t\n1\t200\t0\t2100\t15\n2\t200\t20\t2300\t2\n3\t300\t10\t1950\t12\n4\t300\t40\t2050 15\n5\t400\t0\t1750\t4\"\n6\t400\t20\t1700\t9\nn\tGOR WCUT\tp\\mathrm{R}\tJi\n9\t200\t10\t1900\t5\n10\t200\t40\t2200\t9\n11\t300\t0\t1850\t11\n12\t300\t20\t2300\t6\n13\t400\t10\t1825\t14\n14\t400\t40\t2200\t7\n7\t500\t10\t1700\t11\n15\t500\t0\t1600\t8\n8\t500\t40\t2100\t10\n16\t500\t20\t1800\t5\nThe production of manifold 1 flows through a pipeline of 10 km to reach a separator, while the production of manifold 2 flows through a pipeline of 5 km long. Both pipelines have negligible vertical elevation, ID = 4.5 inches, and R = 0.001 inches. The manifold pressures can vary from 300 to 800 psia, while the nominal pressure at the separator is 300 psia.\nAll wells have identical tubings with the following features: ID of 3 inches, drilling depth of 3.7 km, depth of 2.7 km, and injection point at 2.8 km. The maximum flow rate of each well is 8000 Mscf/d. The well performance curves used to represent this production system are described in [27]. This instance was obtained using the multiphase flow simulator Schlumberger Pipesim, inspired in a synthetic field from [15].\n2.6.2\tComputational Analysis\nThis section presents a computational analysis of the application of the MILP formulations developed in this paper to the synthetic production system. The formulations were expressed in A Mathematical Programming Language (AMPL) and solved with the MILP solver CPLEX 11.2 in a Linux workstation, with an Intel Core 2 Quad 2.93GHz processor and 4GB of RAM. All experiments ran within a time limit of 10 000 seconds (approx 2.78 hours). The instances for which the solver ran out of memory are indicated with an asterisk (\\star).\nFor comparing the performance of the developed formulations, we analyze the impact of the number of polytopes in the domain\nof the PWL functions for each scenario of gas-compression capacity. This analysis aims to verify the increase in the running time as a function of the resolution quality. The analysis considered three different scenarios of lift-gas compression capacity, namely: high for qmax = 3 624480 sm3/d, medium for q;max = 453 060 sm3/d, and low for qPax = 1 13 265 sm3/d. The resolution qualities are:\n\u2022\tcoarse: 18 squares (6 breakpoints for gas-injection and 3 for manifold pressure) for the production function and 25 cubes (5 breakpoints for phase flow) for pressure drop in the hypercube approximation; 36 (twice the number of squares) and 150 (6 times the number of cubes) polytopes for the simplex approximation, respectively;\n\u2022\tmoderate: 66 squares (11 by 6) and 1000 cubes (10 breakpoints in each phase) for hypercube approximation; 132 and 6000 polytopes in the simplex approximation, respectively.\n\u2022\tfine: 180 squares (15 by 12) and 2197 cubes (13 breakpoints in each phase) for hypercube approximation; 360 and 13182 polytopes in the simplex approximation, respectively.\nTable 2.2 gives the size of the oil production optimization problem for the instances considered in the computational analysis and each PWL model, as reported by the MILP solver.\nTable 2.2: Formulation Size\nHypercube\tSimplex\n\tModel\tCoarse\tModerate\tFine\tCoarse\tModerate\tFine\n\tBinary vars.\t6\t2\u20194\t11 682\t4482\t64.22\t37154\nDCC\tContinuous vars.\t2610\t11 778\t60 546\t4498\t22 786\t132 226\n\tConstraints\t891\t2 805\t11 973\t1673\t7013\t37 445\n\tBinary vars.\t172\t242\t312\t212\t280\t350\nDLog\tContinuous vars.\t2610\t11 778\t60 546\t4498\t22 786\t132 226\n\tConstraints\t601\t741\t881\t681\t817\t957\n\tBinary vars.\t6\t2\u20194\t11 682\t8 2-4\t64 7 22\t37154\ncc\tContinuous vars.\t1058\t3 408\t13 772\t1058\t3408\t13 772\n\tConstraints\t1287\t3 637\t14 001\t1287\t3637\t14 001\n\tBinary vars.\t-\t-\t-\t212\t282\t352\nLog\tContinuous vars.\t-\t-\t-\t1058\t3408\t13 772\n\tConstraints\t-\t-\t-\t681\t821\t961\n\tBinary vars.\t472\t2 514\t11 682\t1126\t6 722\t37154\nMC\tContinuous vars.\t1092\t5 554\t26914\t2670\t16130\t95 138\n\tConstraints\t2 965\t16 061\t79 237\t7457\t44 549\t250 405\n\tBinary vars.\t-\t-\t-\t1316\t6656\t37 086\nInc\tContinuous vars.\t-\t-\t-\t3118\t16 066\t95 068\n\tConstraints\t-\t-\t-\t3 047\t13 727\t74 587\n\tBinary vars.\t34\t34\t34\t-\t-\t-\nSOS2\tContinuous vars.\t1402\t4 026\t14938\t-\t-\t-\n\tConstraints\t669\t943\t1 491\t-\t-\t-\nHypercube Approximation\nA computational analysis of DCC, DLog, CC, and SOS2 models is performed with hypercube approximation to the oil production optimization problem. Tables 2.3, 2.4, and 2.5 present the running time in seconds and the primal-dual gap (i.e., \u00a1upper-bound - best-integer|/|best-integer|) for the PWL formulations considering the hypercube approximation for high, medium, and low gas-compression capacity respectively. All formulations were evaluated with coarse, moderate, and fine resolutions for each scenario of lift-gas availability.\nTable 2.3: Hypercube Approximation: High Gas-Compression Capacity\nApproximation Resolution\nModel\tCoarse\t\tModerate\t\tPine\t\n\tCPU (s)\tGAP (%)\tCPU (s)\tGAP (%)\tCPU (s)\tGAP (%)\nDCC\t22.54\t0.00%\t121.26\t0.00%\t10000.00\t17.99%\nDLog\t15.19\t0.00%\t780.74\t0.00%\t5 047.64\t0.00%\nCC\t14.05\t0.00%\t86.67\t0.00%\t1311.36\t0.00%\nMC\t320.11\t0.00%\t3 370.52\t0.00%\t10000.00\t0.02%\nSOS2\t4.70\t0.00%\t18.66\t0.00%\t152.23\t0.00%\nTable 2.3 presents the results for the scenario of high availability of compression gas. With the exception of DCC and MC, all formulations reached the global optimum, with the SOS2 formulation achieving the best performance.\nTable 2.4: Hypercube Approximation: Medium Gas-Compression Capacity\nApproximation Resolution\nModel\tCoarse\t\tModerate\t\tFine\t\n\tCPU (s)\tGAP(\\%)\tCPU (s)\tGAP(\\%)\tCPU (s)\tGAP(\\%)\nDCC\t155.49\t0.00%\t6451.25\t0.00%\t\\star9 641.33\t28.95%\nDLog\t35.70\t0.00%\t1 222.15\t0.00%\t10000.00\t6.89%\nCC\t200.43\t0.00%\t5 358.81\t0.00%\t10000.00\t19.28%\nMC\t206.08\t0.00%\t10000.00\t0.95%\t10000.00\t45.59%\nS0S2\t52.38\t0.00%\t101.19\t0.00%\t865.28\t0.00%\nTable 2.4 presents the results for the scenario of medium availability of compression gas. All formulations reached the global optimum for coarse and moderate resolutions, with the exception of MC for which the optimum was found only for the coarse resolution. Although DLog was the most efficient for the coarse resolution, only the SOS2 formulation was capable of closing the primal-dual gap with the fine resolution.\nWhen the compression capacity becomes low, the oil production optimization problem becomes more complex and only the\nTable 2.5: Hypercube Approximation: Low Gas-Compression Capacity\nApproximation Resolution\nModel\tCoarse\t\tModerate\t\tFine\t\n\tCPU (s)\tCAP(\\%)\tCPU (s)\tCAP (%)\tCPU (s)\tCAP(\\%)\nDCC\t191.88\t0.00%\t7592.06\t0.00%\t*7742.53\t83.03%\nDLog\t65.12\t0.00%\t1,068.58\t0.00%\t10000.00\t2.58%\nCC\t109.00\t0.00%\t8,473.52\t0.00%\t10000.00\t29.84%\nMC\t40.03\t0.00%\t10000.00\t0.69%\t10000.00\t69.29%\nSOS2\t37.29\t0.00%\t169.88\t0.00%\t4519.59\t0.00%\nSOS2 formulation achieves the global optimum in all resolutions as shown in Table 2.5. The MC formulation reached the optimal solution only in the coarse resolution, while the others reached the optimum for coarse and moderate resolutions, but failed to close the primal-dual GAP for the fine resolution.\nSimplex Approximation\nThe results from a computational analysis of DCC, DLog, CC, Log, MC, and Inc models are presented for the simplex approximation of the function domains. As before, the performance of these models considers a varying number of polytopes and three scenarios of lift-gas compression capacity.\nTable 2.6: Simplex Approximation: High Gas-Compression Capacity\nApproximation Resolution\nModel\tCoarse\t\tModerate\t\tFine\t\n\tCPU (s)\tCAP(\\%)\tCPU (s)\tCAP(\\%)\tCPU (s)\tCAP(\\%)\nDCC\t94.35\t0.00%\t7895.19\t0.00%\t10000.00\t198.99%\nDLog\t85.04\t0.00%\t1576.78\t0.00%\t10000.00\t0.52%\nCC\t45.39\t0.00%\t623.52\t0.00%\t*9 855.58\t188.58%\nLog\t5.46\t0.00%\t26.80\t0.00%\t141.09\t0.00%\nMC\t544.65\t0.00%\t10000.00\t0.13%\t10000.00\t-\nInc\t102.85\t0.00%\t5 839.36\t0.00%\t10000.00\t0.36%\nTable 2.6 presents the running times in seconds and primal-dual GAPs for the scenarios of high compression capacity with coarse, moderate, and fine resolutions. All models reached the global optimum with coarse resolution fairly quickly. For a medium resolution, the optimal solution was found with all formulations but MC, which also achieved the worse performance with the coarse resolution. For a fine resolution, the MC model could not find a feasible solution and only the Log model succeeded to close the primal-dual GAP. For a high gas-compression capacity, the Log model outperformed all of the other models for all approximation qualities.\nTable 2.7: Simplex Approximation: Medium Gas-Compression Capacity\nApproximation Resolution\nModel\tCoarse\t\tModerate\t\tPine\t\n\tCPU (s)\tGAP(\\%)\tCPU (s)\tGAP(\\%)\tCPU (s)\tGAP\nDCC\t*8044.60\t3.80%\t*5 060.57\t6.99%\t10 000.00\t65.89%\nDLog\t210.06\t0.00%\t3 852.82\t0.00%\t10 000.00\t23.92%\nCC\t10000.00\t2.84%\t*5 892.72\t51.04%\t\\star6 681.91\t-\nLog\t11.51\t0.00%\t36.50\t0.00%\t157.82\t0.00%\nMC\t10000.00\t1.97%\t10 000.00\t9.47%\t10 000.00\t-\nInc\t2741.95\t0.00%\t10 000.00\t9.05%\t10 000.00\t2 039.15%\nTable 2.8: Simplex Approximation: Low Gas-Compression Capacity\nApproximation Resolution\nModel\tCoarse\t\tModerate\t\tPine\t\n\tCPU (s)\tGAP (%)\tCPU (s)\tGAP (%)\tCPU (s)\tGAP (%)\nDCC\t10000.00\t5.97%\t*4 530.18\t100.87%\t*4 966.15\t595.18%\nDLog\t289.83\t0.00\t3 927.27\t0.00%\t10000.00\t8.39%\nCC\t10000.00\t3.81%\t10000.00\t18.15%\t*5 946.25\t-\nLog\t20.38\t0.00%\t15.28\t0.00%\t149.95\t0.00%\nMC\t3 418.98\t0.00%\t10000.00\t8.62%\t10000.00\t204.90%\nInc\t1289.12\t0.00%\t10000.00\t12.65%\t10000.00\t118.54%\nTables 2.7 and 2.8 present the results for the scenarios of medium and low compression capacity, respectively. As the compression capacity becomes constrained, the oil production optimization problem becomes harder and the primal-dual GAP cannot be closed with most of the formulations and resolutions. This was expected because the approximation with simplex is more precise but rather complex. The results with medium and low gas-compression capacity were similar: the Log model achieved the best performance, whereas only the DCC and CC models could not reach the global optimum with the coarse resolution. With a moderate resolution, only logarithmic models (Log and DLog) closed the primal-dual GAP. With a fine resolution, the solver ran out of memory with the CC model and could not find a feasible solution, however the optimal solution was found with the Log model which was faster in all scenarios and approximation qualities.\n2.6.3\tSimulation Analysis\nThe quality (benefit and mean error) of the solutions obtained by hypercube and simplex approximations are compared considering the oil-field performance estimated with a multiphase flow simulator. The simulation analysis evaluates the mean errors of the process variables calculated with the simulator and their optimizer predictions for the scenario of low compression capacity, considering three\napproximation resolutions: coarse, moderate, and fine. Notice that the PWL models with the same domain (hypercube or simplex) are equivalent, meaning that all formulations with same domain reach the same optimal solution. For this reason, the simulation analysis contrasts against the simulator only the optimal solutions obtained with the hypercube- and simplex-based domains for the three different resolutions.\nThe objective function considered for optimization is:\nf =\t(poqom + pgqgm - Pwqm) -\tPi\u00abr\nwith po = 20, pg = 2, pw = 1, and p; = 0, which were arbitrarily defined to reflect the relative values of the production phases and costs.\nTables 2.9 and 2.10 present the pressure and flow rates handled by both manifolds according to the optimizer predictions. All optimization models suggested the same well-manifold routings: wells 1, 3, 4, 5, 6, 7, and 8 were linked to manifold 1; wells 2, 9, 10, 11, 12, 13, 14, and 15 were connected to manifold 2. The main differences arise in the multiphase flows, pressures, and in the system total benefit.\nTable 2.9: Hypercube Approximation\n\t\tCoarse\t\tModerate\t\tFine\t\n\t\tSimulated\tError (%)\tSimulated\tError (%)\tSimulated\tError (%)\nf ($)\tMan.\t2352855.52\tIT7I%-\t2496486.85\t0.16%\t2508574.67\t0.66%\npm (psia)\t1\t408.83\t0.41%\t413.93\t0.27%\t412.73\t0.93%\n\t2\t373.84\t1.36%\t388.50\t0.05%\t391.88\t0.43%\n(W/d)\t1\t535754.74\t0.45%\t551045.83\t0.21%\t543683.45\t0.87%\n\t2\t611077.55\t3.48%\t665445.89\t0.46%\t678471.64\t0.50%\nqm m\t1\t1426.53\t0.31%\t1444.99\t0.24%\t1449.90\t0.60%\n\t2\t1565.42\t9.19%\t1766.24\t0.35%\t1800.23\t0.64%\nqm m\t1\t291.77\t7.23%\t308.21\t3.11%\t311.40\t3.14%\n\t2\t356.28\t11.64%\t412.96\t0.87%\t426.67\t1.48%\nAnalyzing the hypercube-based solutions shown in Table 2.9, it is noticeable the effect of the resolution quality on the simulated manifold production and pressure. The solution obtained with the coarse resolution has considerably high errors, mostly in manifold 2. When the resolution is increased (moderate and fine), the errors drop to under 1.5% except for the water production. Surprisingly, the moderate resolution achieves smaller mean errors than the fine resolution. However, a better solution was found with a more precise resolution, inducing a better field operation but with higher modeling errors. Further, the oil production and benefit function are increased as the resolution increases, even though a more precise resolution induces higher errors.\nTable 2.10 shows the manifold pressure and flow rates of the simplex-based solution for varying resolutions. The errors obtained\nTable 2.10: Simplex Approximation\n\t\tCoarse\t\tModerate\t\tFine\t\n\t\tSimulated\tError (\\%)\tSimulated\tError (%)\tSimulated\tError (%)\nf (\\$)\tMan.\t2458351.41\t3.71%\t2484899.00\t0.51%\t2730618.46\t0.71%\npm (psia)\t1\t394.15\t0.02%\t413.14\t1.33%\t427.92\t0.74%\n\t2\t384.65\t2.45%\t387.57\t0.30%\t398.29\t0.38%\nqmathrm{g} (W/d)\t1\t502907.20\t1.54%\t549629.99\t1.18%\t611927.05\t0.87%\n\t2\t697727.10\t5.66%\t661198.37\t0.06%\t721230.08\t0.57%\n\t1\t1330.96\t3.65%\t1438.33\t0.83%\t1450.27\t0.71%\n\t2\t1551.85\t14.26%\t1759.47\t0.48%\t1802.32\t0.73%\nqmathrm{w} \",\t1\t212.54\t4.84%\t304.47\t3.76%\t318.14\t3.00%\n\t2\t360.95\t28.89%\t409.23\t1.83%\t429.38\t1.50%\nwith the coarse resolution were not high in manifold 1, but considerably high in manifold 2. As in the approximation with hypercubes, the errors are reduced with an increased resolution (moderate and fine resolutions). However, the moderate resolution reached a solution with smaller errors in manifold 2, while the fine resolution presented smaller errors in manifold 1. Again, it can be noticed that the oil/gas production and benefit function are increased as the resolution is improved with simplex approximation. The profit obtained in the fine resolution is about 9.89% better than with the moderate, and 9.97% better than the coarse.\nTo further illustrate the solutions settings produced by the optimization model, Table 2.11 gives the gas-lift injection and oilflow rates per well for the fine resolution with simplex domains. Likewise, Table 2.12 gives the well settings produced by the optimization model with hypercube domains.\nTable 2.11: Optimal solution per well with a fine simplex resolution\nn\tqn\tqmathrm{o}\tn\tqn\tqmathrm{o}\n1\t9280.93\t350.30\t9\t28316.80\t175.58\n2\t28288.70\t137.93\t10\t28316.80\t177.12\n3\t9280.93\t256.61\t11\t7065.15\t271.40\n4\t28316.80\t170.82\t12\t0.00\t279.45\n5\t9280.93\t161.81\t13\t0.00\t244.99\n6\t28316.80\t141.79\t14\t14158.40\t191.27\n7\t9280.93\t185.33\t15\t5407.81\t181.04\n8\t14158.4\t193.89\t16\t7065.15\t156.65\n2.6.4\tDiscussion\nFrom the computational and simulation analyses, a comparison of the approximations based on hypercubes and simplexes elicited the following remarks:\nTable 2.12: Optimal solution per well with a fine hypercube resolution\nn\tqn\tqn\n1\t1174.24\t351.16\n2\t13701.51\t127.67\n3\t1174.24\t258.95\n4\t8680.19\t157.04\n5\t1174.24\t162.05\n6\t16506.91\t142.91\n7\t1174.24\t190.25\n8\t8253.46\t196.29\nn\tqn\tqn\n9\t27403.02\t177.62\n10\t27403.02\t178.63\n11\t0.00\t271.06\n12\t0.00\t281.61\n13\t0.00\t247.37\n14\t0.00\t187.09\n15\t0.00\t182.19\n16\t6622.30\t158.55\n\u2022\tIn most cases the SOS2 model achieved a better performance for the approximations based on hypercubes. On the other hand, the Log model was the most efficient for the approximations based on simplexes, regardless of the gas-compression capacity and resolution quality. Comparing these two models, the SOS2 formulation is more efficient in only two cases: coarse and moderate resolutions with high gas-compression capacity. In all other cases, which are more complex, the Log model attained a considerably better performance, probably a consequence of the logarithmic number of binary variables and extra constraints.\n\u2022\tModels approximated with hypercubes produced solutions with smaller mean errors than simplex approximation models. In spite of having somewhat higher mean errors the models approximated with simplexes produced solutions that, when implemented in the simulator, achieved a little lower benefit (0.47 %) in the moderate resolution, but considerably higher benefits (\\$) in coarse (4.29%) and fine (8.13%) resolutions. The analysis indicates that solutions obtained with simplex approximations can induce better operating points for the oil field, despite the higher mean errors.\n2.7\tSUMMARY AND SYNTHESIS OF CONTRIBUTION\nIn this Chapter, a framework was developed for modeling pressure drops and well production functions with multidimensional piecewise-linear models for production optimization of gas-lifted oil fields. This framework contains several MILP reformulations of the original non-linear optimization problem with approximations based on hypercubes and simplexes. Computational and simulation analyses were performed considering a synthetic however representative oil field modeled with a commercial multiphase flow simulator. Although the problem of optimizing the production of an oil field is\nconsiderably challenging, the results from these analyses can guide operations engineers to implement customized optimization solutions in real-world oil fields.\nThe contribution of this Chapter is about approximating and solving MINLPs that arise from the short-term optimization of oil production platforms. It was shown that the MPWL models are effective tools for modeling complex, nonlinear functions that can be obtained directly from sample or simulated data, and also from proxy nonlinear models. The main contributions of this Chapter can be summarized as:\n\u2022\tA comprehensive study of MPWL models applied to shortterm production optimization;\n\u2022\tA computational analysis of the MILP models for solving the gas-lift distribution optimization problem;\n\u2022\tA simulation analysis to assess the effectiveness of MPWL models with hypercube and simplex domains.\n3\tMODELING OF FLOW SPLITTING IN GATHERING NETWORKS\nIn modern offshore oil fields, wells can be equipped with routing valves to direct their production to multiple manifold headers, a strategy that is routinely adopted in practice either to provide resilience to equipment failure or adjust the well-manifold routings to improve production. However, the existing models for shortterm production optimization do not account for splitting of flows and therefore require the wells to be connected to a single header. This Chapter proposes a nonlinear model of flow splitting in subsea installations that reproduces the complex behavior observed in multiphase-flow simulation. This model is further approximated with multidimensional piecewise-linear functions to a desired degree of accuracy with respect to simulated behavior. This piecewise-linear model enables the development of an MILP formulation for production optimization that automatically decides between single and multiple routing of wells to headers. The effectiveness of this MILP formulation is assessed in a synthetic but representative gas-lifted oil field modeled in a standard simulator. The Chapter is based on the following papers:\n\u2022\tSilva, T. L.; Camponogara, E.; Teixeira, A. F.; Sunjerga, S. (2013): \u201cA Mixed-Integer Linear Programming Model for Automatic Routing Decisions in Oil Production Optimization\"\". In: Proceedings of IEEE International Conference on Automation Science and Engineering (CASE), Madison, USA, 2013.\n\u2022\tSilva, T. L.; Camponogara, E.; Teixeira, A. F.; Sunjerga, S. (2015): \u201cModeling of Flow Splitting for Production Optimization in Offshore Gas-Lifted Oil Fields: Simulation Validation and Applications\"\". Journal of Petroleum Science and Engineering, v. 128, pp. 630-642.\n3.1\tINTRODUCTION\nIn daily operations of oil fields, petroleum engineers conceive production plans to decide upon valve configurations, well-manifold routings, gas injection rates, among others. Optimization tools such as the piecewise-linear approximations presented in the previous Chapter can be used to model complex process functions that are part of decision-support systems, which may help operators in determining optimal platform settings for daily or weekly operations. Although production optimization of oil fields on the short-term is a complex task that has been studied by many researchers [9, 10, 16, 11, 12], in recent developments, mathematical programming approaches have been successfully applied to determine the daily production plans of complex oil fields, like the Urucu Field in Brazil [37] and the Tfoll Field in Norway [17]. Common to these works is\nthe attempt to close the gap between the scientific models and the needs of real-world oil fields.\nDespite flow splitting being a common practice in industrial settings, to the best of our knowledge it is not accounted for by existing mathematical models in the optimization literature, whose works usually impose a single routing from wells to manifolds. Incidentally, flow splitting induced by routing well production to multiple manifolds is a common practice in the Urucu field, a reservoir located in the heart of the Amazon, which is not addressed by the existing models [37]. To this end, this dissertation advances previous works by developing an optimization model that accounts for flow splitting in the gathering system by allowing production from wells to flow to multiple manifolds, a configuration which is being widely used in off-shore fields.\nIn the following Section, a mathematical model is proposed for modeling of flow splitting according with the observed behavior of a commercial multiphase-flow simulator. This model is approximated using piecewise-linear functions and further validated against the simulator. In Section 3.3, a MILP model that accounts for flow splitting is developed for production optimization of a gas-lifted oil field with pressure and routing constraints. Section 3.4 discusses the modeling of a synthetic, but representative field, and proposes a methodology to obtain sufficiently accurate piecewise-linear models for well-production and pressure drops. Further, a computational analysis evaluates the performance of the MILP formulation and analyzes the impact of flow splitting. Finally, the concluding remarks and a synthesis of the Chapter\u2019s contribution are presented in Section 3.5.\n3.2\tFLOW SPLITTING MODELING AND VALIDATION\nA typical offshore production system is composed of subsea wells, manifolds gathering production from wells, and surface facilities. Production wells are equipped with choke valves that control well-head pressure and production, which can benefit from gas-lift to increase the naturally flowing rate. After being gathered by a manifold, the well production is directed to surface facilities in the platform to be processed by a separation unit, which splits the production in three-phase flows: namely, oil which is transferred by shuttle tankers, gas which is compressed and exported in subsea pipelines, and water which is processed before discharge.\nFigure 3.1 illustrates a subsea production system consisting of a single well and three manifolds gathering production. Pressures and flow rates are depicted in the figure denoting the well-head pressure (p\\mathrm{w}h), pressure downstream the choke (pJs), manifold pressure (pm), well production (qn), flow rates in the jumpers (qn\u2019m), and gas-lift rate (qfnj).\nIn such fields, operators usually decide upon the routing of production from wells to manifolds, which are implemented by opening or closing the routing valves. To the best of our knowledge, previous works found in the technical literature enforce the policy of routing wells to a single manifold [17, 37], despite multiple routing being routinely implemented in real-world oil fields.\nIn what follows, a mathematical model for flow splitting is developed in the context of a single well and multiple manifolds. This model can be used to represent flow splitting of wells in complex production networks, encompassing several wells and multiple manifolds.\n3.2.1\tNonlinear Model\nConsider a particular gas-lifted well n of a set \\scrN = \\{1,..., N}. Suppose that well n can send its production to a subset \\scrMn of the manifolds, with \\scrMn \\subseteq \\scrM = \\{1,...,M}. The oil, gas, and water produced by well n can be characterized by the following equations:\ni qn = \\widehatn).(1 - wcutn)\n(Pmathrm{w}h,q?n3 ).GLRn + qfnJ\t(3.1)\n( qmathrm{w}ater = \\widehatl7q (P^O^nj ).WCUT \u201d\nwith \\widehatiq being the liquid production as a function of the well-head pressure and the rate of the lift-gas injection q^-. For the purpose of steady-state production optimization, the Gas-Liquid Ratio\n(GLR) and the WCUT of the reservoir are assumed to be known and constant for weeks.\nThe difference between the well-head pressure and the pressure downstream the choke, p\u201ds, corresponds to the pressure loss due to friction which is related to a particular choke opening. Flows in the jumper connecting well n to manifold m are given by functions as follows:\n=\t\\mathrm{j}n\t(\\mathrm{j}n\tp\u201d\t\\bfp\u201d\t) sp\tsp\tds\tman\t\t(3.2a)\nq\u201d =\tq\u201d\u2019m,\t\t(3.2b)\n\t\t\nqn,m,\t\t(3.2c)\n\t\t\np\u201ds,\t\t(3.2d)\np\u201ds = \\Deltap . ' ..\t,GoR \u25a0\t+ pm, m\te \\mathrm{q}n\t(3.2e)\nGORn,m \u25a0 (1 - WCUTn) = GLR\u201d + (\t\t\n\t\\q\u201dil + q\\mathrm{w}ater\t, (3.2f)\nVm e\nwhere:\n\u2022\t= (q\u201dil,q\u201das,q\\mathrm{w}ater) \\mathrm{d}s a vect\u00b0r with the three-phase flow produced by well n,\n\u2022\tq\u201dp = (q\u201dim, q\u201dam, q^\u2019X) : m \u20ac \\mathrm{q}n) is a vector with the rate of all fluid phases flowing in the jumpers,\n\u2022\tPman = (pm : m G \\mathrm{q}n) is a vector with the pressure of the manifolds receiving production from well n.\nThe three-phase flows in the jumpers are given by the function q\u201dp(qn, Pns, Pman), which depends on the total flow rate qn of well n, the pressure downstream the choke (p\u201ds), and the pressures at the manifolds to which the well is connected (p\\mathrm{m}an). The multiphaseflow simulator iteratively calculates the flow for each jumper based on the pressure differences downstream the choke to the manifold, keeping the same gas-liquid ratio of the well in accordance with Equation (3.2f). Notice that the left-hand and right-hand side of Equation (3.2f) defines a factor that if multiplied by a flow of liquid will produce the respective flow of gas, namely the GLR, for the jumper and the well, respectively. The pressure drops in the jumpers --------------------------------------------n,m\nare calculated by function\t, a behavior which is a consequence\nof flows in the jumpers and resulting pressure differences.\nn,P\nTypically, the functions q\\mathrm{s}p and Deltap\\mathrm{j}p are not known explicitly but rather implemented by simulation software, which iteratively converges to a solution of the system of equations (3.2) that meets Physics laws. More specifically, Equation (3.2f) assures that gas and liquid flow rates in the jumpers are in the same proportion of flows produced by the well, which is also observed in commercial simulators.\nThe set of equations representing the flow splitting phenomena are based on some assumptions: material balance holds, pressure balance holds, and inlet and outlet flows have the same Gas-Liquid Ratio (GLR). Such relations are further approximated and validated against simulation software.\n3.2.2\tPiecewise-Linear Approximation\nDespite being routinely used by reservoir engineers to predict production, the relations implemented by simulation software are either not explicitly known or too complex to be effectively used in mathematical optimization. Alternatively, these relations can be conveniently modeled with multidimensional piecewise-linear functions. The advantage of piecewise-linear models with respect to others is that the former are directly obtained from the sample data, dispensing with the synthesis of proxy models, a task that can itself be rather complex. This means that a piecewise-linear function can approximate a nonlinear function to a desired degree of accuracy provided a sufficient number of sample points.\nOptimization problems involving these functions can be modeled as MILPs and solved with specialized algorithms or generalpurpose solvers, as discussed on Chapter 2. Usually, the latter approach takes advantage over the first since it uses the advanced technology available for solving MILPs [18]. A comprehensive study of available MILP models to represent multidimensional piecewise-linear functions in the context of oil production optimization is found in [38].\nIn what follows, the main idea of this Chapter is presented, which consists of approximating implicit relations used by multiphaseflow simulators to predict splitting of flows as piecewise-linear models. This methodology is then used to optimize the production of a representative offshore gas-lifted oil field.\nMILP Approximation for Flow Splitting\nThe mathematical modeling of flow splitting developed in Section 3.2.1 is interesting for understanding the process, but not suitable for optimization purposes since it relies on implicit functions implemented by simulation software. Herein we approximate such functions using the multidimensional piecewise-linear model based\non specially ordered sets of variables [36, 39] denoted by SOS2, resulting in a MILP formulation. This model was chosen for its simplicity and efficiency for hypercube domains [38].\nThe well production function widehatq(q\\mathrm{i}n,j ,p\\h) \u00b0f a given well n is approximated with the piecewise-linear function . Gas and water production are obtained from the gas-liquid ratio and watercut relations. Equation (3.1) is rewritten as:\n\t= (qi,p\\mathrm{k})\\in\\scrKn\t\u25a0 widehatn(qi,pk) \u25a0 (1 - WCUTn),\n\t=\tAqi,pk cdot widehatn(qi,pk) cdot\t+ qn,\n\t(qi,pk)\\in\\scrKn\t\nq\\ater\t=\t\\lambdanqi,p\\mathrm{k} cdot widehatn(\u00ae,pmathrm{k}) cdot wcutn,\n\t(qi,pk)e\\scrKn\t\nwhere is the set of breakpoints of lift-gas injection rates, scrK\u201d is the set of breakpoints of well-head pressure of well n, and scrKn := scrK\" times . Further, Aq.,pk is the weighting variable associated to the breakpoint (qi,pk) in scrKn.\nThe gas injection rate and the well-head pressure of well n are defined with the same weighting variables \\lambdan used to approximate the production function:\nq\"nj =\tsum\t\u25a0 qi>\t(34a)\n(qi,Pk)e\\scrKn\np\\h =\tsum\tcdot pmathrm{k}\t(34b)\n(?i,Pk)e\\scrKn\nExtra constraints are added to implement the piecewise-linear model SOS2 approximating the well production function (widehatq):\n1\t=\t\u25a0\t(3-5a)\n(q\\mathrm{i},p\\mathrm{k})\\in\\scrKn\n0 leq Aqi,pk, V(qi,pk) inscrKn,\t(3.5b)\n= sum , forallqi inscrKn\t(3.5c)\n= sum \\lambda;\\mathrm{i},pk, \u25a0 inscrKn,\t(3.5\\mathrm{d})\n(\\xiq\\mathrm{i})qie\\scrKi, (\\xip\\mathrm{k})Pk\u00a3\\scrKp are SOS2,\t(3.5\\mathrm{e})\nwhere \\xiqi and\tare auxiliary variables which are used to implement\nSOS2 constraints.\nThe pressure drop \\Deltap\\mathrm{j}P (\u00ab1^\u2122,GORn,m) in the jumper connecting a well n to manifold m is approximated with a piecewise-linear model:\n'-'--n.m\tx\u2014>\t--------n,m\n\\Deltapjp =\t\u25a0 \\DeltaPjp\n(qi,gor)\nwhere scrRn,m := scrRp,m times scrR\\mathrm{g}.\u2019m is the set of breakpoints for liquid flow rates (scrRP\u2019m) and gas-oil ratio values (scrR\\mathrm{g},m') in the jumper, with being the weighting variable associated to each breakpoint (q, gor) in the set scrRn,m.\nResulting flows split from a particular well n are calculated with the weighting variables \\phin\u2019mor associated to the pressure drop n,m approximation \\Deltap\\mathrm{j}p :\ni\tcm =\t\u00ab \u25a0 (1 - wcun,\n(qmathrm{l},gor)\n&lt;qnam\t\\\t\\phimm\u00b0r \u25a0 \u00ab \u25a0 (1 - wcuTn) cdot 50r,\t(3.7)\n(qi,g\u00b0r)E\\scrRn\u2019m\t' '\nCOEr =\t\\phin;m\u00b0r cdot \u00ab cdot wcutn,\n(qi,gor)\\in\\scrRn\u2019m\nNotice that the flows in the jumpers are now explicitly calculated based on the pressure gradients established by the piecewise-linear n,m approximation of the pressure drop function \\Deltap\\mathrm{j}p .\nThen gas-liquid proportions of split flows are kept the same of the well in accordance with an approximation of Equation (3.2f) as follows:\n12\t\\phinm\u00b0r cdot 5or cdot (1 - WCUTn) = GLRn+\n(qi,gor)E\\scrRn\u2019m\nn\nqi?Pk\n(3.8)\n(qmathrm{i},pmathrm{k})\\in\\scrKn\n\\widehatiq (\u00ab ,p\\mathrm{k})\nE\nA\nExtra constraints are added to implement the SOS2 piecewise-linear model which approximates pressure drops in the jumpers for the well-manifold pair (n,m):\n1=\t\\phinm\u00b0r,\t(3.9\\mathrm{a})\n(qi,gor)\\in\\scrRn\u2019m\n\\etan,m =\t\\phinmor, forall\u00ae\t,\t(3.9b)\nn,m gor\\in\\scrRmathrm{g}\n\\etanm = e \\phi^or,\\forallgor\\in\\scrRr\u25a0\t(3.m\n(<\u201d),,m\t\\bigr)gor\\inKtm are SOS2. (3.9d)\nThe auxiliary variables \\etan,m, and are use\\forall \\bigl(0 implement the piecewise-linear strategy with special ordered sets of constraints.\nOne should notice that the model developed for approximating flow splitting for optimization purposes could also be developed with other piecewise-linear models, such as the convex combination models DCC, DLog, CC, and Log; the incremental model Inc; or the multiple choice model MC [38]. Further, the splitting model can be adjusted for other production systems. For instance, in a gas reservoir - like Mexilhao Field which is located in the Santos Basin off the coast of Brazil - the production of wells is not dependent of gas-lift injection, so it suffices to remove the lift-gas contribution from Equations (3.3) and (3.8).\n3.2.3\tSimulation-Based Validation\nThe validation of the mathematical model of flow splitting is carried out by contrasting its behavior against to the behavior observed in a multiphase flow simulator. For this purpose, a small synthetic field is developed and used as a testbed for the experiments.\nSynthetic Field Modeling\nA typical gas-lifted well that was modeled in the multiphase flow simulator Pipesim from Schlumberger\u00ae is illustrated in Figure 3.2. The flow rate of the well can be increased by injecting pressur-\nFigure 3.2: Gas-lifted well in pipesim.\nized gas at the bottom of the production tubing and by choking\nproduction in the well-head, which changes the back-pressure to the well-head.\nThe well has the following attributes: liquid Productivity Index (PI) = 80 STB/d/psi, GLR = 160 sm3/sm3, WCUT = 0.01 sm3/sm3, and reservoir static pressure of 2100 psia. It is assumed that the reservoir characteristics do not vary frequently, and thus the gas-oil ratio, water-cut, and productivity index of the well are constants for the horizon of production optimization.\nThe well is connected to subsea manifolds that represent the submarine equipment, which are typically found in offshore fields. Figure 3.3 illustrates the subsea equipment of a simple offshore\nFigure 3.3: Illustrative Scenario Modeled with Pipesim.\nfield, which consists of a single well flowing production to three subsea manifolds through jumper pipelines with 4 inches of inner diameter, 0.25 inches of wall thickness, and 0.001 inches of roughness. The pipelines B15, B25, and B2 have different horizontal lengths, namely 1 kilometer, 1.25 kilometers, and 1.5 kilometers, respectively.\nSimulation Analysis\nIn this section, a simulation analysis is performed with the goal of evaluating whether the MILP model approximates satisfactorily the flow splitting observed in the commercial multiphase flow simulator.\nThe methodology adopted to assess the degree of accuracy of the MILP model is illustrated in Figure 3.4. The methodology consists of the following steps:\nStep 1:\tBoundary conditions such as pressures in the manifolds\nand lift-gas rates are given as inputs for the simulator,\nFigure 3.4: Splitting simulation analysis.\nwhich iteratively calculates the pressures in the wellhead and downstream the choke, and also the resulting flow rates in the pipelines.\nStep 2:\tFlow rates and pressures calculated by the simulator (qSIM, pS/M) are gjven as references for the splitting model. A feasible solution is calculated by the splitting model for which the infinity norm ||pSPL \u2014 pSIM ||is bounded by the tolerance \\varepsilon. If the difference between the flow rates and pressures estimated by the splitting model and the simulator are equal or smaller than the tolerance, a reasonable solution was achieved and the algorithm stops. Otherwise, the algorithm continues by going to step 3.\nStep 3:\tThe well-production and pressure-drop approximations are refined by sampling well flow rates and pressure drops from simulator for a higher number of breakpoints. The new PWL functions are given as inputs for the splitting model and the algorithm proceeds by returning to step 2.\nThe algorithm was initialized with PWL approximations containing 5 breakpoints per axis and having (q^f, pmathrm{m}fn) = (5200, [150,155,160]') as the boundary conditions. A solution was reached after 3 iterations, with the resulting approximation for the wellproduction function (\\widehaton|) having a total of 289 breakpoints, being 17 for injection flow rates and 17 for well-head pressures. The result\ning approximation for pressure-drop functions (\\DeltaPmathrm{j}p ) also contains 289 breakpoints, namely 17 per axis.\nTable 3.1 presents flow rates in cubic meters per day (sm3/d) and pressures in psia. Notice that the maximum error between the simulator results and the splitting model predictions is less than 2.5%, which was the chosen tolerance for the convergence of the algorithm.\nTable 3.1: Simulation Analysis of Splitting\n\tVariable\tSplitting Model\tSimulator\tError\n\t\t96972.70\t97365.27\t0%0\\%\n\tqZi\t563.45\t565.32\t0.33%\n\t\t5.69\t5.71\t0.35%\nWell\tPmathrm{w}h\t192.83\t190.00\t1.05%\n\tPds\t192.83\t190.00\t1.05%\n\tqn .\t5910.56\t6000.00\t1.49%\n\tq^as\t39644.60\t39710.47\t0.17%\n\tq^\t230.35\t230.57\t0.00%\nManifold 1\tq^ater\t2.33\t2.33\t0.00%\n\tpm\t147.86\t150\t1.43%\n\tGLRn\u2019m\t170.39\t170.51\t0.07%\n\tq^as\t32313.50\t31613.81\t2721\\%\n\t\t187.48\t183.56\t2.14%\nManifold 2\tq^ater\t1.89\t1.85\t0.00%\n\tpm\t153.15\t155.00\t2.16%\n\tGLRn\u2019m\t170.39\t170.51\t0.07%\n\tq^as\t25893.60\t26040.99\t057\\%\n\tqh\t150.45\t151.20\t0.50%\nManifold 3\tq^ater\t1.52\t1.53\t0.65%\n\tpm\t157.62\t160.00\t1.49%\n\tGLRm\t170.39\t170.51\t0.07%\nDespite the errors in optimizer predictions for well flow rates, they are similar to the flows calculated by the simulator (&lt;0.40%), while pressure differences are acceptable (\\leq 1.49%). Flow rate measurements in the manifolds for both optimizer and simulator are small for manifolds 1 and 3 (\\leq 0.65%), while the errors for manifold 2 are aceptable. The pressure predictions have the higher errors, but did not exceed the upper bound on errors (2.5%). Although the approximations are not free from modeling errors, the simulation analysis showed that the proposed formulation can approximate satisfactorily the phenomena observed in the simulator for a given tolerance.\n3.3\tAPPLICATION TO PRODUCTION OPTIMIZATION\nA mathematical methodology to approximate flow splitting in subsea equipment was developed and validated against a commercial multiphase-flow simulator. This methodology is now incorporated into a mixed-integer programming model to optimize a representative offshore production system with multiple routing decisions and gas-lift distribution. The resulting model will be referred to as automatic routing model.\nA typical offshore field consists of a set of wells draining fluids from a reservoir to subsea manifolds which gather production to the compression and separation system of a Floating Production Storage and Offloading (FPSO), as illustrated in Figure 3.5. The flow paths from wells to manifolds are determined by routing valves. When the flow arrives at the platform, the compression and separation system terminal removes the gas from the mixture, which is compressed and exported to an onshore unit or used for gas-lift. The water is treated before discharge, while the oil is stored and then transferred to the coast in shuttle tankers.\nFigure 3.5: Illustrative offshore gas-lifted field.\nThe problem of optimizing the production of an offshore field subject to gas-lift distribution, pressure constraints and multiple routing decisions is considerably hard to solve due to the nature of the production and pressure-drop functions, which are non-linear, along with the discrete variables regarding the activation of wells and routing decisions. To this end, the problem is formulated as an\nMILP program using piecewise-linear models to approximate the non-linear functions.\nDespite being a common practice in real-world oil fields, previous mathematical models avoid dealing with scenarios in which flow splitting takes place due to the complexity involved. The proposed MILP model is able to automatically decide upon the splitting of flows in the subsea pipelines, representing the division of fluids accordingly with commercial simulation software.\n3.3.1\tMixed-Integer Linear Programming Model\nIn this section an MILP formulation is developed to optimize the daily production of an offshore production system subject to gaslift distribution and multiple-routing decisions. The splitting model is incorporated into this formulation, with small changes to support routing decisions and variations on the manifold pressure. The list of sets, parameters, variables, and functions of the MILP formulation appear in Tables 3.2, 3.3, 3.4 and 3.5 respectively.\nTable 3.2: Sets of automatic routing MILP model\nSets Description\n\\scrN\tSet of wells\n\\scrNm\tSubset of wells sending production to manifold m: \\scrNm \\subseteq \\scrN\n\\scrM\tSet of manifolds\n\\scrMn Subset of manifolds receiving flows from well n: Mn \\subseteq \\scrM\n\\scrH Set of phase flows: \\scrH := {oil, gas, and water}\nGas-lift breakpoints\n\\scrKn\tWell-head pressure breakpoints\n\\scrKn\tBreakpoints for approximating\n'\\scrRn,m\tLiquid flow rate breakpoints for jumpers\nGas-oil ratio breakpoints for jumpers\n\\scrRmathrm{p},m\tPressure downstream the choke breakpoints for jumpers\n\\scrRn,m\tBreakpoints for approximating\t: \\scrRf\u2019m X \\scrRn,m\t\\scrRmathrm{p},m\nQm\tLiquid rate breakpoints for the flowlines\n\\scrQm\tGas-oil ratio breakpoints for the flowlines\n\\scrQm\tWater-cut breakpoints for the flowlines\n-\u2014- m\nQm\tBreakpoints for approximating \\Deltap : \\scrQm \\times \\scrQm\t\\scrQm\nTable 3.3: Parameters of automatic routing MILP model\nParameter\tDescription\nqn,L qn,U n.max Pwh n,max Pd' n,max Phipps GLRn\tLower bounds on well n flow for all phases h \\in\\scrH Upper bounds on well n flow for all phases h \\scrH Big-M value for well-head pressure Big-M value pressure downstream the choke Bound provided by the HIPPS Gas-liquid ratio for well n\nWCUT n GLRn,m\u2019 max m,max Qh ' \\bfqm,max qmax qg max ql qmax qw in ax qinj m.S p\t'\tWater cut for well n Maximum gas-liquid ratio for jumper (n, m) Maximum value for the flow of phase h in manifold m Maximum flows for all phases: (qh\u2018\u2019mmathrm{a}mathrm{x} : h \\scrH) Gas compression capacity in the platform Liquid handling capacity in the platform Water treatment capacity in the platform Limit for gas-lift injection Nominal pressure at the separator\nTable 3.4: Variables of automatic routing MILP model\nVariable\tDescription\n\\widetildehn \\bfqn n,m Qh' qn'm Qh qm Cj Pmathrm{w}h Pd\\mathrm{s} \\lambdan \\lambda9inj 'Pwh yn m yman \\xin\tFlow of phase h \\scrH produced by well n All phase flows produced by well n: (\\widetildeh : h \\scrH) Flow of phase h \\scrH sent by well n to manifold m phase flows from well n to manifold m: (qh\u2019m : h \\scrH) Total flow of phase h \\scrH received by manifold m Phase flows received by manifold m: (q\u2122 : h\t\\scrH) Pressurized gas rate injected in well n Well-head pressure of well n Pressure downstream the production choke of well n Weighting variable for the PWL approximation of q\\mathrm{o}\\mathrm{i}i Binary variable indicating whether well n is producing Binary variable indicating if manifold m is active SOS2 variable on gas-lift to approximate\n\\xin\npk\nn,m\n\\phiq\\,gor,p\\mathrm{d}\\mathrm{s}\nn,m\nApmathrm{j}p\nGLRnm\nzn,m\nn,m\n\\etaqi\u2019\n,pn.m \\etagor\n,pn.m \\etaPds\nm\n\\Deltap\nm p\nGORm\nqV1\\mathrm{q},gor,wcut\n\\delta\n\\deltaqiiq\ngor\nm wcut\nSOS2 variable on well-head pressure to approximate\nn,r\nWeighting variable for the PWL approximation of Apmathrm{j}p\nn,m\nPWL approximation of the pressure drop function\nGas-liquid ratio of flows in the jumpers\nBinary variable with routing from well n to manifold m\nSOS2 variable for jumper oil flow rate breakpoints\nSOS2 variable for jumper gas-oil ratio breakpoints\nSOS2 variable for p\\mathrm{d}s breakpoints\nm\nPWL approximation of the pressure drop function \\Deltap Manifold pressure\nGas-oil ratio of fluids received by manifold m\nWeighting variable for the PWL approximation of \\Deltap\nSOS2 variable for the flowline liquid flow rate breakpoints\n\\delta\nSOS2 variable for flowline gas-oil ratio breakpoints\nSOS2 variable for flowline water-cut breakpoints\nTable 3.5: Functions of automatic routing MILP model\nFunction\nDescription\nf\n\\widehatnmathrm{q}(Cj>Pmathrm{w}h)\n\\Deltap\"pm (Cr>g\u00b0rn\u2019m>p\\mathrm{d}s)\n\\DeltaP (qmmathrm{q},GORm,WCUTm)\nObjective function - total oil produced\nWell production function of well n\nPressure-drop in the well-manifold jumper (n, m)\nPressure drop in the manifold m flowline\nThe goal of the optimization problem is expressed in the objective function f as the maximization of the total oil produced in the manifolds:\nm\nmax f =\tqoil.\nm \\in\\scrM\n(3.10)\nAlthough more complex objectives could be readily used by means of piecewise-linear approximation, oil production remains widely adopted arguably for being more easily measured in real-world settings.\nThe production of the wells is given by a piecewise-linear function which approximates the flow rates observed in the simulator, obtained by sampling the production functions for a sufficiently wide range of lift-gas rates\nand well-head pressures. The well-production functions are approximated in the MILP formulation with the following equations:\nFor all n \\scrN :\nn\tn\tn \\widetildeoil\t\\lambdaqi,Pk \\cdot \\widehatliq(qbpk) \u2019\t(1 \u2014 WCUTn),\t(3.11)\n(qi,Pk)escrKn\t\t\nn\tn\tn \\widetildegas\t,pk \\cdot \\widehatliq(qbpk) ' (qi,Pk)inscrKn\tGLRn + qT,\t(3.12)\nn\tn\tn \\widetildewater\t,p\\ \u2019 \\widehatliq (qi,pk, (qi,Pk)inscrKn\t) \u2022 WCUTn,\t(3.13)\nnn qinj =\t\\lambdaqi,Pk \u2018 (qi,Pk)escrKn\t\t(3.14)\nn\tn\ti\tn.max pwh\t\\lambdaqi,Pk '\t1 Pwh (qi,Pk)inscrKn\t\u2022 (1 \u2014 ynX\t(3.15)\nn\tn\tn.max Pwh\t\\lambdaqi,Pk\t\u2014 pwh (qi,Pk)inscrKn\t\u2022 (1 \u2014 ynX\t(3.16)\nyn =\t\\lambdan\\mathrm{i},Pk > (qi,Pk)escrKn\t\t(3.17)\n\\lambdan.,Pk\t0, V(qi,pk)\t\\scrKn,\t\t(3.18)\n\\xin. =\t\\lambdan.,Pk, w\t\\scrKn, PkinscrKn\t\t(3.19)\n\\xiPnk =\t\\lambdan.,Pk,\t\\scrKn qiinscrKn\t\t(3.20)\n(\\xin) crn , (C) care SOS2. SqVqjinscrKp >\tV-'PkEscrKp\t\t(3.21)\nThe well production approximation equations are not omitted here for clarity reasons, although they are quite similar to the PWL approximation of the flow splitting phenomena. Notice that the main differences appear in Equations (3.15)--(3.16) which now have a big-M term to relax the well-head pressure in case of a well shut-in.\nBinary variables (yn) are introduced to express the possibility of shutting in wells, a procedure that may be required for operational reasons or to improve overall system production. When a well is active (yn = 1) its production is bounded by operational limits:\nynqn,L &lt;qn\tqn,Uyn, \\foralln\t.\t(3.22)\nThe well-manifold flow paths are determined by the binary variables zn,m. Notice that the algorithm will decide upon single or multiple routing. Routing from well n to manifold m (zn,m) can only be active when the well\nis producing (yn = 1). Otherwise (yn = 0), the routing from this well is disabled (zn,m = 0, \\forallm \\scrMn).\nIn order to account for the manifold pressure variation in the model, the pressure drops become also dependent of the pressure downstream the choke (p3s). The pressure drops Ap\\mathrm{j}p\u2019 ( q^q\u2122, GORn,m, p\\mathrm{d}\\mathrm{s}) in the jumpers are approximated in the MILP formulation by:\nFor all n \\scrN, m\t\\scrMn :\nn,m\t= \u00a3 (\u00abi,gor,Pds)escrR\t/ n,m \\phiqi,gor,Pds \u2018\tn,m \\DeltaPjp wng^Pdsh\t(3.23)\nn,m qoa =\t= sum (\u00abi,gor,Pds)escrRn\u2019\t/ n,m \\phi\u00abi,gor,Pds ' gl\t\u2022 (1 - WCUTn),\t(3.24)\nn,m gmathrm{g}mathrm{a}s\t= sum (\u00ae,gor,Pds)escrRn\u2019\t/ n,m \\phi\u00abi,gor,Pds ' gl\t\u25a0 (1 - WCUTn) \u2022 gor,\t(3.25)\nn,m g\\mathrm{w}mathrm{a}ter\t= sum Oi ,gor,Pds)escrRr\t\\cdot gl \\cdot WCUTn,\t\t(3.26)\nn Pds\tsum (\u00ae,gor,Pds)escrRn,m\tz n,m \\phiqi,gor,PdB ' pds\t1 pn>max . (1 _ z\t) + pds\t(1\tZn>m),\t(3.27)\nn Pds\tsum\t/ n,m \\phiqi,gor,PdB ' pds\tn.max - pds\t(1 - zn,m),\t(3.28)\n(.9i,9\u00b0r,pdB)escrRn\u2019'\nGLRn +\t\\lambdan ,P\\mathrm{k}\n(\u00abi,Pk)escrKn\n&lt;GLRn,max(1 - zn,m)\ngi\n\\widehat. g--/p\n+\t\u00a3\t\\phinr9or,pdB \\cdot gor \\cdot (1 - WCUTn)\n(\u00abi,9or,Pds)escrRn,m\n(3.29)\nGLRn + sum \\lambdan ,P\\mathrm{k}\ngi\n(qi,Pk)escrKn\n,\t,> -GLRnmathrm{m}mathrm{x}(1 - Znm)\n\u00a3\n+\n\\cdot gor \u25a0 (1 - WCUTn)\n(qi,gor,Pds)inscrRn\u2019m\n(3.30)\nzn,m\nn,m \\phiqi,gor,Pds ,\n(3.31)\n\u00a3\n(qi,gor,Pds)inscrRn\u2019m\n0, V(gi,gor,pds)\t\\scrR\nzn,m\tyn) \\forall'm\nn,m\n(3.32)\n(3.33)\nn,m\n\\etaqi\u2019\nEn,m\n\\phiqi,gor,Pds ,\n\\forallgi\t\\scrRn,m,\n(3.34)\nn,m\n\\etagor\nEn.m\tn,m\n\\phiqi,gor,P\\mathrm{d}s, vgor\t\\scrRg ,\n(3.35)\n\u00a3\n\u00a3\nn,m\tn,m\tn,m\n\\etaPd, =\t\\phiqi,9or,pds , \\forallpds 6 \\scrRp ,\t(3.36)\n1 (Cm)gore\\scrRn>\u2122 > and (CT)PdBe\\scrRn\u2019\u2122 are SOS2.\n(3.37)\nNotice that the pressure-drop approximation equations are similar to the PWL approximation developed in the splitting model with small changes to handle the routing decisions (zn,m).\nThe mass balance of flows produced by the wells and split to the manifolds are imposed by the following vector constraints:\n\\bfqn =\tqn,m>\t\\in\\scrN,\t(3.38)\n\\bfqm =\t\\bfqn\u2019m> Vm \\scrM.\t(3.39)\nEach manifold can handle certain rates of oil, gas, and water which are honored by constraints bounding all of the phase flows:\nqm &lt;qm\u2019max, \\forallm\t\\scrM.\t(3.40)\nThe platform limits on compression, liquid handling, water treatment, and gas-lift are imposed as bounds on the total production of gas, liquid, and water:\nFor all m \\scrM :\nm\tmax qgas\tqg\t,\t(3.41)\nm 1\tm\tmax (qoil + qwater)\tql\t,\t(3.42)\nm\tmax Qwater \u2014 qw\t,\t(3.43)\nn\tmax qinj\tqinj . n\\in\\scrN\t(3.44)\nPressure constraints on subsea equipment are then established:\nFor all n \\scrN :\nPwh\t- Pmathrm{w}imathrm{m}aX (1 - yn),\t(3.45)\npnmathrm{s}\tPm\t+\t+pnrmathrm{x} (1 -\tzn,m),\t(3.46)\npnmathrm{s}\tPm\t+\t- pnrmathrm{x} (1 -\t^n,m),\t(3.47)\n\u25a0\t.\t(3.48)\nA High-Integrity Pressure Protection System (HIPPS) ensures the safety of the production system, establishing a bound (pmathrm{h}i\u2019mathrm{m})mathrm{a}x) on the pressure\ndownstream the choke. Notice that the difference between the well-head pressure (p\\mathrm{w}\\mathrm{h}) and the pressure downstream the choke (p\\mathrm{d}s) gives the pressure loss in the choke.\nPressure drops in the flowlines, which rise the production from manifolds to platforms, are calculated by a PWL approximation of the pressuredrop function Apm(qim1, GORm, WCUTm):\nFor all m \\scrM :\nm \\Deltap\t\\OmegaQliq,gor,wcut \\cdot \\Deltap\t(qliq, gor, WCUt^, (qiiq ,gor,wcut)\\in\\scrQm\t(3.49)\nm 9oii =\t\\Omegaqliq,gor,wcut \u2019 qliq \u2019 (1\twcut)j\t(3.50)\n\t(qiiq,gor,wcut)\\in\\scrQm\t\nqgas =\t\\Omegaqmathrm{l}\\mathrm{n}mathrm{q},gor,wcut ' qliq \u2019\t' (1\twcut),\t(3.51)\n\t(qiiq ,gor,wcut)\\inQm\t\nqwater\t\\Omegaqiiq,gor,wcut \u2019 qliq \u2019 wcutj (qiiq ,gor,wcut)\\inQm\t(3.52)\nm yman \u2014\t\\Omegaqiiq ,gor,wcut j (qiiq ,gor,wcut)\\in\\scrQm\t(3.53)\n\\Omegaqiiq,gor,wcut\t0j V(ql\\mathrm{i}qj\twcut) \\scrQ , zn,m\tymanj\t\\scrNm j\t(3.54) (3.55)\n\\deltaqiiq\ty >\t\\Omegaqumathrm{q},gor,wcutj gor\\in\\scrQm wcut\\in\\scrQm\t(3.56)\n\\deltagor\t\\Omegaqumathrm{q},gor,wcutj qiiq\\in\\scrQm wcut\\in\\scrQm\t(3.57)\n\\deltawcut\t\\Omegaqiiq,gor,wcut j qiiq\\in\\scrQm gor\\in\\scrQm\t(3.58)\n(Cq)\tpo j (\\deltamor)goreeg j (\\deltamcut)wcuteew\tSOS2\t.\t(3.59)\nThe binary variable y\\mathrm{m}an denotes the activation of manifold m. Notice that the pressure drop in the flowlines depend on the liquid flow rate and the proportions of gas and water of the mixture. The manifold pressure (pm) must be equal to the separator nominal pressure (pm,s) to which it is connected plus the pressure drop in the flow m line (\\Deltap ):\t\npm = pm,s + \\Deltap , \\forallm \\scrM.\t(3.60)\nPutting all together, the problem of allocating pressurized gas and deciding upon the routing of wells to separation units is expressed in a compact\nform as:\nP :\nmax f =\ns.t. : Constraints (3.11)-(3.21), Constraint (3.22),\nConstraints (3.23)-(3.37),\nConstraints (3.38)-(3.39),\nConstraint (3.40),\nConstraints (3.41)-(3.44),\nConstraints (3.45)-(3.48),\nConstraints (3.49)-(3.59),\nConstraint (3.60).\n3.4 MODEL SYNTHESIS AND COMPUTATIONAL ANALYSIS\nThis section evaluates the developed framework for flow splitting in a representative offshore oil field, which operates with gas-lift, allows splitting of flows, and is further constrained by physical and operational constraints. A methodology is proposed for the synthesis of piecewise-linear models that satisfactorily approximate the nonlinear process functions.\n3.4.1\tThe Gas-Lifted Oil Production System\nThe synthetic production system was inspired in [16, 38] and modeled in a multiphase-flow simulator, namely Schlumberger@ Pipesim. This system will serve as a testbed for model synthesis and computational analysis. Figure 3.6 illustrates the production infrastructure of this oil field.\nThe wells are topologically divided into three groups:\n\u2022\twells\t1-2 are\t1 km away from manifold 1 and 1.5\tkm from manifold\t2;\n\u2022\twells\t3-5 are\t1 km away from both manifolds;\n\u2022\twells\t6-7 are\t1.5 km away from manifold 1 and 1\tkm from manifold\t2.\nThe pipelines called jumpers are those connecting wells to manifolds, with 4 inches of ID, 0.25 inches of wall thickness, and 0.001 inches of R. The jumpers with 1 and 1.5 km of length are denoted by Ji and J2, respectively.\nThe pipelines called flowlines are the ones sending the production of the manifolds to the platforms. All pipelines have 5.5 inches of inner diameter, 0.5 inches of wall thickness, and 0.001 inches of roughness. The flowlines Fy and F2 have 2.5 km and 2 km of length, respectively. Each manifold has a dedicated platform for sending production. Manifold 1 is connected to the platform by pipeline Fy, while manifold 2 is connected to its dedicated platform by pipeline F2.\nSome assumptions were made on the field simulation model: the reservoir has a constant pressure; GLR and WCUT of wells do not vary during the optimization process; after well flow is split, resulting flows have the\nFigure 3.6: Production system network with gas-lifted wells.\nsame GLR of the flow before splitting. The liquid flow rate of wells behaves according with the equation qi = pi(pr \u2014 pwf) where pwf is the bottom hole pressure, pi is the well production index, and pr is the reservoir static pressure. Well parameters such as GLR, WCUT, pr, and pi are shown in Table 3.6, with the units being sm3/sm3, %, psi, and STB/d/psi, respectively.\nTable 3.6: Well parameters for flow splitting analysis.\nwell\tGLR\tWCUT\tpr\tpi\n1\t70\t1.00\t2400\t22\n2\t52\t2.00\t2650\t25\n3\t62\t1.00\t2550\t29\n4\t60\t1.50\t2500\t30\n5\t65\t2.00\t2450\t27\n6\t70\t1.50\t2600\t31\n7\t55\t1.50\t2350\t23\nThe absolute pressure in the manifolds ranges from 275 to 575 psi depending on the operational conditions, while the nominal pressure at the separators located in platforms 1 and 2 are 125 and 150 psi, respectively.\n3.4.2\tModel Synthesis\nThis section presents a procedure to synthesize mathematical models for well-production and pressure-drop functions adjusted for the synthetic production system. The procedure consists of analyzing the errors of each approximation by comparing the sampled function values and the values calculated by the mathematical model.\nGrid-Fitting Procedure\nIn [38], it is shown that the errors in the optimizer variables can be reduced by introducing more breakpoints in the piecewise-linear approximations, with the disadvantage of increasing computational time and complexity of the resulting problem. This process was generalized by [40] with the development of a simple off-line procedure to reduce the discrepancy between optimizer predictions and simulator estimates.\nAlthough these methods can improve the quality of approximation, they usually increase excessively the model complexity, because unnecessary breakpoints are added to the domain in each step. In this dissertation, we propose a heuristic procedure based on an algorithm proposed by [37] to obtain suitable approximations for optimization purposes. The procedure is outlined in the following steps and illustrated with the example depicted in Figure 3.7:\n1.\tFigure 3.7(a) presents a two-dimensional domain with 4 polytopes, namely \\scrP = {Pi, P2, P3, Pi} for a given piecewise-linear approximation /(x) of a nonlinear function f (x). This approximation is given as input for the refinement procedure.\n2.\tFigure 3.7(b) illustrates the refinement step performed by the gridfitting procedure. The functions values f (x) of central points (x1,\\=1), (x2,\\=1), (x1 ,y2), and (x2,y2) are sampled from the simulator. The function values of the piecewise-linear approximation /(x) are then calculated for the same points by the convex combination of corner vertices. The relative error is obtained by measuring the deviation of the approximation in each polytope:\n\\varepsilonp = \\f(xi,yj) - f\ty)l\nf (xi,y2)\ni1,2\\}\nIf the maximum error max{\u00a3P1, \\varepsilonP2, \u00a32,1, \\varepsilon2,2} is lower than the tolerance, then no breakpoints are introduced and the PWL approximation is considered satisfactory for optimization purposes. Otherwise, new breakpoints are added in the polytopes where the estimated error is higher than the tolerance.\n3.\tFigure 3.7(c) shows the resulting domain after the refinement step is performed for an approximation in which only polytope P3 presents\nFigure 3.7: Procedure to refine piecewise-linear functions.\nan estimated error higher than the tolerance. This polytope was subdivided into 4 polytopes {P3a, P3b, P3c,P3d}, while polytopes P1 and P4 were subdivided into {P1a, Pu} and {P4a, P4b}, respectively. The subdivision of polytopes P1 and P4 is due to the introduction of the new breakpoints X1 and y2 in the PWL approximation, which is composed of the Cartesian product of all breakpoints from both axis. The subdivision of only polytope P3 would be possible with other models for PWL such as CC and DCC [18], instead of SOS2 constraints.\nThis procedure is a simple way for estimating the approximation error of a general PWL function with hypercube domains. It can easily be extended to higher order and different domains.\nModel Analysis\nThe grid-fitting procedure is now used to obtain suitable approximations for the synthetic production system. The well-production function qmathrm{o}ii was approximated with the procedure illustrated above, while the pressure drops Apjp and Ap were approximated with an extension to threedimensional domains.\nThe initial approximation for the well-production \\widetildemathrm{o}il has 5 breakpoints in both domain axes: lift-gas rate and well-head pressure. Table 3.7 shows the errors of the final approximations according with the fitting procedure.\n| and |^Pk | are the number of breakpoints for lift-gas rate and wellhead pressure, respectively. The approximations of well-production functions have a maximum error of 1.86%, mean error and standard deviation are less than 0.50%.\n,m\nThe starting domain of the jumper pressure-drop functions Ap^p contains 125 points with 5 breakpoints in each axis (i.e., ql, gor, and pmathrm{d}s). Table 3.8 shows the resulting errors of the approximations produced by the fitting procedure. The number of breakpoints for liquid flow rate, gas-oil ratio,\nTable 3.7: Well-production approximations\t\t\t\t\t\t\nWell\t\\\\scrKl\\\t\\\\scrKP \\\tMax Error\tMean Error\tStd. Deviation\tIterations\n1\t13\t15\t1734%\t0728%\t0T29\\mathrm{G}\t5\n2\t9\t11\t1.67%\t0.43%\t0.38%\t4\n3\t9\t9\t04%\t0725%\t0)25%\t4\n4\t13\t15\t1.12%\t0.33%\t0.33%\t5\n5\t9\t9\t1786%\t0. |5M\t0.\t4\n6\t5\t5\t0.73%\t0.26%\t0.26%\t2\n7\t5\t5\t1760%\t0744%\t0)44%\t2\nand pressures downstream the choke are represented by the cardinality of the sets |\\scrRy\"'|. \\scrR | , and |\t|, respectively. The final approximations have\na maximum error less than 1.88%, and a mean error under 1.30%, which are smaller than the tolerance of 2.00%. Notice that the approximations for the pressure drops in the jumpers were obtained with fewer iterations than the approximations for the well-production functions.\nTable 3.8: Jumper pressure drop approximations\nWell\tMan.\t\t\t\\\\scrRmathrm{p}\u2019m\\\tMax Err.\tMean Err.\tStd.\tIt.\n1\t1\t9\t9\t9\t1749%\t086%\t0733%\t3\n\t2\t9\t9\t9\t1.54%\t0.90%\t0.34%\t3\n2\t1\t9\t9\t9\t1T6T\\mathrm{G}\t0795%\t0737%\t3\n\t2\t9\t9\t9\t1.63%\t0.96%\t0.36%\t3\n3\t1,2\t5\t5\t5\t1715%\t0774%\t0725%\t2\n4\t1,2\t9\t9\t9\t1760%\t0798%\t0737%\t3\n5\t1,2\t5\t5\t5\t1741%\t0787%\t0732%\t2\n6\t1\t9\t9\t9\tTT63\\mathrm{G}\t0796%\t0735%\t3\n\t2\t9\t9\t9\t1.48%\t0.87%\t0.31%\t3\n7\t1\t9\t9\t9\t1.88'1\t1.301\t0743%\t3\n\t2\t9\t9\t9\t1.48%\t0.87%\t0.31%\t3\nFinally, Table 3.9 shows the approximation erros of the pressure-drop \"\n\\Deltap functions in the flowlines. \u00a1Qi\"l, |\\scrQ\"\" |, and |\\scrQ\"\"| are the number of breakpoints for liquid flow rate, gas-oil ratio, and water cut values. The maximum errors are small (&lt;0.3%), while the mean errors and standard deviations are negligible (&lt;0.03%). For these approximations only 2 iterations were needed to reach an approximation with small errors.\nTable 3.9: Pressure drop approximations in the flowlines\nManifold |\\scrQ\" |\t|\\scrQ\" |\t|Q\" |\tMax Err. Mean Err. Stds. It.\nF1\t5\t5\t5\t0.29%\t0.007%\t0T3%\t2\nF2\t5\t5\t5\t0.09%\t0.004%\t0.02%\t2\nThe grid-fitting procedure was able to find approximations with errors within the tolerance for the well-production and pressure-drop functions, after a small number of iterations. This result shows that the final approximations are representing the well-production and pressure-drop functions satisfactorily.\n3.4.3\tComputational Analysis\nThis section presents a computational analysis to assess the performance of the MILP formulation developed for the production optimization problem, which considers the influence of flow splitting. The production system presented in previous section will serve as the testbed for the experiments.\nAn MILP formulation was developed using the flow splitting model to optimize the daily production of the synthetic field presented in previous section. For the purpose of comparison of MILP formulations with and without flow splitting, a standard single routing model was developed by introducing a new constraint on the binary variables zn,m, which denote the activation of routings from wells to manifolds:\nzn,m\t1, \\foralln \\in\\scrN.\t(3.61)\nBoth formulations were expressed in AMPL [41] and solved with the MILP solver CPLEX 12.6 in a Linux workstation, using an Intel Xeon E5-2665 processor at 2.40 GHz and 40 GB of RAM. After the pre-solve step, the resulting formulations have the following properties:\n\u2022\tAutomatic routing: 10 060 variables, with 14 being binary, 794 linear constraints, and 62 SOS2 constraints.\n\u2022\tSingle routing: 10 060 variables, with 14 being binary, and 801 linear constraints, and 62 SOS2 constraints.\nNotice that with automatic routing, the formulation for the production optimization problem will decide for each well on the splitting of flows (whether its production will be sent to one or more manifolds), whereas single routing will force the production to flow to a single manifold.\nThe analysis evaluates the performance of both automatic and single routing models for three availabilities of gas-lift:\n\u2022\tHigh: the available gas rate is sufficient to inject the maximum rate allowed in all wells simultaneously (24 500 sm3/d).\n\u2022\tMedium: the average gas rate availability (15 500 sm3/d).\n\u2022\tLow: smallest gas rate availability which enables the opening of all wells (14500 sm3/d).\nAll experiments ran within a time limit of 30 minutes. Table 3.10 shows the results obtained by the automatic and single routing formulations.\nTable 3.10: Computational results\nSolving Statistics\nGas-lift\tRouting\tOil Production\tTime (s)\tNodes\tGAP (%)\n\tAutomatic\t2 561.82\t82.32\t12 490\t0.00\nHigh\tSingle\t2523.53\t140.34\t20836\t0.00\nt\\ r t\tAutomatic\t2 556.97\t1800\t470867\t0.20\nMedium\tSingle\t2506.64\t106.88\t19 336\t0.00\n\tAutomatic\t2 523.61\t1800\t196 403\t1.52\nLow\tSingle\t2 482.76\t36.74\t18146\t0.00\nWith the increase of the lift-gas availability, the optimal oil production increased slightly for both formulations. All solutions found by the automatic routing model induced splitting of flows and yielded higher oil production rates (1.50% \u2014 2.00%) in comparison to the single routing. The single routing model was faster for the scenarios with medium and low availability of ga-lift, requiring a reduced number of branch-and-bound nodes to reach the optimal solution. The automatic routing model reached the optimal solution faster in the scenario with high availability of gas-lift. For low and medium lift-gas availabilities, the automatic routing model did not reach the optimal solution within the time limit of 30 minutes. However, the best feasible solutions found for such scenarios rendered higher oil production rates than the optimal solutions found by the single routing.\nTo further illustrate the optimization results, Table 3.11 presents the well settings for both single and automatic routing models for the scenario with high gas-lift availability. This scenario was chosen because both models were able to reach the optimal solution within the time limit. Both solutions\nTable 3.11: Optimal solution per well for the single and automatic routing models with high gas-lift availability.\nWell Single Routing\tAutomatic Routing\nn\t\tqf\tq\\mathrm{o}\t\tqf\tq\\mathrm{o}\n1\t292.63\t2530.10\t345.70\t294.01\t3000.00\t353.94\n2\t281.77\t1682.99\t293.61\t283.85\t1693.59\t289.43\n3\t284.38\t1659.17\t375.81\t272.45\t3250.00\t435.57\n4\t284.59\t1667.92\t305.35\t283.66\t1508.05\t299.64\n5\t290.12\t2129.08\t334.39\t287.28\t1500.00\t317.34\n6\t308.63\t3330.73\t491.75\t308.17\t2500.00\t481.08\n7\t284.44\t3500\t376.93\t271.91\t3000.00\t384.82\nkept all choke valves fully opened, meaning that the pressures downstream the valves (p\\mathrm{d}s) are equal to the pressures upstream the valves, i.e., the well-head pressures (p\\mathrm{w}h).\nIn this scenario, the well-manifold routings suggested by the optimization models were quite different. The single routing model aligned wells 1,\n2, 4, and 5 to manifold 1; and wells 3, 6, and 7 to manifold 2. On the other hand, the automatic routing model suggested different routes, some of them yielding flow splitting: wells 1, 4, and 5 aligned only to manifold 1; wells 2 and 6 aligned only to manifold 2; and wells 3 and 7 splitting their flows to both manifolds.\nThe flow distribution in the gathering network for both the single and automatic routing models is presented in Table 3.12. All flow rates are in standard cubic meter per day (sm3/d). Notice that the automatic routing\nTable 3.12: Optimal flow distribution in the single and automatic routing models with high gas-lift availability.\nWell n\tManifold m\tSingle Routing\t\t\tAutomatic Routing\t\t\n\t\tn,m\tn,m\tn,m\tn,m\tn,m\tn,m\n\t1\t345.70\t26973.40\t3'.49\t353.94\t28926.10\tT58\n1\t2\t0.00\t0.00\t0.00\t0.00\t0.00\t0.00\n9\t1\t293.61\t17262.10\t5.99\t0.00\t0.00\t0.00\n2\t2\t0.00\t0.00\t0.00\t289.43\t17051.00\t5.91\nQ\t1\t0.00\t0.00\t0.00\t181.88\t12746.80\t1.84\n3\t2\t375.81\t25194.60\t3.80\t253.70\t17781.60\t2.56\nA\t1\t305.35\t20267.90\t4.65\t299.64\t19760.00\t4.56\n4\t2\t0.00\t0.00\t0.00\t0.00\t0.00\t0.00\n\t1\t334.39\t24307.90\t6.82\t317.34\t22548.00\t6.48\n5\t2\t0.00\t0.00\t0.00\t0.00\t0.00\t0.00\n\t1\t0.00\t0.00\t0.00\t0.00\t0.00\t0.00\n6\t2\t491.75\t38277.30\t7.49\t481.08\t36688.10\t7.33\n7\t1\t0.00\t0.00\t0.00\t128.80\t8233.32\t1.96136\n7\t2\t376.93\t24547.00\t5.74\t256.03\t16254.20\t3.90\nmodel induces flow splitting in wells 3 and 7, which yields a higher overall oil production when compared to the single routing model.\n3.5 SUMMARY AND SYNTHESIS OF CONTRIBUTION\nA mathematical model was proposed to represent the splitting of flows which is of particular interest in subsea operations. The splitting model was approximated by an MILP model based on multidimensional piecewise-linear functions and validated by contrasting its predictions against to what is observed in simulation software. An MILP formulation was developed for the problem of maximizing the production of a representative offshore oilfield subject to lift-gas distribution, pressure constraints, and multiple routing decisions. Further, a heuristic procedure was designed to obtain well-production and pressure-drop approximations with mean and maximum errors within a given tolerance. The model analysis showed that the approximation errors become smaller than the tolerance after a few iterations of the procedure. This result indicates that the flow-splitting model can accurately reproduce the phenomena observed in multiphase flow simulation. Finally, the com\nputational analysis showed that the standard single-routing model is solved faster than the automatic-routing model, but the latter reached solutions with higher overall oil production rates.\nWhile Chapter 2 discussed mathematical programming tools to approximate nonlinear functions appearing in the optimization of gas-lifted platforms, this Chapter advances previous works by modeling and optimizing the production of oil fields in which multiple routing and the splitting of flows might occur in subsea equipment, often yielding higher oil rates. The contributions of this Chapter can be summarized as:\n\u2022\tA nonlinear model of flow splitting in subsea equipment of offshore production systems;\n\u2022\tA PWL approximation model of flow splitting and its validation against simulation software;\n\u2022\tA MILP model to optimize the gas-lift distribution of an offshore field which allows for multiple routing decisions;\n\u2022\tA computational analysis of single and multiple (automatic) routing models;\n\u2022\tA heuristic procedure (grid-fitting) to refine MPWL approximations.\n4\tNETWORK CONSTRAINED RESERVOIR OPTIMIZATION\nUnlike the previous Chapters which focused on short-term production optimization, this Chapter focus on production optimization in the longterm, which extends from months to a couple of years. A methodology is proposed to optimize the recovery of petroleum reservoirs constrained by production gathering systems. Since full-field implicit simulations are prohibitively costly, reservoir management policies are typically developed with standalone reservoir models, while constraints with respect to the production gathering network are limited or fully disregarded. However, it is well known that the field operation is driven by platform settings and constraints imposed by the network and processing facilities. Therefore, the disregard of such constraints may render unfeasible operational plans in practice, precluding their application in real-world fields. In this dissertation, we propose to optimize oil reservoirs constrained by gathering networks with a multiple shooting formulation, which is a control method suitable for problems with numerous output constraints. This method splits the prediction horizon of the optimal control problem in several smaller intervals enabling the use of decomposition and parallelization techniques. The developed methodology is assessed in a two-phase black-oil reservoir producing to a gathering network with nonlinear constraints regarding the operation of electrical submersible pumps. To demonstrate the method\u2019s capability to handle network constraints, the results of the network constrained approach are contrasted against the conventional unconstrained approaches which neglected the gathering network system. This Chapter is based on the following paper:\n\u2022 Silva, T. L.; Codas, A.; Stanko, M.; Camponogara, E.; Foss, B. A. (2016): \u201cNetwork Constrained Reservoir Optimization\"\". Submitted to the SPE Reservoir Evaluation Engineering Journal on June 2017.\n4.1\tINTRODUCTION\nThe overall benefit of a petroleum field is affected by both the reservoir performance and the deliverability of the production gathering network and surface facilities. But although these systems are intrinsically connected, they are often seen separately by researchers and practitioners. While reservoir engineers seek to maximize the Net Presente Value (NPV) of the field in the long-term, production engineers look for feasible strategies regarding the network infrastructure and processing facilities that maximize the daily or weekly production in the short-term. An accurate prediction of the production process requires full-field simulations, which involve the fluid flow in the reservoir and gathering network, thus an optimal integrated strategy can only be achieved by reconciling these two often conflicting goals.\nThe modeling and simulation tools used for long-term and short-term operations differ in time scale and complexity. On the one hand, costly numerical simulations are performed to forecast the dynamics within the porous media and the reservoir recovery for given well production schemes. However,\nconventional reservoir simulation tools typically do not allow engineers to model a wide range of well and completion designs such as deviated wells and inflow control devices. On the other hand, because the dynamics of the reservoir are considerably slower than fluid flow dynamics in gathering networks, most network simulators often ignore flow transients and adopt steady-state models to represent the production process. Without an integrated strategy, optimal controls calculated with standalone models may render unfeasible operational plans, precluding their application in real-world fields.\nSeveral works in technical literature address short-term optimization problems such as the gas-lift distribution problem with subsea routing and facility constraints [42]. Previous Chapters of this dissertation focused on short-term production optimization. While Chapter 2 addressed optimization tools such as piecewise-linear models to represent well production and pressure drops for short-term production optimization, Chapter 3 proposed a model for flow splitting in subsea equipment of offshore production systems. A brief literature review on short-term production optimization can be found in Section 2.4. Although these approaches may increase production or reduce operational costs in the short-term, they do not account for the impact of the drainage of the reservoir on the NPV - the long-term goal, which may compromise the economic life-cycle performance of the reservoir.\nDifferently from the methods for short-term production optimization, from the long-term perspective, a control method that has been successfully adopted by researchers and practitioners is the Closed-Loop Reservoir Management (CLRM) [43, 44, 45]. This method combines periodic calibration of process models with measured data, and control optimization relying on field simulations to forecast and analyze oil-recovery strategies. The model update part is known as history matching, while the control optimization part is referred to as reservoir optimization. A particular reservoir optimization problem that is widely employed to improve recovery of oil reservoirs and which is addressed in this dissertation is water flooding. It consists in determining water injection strategies to push additional oil towards producing wells and to maintain a steady pressure in the reservoir. With the right choice of well targets the reservoir recovery factor can be considerably increased.\nWater flooding optimization relies on accurate simulation of the recovery process, which is typically computationally expensive since it requires the solution of a system of partial-differential equations discretized in time and space [46]. For fully implicit models, the reservoir states are obtained by performing iterative calculations of fluid flow in porous media to the convergence of mass balance and pressure equations with a high degree of accuracy. The complexity of the reservoir model is thus inherited by the optimization problem because, at each iteration, the optimizer might require several simulation runs. One approach to tackle this problem is the Single Shooting (SS) method. With SS, the optimizer first computes the controls which comprise the space of decision variables and then simulates the control profile to obtain the corresponding states and algebraic variables [47]. Typically, the gradients\nof constraints and objective with respect to the controls are calculated with the adjoint method, which is an efficient alternative to direct methods when the number of decision variables is large. A review of SS methods for reservoir optimization can be found in [48].\nOne challenging aspect regarding reservoir optimization is the handling of output constraints, which ensure that the field production meets processing limits on the surface facilities and the wells operate without damaging the formation [49, 44, 50]. However, such methods typically do not account for fluid flow interaction between the reservoir and the production gathering system, disregarding network constraints that could render the proposed plans infeasible in practice [51]. During the life cycle of petroleum fields, the pressure required by the production gathering system will significantly impact on well productivity, specially in offshore fields which typically produce to complex networks.\nOne alternative to deal with output constraints is the adjoint gradient computation together with the Augmented Lagrangian method [52, 51]. However, this method may be difficult to tune with a large number of output constraints. Recently, the reservoir optimization problem was tackled with the Multiple Shooting (MS) method [53]. In this approach, the production horizon is divided into several time frames or shooting intervals, each of which contains independent initial conditions for state and control variables. This method allows to enforce output constraints because intermediate states and controls are explicitly given in the mathematical formulation, becoming available during the optimization. Since the production horizon is divided in several independent intervals, network constraints can be instantiated in parallel to ensure the consistency of the long-term strategy with the gathering network system, similarly to the way constraints are handled in short-term optimization.\nIn this Chapter, a MS formulation is proposed to reconcile the shortterm and long-term strategies with a methodology that takes into account network constraints in reservoir optimization. The MS formulation together with a gradient-based optimization method enables the use of parallelization techniques and a scalable method to handle output constraints arising from the production gathering network. Further, while the fluid transients are represented in the reservoir domain, fluid flow is assumed to be at steadystate conditions in the production gathering network. Main goals of this Chapter are:\n\u2022\tA framework to model fluid flow from the reservoir to production gathering networks at steady-state conditions;\n\u2022\tA methodology to account for network constraints in water-flooding optimization using a scalable gradient-based method;\n\u2022\tNumerical and simulation analyses of network constrained reservoir optimization strategies.\nThe rest of this Chapter is organized as follows. The following Section presents a brief literature review on the coupling of network and reservoir\nmodels. Section 4.3 presents models and simulation methods for reservoir and production gathering networks. Section 4.4 presents a MS formulation for reservoir management which accounts for network constraints. Section 4.5 presents a numerical and simulation analysis of water-flooding problems constrained by the network. Section 4.7 presents a summary of the results and a synthesis of the contribution.\n4.2\tBRIEF LITERATURE REVIEW\nSeveral works have addressed the coupling of network and reservoir models. Gokhan et al. [54] developed an implicit coupling of a 3D black-oil reservoir simulator with a general-purpose network simulator. Schiozer [55] proposed a domain decomposition strategy to improve performance of implicit full-field simulations. Tingas et al. [56] developed an integrated reservoir and surface network simulation to improve production management of gas fields in the North Sea. Kosmala et al. [57] developed a coupling control tool for reservoir and production management of an integrated production system. Davidson and Beckner [58] connected a facility network model with an inhouse reservoir simulator using an explicit coupling in which the reservoir conditions are held constant at the beginning of each time step. Coats et al. [59] modeled and formulated a black-oil and compositional fully coupled surface and subsurface simulator. Rahmawati et al. [60] coupled a network simulator with a reservoir simulator to optimize the integrated production using a derivative-free method. Gao [61] investigated the effects of coupling surface and subsurface models on production forecast. Such approaches for coupling reservoir and network simulation models vary in terms of the degree of accuracy and computational effort, which may become prohibitive for complex production systems.\n4.3\tPETROLEUM PRODUCTION PROCESS\nThe production process of hydrocarbons involves fluid flow in the reservoir, wells and gathering network system. The governing laws and dynamics in the reservoir are described with a set of differential equations and some boundary conditions, while the fluid flow in the production gathering network is represented with a set of equations ensuring mass and momentum balance. The network flow is assumed at steady-state conditions since the dynamics of fluids flowing in the reservoir are considerably slower than the transients of the fluids in the network. Since Electrical Submersible Pump (ESP) models are used in the examples that will be presented afterwards and since these represent complex nonlinear constraints, as opposed to for instance a pressure drop constraint, they are presented in some detail.\n4.3.1\tReservoir Model\nThe reservoir model consists of a set of differential equations representing the simultaneous multiphase fluid flow in a porous medium. An undersaturated oil reservoir model was adopted in this dissertation, which means that pressure remains above the bubble point pressure during the whole prediction horizon, thus there is no gas liberation from the oil in the formation. The fluid model employed is of black oil type and the solubility of water in the oil and gas phases is neglected. Based on the mass conservation principle, the Darcy law and the capillary pressure physical principle, the set of differential equations which describes the fluid flow in porous media is [46]:\n= nabla (TPnabla\\PhiP) + TTp,\tescrP,\t(4.1a)\n\\bfTP =\t. k,\tp e scrP,\t(4.1b)\nP'p-Dp\n\\PhiP = pp - -\\rhorllsll^>\tpeP,\t(4.1c)\nSw + So = 1,\t(4.Id)\nPc,w = Po - p-w,\t(4.1e)\nwhere:\n\u2022\t<f> is the rock porosity.\n\u2022\tSp is the saturation of phase p.\n\u2022\tBp is the formation volume factor of phase p.\n\u2022\tqp is the standard volumetric flow of phase p which can be injected or produced by the wells.\n\u2022\tP = {o, w} is the set of phase flows, namely o for oil and w for water phase.\n\u2022\tkr,p is the relative permeability of phase p.\n\u2022\tpp is the viscosity of phase p.\n\u2022\tk is the reservoir-rock absolute permeability.\n\u2022\tpp is the absolute pressure of phase p.\n\u2022\tpp is the density of phase p at standard conditions.\n\u2022\t||g| | is the absolute value for gravity.\n\u2022\tz is the height value, with the same direction of gravity.\n\u2022\tPc,w is the capillary pressure difference between oil and water phases. This set of equations is valid in the reservoir domains Q C R3. Eq. (4.1a) is the mass conservation equation for each phase flow. Eq. (4.1b) defines the transmissibility of the fluid Tp, which is a measure of the fluid ease to flow,\nvarying with the fluid mobility . Eq. (4.1c) defines the phase potential, which determines the flow directions. Eq. (4.1d) defines that the wetting and nonwetting phases jointly fill completely the void volume of the porous medium. Eq. (4.1e) defines the capillary pressure as the difference between the pressure of oil and water phases. Notice that the pressure in the wetting fluid is less than that in the nonwetting fluid because of the curvature and surface tension of the interface between the two phases.\nEq. (4.1a) is discretized in space and time with the control-volume finite element method [46] and backward Euler implicit-integration scheme respectively. Well equations are introduced to represent the fluid flow in the well grid blocks accordingly [62]. The solution of this system of equations is the reservoir simulation output, i.e., the well flows qp and pressures, and the pressure of oil po and saturation of water Sw in the time range (t0,tf) for given initial conditions po(to) and Sw(t0).\nBoundary conditions are established for the reservoir simulator both on well flows and bottom-hole pressures, which are corrected with Newton steps. In every iteration, first, pressure conditions are imposed, and then the rates are calculated. If the rates are higher than the specified rates, the pressures are increased until the specified rates are delivered; otherwise, the pressures are used as boundary conditions. There are also no-flow boundary conditions which are imposed on the cell walls located at the periphery of the reservoir.\nReservoir Simulation\nThe reservoir model is implemented in the fully implicit black-oil solver Matlab Reservoir Simulator Toolbox (MRST) which is suitable for developing new simulation and optimization methods [63]. The reservoir domain Omega is divided in a set of grid blocks \\scrG according with the spatial discretization scheme. The state variables xk denote the pressure of oil (p\\bfv) and saturation of water (S^) in the grid blocks at each time instant k G \\scrK. To improve the notation readability, algebraic variables vk are introduced to the formulation to denote system features which are not part of the reservoir state. These variables represent the bottom-hole pressures and phase flow produced or injected by the wells.\nThe simulation is performed for given reservoir initial conditions \\bfxk-1 = (p\\bfv,S^),i G \\scrG at the beginning of each time step. The MRST solution for the simulation step consists of the state xk = (p\\bfv, S^) ,i G \\scrG, and algebraic variables vk = (qW ,pWh) , p \u20ac \\scrP, w G W at the end of the time step that satisfy the set of equations: s\n0 = R\\mathrm{c} (\\bfxk-i, \\bfxk, \\bfvk)\t(4.2a)\n0 = Qw(\\bfxk, \\bfvk)\t(4.2b)\n0 = B(\\bfvk, \\bfuk)\t(4.2c)\nwhere:\n\u2022\t\\scrW is the set of wells and \\scrGw is the set of grid blocks containing perforations of well w G \\scrW.\n\u2022\tRc(-) is the system of equations (4.1a)-(4.1e) after discretization in time and space, and inclusion of well equations.\n\u2022\tQw(\u2022) models the total well rates as the contribution of different inter-\nvals of perforations within the same wellbore in the reservoir. It relates the algebraic variables denoting well flow variables \\bfvk to the their corresponding perforation flow variables. The total well flow is attributed to the summation of perforation flow rates of the well: 0 \u2014 q'^p \u2014\tQp,k,\niesw\np E \\scrP, w G \\scrW, where qp,k is the flow of phase p in the perforated grid blocks i at time instant k, and q^p is the total flow of phase p of well w.\n\u2022\tB(-) links the well algebraic \\bfvk to the corresponding well control targets uk. Typically the well control is a fixed bottom-hole pressure or a constant flow rate during the time step.\nMRST solves iteratively the system of equations (4.2a)-(4.2c) with the Newton-Raphson method. Most computational effort inherited by the optimization problem lies on the solution of this system of equations, thus an efficient approach is key for the success of the methodology. Although implicit formulations allow arbitrarily large time steps because stability is ensured, there is a limitation on the time step size due to accuracy requirements. We adopted the IMplicit Pressure-Explicit Saturation (IMPES) scheme, meaning that pressure and saturation equations are solved separately, which allows for an implicit update of pressures and stable explicit update of saturations for the same time step size.\n4.3.2\tNetwork Model\nFluid Flow in Production Gathering Network\nThe study of flow performance in gathering networks relies on models that implement mass, momentum and energy conservation equations. Additionally a fluid model relates fluid properties with certain pressure and temperature conditions. The equations that describe the multiphase flow at steady-state conditions in production networks are derived in what follows.\nDepending on the pressure and temperature conditions, gas flows might appear even in systems producing two-phase fluids at surface conditions. For this reason, an important aspect in multiphase flow is accurate identification of different flow regimes, i.e., geometrical distributions of gas and liquid mixtures such as bubbles or slugs in liquid, liquid droplets in gas, or segregated liquid and gas layers. These flow regimes impact on the pressure drops in the flowlines of the production system [64, 65]. Another key effect is the occurrence of slip between the liquid and gas phases caused by the different velocities between the phases, where typically liquid flows slower\nthan gas. When there is slip between the phases, the pipe volume may be mostly occupied by liquid (i.e. high liquid holdup) which causes additionally hydrostatic pressure losses due to high mixture density.\nIn an attempt to reduce complexity of representing mixture flow, the multiphase flow dynamics can be represented in separate equations for gas and liquid phases, and common force terms at the interface. This approach yields realistic results for flow regimes with a very distinct inter-phase such as stratified flow. However, for other flow regimes that do not have a sharp interface, this two-fluid model becomes too complex thus a different approach is followed. Herein, a dynamic model of mass and momentum equations is derived with a semi-empirical method for the gas-liquid mixture, considering additional closure equations which relates the mixture and single phase velocities with their corresponding densities [66]. The governing equations for two-phase flow are:\n\\partial(\\rhom\\num)   \\partial\\rho \"\nds\t\\partialt\n\\partial(\\rhom\\num)\t\\partial(\\rhom\\num)\t\\partialp | Fg Ff\n\\partials _ \\partialt\t\\partials + ~A + ~A\n\\rhom\n\\num\n\\rhog\n\\rhoo\nPm (\\rhog, Pl) \\num(\\nug, \\nul )\npg,sc + rs ' \\rhoo,sc\nBg\nRs ' \\rhog,sc T\no,sc\n(4.3c)\n(4.3d)\n(4.3e)\n(4.3f)\nB\no\nwhere:\n\u2022\t\\rhow, pg, and po are the densities of water, gas and oil, respectively.\nThe densities of oil and gas at surface conditions are po,sc and pg,sc. The water density \\rhow is assumed constant in the production system regardless of the pressure and temperature conditions. The liquid density \\rhol is determined with the aid of the liquid mixing rule: \\rhol _ fo \u2022 \\rhoo + fw \u2022\t, where fo and fw are the oil and water volume fractions,\nrespectively.\n\u2022\t\\num, \\nug, and \\nul are the fluid velocities of the mixture, gas, and liquid flow respectively.\n\u2022\tBg is the wet gas formation volume factor; Bo is the oil formation volume factor; Rs is the solution gas ratio; and the solution oil-gas ratio rs. These are parameters from the volatile black oil model which is a two-component model that accounts for compositional variation in volumetric properties in both the oil and gas phases. Such parameters are a function of pressure and temperature conditions, meaning that they are part of the Equation of State (EOS) model of the fluid and can be obtained from collected data and black-oil correlations.\nEq. (4.3a) is the mass conservation equation. The momentum conservation is expressed in Eq. (4.3b). Density and viscosity of the mixture are obtained with Eqs. (4.3b) and (4.3c) respectively. The fluid behavior was expressed in terms of volatile black-oil properties, as expressed in Eqs. (4.3e) and (4.3f).\nAssuming steady-state flow and that there is no change in oil composition, meaning that a black-oil model is used, the pressure profile with the spatial position s of the pipeline can be written as [67]:\ndp ds\np\tdv\n= \u2014 Sln \\theta \u2014 2dfv|v|\u2014 \\rhoVTs\n(4.4)\nwhere:\n\u2022\tThe first term is the head loss or gravity loss which is the static change in pressure caused by the change in the pipe\u2019s elevation. In vertical pipelines, it is usually the most important component, but can be neglected in near-horizontal pipelines.\n\u2022\tThe second term refers to the frictional loss which is caused by the dissipation of energy by viscous forces in the fluid. This value changes with fluid properties, flow regimes and fluid velocities.\n\u2022\tThe third term represents the acceleration loss which is caused by changes in fluid momentum in the well during the expansion phase. Typically this term is less important, but it might be more relevant for wells with high gas-liquid ratio.\nThe friction factor f was estimated using a correlation from the Moody chart [68], after calculating the slip between the liquid and gas phases and the liquid holdup with a correlation for inclined pipes proposed by [69]. An implicit Colebrook equation can be adopted to calculate the friction factor for turbulent flow regions [70]. A comprehensive study of several correlations for determining fluid properties, flow regimes and pressure gradients in inclined pipelines can be found in [66].\nElectrical Submersible Pumps\nMultiphase flow in production networks relies on accurate calculations of fluid properties, geometrical flow patterns and pressure drop gradients in the pipelines of the production gathering system. However, other equipment in the network such as compressors, pumps and chokes may also impact on the productivity of the system. An ESP is a particular type of equipment which has been used as an artificial-lift mechanism to improve production from fields with complex wellbore environments.\nAn ESP is a multistage centrifugal pump which is installed at the bottom of a well to improve performance or to enable the production from reservoirs with heavy or viscous fluids. An ESP consists of a motor powered by an alternating electric current from the surface that spins a pump at the\nFigure 4.1: ESP-lifted well [3].\nbottom of the well lifting fluids to the surface. The power source at the surface may operate at a fixed frequency, or it can be adjusted over a range of frequencies using a variable speed drive that alters the frequency of the current and thus the rotational speed of the pump.\nA mechanical layout of an ESP-lifted well is shown in Figure 4.1. The ESP is hosted in a casing which is placed inside the tubing, close to the bottom-hole of the well. The height H1 represents the length of the casing holding the ESP, and H2 is total depth of the well down to the producing formation. The pipe sections H1 and H1 \u2014 H2 might have different features and thus in mathematical models they can be modeled as different pipes with a connection downstream the pump casing.\nThe relationships in the wellbore and gathering network are described in terms of pressures and flow, which is convenient because producing formations are driven by pressure. In centrifugal pumps, however, the performance is usually described using head, i.e., the elevation difference between the liquid column at the inlet and the outlet. Thus the pressure difference delivered by the pump is calculated by multiplying the head times the density of the pumped fluid. For a given ESP pumping a fixed flow rate at a specific rotational speed, the output head is constant regardless of the density of the fluid being pumped. However, the pressure output and the shaft horse power required to drive the pump will change in direct proportion to the density of the fluid.\nFigure 4.2 shows a typical ESP performance curve. Its safe operation involves keeping the pump operating within the green region, the so-called\noperating envelope, which is typically determined in terms of well inflow and pump head boundaries. The region is bounded in the y-coordinate by head limits which vary with the frequency of the pump, and in the x-coordinate by the up- and down-thrust limits which represent the boundaries for well flow rate at different frequencies. Typically ESP vendors provide a reference frequency f0 and the corresponding head curve for it, which is drawn in blue in Figure 4.2. Moreover, the ESP vendors also provides the well flow bounds (qmathrm{L}0, qmathrm{U}0), and the pump head limits (Hmathrm{L}0, Hmathrm{U}0) for the reference frequency. Several ESP models are available in the industry for different well production potentials and fluid properties [71].\nThe handling of ESP constraints demand the inclusion of nonlinear constraints in the optimization formulation which will be presented in detail afterwards in Section 4.4. These constraints increase the complexity of the optimization problem and also impact on the computational time of the simulations. The main reason for this increase in complexity is the extra time needed to solve the ESP nonlinear system of equations and the calculation of nonlinear boundaries regarding of the ESP operating envelopes at every time step (see Figure 4.2).\nGraph-Based Formulation\nThe topology and features of the production gathering network are represented with a graph-based formulation. The description in the format of graphs is suitable to describe heterogeneous networks consisting of wells, manifolds, choke valves and processing facilities, and follows standard network-flow models [72]. Graph-based formulations were recently applied to model mass and momentum balance equations for short-term production optimization [37, 73].\nThe gathering network is denoted by a directed graph G = (V, E),\nwhere V is the set of vertices representing the junctions, and E is the set of edges representing the pipelines or equipment of the network . The well inflows are source nodes (Vsrc) and the inlet of the surface facilities are the sink nodes (Vsnfc). The subset of interior nodes Vlnt contains the vertices which are neither sources nor sinks. The edges represent pipelines or equipment of\nTable 4.1: Network Graph Sets.\nSet\tDescription\nV\tSet of vertices of the production network.\nVsrc\tSet of source vertices in the network. Vsrc \\subset V\nVsnk\tSet of sink vertices in the network. Vsnk \\subset V\nVini\tSet of interior vertices in the network. Vini = V \\ (Vsrc U Vsnk)\nVg\u201d\tInlet vertex of edge e, i.e., Vmathrm{e}\u201d = \\{i : e = (i, j) E}\nV\\mathrm{k}ui\tOutlet vertex of edge e, i.e., V\\mathrm{k}ui = \\{j : e = (i, j)\tE}\nE\tSet of edges of the production network.\nEpipe\te\\mathrm{G}ges \u00bfeno\\mathrm{E}jng pipelines in the network.\nEeqp\tSet of edges denoting equipments in the network.\nEsrc\tSet of edges leaving a source node in \\mathrm{V}src, i.e. E\\mathrm{v}rc =\tE\u00b0ui\nievsrc\nEsnk\tSet of edges entering a sink node in Vsnk, i.e. Esnk =\tEf\nE\\mathrm{v}\u201d\tSet of edges entering node vertex i, i.e., E\\mathrm{v}\u201d = \\{e : e = (i, j)\tE}.\nSet of edges leaving node vertex i, i.e.,\t= \\{e : e = (i, j)\tE}.\nthe network such as choke valves, electrical submersible pumps or separators. The edges are associated with physical properties of the network component such as pipe diameter or pump horse power. An edge belongs either to the subset Epipe if it represents a pipeline or to the subset Eeqp if it represents an equipment. A summary of the graph sets is presented in Table 4.1.\nAn illustrative gathering network and its corresponding graph are depicted in Figures 4.3(a) and 4.3(b). This network contains two production wells, comprising the set of source nodes Vsrc = {v1, v2}; and one sink representing the surface facilities, denoted by the set Vsnfc = {vs}. The subsea manifold and other junctions of the network are the interior nodes which are denoted by the set Vlnt = {V3, v4, v5, v6, v7}. The pipelines and flowlines of the network are in the set of pipe edges Epipe = {e1, e3, e4, e6, e7}, while the chokes of the network are represented by the special edges in the set Eeqp = {e2, es}.\n(a) ) Gathering Network\t(b) ) Network Graph\nFigure 4.3: Illustrative gathering network\nNetwork Simulation\nThe fluid flowing in the network is simulated by a function that computes the flows and pressures in the network for some given boundary conditions imposed by its neighboring systems, namely the surface facilities and the reservoir. The downstream conditions are the pressures at the inlet of the separators, which are kept at fixed values. The upstream conditions are the pressures and flows at the bottom of the wells, which are output from the reservoir simulator and are kept fixed during the network simulation. This means that we are solving explicitly the network equations after convergence of the reservoir equations, thus the controlled variables of the integrated production system are in the reservoir domain.\nThe simulation variables are the pressures at the vertices and the flows in the edges, as shown in Table 4.2. These variables are computed based on\nTable 4.2: Network simulation variables\nVariable\tDescription\nP\\mathrm{v}\tPressure at vertex V V.\nqe,p\tFlow rate of phase p \\scrP in edge e\tE.\nqe\tMultiphase flow in edge e.\nthree principles:\n1.\tMass Conservation: the flow entering a node must equal the flow leaving it, meaning that there is no accumulation of fluid in any internal node of the graph.\nqe \u2014\tqe = 0, Vv e Vint\t(4.5)\ne\u00a3Emathrm{v}n (v)\te\u00a3Emathrm{v}ui (v)\nEmathrm{v}n(v) is the set of edges reaching node v, and Emathrm{v}ut(v) is the set of edges leaving it.\n2.\tMomentum Conservation: The pressure drop gradient over an edge e = (i,j) is a function of the multiphase flow crossing it and the pressure boundary conditions of the pipeline.\nApe = Ape q. .o\t(4.6mathrm{v})\nApe = pi \u2014 pj\t(4.6b)\nwhere Ape is the pressure drop function. Notice that the pressure drop is precisely the pressure difference between nodes i and j, and that its value depends partly on the pipeline properties and geometries.\n3.\tBoundary Conditions: some boundary conditions are imposed to the network simulation. The upstream boundary conditions refer to constant pressures or flows at the bottom of the wells which are computed in the reservoir simulation. The downstream boundary conditions are given by the surface facilities, typically a constant pressure at the inlet of the processing unit.\nAn efficient procedure is described in Algorithm 1 to compute flows and pressures in a network G for given upstream (vw) and downstream (ps) boundary conditions. The procedure receives as inputs the network graph G, the well algebraic variables v\\mathrm{W} with the pressures and flows which were output from the reservoir simulation, and the constant pressures at the inlet of the separators ps in the surface facilities. It starts by assigning the bottomhole pressures (BHPW) and well flow rates (qw) with function \u00a3(.), which receives the network graph G and the well algebraic variables vw as inputs (see line 2). Function \\zeta(.) computes a binary matrix (M) that maps the source nodes to the edges of the graph (see line 3). This matrix has |Vsrc| rows and |E| columns and is built according with the rule: position (i, j) of the matrix takes on value 1 if edge j receives flows from the source node i, and 0 otherwise. The boundary conditions for the simulation are imposed by assigning the corresponding well bottom-hole pressures and separator pressures in the network (see lines 4 and 5). The flow rates in all edges of the network are computed with a linear operation of the well flow rates vector and the matrix M (see line 6). The initial set of active edges for the calculation of pressure drops is established as the set of edges leaving the source nodes and the edges reaching the sinks excluding the equipment edges (see lines 7-8). The while loop (see lines 9 to 20) computes the pressure drops in all edges, except the ones representing network equipment, since their pressure\nAlgorithm 1 - Network Simulation\n1: function NETSIMULATION(G, vw, ps)\n2: 3: 4: 5: 6: 7: 8: 9:\tBHPW, qW leftarrow \\xi(G, Vw) M leftarrow&lt;(G) pv(Vsrc) leftarrow BHPW pv(vsnfc) leftarrow ps qe(E) leftarrow MT X q\\mathrm{W}\t\\triangleleft Flows computed with a linear operation. leftarrow \\mathrm{E}out(ysrc) setminus \\mathrm{E}\\mathrm{e}qp \\mathrm{E}down leftarrow\t \\mathrm{E}in(ysnk) setminus \\mathrm{E}eqp while Eup cup Edown = emptyset do\n10:\tj \\mathrm{E}down\n11:\tvk leftarrow vin U \\mathrm{V}out\n12:\tVk+1 leftarrow V\\mathrm{W}ut(Eup) U V\\mathrm{e}n(Ein)\n13:\t\\deltae(Eup) leftarrow -1T\n14:\t\\deltae(Edown) leftarrow 1T\n15:\tPv(Vk+1) leftarrow pv(Vk) + diag(\\deltae(\\mathrm{E}\\mathrm{k})) times Ape(qe(Ek), pv(Vk))\n16:\tVin leftarrow V\\mathrm{W}ut(Eup)\n17:\tyout leftarrow  yin(\\mathrm{E}down)\n18:\tEup leftarrow E\\mathrm{v}ut(Vin) setminus Eeqp\n19:\t\\mathrm{E}down leftarrow\t \\mathrm{E}in(yout) setminus \\mathrm{E}eqp\n20:\tend while\n21:\treturn pv, qe\n22: end function\ndrops are obtained as the difference between the upstream and downstream pressures, after the network simulation procedure. Ek, Vk, and Vk+1 are respectively the set of active edges and their corresponding inlet and outlet vertices (see lines 10-12). A negative sign (\\deltae) is assigned to the edges in which the pressure propagation is in upward direction, while a positive sign is assigned to the edges with a backward pressure direction (see lines 13-14). The pressure drops are calculated concurrently in all active edges and the resulting pressures are assigned to the outlet vertices (see line 15). A walk step is performed in the network, meaning that the subsets of active inlet and outlet vertices, and the corresponding subsets of active edges which reach outlet edges or leave inlet edges are updated (see lines 16-19). The algorithm converges after visiting once all non-equipment edges of the network , which is the stopping criteria of the procedure. In the worst case, the equipment edges are at the tip of the branchs and the procedure will compute the pressure drop in a single edge in each iteration up to the equipment edge. Therefore, the the computational complexity of the algorithm is O(E \\ Eeqp). However, when the number of wells grows and the number independent branches in the\nnetwork increases, the procedure becomes more efficient because several edges are evaluated simultaneously. At the end, the function return the pressures at the vertices and the flows in the edges as outputs (see line 21).\n4.4\tRESERVOIR CONTROL OPTIMIZATION\nReservoir control optimization involves the use of mathematical models to improve the reservoir management strategy and increase oil recovery performance. We address a particular optimization problem commonly referred to as water-flooding, which is a secondary recovery method that has been successfully employed by researchers and practitioners to maximize long-term gains. In water-flooding, water is injected into the reservoir in order to sustain its pressure and displace the oil from the pore spaces towards the wells. The main challenge is to calculate the water allocation in such a way to maximize the recovery factor and delay water break-through producing wells. To this end, it is necessary to impose constraints on the states and algebraic variables, i.e. the output constraints, which require expensive process simulations and gradient calculations in order to ensure feasibility of operational strategies regarding water handling capacity and other constraints in the processing facilities.\nHerein, the water-flooding optimization problem is formulated as an optimal control problem in which the reservoir states change with well controls in a given prediction horizon. The controls are bottom hole pressures or flow set-points for the production and injection wells, and the long-term objective is the maximization of the cumulative sum of present values of cash inflows and outflows, namely the NPV. Well locations are not part of the optimization but parameters which are determined a priori.\n4.4.1\tMultiple Shooting Formulation\nMS [74] is a well-known optimal control formulation which was recently employed to optimize water-flooding processes with several output constraints [53]. In MS, the prediction horizon is split into K time frames or shooting intervals in place of a single interval as in SS. Each shooting interval has its own independent initial conditions and control variables, thus the state and auxiliary variables becomes available explicitly in the optimizer at the interval boundaries of the prediction horizon. As a consequence, output constraints can be readily handled in the MS formulation by imposing linear bound constraints on optimization variables which are available at the boundaries of the shooting intervals. Further, the MS formulation is attractive because the shooting intervals can be simulated in parallel, opening opportunities to consider output constraints in a much broader scale than currently.\nFor given initial conditions, each shooting interval has a final-state variable xf = (\\bfxk, k e scrK) denoting the reservoir state at the end of the interval which must coincide with the initial states x = (xk, k e scrK+) of the\nnext time frame, where Theta+ = {2,. . ., K +1} and Theta = {1,. . ., K\\}. A set of additional algebraic variables v = (vk, k G Theta) are introduced to represent well flows, bottom-hole pressures and other information regarding network equipment. The algebraic variables are divided into well (vw) and network (vn) algebraic variables. One can only impose output constraints at the boundaries of the shooting intervals, therefore we assume for simplicity that shooting intervals coincide with the reservoir simulation steps.\nThe controls are split in a set of U steps, where \\scrU = {1, .. ., U}, and a subjective function maps the simulation step indexes to the control step indexes, \\kappa : Theta \\rightarrow \\scrU such that if k1 &lt;k2 then \\kappa(k1) &lt;\\kappa(k2), meaning that U &lt;K. The optimization variables u = (\\bfxj, j G \\scrU) are control inputs which represent well target rates or their corresponding bottom-hole pressures. The decision variables consist of the control variables u, the initial states x, the final states xf, and the algebraic variables v. The reservoir initial condition x1 is not part of the optimization variable, but a known parameter of the problem.\nAssuming that xk and u\\kappa(k) define a unique solution for xk and vk, it is possible to reduce the decision variables vector to x, v, and u, where Rk is the implicit function representing the reservoir simulation step such that xk = Rk (xk, u\\kappa(k)), and R\\mathrm{v}k is the implicit function denoting the relation of states and controls with algebraic variables such that vk = R\\mathrm{v} (xk, u\\kappa(k) )[\t].\nThe reservoir control-optimization problem constrained by network output constraints is formulated with the following equations:\nmin\t=\\ lk(xk+1, \\cdotk, u\\kappa(k)) \\Theta=x,u,vw ,vn kE\\scrK\t(4.7a)\ns. \\rightarrow.:\t\nXk+1 = R\\bfx(\\mathrm{v}k,u\\kappa(k)), k G Theta\t(4.7b)\n\\cdot\\bfw = Rk(xk,\\bfx\\kappa(k)), k G Theta\t(4.7c)\n\\cdot\\bfn = Nk (\\cdot\\bfw),k G Theta\t(4.7d)\n\\bfb\\bfx &lt;x &lt;b\\bfx\t(4.7e)\n\\bfb\\bfu &lt;U &lt;b\\bfu\t(4.7f)\n\\bfb\\bfw &lt;\\cdotw &lt;\\bfb\\bfw\t(4.7g)\nb\\bfn &lt;vn &lt;b\\bfn\t(4.7h)\nNotice that the decision variables 0 are the states x, the controls u, and the well algebraic variables vw, and the network algebraic variables vn. Eq. (4.7a) defines the objective function of the optimization problem which is the summation of separable functions lk (\u2022) from each interval. It typically denotes the NPV but can also express any gain function that can be computed from the states, controls and algebraic variables. Eq. (4.7b) defines the reservoir simulation step which calculates the next state xk+1 for a given initial state xk and control input u\\kappa(k). This equation also ensures continuity of state profiles of consecutive intervals. Eq. (4.7c) defines the well algebraic variables vw also\nas a function of the initial state and control input in each interval. Eq. (4.7d) computes the network algebraic variables vn for given well algebraic variables with function Nk(\u2022) which is formally defined in Algorithm 2. This function takes the output of the network simulation procedure and computes equipment properties and corresponding gradients with respect to the controls and state variables in order to add constraints in the MS formulation. Eqs. (4.7e)-(4.7h) establish bounds for the states, controls, well and network algebraic variables, respectively.\n4.4.2\tNetwork Constraints\nThe present work extends the MS formulation to consider network constraints in reservoir optimization. In [53], a reduced Sequentially Quadratic Programming (rSQP) algorithm was developed to tackle reservoir management problems by means of multiple shooting. However, the algorithm does not handle algebraic variables referring to production gathering networks but only well algebraic variables.\nTo account for network constraints, Algorithm 2 describes a function to calculate network algebraic variables for given well algebraic variables and boundary conditions. The function receives the well algebraic variables (v\\mathrm{W}),\nAlgorithm 2 Function to compute network algebraic variables\n1: function Nk(v\\mathrm{w}, ps, G)\n2:\tpv, qe \\leftarrow NETSIMULATION(v\\mathrm{W}, ps, G)\n3:\tv\\mathrm{n} \\leftarrow r(pv, qe, G)\n4:\treturn v\\mathrm{n}\n5: end function\nthe network graph (G), and the downstream boundary conditions (ps) as inputs and then computes the corresponding network algebraic variables (v\\mathrm{v}). Notice that this function is used in Equation (4.7d) of the MS formulation.\nIn line 1, the function receives as inputs the well algebraic variables v\\bfw which are the well boundary variables in a time instant k, together with the pressures at the separators ps, and the network graph G. Provided that v\\mathrm{W} is an algebraic variable of the MS formulation, Nk can be computed concurrently to the reservoir simulator.\nIn line 2, a simulation of the network is performed and the node pressures (pv) and edge flows (qe) are returned as outputs as shown in Algorithm 1.\nIn line 3, the network algebraic variables v\\mathrm{v} are extracted from the network by the function T(-).\nThis function is rather general and can represent any value of interest in the network that can be computed from the node pressures and edge flows in a network graph. Network constraints can represent capacity limitations at the processing unit, pressure drop constraints in the subsea equipment, or\nmore complex constraints such as the ones related to the operation of chokes or pumps, among others. After obtaining the network algebraic variables, constraints are imposed to these values in the optimization framework with simple bound constraints:\n\\bfv.\t(4.8a)\nwhere vmathrm{n},L and \\bfvmathrm{n},U are upper and lower bounds, respectively, for the network algebraic variables. Notice that equality constraints can also be imposed by simply setting vmathrm{n}\u2019L = vmathrm{n}\u2019U, however such constraints are typically hard to handle.\nChoke Valve Constraints\nChokes are special valves designed to reduce the velocity and restrict flow rates in pipelines of gathering networks. When fluid flows at given pressure and temperature conditions and it passes through a restriction into a lower pressure environment, the fluid velocity increases, and due to the mass conservation principle, an increase of velocity occurs when it flows through the smaller cross-sectional area of the restriction. At the same time, the Venturi effect causes the static pressure, and therefore the density, to decrease downstream beyond the restriction.\nFeasibility of production targets in choked wells can be ensured by imposing pressure drop constraints on the choke valves [15]:\nApL\tApu\t(4.9)\nwhere Ape denotes the pressure drops on the chokes e Eeqp, and vmathrm{n}\u2019L and vmathrm{n},U denote the lower and upper bounds for the pressure drops, respectively. For a feasible operation, a positive pressure drop is imposed, meaning that ApL = 0, and Apu is a sufficiently large value to keep the constraint relaxed with respect to the upper bound.\nElectrical Submersible Pump Constraints\nComplex network constraints can also be imposed with the proposed methodology. In particular, the constraints regarding the operation of an ESP involves keeping the well inflow and pump head within the boundaries of the pumps operating envelopes. This can be achieved by imposing constraints to the well inflow qmathrm{l} and the pump frequency f:\nfmin f\tfmax\t(4.10a)\nf0 \u25a0 (f }\t(4.10b)\nwhere f0 is the reference frequency, and fmln and fmax are the ESP frequency limits. The liquid flow rates at ESP pressure and temperature conditions are\nconstrained by upper (q\\mathrm0) and lower (q\\mathrm0) bounds which vary with the ESP current frequency f, and the reference frequency f0 of the equipment.\nEqs. 4.10b are rearranged such that the constraints follow the standard form established in Eq. 4.8a:\n0 S \u201c \u2014 \"\\mathrmo ' (f\n0 - \u201c\\mathrm0-(f\u2014\u201c\n(4.11)\n(4.12)\nmeaning that the left-hand side of these inequalities and the ESP frequencies comprise a vector of network algebraic variables for one ESP at time step k:\nf\n\u201c \u2014 \u201cfo \u25a0 (f0) \u201c\\mathrm0 \u2022 (fo \u2014 \u201c\n(4.13)\nThe calculation of ESP constraints require the knowledge of the pump frequencies a priori. In this dissertation, the ESP frequencies are a consequence of the well controls and resulting pressures and flows in the network. Algorithm 3 describes a procedure that computes the ESP frequencies after the network simulation procedure.\nAlgorithm 3 Function that computes ESP frequencies\n1: function ESPfrequenoies(G, pv, qe,\tf0 , Nstg )\n2:\tEeqp leftarrow equipmentEdges(G)\n3:\tVin leftarrow V\\mathrm{e}n(Eeqp)\n4:\tApESP leftarrow pv(Vin) \u2014 pv(V\\mathrm{o}ut(Eeqp))\n5:\tTin leftarrow nodeTemperatures(G, Vin)\n6:\t\u201ce,o,\u201ce,w ,P\\mathrm,P\\mathrm{w} leftarrow 10CalF10Ws(\u201ce,0(EeqP), \u201ce,w (E\\mathrm{e}qP),\t(Vin ) , Tin ,\t)\n7:\t\u201c1 leftarrow q\\bigl(,o +\n8:\t\\mathrmm leftarrow \u201ci,o \u2022 \\mathrm\\mathrm +\t/\u201c\\mathrm\n9:\tDeltaH.v/\tcdot g)\n10:\tfleftarrow\t(\u201ci,fo,Nst9)\n11:\treturn f\n12: end function\nThe inputs are the network graph (G), the pressures in the nodes (pv), the flows in the edges (qe), the standard oil density (\\mathrm\\mathrm{o}c), the ESP reference frequencies (f0), and number of stages (Nst9).\nIn lines 2-4, the pressure difference in the edges representing the ESPs are extracted from the network variables.\nIn lines 5-7, the phase flows and densities are determined for the ESP pressures and temperature conditions. This function receives as inputs the phase flows and oil density at surface conditions, the ESP intake pressures and\ninlet temperatures. The function outputs are the phase flows and densities at local conditions.\nIn lines 8-9, the ESP head values are determined for the given local density of the mixture (\\rhom), where g is the gravity.\nFinally, in line 10, the ESP frequencies are determined for given local liquid flow rates and ESP features. Later, in conjunction with the example in Section 4.5, an explicit model for the function \\vargammamathrm{E}SP(\u2022) is presented.\n4.4.3\tPressure Drop Sensitivities\nThe set of equations describing the network fluid flow assumes flows at steady-state conditions, meaning that the pressure transients and fluid dynamics in the pipelines are disregarded. However, the pressure gradients vary with the pipe spatial position since the fluid densities and flow regimes change with pressure and temperature conditions. Even though the temperature distribution in the network is constant, the pressure variations might have considerable influence on the pressure drop gradients. Therefore, the pressure drop gradient in a pipeline is represented as an Ordinary Differential Equation (ODE) of the average pressure at position s of the pipe:\n= f (s,p(s),q)\nP(so) = po(q)\n(4.14a)\n(4.14b)\nwhere f is the pressure drop gradient function at position s of the pipeline, for a given pressure at this position p(s), and a flow rate q in the pipeline. The standard flow rate q is a model parameter and do not vary with the spatial position s. The knowledge of the pressure at s0 for a given flow q rate is the boundary condition of the ODE system.\nForward Sensitivity Analysis\nA sensitivity analysis allows for calculating the pressure drop gradients with respect to the model parameter q. This information is used afterwards to obtain the pressure drop gradients and total derivatives of the network constraints. A forward sensitivity method is derived by writing explicitly the total derivative of the pressure drop gradient with respect to the total flow rate:\nd2p = \\partialfT \\partialpT + \\partialf T ds \u2022 dq\t\\partialp \\partialq \\partialq\ndp(so) = \\partialpo(q)\ndq\t\\partialq\n(4.15a)\n(4.15b)\nThe pressure drop sensitivity with respect to the model parameter q is defined\nas:\nS<\u201d=partial^\n(4.16)\nand satisfies the following sensitivity equations:\ndS ds\nS (so)\npartial/ dp\nT partial/T s \u00ab+partialq\npartialpoT partialq\n(4.17a)\n(4.17b)\nThe spatial integration is a combined system involving the ODE and the sensitivity equations p of size N(Ns + 1), where N is the number of equations of the original problem, and Ns is the number of model parameters. The ODE solution with the corresponding sensitivities can be written as follows:\nr sf=L\np(sf)=\tf (s,p(s),q) \u25a0 \\Psis\nS0 =\n*<-)=Z=7 partialp(s)+partial^)-\n(4.18)\n(4.19)\nwhere L is the length of the pipeline Finally, the gradients are obtained with:\n, partial\\Psi\nnablaq= S(sf )T \\cdot -partialp-\t(4.20a)\nThe sensitivity equations are solved simultaneously with the state profiles with a multi-step integration method. In addition, a full or partial error control for the sensitivity variables is considered in the local error calculation.. The partial derivatives can be calculated using Automatic Differentiation (AD) tools or Finite Differences (FD).\n4.4.4\tAdjoint Sensitivity Analysis\nIn the forward sensitivity approach, an ODE system of size (1 + Ns)N is solved to obtain the sensitivities with respect to the Ns model parameters. This can be prohibitive for a large-scale system, specially when the number of model parameters or sensitivity variables (Ns) is large with respect to the number of constraints. In this case, the adjoint sensitivity method is very attractive because it does not compute all the sensitivities in S.\nThe objective function or a constraint can be written as \\Psi(s,p(s), q) such that the variables and parameters are governed by the ODE in Eqs. (4.14a) and (4.14b). Introducing a Lagrange multiplier A, an augmented\nobjective function is defined as:\n\\Psi(s,p(s),q) = \\Psi(sf ,p(sf ),q)+ i lambda(s)T ( f (s,p(s),q) \u2014\n\u00ab/so L x\ndp\\ ds partial\nds\n(4.21)\nand by introducing the following perturbations:\ndeltap = p(s) \u2014 p\\ast (s)\ndq = q \u2014 q*\nd\\Psi = \\Psi(p\\ast(s) + deltap, q\\ast + dq) \u2014 \\Psi(p*(s), q\\ast)\n(4.22a)\n(4.22b)\n(4.22c)\nthe following equation is obtained for the augmented objective:\n\\Psi(p(s),q) = \\Psi(p(sf ),q) \u2014 p(sf )Tlambda(sf) + p(so)Tlambda(so) lambda(sf (s,p(s),q) + p(s)T \\mathrm{d}lambda)s'\nrsf\n+ J\nd SO\nds\n(4.23)\ntaking the gradient of the objective it follows that:\n\u25a0 n,T,\t\"I T\trycr,\nd\\Psi(p(s),q)= -partial- \u2014 lambdas f)\tdeltap(sf ) + lambda(so)deltap(so) + -partial- dq+\npartialp\n/\u2022 sf [dlambda. . dlambda Ao klambda(s)+\\mathrm{d}s\nso\ndeltap(s) + partial-lambda dpds\n(4.24)\n\nThe adjoint equations are chosen such that only dq influences\nd\\Psi(p(s),q) = {partial^\n- '\t, partialp(so)\nT dq\nlambdas]+ \u00a3 [partial>H\ndq (4.25)\nwith the boundary condition:\nlambdas) = 'partials\nand differential equation for the adjoint\ndlambda =_ partialf lambda ds\tdp\n(4.26)\n(4.27)\nThe choice of the best method to use is based on the number of variables and constraints of the problem. In this dissertation, a combination of forward and backward methods with automatic differentiation and finite differences were compared with respect to the computational cost. The forward method with finite differences was chosen because it was the most efficient method for the case instances of the numerical and simulation analysis.\n4.5 NUMERICAL AND SIMULATION ANALYSIS\nA numerical and simulation analysis is performed to assess the proposed methodology for the optimization of oil reservoirs constrained by production gathering networks. The relevance of such constraints is attested by contrasting optimal constrained strategies against traditional methods. Moreover, the flexibility of the methodology is put to test by solving optimization problems with complex network constraints such as the ones related to the operation of ESPs.\nThe solution method involves the orchestration of several software components as shown in Figure 4.4. A network solver was developed in Mat-\nReservoir-Network Integrated Optimization\nNonlinear Predictive Control\tNetwork Solver\nMultiple shooting\tGraph representation\n! Reduced SQP\t!\t; Network simulation\n\t4\t>\t4\t\tL\t\n\t\t\t\nQP Solver\tReservoir Simulator\tODE Solver\t; Nodal Analysis\nInterior point method \u00a1State-of-art solver\t!\tIMPES solver\t; Automatic differentiation 1\tSensitivity analysis Forward and adjoint methods\tBlack-oil correlations Pressure drop derivatives\n\t\t\t\nOther Software\nFigure 4.4: Software Architecture\nlab for modeling and simulation of fluid flow in gathering networks. The pressure drop calculations are computed using the framework for nodal analysis developed by [66], which consists of several correlations to compute fluid properties and pressure drop derivatives. An integrator was coupled to the network simulator to obtain the pressure sensitivities, using a Matlab interface to the ODE solver (CVODES), which is part of the SUite of Nonlinear and DIfferential/ALgebraic Equation Solvers (Sundials v2.6.2) [75]. The network solver was tightly interfaced to the REduced Multiple Shooting Optimizer (REMSO) developed [76]. REMSO is interfaced to the Matlab Reservoir Simulation Toolbox (MRST 2015a) [77] and to an mathematical programming solver (IBM ILOG CPLEX v12.6) which was used to solve quadratic programs sequentially. The software uses automatic differentiation to compute gradients, supports parallelism and adopts reduction techniques for memory saving purposes. All simulation and optimization ran on a workstation equipped with a CPU Intel Xeon E51620 3.60 GHz with 32 GB of RAM running MATLAB 2016a.\nA brief description of the reservoir model used as a testbed in the\nsimulation experiments is given in Section 4.5.1. The production gathering network is described in Section 4.5.2. Section 4.5.3 defines the constraints and parameters of the problem. Finally, Section 4.5.5 presents case studies and a simulation analysis.\n4.5.1\tReservoir Description\nThe reservoir model was adapted from a case instance from [78]. It consists of a Cartesian three-dimensional box, split in 1200 regular grid blocks being 20 x 10 x 6 in x, y, and z coordinates, respectively. Each block is 500 feet long, 500 feet wide and 50 feet high. We chose a rather simple reservoir model to assess the effectiveness of the developed methodology to account for network constraints, in particular nonlinear constraints as manifested by ESPs. The multiple shooting methodology has earlier been applied to a more complex reservoir model [53], however without network constraints.\nThe fluid is represented with an two-phase immiscible flow model and the reservoir grid blocks have homogeneous rock porosity and relative permeability. The absolute permeabilitiy is 50 darcys (d) in the x and y coordinates, and 25 darcys (d) in the z coordinate, meaning that the fluids flow easily in the horizontal direction. The relative permeability is a curve that describes phase permeabilities to water saturations. Table 4.3 provides relative phase permeabilities for a set of water saturation values, where Sw is the water saturation, Krw is the water relative permeability, and Krow is the oil relative permeability.\nTable 4.3: Oil Relative Permeabilities\nSw\tKrw\tK Krow\n0.1500\t0.0\t1.0000\n0.2000\t0.0059\t0.8521\n0.2500\t0.0237\t0.7160\n0.3000\t0.0533\t0.5917\n0.3500\t0.0947\t0.4793\n0.4000\t0.1479\t0.3787\n0.4500\t0.2130\t0.2899\n0.5000\t0.2899\t0.2130\n0.5500\t0.3787\t0.1479\n0.6000\t0.4793\t0.0947\n0.6500\t0.5917\t0.0533\n0.7000\t0.7160\t0.0237\n0.7500\t0.8521\t0.0059\n0.8000\t1.0000\t0.000\nThe reservoir initial conditions are uniformly set to 200 bar for the oil pressure, and 0.15 for the water saturation in all grid blocks. Other relevant rock and fluid properties are shown in Table 4.4.\nTable 4.4: Reservoir parameters\nSymbol\tVariable\tValue\tUnits\n\tPorosity\t0.3\t-\ncr\tRock compressibility\t3 X 10-5\t1/Pa\ncw\tWater compressibility\t4.28\t10-5\t1/Pa\nco\tOil compressibility\t6.65 x 10-5\t1/Pa\nPo\tOil density\t962\tkg/m3\n\\rhow\tWater density\t1080\tkg/m3\n\\muo\tOil viscosity\t5.00\tPa s\n\\muw\tWater viscosity\t0.48\tPa s\nFigure 4.5 depicts the reservoir model with the corresponding position of the production and injection wells. The wells are placed prior to the\np2\nFigure 4.5: Reservoir Model\noptimization as shown in the figure. Five production wells pi (i = 1,. . . 5) drain fluids from the reservoir and two injectors j (j = 1, 2) push water into the reservoir to displace the oil to productive areas and to sustain the reservoir pressure. The total producing life of the reservoir is taken as 10 years, with a fixed time step of 5 days, which means a total of 730 time steps.\n4.5.2\tProduction Gathering Network\nThe production gathering network has 5 ESP-lifted wells producing to a common subsea manifold which transports the fluids to the processing facilities at the surface. The network graph is depicted in Figure 4.6. Each producer is equipped with an ESP which is placed in a casing inside the tubing close to the well bottom-hole. The production chokes are assumed to be fully opened with a negligible pressure drop and thus they were not included in\nFigure 4.6: Production gathering network\nthe network graph. Constraints regarding injection wells infrastructure are not considered, but the methodology can be easily extended for this aim.\nThe set of pipelines transporting the fluids from the reservoir to the surface is divided in tubing, pipeline and flowlines. The pipeline features are shown in Table 4.5. The pipeline is vertical when the angle is 90 degrees,\nTable 4.5: Pipeline features\nPipeline\tLength (m)\tID (mm)\tR (mm)\tAngle (deg)\nTubing (hi)\t213.30\t152\t0.028\t90\nTubing (h2)\t914.40\t76\t0.028\t90\nPipeline\t1000.00\t120\t0.028\t0\nFlowline\t2000.00\t240\t0.028\t90\nID:= Inner Diameter, R:= Roughness\nand horizontal if the angle is 0 degree. For vertical pipelines, the potential component usually is the dominant in the pressure drops, while friction is dominant for horizontal pipes.\nAll ESPs have 70 identical stages and a motor frequency varying from 30 Hz to 90 Hz, with a reference frequency of 60 Hz. It is assumed that the platform has enough energy to supply power for all ESPs. Thus, the pump operation is not constrained by power limitations, but such constraints can also be addressed by the proposed methodology.\nThe network boundary conditions are given by the multiphase flows and bottom-hole pressures that are computed in the reservoir simulation, which represent the upstream boundary conditions, and the inlet pressure at the separator is kept constant at 5 bar, which is the downstream boundary condition of the system.\nESP Model\nThe flows and pressures in the network are calculated with the network simulation procedure as shown in Algorithm 1. The outputs are the pressure differences in the ESPs (APesp) and the flow rates of the fluids being pumped. With these values, the pump heads can be calculated from:\nAH =\t(4.28)\npi \u25a0 g\nwhere AH is the total pump head, \\rhoi is the average density of the pumped flow, and g is the gravitational constant. For two-phase immiscible flows, which is the fluid model adopted in this work, the average density is the weighted average of oil and water densities which uses the local phase volume fractions of oil and water.\nNotice that the boundaries of the ESP operating envelopes vary with the frequencies of the pumps, which are typically controlled by the operators from the platform. Therefore, the ESP constraints are nonlinear functions of the flow rates and densities of the fluids being pumped, and of the frequencies of the pumps. The ESP frequencies are computed with Algorithm 3, and the operating envelope constraints are imposed as described in Section 4.3.2.\nNetwork and reservoir equations converge separately, meaning that their coupling is explicit. Thus, there is no need to perform any equilibrium loop to ensure consistency of the equations required for integrated production optimization. Instead, well controls obtained after convergence of reservoir equations are kept constant in the network simulation procedure, and the residuals of the network constraints are driven to zero by the optimization algorithm. This means that the pump frequencies are a consequence of the well controls chosen to satisfy reservoir equations, and thus an explicit relation between well inflow and pump head is required to calculate pump frequencies for given pressure drops in network equipment. A procedure to compute the pump frequencies for given node pressures, edge flows and a network graph appears in Algorithm 3.\nIn [3], the single stage ESP head curve at the reference frequency was satisfactorily fitted to a 4th order polynomial equation of the well flow rate, and thus the pump frequency f can be calculated as the solution of:\nAH/0 = a4 \u25a0 qf0 + a3 \u25a0 qf0 +&lt;12 \u25a0 qf0 + ai \u25a0 qf0 + ao\nAH = AH/0 \u25a0\n(4.29a)\n(4.29b)\n(4.29c)\nwhere ai, (i = 1, . .., 4) are the coefficients of the polynomial equation approximating the pump head curve, Nst9 is the number of stages of the pump, and qf0 and AHf0 denote the flow rate and pump head at the reference frequency. The polynomial equation of the head curve is a quartic polynomial equation\nwhich can be converted to a depressed quartic equation for which there exists an explicit solution. Notice that after calculating the frequency of the pump, the ESP head can be constrained by imposing bounds to the frequency:\nf min\n&lt;f &lt;fmax\n(4.30)\nwith fmln and fmax being the lower and upper bounds to the pump frequency respectively.\n4.5.3\tOptimization Problem Statement\nA water-flooding optimization problem with network constraints is modeled with the MS formulation. The objective is a scaled NPV function, which is separable, and compatible with Equation (4.7a):\nmax NPV:\t(dk \u25a0 (1 + d)~k^ \u25a0 I\tro \u25a0 qp'k \u2014\t\u25a0 q^k\nkescrK\ni,k\n+\t\u2014 r\\sum \u2022 qd,\nievInj\nwhere:\n\u2022\t\\scrK is the set of prediction intervals which split the total producing life of the reservoir of 10 years.\n\u2022\tro \u2014 1/stb, rw \u2014 0.1/stb , r\\sum \u2014 0.1/stb are the gains with the oil revenue, and costs for water treatment and water injection, respectively. The gain ro, and the costs rw and r\\sum were chosen so that the cost for treating the produced or injected water corresponds to 10% of the revenue obtained with the selling of oil.\n\u2022\tqP,k and q^\u2019k are the oil and water rates of production wells, and q^k is the water rate of injection wells. These well flow rates are denoted by the well algebraic variables vk in the mathematical formulation.\n\u2022\td \u2014 0.1 is the discount factor, and dk is the time interval at k.\nConstraints on reservoir states, which are given by Equation (4.7e), impose limits to the pressure of oil and water saturation in the reservoir grid blocks. The feasible value for pressure of oil ranges from 100 bar to 500 bar, while the range of feasible water saturations is from 0.01 to 0.4.\nThe constraints to the control inputs uk are given by Equation (4.7f). The production wells are controlled by bottom-hole pressure set points which can vary from 100 bar to 300 bar, while the injection wells are controlled by rate which can vary from 1 m3/d to 300 m3/d.\nEquation (4.7g) defines constraints to the algebraic variables in a compact form. These constraints, however, are divided into well and network constraints. The well constraints impose bounds to the well algebraic variables\n(vmathrm{W}) which represent the well inflow and bottom-hole pressures. Since the bottom-hole pressures of producers and injection rates of injectors are control inputs, which are already constrained in Equation (4.7e), the constraints to the algebraic variables take into account only bounds to well inflows of production wells and pressure bounds for injection wells. This avoids the extra computational cost of computing redundant output constraints. The feasible oil flow rates of production wells range from 1 m3/d to 250 m3/d, while the feasible values for water production range from 1 m3/d to 300 m3/d.\nThe remaining algebraic variable constraints refer to the network constraints. Such constraints impose bounds to the network variables (vmathrm{N}) which represent the violation to the ESP operating envelopes of production wells. These constraints ensure that the ESPs operate within their envelopes. To satisfy these constraints, it is sufficient to enforce bounds to the well inflow and ESP frequencies. The feasible values for the frequency range from 30 Hz to 90 Hz, while the feasible well flow rates range from 15 m3/d to 200 m3/d at the reference frequency of 60 Hz.\n4.5.4\tHeuristic for a Feasible Start\nA primal feasible initial guess for the states and algebraic variables in reservoir optimization is typically obtained by performing a forward simulation of the reservoir for bounded control inputs. However, when network constraints are introduced in the problem, obtaining a feasible initial guess with respect to both reservoir and network equations is not evident but important for the optimization algorithm.\nTo obtain a initial feasible guess with respect to the network and reservoir equations, a reduced-order control strategy was adopted, which was inspired by the Feasibility Pump (FP) heuristic. The FP is an heuristic adopted for finding a feasible solution of a given mixed-integer programming problem by solving linear relaxations of the problem in order to find an incumbent solution which is as close as possible to the feasible space [79].\nIn this work, the heuristic used a constant control value for the whole horizon per well to find a feasible solution for the optimization problem. The result of the reduced-order control problem is a primal feasible guess which can be refined by splitting the single control step into several control intervals. This control schedule is given as the initial guess for the refined control optimization problems which can adjust the controls in each step to maximize the NPV.\nThe heuristic is written in a high-level language in Algorithm 4. The function receives the reservoir initial states (x0), a guess for the well controls (u0), and separator inlet pressures (ps) which are the downstream boundary conditions for the network simulation. A forward reservoir simulation is performed to obtain the states (x1) and well algebraic variables (vw,1j for all prediction intervals (see lines 2-3). Then the network algebraic variables (vN,1j are calculated provided the states and well algebraic variables in the prediction\nAlgorithm 4 Heuristic for a feasible start\n1: function FEASIBLESTART(x0, u\u00b0, ps, K)\n2:\tX1&lt;-Rx(x\".u\"j\n3:\tVWJ&lt;-Rv(x\".u\"j\n4:\tV^1\tN(x1,VW\u20191,pS)\n5:\t[xf,vw,/, vN,/,uf] \u25a0<\u2014 Remso(x\u00b0,u\u00b0,x1, vw>1, vN>1)\n6:\tuR \u2022<\u2014 controlRefinement(uf, K)\n7:\treturn uR\n8: end function\n9: function controlRefinement(u, K)\n10:\tUR e R|K|x|u| 0T\n11:\tfor i := 1 : |K| do\n12:\tuR(z)&lt;\u2014 u\n13:\tend for\n14:\treturn uR\n15: end function\nintervals (see line 4). This is achieved by invoking the rSQP algorithm with the initial states (x0), the control inputs (u0), and the algebraic variable guesses (vw,x, vN\u2019x) as inputs (see line 5). The solution returned by REMSO consists of the optimal reservoir states (xf), constant well controls (uf) and the well and algebraic variables (vw,f, vN,f). The single control step of the solution (uf) is split into several control intervals, and the resulting refined control schedule (uR) is returned (see line 6).\nThe control refinement procedure splits the single control step of the reduced-order control strategy into several control intervals. Figure 4.7 depicts the control strategy before and after the refinement. On the left plot, the\nSingle Control per Well\nt\nControl Steps:\n82x\t72x\t24x\n6x\t4x\t2x\t1x\n5 days 15 days 30 days 60 days 90 days 180 days 360 days\n10 years\nu(i)\nRefined Well Control\n-\u2014\nt\nFigure 4.7: Well control refinement\nsingle well control input u(t) is shown with the corresponding reservoir states x(t) and algebraic variables v(t). The single step in this case is split into\n191 control steps while keeping constant the control inputs (see plot on the right). Notice that the discretization is fine at the beginning and coarser at the end, meaning that more accurate results are required in the early life of the field.0.9 The resulting schedule is a control strategy that satisfies both reservoir and network constraints with several degrees of freedom. This schedule is adopted as the standard initial guess for all network constrained reservoir optimization problems addressed in this dissertation.\nThe initial guess for the reduced-order controls are the lowest feasible value for the bottom-hole pressure of producers, namely 100 bar, and the maximum injection rate and half of this value for the injectors, namely 300 m3/d and 150 m3/d. The solution of the reduced-order control problem with this initial guess kept the controls of wells pi, p3, p4, and ii unchanged, but adjusted the controls of wells p2, p5 and i2 to satisfy network constraints. The pressures at the bottom-hole of wells p2 and p5 were increased respectively to 136 bar and 149 bar, while the water injection rate of well i2 was decreased to 140 m3 /d.\nThe ESP constraints of well p5 are depicted for the initial guess before and after the heuristic. Figure 4.8(a) shows the violation of ESP constraints\n(a) ) Violation of ESP constraints\n3500\n(b) ) Result using the heuristic\nFigure 4.8: Output of heuristic for p5.\nin the initial guess, while Figure 4.8(b) shows that the network constraints hold for the solution given by the heuristic. The figure on the left shows the ESP operating envelope with the corresponding operation of the pump, while the figures on the right show the network constraints imposed on the problem. Notice that the initial guess starts to violate the lower bound for the liquid flow rate in the pump after 2500 days of operation, which means that without network constraints, engineers would identify this problem only after a couple of years of operation.\n4.5.5\tCase Studies\nTwo case studies are performed to assess the effectiveness of the proposed methodology. The first compares network unconstrained against constrained cases with the aim to assess the impact of network constraints in reservoir optimization. The second case study compares reservoir optimization strategy which is typically performed by reservoir engineers against shortterm practices, which are traditionally performed by production engineers. Short-term practices use simplified reservoir models, but typically consider sophisticated network constraints. On the other hand, reservoir optimization methods use more accurate reservoir models, but adopt simplified constraints for the network. The second case study aims to asses the differences and benefits of the strategies when both reservoir and network models are representative. All cases are open-loop optimization problems, meaning that the controls are not adjusted with field measured data for feedback control. Detailed results showing production rates and pressure profiles per well for each case study are presented in Appendix A.\nReservoir Optimization with Network Constraints\nIn this study, two water-flooding problem instances are compared; one without network constraints, and the other with additional network constraints regarding the operation of ESPs. Although operators typically check feasibility of operational plans with respect to the gathering network and surface facilities before considering it as a viable recommendation, most reservoir optimization methods disregard such constraints. This study aims to asses the relevance of considering network constraints in reservoir optimization methods.\nThe optimization of the unconstrained case took 119 Sequentially Quadratic Programming (SQP) iterations, while the network constrained case took 287 iterations. One possible reason for the overhead of the solution method is the numerous extra network output constraints for a feasible operation of the ESPs. A total of 3650 network constraints were considered in the constrained case, i.e., one constraint per simulation step (730) per well (5) to assess the potential of the methodology, but in practice this number could be reduced since the dynamics of the reservoir are slower.\nThe optimal cumulative NPV of the approaches is shown in Figure 4.9. As expected, the NPV is higher in the network unconstrained case. Although\ntime (day)\nFigure 4.9: Optimal NPV values network unconstrained and constrained scenarios.\na decrease in the objective is not desired usually, in this case the optimal strategy has binding network constraints and thus the optimal unconstrained solution is not feasible considering the integrated production system. The small difference in terms of NPV in the scenarios is possibly due to the simplicity of the reservoir model adopted in the experiments. In practice, this difference could be much larger, specially in reservoirs with heterogeneous permeability and saturation distributions.\nThe results also revealed that the ESPs, except for producer 3, work outside the boundaries of the operating envelopes in the unconstrained case. This means that the solution obtained without network constraints rendered recommendations that would damage the ESPs in practice. One well whose control strategy is particularly affected is producer p5. Figures 4.10(a) and 4.10(b) show the ESP operation trajectory for well p5 in both constrained and unconstrained cases. In the unconstrained case, the operation of the ESP is not kept within the boundaries of the pump operating envelope, while the ESP constraints are honored in the constrained case.\nComparison with the Short-Term Practice\nLong-term optimization involves years and is performed by reservoir engineers, while short-term optimization involves days or weeks and is typically done by production engineers. In contrast with long-term goals which\n(a) Network unconstrained\n3500\n3000\nFigure 4.10: ESP constraints of well p5.\n2500\n2000\n1500\n1000\n500\n\n\naim to maximize the reservoir oil recovery, the short-term practice is usually to produce as much as possible daily. Therefore it can be seen as a greedy strategy that chooses controls to give the highest production in every time step, without considering the long-term impact of such actions.\nIn water-flooding optimization, the early prediction of water front arrivals is a key aspect in the choice of the best strategy to operate the wells. Long-term strategies typically have an advantage over short-term ones since with the latter can not predict water front arrivals. This case study compares the long-term against a greedy strategy. The greedy approach consists of a sequence of optimization problems, one for each control step, up to the end of the prediction horizon.\nThe first scenario is the long-term optimization case which consists of a single optimization problem for the whole prediction horizon with a 5-day step interval. The controlled variables are the Bottom-Hole Pressure (BHP) values for producers and injection rates for the injectors. The second scenario is the greedy case, whereby several optimization problems are solved, one per step interval. The controlled variables are only the bottom-hole pressures of the production wells, and the water injection rates of injectors are kept constant at the values obtained with the heuristic procedure for a feasible\nstart. Table 4.6 contains a summary of both strategies.\nTable 4.6: NPVs obtained with long-term and greedy strategies\nLong Term Strategy\tGreedy Strategy\nSingle optimization problem. NPV for the whole horizon. Discount factor of 10 % Producer BHPs and injection rates\tOne problem every 5 days NPV with a 5-day horizon Problems are solved sequentially Only BHPs of producers\nThe cumulative NPVs are compared to the initial guess in Figure 4.11. The initial guess is referred to as single control in the figure. In the first\nFigure 4.11: Optimal NPVs for the network unconstrained and constrained scenarios.\nyear, the long-term strategy preserves the initial guess control strategy while the greedy strategy renders a higher NPV. After some years, the long-term strategy begins to render a higher NPV than the greedy strategy. Finally, in the last year, it can be seen that the long-term strategy gives the highest cumulative NPV and although the greedy strategy renders good results in the first years of production, it decreases the NPV of the initial guess at later stages of production. This behavior is observed because each subproblem is\nsolved independently and thus the future impact of the present actions are disregarded.\nThe ESP operating profiles induced by the greedy and long-term strategies can differ significantly as shown in Figure 4.12. In the greedy strategy,\n3500\n3000\n2500\n2000\n1500\n1000\n500\n(a) ) Greedy Strategy\nFigure 4.12: ESP constraints of well p5.\n3500\n3000\n2500\n2000\n1500\n1000\n500\n(b) ) Long-Term Strategy\nthe well starts producing close to the maximum and decreases its production with time. The long-term strategy does the opposite, since it curtails the well production in order to prevent a premature water front arrival.\n4.6 CONCLUDING REMARKS\nA network solver that uses automatic differentiation, parallelization and integration mechanisms was developed and tightly interfaced to an opensource reservoir simulator. The integrated problem was represented with a multiple shooting formulation and solved with a rSQP algorithm. An explicit coupling was chosen for the reservoir and network models to avoid the extra burden of converging the equations of the integrated system at every time step. Instead, the inconsistencies between reservoir and network flows and pressures are modeled as constraints in the optimization formulation. Thus, after satisfying all constraints at the convergence of the algorithm, the equations of both reservoir and network models are consistent.\nTo assess the feasibility and the potential of the methodology to handle network constraints, it was considered a rather simple reservoir model, and a complex network model with nonlinear constraints regarding the operation of ESPs. A heuristic procedure was developed with the aim to obtain a feasible initial guess with respect to the integrated production system. This procedure was important for the effectiveness of the optimization algorithm.\nThe results elicited that the developed methodology is suitable to handle complex and numerous network constraints. Two case studies were presented. The first assessed the relevance of network constraints to ensure feasibility with respect to the gathering facilities by comparing an uncon\nstrained against a constrained case. While the solution of the unconstrained case rendered a strategy which violated the operating envelope boundaries of the ESPs, the strategy obtained with the constrained case honored these constraints without a significant decrease in the NPV. The second case study compared the traditional approach adopted by reservoirs engineers against short-term practices. It was shown that the latter yields a lower NPV because it can not predict early water front arrivals.\n4.7 SUMMARY AND SYNTHESIS OF CONTRIBUTION\nAn efficient method was developed for reservoir optimization problems with network constraints. It extended the previous work developed by Codas et al. [53] in which it was shown that several output constraints favors multiple shooting. This dissertation applied the MS formulation for reservoir optimization where the output constraints are particularly related to the production gathering network.\nWhile Chapters 2 and 3 focused on modeling and optimization tools for short-term production optimization, this Chapter focused on long-term production optimization, in particular the optimization of water-flooding processes. Production gathering network constraints appeared in all Chapters, but the approach used in the previous Chapters dealt with discrete variable and the solution method involved the use of state-of-art mixed-integer programming solver. On the other hand, the methodology developed in this Chapter deals with nonlinear problems with a large number of decisions variables and constraints, and therefore requires the use of specialized techniques such as the use of an ODE solver with sensitivity capabilities, automatic differentiation and a rSQP algorithm. The contributions of this Chapter can be summarized as:\n\u2022\tA methodology to handle network constraints in gradient-based reservoir optimization;\n\u2022\tA network solver that is tightly integrated to an open-source reservoir simulator and provides gradient and sensitivity information with respect to momentum balance equations;\n\u2022\tA heuristic to obtain a feasible initial guess, which satisfies both reservoir and network equations for integrated production optimization problems;\n\u2022\tA simulation analysis assessing the impact of network constraints in reservoir optimization.\n5\tCONCLUDING REMARKS\nThe optimal operation of oil fields is a complex task that involves several disciplines, processes and technologies. In the long-term, reservoir engineers seek strategies to improve the NPV for the remaining field life time. In the short-term, production engineers look for daily or weekly plans that maximize the field performance while the operational constraints are satisfied. From both time scale perspectives, operators had to rely on their experience and knowledge of the system, and on sensitivity analyses based on process models to find the best setpoints for operating the field. Unfortunately, these methods are not sufficient to ensure a mode of operation that enhances oil production and therefore the value of assets under unusual operational conditions, e.g. equipment failure, installation of new wells or processing facilities starting to work.\nAn alternative that is gaining acceptance in the industry is modelbased optimization, which relies on the integration of mathematical models with algorithms into effective optimization tools. These tools can be effective to advise engineers in finding optimal operation settings provided that process models are routinely updated with field data to reflect the prevailing system conditions. Therefore, a decisive aspect to improve economic margins with the use of model-based optimization is the development of mathematical models that are suitable for optimization purposes and which reflect sufficiently well the actual processes. The quality of recommendations provided by the optimization tool is strongly connected to the accuracy of process models, thus the validation of the optimal recommendations against simulation models is indispensable before their actual implementation in the field.\nIn gas-lifted oil fields, well production can be represented as a function of the well-head pressure and the gas-lift injection rate. Fhrther, pressure drops in the gathering network depend on phase flow rates and the average pressures in a pipe segment. These functions are typically calculated in an implicit manner by a network simulator, which may not be suitable for efficient optimization methods. Instead, this dissertation developed a framework for multidimensional piecewise-linear approximations to represent the nonlinear functions which appear in short-term production optimization. MPWL models have the advantage of not requiring curve fitting, enabling the synthesis of function approximations directly from sampled data. These models can be employed in the approximation of well production and pressure drop functions from data sampled in commercial multiphase flow simulators in which the process was modeled. A suitable MPWL formulation can then be chosen and adjusted for the operating conditions of the platform, yielding an optimization formulation that may support production engineers in the daily or weekly operation of oil fields.\nAnother modeling issue addressed in this dissertation regards the splitting of flows in production gathering networks. In modern offshore oil fields, wells can be equipped with routing valves to direct their production to multiple manifold headers. Although flow splitting is a practice routinely adopted\nby engineers in the operation of offshore platforms, the existing models for short-term production optimization do not account for splitting of flows and therefore require the wells to be connected to a single header. This dissertation developed an optimization model that is able to decide upon single or multiple routing in subsea equipment of offshore fields. One important aspect of model-based optimization, in addition to model accuracy, is the equivalence of degrees of freedom between the optimization model and the decision making process adopted by operators in practice. For instance, single-routed optimization models found in previous works did not consider the ability of splitting flows in the production gathering network. Without the same degrees of freedom, the optimal recommendations can not compete with analytic and practical methods adopted by operators, which may turn the optimization tools not attractive in practice. In fields where multiple routing is an option, the proposed automatic routing model is a promising alternative to help engineers in making optimal decisions regarding the short-term goals.\nUnlike previous developments which focused on short-term production optimization, another subject addressed in this dissertation is the optimization of reservoirs which are constrained by the production gathering network. Although network constraints are typically handled in short-term optimization, they are disregarded or only limitedly handled in reservoir optimization. The disregard of such constraints may render operational plans unfeasible in practice, precluding their application in real-world fields. To this end, this dissertation proposed a methodology to handle network constraints in reservoir optimization, particularly in water flooding processes. The methodology was assessed in a simple black-oil reservoir model with complicated constraints regarding the operation of ESPs. The results elicited that the methodology enables the handling of network constraints in a much broader scale than previous works by decomposing the simulation and constraint evaluations in the time domain. Although the reservoir model utilized was synthetic and rather simple, the methodology can be extended to complex reservoir, enabling the development of optimal reservoir management policies which are feasible with respect to the network and processing facilities. Further, the optimal results can help to predict early capacity limitations on the processing installations or oversized equipment based on well production forecasts and network deliverability.\n5.1 SUMMARY OF CONTRIBUTIONS\nThis dissertation combined models and optimization methodologies for the operation of oil fields in the short-term and long-term. In the shortterm, the contributions consist of a comprehensive study of MPWL models to approximate the nonlinear well production and pressure drop functions, and the modeling of flow splitting in production gathering networks of offshore systems for optimization purposes. In the long-term, a methodology was proposed to consider network constraints in reservoir optimization, particularly\nin water-flooding processes. These contributions, seen from the standpoint of integrated operations, may be used to support production and reservoir engineers in decision making processes of real-world fields. A summary of the main developments of the dissertation are presented by chapter.\nThe contribution of Chapter 2 is about approximating and solving MINLPs that arise from the daily optimization of oil platforms. It was shown that MPWL models are effective tools for modeling complex, nonlinear functions that are obtained directly from sample or simulated data, and also from proxy nonlinear models. Piecewise-linear functions with both hypercube and simplex domains were studied regarding their approximation accuracy. The performance and effectiveness of all MPWL models were evaluated by means of computational and simulation analyses. While SOS2 was the fastest model for hypercube domains, the logarithmic model was the most efficient for simplex domains. The approximation errors can be decreased by adding more breakpoints to the function to a desired degree of accuracy. However, the computational cost increases significantly with many breakpoints because of the extra binary variables. This is a possible reason for a better performance of SOS2 and Log models, since the first adds binary variables by demand in the branching scheme, and in the second the number of binary variables grows logarithmically.\nChapter 3 advanced previous works by modeling flow splitting phenomena in oil fields with multiple routing options in subsea equipment. A nonlinear model and a MILP approximation based on a particular MPWL model (SOS2) were proposed to represent the flow splitting phenomena in gathering networks. The SOS2 model was chosen for its efficiency and because its implementation is relatively simple, but other models discussed in Chapter 2 could also be used. When contrasted against a commercial network simulator, the MILP model was able to represent the phenomena with high accuracy provided that sufficient breakpoints were available. The flow splitting model was incorporated to a mixed-integer formulation to optimize the production of an offshore field with multiple routing. A comparison with the traditional models found in the literature, which allow only single routing, showed that the model which allows multiple routing is more general and was able to determine operational settings that yield higher oil rates.\nChapter 4 focused on the interface between reservoir management and short-term optimization layers, particularly considering network constraints in water flooding processes. Network constraints have appeared in other chapters, where they were represented using mathematical programming formulations and solved using state-of-the-art mixed-integer programming solvers. Instead, in this work, the network was represented by a graph and several correlations were used to calculate pressure drop derivatives in the pipelines. An efficient methodology based on multiple shooting was developed to represent both network and reservoir equations in water flooding optimization problems. The network variables and constraints were coupled to the reservoir equations by extending algebraic variables in the MS formulation. The methodology\nis flexible to handle complex network constraints in a much broader scale than previous works from the literature. The efficiency of the developed methodology relies on the use of parallelization and advanced techniques such as an MS formulation, an ODE solver with sensitivity capabilities, automatic differentiation and reduced-order SQP algorithm. The proposed methodology was able to handle complex network constraints such as the ones related to ESP operating envelopes in reservoir optimization problems.\n5.2\tFURTHER DEVELOPMENTS\nA list of suggestions for future work follows:\n\u2022\tInclude temperature and energy conservation equations in the experiments of Chapter 2. By doing that, it would be possible to impose constraints on the difference of velocity of the fluids, possibly avoiding slugs in the multiphase flow.\n\u2022\tConsider compressor scheduling [35] in the experiments conducted with the MPWL models in Chapter 2. The integrated optimization of gaslift distribution and compressor scheduling may result in improved decisions.\n\u2022\tIdentify problem-dependent cutting planes compatible with MPWL models. The motivation is that cutting-plane algorithms may reduce the computational time for refined MPWL approximations.\n\u2022\tApply the automatic routing model proposed in Chapter 3 in more complex production systems, possibly accounting for splitting of flows in other facilities. The gains with the automatic routing model may be even greater if the gathering network system is more complex and has more degrees of freedom, such as the network of Urucu field [80].\n\u2022\tImprove in the rSQP algorithm used in Chapter 4 to handle infeasible initial solutions. One possible direction is the use of an augmented Lagrangian method with a trust region in place of a line search.\n\u2022\tExtend the methodology proposed in Chapter 4 for three-phase fluid reservoirs. This would allow modeling other lifting methods such as gas-lift, but further investigation on pump modeling and processing constraints would be required.\n\u2022\tDevelop an implicit coupling for reservoir and network models. This would allow to control the wells through the network, meaning that the controls of the integrated system could be choke openings or ESP frequencies, instead of BHPs and well rates. The challenge in this case is to converge both reservoir and network equations simultaneously since their dynamics are quite different and thus the equations of the integrated production system will be stiff.\n\u2022 Include discrete variables in the methodology to optimize reservoirs with network constraints. One application is the integrated optimization of reservoir controls and infrastructure design of the field. One possible direction is to use the theory of mixed-integer optimal control developed by Sager[81].\nAPPENDIX A - DETAILED RESULTS OF CHAPTER 4\nThis appendix contains more detailed results for the experiments and simulation analysis presented on Chapter 4, particularly in Section 4.5.5. The results are divided in three sections which present the production and injection profiles of the wells and the operation trajectories of the ESPs on the network for each case study of the simulation analysis.\nRESERVOIR OPTIMIZATION WITHOUT NETWORK CONSTRAINTS\nThis section presents the results per well for a case study in which the reservoir production is optimized without network constraints. Figures A.1(a) and A.1(b) show the injection profile of wells i1 and i2. The production profile of wells p1, p2, p3, p4 and p5 are depicted in Figures A.2(a), A.3(a), A.4(a), A.5(a) and A.6(a), respectively. Figures A.2(b), A.3(b), A.4(b), A.5(b) and A.6(b) show the operation trajectory of the ESPs of production wells p1, p2, p3, p4 and p5, respectively.\n301\nWell:i1 Type:rate Sign:Injector\n299\n2\n0\n300\n500 \u25a0\u2014\nF\n0\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n500 |\n0\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n(a) Injection profile of well i1\n(b) Injection profile of well i2.\nFigure A.1: Network unconstrained: injection profile of wells i1 and\ni2.\nWell:p1 Type:bhp Sign:Producer\n150\n50\n100\nE,\n(a) Production profile of well p1\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n3500\n3000\n2500\n2000\n1500\n1000\n500\n(b) ESP operation trajectory for well p1.\nFigure A.2: Network unconstrained: production profile of well pl.\n200\n\n150\n-O\n100\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n3500\n3000\n2500\n2000\n1500\n1000\n500\n(b) ESP operation trajectory for well P2.\n(a) Production profile of well p2.\nFigure A.3: Network unconstrained: production profile of well p2.\nNETWORK CONSTRAINED RESERVOIR OPTIMIZATION\nThis section presents the results per well for a case study in which network constraints are taken into account in the reservoir optimization. The network constraints refer to the boundaries of the ESP operating envelopes. Figures A.7(a) and A.7(b) show the injection profile of wells it and i2. The production profile of wells p1, p2, p3, p4 and p5 are depicted in Figures A.8(a), A.9(a), A.10(a), A.11(a) and A.12(a), respectively. Figures A.8(b), A.9(b), A.10(b), A.11(b) and A.12(b) show the operation trajectory of the ESPs of production wells p1, p2, p3, p4 and p5, respectively.\nWell:p3 Type:bhp Siqn:Producer\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\n1\t---------i--------i--------i--------i---------i--------i--------i--------\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\n101\t|---i-----i----i-----i----i-----i-----i----\nH 100\t-\n99 I----1----1-----1----1-----1----1-------1--\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n(a) Production profile of well p3.\n3500\n3000\n2500\n2000\n1500\n1000\n500\n(b) ESP operation trajectory for well P3.\nFigure A.4: Network unconstrained: production profile of well \\mathrm{p}3.\nWell:p4 Type:bhp Siqn:Producer\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n(a) Production profile of well p4.\n3500\n3000\n2500\n2000\n1500\n1000\n500\n(b) ESP operation trajectory for well p4.\nFigure A.5: Network unconstrained: production profile of well \\mathrm{p}4.\nGREEDY STRATEGY IN RESERVOIR OPTIMIZATION\nThis section presents the results per well for a case study in which the reservoir is optimized with a greedy strategy instead of a long-term approach. Figures A.13(a) and A.13(b) show the injection profile of wells i1 and i2. The production profile of wells p1, p2, p3, p4 and p5 are depicted in Figures A.14(a), A.15(a), A.16(a), A.17(a) and A.18(a), respectively. Figures A.14(b), A.15(b), A.16(b), A.17(b) and A.18(b) show the operation trajectory of the ESPs of production wells p1, p2, p3, p4 and p5, respectively.\nWell:p5 Tvpe:bhp Siqn:Producer\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\nlocal liq. flow rate (sm3/d)\n3500\n3000\n2500\n2000\n1500\n1000\n500\n(a) Production profile of well \\mathrm{p}5.\n(b) ESP operation trajectory for well p5.\nFigure A.6: Network unconstrained: production profile of well \\mathrm{p}5.\n300\n299.5\nE.\ncr 299\n2\n1'\n0\n0\t500\t'000\t'500\t2000\t2500\t3000\t3500\t4000\n500*-----1-----1-----1-----1------1-----1-----1-----1\n'-------------------------------------------\n0 I-----.-----.-----.-----.-----.-----.-----.-----\n0\t500\t'000\t'500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n(a) Injection profile of well il.\n'------------\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\n500\n-Q\n0\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n(b) Injection profile of well i2.\nFigure A.7: Network constrained: injection profile of wells it and\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n3500\n3000\n2500\n2000\n1500\n1000\n500\n(a) Production profile of well pl.\n(b) ESP operation trajectory for well pl.\nFigure A.8: Network constrained: production profile of well pl.\nWell:p2 Type:bhp Sign:Producer\n______________________________\n150\n100\n50\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n(a) Production profile of well mathrm{p}2.\n3500\n3000\n2500\n2000 \u00a3 S\n1500 -I\n1000\n500\n(b) ESP operation trajectory for well P2-\nFigure A.9: Network constrained: production profile of well mathrm{p}2.\n100.0000000001\n100.00000000005\n1000\n3000\n4000\n2000\ntime(day)\n100\n0\n1000\n3500\n3000\n2500\n2000\n1500\n500\n(a) Production profile of well mathrm{p}3.\n150\nWell:p4 Type:bhp Sign:Producer\n100 E.\n50\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n3500\n3000\n2500\n2000\n1500\n1000\n500\n(a) Production profile of well p4.\n(b) ESP operation trajectory for well p4.\nFigure A.11: Network constrained: production profile of well \\mathrm{p}4.\n200\nWell:p5 Type:bhp Sign:Producer\n100\nE,\n0\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n3500\n3000\n2500\n2000\n1500\n1000\n500\n(a) Production profile of well p5\n(b) ESP operation trajectory for well p5.\n\nFigure A.12: Network constrained: production profile of well \\mathrm{p}5.\nWell:i1 Control target:rate Type:Injector\nWell:i2 Control target:rate Type:Injector\nE\no\u00b0 ---------,-------,------,------,------,------,------,----\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\nE\no\u00b0 I---------,------,------,-------,------,------,-------,----\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\n_ 301\n\u25a0S\n300\nE,\n299\n134\n500\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\n0\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n(a) Injection profile of well i1.\n133 k\ncr\tI_______i_______i_______i_______i_______i_______i_______i_______\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\n500\n0\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n(b) Injection profile of well i2.\nFigure A.13: Greedy strategy: injection profile of wells \\mathrm{i}1 and \\mathrm{i}2.\n200\n100\n0\nWell:p1 Control target:bhp Type:Producer\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\n100\n50\n0\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\n100.000001\n100.0000005\nQ.\nJD\n100\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n3500\n3000\n2500\n2000 \u00a3 S\n1500 -I\n1000\n500\n(a) Production profile of well p1.\n(b) ESP operation trajectory for well pt.\nFigure A.14: Greedy strategy: production profile of well pl.\nWell:p2 Control target:bhp Type:Producer\n0\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n3500\n3000\n2500\n2000 \u00a3 S\n1500 -I\n1000\n500\nWell:p3 Control target:bhp Type:Producer\nbhp (bar)\t% m 3/daV)\t% m 3/daV)\t77\tbhp(bar)\n200\n100\n0\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\nProduction profile of well p3.\n3500\n3000\n2500\n2000\n1500 -I\n1000\n500\n(b) ESP operation trajectory for well P3.\nFigure A.16: Greedy strategy: production profile of well p3.\nWell:p4 Control target:bhp Type:Producer\n200\n100\n0\n0\t500\t1000\t1500\t2000\t2500\t3000\t3500\t4000\ntime(day)\n3500\n3000\n2500\n2000\n1500 -I\n1000\n500\nbhp (bar)\t%\t3/day)\tqo (m 3/day)\nWell:p5 Control target:bhp Type:Producer\n200\n100\n0\n(a) Production profile of well p5.\n(b) ESP operation trajectory for well p5.\n3500\n3000\n2500\n2000\n500\n1000\n500\ntime (days)\nFigure A.18: Greedy strategy: production profile of well p5\nREFERENCES\n1\tJAHN, F.; COOK, M.; GRAHAM, M. Hydrocarbon exploration &amp; production. 2. ed. [S.l.]: Elsevier, 2008. (Developments in Petroleum Science, v. 55).\n2\tFOSS, B.; JENSEN, J. P. Performance analysis for closed-loop reservoir management. SPE Journal, Society of Petroleum Engineers, v. 16, n. 1, p. 183-190, 2011.\n3\tSTANKO, M.; GOLAN, M. et al. Exploring the potential of model-based optimization in oil production gathering networks with ESP-produced, high water cut wells. In: Proc. of the 17th International Conference on Multiphase Production Technology. Cannes, France: BHR Group, 2015.\n4\tYETEN, B. et al. Decision analysis under uncertainty for Smart Well deployment. Journal of Petroleum Science &amp; Engineering, v. 43, p. 183-199, 2004.\n5\tCAMPONOGARA, E. et al. An automation system for gas-lifted oil wells: Model identification, control, and optimization. Journal of Petroleum Science and Engineering, Elsevier, v. 70, n. 3, p. 157-167, 2010.\n6\tSILVA, T. L. Formula\u00e7\u00f5es inteiras mistas para modelos lineares por partes multidimensionais: aplicac\u00f5es na otimizacao da produ\u00e7\u00e3o de petr\u00f3leo sob restri\u00e7\u00f5es de press\u00e3o. Dissertation (Master) \u2014 Department of Automation and Systems Engineering, Federal University of Santa Catarina, 2012. In Portuguese.\n7\tMOIS\u00c9S, G. V.; ROLIM, T. A.; FORMIGEI, J. M. Gedig: Petrobras corporate program for digital integrated field management. In: Proc. of the SPE Intelligent Energy Conference and Exhibition. Amsterdam, The Netherlands: [s.n.], 2008.\n8\tCODAS, A.; CAMPONOGARA, E. Mixed-integer linear optimization for optimal lift-gas allocation with well-separator routing. European Journal of Operational Research, v. 212, p. 222-231, 2012.\n9\tBUITRAGO, S.; RODR\u00cdGUEZ, E.; ESPIN, D. Global optimization techniques in gas allocation for continuous flow gas lift systems. In: SPE Gas Technology Symposium. Calgary, Alberta, Canada: [s.n.], 1996.\n10\tALARC\u00d3N, G. A.; TORRES, C. F.; G\u00d3MEZ, L. E. Global optimization of gas allocation to a group of wells in artificial lift using nonlinear constrained programming. Journal of Energy Resources Technology, v. 124, n. 4, p. 262268, 2002.\n11\tCAMPONOGARA, E.; CONTO, A. de. Lift-gas allocation under precedence constraints: MILP formulation and computational analysis. IEEE Transactions on Automation Science and Engineering, v. 6, n. 3, p. 544-551, July 2009.\n12\tMISENER, R.; GOUNARIS, C. E.; FLOUDAS, C. A. Global optimization of gas lifting operations: A comparative study of piecewise linear formulations. Industrial &amp; Engineering Chemistry Research, v. 48, n. 13, p. 6098-6104, 2009.\n13\tBEGGS, D.; BRILL, J. A study of two-phase flow in inclined pipes. Journal of Petroleum technology, Society of Petroleum Engineers, v. 25, n. 5, p. 607-617, 1973.\n14\tLITVAK, M.; DARLOW, B. Surface network and well tubinghead pressure constraints in compositional simulation. In: Proc. of the SPE ReservoirSimulation Symposium. San Antonio, Texas: [s.n.], 1995.\n15\tKOSMIDIS, V.; PERKINS, J.; PISTIKOPOULOS, E. Optimization of well oil rate allocations in petroleum fields. Industrial &amp; Engineering Chemistry Research, ACS Publications, v. 43, n. 14, p. 3513-3527, 2004.\n16\tKOSMIDIS, V.; PERKINS, J.; PISTIKOPOULOS, E. A mixed integer optimization formulation for the well scheduling problem on petroleum fields. Computers &amp; Chemical Engineering, Elsevier, v. 29, n. 7, p. 1523-1541, 2005.\n17\tGUNNERUD, V.; FOSS, B. Oil production optimization-a piecewise linear model, solved with two decomposition strategies. Computers &amp; Chemical Engineering, v. 34, n. 11, p. 1803-1812, 2010.\n18\tVIELMA, J. P.; AHMED, S.; NEMHAUSER, G. Mixed-integer models for nonseparable piecewise-linear optimization: Unifying framework and extensions. Operations Research, v. 58, n. 2, p. 303-315, 2010.\n19\tTODD, M. Union jack triangulations. In: KARAMARDIAN, S. (Ed.). Fixed Points: algorithms and applications. [S.l.]: Academic Press, New York, London, 1977. p. 315-336.\n20\tCROXTON, K. L.; GENDRON, B.; MAGNANTI, T. L. A comparison of mixed-integer programming models for nonconvex piecewise linear cost minimization problems. Management Science, v. 49, p. 1268-1273, 2003.\n21\tJEROSLOW, R. G.; LOWE, J. K. Modelling with integer variables. In: Mathematical Programming at Oberwolfach II. [S.l.]: Springer Berlin Heidelberg, 1984. v. 22, p. 167-184.\n22\tMEYER, R. R. Mixed integer minimization models for piecewise-linear functions of a single variable. Discrete Mathematics, v. 16, n. 2, p. 163-171, 1976.\n23\tSHERALI, H. D. On mixed-integer zero-one representations for separable lower-semicontinuous piecewise-linear functions. Operations Research Letters, v. 28, n. 4, p. 155-160, 2001.\n24\tIBARAKI, T. Integer programming formulation of combinatorial optimization problems. Discrete Mathematics, v. 16, p. 39-52, 1976.\n25\tVIELMA, J.; KEHA, A.; NEMHAUSER, G. Nonconvex, lower semicon-tinuous piecewise linear optimization. Discrete Optimization, v. 5, n. 2, p. 467-488, 2008.\n26\tVIELMA, J.; NEMHAUSER, G. Modeling disjunctive constraints with a logarithmic number of binary variables and constraints. Mathematical Programming, v. 128, n. 1-2, p. 49-72, 2009.\n27\tSILVA, T. L.; CODAS, A.; CAMPONOGARA, E. A computational analysis of convex combination models for multidimensional piecewise-linear approximation in oil production optimization. In: Proc. of IFAC Workshop on Automatic Control in Offshore Oil and Gas Production. Trondheim, Norway: [s.n.], 2012.\n28\tBALAKRISHNAN, A.; GRAVES, S. C. A composite algorithm for a concave-cost network flow problem. Networks, v. 19, n. 2, p. 175-202, 1989.\n29\tLEE, J.; WILSON, D. Polyhedral methods for piecewise-linear functions i: the lambda method. Discrete Applied Mathematics, v. 108, n. 3, p. 269-285, 2001.\n30\tDANTZIG, G. On the significance of solving linear programming problems with some integer variables. Econometrica, Journal of the Econometric Society, v. 28, n. 1, p. 30-44, 1960.\n31\tJEROSLOW, R. G.; LOWE, J. K. Experimental results on the new techniques for integer programming formulations. Journal of the Operational Research Society, v. 36, n. 5, p. 393-403, 1985.\n32\tKEHA, A. B.; FARIAS JR, I. R. de; NEMHAUSER, G. L. Models for representing piecewise linear cost functions. Operations Research Letters, v. 32, p. 44-48, 2004.\n33\tPADBERG, M. Approximating separable nonlinear functions via mixed zero-one programs. Operations Research Letters, v. 27, n. 1, p. 1-5, 2000.\n34\tBEALE, E. M. L.; TOMLIN, J. A. Special facilities in a general mathematical programming system for non-convex problems using ordered sets of variables. In: Proc. of the Fifth International Conference on Operations Research. [S.I.: s.n.], 1970. p. 447-454.\n35\tCAMPONOGARA, E.; NAZARI, L. F.; MENESES, C. N. A revised model for compressor design and scheduling in gas-lifted oil fields. IIE Transactions, v. 44, n. 5, p. 342-351, 2012.\n36\tBEALE, E. M. L. Branch and bound methods for numerical optimization of non-convex functions. Computational Statistics, v. 80, p. 11-20, 1980.\n37\tCODAS, A. et al. Integrated production optimization of oil fields with pressure and routing constraints: the Urucu field. Computers &amp; Chemical Engineering, v. 46, p. 178-189, 2012.\n38\tSILVA, T. L.; CAMPONOGARA, E. A computational analysis of multidimensional piecewise-linear models with applications to oil production optimization. European Journal of Operational Research, v. 232, n. 3, p. 630-642, 2014.\n39\tTOMLIN, J. A. Special ordered sets and an application to gas supply operations planning. Mathematical Programming, v. 42, n. 1-3, p. 69-84, 1988.\n40\tAGUIAR, M. A. S.; CAMPONOGARA, E.; SILVA, T. L. A mixed-integer convex formulation for production optimization of gas-lifted oil wells with routing and pressure constraints. Brazilian Journal of Chemical Engineering, v. 31, n. 2, p. 439-455, 2014.\n41\tFOURER, R.; GAY, D. M.; KERNIGHAN, B. W. AMPL: A Modeling Language for Mathematical Programming. [S.l.]: Boyd Fraser Publishing Company, 1993.\n42\tCAMPONOGARA, E.; NAKASHIMA, P. H. R. Solving a gas-lift optimization problem by dynamic programming. European Journal of Operational Research, v. 174, n. 2, p. 1220-1246, 2006.\n43\tJANSEN, J.; BROUWER, R.; DOUMA, S. G. Closed loop reservoir management. In: Proc. of the SPE Reservoir Simulation Symposium. The Woodlands, Texas: [s.n.], 2009.\n44\tWANG, C.; LI, G.; REYNOLDS, A. C. Production optimization in closed-loop reservoir management. SPE Journal, Society of Petroleum Engineers, v. 14, n. 3, p. 506-523, 2010.\n45\tPETERS, L. et al. Results of the Brugge benchmark study for flooding optimization and history matching. SPE Reservoir Evaluation &amp; Engineering, v. 13, n. 03, p. 391 - 405, 2010.\n46\tCHEN, Z.; HUAN, G.; MA, Y. Computational methods for multiphase flows in porous media. Philadelphia, PA: Society for Industrial and Applied Mathematics, 2006.\n47\tJANSEN, J.-D.; BOSGRA, O. H.; HOF, P. M. V. den. Model-based control of multiphase flow in subsurface oil reservoirs. Journal of Process Control, v. 18, n. 9, p. 846 - 855, 2008.\n48\tJANSEN, J. Adjoint-based optimization of multi-phase flow through porous media: A review. Computers &amp; Fluids, Elsevier Ltd, v. 46, n. 1, p. 40-51, jul 2011.\n49\tSAPUTELLI, L.; NIKOLAOU, M.; ECONOMIDES, M. Real-time reservoir management: A multiscale adaptive optimization and control approach. Computational Geosciences, v. 10, n. 1, p. 61-96, 2006.\n50\tESSEN, G. van; HOF, P. Van den; JANSEN, J.-D. Hierarchical long-term and short-term production optimization. SPE Journal, Society of Petroleum Engineers, v. 16, n. 1, p. 191-199, 2011.\n51\tSUWARTADI E., K. S. F. B. Nonlinear output constraints handling for production optimization of oil reservoirs. Computational Geosciences, Springer Netherlands, v. 16, n. 2, p. 499-517, 2011.\n52\tCHEN, C. et al. Closed-loop reservoir management on the brugge test case. Computational Geosciences, v. 14, n. 4, p. 691-703, 2010. ISSN 1573-1499.\n53\tCODAS, A.; FOSS, B.; CAMPONOGARA, E. Output constraint handling and parallelization for oil-reservoir control optimization by means of multiple shooting. SPE Journal, v. 20, n. 04, p. 856-871, August 2015.\n54\tGOKHAN, H.; SANTANU, B.; WADE, B. Integration of a Field Surface and Production Network With a Reservoir Simulator. SPE ComputerApplications, n. June, 1997.\n55\tSCHIOZER, D. J. Simultaneous Simulation of Reservoir and Surface Facilities. Thesis (Doctoral), 1994.\n56\tTINGAS, J. et al. Integated reservior and surface network simulation in reservoir management of southern north sea gas reservoirs. In: SOCIETY OF PETROLEUM ENGINEERS. European Petroleum Conference. [S.I.], 1998.\n57\tKOSMALA, A. et al. Coupling of a Surface Network With Reservoir Simulation. In: SPE Annual Technical Conference and Exhibition. [S.l.]: Society of Petroleum Engineers, 2003.\n58\tDAVIDSON, J.; BECKNER, B. Integrated Optimization for Rate Allocation in Reservoir Simulation. Proc. of SPE Reservoir Simulation Symposium, Society of Petroleum Engineers, n. eq 1, p. 1-7, feb 2003.\n59\tCOATS, B. et al. A Generalized Wellbore and Surface Facility Model, Fully Coupled to a Reservoir Simulator. SPE Reservoir Evaluation &amp; Engineering, v. 7, n. 02, p. 132-142, apr 2004.\n60\tRAHMAWATI, S. D. et al. Integrated field operation and optimization. Journal of Petroleum Science and Engineering, v. 81, p. 161 - 170, 2012.\n61\tGAO, M. Reservoir and Surface Facilities Coupled Through Partially And Fully Implicit Approaches. Dissertation (Master) \u2014 Texas A&amp; M University, 2014.\n62\tPEACEMAN, D. W. Interpretation of well-block pressures in numerical reservoir simulation. Society of Petroleum Engineers Journal, v. 23, n. 3, p. 531 - 543, June 1983.\n63\tLIE, K.-A. et al. Open-source matlab implementation of consistent discretisations on complex grids. Computational Geosciences, v. 16, n. 2, p. 297-322, 2012.\n64\tBEGGS, D. H.; BRILL, J. P. A study of two-phase flow in inclined pipes. Journal of Petroleum Technology, v. 25, n. 05, p. 607 - 617, 1973.\n65\tBRILL, J. P.; MUKHERJEE, H. K. Multiphase flow in wells. Richardson, TX: Society of Petroleum Engineers, 1999. (SPE Monograph Series, v. 17).\n66\tJANSEN, J. D. Nodal analysis of oil and gas wells - system modeling and numerical implementation. [S.l.]: SPE Textbook Series. SPE, Richardson. In Production, 2016.\n67\tHAGEDORN, A. R.; BROWN, K. E. et al. Experimental study of pressure gradients occurring during continuous two-phase flow in small-diameter vertical conduits. Journal of Petroleum Technology, Society of Petroleum Engineers, v. 17, n. 04, p. 475-484, 1965.\n68\tMOODY, L. F. Eriction factors for pipe flow. Transactions of the AMSE, v. 66, n. 8, p. 671-684, 1944.\n69\tPAYNE, G. A. et al. Evaluation of inclined-pipe, two-phase liquid holdup and pressure-loss correlation using experimental data. Journal of Petroleum Technology, v. 31, n. 09, p. 1198 - 1208, 1979.\n70\tCOLEBROOK, C. F. et al. Turbulent flow in pipes, with particular reference to the transition region between the smooth and rough pipe laws. Journal of the Institution of Civil Engineers, v. 12, n. 8, p. 393-422, 1939.\n71\tPAVLOV, A. et al. Modelling and model predictive control of oil wells with electric submersible pumps. In: Proc. of the IEEE Conference on Control Applications (CCA). Antibes, France: [s.n.], 2014. p. 586-592.\n72\tAHUJA, R. K.; MAGNANTI, T. L.; ORLIN, J. B. Network flows: theory, algorithms, and applications. 1. ed. Philadelphia, PA: Prentice hall, 1993.\n73\tGRIMSTAD, B. et al. Global optimization of multiphase flow networks using spline surrogate models. Computers &amp; Chemical Engineering, v. 84, n. 4, p. 237-254, Jan 2015.\n74\tBOCK, H. G.; PLITT, K.-J. A multiple shooting algorithm for direct solution of optimal control problems. In: PROC. OF THE 9TH IFAC WORLD CONGRESS. Budapest, Hungary, 1984.\n75\tHINDMARSH, A. C. et al. SUNDIALS: Suite of nonlinear and differen-tial/algebraic equation solvers. ACM Transactions on Mathematical Software (TOMS), ACM, v. 31, n. 3, p. 363-396, 2005.\n76\tCODAS, A. REduced Multiple Shooting Optimizer (REMSO). 2015. Available from Internet:&lt;https://github.com/iocenter/remso>.\n77\tLIE, K.-A. et al. Open-source matlab implementation of consistent discretisations on complex grids. Computational Geosciences, v. 16, n. 2, p. 297-322, 2012.\n78\tROYSEM, E. H.; ALFSEN, M. Optimization of investment strategy related to subsea water separator using reservoir simulation. Dissertation (Master) \u2014 Norwegian University of Science and Technology, December 2012.\n79\tFISCHETTI, M.; GLOVER, F.; LODI, A. The feasibility pump. Mathematical Programming, Springer, v. 104, n. 1, p. 91-104, 2005.\n80\tCODAS, A. et al. Integrated production optimization of oil fields with pressure and routing constraints: The Urucu field. Computers &amp; Chemical Engineering, Elsevier, v. 46, p. 178-189, 2012.\n81\tSAGER, S. Numerical methods for mixed-integer optimal control problems. [S.l.]: Der andere Verlag Tonning, Lubeck, Marburg, 2005."}]}}}