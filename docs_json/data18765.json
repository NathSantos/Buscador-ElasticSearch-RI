{"add": {"doc": {"field": [{"@name": "docid", "#text": "BR-TU.22652"}, {"@name": "filename", "#text": "6671_348412.pdf"}, {"@name": "filetype", "#text": "PDF"}, {"@name": "text", "#text": "Carolina Maia Vettorazzo\n\nMODEL PREDICTIVE CONTROL OF GAS COMPRESSION STATION\nIN OFF-SHORE PRODUCTION PLATFORMS\n\nDissertation presented to the Gra-\nduate Program in Automation and\nSystems Engineering in partial ful-\nfillment of the requirements for the\ndegree of Master in Automation and\nSystems Engineering.\n\nAdvisor: Prof. Agustinho Plucenio, Ph.D\nCo-advisor: Prof. Julio Elias Normey-Rico, Ph.D\n\nFlorian\u00f3polis\n\n2016\n\n\n\nFicha de identifica\u00e7\u00e3o da obra elaborada pelo autor,\n atrav\u00e9s do Programa de Gera\u00e7\u00e3o Autom\u00e1tica da Biblioteca Universit\u00e1ria da UFSC.\n\nVettorazzo, Carolina Maia\n   Model predictive control of gas compression\nstation in off-shore production platforms /\nCarolina Maia Vettorazzo ; orientador, Agustinho\nPlucenio; coorientador, J\u00falio Elias Normey-Rico -\nSC, 2016.\n   112 p.\n\n   Disserta\u00e7\u00e3o (mestrado) - Universidade Federal de\nSanta Catarina, Centro Tecnol\u00f3gico, Programa de P\u00f3s\nGradua\u00e7\u00e3o em Engenharia de Automa\u00e7\u00e3o e Sistemas,\nFlorian\u00f3polis, 2016.\n\n   Inclui refer\u00eancias. \n\n   1. Engenharia de Automa\u00e7\u00e3o e Sistemas. 2.\nSistemas de compress\u00e3o. 3. MPC. 4. Ajuste de\ncontroladores. I. Plucenio, Agustinho. II. Normey\nRico, J\u00falio Elias. III. Universidade Federal de\nSanta Catarina. Programa de P\u00f3s-Gradua\u00e7\u00e3o em\nEngenharia de Automa\u00e7\u00e3o e Sistemas. IV. T\u00edtulo.\n\n\n\nCarolina Maia Vettorazzo\n\nMODEL PREDICTIVE CONTROL OF GAS COMPRESSION STATION\nIN OFF-SHORE PRODUCTION PLATFORMS\n\nThis Dissertation is recommended in partial fulfillment of the require-\nments for the degree of \u201cMaster in Automation and Systems Engine-\nering\u201d, which has been approved in its present form by the Graduate\nProgram in Automation and Systems Engineering.\n\nFlorian\u00f3polis, December 14th 2016.\n\nProf. Dr. Daniel Ferreira Coutinho\nGraduate Program Coordinator\n\nFederal University of Santa Catarina\n\nDissertation Committee:\n\nProf. Agustinho Plucenio, Ph.D\nAdvisor\n\nFederal University of Santa Catarina\n\nDaniel Martins Lima, Ph.D\nFederal University of Santa Catarina\n\nEduardo Camponogara, Ph.D\nFederal University of Santa Catarina\n\nEug\u00eanio de Bona Castelan Neto, Ph.D\nFederal University of Santa Catarina\n\n\n\n\n\n\u00c0 minha fam\u00edlia.\n\n\n\n\n\nACKNOWLEDGEMENTS\n\nI would like to thank my advisors Prof. Agustinho Plucenio and\nProf. Julio Normay-Rico for teaching me. They gave me the opportunity\nto work with them and inspired me to become a better researcher.\n\nI thank my family and friends for all the support. They believed\nin my potential even when I did not and kept me on my path during\nthe worst moments. I am very grateful to my partner Marco who was\nalways by my side, even when we were in different time zones.\n\nI thank my research colleagues for all the theoretical discussions\nand ideas, specially Rafael Sartori and Thaise Damo for the support\noutside the lab.\n\nI also thank the engineers Marcelo Lima and Mario Campos from\nCenpes \u2013 Petrobras for their enlightenment on the compressor\u2019 theory\nand ideas.\n\nFinally, I thank the Federal University of Santa Catarina and the\nDepartment of Automation and Systems for accepting me in the gra-\nduate program, allowing me to use their facilities and resources, and\nPetrobras funding my research.\n\n\n\n\n\n\"We but mirror the world. All the tendencies\npresent in the outer world are to be found in\nthe world of our body. If we could change\nourselves, the tendencies in the world would\nalso change. As a man changes his own na-\nture, so does the attitude of the world change\ntowards him. This is the divine mystery su-\npreme. A wonderful thing it is and the source\nof our happiness. We need not wait to see\nwhat others do.\"\n(Original quote for the saying: \"Be the change\nyou wish to see in the world\")\n\n\u2013 Mahatma Gandhi\n\n\n\n\n\nRESUMO ESTENDIDO\n\nUma plataforma off-shore normalmente produz petr\u00f3leo bruto e\ng\u00e1s natural. O g\u00e1s \u00e9 tratado para a remoc?\u00e3o da humidade e sua press\u00e3o\ne sua temperatura s\u00e3o modificadas de acordo com sua aplicac?\u00e3o final.\nParte do g\u00e1s \u00e9 direcionado para a linha de exportac?\u00e3o de g\u00e1s para ser\ncomercializado. Muitas vezes o g\u00e1s \u00e9 utilizado por poc?os que operam\ncom elevac?\u00e3o por gaslift. O g\u00e1s natural tamb\u00e9m \u00e9 usado em turbinas\npara gerar eletricidade. Um sistema de compress\u00e3o de g\u00e1s \u00e9 uma parte\nimportante de uma unidade de produc?\u00e3o off-shore de petr\u00f3leo. O tipo\nde compressor mais usado em um sistema de compress\u00e3o de g\u00e1s \u00e9 o\ncompressor centr\u00edfugo. Uma falha do compressor pode fazer com que\numa unidade de produc?\u00e3o completa seja desligada. Os compressores\ncentr\u00edfugos t\u00eam limites operacionais muito restritos e s\u00e3o muito sen-\ns\u00edveis a mudanc?as na vaz\u00e3o de entrada de g\u00e1s ou nas propriedades\ndo mesmo. O compressor pode entrar em surge, que \u00e9 uma condic?\u00e3o\noperacional inst\u00e1vel caracterizada pelo fluxo reverso de g\u00e1s dentro do\ncompressor e que pode acontecer quando a vaz\u00e3o de entrada de g\u00e1s \u00e9\nmuito baixa. Um compressor centr\u00edfugo que opera em surge n\u00e3o com-\nprimir\u00e1 o g\u00e1s corretamente, causando danos permanentes \u00e0 m\u00e1quina.\nO procedimento normal utilizado quando se detecta a ocorr\u00eancia de\nsurge \u00e9 parar o compressor. Geralmente, os compressores centr\u00edfugos\ns\u00e3o instalados com um controle regulat\u00f3rio que inclui a prevenc?\u00e3o de\nsurge. No entanto, mudanc?as bruscas na vaz\u00e3o de entrada de g\u00e1s e\nna composic?\u00e3o do g\u00e1s s\u00e3o conhecidas por fazer com que o compressor\ncentr\u00edfugo pare com freq\u00fc\u00eancia. Esta dissertac?\u00e3o prop\u00f5e um controla-\ndor MPC que reduz o consumo de energia do sistema de compress\u00e3o\ne melhora sua protec?\u00e3o contra surge. Este trabalho tamb\u00e9m apresenta\na modelagem de uma estac?\u00e3o de compress\u00e3o real composta de dois\ncompressores de tr\u00eas est\u00e1gios. Com base na an\u00e1lise do comportamento\ndo sistema e da relac?\u00e3o din\u00e2mica entre as entradas e sa\u00eddas do sistema,\ns\u00e3o propostas e testadas duas formulac?\u00f5es de MPC diferentes. Para\najustar o controlador MPC foi aplicada a t\u00e9cnica de ajuste satisfat\u00f3rio,\nmelhorando o desempenho do controlador.\n\nPalavras-chave: Sistemas de compress\u00e3o. MPC. Ajuste de controla-\ndores\n\n11\n\n\n\n\n\nABSTRACT\n\nAn offshore oil production unit normally produces crude oil and\nnatural gas. The gas is treated for removal of moisture and its pressure\nand temperature are conditioned to its target application. Part of the\ngas is directed to the gas export line for sales. Often it is used by wells\noperating with gas lift. Natural gas is also used in turbines to generate\nelectricity. A gas compression system is an important part of an offshore\noil production unit. The most important type of equipment used in a\ngas compression system is the centrifugal compressor. A compressor\nfailure may cause a complete production unit shut down. Centrifugal\ncompressors have a limited operational range and are very sensitive to\nchanges in the gas flow rate or in its properties. Compressor surge is\nan unstable operational condition characterized by reverse flow inside\nthe compressor and it can happen when the gas flow rate is too low. A\ncentrifugal compressor operating in surge mode will not compress the\ngas as required and the machine could be damaged permanently. The\nnormal procedure used when surge is detected is to stop the compressor.\nUsually centrifugal compressors are installed with a regulatory control\nthat includes the avoidance of surge. But abrupt changes in gas flow-\nrate and gas composition are known to cause centrifugal compressor to\nstop the production operations too often. This dissertation proposes a\nMPC controller that reduces the energy consumption of the compres-\nsion system and improves its protection against surge. This work also\npresents the modeling of a real compression station composed of two\nthree-stage compressors. Based on the analysis of the system\u2019s behavior\nand the dynamic relation between inputs and outputs, two different\nMPC formulations are proposed and tested. To tune the MPC controller\nthe satisficing tuning technique is applied, improving the controller\u2019s\nperformance.\n\nKeywords: Compression system. MPC. Tuning.\n\n13\n\n\n\n\n\nLIST OF FIGURES\n\n3.1 Production platform, adapted from [1] . . . . . . . . . . 45\n3.2 Compression system . . . . . . . . . . . . . . . . . . . . 47\n3.3 Surge and Stonewall . . . . . . . . . . . . . . . . . . . . 49\n3.4 Compression stage configuration proposed in [2] . . . . 51\n3.5 Compression stage modeled in this work . . . . . . . . . 52\n3.6 Relation between volumetric flow rate, pressure ratio,\n\nand normalized rotational speed . . . . . . . . . . . . . 55\n3.7 Inlet header . . . . . . . . . . . . . . . . . . . . . . . . . 59\n3.8 Example of a compressor map . . . . . . . . . . . . . . . 64\n3.9 Gas flows through the heat exchanger . . . . . . . . . . 65\n3.10 Inlet gas flow . . . . . . . . . . . . . . . . . . . . . . . . 67\n3.11 Results of the regulatory control system - inlet header\n\npressure . . . . . . . . . . . . . . . . . . . . . . . . . . . 67\n3.12 Results of the regulatory control system - flared gas . . . 68\n3.13 Results of the regulatory control system - Stage 1 . . . . 69\n3.14 Results of the regulatory control system - Stage 2 . . . . 70\n3.15 Results of the regulatory control system - Stage 3 . . . . 71\n3.16 Results of the regulatory control system - outlet header\n\npressure . . . . . . . . . . . . . . . . . . . . . . . . . . . 72\n3.17 Power consumption . . . . . . . . . . . . . . . . . . . . . 72\n3.18 Matrix of the step responses between the possible ma-\n\nnipulated and controlled variables . . . . . . . . . . . . 77\n3.19 Matrix of the step responses between the possible ma-\n\nnipulated and controlled variables . . . . . . . . . . . . 78\n3.20 Matrix of the step responses between the possible ma-\n\nnipulated and controlled variables . . . . . . . . . . . . 79\n3.21 Matrix of the step responses between the possible ma-\n\nnipulated and controlled variables . . . . . . . . . . . . 80\n3.22 Static relation between pin, P , and \\phi ASV,1 . . . . . . . . 82\n\n4.1 MPC and PID interaction . . . . . . . . . . . . . . . . . . 85\n4.2 Gas flow rate that enters the compression system - min . 86\n4.3 Results of the application of MPC1 - Stage 1. Dashed\n\nblack line: regulatory control without MPC, solid blue\nline: regulatory control with MPC1, doted black line:\nsurge index upper limit . . . . . . . . . . . . . . . . . . . 91\n\n4.4 Results of the application of MPC1 - Stage 2. Dashed\nblack line: regulatory control without MPC, solid blue\nline: regulatory control with MPC1, doted black line:\nsurge index upper limit . . . . . . . . . . . . . . . . . . . 92\n\n15\n\n\n\n4.5 Results of the application of MPC1 - Stage 3. Dashed\nblack line: regulatory control without MPC, solid blue\nline: regulatory control with MPC1, doted black line:\nsurge index upper limit . . . . . . . . . . . . . . . . . . . 93\n\n4.6 Results of the application of MPC1 - inlet header pres-\nsure. Dashed black line: regulatory control without MPC,\nsolid blue line: regulatory control with MPC1 . . . . . . 94\n\n4.7 Results of the application of MPC1 - outlet header pres-\nsure. Dashed black line: regulatory control without MPC,\nsolid blue line: regulatory control with MPC1 . . . . . . 94\n\n4.8 Results of the application of MPC1 - flared gas. Dashed\nblack line: regulatory control without MPC, solid blue\nline: regulatory control with MPC1 . . . . . . . . . . . . 95\n\n4.9 Results of the application of MPC2 - Stage 1. Dashed\nblack line: regulatory control without MPC, solid blue\nline: regulatory control with MPC2, doted black line:\nsurge index upper limit . . . . . . . . . . . . . . . . . . . 98\n\n4.10 Results of the application of MPC2 - Stage 2. Dashed\nblack line: regulatory control without MPC, solid blue\nline: regulatory control with MPC2, doted black line:\nsurge index upper limit . . . . . . . . . . . . . . . . . . . 99\n\n4.11 Results of the application of MPC2 - Stage 3. Dashed\nblack line: regulatory control without MPC, solid blue\nline: regulatory control with MPC2, doted black line:\nsurge index upper limit . . . . . . . . . . . . . . . . . . . 100\n\n4.12 Results of the application of MPC2 - inlet header pres-\nsure. Dashed black line: regulatory control without MPC,\nsolid blue line: regulatory control with MPC2 . . . . . . 101\n\n4.13 Results of the application of MPC2 - outlet header pres-\nsure. Dashed black line: regulatory control without MPC,\nsolid blue line: regulatory control with MPC2 . . . . . . 101\n\n4.14 Results of the application of MPC2 - flared gas. Dashed\nblack line: regulatory control without MPC, solid blue\nline: regulatory control with MPC2 . . . . . . . . . . . . 102\n\n4.15 Results of the satisficing tuning applied on MPC2 - Stage\n1. Dashed black line: regulatory control without MPC,\nsolid blue line: regulatory control with MPC2 tuned man-\nually, solid red line: regulatory control with MPC2 tuned\nwith the satisficing technique, doted black line: surge in-\ndex upper limit . . . . . . . . . . . . . . . . . . . . . . . 104\n\n\n\n4.16 Results of the satisficing tuning applied on MPC2 - Stage\n2. Dashed black line: regulatory control without MPC,\nsolid blue line: regulatory control with MPC2 tuned man-\nually, solid red line: regulatory control with MPC2 tuned\nwith the satisficing technique, doted black line: surge in-\ndex upper limit . . . . . . . . . . . . . . . . . . . . . . . 105\n\n4.17 Results of the satisficing tuning applied on MPC2 - Stage\n3. Dashed black line: regulatory control without MPC,\nsolid blue line: regulatory control with MPC2 tuned man-\nually, solid red line: regulatory control with MPC2 tuned\nwith the satisficing technique, doted black line: surge in-\ndex upper limit . . . . . . . . . . . . . . . . . . . . . . . 106\n\n4.18 Results of the satisficing tuning applied on MPC2 - in-\nlet header pressure. Dashed black line: regulatory con-\ntrol without MPC, solid blue line: regulatory control with\nMPC2 tuned manually, solid red line: regulatory control\nwith MPC2 tuned with the satisficing technique . . . . . 107\n\n4.19 Results of the satisficing tuning applied on MPC2 - out-\nlet header pressure. Dashed black line: regulatory con-\ntrol without MPC, solid blue line: regulatory control with\nMPC2 tuned manually, solid red line: regulatory control\nwith MPC2 tuned with the satisficing technique . . . . . 107\n\n4.20 Results of the satisficing tuning applied on MPC2 - flared\ngas. Dashed black line: regulatory control without MPC,\nsolid blue line: regulatory control with MPC2 tuned man-\nually, solid red line: regulatory control with MPC2 tuned\nwith the satisficing technique . . . . . . . . . . . . . . . 108\n\n4.21 Results of the satisficing tuning applied on MPC2 - con-\nsumed power. Dashed black line: regulatory control with-\nout MPC, solid blue line: regulatory control with MPC2\ntuned manually, solid red line: regulatory control with\nMPC2 tuned with the satisficing technique . . . . . . . . 108\n\n4.22 Results of the robustness test - stage 1. Solid black line:\nregulatory control without MPC, colored dashed lines:\nregulatory control with MPC2, doted black line: surge\nindex upper limit . . . . . . . . . . . . . . . . . . . . . . 111\n\n4.23 Results of the robustness test - stage 2. Solid black line:\nregulatory control without MPC, colored dashed lines:\nregulatory control with MPC2, doted black line: surge\nindex upper limit . . . . . . . . . . . . . . . . . . . . . . 112\n\n\n\n4.24 Results of the robustness test - stage 3. Solid black line:\nregulatory control without MPC, colored dashed lines:\nregulatory control with MPC2, doted black line: surge\nindex upper limit . . . . . . . . . . . . . . . . . . . . . . 113\n\n4.25 Results of the robustness test - inlet header pressure.\nSolid black line: regulatory control without MPC, colored\ndashed lines: regulatory control with MPC2 . . . . . . . 114\n\n4.26 Results of the robustness test - outlet header pressure.\nSolid black line: regulatory control without MPC, colored\ndashed lines: regulatory control with MPC2 . . . . . . . 114\n\n4.27 Results of the robustness test - flared gas. Solid black\nline: regulatory control without MPC, colored dashed\nlines: regulatory control with MPC2 . . . . . . . . . . . . 115\n\n4.28 Results of the robustness test - consumed power. Solid\nblack line: regulatory control without MPC, colored dashed\nlines: regulatory control with MPC2 . . . . . . . . . . . . 115\n\n\n\nLIST OF TABLES\n\n4.1 MPC performance comparison . . . . . . . . . . . . . . . 109\n\n19\n\n\n\n\n\nACRONYMS\n\nARIMA Auto-Regressive Integrated Moving Average\nDMC Dynamic Matrix Control\nEHAC Extended Horizon Adaptive Control\nEPSAC Extended Prediction Self-adaptive Control\nGPC Generalized Predictive Control\nMIMO Multiple Inputs Multiple Outputs\nMPC Model Predictive Control\nMTBF Mean Time Between Failure\nSISO Single Input Single Output\n\n21\n\n\n\n\n\nSYMBOLS\n\nA1 Area of the impeller (m2)\nCVN Flow coefficient\nG Dynamic matrix of the system\nIS Index of surge\nJ Compressor moment of inertia (kgm2)\nKiexp Integral gain of the outlet pressure controller\nKpexp Proportional gain of the outlet pressure controller\nLc Length of the duct (m)\nMW Molecular weight of the gas mixture (kg/kmol)\nQcp Gas volume flow rate through the compressor (m3/s)\nQsurge Minimum gas volume flow rate through the compres-\n\nsor to avoid surge (m3/s)\nQ Gas volume flow rate (m3/s)\nR Gas constant (J/mol)\nTd Discharge temperature of a compression stage (K)\nTs Suction temperature of a compression stage (K)\nVp Plenum volume (m3)\nVh Outlet header volume, it represents the total volume\n\nassociated with the pipes (m3)\nVin Volume of the compressor inlet drum (m3)\nZ Gas compressibility\n\\Psi (\\omega , m) Compressor characteristic curve\n\\eta p Polytropic efficiency of the compression\n\\mu Compressor slip factor\n\\omega Compressor speed (rad/s)\n\\tau c Torque exerted by the compressor load (Nm)\n\\tau d Driver torque (Nm)\na0 Sonic velocity (m/s)\nk Gas specific heat ratio\nmt Gas mass flow rate through the throttle (kg/s)\nmexp Gas mass flow rate delivered the exportation line\n\n(kg/s)\nmflare Gas mass flow rate in the flare line (kg/s)\nmin,1 Gas mass flow rate entering the compression train 1\n\n(kg/s)\nmin,2 Gas mass flow rate entering the compression train 2\n\n(kg/s)\nmin Inlet gas mass flow rate (kg/s)\nmout,1 Gas mass flow rate from compressor train 1 (kg/s)\nmout,2 Gas mass flow rate from compressor train 2 (kg/s)\n\n23\n\n\n\nmout Outlet gas mass flow rate (kg/s)\nmp1 Gas mass flow rate delivered to process 1 (kg/s)\nmp2 Gas mass flow rate delivered to process 2 (kg/s)\nmr Gas mass flow rate through antisurge valve (kg/s)\nm Gas mass flow rate through the compressor (kg/s)\npd Discharge pressure of the compressor stage (bar)\npp Pressure in the plenum (Pa)\nps Suction pressure of a compression stage (m3/s)\npin Pressure in the inlet header (bar)\npout Pressure in the outlet header (bar)\nps,1 Suction pressure of stage 1 of compression train 1\n\n(bar)\nps,2 Suction pressure of stage 1 of compression train 2\n\n(bar)\npdij Discharge pressure of stage ij, where i refers to the\n\ncompressor line and j to the compressor stage (bar)\nr2 Impeller radius (m)\n\n\n\nCONTENTS\n\n1 Introduction 27\n1.1 Objectives and contributions . . . . . . . . . . . . . . 29\n1.2 Organization of the dissertation . . . . . . . . . . . . 30\n\n2 Model Predictive Control 31\n2.1 MPC elements . . . . . . . . . . . . . . . . . . . . . . 32\n\n2.1.1 Prediction model . . . . . . . . . . . . . . . . 32\n2.1.1.1 Process model . . . . . . . . . . . . . 32\n2.1.1.2 Disturbance model . . . . . . . . . . 32\n2.1.1.3 Free and forced response . . . . . . . 33\n\n2.1.2 Objective function . . . . . . . . . . . . . . . . 34\n2.1.2.1 Constraints . . . . . . . . . . . . . . . 35\n\n2.1.3 Control law . . . . . . . . . . . . . . . . . . . 36\n2.1.4 Reference tracking and band control . . . . . . 36\n\n2.2 Dynamic Matrix Controller (DMC) . . . . . . . . . . . 37\n2.3 MPC Tuning with Satisficing Technique . . . . . . . . 41\n2.4 Final comments . . . . . . . . . . . . . . . . . . . . . 43\n\n3 Compression System 45\n3.1 Surge and Stonewall . . . . . . . . . . . . . . . . . . 47\n3.2 Surge indexes . . . . . . . . . . . . . . . . . . . . . . 48\n3.3 Modeling . . . . . . . . . . . . . . . . . . . . . . . . . 49\n\n3.3.1 Compression stage . . . . . . . . . . . . . . . 52\n3.3.2 Power consumption . . . . . . . . . . . . . . . 56\n3.3.3 Inlet header . . . . . . . . . . . . . . . . . . . 58\n3.3.4 Outlet header . . . . . . . . . . . . . . . . . . 60\n\n3.4 Regulatory control . . . . . . . . . . . . . . . . . . . 61\n3.4.1 Inlet pressure and load sharing . . . . . . . . . 61\n3.4.2 Outlet header pressure . . . . . . . . . . . . . 63\n3.4.3 Antisurge control . . . . . . . . . . . . . . . . 63\n3.4.4 Suction temperature control . . . . . . . . . . 65\n\n3.5 System simulation . . . . . . . . . . . . . . . . . . . . 66\n3.6 Control objectives . . . . . . . . . . . . . . . . . . . . 73\n3.7 Linear model . . . . . . . . . . . . . . . . . . . . . . 73\n\n3.7.1 Step responses analysis . . . . . . . . . . . . . 74\n3.7.2 Variables selection . . . . . . . . . . . . . . . . 82\n\n3.8 Final comments . . . . . . . . . . . . . . . . . . . . . 83\n\n4 Implementation and Results 85\n4.1 MPC implementations . . . . . . . . . . . . . . . . . 86\n\n\n\n4.1.1 MPC 1 . . . . . . . . . . . . . . . . . . . . . . 87\n4.1.2 MPC 2 . . . . . . . . . . . . . . . . . . . . . . 95\n4.1.3 MPC with satisficing tuning . . . . . . . . . . . 102\n\n4.2 Robustness analysis . . . . . . . . . . . . . . . . . . . 109\n4.3 Final comments . . . . . . . . . . . . . . . . . . . . . 116\n\n5 Conclusions 117\n\nReferences 119\n\n\n\n1 INTRODUCTION\n\nThe gas compression system is an important component of off-\nshore oil and gas production plants. It is responsible for increasing\nthe pressure of the gas coming from the separator, supplying a cer-\ntain gas flow rate at specific pressure, humidity, and temperature,\naccording to the desired operating point and the specifications of\nthe subsequent systems. The compressed gas can then be exported,\nused for gas-lift, used to generate electrical energy, or return to the\nreservoir in injection wells.\n\nThe compression system has to process the gas flow rate de-\nlivered by the separator. Stopping a compressor may cause this gas\nto accumulate and the pressure on the separator to rise above safety\nlimits. In that case the uncompressed gas has to be flared, which is\nan operation subject to environmental regulation. In critical situa-\ntions oil wells may have to be closed until the compression system\nstarts to work again.\n\nOil and gas production facilities are equipped with centrifugal\ncompressors, which have limited operational ranges. A good review\nof centrifugal compressor applications as well as ways to enhance\nthe capability of the compressor can be found in [3].\n\nOne of the main causes of compressor shutdown is the occur-\nrence of a phenomena called surge [4],[5]. Surge is an unstable op-\neration condition of a compressor. It is characterized by alternation\nof flow directions inside the compressor with oscillations in the gas\npressures and flow-rates. Surge usually occurs when the inlet gas\nflow rate is below specified limits and the pressure ratio is too high\n[3],[4]. The surge region is one of the operation limitations of cen-\ntrifugal compressors. Another operation limitation is the stonewall\nregion, which is characterized by high flow-rates with gas veloci-\nties around the sound speed. Operation in the stonewall region is\nnormally avoided because of mechanical wear on the compressor.\nBesides, the compressor manufacturer may recommend maximum\nand minimum rotation speeds of the shaft.\n\nGiven these operation limits the gas flow rate through the\ncompressor can be changed in two ways: the surplus gas can be\nflared to decrease the gas flow rate or the compressed gas can be\nrecycled back the compressor suction to increase the gas flow rate\nthrough the compressor. The gas flaring is handled by the flare valve\nthat opens when the pressure is too high. The recirculation of the\ncompressed gas is handled by the antisurge regulatory control sys-\ntem. It is designed to manipulate the recycle valves in order to keep\nthe compressor operating in a safe region. But changes in the gas\n\n27\n\n\n\n28 Chapter 1. Introduction\n\nmolecular weight with abrupt variations in the gas flow-rate, for ex-\nample, may cause the regulatory control system to fail and the com-\npressor to go into surge, causing the system to stop. It is known that\nplant shut-down due to failure in the compression system caused by\nsurge is a recurrent problem.\n\nUsually the solution to the surge problem is to avoid its occur-\nrence [4]. In [6] it is stated that active surge control solutions have\nbeen proposed but they are not yet available for industrial applica-\ntions.\n\nTo understand and prevent this phenomena several models\nhave been proposed in the literature. The phenomenological mod-\neling of centrifugal compressors was first presented in 1976 by Gre-\nitzer in [7]. He introduces a single stage centrifugal compressor de-\nscribed by a set of differential and algebraic equations. In [8], [2],\n[5], and [9], Greitzer model is presented with modifications.\n\nAnother alternative to deal with surge and improve the com-\npression system\u2019s performance is to use advanced controlled tech-\nniques. Model Predictive Control (MPC) is an advanced control\nstrategy successfully applied in the industry [10] which deals easily\nwith constraints, multiple variables, and delays. MPC predicts the\nsystem\u2019s output through an explicit model of the system and calcu-\nlates the control actions through the minimization of an objective\nfunction, considering the constraints of the system.\n\nControl applications for centrifugal compressors are normally\ndesigned to deal with the fast dynamics of the machine. For ad-\nvanced control systems based in MPC controllers, this imposes a\nconstrain in the computational time, since the MPC would have to\nperform its calculations at a high sampling rate. MPC controllers\nhave been applied to control centrifugal compressors at high sam-\npling rate in [11], [12]. In [5] a MPC controller is designed to con-\ntrol the pressure and avoid to the surge. The minimization of the\nrecycled gas is taken into account and the MPC is proposed as a re-\nplacement for the PID controllers of the regulatory control system.\n\nEven though the MPC is considered to be able to replace mul-\ntiple control loops with good results [13], in the compression sys-\ntem studied in this dissertation it is not possible to replace the regu-\nlatory system, given that the regulatory control loops are embedded\nin the compression system. For that, the proposed MPC has to work\nas a layer above the low level PID controllers.\n\nThe tunning of large scale MPC is a difficult problem and its\nsolution relies on the knowledge of the processes and, oftentimes, in\nseveral try and error attempts. To overcome such problems, several\n\n\n\n1.1. Objectives and contributions 29\n\nworks proposed techniques to procedurally obtain the weights for\nthe objective function [14, 15]\n\nIn this work, the satisficing approach presented in [16] was\nchosen. In this technique the weights are calculated on-line accord-\ning to the operation point of the system, depending on which ob-\njective is further away from its goal. Considering the amount of\nvariables and objectives, there are several possible combinations of\nweights that will determine the performance of the controlled sys-\ntem.\n\n1.1 OBJECTIVES AND CONTRIBUTIONS\n\nThe objective of this dissertation is to present the application\nof an MPC controller designed to improve the compression system\u2019s\nperformance, avoiding shut-down due to surge, and improving en-\nergy consumption. The centrifugal compression system of a particu-\nlar off-shore oil and gas production platform is studied in this work.\nThe MPC is implemented as a higher control level that runs at a low\nsampling rate (with sampling time equal to 5 seconds), above the\nPID regulatory control system. Even though the system can reach\nthe surge point in less than 1 second, the MPC can still help the\noverall system\u2019s performance by anticipating actions to avoid surge\nand improving energetic efficiency.\n\nThe main contribution of this study is the modeling of a com-\nplete compression system, composed by two parallel 3-stage com-\npression trains. The phenomenological model includes not only the\ntypical modeling of a compression stage, but also the regulatory PID\ncontrollers, heat exchangers, vessels, the recycle lines and valves,\nand the exportation line.\n\nAnother contribution is the inclusion of the surge indexes as\ncontrolled variables so that they can be used for prediction and are\naffected by the manipulated variables. The index is easy to compute\nand takes into account the gas flow rate though the compressor\nand the minimum gas flow rate to avoid surge, calculated at every\niteration based on the system\u2019s state.\n\nFinally, a strategy to tune the controller is also proposed. The\nsatisficing tuning technique is able to dynamically change the con-\ntrol tuning to prioritize the variables that are closer to violate their\noperation limits.\n\n\n\n30 Chapter 1. Introduction\n\n1.2 ORGANIZATION OF THE DISSERTATION\n\nThis dissertation is organized as follows: chapter 2 reviews\nthe theory of Model Predictive Control (MPC), with emphasis in the\nrecursive Dynamic Matrix Control (DMC), and presents a tuning\ntechnique implemented to improve the controller\u2019s performance.\n\nChapter 3 has a description of the compressor model and a\ndiscussion of the possible controlled and manipulated variables.\n\nChapter 4 details the implementation of the different solu-\ntions and the results. Finally, chapter 5 gives the conclusions.\n\n\n\n2 MODEL PREDICTIVE CONTROL\n\nThis chapter presents an overview on MPC with its main con-\ncepts, with emphasis in the design of the DMC algorithm and the\nsatisficing tuning technique, since they are used in this work.\n\nModel predictive control is one of the most successful ad-\nvanced control techniques applied in industry [10]. This success is\ndue to the fact that MPC strategies can be applied to Single Input\nSingle Output (SISO) and Multiple Inputs Multiple Outputs (MIMO)\nsystems, with or without delay and constraints on outputs and con-\ntrol actions.\n\nMPC is not limited to an unique control strategy. This name\nis used to designate a large group of control algorithms that:\n\n\\bullet use an explicit model of the process to predict the system\u2019s\nbehavior in a finite moving time horizon;\n\n\\bullet calculate a sequence of future control actions through the min-\nimization of an objective function.\n\nThe differences between the existent MPC algorithms rely on\nthe different types of prediction and disturbance models, objective\nfunctions, and on the procedure to deal with the constraints and to\nobtain the control law.\n\nAlthough there are several different MPC algorithms, they all\nhave these three common elements:\n\n\\bullet prediction model including a prediction error treatment method\nused to predict the systems behavior through a certain time\nperiod;\n\n\\bullet objective function, which contains the control objective, for\nexample tracking a reference or minimizing energy consump-\ntion;\n\n\\bullet a procedure to obtain the control law, which minimizes the\nobjective function.\n\nThe following section explains these elements in further de-\ntails.\n\n31\n\n\n\n32 Chapter 2. Model Predictive Control\n\n2.1 MPC ELEMENTS\n\n2.1.1 Prediction model\n\nThe prediction model is in general given by a set of equations\nthat models the input to output relation of the controlled system,\nbut it could also be a fuzzy model or any other representation of\nthe relation between the inputs, disturbances and outputs. The pre-\ndiction model is an important element of the MPC strategy. As a\ngeneral rule, the performance of MPC algorithms is connected to\nhow well their underlying models can predict the plant input-output\ndynamics, therefore a good effort is put into defining prediction\nmodels that reflect reality as good as possible. The prediction error\ntreatment method is different in every MPC algorithm.\n\nThe prediction model is composed by: the process model and\nthe disturbances model. The predicted outputs of the system are\nthen a combination of the outputs of the process model and the\noutputs of the disturbance model.\n\n2.1.1.1 Process model\n\nThe process model defines the relation between the inputs\nand the outputs of the system. The model can be linear or nonlinear.\nThe most common linear models are:\n\n\\bullet impulse response;\n\n\\bullet step response;\n\n\\bullet transfer function;\n\n\\bullet state space.\n\n2.1.1.2 Disturbance model\n\nThe model for the disturbances is as important as the pro-\ncess model. The representation most widely used to describe deter-\nministic and stochastic disturbances is known as Auto-Regressive\nIntegrated Moving Average. This method models the differences be-\ntween the model output and the process output as:\n\n\\eta (t) =\nC(z - 1)e(t)\n\nD(z - 1)\n\n\n\n2.1. MPC elements 33\n\nwhere the polynomial D(z - 1) includes an integrator \\Delta = 1  - z - 1,\ne(t) is a white noise with average zero. The parameters of the poly-\nnomials C e D are used to describe the stochastic characteristics\nof \\eta and the use of the integrator in D is very important in order\nto take into account step disturbances, which are very common in\npractice. This model can represent random changes, steady state\noff-sets, etc. This is the model used in GPC, EPSAC, EHAC, and in\nother controllers with a few modifications.\n\nA particular case of disturbance model is the one used in the\nDMC algorithm, where the predicted disturbance \\^\\eta is considered\nconstant and equal to the measured disturbance \\eta , so \\^\\eta (t + k | t) =\n\\eta (t) for all k > 0, and e(t) = y(t)  - \\^y(t) is the error between the\nprocess output y(t) and the model output \\^y(t). The computation of\n\\^y(t) is presented in section 2.2.\n\nOther representations of these models and the analysis of\nthe effects the disturbance model has on the control system can\nbe found in [17, 18].\n\n2.1.1.3 Free and forced response\n\nMPC with linear models consider the systems response to be a\ncombination of two parts: the free response and the forced response.\nThe idea is to consider the control sequence u(t) as a superposition\nof two sequences:\n\nu(t) = uf(t) + uc(t)\n\nin which uf(t) corresponds to the past input values, that are kept\nconstant in the future, that means:\n\nuf(t  - j) = u(t  - j) for j = 1, 2, . . .\nuf(t + j) = u(t  - 1) for j = 0, 1, 2, . . .\n\nand uc(t) corresponds to the future input values so they are equal\nto zero in the past and equal to the future control actions in the\nfuture:\n\nuc(t  - j) = 0 for j = 1, 2, . . .\nuc(t + j) = u(t + j)  - u(t  - 1) for j = 0, 1, 2, . . .\n\nThe free response yf(t) is the output prediction when the in-\nput is equal to uf(t). The forced response yc(t) corresponds to the\n\n\n\n34 Chapter 2. Model Predictive Control\n\npredictions when the input is equal to uc(t). If a disturbance model\nis available, the free response may include the outputs of that model\nas well, so the predictions are as close to reality as possible.\n\n2.1.2 Objective function\n\nThe objective function is chosen according to the control\u2019s\npurpose. In most cases the goal is to minimize the error between the\npredicted outputs \\^y and their references yr penalizing the control\nincrements \\Delta u. For a Single Input Single Output case, this results\nin the equation:\n\nJ =\n\nN2\\sum \nj=N1\n\n\\delta (j)[\\^y(t+j | t) - yr(t+j)]2+\nNu\\sum \nj=1\n\n\\lambda (j)[\\Delta u(t+j - 1)]2 (2.1)\n\nwhere:\n\n\\bullet N1 and N2 - minimum and maximum prediction horizon. They\ndefine the time window where it is desired that the output y\nfollows the reference yr. For example, the selection of a large\nN1 implies that the mistakes on the first N1 - 1 instants are not\nimportant and the obtained closed-loop response will tend to\nbe smooth. In the case of systems with a delay d, the prediction\nhorizon should start after d, so N1 > d, since there will be no\nresponse from the system to input u(t) until the instant t = d.\n\n\\bullet Nu - control horizon. It defines the time window where it is\nimportant to limit the control action. Thus, the number of\ndecision variables of the minimization problem is defined by\nNu. Note that a bigger Nu implies in a more complex prob-\nlem, on the other hand better responses can be obtained be-\ncause of the bigger number of degrees of freedom. Usually,\nthe control horizon is smaller than the prediction horizon,\nNu &lt;N, where N = N2  - N1. Practical experiments show\nthat Nu = N/5 gives good results.\n\n\\bullet \\delta (j) and \\lambda (j) - weights for error and control action. They\nare fundamental in the MPC formulation because they define\nwhich variables are more important in the cost function. These\nweighting sequences are often chosen constant or exponential\nover the horizon. For example, a function of the type \\delta (j) =\n\\alpha N2 - j could be used so that the error penalization varies through\nthe horizon.\n\n\n\n2.1. MPC elements 35\n\nUsing the idea of forced and free responses to describe the\npredictions of the process output in the cost function, the predic-\ntion errors can be written as functions of the future control actions.\nTherefore, the future control movements can be computed minimiz-\ning J, as they are the only unknown variables of J.\n\n2.1.2.1 Constraints\n\nIn practice, all processes are subject to constraints in both\ninput and output variables. Examples of these constraints are the\nmaximum and minimum limits of the actuators (e.g. valves), the\nmaximum speed variation of a drive (e.g. servo drives) or the limits\nthat can be achieved by the outputs of a system due to safety issues.\nIn addition, there are economic objectives for the system operation\nthat generally lead the controller to choose operating points at the\nlimits. Thus, if the control actions are properly calculated for the\nsystem to work very close to the economic optimum point, the qual-\nity and cost of the production process are optimized [19]. For these\nreasons, it is important to consider the problem\u2019s constraints in the\ncalculation of the control increments. The constraints are included\nto the optimization problem as a set of equations of type:\n\numin \\leq u(t) \\leq umax \\forall t (2.2a)\n\\Delta umin \\leq u(t)  - u(t  - 1) \\leq \\Delta umax \\forall t (2.2b)\nymin \\leq y(t) \\leq ymax \\forall t (2.2c)\n\nThe MPC control action can be obtained at each sampling\ntime solving a static optimization problem defined by:\n\n\\mathrm{m}\\mathrm{i}\\mathrm{n}\n\\Delta \\bfu \n\nJ (2.3a)\n\nsubject to A\\Delta \\bfu &lt;b (2.3b)\n\nwhere J is the objective function and A and b define the constraints\n2.2.\n\nFor unconstrained problems, the solution that minimizes J\ncan be obtained analytically, but for constrained problems it can\nnot. In this case, solving J requires a much larger computational\neffort than in the unconstrained case. If J is a quadratic function\nand the constraints are linear, the constrained optimization problem\ndefined in 2.3 can be solved by any standard/off-the-shelf quadratic\nprogramming solver. Despite the complexity of the calculation, the\n\n\n\n36 Chapter 2. Model Predictive Control\n\nMPC\u2019s ability to take restrictions into consideration is one of the\nreasons for its success in industrial applications.\n\nIn practice, there are several points to be carefully considered\nin the solution of a constrained MPC. The formulation of the prob-\nlem should correctly define the constraints, and manage them when\nnecessary. This management allows the correct operation of the op-\ntimization algorithm, releasing or smoothing the constraints, when\npossible. Also, from the point of view of the implementation of the\noptimization algorithm, is important to improve the efficiency and\nthe minimization of computation times [20].\n\n2.1.3 Control law\n\nIn every MPC algorithm the goal is to calculate u(t + k | t),\nwith k = 0, 1, . . . , Nu. For this it is necessary to:\n\n\\bullet calculate the predictions \\^y(t + k | t) as a function of the future\ncontrol increments;\n\n\\bullet replace the predictions in the objective function J;\n\n\\bullet calculate the control increments \\Delta \\bfu that minimize J, consid-\nering the restrictions.\n\nWith these steps the future control increments in the control\nhorizon are calculated. However, only the first increment is applied\nto the system.\n\n2.1.4 Reference tracking and band control\n\nOne of the MPC\u2019s advantages is the possibility of using future\nreferences, when these values are available, to calculate the con-\ntrol signal. This allows the system to reach faster the desired new\nvalue. The values of yr(t + k) used in the objective function are not\nnecessarily the actual system\u2019s reference. In practical applications,\nstrategies to soften the reference changes are typically used. These\nstrategies are similar to filters used in classical control structures\nwith two degrees of freedom:\n\nyr(t) = r(t) (2.4)\nyr(t + k) = \\alpha yr(t + k  - 1) + (1  - \\alpha )r(t + k)\n\nwhere \\alpha is a parameter between 0 and 1 and k = 1, . . . , N. Equation\n2.4 represents a first order low pass filter that can be adjusted to\n\n\n\n2.2. Dynamic Matrix Controller (DMC) 37\n\nsmooth r more or less depending on the \\alpha value. These filters are\ncommonly used in several MPC controllers, such as GPC and DMC.\n\nSometimes there is no reference yr(t) to track, but a range\nin which the controller has to keep the controlled variable y. The\nband is defined by a lower limit ymin and an upper limit ymax. To\nimplement this band control, yr(t) is a decision variable of the op-\ntimization problem created to minimize the objective function J. If\nymin \\leq y(t) \\leq ymax then the solution is yr(t) = y(t), but if ymax \\leq y\nthen yr(t) = ymax and if if y \\leq ymin then yr(t) = ymin.\n\n2.2 DYNAMIC MATRIX CONTROLLER (DMC)\n\nThe DMC is a well known MPC strategy, largely applied in\nrefineries and chemical plants. A detailed description of the DMC\ncan be found in the book of Camacho and Bordons [19], chapter 3.\nThis section has a description of the modified DMC algorithm used\nin this work and proposed in [21].\n\nDMC is a MPC strategy that can be applied for open-loop\nstable plants (and can be generalized for processes with integrator\nmodes, but this case will not be considered here). The step response\nof the system is used to obtain the predictions:\n\n\\^y(t + k| t) =\n\\infty \\sum \ni=1\n\ngi\\Delta u(t + k  - i) + \\eta (t + k| t) (2.5)\n\nwhere \\eta (t + k| t) is the prediction error in time t + k. This error is\nconsidered constant through the horizon. So \\eta (t + k| t) = \\eta (t| t) =\ny(t) - yo(t| t), where yo is the prediction without corrections. Replac-\ning the prediction error and rearranging equation 2.5 results in:\n\n\\^y(t + k| t) =\nk\\sum \n\ni=1\n\ngi\\Delta u(t + k  - i) +\n\\infty \\sum \ni=1\n\ngk+i\\Delta u(t  - i) + y(t) (2.6)\n\n - \n\\infty \\sum \ni=1\n\ngi\\Delta u(t  - i)\n\n\\^y(t + k| t) =\nk\\sum \n\ni=1\n\ngi\\Delta u(t + k  - i) (2.7)\n\n+\n\\infty \\sum \ni=1\n\n(gk+i  - gi)\\Delta u(t  - i) + y(t)\n\n\n\n38 Chapter 2. Model Predictive Control\n\nThe infinite summation can be replaced by a M-terms sum-\nmation because gk+i  - gi \\sim = 0, \\forall i > M, as the process is stable and\nthe step response coefficients tends to a constant value. Now the\nprediction equation is:\n\n\\^y(t + k| t) =\n\\sum k\n\ni=1 gi\\Delta u(t + k  - i) + (2.8)\\sum M\ni=1(gk+i  - gi)\\Delta u(t  - i) + y(t)\n\nConsider a prediction horizon N and a control horizon Nu,\nthe predictions can be written in matrix form:\n\n\\^y = G u + I\\Delta u(t  - 1) + 1Ny(t) (2.9)\n\nwhere \\bfone N is a N \\times 1 vector of ones,\n\n\\bfI \\Delta \\bfu (t  - 1) =\n\n\\left[ \n   \n\n(g2  - g1) (g3  - g2) . . . (gM+1  - gM)\n(g3  - g1) (g4  - g2) . . . (gM+2  - gM)\n\n...\n... \\cdot \\cdot \\cdot \n\n...\n(gN+1  - g1) (gN+2  - g2) . . . (gN+M  - gM)\n\n\\right] \n   \n\n\\times \n\n\\left[ \n   \n\n\\Delta u(t  - 1)\n\\Delta u(t  - 2)\n\n...\n\\Delta u(t  - M)\n\n\\right] \n   ,\n\n\\bfG \\bfu =\n\n\\left[ \n   \n\ng1 0 . . . 0\ng2 g1 . . . 0\n...\n\n... \\cdot \\cdot \\cdot \n...\n\ngN gN - 1 . . . gN - Nu\n\n\\right] \n   \n\\left[ \n   \n\n\\Delta u(t)\n\\Delta u(t + 1)\n\n...\n\\Delta u(t + Nu  - 1)\n\n\\right] \n   ,\n\nand \\^\\bfy = [\\^y(t + 1| t), . . . , \\^y(t + N| t)]T . Note that in the computation\nof G and I, gi = gM if i > M.\n\nEquation (2.9) can be rewritten as:\n\n\\^\\bfy = \\bfG \\bfu + \\bff \\bfr (2.10)\n\nwhere \\bff \\bfr = \\bfI \\Delta \\bfu (t  - 1) + \\bfone Ny(t) is the system\u2019s free response as it\nonly depends on the past values of the control action and process\noutput.\n\n\n\n2.2. Dynamic Matrix Controller (DMC) 39\n\nFrom this equation, if the initial conditions are null then the\nfree response is equal to zero. If an unit step is applied in u,\n\n\\Delta u(t) = 1, \\Delta u(t + 1) = 0, \\cdot \\cdot \\cdot , \\Delta u(t + Nu  - 1) = 0\n\nthe output [\\^y(t + 1), \\^y(t + 2), \\cdot \\cdot \\cdot , \\^y(t + N)]T is equal do the first\ncolumn of the matrix G. So, the first column of G can be obtained\ntrough the systems step response.\n\nNote that matrix G has dimension N \\times Nu and vector \\bfu di-\nmension is Nu \\times 1, although only \\Delta u(t) should be computed and\nused as the rest of the future control actions are discarded.\n\nAs shown in [19] and [22], the free response can be obtained\nrecursively. The prediction for the instant t+k can be obtained with\nthe available information in t and t  - 1 given by:\n\nyo(t + k| t) =\n\\infty \\sum \n\ni=k+1\n\ngi\\Delta u(t + k  - i)\n\nyo(t + k| t  - 1) =\n\\infty \\sum \n\ni=k+2\n\ngi\\Delta u(t + k  - i)\n\nThe difference between them is only the control action \\Delta \\bfu (t - \n1), which was not know at t - 1. Hence, by subtracting one equation\nfrom the other:\n\nyo(t + k| t)  - yo(t + k| t  - 1) = gk+1\\Delta u(t  - 1)\n\n+\n\n\\infty \\sum \ni=k+2\n\ngi\\Delta u(t + k  - i) (2.11)\n\n - \n\\infty \\sum \n\ni=k+2\n\ngi\\Delta u(t + k  - i)\n\nyo(t + k| t) = gk+1\\Delta u(t  - 1) + yo(t + k| t  - 1)\n\nTherefore, at every iteration, before the DMC algorithm calcu-\nlates the control increments, the prediction has to be updated with\nthe latest known control action \\Delta u(t  - 1):\n\nyo = yo +\n\n\\left[ \n   \n\ng1\ng2\n...\n\ngM\n\n\\right] \n   \\Delta u(t  - 1)\n\n\n\n40 Chapter 2. Model Predictive Control\n\nyo is the vector with the prediction without considering the mea-\nsured disturbances or corrections. Afterwards yo is shifted in time\nto become a prediction from t+1 to t+M, whereas formerly it was\na prediction from t to t+M  - 1. When the first element of the vector\nis discarded a new element has to be added at the end of the vector\nto keep yo with size M \\times 1. Considering that the process is stable:\n\nyo(t + M  - 1| t) =\n\\infty \\sum \n\ni=M\n\ngi\\Delta u(t + M  - 1  - i)\n\nyo(t + M| t) =\n\\infty \\sum \n\ni=M+1\n\ngi\\Delta u(t + M  - i)\n\n=\n\\infty \\sum \n\ni=M\n\ngi+1\\Delta u(t + M  - 1  - i)\n\nyo(t + M| t)  - yo(t + M  - 1| t) =\n\\infty \\sum \n\ni=M\n\n(gi+1  - gi)\\Delta u(t + M  - 1  - i)\n\nSince gi+1  - gi \\sim = 0, \\forall i > M, we have yo(t + M| t) \\sim = yo(t +\nM  - 1| t). So the shifted prediction yo becomes:\n\nyo =\n\n\\left[ \n     \n\nyo(t + 1| t)\nyo(t + 2| t)\n\n...\nyo(t + M  - 1| t)\nyo(t + M  - 1| t)\n\n\\right] \n     \n\nThis recursive method simplifies the prediction calculations\navoiding the need to keep track of the past values of \\Delta \\bfu . This\nmethod also facilitates the application of the prediction error treat-\nment method presented in [21], where the authors proposed a fil-\nter to compute the non measured disturbances of the system. The\nprediction correction depends on the error between the measured\noutput and the predicted one, and on the parameters of the filter:\n\nc(t) = \\beta c(t  - 1) + (1  - \\beta )(y(t)  - yo(t| t)) (2.12)\n\nwhere c(t) is the prediction correction, \\beta is the parameter of the\nfilter, y(t) is the measured output, yo(t| t) is the predicted output\nwithout correction.\n\n\n\n2.3. MPC Tuning with Satisficing Technique 41\n\nMeasured disturbances can also be included in the predic-\ntions if there is a model for the disturbance. Considering measured\ndisturbances and prediction corrections, the free response becomes:\n\nfr = fr +\n\n\\left[ \n   \n\ng1\ng2\n...\n\ngM\n\n\\right] \n   \\Delta u(t  - 1) +\n\n\\left[ \n   \n\nh1\nh2\n...\n\nhM\n\n\\right] \n   \\Delta w(t  - 1) + \\bfone Mc(t)\n\nwhere [h1 h2 ... hM] are the coefficients of the step response of the\ndisturbance model, \\Delta w is the disturbance variation, and where \\bfone M\nis a M \\times 1 vector of ones.\n\n2.3 MPC TUNING WITH SATISFICING TECHNIQUE\n\nThe function shown by equation 2.1 is a typical objective func-\ntion used in SISO MPC algorithms and it has multiple objectives: the\nreference tracking \\delta (j)[\\^y(t+j | t) - yr(t+j)]2 and the control actions\npenalization \\lambda (j)[\\Delta u(t + j  - 1)]2. The weights for each objective \\lambda \nand \\delta are usually determined by the control designer. These cho-\nsen values are usually fixed and determined based on the designer\u2019s\nknowledge about the process.\n\nThe satisficing MPC (SMPC) presented in [16] uses the sat-\nisficing theory to calculate the appropriate weights of the objective\nfunction for the current system\u2019s state.\n\nThe SMPC algorithm is a distributed MPC designed to attend\nthe objectives and constraints of different local controllers. The solu-\ntion to this distributed problem is the analytic center of the region\nthat satisfies all the local controllers. This point is also the solu-\ntion of the centralized problem with the equivalent weights in the\nobjective function. In the SMPC the weights change according to\nthe operation point, seeking a satisfactory tuning. The weights are\ncalculated dynamically to give priority to the less satisfied local ob-\njectives. The satisfactory system\u2019s performance is obtained through\nthe maximum value that an objective can add to the total objective\nfunction. So if an objective is close to its maximum value, the weight\nassociate to it will be increased forcing the controller to give priority\nto this local objective. Satisficing tuning can be applied to any type\nof MPC controller that uses weights in the objective function.\n\nThe tuning procedure is explained below. Each objective has\na satisficing factor called Fsat that is calculated based on the largest\n\n\n\n42 Chapter 2. Model Predictive Control\n\ncontribution expected for the objective. For the reference tracking\nobjective, for example, it is calculated as:\n\nFsat =\n\nN2\\sum \nj=N1\n\n[e\\ast ref(t + j | t)]\n2 (2.13)\n\nwhere e\\ast ref is the largest expected error between the reference and\nthe predicted output [\\^y(t + j | t)  - yr(t + j)], and N1 and N2 define\nthe prediction horizon N.\n\nFor the control actions penalization Fsat can be calculated as:\n\nFsat =\n\nNu\\sum \nj=1\n\n[\\Delta u\\ast (t + j  - 1)]2 (2.14)\n\nwhere \\Delta u\\ast is the largest expected control increment and Nu is the\ncontrol horizon . The maximum contribution expected or tolerated\nfor each objective is chosen by the control designer.\n\nThe main difference between the manual and the satisficing\ntuning is that in the first the chosen weights are usually kept con-\nstant and in the second they change given priority to the objectives\nthat are closest to their limit Fsat.\n\nThe weight \\lambda to be attributed to a term of the cost function\nat a given time instant is then calculated by:\n\n\\lambda =\n1\n\nFsat  - \\=F\n(2.15)\n\nwhere F is the value of the objective at iteration k. The value of F\ncan be calculated by equations 2.13 and 2.14 but instead of using\nthe largest expected control action and reference error, the actual\nvalues of \\Delta u and eref should be used. The weight is calculated\nthrough this procedure at every iteration.\n\nWhen F approaches its satisficing factor (F \\rightarrow Fsat), \\lambda in-\ncreases indefinitely (\\lambda \\rightarrow \\infty ). If F surpass Fsat, according to 2.15\n\\lambda &lt;0 which has no practical meaning. Thus, to avoid such prob-\nlems, these critical conditions are tested before the weights are cal-\nculated. If one of these conditions is true, then the weight calculated\non the previous iteration (k  - 1) is used, meaning that \\lambda k = \\lambda k - 1.\n\nIt is important to highlight that the maximum values used\nto calculate Fsat are not boundaries. These are desired values, not\noperational constraints.\n\n\n\n2.4. Final comments 43\n\n2.4 FINAL COMMENTS\n\nThis chapter presented an overview on MPC theory and its\nelements, highlighting the recursive DMC algorithm. These are im-\nportant concepts that were used in the MPC formulations presented\nin chapter 4. Finally, the satisficing technique to tune the MPC con-\ntroller was presented. This satisficing theory will be used in the pro-\nposed DMC of this dissertation, allowing the simplification of the\ntuning procedure. The next chapter presents the modeling of the\ncompression system studied in this dissertation.\n\n\n\n\n\n3 COMPRESSION SYSTEM\n\nThis chapter presents an overview of centrifugal compressors\nand its applications in off-shore oil and gas facilities. It also has a\ndetailed description of the mathematical model used in the design\nof the MPC\u2019s prediction model and in the system simulations.\n\nIn production plants, compressors are the subsystems respon-\nsible for giving energy to the gas to increase its pressure, suppling a\ncertain gas flow rate at a specific pressure according to the desired\noperating point and the specifications of the subsequent subsystem.\nFigure 3.1 was adapted from [1] and presents an offshore produc-\ntion platform with its main subsystems. The multiphase flow ema-\nnating from the wells is separated in three phases when it reaches\nthe separator. The gas phase is directed to the compression system\nwhere its humidity, temperature, and pressure are changed to meet\nthe operation requirements. The compressed gas can then be ex-\nported, used for gas-lift, used to generate energy, or return to the\nreservoir in injection wells.\n\nManifold 1\n\nManifold 2 Liquids\nOutput\n\nSeparator 1\n\nSeparator 2\n\nWell 1\n\nLift-gas injection\n\nInjection\n\nF\nla\n\nre\n\nExportation\n\nCompressor 1\n\nGas-\n\nLift \n\nF\nla\n\nre\n\nCompressor 2\n\nGas\n\nOutputPipeline &amp; \n\nRiser 1\n\nPipeline &amp; \n\nRiser 2\n\nWell 4\n\nGas\n\nOutput\n\nLiquids\n\nOutput\n\nFigure 3.1: Production platform, adapted from [1]\n\nThe compression system has to process the gas flow rate de-\nlivered by the separator and if the compressor fails this gas accumu-\nlates causing the separator\u2019s pressure to rise. To prevent this pres-\nsure from exceeding safety limits, part of the uncompressed gas has\nto be flared. Another undesired situation is an inlet gas flow rate\n\n45\n\n\n\n46 Chapter 3. Compression System\n\nbelow specified limits, which can take the compressor to an unsta-\nble region of operation. In this case, there can be a reverse gas flow\ninside the compressor that causes oscillations in the pressure and\nflow of the gas. This phenomenon is known as compressor surge\n[3][4].\n\nThe centrifugal compression system of a particular platform\nis studied in this work. A compression stage is made of two parts:\nthe impeller and the diffuser. The gas is sucked through the center\nof the impeller and pushed by the centrifugal force to the diffuser,\nwhere the kinetic energy of the accelerated gas is then converted\nto pressure. The amount of energy a gas mass unit receives from\nthe compressor is called head [3]. However not all the energy is\nused to increase the pressure. Due to friction and other irreversible\nlosses, part of the energy is lost in the form of heat. Subsection 3.3.2\npresents in more details the head calculation and its relation to the\npressure increase.\n\nFor a compressor stage, the variables and parameters that de-\nfine its performance are:\n\n\\bullet ps - suction pressure\n\n\\bullet Ts - suction temperature\n\n\\bullet pd - discharge pressure\n\n\\bullet MW - molecular weight of the gas mixture\n\n\\bullet Z - gas compressibility\n\n\\bullet k - gas specific heat ratio\n\n\\bullet \\eta p - polytropic efficiency\n\nThese variables and parameters define the gas flow rate that\nthe compressor is able to process and the amount of power required\nto achieve it. They also define the temperature of the compressed\ngas, or the discharge temperature Td. Centrifugal compressors are\ndesigned to operate within a relatively small range of pressures,\nflows and gas characteristics. There are two phenomena that limit\nthe operation of centrifugal compressors: stonewall or choke and\nsurge. These phenomena, as well as the strategies to avoid them,\nare presented in section 3.1.\n\nIn this study the compression system consists in two parallel\ncompressors with three stages each. A schematic of the system is\n\n\n\n3.1. Surge and Stonewall 47\n\npresented in figure 3.2. The two parallel compressor trains are con-\nnected to the inlet header at the entrance of the system and to an\nexportation header at the exit.\n\nThe pressures in the system are the inlet pressure pin, the out-\nlet pressure pout, the discharge pressures pdij, where ij refers to the\ncompression stage j of the compressor train i. The discharge pres-\nsure of one stage of compression is equal to the suction pressure of\nthe next stage. The pressure ratio r is the relation between the dis-\ncharge and the suction pressures of a certain stage and it represents\nhow much the gas pressure has been increased. The gas mass flow\nrate entering and exiting the process are respectively min and mout.\nThe mass flow rate through the compressor is m and mass flow rate\nthrough the recycle valve is mr.\n\nThe compression system also has PID controllers that are re-\nsponsible for stabilizing the suction pressure, the discharge pres-\nsure, and the antisurge control. This regulatory layer was also mod-\neled as part of the system so the prediction models would consider\nthe influence of the PID controllers on the system. The MPC con-\ntroller will not replace these PID controllers, but will work in a layer\nabove the regulatory system to improve the systems performance.\n\nFigure 3.2: Compression system\n\n3.1 SURGE AND STONEWALL\n\nSurge is an unstable condition for the compressor operation\nthat results in reverse gas flow rate though the compressor and fluc-\ntuations in the delivered pressure and flow rate [23, 6]. The surge\nphenomenon is associated with high pressure ratios and gas flow\nrates below the nominal flow rate of the compressor and thus con-\n\n\n\n48 Chapter 3. Compression System\n\nstitutes the lower boundary for stable flow rates. The occurrence of\nsurge can severely damage the mechanical components of the com-\npressor. It is important to determine the surge point so an antisurge\ncontroller can avoid surge by keeping the system operating in the\nstable operation region. Surge control in industrial applications still\nrelies on preventing the surge occurrence [5]. For every pressure\nratio and rotational speed there is a minimum volumetric flow rate,\ndetermined by the surge line, that guarantees the system\u2019s stable\noperation. In figure 3.3, the minimum flow is represented by point\nD. A well known antisurge control strategy is to use recycle valves\nto send part of the discharged compressed gas back to the suction\nto increase the flow through the compressor when necessary. Sec-\ntion 3.4.3 explains in further details the antisurge control system\ninstalled by the manufacturer in the compression system studied in\nthis work. The compressor manufacturer, through a series of tests,\ndetermines the operation limits of the compressor stage. The surge\nand the stonewall or choke are the two phenomena that limit the\ncompressor\u2019s operation and they are determined by the manufac-\nturer. Figure 3.3, taken from [24], illustrates the relation between\nthe volume flow rate Q and the pressure ratio r between the surge\nand stonewall limits. The compressor map for a real compressor\ndoes not define the points to the left of the surge line because the\ntests are not performed in the unstable region.\n\nThe stonewall phenomenon is associated with flow rates well\nabove the nominal flow rate and it defines the upper boundary for\nstable flows. Stonewall is characterized by the occurrence of sonic\nspeed in the compressor\u2019s impeller. It occurs when the system re-\nsistance decreases and flow increases. For a compressor of a sin-\ngle stage, the phenomenon happens when the head becomes null\n[24] and r = 1, which means the gas is flowing through the com-\npressor without being compressed. The efficiency decreases due to\nincreased energy losses in the form of heat. Some manufacturers\nlimit the compressor\u2019s operation to the choke or stonewall region,\nbut others allow their machine to operate in the choke region as\nlong as the head is not negative [3].\n\n.\n\n3.2 SURGE INDEXES\n\nThe surge indexes are variables created to measure the dis-\ntance between the current operation point and the surge line. In\n\n\n\n3.3. Modeling 49\n\nFigure 3.3: Surge and Stonewall\n\n[25] a surge indicator that is not affected by the gas molecular\nweight is proposed. But the pressure drop on the orifice plate used\nto measure the volumetric gas flow has to be known and, for that,\ncalculating this surge indicator in practice is difficult. In [13] a sim-\npler surge index is presented as a performance indicator:\n\nIS =\nQsurge\nQcp\n\n(3.1)\n\nwhere Qcp is the volumetric flow rate of gas through the stage and\nQsurge is the minimum volumetric flow that must go through that\nsame stage to avoid surge at that operating point. The desired value\nfor the index is IS &lt;1. The steps to calculate Qsurge are detailed\nin 3.3.1.\n\nThe IS values range from 0 to 1, where 1 means that the\nsystem went into surge. In this study IS is not only considered a\nperformance indicator but also tested as a controlled variable for\nthe MPC controllers discussed in chapter 4. Since the system has six\nstages, three for each compression train, the complete system has\nsix indexes of surge, which are grouped in vector IS.\n\n3.3 MODELING\n\nThe mathematical model of the compressor presented in this\nsection is based on Greitzer [7]. Greitzer model is also used in [26],\n[4], [27], [28], [29], [24], [30] e [31].\n\nThe equations that define the dynamics of a compression stage\nwere taken from [2]. The main equations are:\n\n\n\n50 Chapter 3. Compression System\n\ndp\n\ndt\n=\n\na20\nVp\n\n(m  - mt) (3.2)\n\ndm\n\ndt\n=\n\nA1\nLc\n\n(\\Psi (\\omega , m)ps  - pp) (3.3)\n\nd\\omega \n\ndt\n=\n\n1\n\nJ\n(\\tau d  - \\tau c) (3.4)\n\n\\tau c = m\\mu \\omega r\n2\n2 (3.5)\n\nwhere:\n\na0 - sonic velocity (m/s),\n\nVp - plenum volume (m3),\n\nA1 - area of the impeller (m2),\n\nLc - length of the duct (m),\n\n\\Psi (\\omega , m) - compressor characteristic curve,\n\nJ - compressor moment of inertia (kgm2),\n\n\\mu - compressor slip factor,\n\nr2 - impeller radius (m),\n\nare the parameters and constants of the model and:\n\nm - mass flow rate entering the plenum (kg/s),\n\nmt - mass flow rate through the throttle (kg/s),\n\nps - suction pressure (Pa),\n\npp - pressure in the plenum (Pa),\n\n\\tau d - driver torque (Nm),\n\n\\tau c - torque exerted by the compressor load (Nm),\n\n\\omega - compressor speed (rad/s),\n\nare the variables and states that change with time.\nFigure 3.4 represents the model for a compression stage pro-\n\nposed by Gravdahl in [2]. In this work the model of the compres-\nsion stage is slightly different, as the following simplifications were\nmade:\n\n\n\n3.3. Modeling 51\n\nFigure 3.4: Compression stage configuration proposed in [2]\n.\n\n\\bullet there is no accumulation of gas in the compressor, so in equa-\ntion 3.3 dm\n\ndt\n= 0. This means \\Psi (\\omega , m)p0 = pp. This simplifi-\n\ncation relies on the fact that the variations on m with time\ninside the compressor would be very rapid and the use of the\nalgebraic expression assumes an instantaneous change.\n\n\\bullet it is assumed that the regulatory control system is part of the\nmodel.\n\n\\bullet the compressor manufacturer data sheet is used to obtain the\nrelation between discharge and suction pressure to the suction\nvolumetric flow rate Q and compressor angular velocity \\omega , so\n\\Psi (\\omega , Q) = pp/ps.\n\n\\bullet there is no mass exchange between gas and liquid phase in the\nscrubber.\n\n\\bullet there is no energy losses in the heat exchanger. For the sake\nof control algorithms development this simplification is con-\nsidered acceptable.\n\n\\bullet there is no change in the gas compressibility with pressure. It\nis expected that Z changes would not lead to changes on the\nMPC algorithm choices.\n\nThe following subsections describe the equations used in this\nstudy. It is important to highlight that gas flow rates, pressures, tem-\nperatures, valve openings, and the rotational speeds of the two com-\npression trains are states or algebraic variables of the model and\nthey can change through time. The other elements of the model are\nconstants and parameters.\n\n\n\n52 Chapter 3. Compression System\n\n3.3.1 Compression stage\n\nIn this work, each compression stage has the main compres-\nsor line and a recycle line with an antisurge valve used to prevent\nthe occurrence of surge. In the main line there is a heat exchanger, a\ngas scrubber, and a compressor unit. The heat exchanger is respon-\nsible for keeping the gas temperature at the desired reference; the\ngas scrubber removes the gas condensate that forms because of the\nhigh pressure in the system; finally, the compressor unit is responsi-\nble for providing energy to the gas, increasing its pressure. Figure\n3.5 shows the compression stage modeled in this section.\n\nFigure 3.5: Compression stage modeled in this work\n\nEach stage can be described by the same set of differential\nequations, therefore the next subsections present the modeling of\nthe inlet header, of the outlet header, and of only one stage of com-\npression. Since the three stages of each compression train are con-\nnected in series, the discharge pressure of one stage is equal to the\nsuction pressure of the subsequent stage.\n\nThe original differential equations 3.2 to 3.5 do not include\ntemperature changes caused by the heat exchanger or the dynamics\nof the recycled gas mass flow rate. So these equations were included\nin the model. In the model proposed in this study, the gas accumu-\nlation in the plenum is not considered. Instead dp\n\ndt\nis a function of\n\nthe gas accumulation in the scrubber V (equation 3.2).\nThe compressor characteristic curve \\Psi (\\omega , m) was obtained\n\nfrom the compressor map provided by the manufacturer. The map\nshows the relation between pressure ratio pd/ps, rotational speed \\omega ,\nand gas flow rate mcp through each compression stage. Besides, the\nmap also shows the surge line, which represents the minimum flow\n\n\n\n3.3. Modeling 53\n\nrate to avoid surge, given pd/ps and \\omega . An example of compression\nmap is given in figure 3.8.\n\nAfter the modifications and the addition of the heat exchanger\nand recycle loop dynamics, the set of equations 3.2 to 3.5 was\nchanged. The new set of equations that represents a compression\nstage is:\n\ndps\ndt\n\n=\nZRTs\nMWVs\n\n(mhe  - mcp) (3.6)\n\nd\\omega \n\ndt\n=\n\n1\n\nJ\n(\\tau d  - \\tau c) (3.7)\n\n\\tau c = \\omega mcp\\mu r\n2\n2 (3.8)\n\nmhe = mr + m\ns\nin (3.9)\n\nwhere:\n\nZ - gas compressibility factor\n\nMW - gas molecular weight (kg/mol)\n\nR - gas constant (J/mol)\n\nps - suction pressure of the stage (Pa)\n\nTs - suction temperature of the stage (K)\n\nVs - volume of the scrubber (m3)\n\nmhe - gas mass flow rate through the heat exchanger (kg/s)\n\nmcp - gas mass flow rate through the compressor unit (kg/s)\n\nmr - gas mass flow rate through the recycling line (kg/s)\n\nmsin - gas mass flow rate that enters the stage (kg/s)\n\nThe discharge pressure of stage i is equal to the suction pres-\nsure of the subsequent stage i + 1, so pd,i = ps,i+1, and ps is deter-\nmined by solving the differential equation 3.6 for each stage. The\npressure ratio for each stage is ri = pd,i/ps,i. From equation 3.3,\nconsidering dm\n\ndt\n= 0, the pressure ratio is related to \\omega and mcp by:\n\n\\Psi (\\omega , mcp) =\npd\nps\n\n(3.10)\n\n\n\n54 Chapter 3. Compression System\n\nIn a compression stage, the relation between r, \\omega , and the\nvolumetric flow rate Qcp is given by the manufacture\u2019s compression\nmap and can be approximated through a polynomial:\n\nr = a + bx  - cy  - dx2 + exy + fy2 (3.11)\n\nwith:\n\nr =\npd\nps\n\ny =\n\\omega \n\n\\omega nom\n\nx =\nQcp\ny\n\nwhere \\omega nom is the compressor nominal rotational speed. Since, r\nand y are known, x is the one of the roots of 3.11. Figure 3.6 shows\nthe relation between the volumetric flow rate and the pressure ratio\nfor a few normalized rotational speeds. The surge line shown in the\nfigure is where the pressure ratio is maximum and dr/dQ = 0. The\nsurge volumetric flow Qsurge is Q at the point where dr/dQ = 0.\n\ndr\n\ndQ\n=\n\ndr\n\ndx\n\ndx\n\ndQ\n\ndr\n\ndQ\n= b\n\ndx\n\ndQ\n+ 2dx\n\ndx\n\ndQ\n+ ey\n\ndx\n\ndQ\n(3.12)\n\nReplacing x = Qsurge/y, y = \\omega /\\omega nom, and dx/dQ = 1/y in\nequation 3.12:\n\ndr\n\ndQ\n=\n\nb\n\ny\n+\n\n2d\n\ny\nx + e = 0\n\n2d\n\ny2\nQsurge =  - \n\nb\n\ny\n - e\n\nQsurge =\n - (by + ey2)\n\n2d\n\nQsurge =\n - b\\omega \n\n2d\\omega nom\n+\n\n - e\\omega 2\n\n2d\\omega 2nom\n\nTo simplify the calculations, Qsurge can be written as a func-\ntions of \\omega :\n\n\n\n3.3. Modeling 55\n\nQsurge = k1\\omega + k2\\omega \n2\n\nk1 =\n - b\n\n2d\\omega nom\n\nk2 =\n - e\n\n2d\\omega 2nom\n\nThe manufacture\u2019s compression map does not show the sys-\ntem\u2019s behavior for the region where dr/dQ &lt;0, the part of the curve\nto the left of the surge line, because this is the unstable operation\nregion and the system is not tested in these operation conditions.\nThe compressor\u2019s stable operation region is to the right of the surge\nline. So x is the root of polynomial 3.11 that is to the right of the\npoint where dr/dQ = 0.\n\nFigure 3.6: Relation between volumetric flow rate, pressure ratio,\nand normalized rotational speed\n\nThe gas volumetric flow rate Qcp through the compressor is\ncalculated from x, Qcp = xy. The gas mass flow rate through a\ncompressor stage mcp depends of the gas density \\rho :\n\nmcp = \\rho Qcp (3.13)\n\n\\rho =\nMW\n\nZRTs\nps (3.14)\n\nThe recycled gas mass flow rate is computed using the equa-\ntions for valves working with compressible fluids as recommended\n\n\n\n56 Chapter 3. Compression System\n\nby [32]:\n\nmr = NunCV Y pd\n\n\\sqrt{} \\biggl( \nMWx\n\nZRTd\n\n\\biggr) \n(3.15)\n\nCV = CVN\\Phi r (3.16)\n\nFk =\nk\n\n1.4\n(3.17)\n\nx = min\n\n\\biggl( \npd  - ps\n\npd\n, FkxT\n\n\\biggr) \n(3.18)\n\nY = 1  - \nx\n\n3FkxT\n(3.19)\n\nwhere:\n\nmr - gas mass flow rate through the recycling line (kg/s)\n\nNun - constant that converts the units\n\nCVN - flow coefficient\n\nk - heat capacity ratio\n\nThe discharge temperature of the compressed gas can be ob-\ntained as:\n\nTd = Ts\n\n\\biggl( \npd\nps\n\n\\biggr) k - 1\n\\eta pk\n\n. (3.20)\n\nwhere:\n\n\\eta p - polytropic efficiency\n\n3.3.2 Power consumption\n\nThe head H is the amount of work per mass unit that has to\nbe applied to the gas to compress it. According to [24], the energy\nbalance in the compression can be expressed as:\n\nH + dq = dh +\nc2\n\n2\n+ gdz (3.21)\n\nwhere dq is the heat exchanged inside the impeller, dh is the varia-\ntion of the gas enthalpy, c\n\n2\n\n2\nis the kinetic energy of the gas, and gdz\n\nis the gravitational energy of the gas.\n\n\n\n3.3. Modeling 57\n\nThe process is considered to be adiabatic, so there is no heat\nexchange and dq = 0. The kinetic and gravitational energies are too\nsmall and can also be disregarded. So the head can be considered\nthe energy required to change the enthalpy of the gas and it is given\nby:\n\nH = dh (3.22)\n\nThe enthalpy variation is:\n\ndh =\ndp\n\n\\rho \n(3.23)\n\nwhere p is the gas pressure and \\rho is the gas density.\nThus, the work per mass unit required to compress a gas from\n\npressure p1 to pressure p2 can be obtained by:\n\nH =\n\n\\int p2\np1\n\ndp\n\n\\rho \n(3.24)\n\nThe gas density \\rho can be expressed differently if the compres-\nsion is isentropic, isothermal, or polytropic. The isentropic compres-\nsion is adiabatic and reversible and the entropy is constant. The\nisothermal is also reversible and in this case the temperature re-\nmains constant. The polytropic compression is adiabatic but irre-\nversible and in this case the efficiency of the compression is con-\nstant.\n\nThe polytropic compression is considered more appropriate\naccording to [3]. In that case,\n\np\n\n\\rho n\n= cte (3.25)\n\n\\rho = \\rho 1\n\n\\biggl( \np\n\np1\n\n\\biggr) 1/n\n(3.26)\n\nn is the polytropic exponent. Replacing equation 3.26 in 3.24:\n\nH =\np\n1/n\n1\n\n\\rho 1\n\n\\int p2\np1\n\ndp\n\np1/n\n(3.27)\n\nAfter solving the integral in equation 3.27, the head equation\nbecomes:\n\nH =\np\n1/n\n1\n\n\\rho 1\n\n\\Biggl( \np\n\n - 1\nn\n\n+1\n\n - 1\nn\n\n+ 1\n\n\\Biggr) \\bigm| \\bigm| \\bigm| \\bigm| \\bigm| \np2\n\np=p1\n\n\n\n58 Chapter 3. Compression System\n\nwith\n\n\\rho 1 =\np1MW\n\nZ1RT1\n(3.28)\n\nwhere MW is the gas molecular weight, Z1 is the gas compressibil-\nity at point 1, and T1 is the gas temperature at point 1. Replacing\nequation 3.28 in 3.3.2 gives:\n\nH =\nZ1RT1\nMW\n\nn\n\nn  - 1\n\n\\Biggl[ \\biggl( \np2\np1\n\n\\biggr) n - 1\nn\n\n - 1\n\n\\Biggr] \n. (3.29)\n\nThe polytropic exponent n can be expressed in therms of the poly-\ntropic efficiency \\eta p and the gas specific heat ratio k:\n\nn  - 1\nn\n\n\\approx \nk  - 1\n\\eta pk\n\n(3.30)\n\nThe polytropic efficiency \\eta p is also calculated from a polyno-\nmial obtained from the compressor\u2019s manufacturers data sheet.\n\nThus, the equation for the head becomes:\n\nH =\nZ1RT1\nMW\n\n\\eta pk\n\nk  - 1\n\n\\Biggl[ \\biggl( \np2\np1\n\n\\biggr) k - 1\n\\eta pk\n\n - 1\n\n\\Biggr] \n. (3.31)\n\nThe absorbed compressor power P is given by:\n\nP =\nmcpH\n\n\\eta p\n(3.32)\n\nwhere mcp is the gas mass flow rate going through the compressor.\n\n3.3.3 Inlet header\n\nThe inlet header is represented by a compressor inlet drum\nwith volume Vin, shown in figure 3.7.\n\nThe gas phase from the separator reaches the compression\nsystem with a mass flow rate min. From the inlet header, the gas\nmass flow rate is divided between the two compression trains. Con-\nnected to this vessel is also the flare line with a flare valve. This\nvalve opens releasing gas to the flare if the pressure in the inlet\nheader pin reaches its maximum limit. The pressure pin depends on\n\n\n\n3.3. Modeling 59\n\nFigure 3.7: Inlet header\n\nthe mass balance in the vessel.\n\ndpin\ndt\n\n=\nRZTin\nMWVin\n\n(min  - min,1  - min,2  - mflare) (3.33)\n\nmin,1 = k\n1\nhe\n\n\\sqrt{} \nMW\n\nZRTin\n\n\\sqrt{} \npin(pin  - p1s) (3.34)\n\nmin,2 = k\n2\nhe\n\n\\sqrt{} \nMW\n\nZRTin\n\n\\sqrt{} \npin(pin  - p2s) (3.35)\n\nwhere:\n\npin - pressure in the inlet header\n\nVin - volume of the compressor inlet drum\n\nTin - temperature of the gas entering the compression system\n\nmin - gas mass flow rate entering the compression system\n\nmin,1 - gas mass flow rate entering the compression train 1\n\nmin,2 - gas mass flow rate entering the compression train 2\n\nmflare - gas mass flow rate in the flare line\n\nps,1 - suction pressure of stage 1 of compression train 1\n\n\n\n60 Chapter 3. Compression System\n\nps,2 - suction pressure of stage 1 of compression train 2\n\nIn equations 3.34 and 3.35, khe,1 and khe,2 are constants that\nrepresent the pressure drop in the heat exchanges 1 e 2.\n\n3.3.4 Outlet header\n\nThe dynamics of the outlet header pressure pout is obtained\nfrom the mass balance:\n\ndpout\ndt\n\n=\nZRT h\n\nMWVh\n(mout,1 + mout,2  - mexp  - mp1  - mp2) (3.36)\n\nWhere:\n\nVh - outlet header volume, it represents the total volume associated\nwith the pipes.\n\nmout,1 - gas mass flow rate from compressor train 1,\n\nmout,2 - gas mass flow rate from compressor train 2,\n\nmexp - gas mass flow rate delivered the exportation line,\n\nmp1 - gas mass flow rate delivered to process 1,\n\nmp2 - gas mass flow rate delivered to process 2.\n\nThe modeling of the pressure in the exportation line was sim-\nplified to avoid the use of partial differential equations. The pres-\nsure was modeled as a combination of pressure loss and pressure\nvariation due to the gas accumulation in the line. It is assumed that\nin the export line there is a gas flow mext which is independent.\nFurthermore it is assumed that in the steady state mdexp = mexp and\nthat this transition has a first order dynamic. The pressure pexp is\nthen written as:\n\npexp = pexp,1 + pexp,2 (3.37)\n\ndmdexp\ndt\n\n=  - \nmdexp\n\\sigma mexp\n\n+\nmexp\n\\sigma mexp\n\n(3.38)\n\np2exp = kexp,1(m\nd\nexp + mext)\n\n2 (3.39)\ndpexp,1\n\ndt\n= Kdexp\n\n\\bigl( \nmexp  - mdexp\n\n\\bigr) \n(3.40)\n\nKdexp =\nZRT h\n\nMWVlexp\n(3.41)\n\n\n\n3.4. Regulatory control 61\n\nwhere:\n\n\\sigma mexp - time constant,\n\nkexp,1 - constant that depends on the length and diameter of the ex-\nport line, the friction factor, and the average pressure through\nthe line,\n\nVlexp - volume of the exportation line.\n\n3.4 REGULATORY CONTROL\n\nThe regulatory control system is formed by PID controllers\nand it was also modeled as part of the compression system. Every\nPID has an anti-windup. The regulatory control system considered\nin the compressor modeling presented in this dissertation is com-\nposed by:\n\n1. Inlet gas pressure and load sharing control\n\n2. Outlet gas pressure and exportation flow control\n\n3. Antisurge control\n\n4. Suction temperature control\n\n3.4.1 Inlet pressure and load sharing\n\nThe compressor inlet pressure pin depends on the mass bal-\nance of the vessel Vin, shown in equation 3.33.\n\nThe manipulation of min,1 and min,2 can take pin to the de-\nsired value. The flows min,1 and min,2 depend on the rotational\nspeed of the compressor w, which depends on the power P applied\n\n\n\n62 Chapter 3. Compression System\n\nto the compressor. The control law for pin is given by:\n\nepin =  - p\nsp\nin + pin (3.42)\n\nupin,1 = Kppinepin + Kipin\n\n\\int t\n0\n\nepin(\\tau )d\\tau + ubias,1 (3.43)\n\nupin,2 = Kppinepin + Kipin\n\n\\int t\n0\n\nepin(\\tau )d\\tau + ubias,2 (3.44)\n\nubias,1 = Kpbiasedsm,1 + Kibias\n\n\\int t\n0\n\nedsm,1(\\tau )d\\tau (3.45)\n\nubias,2 = Kpbiasedsm,2 + Kibias\n\n\\int t\n0\n\nedsm,2(\\tau )d\\tau (3.46)\n\nedsm,1 = d\nmean\nsurge  - dsurge,1 (3.47)\n\nedsm,2 = d\nmean\nsurge  - dsurge,2 (3.48)\n\ndsurge,1 = Q1  - Qsurge,1 (3.49)\ndsurge,2 = Q2  - Qsurge,2 (3.50)\n\ndmeansurge =\ndsurge,1 + dsurge,2\n\n2\n(3.51)\n\nwhere:\n\nepin - error between the setpoint and pin,\n\np\nsp\nin - setpoint for pin,\n\nKppin - proportional gain of the inlet pressure controller,\n\nKipin - integral gain of the inlet pressure controller\n\nKpbias - proportional gain of the load sharing controller,\n\nKibias - integral gain of the load sharing controller\n\nQ1 and Q2 - volumetric flow rate through the first stage of com-\npressor train 1 and 2, respectively\n\nQsurge,1 and Qsurge,2 - surge volumetric flow rate for the first stage\nof compressor train 1 and 2, respectively\n\nThe terms ubias,1 and ubias,2 implement the load sharing, so\nthat both compressor trains are always at the same distance of the\nsurge point.\n\n\n\n3.4. Regulatory control 63\n\n3.4.2 Outlet header pressure\n\nThe outlet header pressure pout depends on the mass balance\nmout,1 + mout,2  - mexp  - mp1  - mp2, as shown in equation 3.36.\nThe gas flow rate directed to the exportation line mexp is regulated\nby the exportation valve opening \\phi exp. The pressure pout can be\nchanged by manipulating \\phi exp. The control law for \\phi exp is given by:\n\nepout = p\nsp\nout  - pout (3.52)\n\n\\phi exp =  - Kcexp \\ast epout  - Kiexp\n\\int t\n0\n\nepout(\\tau )d\\tau \n\nwhere:\n\nepout - error between the setpoint and pout,\n\np\nsp\nout - setpoint for pout,\n\nKpexp - proportional gain of the outlet pressure controller,\n\nKiexp - integral gain of the outlet pressure controller\n\n3.4.3 Antisurge control\n\nCompressor data sheets are usually provided by the compres-\nsor manufacturer. They contain important information on the com-\npressor\u2019s behavior and operating points. Figure 3.8 shows a typical\ncompressor map taken from a compressor\u2019s data sheet. The graph\nshows the relation between the volumetric flow rate at compressor\u2019s\nsuction and the pressure ratio for different rotational speeds. In the\nmap, the red solid line is known as the surge line. As explained\nin section 3.1, this line defines the minimum flow required to avoid\nsurge, Qsurge. Anti surge control techniques usually consider a safer\nsurge line, called control surge line or safe surge line, represented\nby the blue dashed line on the graph. Commonly, the control surge\nline is the surge line plus a slack of 5  - 10\\% of the minimum flow\nrate.\n\nIf the compressor is working at a point to the left of the safe\nsurge line then the flow rate through the compressor is below the\nminimum. Recycling part of the compressed gas can increase the\ngas flow through the compressor, preventing the system to go into\nsurge. And if the compressor is working at a point to the right of\nthe safe surge line, no action is required.\n\n\n\n64 Chapter 3. Compression System\n\nSurge line\n\nControl line\n\nFigure 3.8: Example of a compressor map\n\nSo the antisurge control of this system consists on opening a\nrecycle valve allowing part of the discharged compressed gas to go\nback to compressor suction. This will increase the compressor\u2019s gas\nflow keeping it above the minimum and avoiding surge.\n\nThe minimum flow obtained through the control surge line\nQsurge is used to define the setpoint for the PI controller Qspsurge as\nshown in equation 3.53.\n\nQspsurge = Qsurge(1 + slack) (3.53)\n\nFor each stage there is an antisurge recycling valve. The valve\nopening, \\phi r is determined by the control law in equation 3.55.\n\nes = Q\nsp\nsurge  - Q (3.54)\n\n\\Phi r = Kpres + Kir\n\n\\int t\n0\n\nes(\\tau )d\\tau (3.55)\n\nwhere:\n\nQ - flow through the compressor stage,\n\n\n\n3.4. Regulatory control 65\n\nKpr - proportional gain of the PI controller,\n\nKir - integral gain of the PI controller,\n\n3.4.4 Suction temperature control\n\nOn the suction of each compression stage there is a heat ex-\nchanger that keeps the suction temperature at a desired value. The\ngas temperature control is based on the coolant flow.\n\nFigure 3.9: Gas flows through the heat exchanger\n\nFigure 3.9 shows the important flows used in the modeling of\nthe temperature control where:\n\nmE - gas mass flow from inlet header or from the previous stage,\n\nmr - recycled gas mass flow,\n\nmhe - gas mass flow trough the heat exchanger,\n\nmc - coolant mas flow,\n\nThe amount of energy in the heat exchanger is given by Win:\n\nWin = mrcgTd + mEcgTE + \\Phi hem\nmax\nc ccTc. (3.56)\n\nwhere:\n\nTE - inlet gas temperature,\n\nTd - discharge gas temperature (same as the temperature of the\nrecycled gas),\n\nTs - suction gas temperature,\n\nTc - coolant temperature,\n\ncg - gas specific heat,\n\n\n\n66 Chapter 3. Compression System\n\ncc - coolant specific heat,\n\n\\Phi he - heat exchanger valve opening.\n\nIn steady state the coolant and the gas temperatures are con-\nsidered the same since the modeling assumes no heat losses:\n\nWout = (mhecg + \\Phi hem\nmax\nc cc)T\n\nss\ns (3.57)\n\nConsidering no energy loss, Win = Wout and\n\nT sss = (mRcgTd + mEcgTE + \\Phi hem\nmax\nc ccTC) /(mT Ccg+\\Phi hem\n\nmax\nc cC).\n\n(3.58)\nAssuming a first order dynamics, the suction temperature\u2019s\n\ndifferential equation Ts is:\n\ndTs\ndt\n\n=  - \nTs\n\\sigma T s\n\n+\nT sss\n\\sigma T s\n\n(3.59)\n\nThe heat exchanger\u2019s valve opening \\Phi he is given the control\nlaw in equation 3.61:\n\neT s = T\nsp\ns  - Ts (3.60)\n\n\\Phi he = KpT seT s + KiT s\n\n\\int t\n0\n\neT s(\\tau )d\\tau (3.61)\n\n3.5 SYSTEM SIMULATION\n\nThis section analyses the system\u2019s behavior without the MPC\nlayer. Here only the regulatory control is active. This results will be\nthe base for comparison of the proposed MPC controllers in the next\nchapters. The two compressor trains are identical so only the results\nof one the trains are shown in this section.\n\nThe compression system nonlinear model described in section\n3.3 was implemented in Matlab and the differential equations were\nsolved with ODE45. For the simulations and comparisons a simple\nscenario was chosen, where the inlet flow varies as illustrated in\nfigure 3.10. This input flow is the main disturbance applied to the\nsystem to create the scenario. The simulation starts with the flow\non its nominal value. Then the flow drops by 50\\%. This drives the\nsystem to the surge region. After the drop, the inflow rises to 115\\%\nof its nominal value, forcing the system to flare gas. The results of\nthe regulatory controlled system are shown in figures 3.11 to 3.17.\n\n\n\n3.5. System simulation 67\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n10\n\n15\n\n20\n\n25\nm\n\nin\n [\n\nkg\n/s\n\n]\n\nFigure 3.10: Inlet gas flow\n\nFigure 3.11 shows that the inlet pressure controller is able to\nkeep pin at its setpoint p\n\nsp\nin = 6.2 when min is low, but when min is\n\nhigher than the compressor\u2019s capacity, the rotational speed reaches\nits maximum limit and pin increases. When pin reaches the relief\nvalve pressure limit, the flare valve opens and allowing gas to flow\nto the flaring system, as can be seen in figure 3.12.\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n6\n\n6.5\n\n7\n\np i\nn\n [\n\nba\nr]\n\nFigure 3.11: Results of the regulatory control system - inlet header\npressure\n\nFigures 3.13 to 3.15 show the surge indexes and the antisurge\nvalves openings. As min decreases the surge indexes increase. When\n\n\n\n68 Chapter 3. Compression System\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n0\n\n0.02\n\n0.04\n\n0.06\n\n0.08\n\n0.1\n\nm\nfl\n\nar\ne \n\n[k\ng/\n\ns]\n\nFigure 3.12: Results of the regulatory control system - flared gas\n\nthey reach 0.95 the antisurge valves open to increase the gas flow\nthrough the compressor and avoid surge. But min keeps decreasing\nand, when \\phi ASV,1 is totally opened, stage 1 starts to approach the\nsurge region. Figure 3.13 shows that the antisurge valve of stage\n1 saturates. When IS1 = 1 the compressor is surging. If one stage\ngoes into surge the system shuts down even if the other stages are\nnot surging.\n\nFigure 3.16 shows the outlet header pressure pout. The regu-\nlatory control keeps it at its setpoint pspout = 176. Figure 3.17 show\nthat the consumed power decreases when min is low and increases\nalmost to its maximum when min increases.\n\n\n\n3.5. System simulation 69\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n1 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n1\n\n?\nA\n\nS\nV\n\n1\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 3.13: Results of the regulatory control system - Stage 1\n\n\n\n70 Chapter 3. Compression System\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n2 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n?\nA\n\nS\nV\n\n2\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 3.14: Results of the regulatory control system - Stage 2\n\n\n\n3.5. System simulation 71\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n0.5\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n3 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n?\nA\n\nS\nV\n\n3\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 3.15: Results of the regulatory control system - Stage 3\n\n\n\n72 Chapter 3. Compression System\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n175.8\n\n175.9\n\n176\n\n176.1\np o\n\nut\n [\n\nba\nr]\n\nFigure 3.16: Results of the regulatory control system - outlet header\npressure\n\n0 5 10 15 20 25 30 35\nTime [min]\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nN\nom\n\nal\niz\n\ned\n p\n\now\ner\n\n [\n-]\n\nFigure 3.17: Power consumption\n\nThe simulated scenario shows that for a gas inflow drop of\n50\\% this system would go into surge. A real compression system\nwould stop working if it went into surge. So, the system\u2019s behavior\nobserved when IS = 1 is not real. However, this simulation shows\nthat, for this min disturbance, the regulatory control was not able\nto avoid surge. Based on that, an advanced control algorithm could\nbe implemented to improve the compression system\u2019s performance.\n\n\n\n3.6. Control objectives 73\n\n3.6 CONTROL OBJECTIVES\n\nThe MPC designed for the compression system has these con-\ntrol objectives:\n\n\\bullet To avoid surge and system\u2019s shutdown increasing the Mean\nTime Between Failure (MTBF) of the compressor system\n\n\\bullet To minimize gas flaring\n\n\\bullet To minimize energy consumption\n\nThe setpoints for the regulatory control could be used as ma-\nnipulated variables for the MPC controller. The antisurge PID con-\ntroller allows another signal to override its output, sending a differ-\nent signal to the antisurge valve. So the antisurge valve openings\ncould also be manipulated variables.\n\nTo avoid the occurrence of surge, the surge indexes could be\nused as controlled variables. The compressors energy consumption\nE could be expressed as a component of the control objective func-\ntion J. The compressors energy consumption can be expressed as\nthe sum of the integral of the power along the prediction horizon\nfor each compressor.\n\nE =\n2\\sum \n\nj=1\n\nEj (3.62)\n\nEj =\n\n\\int to+N\nto\n\nPj(t)dt (3.63)\n\nBesides these objectives, the suction and discharge pressures\nof each stage have to be kept within their operation limits. They\ncould also be included as controlled variables or as constraints for\nthe optimization problem that calculates the control increments.\n\n3.7 LINEAR MODEL\n\nThe nonlinear model of the compression system, including\nthe regulatory control, is given by a set of algebraic and differential\nequations. The outputs y of the system are a function of the states\nx and the control signals u. This relation is represented by equation\n3.64.\n\n\n\n74 Chapter 3. Compression System\n\ny = f(x, u) (3.64)\n\nIn [33] the Practical Non Linear MPC (PNMPC) is introduced.\nIn this work the author shows that the matrix G used by the MPC\nmay be obtained from the Jacobian matrix of the system:\n\nG =\n\\biggl[ \n\\partial f\n\n\\partial u\n\n\\biggr] \n=\n\n\\left[ \n     \n\n\\partial f(t+1| t)\n\\partial u(t)\n\n0 . . . 0\n\\partial f(t+2| t)\n\n\\partial u(t)\n\\partial f(t+2| t)\n\\partial u(t+1)\n\n. . . 0\n...\n\n...\n. . .\n\n...\n\\partial f(t+N| t)\n\n\\partial u(t)\n\\partial f(t+N| t)\n\\partial u(t+1)\n\n. . .\n\\partial f(t+N| t)\n\\partial u(t+N - 1)\n\n\\right] \n     (3.65)\n\nIf the system is considered to be time-invariant, then G can\nbe approximated to:\n\nG =\n\\biggl[ \n\\partial f\n\n\\partial u\n\n\\biggr] \n=\n\n\\left[ \n     \n\n\\partial f(t+1| t)\n\\partial u(t)\n\n0 . . . 0\n\\partial f(t+2| t)\n\n\\partial u(t)\n\\partial f(t+1| t)\n\n\\partial u(t)\n. . . 0\n\n...\n...\n\n. . .\n...\n\n\\partial f(t+N| t)\n\\partial u(t)\n\n\\partial f(t+N - 1| t)\n\\partial u(t)\n\n. . .\n\\partial f(t+1| t)\n\n\\partial u(t)\n\n\\right] \n     (3.66)\n\nThus, for a linear system as well as for a linearized repre-\nsentation [34], the matrix G is equivalent to the one built in the\nDMC controller algorithm. The first column of the matrix G is the\nstep response of the system and it is also used to calculate the free\nresponse. The vector with the step response coefficients g can be\nobtained by:\n\ng =\nf(\\=x, \\=u + \\Delta u)  - f(\\=x, \\=u)\n\n\\Delta u\n(3.67)\n\nwhere (\\=x, \\=u) is the point where the function is linearized. In this\nstudy, the system was linearized off-line at an equilibrium point that\ncorresponds to the system\u2019s steady state xss and uss. So, \\=x = xss and\n\\=u = uss. The same linearized models were used through the entire\nsimulations.\n\n3.7.1 Step responses analysis\n\nInstead of the coefficients of the step responses normally used\nin linear MPC control systems, the coefficients obtained using the\n\n\n\n3.7. Linear model 75\n\nPNMPC technique were used here. For a linear system these coef-\nficients would be identical to the ones obtained with the applica-\ntion of a step [33]. However for a nonlinear system the PNMPC\ncoefficients correspond to the coefficients of the linearized system.\nFor simplicity, these coefficients will be called step responses. This\nsubsection presents the analysis of these linear models so the most\nadequate variables can be selected to be used by the MPC controller.\n\nConsidering the setpoints and manipulations that can be changed\nin the compression system regulatory system, the possible manipu-\nlated variables are:\n\n\\bullet u1 - setpoint of the inlet gas pressure (p\nsp\nin)\n\n\\bullet u2 - setpoint of the outlet gas pressure (p\nsp\nout)\n\n\\bullet u3 - opening of the antisurge valve of stage 11 (\\phi ASV,11)\n\n\\bullet u4 - opening of the antisurge valve of stage 12 (\\phi ASV,12)\n\n\\bullet u5 - opening of the antisurge valve of stage 13 (\\phi ASV,13)\n\n\\bullet u6 - opening of the antisurge valve of stage 21 (\\phi ASV,21)\n\n\\bullet u7 - opening of the antisurge valve of stage 22 (\\phi ASV,22)\n\n\\bullet u8 - opening of the antisurge valve of stage 23 (\\phi ASV,23)\n\nBased on the control objectives described in section 3.6, the\npossible controlled variables are:\n\n\\bullet y1 - discharge pressure of stage 11 (pd11)\n\n\\bullet y2 - discharge pressure of stage 12 (pd12)\n\n\\bullet y3 - discharge pressure of stage 21 (pd21)\n\n\\bullet y4 - discharge pressure of stage 22 (pd22)\n\n\\bullet y5 - surge index of stage 11 (IS11)\n\n\\bullet y6 - surge index of stage 12 (IS12)\n\n\\bullet y7 - surge index of stage 13 (IS13)\n\n\\bullet y8 - surge index of stage 21 (IS21)\n\n\\bullet y9 - surge index of stage 22 (IS22)\n\n\n\n76 Chapter 3. Compression System\n\n\\bullet y10 - surge index of stage 23 (IS23)\n\n\\bullet y11 - consumed power (P)\n\nThe step responses coefficients were normalized by:\n\nsrnormnm = srnm\nrangemu\nynnom\n\n\\times 100\\% (3.68)\n\nwhere srnm is the vector with the step response coefficients between\nthe controlled variable n and the manipulated variable m, rangemu\nis the range of the manipulated variable m, and ynnom is the nominal\nvalue of the controlled variable n. Thus, srnormnm shows the percent-\nage variation of n in relation to its nominal value, for a variation in\nm.\n\nFigures 3.18 to 3.21 show the step responses between the pos-\nsible manipulated variables u and the possible controlled variables\ny. The coefficients of the step responses were normalized by equa-\ntion 3.68. The inter stage discharge pressures pd (y1 to y4), shown\nin figure 3.18, are highly sensitive to changes in u1 and u2. But y1\nand y3 are linearly dependent of y2 and y4 respectively. Besides,\nif u1 and u2 are kept within their limits, y1 to y4 also stay within\ntheir limits. So instead of using them as controlled variables, their\nlower and upper limits were included in the problem\u2019s constraints\nto be safe. The indexes of surge IS (y5 to y10), shown in figures\n3.19 and 3.20, are highly influenced by changes in the antisurge\nvalve openings (u3 to u8). The consumed power P (y11), shown in\nfigure 3.21, is influenced by all the manipulated variables. The gain\nbetween u1 and P is negative while the gain between the rest of the\nmanipulated variables and P is positive. These results suggest that,\nat this operating point, P could be minimized if u1 is maximized\nwhile u2 to u8 are minimized.\n\n\n\n3.7. Linear model 77\n\n-1\n00\n\n1\n0\n\ny1\nu\n1\n\nu\n2\n\nu\n3\n\nu\n4\n\nu\n5\n\nu\n6\n\nu\n7\n\nu\n8\n\ny2\n\n-1\n00\n\n1\n0\n\ny3 y4\n\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n\n1\n5 0 -5 1\n5 0 -5\n\nFi\ngu\n\nre\n3\n\n.1\n8\n\n:\nM\n\nat\nri\n\nx\nof\n\nth\ne\n\nst\nep\n\nre\nsp\n\non\nse\n\ns\nbe\n\ntw\nee\n\nn\nth\n\ne\np\nos\n\nsi\nbl\n\ne\nm\n\nan\nip\n\nu\nla\n\nte\nd\n\nan\nd\n\nco\nn\n\ntr\nol\n\nle\nd\n\nva\nri\n\nab\nle\n\ns\n\n\n\n78 Chapter 3. Compression System\n\nu\n1\n\nu\n2\n\nu\n3\n\nu\n4\n\nu\n5\n\nu\n6\n\nu\n7\n\nu\n8\n\n-1\n0 0\n1\n0\n\ny5\n\n-1\n0 0\n1\n0\n\ny6y7\n\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n\n3\n00\n\n-1\n0\n\nFigu\nre\n\n3\n.1\n\n9\n:\n\nM\natrix\n\nof\nth\n\ne\nstep\n\nresp\non\n\nses\nbetw\n\neen\nth\n\ne\np\nossible\n\nm\nan\n\nip\nu\n\nlated\nan\n\nd\ncon\n\ntrolled\nvariables\n\n\n\n3.7. Linear model 79\n\nu\n1\n\nu\n2\n\nu\n3\n\nu\n4\n\nu\n5\n\nu\n6\n\nu\n7\n\nu\n8\n\n-1\n00\n1\n0\n\ny8\n\n-1\n00\n1\n0\n\ny9 y10\n\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n\n3\n0 0\n\n-1\n0\n\nFi\ngu\n\nre\n3\n\n.2\n0\n\n:\nM\n\nat\nri\n\nx\nof\n\nth\ne\n\nst\nep\n\nre\nsp\n\non\nse\n\ns\nbe\n\ntw\nee\n\nn\nth\n\ne\np\nos\n\nsi\nbl\n\ne\nm\n\nan\nip\n\nu\nla\n\nte\nd\n\nan\nd\n\nco\nn\n\ntr\nol\n\nle\nd\n\nva\nri\n\nab\nle\n\ns\n\n\n\n80 Chapter 3. Compression System\n\nu\n1\n\nu\n2\n\nu\n3\n\nu\n4\n\nu\n5\n\nu\n6\n\nu\n7\n\nu\n8\n\n0\n1\n0\n\ny11\n\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n0\n1\n0\n\n50\n\n-1\n5\n\nFigu\nre\n\n3\n.2\n\n1\n:\n\nM\natrix\n\nof\nth\n\ne\nstep\n\nresp\non\n\nses\nbetw\n\neen\nth\n\ne\np\nossible\n\nm\nan\n\nip\nu\n\nlated\nan\n\nd\ncon\n\ntrolled\nvariables\n\n\n\n3.7. Linear model 81\n\nThe relation between P and pin is particularly interesting.\nThere is a direct relation between the gas mass flow rate mcp and\nconsumed power P , meaning that an increase on mcp implies in the\ngreater consumption of power. At the same time there is a direct\nrelation between the head H and P . Since the head depends on\nthe pressure ratio r = pd/ps and assuming a fixed discharge pres-\nsure pd, it is possible to conclude that there is an inverse relation\nbetween the suction pressure ps and the consumed power P . That\nis, if the suction pressure is increased, less power is required in the\ncompression process.\n\nP =\nmcpH\n\n\\eta p\n(3.69)\n\nH =\nZ1RT1\nMW\n\n\\eta pk\n\nk  - 1\n\n\\Biggl[ \\biggl( \npd\nps\n\n\\biggr) k - 1\n\\eta pk\n\n - 1\n\n\\Biggr] \n. (3.70)\n\nWhen the compressor is not recycling, the static gain between\nps and P is negative. In this situation, changes in the pressure will\nnot result in changes in the gas mass flow through the compressor.\nBut when the compressor is recycling gas to avoid surge, a reduction\nin ps moves the system away from the surge region, which leads to\na reduction on the recycled gas flow mr and consequently on the\nflow through the compressor mcp. As explained before, a reduction\nin mcp leads to a reduction in power consumption. So, if there is\ngas recirculation, the static gain between ps and P could become\npositive.\n\nFigure 3.22 shows the static relation between pin, P , and\n\\phi 1ASV . These values were obtained for a low gas flow rate, when\nthe compression system is forced to recycle gas to avoid surge. The\ndashed blue line represents the relation between pin and the anti-\nsurge valve opening of the first stage \\phi 1ASV in steady state. In this\nsituation, smaller values of pin require smaller \\phi 1ASV to avoid surge.\nThe solid red line represents the relation between pin and the con-\nsumed power P . In this situation the gain between these variables\nchanges signal. For this reason, including the model for pin \\times P in\nthe prediction model of the MPC could decrease the system\u2019s perfor-\nmance instead of improving it.\n\n\n\n82 Chapter 3. Compression System\n\n?\nASV\n\nP\n\nN\no\nrm\n\nil\niz\n\ne\nd\n p\n\no\nw\n\ne\nr \n\n[-\n]\n\n0.652\n\n0.650\n\n0.648\n\n0.646\n\n?\nA\n\nS\nV\n\n[-\n]\n\n0.6\n\n0.5\n\n0.4\n\n0.3\n\np\nin\n\n[bar]\n4.4 4.6 4.8 5.0 5.2 5.4 5.6 5.8 6.0 6.2\n\nFigure 3.22: Static relation between pin, P , and \\phi ASV,1\n\n3.7.2 Variables selection\n\nConsidering the step responses analysis presented in 3.7.1,\nand which setpoints and valve openings can be changed in the com-\npression system regulatory system, the possible manipulated vari-\nables are:\n\n\\bullet pspin - setpoint of the inlet gas pressure\n\n\\bullet pspout - setpoint of the outlet gas pressure\n\n\\bullet \\phi ASV,11 - opening of the antisurge valve of stage 11\n\n\\bullet \\phi ASV,12 - opening of the antisurge valve of stage 12\n\n\\bullet \\phi ASV,13 - opening of the antisurge valve of stage 13\n\n\\bullet \\phi ASV,21 - opening of the antisurge valve of stage 21\n\n\\bullet \\phi ASV,22 - opening of the antisurge valve of stage 22\n\n\\bullet \\phi ASV,23 - opening of the antisurge valve of stage 23\n\nBased on the control objectives described in section 3.6, the\npossible controlled variables are:\n\n\\bullet IS11 - surge index of stage 11\n\n\n\n3.8. Final comments 83\n\n\\bullet IS12 - surge index of stage 12\n\n\\bullet IS13 - surge index of stage 13\n\n\\bullet IS21 - surge index of stage 21\n\n\\bullet IS22 - surge index of stage 22\n\n\\bullet IS23 - surge index of stage 23\n\nBesides these variables, the energy consumption E could be\nincluded as an additional objective in the objective function to guar-\nantee energy minimization.\n\nThe energy consumption depends on the power consumed\nby the compression system. As explained before, the static gain be-\ntween pin and P changes with the operation point. Changes in the\nsignal of static gains can be difficult for the linear MPC algorithm to\ncorrect and the controller could not work properly.\n\n3.8 FINAL COMMENTS\n\nThis chapter described the compression system studied in this\ndissertation, with a detailed description of the system\u2019s mathemat-\nical model. This nonlinear model was used to simulate the system\nand to study its behavior. This model, that is one of the contribu-\ntions of this work, was published in [25, 35].\n\nThis chapter also presented an analysis of the potential con-\ntrolled and manipulated variables to be used by the MPC controllers\nto achieve the control objectives. Based on the variables selection,\nthe linearized prediction models were then obtained from the non-\nlinear model.\n\nNext chapter presents two MPC controllers. In the first one,\nthe manipulated variables are driven to values that minimize the\npower consumption. The total energy is then minimized indirectly.\nIn the second formulation, the energy consumption is minimized\ndirectly in the objective function. This requires a linear model to ex-\npress the dynamics between the manipulated variables and energy\nconsumption\n\n\n\n\n\n4 IMPLEMENTATION AND RESULTS\n\nThis chapter presents the two different MPC configurations\nthat were tested to achieve the control objectives and improve the\ncompression system\u2019s performance. The results were also compared\nwith the system controlled by the regulatory layer only. The MPC\ncontroller implemented for this study is a recursive DMC controller\nwith a correction filter like the one proposed in [21].\n\nThe MPC controller is implemented as a layer above the low-\nlevel or regulatory control, formed by the PID controllers, as illus-\ntrated in figure 4.1.\n\nMPC\n\nPID\n\nProcess\n\nFigure 4.1: MPC and PID interaction\n\nThese experiments were also implemented in Matlab and the\ndifferential equations were solved with ODE45. The sampling time\nfor the MPC controller is 5s. The process was simulated using the\ncomplete non-linear model of the plant described in section 3.3.\n\nEach MPC has a set of controlled variables, henceforth called\ny, and manipulated variables, henceforth called u. The selection of\nthese variables was based on the control objective defined for the\ncompression system, and system analysis presented on chapter 3.\n\nAs explained before, the control actions are uk = uk - 1 +\\Delta \\bfu k\nand the increments \\Delta \\bfu k are obtained through the minimization of\na cost function subject to constraints.\n\nThe MPC controllers studied in this dissertation have differ-\nent objective functions and tuning strategies. Section 4.1 has a de-\ntailed explanation of the MPC implementations tested in the sce-\nnario with no additional modeling errors. The results of the appli-\ncation of both MPC formulations were very similar, but only MPC2\ncould be improved by a more appropriated tuning of the controller.\nIn section 4.2 a robustness test is presented. In the test, modeling\nerrors were introduced and only the second MPC implementation\nwas considered robust.\n\n85\n\n\n\n86 Chapter 4. Implementation and Results\n\n4.1 MPC IMPLEMENTATIONS\n\nThe MPC controllers exposed in this section are variations of\nthe DMC algorithm, as explained in section 2.2. The first MPC imple-\nmented (section 4.1.1) does not consider the energy consumption\ndirectly in its formulation due to its very nonlinear relation with\nthe manipulated variables. The energy consumption was included\nin the second MPC formulation (section 4.1.2). As this process has\nvariables with very different dynamics and amplitudes, tuning the\nMPC is not straightforward. Hence, in section 4.1.3 the satisficing\ntuning technique was applied to the MPC2 formulation to obtain\nmore appropriate weights. The application of the technique led to a\nimproved controller performance. The results were also compared\nagainst the system controlled only with the PID controllers. This\ncomparison is carried out in the same scenario explained in sec-\ntion 3, where the gas flow rate that enters the compression system\nwas used to disturb the plant\u2019s behavior. Figure 4.2 represents the\nchanges in the gas flow rate min during the simulation. The flow\nstarts at 21.5857 kg/s, then it drops to 50% of the initial value,\ncausing the system to go into surge without a proper control strat-\negy. After that the flow rises to 115% of its initial value, causing the\ninput pressure to go above its maximum limit, that can cause the\nflare of part of the entering gas.\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n10\n\n15\n\n20\n\n25\n\n k\ng/\n\ns \n\nFigure 4.2: Gas flow rate that enters the compression system - min\n\nThe controlled and manipulated variables, the objective func-\ntion, and the constraints were chosen based on the compression\nsystem analysis presented in chapter 3 and are described for each\ncontroller in the following sections.\n\n\n\n4.1. MPC implementations 87\n\n4.1.1 MPC 1\n\nThe energy consumption can be minimized if pin is maxi-\nmized and pout and mr are minimized. For this compression sys-\ntem it is easy to determine the ideal values for the manipulated\nvariables that guarantee energy saving. So, instead of considering\nthe consumed energy as a term in the control objective function,\nthis first MPC was designed to drive the manipulated variables to\ntheir ideal values whenever possible. With this formulation, it is not\nnecessary to include the model that relates the power with the ma-\nnipulated variables, so the controller will not have to deal with its\nnonlinearities.\n\nControlled and manipulated variables\n\nTo achieve the control objectives the MPC1 controlled vari-\nables (y) are:\n\n\\bullet y1: surge index of stage 11 (IS11)\n\n\\bullet y2: surge index of stage 12 (IS12)\n\n\\bullet y3: surge index of stage 13 (IS13)\n\n\\bullet y4: surge index of stage 21 (IS21)\n\n\\bullet y5: surge index of stage 22 (IS22)\n\n\\bullet y6: surge index of stage 23 (IS23)\n\nTo keep these variables controlled, the MPC1 manipulated\nvariables (u), are:\n\n\\bullet u1: setpoint of the inlet gas pressure (Pinsp)\n\n\\bullet u2: setpoint of the outlet gas pressure (Poutsp)\n\n\\bullet u3: opening of the antisurge valve of stage 11 (\\phi ASV,11)\n\n\\bullet u4: opening of the antisurge valve of stage 12 (\\phi ASV,12)\n\n\\bullet u5: opening of the antisurge valve of stage 13 (\\phi ASV,13)\n\n\\bullet u6: opening of the antisurge valve of stage 21 (\\phi ASV,21)\n\n\\bullet u7: opening of the antisurge valve of stage 22 (\\phi ASV,22)\n\n\\bullet u8: opening of the antisurge valve of stage 23 (\\phi ASV,23)\n\n\n\n88 Chapter 4. Implementation and Results\n\nThus, MPC1 sends setpoints to the inlet pressure PID con-\ntroller and to the outlet pressure PID controller, and defines the\nposition of the antisurge valves.\n\nObjective function\n\nThe objective of this formulation, J (equation 4.1), is to bring\nthe control variables y to their references yr and the manipulated\nvariables u to their targets ut while minimizing the control variation\n\\Delta \\bfu .\n\nJ = [\\^y  - yr]\nT Qy[\\^y  - yr] + \\Delta \\bfu \n\nT Qu\\Delta \\bfu + [u  - ut]\nT Qt[u  - ut] (4.1)\n\nControl tuning\n\nThe diagonal matrices Qy,Qu, and Qt are formed respectively\nby the weights defined for reference error, target error, and control\nvariation. These weights were chosen manually:\n\nQy = diag([10, 10, 10, 10, 10, 10])\n\nQu = diag([0.1, 0.1, 1, 1, 1, 1, 1, 1])\n\nQt = diag([0.01, 0.01, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1])\n\nThese values were chosen so that the reference error was the\nfirst priority and the target error the last priority in the objective\nfunction minimization. It is important to highlight that \\^y are kept in\na band, as explained is section 2.1.4.\n\nConstraints\n\nThe problem\u2019s constraints are defined in 4.2. There are lower\nand upper boundaries for manipulated and controlled variables, u\nand y. The control increment \\Delta \\bfu is also limited, so the changes in\nthe control actions are smooth.\n\n\\Delta \\bfu min \\leq \\Delta \\bfu \\leq \\Delta \\bfu max (4.2a)\numin \\leq u \\leq umax (4.2b)\n\\^ymin \\leq \\^y \\leq \\^ymax (4.2c)\n\n(4.2d)\n\n\n\n4.1. MPC implementations 89\n\nThe boundaries for the controlled variables are:\n\n0 \\leq y1 \\leq 0.93\n0 \\leq y2 \\leq 0.93\n0 \\leq y3 \\leq 0.93\n0 \\leq y4 \\leq 0.93\n0 \\leq y5 \\leq 0.93\n0 \\leq y6 \\leq 0.93\n\nThe boundaries for the manipulated variables are:\n\n5.27 \\leq u1 \\leq 6.2\n160 \\leq u2 \\leq 200\n\n\\Phi rreg,11 \\leq u3 \\leq 1\n\\Phi rreg,12 \\leq u4 \\leq 1\n\\Phi rreg,13 \\leq u5 \\leq 1\n\\Phi rreg,21 \\leq u6 \\leq 1\n\\Phi rreg,22 \\leq u7 \\leq 1\n\\Phi rreg,23 \\leq u8 \\leq 1\n\nThe lower boundaries for the positions of the antisurge valves\nchange at every iteration. The MPC has to calculate a valve opening\nthat is greater than the one defined by the regulatory control system\nso umin = \\Phi rreg. This ensures that the MPC will never close the\nvalves if the regulatory system decides to open them, condition that\ncan violate the compressor manufacturer\u2019s warranty.\n\nResults\n\nFigures 4.3 to 4.8 show the results of the application of MPC1\nin the simulated scenario presented in figure 4.2. In the figures, the\ndashed black lines represent the system\u2019s performance with the reg-\nulatory system only and the blue solid lines are the results of the\napplication of the MPC1 controller. In figures 4.3a, 4.4a, and 4.5a\nthe doted black lines are the maximum limit of the surge indexes.\nThe results show that MPC1 was able to prevent the system to go\ninto surge, since the indexes never reach the value 1, even when\nthe gas flow rate is at its minimum. But MPC1 was not able to keep\nthe indexes below their upper limit in the steady state. This problem\ncould be solved by selecting a more appropriate set of tuning values.\n\n\n\n90 Chapter 4. Implementation and Results\n\nIf the weights for this objective were greater, the indexes might be\nkept below 0.93. However, when this was tried, the control actions\nwere too aggressive, which suggested that other weights should be\nchanged. The results presented in this section are the best ones ob-\ntained by manual tuning. In this solution 22 weights have to be\nselected to tune the controller. Tuning a MIMO MPC is always diffi-\ncult, and the manual procedure is not simple. Before studying an im-\nproved method for MPC tuning, a different formulation is analyzed.\nSo the next solution includes the energy consumption directly in the\nobjective function and only the target for u1 is kept. The number of\nweights that have to be selected was then reduced, facilitating the\ntuning.\n\n\n\n4.1. MPC implementations 91\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n1 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.5\n\n1\n\n?\nA\n\nS\nV\n\n,1\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.3: Results of the application of MPC1 - Stage 1. Dashed\nblack line: regulatory control without MPC, solid blue line: regula-\ntory control with MPC1, doted black line: surge index upper limit\n\n\n\n92 Chapter 4. Implementation and Results\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n2 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n?\nA\n\nS\nV\n\n,2\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.4: Results of the application of MPC1 - Stage 2. Dashed\nblack line: regulatory control without MPC, solid blue line: regula-\ntory control with MPC1, doted black line: surge index upper limit\n\n\n\n4.1. MPC implementations 93\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.5\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\nIS\n3 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n?\nA\n\nS\nV\n\n,3\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.5: Results of the application of MPC1 - Stage 3. Dashed\nblack line: regulatory control without MPC, solid blue line: regula-\ntory control with MPC1, doted black line: surge index upper limit\n\n\n\n94 Chapter 4. Implementation and Results\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n5.5\n\n6\n\n6.5\n\n7\n\np\nin\n\n [\nba\n\nr]\n\nFigure 4.6: Results of the application of MPC1 - inlet header pres-\nsure. Dashed black line: regulatory control without MPC, solid blue\nline: regulatory control with MPC1\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n160\n\n165\n\n170\n\n175\n\np\nou\n\nt \n[b\n\nar\n]\n\nFigure 4.7: Results of the application of MPC1 - outlet header pres-\nsure. Dashed black line: regulatory control without MPC, solid blue\nline: regulatory control with MPC1\n\n\n\n4.1. MPC implementations 95\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.05\n\n0.1\nm\n\nfl\nar\n\ne \n[k\n\ng/\ns]\n\nFigure 4.8: Results of the application of MPC1 - flared gas. Dashed\nblack line: regulatory control without MPC, solid blue line: regula-\ntory control with MPC1\n\n4.1.2 MPC 2\n\nThis formulation is similar to the previous one in two points:\nthe manipulated variables and constraints remain the same as in\nMPC1. But now energy consumption is minimized directly. To in-\nclude the energy consumption, the objective function was changed.\nSince the energy E is a function of the consumed power P , the\nmodels relating u to P were included and a constraint that limits P\nwas added. But, as explained in subsection 3.7.1, the static gain be-\ntween P and the inlet pressure pin changes signal depending on the\noperation point. Because of this nonlinearity the linearized model\nmay induce the controller to take actions in the wrong direction.\nFor that, the linearized model between P and pin was disregarded.\nThe targets for the manipulated variables were eliminated, except\nthe one for the inlet pressure setpoint, to guarantee that pin would\nreturn to its nominal value whenever possible.\n\nControlled and manipulated variables\n\nThe controlled variables y1 - 6 and the manipulated variables\nu1 - 8 remained the same.\n\nObjective function\n\nIn this case, the objective J (equation 4.3) is to bring the con-\ntrol variables y to their references yr (inside the band) and the ma-\n\n\n\n96 Chapter 4. Implementation and Results\n\nnipulated variable u1 to its target while minimizing the control vari-\nation \\Delta \\bfu and the energy consumption E.\n\nJ = [\\^y  - yr]\nT Qy[\\^y  - yr] + \\Delta \\bfu \n\nT Qu\\Delta \\bfu \n\n+ (u1  - pnomin )\nT Qt(u1  - pnomin ) + EQE (4.3)\n\nControl tuning\n\nThe weight for the minimization of the energy consumption\nwas set to 1 and added as QE. The new diagonal matrices are:\n\nQy = diag([100, 100, 100, 100, 100, 100, 1])\n\nQu = diag([0.1, 0.001, 1, 1, 1, 1, 1, 1])\n\nQt = 0.0005\n\nQE = 1\n\nIn this formulation, \\^y are also kept in a band, as explained in section\n2.1.4. So, if 0 \\leq \\^y \\leq 0.93 then Qy = 0.\n\nConstraints\n\nSince the energy consumption is a function of the power con-\nsumption, the lower and upper limits for power were added. As the\npower value is normalized, the lower limit is 0 and the upper limit\nis 1. All other constraints were maintained.\n\nResults\n\nThe results obtained with the application of the second MPC\nformulation are shown in figures 4.9 to 4.14. In the figures, the\ndashed black lines represent the system\u2019s performance with the reg-\nulatory system only and the blue solid lines are the results of the\napplication of the MPC2 formulation. In figures 4.3a, 4.4a, and 4.5a\nthe doted black lines are the maximum limit of the surge indexes.\nThese results are very similar to the ones obtained with the first\nMPC formulation, presented in subsection 4.1.1. Even though the\npower consumption was reduced, the controller could not keep the\nsurge indexes below their upper limit.\n\nThis formulation was also tested with different tunings and\nin some cases the control actions were too aggressive while in oth-\ners they were smooth but the system\u2019s response was too slow. Thus,\n\n\n\n4.1. MPC implementations 97\n\nit was also difficult to tune manually the weights in MPC2. This\nsuggests the use of a different method for this tuning, which is pre-\nsented hereafter.\n\n\n\n98 Chapter 4. Implementation and Results\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n1 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.5\n\n1\n\n?\nA\n\nS\nV\n\n,1\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.9: Results of the application of MPC2 - Stage 1. Dashed\nblack line: regulatory control without MPC, solid blue line: regula-\ntory control with MPC2, doted black line: surge index upper limit\n\n\n\n4.1. MPC implementations 99\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n2 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n?\nA\n\nS\nV\n\n,2\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.10: Results of the application of MPC2 - Stage 2. Dashed\nblack line: regulatory control without MPC, solid blue line: regula-\ntory control with MPC2, doted black line: surge index upper limit\n\n\n\n100 Chapter 4. Implementation and Results\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.5\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\nIS\n3 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n?\nA\n\nS\nV\n\n,3\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.11: Results of the application of MPC2 - Stage 3. Dashed\nblack line: regulatory control without MPC, solid blue line: regula-\ntory control with MPC2, doted black line: surge index upper limit\n\n\n\n4.1. MPC implementations 101\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n5.5\n\n6\n\n6.5\n\n7\np\n\nin\n [\n\nba\nr]\n\nFigure 4.12: Results of the application of MPC2 - inlet header pres-\nsure. Dashed black line: regulatory control without MPC, solid blue\nline: regulatory control with MPC2\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n160\n\n165\n\n170\n\n175\n\np\nou\n\nt \n[b\n\nar\n]\n\nFigure 4.13: Results of the application of MPC2 - outlet header pres-\nsure. Dashed black line: regulatory control without MPC, solid blue\nline: regulatory control with MPC2\n\n\n\n102 Chapter 4. Implementation and Results\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.05\n\n0.1\n\nm\nfl\n\nar\ne \n\n[k\ng/\n\ns]\n\nFigure 4.14: Results of the application of MPC2 - flared gas. Dashed\nblack line: regulatory control without MPC, solid blue line: regula-\ntory control with MPC2\n\n4.1.3 MPC with satisficing tuning\n\nThe results shown in the previous subsections suggest that\nthe MPC could be a good approach to improve the compression sys-\ntem control, however tuning the parameters of the weight matrices\nQy, Qu, and Qt have showed to be difficult, mainly because of the\ndifferent dynamics and ranges that each variable has. To overcome\nthis problem, the satisficing MPC tuning was used. The results of\nMPC1 were not improved with this technique, so only the results of\nMPC2 are shown in this section. The satisficing technique requires\nthat acceptable ranges for each variable are defined, as explained\nin section 2.3. For this problem, the ranges were chosen as:\n\nF \\Delta usat = Nu[0.1\n2 202 0.052 0.052 0.052 0.052 0.052 0.052]T\n\nF utsat = Nu[5\n2]T\n\nF\ny\nsat = N[0.01\n\n2 0.012 0.012 0.012 0.012 0.012]T\n\nF Esat = N[0.5\n2]T\n\nwhere:\n\nF \\Delta usat - factor used to calculate the weights of Qu for the control\nincrements \\Delta \\bfu ,\n\nF utsat - factor used to calculate the weight of Qt for the target error\n(u1  - pnomin ),\n\n\n\n4.1. MPC implementations 103\n\nF\ny\nsat - factor used to calculate the weights of Qy for the reference\n\nerror [\\^y  - yr],\n\nF Esat - factor used to calculate the weight of QE for energy con-\nsumption minimization E,\n\nNu - control horizon,\n\nN - prediction horizon.\n\nResults\n\nThe results obtained by tuning MPC2 with the satisficing tun-\ning technique are shown in figures 4.15 to 4.21. The performance\nof MPC1 was not improved by the technique so only the results ob-\ntained with MPC 2 are shown. The black dashed lines correspond to\nthe compression system with the regulatory control only. The blue\ndash-dot lines correspond to the results of the application of MPC2\nwith manual tuning while the red solid lines are the results of the\napplication of MPC2 with satisficing tuning.\n\n\n\n104 Chapter 4. Implementation and Results\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n1 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.5\n\n1\n\n?\nA\n\nS\nV\n\n,1\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.15: Results of the satisficing tuning applied on MPC2 -\nStage 1. Dashed black line: regulatory control without MPC, solid\nblue line: regulatory control with MPC2 tuned manually, solid red\nline: regulatory control with MPC2 tuned with the satisficing tech-\nnique, doted black line: surge index upper limit\n\n\n\n4.1. MPC implementations 105\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n2 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n?\nA\n\nS\nV\n\n,2\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.16: Results of the satisficing tuning applied on MPC2 -\nStage 2. Dashed black line: regulatory control without MPC, solid\nblue line: regulatory control with MPC2 tuned manually, solid red\nline: regulatory control with MPC2 tuned with the satisficing tech-\nnique, doted black line: surge index upper limit\n\n\n\n106 Chapter 4. Implementation and Results\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.5\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\nIS\n3 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n?\nA\n\nS\nV\n\n,3\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.17: Results of the satisficing tuning applied on MPC2 -\nStage 3. Dashed black line: regulatory control without MPC, solid\nblue line: regulatory control with MPC2 tuned manually, solid red\nline: regulatory control with MPC2 tuned with the satisficing tech-\nnique, doted black line: surge index upper limit\n\n\n\n4.1. MPC implementations 107\n\nThe performance of the controller was improved by the satis-\nficing tuning. The overshoot of the surge indexes was reduced, and\nthe MPC2 was able to maintain the indexes at their limit in steady\nstate.\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n5.5\n\n6\n\n6.5\n\n7\n\np\nin\n\n [\nba\n\nr]\n\nFigure 4.18: Results of the satisficing tuning applied on MPC2 - in-\nlet header pressure. Dashed black line: regulatory control without\nMPC, solid blue line: regulatory control with MPC2 tuned manually,\nsolid red line: regulatory control with MPC2 tuned with the satisfic-\ning technique\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n160\n\n165\n\n170\n\n175\n\np\nou\n\nt \n[b\n\nar\n]\n\nFigure 4.19: Results of the satisficing tuning applied on MPC2 - out-\nlet header pressure. Dashed black line: regulatory control without\nMPC, solid blue line: regulatory control with MPC2 tuned manually,\nsolid red line: regulatory control with MPC2 tuned with the satisfic-\ning technique\n\n\n\n108 Chapter 4. Implementation and Results\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.05\n\n0.1\n\nm\nfl\n\nar\ne \n\n[k\ng/\n\ns]\n\nFigure 4.20: Results of the satisficing tuning applied on MPC2 -\nflared gas. Dashed black line: regulatory control without MPC, solid\nblue line: regulatory control with MPC2 tuned manually, solid red\nline: regulatory control with MPC2 tuned with the satisficing tech-\nnique\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nN\nom\n\nal\niz\n\ned\n p\n\now\ner\n\n [\n-]\n\nFigure 4.21: Results of the satisficing tuning applied on MPC2 - con-\nsumed power. Dashed black line: regulatory control without MPC,\nsolid blue line: regulatory control with MPC2 tuned manually, solid\nred line: regulatory control with MPC2 tuned with the satisficing\ntechnique\n\nFigure 4.21 shows the power consumed by the compression\nsystem and, even though MPC2 minimizes it directly, there is no sig-\nnificant difference in the consumption. Due to the changes executed\nin pin, both MPC controllers were able to decrease the amount of\n\n\n\n4.2. Robustness analysis 109\n\nTable 4.1: MPC performance comparison\n\nRegulatory MPC1 MPC2 MPC2\nmanual satisficing\n\nEnergy consumption 100% 96.24% 97.92% 97.01%\nFlared gas 100% 9.22% 5.15% 5.15%\nRecycled gas 100% 60.07% 66.23% 63.46%\n\nflared gas.\nTable 4.1 summarizes the performance of the proposed MPCs.\n\nThe results obtained by simulating the system without any MPC\ncontroller were considered the worst case scenario, therefore they\nrepresent 100% of energy consumption, gas flaring, and gas recy-\ncling. For example, the application of the MPC2 algorithm cause\nthe system to recycle only 63.46% of the total amount of gas recy-\ncled by the system with the regulatory control only. The application\nof MPC1 resulted in a smaller energy consumption than the appli-\ncation of MPC2 because MPC1 recycled less gas. However, MPC1\nfail to keep the surge indexes below their maximum limit, as shown\nin figures 4.3a to 4.5a. MPC2 spends more energy recycling more\ngas to keep IS \\leq 0.93, as shown in figures 4.15a to 4.17a. The per-\nformance comparison presented in table 4.1 shows little difference\nbetween MPC2 manual and MPC2 satisficing. The main advantage\nof the satisficing tuning technique is that it provided a satisfactory\ntune for the MPC controller faster then other heuristic techniques.\n\n4.2 ROBUSTNESS ANALYSIS\n\nTo further investigate the proposed solutions a robustness\nanalysis was made. To do so, errors in critical parameters were in-\ntroduced. These parameters were selected based on the practical\nknowledge of the process engineers regarding the studied compres-\nsion system:\n\n\\bullet Molecular weight of the gas - \\pm 15\\%\n\n\\bullet Moment of inertia of the compressors turbines - \\pm 40\\%\n\n\\bullet Antisurge valves coefficients - \\pm 20\\%\n\n\\bullet Scrubber volumes - \\pm 40\\%\n\n\n\n110 Chapter 4. Implementation and Results\n\nThe linearized prediction model was obtained at the same\nequilibrium point used by the manufacturer to obtain the compres-\nsor\u2019s data sheet, that is the same gas molecular weight, flow rate,\nand pressure to be the nominal values defined by the manufacturer.\nThe scenario presented in the previous section was simulated 50\ntimes. Each time, randomly chosen errors were added to the listed\nparameters. In each simulation the prediction model remained the\nsame but the plant was different. The error added to each parame-\nter was randomly chosen in a rectangular distribution between the\ndefined limits. Figures 4.22a to 4.28 show the results of the robust-\nness test applied to MPC2. The black solid lines represent the regu-\nlatory control results and the colored dashed lines are the results of\nthe MPC2 in several simulations. Even though there are differences\nin the results, they are very similar. The optimization problem cre-\nated to obtain the control increments was never infeasible and MPC\ncontroller worked properly at every simulation.\n\n\n\n4.2. Robustness analysis 111\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n1 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.5\n\n1\n\n?\nA\n\nS\nV\n\n,1\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.22: Results of the robustness test - stage 1. Solid black line:\nregulatory control without MPC, colored dashed lines: regulatory\ncontrol with MPC2, doted black line: surge index upper limit\n\n\n\n112 Chapter 4. Implementation and Results\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nIS\n2 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n?\nA\n\nS\nV\n\n,2\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.23: Results of the robustness test - stage 2. Solid black line:\nregulatory control without MPC, colored dashed lines: regulatory\ncontrol with MPC2, doted black line: surge index upper limit\n\n\n\n4.2. Robustness analysis 113\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.5\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\nIS\n3 \n\n[-\n]\n\n(a) Surge index\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.2\n\n0.4\n\n0.6\n\n0.8\n\n?\nA\n\nS\nV\n\n,3\n [\n\n-]\n\n(b) Antisurge valve opening\n\nFigure 4.24: Results of the robustness test - stage 3. Solid black line:\nregulatory control without MPC, colored dashed lines: regulatory\ncontrol with MPC2, doted black line: surge index upper limit\n\n\n\n114 Chapter 4. Implementation and Results\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n5.5\n\n6\n\n6.5\n\n7\n\np\nin\n\n [\nba\n\nr]\n\nFigure 4.25: Results of the robustness test - inlet header pressure.\nSolid black line: regulatory control without MPC, colored dashed\nlines: regulatory control with MPC2\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n160\n\n165\n\n170\n\n175\n\np\nou\n\nt \n[b\n\nar\n]\n\nFigure 4.26: Results of the robustness test - outlet header pressure.\nSolid black line: regulatory control without MPC, colored dashed\nlines: regulatory control with MPC2\n\n\n\n4.2. Robustness analysis 115\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0\n\n0.05\n\n0.1\nm\n\nfl\nar\n\ne \n[k\n\ng/\ns]\n\nFigure 4.27: Results of the robustness test - flared gas. Solid black\nline: regulatory control without MPC, colored dashed lines: regula-\ntory control with MPC2\n\n0 5 10 15 20 25 30 35\n\nTime [min]\n\n0.6\n\n0.7\n\n0.8\n\n0.9\n\n1\n\nN\nom\n\nal\niz\n\ned\n c\n\non\nsu\n\nm\ned\n\n p\now\n\ner\n [\n\n-]\n\nFigure 4.28: Results of the robustness test - consumed power. Solid\nblack line: regulatory control without MPC, colored dashed lines:\nregulatory control with MPC2\n\nWith these results it is expected that the MPC2 could be ap-\nplied to the real compression system. The same test was performed\nwith the MPC1, but in this case the results showed that this solution\nis less robust. The optimization problem was infeasible in the ma-\njority of the simulations and the MPC algorithm could not calculate\nthe control actions for control the system.\n\n\n\n116 Chapter 4. Implementation and Results\n\n4.3 FINAL COMMENTS\n\nThis chapter presented the implementations of two MPC con-\ntrollers and the results of their application. It also presented the\nresults of the applications of the satisficing tuning technique and\nthe results of a robustness test.\n\nIn the first MPC formulation, the total energy is minimized in-\ndirectly as the controller drives the manipulated variables to values\nthat minimize the power consumption. This formulation was tried\nso that the nonlinearities between the power consumption and the\ninlet header pressure would not affect the system\u2019s performance,\nsince the model that relates them would not be used. But these\nresults were not satisfactory and could not be improved by the sat-\nisficing tuning. MPC1 also failed the robustness test.\n\nThe second MPC formulation had better results than the first\none. In MPC2 formulation the energy consumption was included\nin the objective function so it could be minimized directly. MPC2\u2019s\nperformance was improved by the application of the satisficing tech-\nnique. MPC2 passed the robustness test because it worked well even\nwhen critical parameters of the model were changed.\n\n\n\n5 CONCLUSIONS\n\nIn this dissertation a MPC controller was proposed to improve\nthe performance of an compression system. For that, a detailed de-\nscription of the system\u2019s mathematical model was presented, along\nwith the analysis of the system\u2019s behavior and of the potential con-\ntrolled and manipulated variables to be used by the MPC controllers\nto achieve the control objectives. A tuning technique was also tested\nto improve the system\u2019s performance and a robustness test was per-\nformed. Two MPC formulations were presented. In the first one,\nthe energy consumption is minimized indirectly while in the second\nformulation the energy consumption is minimized directly in the ob-\njective function. Only the second formulation achieved the control\nobjectives and proved to be robust to the disturbance applied.\n\nThe main contributions of this dissertation are:\n\n\\bullet the modeling and analysis of a complete compression system\nfrom a real oil production platform,\n\n\\bullet the formulation of a MPC controller as a control layer above\nthe regulatory system, running at a higher sampling period,\n\n\\bullet the application of a tuning technique that improved the sys-\ntem\u2019s performance.\n\nIn the literature, several compressor models can be found, but\nthey usually describe the compression on a single stage. In this dis-\nsertation, the modeled system consists of two parallel 3-stage com-\npressors with an inlet header and an outlet header. Chapter 3 pre-\nsented the modeling and analysis of the compression system. This\nmodeling resulted in two publications [25, 35].\n\nThis work also presented a MPC controller capable of prevent-\ning surge and while minimizing energy consumption. Chapter 2 pre-\nsented important concepts used in the MPC formulation along with\nthe satisficing technique to tune the MPC controller. The applica-\ntion of this technique improved the MPC controller\u2019s performance.\nThe possibility of implementing the MPC as a control layer above\nthe regulatory PID controllers with a greater sampling time was in-\nvestigated. Even though the surge phenomena occurs in less than a\nsecond and the MPC was set to run every 5 seconds, the MPC\u2019s pre-\ndictive ability allowed the controller to drive the system to a safer\noperation point, preventing surge.\n\nRegarding practical outcome, because of the success of the\nproposed control strategy in the simulated plant, the algorithm will\n\n117\n\n\n\n118 Chapter 5. Conclusions\n\nbe implemented in a real-time control software. After exhaustive\ntestings, it may be applied on a real oil and gas production platform.\nRegarding academic follow-up, it will be performed a test to assess\nthe MPC controller\u2019s performance in a scenario of a compression\ntrain shutdown.\n\n\n\nREFERENCES\n\n1 AGUIAR, M. A.; CODAS, A.; CAMPONOGARA, E. Systemwide\noptimal control of offshore oil production networks with time\ndependent constraints. IFAC-PapersOnLine, v. 48, n. 6, p. 200 \u2013 207,\n2015.\n\n2 GRAVDAHL, J. T. Modeling and Control of Surge and Rotating\nStall in Compressors. Thesis (PhD) \u2014 NTNU-Norwegian University of\nScience and Technology, Trondheim, Norway, 1998.\n\n3 RAMUSSEN, P. C.; KURZ, R. Centrifugal compressor applications -\nustream and midstream. 38th Turbomachinery Symposium, 2009.\n\n4 GRAVDAHL, J. T. et al. Modeling for surge control of centrifugal\ncompressors:comparison with experiment. Proceedings of the 39th IEEE\nConference on Decision and Control, 2000.\n\n5 BUDINIS, S.; THORNHILL, N. F. Control of centrifugal compressors\nvia model predictive control for enhanced oil recovery applications.\nProceeding of the 2nd IFAC Workshop on Automatic Control in Offshore\nOil and Gas Production, Florianopolis, SC, Brasil, 2015.\n\n6 TORRISI, G. et al. Model predictive control approaches for\ncentrifugal compression systems. Proceedings of the 54th IEEE\nConference on Decision and Control, 2015.\n\n7 GREITZER, E. M. Surge and rotating stall in axial flow\ncompressors\u2014part i: Theoretical compression system model. Journal\nof Engineering for Power - Transactions of the ASME, p. 190\u2013198, 1976.\n\n8 GRAVDAHL, J. T.; EGELAND, O. Speed and surge control for a low\norder centrifugal compressor model. Model Identification and Control,\nvol.19, n1, 13-29, 1998.\n\n9 BOINOV, K. O. et al. Surge control of the electrically driven\ncentrifugal compressor. IEEE TRANSACTIONS ON INDUSTRY\nAPPLICATIONS, VOL. 42, NO. 6, NOVEMBER/DECEMBER 2006, 2006.\n\n10 DORMIDO, S. Una revisi\u00f3n de las tecnolog\u00edas de control predictivo\nbasado en modelos en la industria. Wokshop sobre estado y perspectivas\ndel control predictivo, Valladolid, Spain, 1987.\n\n11 OVERVAG, T. F. Centrifugal Compressor Load Sharing with the use\nof MPC. Thesis (PhD) \u2014 NTNU-Norwegian University of Science and\nTechnology, Trondheim, Norway, 2013.\n\n119\n\n\n\n120 References\n\n12 CORTINOVIS, A. et al. Model predictive anti-surge control of\ncentrifugal compressors with variable-speed drives. Proceedings of the\n2012 IFAC Workshop on Automatic Control in Offshore Oil and Gas\nProduction, Trondheim, Norway, 2012.\n\n13 SMEULERS, J.; BOUMAN, I. W.; ESSEN, H. van. Model predictive\ncontrol of compressor installations. Proceedings of the IMeche 1999,\nTrondheim, Norway, 1999.\n\n14 SANTOS, J. E. W. dos. M\u00e9todo de Ajuste para MPC baseado Em\nMulti-Cen\u00e1rios para Sistemas N\u00e3o Quadrados. Dissertation (Master) \u2014\nUniversidade Federal do Rio Grande do Sul, Porto Alegre, 2016.\n\n15 GARRIGA, J. L.; SOROUSH, M. Model predictive control tuning\nmethods: A review. Industrial and Engineering Chemistry Research,\nn. 49, p. 3505\u20133515, 2010.\n\n16 LIMA, M. L. et al. Distributed Satisficing MPC. IEEE Transactions\non Control Systems Technology, v. 23, n. 1, p. 305\u2013312, 2015.\n\n17 BERGH, L. G.; MACGREGOR, J. F. Constrained minimum variance\ncontrollers: Internal model structure and robustness properties. Ind.\nEng. Chem. Res., v. 26, p. 1558\u20131564, 1987.\n\n18 PALMOR, Z. Properties of optimal stochastic control systems with\ndead-time. Automatica, v. 18, p. 107\u2013116, 1982.\n\n19 CAMACHO, E.; BORDONS, C. Model Predictive Control. Berlin:\nSpringer, 2007.\n\n20 FLESCH, R. C. C. Contribuicoes ao Controle de Sistemas\nMonovariaveis e Multivariaveis com Atraso de Transporte. Thesis (PhD)\n\u2014 Universidade Federal de Santa Catarina, 2012.\n\n21 LIMA, D. M. et al. Improving Robustness and Disturbance\nRejection Performance with Industrial MPC. Congresso Brasileiro de\nAutom\u00e1tica, 2014.\n\n22 MORARI, M.; LEE, J. H.; GARCIA, C. E. Model Predictive Control.\nNew Jersey: Prentice Hall, 2002.\n\n23 M.P.BOYCE et al. Practical aspects of centrifugal compressors\nsurge and surge control. Proceedings of the Twelfth Turbomachinery\nSymposium, 1983.\n\n\n\nReferences 121\n\n24 HANSEN, C. Dynamic Simulation of Compressor Control Systems.\nThesis (PhD) \u2014 Aalborg University Esbjerg, Niels Bohrs vej 86700\nEsbjerg, Denmark, 2008.\n\n25 PLUCENIO, A. et al. Modeling and control of a gas compression\nstation used in an oil platform. Congresso Brasileiro de Autom\u00e1tica,\nVitoria, ES, Brasil, 2016.\n\n26 HAFAIFA, B. R. A.; MOULOUD, G. Modeling of surge phenomena\nin a centrifugal compressor: experimental analysis for control. Systems\nScience and Control Engineering, 2 : 1, 632  - 641, 2014.\n\n27 GRAVDAHL, J. T. et al. Modeling for surge control in free-spool\ncentrifugal compresssors:experimental validation. JOURNAL OF\nPROPULSION AND POWER, 2004.\n\n28 JIANG, J. K. W.; DOUGAL, R. A. Dynamic centrifugal compressor\nmodel for system simulation. Journal of Power Sources, 2005.\n\n29 PAPARELLA, F. et al. Load sharing optimization of parallel\ncompressors. European Control Conference, ECC, 2013.\n\n30 NIEUWENHUIZEN, M. Parameter analysis and identification of\nthe Greitzer model by analogy with the Van der Pol equation. Thesis\n(PhD) \u2014 Technische Universiteit Eindhoven, Department Mechanical\nEngineering, Dynamics and Control Technology Group, De Rondom 70,\n5612 AP Eindhoven, Netherlands, 2008.\n\n31 BOHAGEN, B. Active surge control of centrifugal compression\nsystems. Thesis (PhD) \u2014 NTNU-Norwegian University of Science and\nTechnology, Trondheim, Norway, 2007.\n\n32 DRESSER. Control Valve Sizing Handbook. Huston: Dresser\nMasoneilan, 2009.\n\n33 PLUCENIO, A. Desenvolvimento de Tecnicas de Controle Nao Linear\npara Elevacao de Fluidos Multifasicos. Thesis (PhD) \u2014 Programa\nde Pos-Graduacao em Engenharia de Automacao e Sistemas, DAS,\nUniversidade Federal de Santa Catarina, Florianopolis-SC-Brasil, 2010.\n\n34 YANG, B. P.; PLUCENIO, A. Practical non-linear model predictive\ncontrol pnmpc: Algorithm implementations. Congresso Brasileiro de\nAutom\u00e1tica, Vitoria, ES, Brasil, 2016.\n\n\n\n122 References\n\n35 PLUCENIO, A. et al. Advanced control applied to a gas\ncompression station of a production platform. Congresso Brasileiro de\nAutom\u00e1tica, Vitoria, ES, Brasil, 2016.\n\n\n\tResumo Estendido\n\tAbstract\n\tList of Figures\n\tList of Tables\n\tAcronyms\n\tSymbols\n\tContents\n\tIntroduction\n\tObjectives and contributions\n\tOrganization of the dissertation\n\n\tModel Predictive Control\n\tMPC elements\n\tPrediction model\n\tProcess model\n\tDisturbance model\n\tFree and forced response\n\n\tObjective function\n\tConstraints\n\n\tControl law\n\tReference tracking and band control\n\n\tDynamic Matrix Controller (DMC)\n\tMPC Tuning with Satisficing Technique\n\tFinal comments\n\n\tCompression System\n\tSurge and Stonewall\n\tSurge indexes\n\tModeling\n\tCompression stage\n\tPower consumption\n\tInlet header\n\tOutlet header\n\n\tRegulatory control\n\tInlet pressure and load sharing\n\tOutlet header pressure \n\tAntisurge control\n\tSuction temperature control\n\n\tSystem simulation\n\tControl objectives\n\tLinear model\n\tStep responses analysis\n\tVariables selection\n\n\tFinal comments\n\n\tImplementation and Results\n\tMPC implementations\n\tMPC 1\n\tMPC 2\n\tMPC with satisficing tuning\n\n\tRobustness analysis\n\tFinal comments\n\n\tConclusions\n\tReferences"}]}}}